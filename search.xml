<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[å›¾åºŠå¤±æ•ˆäº†ï¼Ÿä¹Ÿè®¸ä½ åº”è¯¥è¯•è¯•è¿™ä¸ªå·¥å…·]]></title>
    <url>%2F2019%2F05%2F08%2Ftools%2Fblog-toolbox%2F</url>
    <content type="text"><![CDATA[å‰è¨€ç»è¿‡å‡ ä¸ªå°ä¼™ä¼´çš„æé†’ï¼Œå‘ç°ä¸ªäººåšå®¢ä¸­çš„è®¸å¤šå›¾ç‰‡éƒ½è£‚äº†æ— æ³•è®¿é—®ï¼›åŸå› å°±ä¸å¤šè¯´ï¼Œæ—¢ç„¶å‡ºç°é—®é¢˜å°±å¾—è¦è§£å†³ã€‚ åŸæœ¬æˆ‘çš„å¤„ç†æ–¹å¼éå¸¸ç®€å•ç²—æš´ï¼šæ‰¾åˆ°åŸæœ‰çš„å›¾ç‰‡é‡æ–°ä¸‹è½½ä¸‹æ¥ä¸Šä¼ åˆ°æ–°çš„å¯ç”¨å›¾åºŠå†æŠŠå›¾ç‰‡åœ°å€æ›¿æ¢ã€‚ è¿™æ ·æäº†ä¸€ä¸¤ç¯‡ä¹‹åæˆ‘å°±ç»æœ›äº†ã€‚ã€‚ã€‚ ä¹‹å‰ä¸ºäº†ä»£ç èƒ½åœ¨å…¬ä¼—å·é‡Œä¹Ÿæœ‰å¥½çš„é˜…è¯»ä½“éªŒï¼Œæ‰€ä»¥èƒ½æˆªå›¾çš„æˆ‘ç»ä¸è´´ä»£ç ï¼Œå¯¼è‡´ä¸€ç¯‡æ–‡ç« å¤šçš„å¾—æœ‰åå‡ å¼ å›¾ç‰‡ã€‚ å¥½åœ¨å“ªä½å¤§ä½¬è¯´è¿‡â€œä»¥äººè‚‰XXä¸ºè€»â€ï¼Œè¿™ç§é‡å¤åŠ³åŠ¨åŠ›å®Œå…¨å¯è‡ªåŠ¨åŒ–ï¼›äºæ˜¯ä¾¿æœ‰äº†æœ¬æ¬¡çš„è¿™ä¸ªå·¥å…·ã€‚ å®ƒå¯ä»¥ä¸€è¡Œå‘½ä»¤æŠŠä½ æ‰€æœ‰ Markdown å†™çš„å†…å®¹ä¸­çš„å›¾ç‰‡å…¨éƒ¨æ›¿æ¢ä¸ºæ–°çš„å›¾åºŠã€‚ è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š ä½¿ç”¨å¯ä»¥ç›´æ¥åœ¨è¿™ä¸ªåœ°å€ä¸‹è½½ jar åŒ…è¿è¡Œï¼šhttps://github.com/crossoverJie/blog.toolbox/releases/download/v0.0.1/blog.toolbox-0.0.1-SNAPSHOT.jar å½“ç„¶ä¹Ÿå¯ä»¥ä¸‹è½½æºç ç¼–è¯‘è¿è¡Œï¼š 123git clone https://github.com/crossoverJie/blog.toolboxmvn clean packagejava -jar nows-0.0.1-SNAPSHOT.jar --app.downLoad.path=/xx/img /xx/xx/path 100 çœ‹è¿è¡Œæ–¹å¼ä¹ŸçŸ¥é“ï¼Œå…¶å®å°±æ˜¯ç”¨ SpringBoot å†™äº†ä¸€ä¸ªå·¥å…·ç”¨äºæ‰¹é‡ä¸‹è½½æ–‡ä¸­å‡ºç°çš„å›¾ç‰‡åŒæ—¶ä¸Šä¼ åå®Œæˆæ›¿æ¢ã€‚ å…¶ä¸­ app.downLoad.path æ˜¯ç”¨äºå°†ä¸‹è½½çš„å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°ç£ç›˜çš„ç›®å½•ã€‚ /xx/xx/path åˆ™æ˜¯æ‰«æ .md æ–‡ä»¶çš„ç›®å½•ï¼Œä¼šé€’å½’æ‰«ææ‰€æœ‰å‡ºæ‰€æœ‰æ–‡ä»¶ã€‚ 100 åˆ™æ˜¯éœ€è¦æ›¿æ¢æ–‡ä»¶çš„æ•°é‡ï¼Œé»˜è®¤æ˜¯æŒ‰ç…§æ–‡ä»¶ä¿®æ”¹æ—¶é—´æ’åºã€‚ å¦‚æœè‡ªå·±çš„å›¾ç‰‡è¾ƒå¤šçš„è¯è¿˜æ˜¯æœ‰å‡ ä¸ªå‘éœ€è¦æ³¨æ„ä¸‹ã€‚ çº¿ç¨‹æ•°é‡é»˜è®¤æ˜¯å¯åŠ¨äº†ä¸¤ä¸ªçº¿ç¨‹å»éå†æ–‡ä»¶ã€ä¸Šä¼ ä¸‹è½½å›¾ç‰‡ã€æ›´æ–°æ–‡æœ¬ç­‰å†…å®¹ï¼Œå…¶ä¸­çš„ç½‘ç»œ IO å…¶å®æŒºè€—æ—¶çš„ï¼Œæ‰€ä»¥å…¶å®å¯ä»¥é€‚å½“çš„å¤šå¼€äº›çº¿ç¨‹æ¥æé«˜ä»»åŠ¡çš„æ‰§è¡Œæ•ˆç‡ã€‚ ä½†çº¿ç¨‹è¿‡å¤šä¹Ÿè®¸ä¼šè§¦å‘å›¾åºŠçš„ä¿æŠ¤æœºåˆ¶ï¼ŒåŒæ—¶ä¹Ÿå’Œè‡ªå·±ç”µè„‘é…ç½®æœ‰å…³ï¼Œè¿™ä¸ªå¾—ç»“åˆå®é™…æƒ…å†µè€ƒè™‘äº†ã€‚ æ‰€ä»¥å¯ä»¥é€šè¿‡ --app.thread=6 è¿™æ ·çš„å‚æ•°æ¥è°ƒæ•´çº¿ç¨‹æ•°é‡ã€‚ å›¾åºŠé™åˆ¶è¿™ä¸ªæ˜¯å›¾ç‰‡è¿‡å¤šä¸€å®šæ˜¯å¤§æ¦‚ç‡å‡ºç°çš„ï¼Œä¸Šä¼ è¯·æ±‚çš„é¢‘æ¬¡è¿‡é«˜å¾ˆå®¹æ˜“è¢«é™æµå° IPã€‚ 1&#123;"code":"error","msg":"Upload file count limit. Time left 1027 second."&#125; ç›®å‰æ¥çœ‹æ˜¯å° IP å±…å¤šï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡èµ°ä»£ç†ã€æ¢ç½‘ç»œçš„æ–¹å¼æ¥è§£å†³ã€‚ å½“ç„¶å¦‚æœæ˜¯è‡ªæ­å›¾åºŠå¯ä»¥æ— è§†ã€‚ é‡è¯•ç”±äºæˆ‘ä½¿ç”¨çš„æ˜¯å…è´¹å›¾åºŠï¼Œä¸Šä¼ è¿‡ç¨‹ä¸­å¶å°”ä¹Ÿä¼šå‡ºç°ä¸Šä¼ å¤±è´¥çš„æƒ…å†µï¼Œå› æ­¤é»˜è®¤æ˜¯æœ‰ 5 æ¬¡é‡è¯•æœºåˆ¶çš„ï¼›å¦‚æœäº”æ¬¡éƒ½å¤±è´¥äº†é‚£ä¹ˆå¤§æ¦‚ç‡æ˜¯ IP è¢«å°äº†ã€‚ å³ä¾¿æ˜¯ ip è¢«å°ååªè¦æ¢äº†æ–°çš„ ip é‡æ–°æ‰§è¡Œç¨‹åºå®ƒä¼šè‡ªåŠ¨è¿‡æ»¤æ‰å·²ç»æ›¿æ¢çš„å›¾ç‰‡ï¼Œä¸ä¼šå†åšæ— ç”¨åŠŸï¼Œè¿™ç‚¹å¯ä»¥æ”¾å¿ƒã€‚ å›¾ç‰‡ä¿å­˜ é»˜è®¤æƒ…å†µä¸‹,ä¸‹è½½çš„å›¾ç‰‡ä¼šä¿å­˜åœ¨æœ¬åœ°ï¼Œæˆ‘ä¹Ÿå»ºè®®å€Ÿæ­¤æœºä¼šè‡ªå·±æœ¬åœ°éƒ½ç¼“å­˜ä¸€ä»½ï¼ŒåŒæ—¶åå­—è¿˜å’Œæ–‡ä¸­çš„åå­—ä¸€æ ·ï¼Œé¿å…ä»Šåå›¾åºŠå½»åº•æŒ‚æ‰åè¿æ¢å¤çš„æœºä¼šéƒ½æ²¡æœ‰ã€‚ æ€»ç»“è¿™ä¸ªç¨‹åºçš„ä»£ç å°±æ²¡æ€ä¹ˆè®²äº†ï¼Œç¡®å®ä¹ŸæŒºç®€å•ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±ä¸‹æ¥çœ‹çœ‹ã€‚ ç›®å‰åŠŸèƒ½ä¹Ÿå¾ˆå•ä¸€ï¼Œè‡ªç”¨å®Œå…¨å¤Ÿäº†ï¼›çœ‹åç»­å¤§å®¶æ˜¯å¦è¿˜æœ‰å…¶ä»–éœ€æ±‚å†é€æ¸å®Œå–„å§ï¼Œæ¯”å¦‚ï¼š å›¾åºŠä¸Šä¼ å¤±è´¥è‡ªåŠ¨åˆ‡æ¢åˆ°å¯ç”¨å›¾åºŠã€‚ æ•´ä½“å¤„ç†æ•ˆç‡æå‡ã€‚ ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æ›´å¥½çš„è¿›åº¦å±•ç°ç­‰ã€‚ å†æ¬¡è´´ä¸€ä¸‹æºç åœ°å€ï¼š https://github.com/crossoverJie/blog.toolbox ä½ çš„ç‚¹èµä¸åˆ†äº«æ˜¯å¯¹æˆ‘æœ€å¤§çš„æ”¯æŒ]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç­–ç•¥æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€å¹¶å‘åŒ…å…¥å‘æŒ‡åŒ—ã€ä¹‹å‘å¤§ä½¬æ±‡æŠ¥ä»»åŠ¡]]></title>
    <url>%2F2019%2F04%2F28%2Fconcurrent%2FCountDownLatch%2F</url>
    <content type="text"><![CDATA[å‰è¨€åœ¨é¢è¯•è¿‡ç¨‹ä¸­èŠåˆ°å¹¶å‘ç›¸å…³çš„å†…å®¹æ—¶ï¼Œä¸å°‘é¢è¯•å®˜éƒ½å–œæ¬¢é—®è¿™ç±»é—®é¢˜ï¼š å½“ N ä¸ªçº¿ç¨‹åŒæ—¶å®ŒæˆæŸé¡¹ä»»åŠ¡æ—¶ï¼Œå¦‚ä½•çŸ¥é“ä»–ä»¬éƒ½å·²ç»æ‰§è¡Œå®Œæ¯•äº†ã€‚ è¿™ä¹Ÿæ˜¯æœ¬æ¬¡è®¨è®ºçš„è¯é¢˜ä¹‹ä¸€ï¼Œæ‰€ä»¥æœ¬ç¯‡ä¸ºã€å¹¶å‘åŒ…å…¥å‘æŒ‡åŒ—ã€çš„ç¬¬äºŒç¯‡ï¼›æ¥èŠèŠå¸¸è§çš„å¹¶å‘å·¥å…·ã€‚ è‡ªå·±å®ç°å…¶å®è¿™ç±»é—®é¢˜çš„æ ¸å¿ƒè®ºç‚¹éƒ½æ˜¯ï¼šå¦‚ä½•åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å¾—çŸ¥å…¶ä»–çº¿ç¨‹æ˜¯å¦æ‰§è¡Œå®Œæ¯•ã€‚ å‡è®¾ç°åœ¨æœ‰ 3 ä¸ªçº¿ç¨‹åœ¨è¿è¡Œï¼Œéœ€è¦åœ¨ä¸»çº¿ç¨‹ä¸­å¾—çŸ¥ä»–ä»¬çš„è¿è¡Œç»“æœï¼›å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š å®šä¹‰ä¸€ä¸ªè®¡æ•°å™¨ä¸º 3ã€‚ æ¯ä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡åè®¡æ•°å‡ä¸€ã€‚ ä¸€æ—¦è®¡æ•°å™¨å‡ä¸º 0 åˆ™é€šçŸ¥ç­‰å¾…çš„çº¿ç¨‹ã€‚ æ‰€ä»¥ä¹Ÿå¾ˆå®¹æ˜“æƒ³åˆ°å¯ä»¥åˆ©ç”¨ç­‰å¾…é€šçŸ¥æœºåˆ¶æ¥å®ç°ï¼Œå’Œä¸Šæ–‡çš„ã€å¹¶å‘åŒ…å…¥å‘æŒ‡åŒ—ã€ä¹‹é˜»å¡é˜Ÿåˆ—çš„ç±»ä¼¼ã€‚ æŒ‰ç…§è¿™ä¸ªæ€è·¯è‡ªå®šä¹‰äº†ä¸€ä¸ª MultipleThreadCountDownKit å·¥å…·ï¼Œæ„é€ å‡½æ•°å¦‚ä¸‹ï¼š è€ƒè™‘åˆ°å¹¶å‘çš„å‰æï¼Œè¿™ä¸ªè®¡æ•°å™¨è‡ªç„¶éœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ‰€ä»¥é‡‡ç”¨äº† AtomicIntegerã€‚ æ‰€ä»¥åœ¨åˆå§‹åŒ–æ—¶éœ€è¦æ ¹æ®çº¿ç¨‹æ•°é‡æ¥æ„å»ºå¯¹è±¡ã€‚ è®¡æ•°å™¨å‡ä¸€å½“å…¶ä¸­ä¸€ä¸ªä¸šåŠ¡çº¿ç¨‹å®Œæˆåéœ€è¦å°†è¿™ä¸ªè®¡æ•°å™¨å‡ä¸€ï¼Œç›´åˆ°å‡ä¸º0ä¸ºæ­¢ã€‚ 123456789101112131415161718192021/** * çº¿ç¨‹å®Œæˆåè®¡æ•° -1 */public void countDown()&#123; if (counter.get() &lt;= 0)&#123; return; &#125; int count = this.counter.decrementAndGet(); if (count &lt; 0)&#123; throw new RuntimeException("concurrent error") ; &#125; if (count == 0)&#123; synchronized (notify)&#123; notify.notify(); &#125; &#125;&#125; åˆ©ç”¨ counter.decrementAndGet() æ¥ä¿è¯å¤šçº¿ç¨‹çš„åŸå­æ€§ï¼Œå½“å‡ä¸º 0 æ—¶åˆ™åˆ©ç”¨ç­‰å¾…é€šçŸ¥æœºåˆ¶æ¥ notify å…¶ä»–çº¿ç¨‹ã€‚ ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆè€Œéœ€è¦çŸ¥é“ä¸šåŠ¡çº¿ç¨‹æ‰§è¡Œå®Œæ¯•çš„å…¶ä»–çº¿ç¨‹åˆ™éœ€è¦åœ¨æœªå®Œæˆä¹‹å‰ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°ä¸Šæ–‡æåˆ°çš„åœ¨è®¡æ•°å™¨å˜ä¸º 0 æ—¶å¾—åˆ°é€šçŸ¥ã€‚ 12345678910111213141516/** * ç­‰å¾…æ‰€æœ‰çš„çº¿ç¨‹å®Œæˆ * @throws InterruptedException */public void await() throws InterruptedException &#123; synchronized (notify)&#123; while (counter.get() &gt; 0)&#123; notify.wait(); &#125; if (notifyListen != null)&#123; notifyListen.notifyListen(); &#125; &#125;&#125; åŸç†ä¹Ÿå¾ˆç®€å•ï¼Œä¸€æ—¦è®¡æ•°å™¨è¿˜å­˜åœ¨æ—¶åˆ™ä¼šåˆ©ç”¨ notify å¯¹è±¡è¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°è¢«ä¸šåŠ¡çº¿ç¨‹å”¤é†’ã€‚ åŒæ—¶è¿™é‡Œæ–°å¢äº†ä¸€ä¸ªé€šçŸ¥æ¥å£å¯ä»¥è‡ªå®šä¹‰å®ç°å”¤é†’åçš„ä¸€äº›ä¸šåŠ¡é€»è¾‘ï¼Œåæ–‡ä¼šåšæ¼”ç¤ºã€‚ å¹¶å‘æµ‹è¯•ä¸»è¦å°±æ˜¯è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œä¸‹é¢æ¥åšä¸€ä¸ªæ¼”ç¤ºã€‚ åˆå§‹åŒ–äº†ä¸‰ä¸ªè®¡æ•°å™¨çš„å¹¶å‘å·¥å…· MultipleThreadCountDownKit åˆ›å»ºäº†ä¸‰ä¸ªçº¿ç¨‹åˆ†åˆ«æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œå®Œæ¯•åæ‰§è¡Œ countDown()ã€‚ çº¿ç¨‹ 3 ä¼‘çœ äº† 2s ç”¨äºæ¨¡æ‹Ÿä¸šåŠ¡è€—æ—¶ã€‚ ä¸»çº¿ç¨‹æ‰§è¡Œ await() ç­‰å¾…ä»–ä»¬ä¸‰ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚ é€šè¿‡æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡ºä¸»çº¿ç¨‹ä¼šç­‰å¾…æœ€åä¸€ä¸ªçº¿ç¨‹å®Œæˆåæ‰ä¼šé€€å‡ºï¼›ä»è€Œè¾¾åˆ°äº†ä¸»çº¿ç¨‹ç­‰å¾…å…¶ä½™çº¿ç¨‹çš„æ•ˆæœã€‚ 12MultipleThreadCountDownKit multipleThreadKit = new MultipleThreadCountDownKit(3);multipleThreadKit.setNotify(() -&gt; LOGGER.info("ä¸‰ä¸ªçº¿ç¨‹å®Œæˆäº†ä»»åŠ¡")); ä¹Ÿå¯ä»¥åœ¨åˆå§‹åŒ–çš„æ—¶å€™æŒ‡å®šä¸€ä¸ªå›è°ƒæ¥å£ï¼Œç”¨äºæ¥æ”¶ä¸šåŠ¡çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åçš„é€šçŸ¥ã€‚ å½“ç„¶å’Œåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œè¿™æ®µé€»è¾‘æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼ˆå’Œæ‰§è¡Œ await() æ–¹æ³•å¤„äºåŒä¸€ä¸ªçº¿ç¨‹ï¼‰ã€‚ CountDownLatchå½“ç„¶æˆ‘ä»¬è‡ªå·±å®ç°çš„ä»£ç æ²¡æœ‰ç»è¿‡å¤§é‡ç”Ÿäº§ç¯å¢ƒçš„éªŒè¯ï¼Œæ‰€ä»¥ä¸»è¦çš„ç›®çš„è¿˜æ˜¯å°è¯•çª¥æ¢å®˜æ–¹çš„å®ç°åŸç†ã€‚ æ‰€ä»¥æˆ‘ä»¬ç°åœ¨æ¥çœ‹çœ‹ juc ä¸‹çš„ CountDownLatch æ˜¯å¦‚ä½•å®ç°çš„ã€‚ é€šè¿‡æ„é€ å‡½æ•°ä¼šå‘ç°æœ‰ä¸€ä¸ª å†…éƒ¨ç±» Syncï¼Œä»–æ˜¯ç»§æ‰¿äº AbstractQueuedSynchronizer ï¼›è¿™æ˜¯ Java å¹¶å‘åŒ…ä¸­çš„åŸºç¡€æ¡†æ¶ï¼Œéƒ½å¯ä»¥å•ç‹¬æ‹¿æ¥è®²äº†ï¼Œæ‰€ä»¥è¿™æ¬¡é‡ç‚¹ä¸æ˜¯å®ƒï¼Œä»Šåæˆ‘ä»¬å†ç€é‡ä»‹ç»ã€‚ è¿™é‡Œå°±å¯ä»¥æŠŠä»–ç®€å•ç†è§£ä¸ºæä¾›äº†å’Œä¸Šæ–‡ç±»ä¼¼çš„ä¸€ä¸ªè®¡æ•°å™¨åŠçº¿ç¨‹é€šçŸ¥å·¥å…·å°±è¡Œäº†ã€‚ countDownå…¶å®ä»–çš„æ ¸å¿ƒé€»è¾‘å’Œæˆ‘ä»¬è‡ªå·±å®ç°çš„åŒºåˆ«ä¸å¤§ã€‚ 1234567891011public void countDown() &#123; sync.releaseShared(1);&#125;public final boolean releaseShared(int arg) &#123; if (tryReleaseShared(arg)) &#123; doReleaseShared(); return true; &#125; return false;&#125; åˆ©ç”¨è¿™ä¸ªå†…éƒ¨ç±»çš„ releaseShared æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºä»–æƒ³è¦å°†è®¡æ•°å™¨å‡ä¸€ã€‚ çœ‹åˆ°è¿™é‡Œæœ‰æ²¡æœ‰ä¼¼æ›¾ç›¸è¯†çš„æ„Ÿè§‰ã€‚ æ²¡é”™ï¼Œåœ¨ JDK1.7 ä¸­çš„ AtomicInteger è‡ªå‡å°±æ˜¯è¿™æ ·å®ç°çš„ï¼ˆåˆ©ç”¨ CAS ä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼‰ã€‚ åªæ˜¯ä¸€æ—¦è®¡æ•°å™¨å‡ä¸º 0 æ—¶åˆ™ä¼šæ‰§è¡Œ doReleaseShared å”¤é†’å…¶ä»–çš„çº¿ç¨‹ã€‚ è¿™é‡Œæˆ‘ä»¬åªéœ€è¦å…³å¿ƒçº¢æ¡†éƒ¨åˆ†ï¼ˆå…¶ä»–çš„æš‚æ—¶ä¸ç”¨å…³å¿ƒï¼Œè¿™é‡Œæ¶‰åŠåˆ°äº† AQS ä¸­çš„é˜Ÿåˆ—ç›¸å…³ï¼‰ï¼Œæœ€ç»ˆä¼šè°ƒç”¨ LockSupport.unpark æ¥å”¤é†’çº¿ç¨‹ï¼›å°±ç›¸å½“äºä¸Šæ–‡è°ƒç”¨ object.notify()ã€‚ æ‰€ä»¥å…¶å®æœ¬è´¨ä¸Šè¿˜æ˜¯ç›¸åŒçš„ã€‚ awaitå…¶ä¸­çš„ await() ä¹Ÿæ˜¯å€Ÿç”¨ Sync å¯¹è±¡çš„æ–¹æ³•å®ç°çš„ã€‚ 12345678910111213141516public void await() throws InterruptedException &#123; sync.acquireSharedInterruptibly(1);&#125;public final void acquireSharedInterruptibly(int arg) throws InterruptedException &#123; if (Thread.interrupted()) throw new InterruptedException(); //åˆ¤æ–­è®¡æ•°å™¨æ˜¯å¦è¿˜æœªå®Œæˆ if (tryAcquireShared(arg) &lt; 0) doAcquireSharedInterruptibly(arg);&#125;protected int tryAcquireShared(int acquires) &#123; return (getState() == 0) ? 1 : -1;&#125; ä¸€æ—¦è¿˜å­˜åœ¨æœªå®Œæˆçš„çº¿ç¨‹æ—¶ï¼Œåˆ™ä¼šè°ƒç”¨ doAcquireSharedInterruptibly è¿›å…¥é˜»å¡çŠ¶æ€ã€‚ 1234private final boolean parkAndCheckInterrupt() &#123; LockSupport.park(this); return Thread.interrupted();&#125; åŒæ ·çš„ç”±äºè¿™ä¹Ÿæ˜¯ AQS ä¸­çš„æ–¹æ³•ï¼Œæˆ‘ä»¬åªéœ€è¦å…³å¿ƒçº¢æ¡†éƒ¨åˆ†ï¼›å…¶å®æœ€ç»ˆå°±æ˜¯è°ƒç”¨äº† LockSupport.park æ–¹æ³•ï¼Œä¹Ÿå°±ç›¸å½“äºæ‰§è¡Œäº† object.wait() ã€‚ æ‰€æœ‰çš„ä¸šåŠ¡çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åä¼šåœ¨è®¡æ•°å™¨å‡ä¸º 0 æ—¶è°ƒç”¨ LockSupport.unpark æ¥å”¤é†’çº¿ç¨‹ã€‚ ç­‰å¾…çº¿ç¨‹ä¸€æ—¦è®¡æ•°å™¨ &gt; 0 æ—¶åˆ™ä¼šåˆ©ç”¨ LockSupport.park æ¥ç­‰å¾…å”¤é†’ã€‚ è¿™æ ·æ•´ä¸ªæµç¨‹ä¹Ÿå°±ä¸²èµ·æ¥äº†ï¼Œå®ƒçš„ä½¿ç”¨æ–¹æ³•ä¹Ÿå’Œä¸Šæ–‡çš„ç±»ä¼¼ã€‚ å°±ä¸åšè¿‡å¤šä»‹ç»äº†ã€‚ å®é™…æ¡ˆä¾‹åŒæ ·çš„æ¥çœ‹ä¸€ä¸ªå®é™…æ¡ˆä¾‹ã€‚ åœ¨ä¸Šä¸€ç¯‡ã€Šä¸€æ¬¡åˆ†è¡¨è¸©å‘å®è·µçš„æ¢è®¨ã€‹æåˆ°äº†å¯¹äºå…¨è¡¨æ‰«æçš„æƒ…å†µä¸‹ï¼Œéœ€è¦åˆ©ç”¨å¤šçº¿ç¨‹æ¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ æ¯”å¦‚æˆ‘ä»¬è¿™é‡Œåˆ†ä¸ºäº† 64 å¼ è¡¨ï¼Œè®¡åˆ’åˆ©ç”¨ 8 ä¸ªçº¿ç¨‹æ¥åˆ†åˆ«å¤„ç†è¿™äº›è¡¨çš„æ•°æ®ï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516CountDownLatch count = new CountDownLatch(64);ConcurrentHashMap total = new ConcurrentHashMap();for(Integer i=0;i&lt;=63;i++)&#123; executor.execute(new Runnable()&#123; @Override public void run()&#123; List value = queryTable(i); total.put(value,NULL); count.countDown(); &#125; &#125;) ; &#125;count.await();System.out.println("æŸ¥è¯¢å®Œæ¯•"); è¿™æ ·å°±å¯ä»¥å®ç°æ‰€æœ‰æ•°æ®éƒ½æŸ¥è¯¢å®Œæ¯•åå†åšç»Ÿä¸€æ±‡æ€»ï¼›ä»£ç æŒºç®€å•ï¼Œä¹Ÿå¥½ç†è§£ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± çš„ APIï¼‰ã€‚ æ€»ç»“CountDownLatch ç®—æ˜¯ juc ä¸­ä¸€ä¸ªé«˜é¢‘ä½¿ç”¨çš„å·¥å…·ï¼Œå­¦ä¼šå’Œç†è§£ä»–çš„ä½¿ç”¨ä¼šå¸®åŠ©æˆ‘ä»¬æ›´å®¹æ˜“ç¼–å†™å¹¶å‘åº”ç”¨ã€‚ æ–‡ä¸­æ¶‰åŠåˆ°çš„æºç ï¼š https://github.com/crossoverJie/JCSprout/blob/master/src/main/java/com/crossoverjie/concurrent/communication/MultipleThreadCountDownKit.java ä½ çš„ç‚¹èµä¸åˆ†äº«æ˜¯å¯¹æˆ‘æœ€å¤§çš„æ”¯æŒ]]></content>
      <categories>
        <category>å¹¶å‘</category>
      </categories>
      <tags>
        <tag>concurrent</tag>
        <tag>CountDownLatch</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[VLOG-008:Basketball Day One]]></title>
    <url>%2F2019%2F04%2F21%2Fvlog%2FBasketball%20Day%20one%2F</url>
    <content type="text"><![CDATA[å‘¨æœ«è½»æ¾ä¸€ä¸‹ã€‚]]></content>
      <categories>
        <category>VLOG</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ä¸€æ¬¡åˆ†è¡¨è¸©å‘å®è·µçš„æ¢è®¨]]></title>
    <url>%2F2019%2F04%2F16%2Fframework-design%2Fsharding-db%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¹‹å‰ä¸å°‘äººé—®æˆ‘â€œèƒ½å¦åˆ†äº«ä¸€äº›åˆ†åº“åˆ†è¡¨ç›¸å…³çš„å®è·µâ€ï¼Œå…¶å®ä¸æ˜¯æˆ‘ä¸åˆ†äº«ï¼Œè€Œæ˜¯çœŸçš„ç»éªŒä¸å¤šğŸ¤£ï¼›å’Œå¤§éƒ¨åˆ†äººä¸€æ ·éƒ½æ˜¯åœç•™åœ¨ç†è®ºé˜¶æ®µã€‚ ä¸è¿‡è¿™æ¬¡å¤šå°‘æœ‰äº›å¯ä»¥è¯´é“äº†ã€‚ å…ˆè°ˆè°ˆèƒŒæ™¯ï¼Œæˆ‘ä»¬ç”Ÿäº§æ•°æ®åº“éšç€ä¸šåŠ¡å‘å±•é‡ä¹Ÿé€æ¸èµ·æ¥ï¼›å¥½å‡ å¼ å•è¡¨å·²ç»çªç ´äº¿çº§æ•°æ®ï¼Œå¹¶ä¸”ä¿æŒæ¯å¤© 200+W çš„æ•°æ®é‡å¢åŠ ã€‚ è€Œæˆ‘ä»¬æœ‰äº›ä¸šåŠ¡éœ€è¦è¿›è¡Œå…³è”æŸ¥è¯¢ã€æˆ–è€…æ˜¯æŠ¥è¡¨ç»Ÿè®¡ï¼›åœ¨è¿™æ ·çš„èƒŒæ™¯ä¸‹å¤§è¡¨çš„é—®é¢˜æ›´åŠ çªå‡ºï¼ˆæ¯”å¦‚ä¸€ä¸ªæŸ¥è¯¢åŠŸèƒ½éœ€è¦è·‘å¥½å‡ åˆ†é’Ÿï¼‰ã€‚ å¯èƒ½å¾ˆå¤šäººä¼šè¯´ï¼šä¸ºå•¥å•è¡¨éƒ½è¿‡äº¿äº†æ‰æƒ³æ–¹æ¡ˆè§£å†³ï¼Ÿå…¶å®ä¸æ˜¯ä¸æƒ³ï¼Œè€Œæ˜¯ç”±äºå†å²åŸå› åŠ ä¸Šé”™è¯¯é¢„ä¼°äº†æ•°æ®å¢é•¿æ‰å¯¼è‡´è¿™ä¸ªå±€é¢ã€‚æ€»ä¹‹åŸå› æ¯”è¾ƒå¤æ‚ï¼Œä¹Ÿä¸æ˜¯æœ¬æ¬¡è®¨è®ºçš„é‡ç‚¹ã€‚ ä¸´æ—¶æ–¹æ¡ˆç”±äºéœ€æ±‚ç´§ã€äººæ‰‹ç¼ºçš„æƒ…å†µä¸‹ï¼Œæ•´ä¸ªå¤„ç†çš„è¿‡ç¨‹åˆ†ä¸ºå‡ ä¸ªé˜¶æ®µã€‚ ç¬¬ä¸€é˜¶æ®µåº”è¯¥æ˜¯å»å¹´åº•ï¼Œå½“æ—¶è¿ç»´ååº” MySQL æ‰€åœ¨çš„ä¸»æœºå†…å­˜å ç”¨å¾ˆé«˜ï¼Œæ•´ä½“è´Ÿè½½ä¹Ÿå±…é«˜ä¸ä¸‹ï¼Œå¯¼è‡´æ•´ä¸ª MySQL çš„ååé‡æ˜æ˜¾é™ä½ï¼ˆå†™å…¥ã€æŸ¥è¯¢æ•°æ®éƒ½æ˜æ˜¾å‡æ…¢ï¼‰ã€‚ ä¸ºæ­¤æˆ‘ä»¬æ‰¾å‡ºäº†æ•°æ®é‡æœ€å¤§çš„å‡ å¼ è¡¨ï¼Œå‘ç°å¤§éƒ¨åˆ†æ•°æ®é‡åœ¨7/8000W å·¦å³ï¼Œå°‘æ•°çš„å·²ç»çªç ´ä¸€äº¿ã€‚ é€šè¿‡ä¸šåŠ¡å±‚é¢è¿›è¡Œåˆ†æå‘ç°ï¼Œè¿™äº›æ•°æ®å¤šæ•°éƒ½æ˜¯ç”¨æˆ·äº§ç”Ÿçš„ä¸€äº›æ—¥å¿—å‹æ•°æ®ï¼Œè€Œä¸”è¿™äº›æ•°æ®åœ¨ä¸šåŠ¡ä¸Šå¹¶ä¸æ˜¯å¼ºç›¸å…³çš„ï¼Œç”šè‡³ä¸¤ä¸‰ä¸ªæœˆå‰çš„æ•°æ®å…¶å®å·²ç»ä¸éœ€è¦å®æ—¶æŸ¥è¯¢äº†ã€‚ å› ä¸ºæ¥è¿‘å¹´åº•ï¼Œå°½å¯èƒ½çš„ä¸æƒ³å»åŠ¨åº”ç”¨ï¼Œè€ƒè™‘æ˜¯å¦å¯ä»¥åœ¨è¿ç»´å±‚é¢ç¼“è§£å‹åŠ›ï¼›ä¸»è¦çš„ç›®çš„å°±æ˜¯æŠŠå•è¡¨çš„æ•°æ®é‡é™ä½ã€‚ åŸæœ¬æ˜¯æƒ³æŠŠä¸¤ä¸ªæœˆä¹‹å‰çš„æ•°æ®ç›´æ¥è¿ç§»å‡ºæ¥æ”¾åˆ°å¤‡ä»½è¡¨ä¸­ï¼Œä½†åœ¨å‡†å¤‡å®æ–½çš„è¿‡ç¨‹ä¸­å‘ç°ä¸€ä¸ªå¤§å‘ã€‚ è¡¨ä¸­æ²¡æœ‰ä¸€ä¸ªå¯ä»¥æ’åºçš„ç´¢å¼•ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•å¿«é€Ÿçš„ç­›é€‰å‡ºä¸€éƒ¨åˆ†æ•°æ®ï¼è¿™çœŸæ˜¯ä¸€ä¸ªæ·±å‘ï¼Œä¸ºåé¢çš„ä¸€äº›ä¼˜åŒ–åŸ‹äº†ä¸ªåœ°é›·ï¼›å³ä¾¿æ˜¯åŠ ç´¢å¼•ä¹Ÿéœ€è¦èŠ±å‡ ä¸ªå°æ—¶ï¼ˆå…·ä½“å¤šä¹…æ²¡æ•¢åœ¨ç”Ÿäº§æµ‹è¯•ï¼‰ã€‚ å¦‚æœæˆ‘ä»¬å¼ºè¡ŒæŒ‰ç…§æ—¶é—´è¿›è¡Œç­›é€‰ï¼Œå¯èƒ½æŸ¥è¯¢å‡º 4000W çš„æ•°æ®å°±å¾—èŠ±ä¸Šå¥½å‡ ä¸ªå°æ—¶ï¼›è¿™æ˜¾ç„¶æ˜¯è¡Œä¸é€šçš„ã€‚ äºæ˜¯æˆ‘ä»¬ä¾¿æƒ³åˆ°äº†ä¸€ä¸ªå¤§èƒ†çš„æƒ³æ³•ï¼šè¿™éƒ¨åˆ†æ•°æ®æ˜¯å¦å¯ä»¥ç›´æ¥ä¸è¦äº†ï¼Ÿ è¿™å¯èƒ½æ˜¯æœ€æœ‰æ•ˆåŠæœ€å¿«çš„æ–¹å¼äº†ï¼Œå’Œäº§å“æ²Ÿé€šåå¾—çŸ¥è¿™éƒ¨åˆ†æ•°æ®çœŸçš„åªæ˜¯æ—¥å¿—å‹çš„æ•°æ®ï¼Œå³ä¾¿æ˜¯æŠ¥è¡¨å‡ºä¸æ¥ä»Šåè¡¥ä¸Šä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ äºæ˜¯æˆ‘ä»¬å°±ç®€å•ç²—æš´çš„åšäº†ä»¥ä¸‹äº‹æƒ…ï¼š ä¿®æ”¹åŸæœ‰è¡¨çš„è¡¨åï¼Œæ¯”å¦‚åŠ ä¸Š(_190416bak)ã€‚ å†æ–°å»ºä¸€å¼ å’ŒåŸæœ‰è¡¨åç§°ç›¸åŒçš„è¡¨ã€‚ è¿™æ ·æ–°çš„æ•°æ®å°±å†™åˆ°äº†æ–°è¡¨ï¼ŒåŒæ—¶ä¸šåŠ¡ä¸Šä¹Ÿæ˜¯ä½¿ç”¨çš„è¿™ä¸ªæ•°æ®é‡è¾ƒå°çš„æ–°è¡¨ã€‚ è™½è¯´è¿‡ç¨‹ä¸å¤ªä¼˜é›…ï¼Œä½†è‡³å°‘æ˜¯è§£å†³äº†é—®é¢˜åŒæ—¶ä¹Ÿç»™æˆ‘ä»¬åšæŠ€æœ¯æ”¹é€ é¢„ç•™äº†æ—¶é—´ã€‚ åˆ†è¡¨æ–¹æ¡ˆä¹‹å‰çš„æ–¹æ¡ˆè™½è¯´å¯ä»¥ç¼“è§£å‹åŠ›ï¼Œä½†ä¸èƒ½æ ¹æœ¬è§£å†³é—®é¢˜ã€‚ æœ‰äº›ä¸šåŠ¡å¿…é¡»å¾—æŸ¥è¯¢ä¹‹å‰çš„æ•°æ®ï¼Œå¯¼è‡´ä¹‹å‰é‚£æ‹›è¡Œä¸é€šäº†ï¼Œæ‰€ä»¥æ­£å¥½æˆ‘ä»¬å°±å€ŸåŠ©è¿™ä¸ªæœºä¼šæŠŠè¡¨åˆ†äº†ã€‚ æˆ‘ç›¸ä¿¡å¤§éƒ¨åˆ†äººè™½è¯´æ²¡æœ‰åšè¿‡å®é™…åšè¿‡åˆ†è¡¨ï¼Œä½†ä¹Ÿè§è¿‡çŒªè·‘ï¼›ç½‘ä¸Šä¸€æœå„ç§æ–¹æ¡ˆå±‚å‡ºä¸ç©·ã€‚ æˆ‘è®¤ä¸ºæœ€é‡è¦çš„ä¸€ç‚¹æ˜¯è¦ç»“åˆå®é™…ä¸šåŠ¡æ‰¾å‡ºéœ€è¦ sharding çš„å­—æ®µï¼ŒåŒæ—¶è¿˜æœ‰ä¸Šçº¿é˜¶æ®µçš„æ•°æ®è¿ç§»ä¹Ÿéå¸¸é‡è¦ã€‚ æ—¶é—´å¯èƒ½å¤§å®¶éƒ½ä¼šè¯´ç”¨ hash çš„æ–¹å¼åˆ†é…å¾—æœ€å‡åŒ€ï¼Œä½†æˆ‘è®¤ä¸ºè¿™è¿˜æ˜¯éœ€è¦ä½¿ç”¨å†å²æ•°æ®çš„åœºæ™¯æ‰ç”¨å“ˆå¸Œåˆ†è¡¨ã€‚ è€Œå¯¹äºä¸éœ€è¦å†å²æ•°æ®çš„åœºæ™¯ï¼Œæ¯”å¦‚ä¸šåŠ¡ä¸ŠåªæŸ¥è¯¢è¿‘ä¸‰ä¸ªæœˆçš„æ•°æ®ã€‚ è¿™ç±»éœ€æ±‚å®Œæˆå¯ä»¥é‡‡å–æ—¶é—´åˆ†è¡¨ï¼ŒæŒ‰ç…§æœˆä»½è¿›è¡Œåˆ’åˆ†ï¼Œè¿™æ ·æ”¹åŠ¨ç®€å•ï¼ŒåŒæ—¶å¯¹å†å²æ•°æ®ä¹Ÿæ¯”è¾ƒå¥½è¿ç§»ã€‚ äºæ˜¯æˆ‘ä»¬é¦–å…ˆå°†è¿™ç±»éœ€æ±‚çš„è¡¨ç­›é€‰å‡ºæ¥ï¼ŒæŒ‰ç…§æœˆä»½è¿›è¡Œæ‹†åˆ†ï¼Œåªæ˜¯åœ¨æŸ¥è¯¢çš„æ—¶å€™æ‹¼æ¥å¥½è¡¨åå³å¯ï¼›ä¹Ÿæ¯”è¾ƒå¥½ç†è§£ã€‚ å“ˆå¸Œåˆšæ‰ä¹Ÿæåˆ°äº†ï¼šéœ€è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿›è¡Œåˆ†è¡¨ç­–ç•¥ã€‚ è€Œä¸€æ—¦æ‰€æœ‰çš„æ•°æ®éƒ½æœ‰å¯èƒ½æŸ¥è¯¢æ—¶ï¼ŒæŒ‰ç…§æ—¶é—´åˆ†è¡¨ä¹Ÿå°±è¡Œä¸é€šäº†ã€‚ï¼ˆä¹Ÿèƒ½åšï¼Œåªæ˜¯å¦‚æœä¸æ˜¯æŒ‰ç…§æ—¶é—´è¿›è¡ŒæŸ¥è¯¢æ—¶éœ€è¦éå†æ‰€æœ‰çš„è¡¨ï¼‰ å› æ­¤æˆ‘ä»¬è®¡åˆ’é‡‡ç”¨ hash çš„æ–¹å¼åˆ†è¡¨ï¼Œè¿™ç®—æ˜¯ä¸šç•Œæ¯”è¾ƒä¸»æµçš„æ–¹å¼å°±ä¸å†èµ˜è¿°ã€‚ é‡‡ç”¨å“ˆå¸Œæ—¶éœ€è¦å°† sharding å­—æ®µé€‰å¥½ï¼Œç”±äºæˆ‘ä»¬çš„ä¸šåŠ¡æ¯”è¾ƒå•çº¯ï¼›æ˜¯ä¸€ä¸ªç‰©è”ç½‘åº”ç”¨ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½åŒ…å«æœ‰ç‰©è”ç½‘è®¾å¤‡çš„å”¯ä¸€æ ‡è¯†ï¼ˆIMEIï¼‰ï¼Œå¹¶ä¸”è¿™ä¸ªå­—æ®µå¤©ç„¶çš„å°±ä¿æŒäº†å”¯ä¸€æ€§ï¼›å¤§å¤šæ•°çš„ä¸šåŠ¡ä¹Ÿéƒ½æ˜¯æ ¹æ®è¿™ä¸ªå­—æ®µæ¥çš„ï¼Œæ‰€ä»¥å®ƒéå¸¸é€‚åˆæ¥åšè¿™ä¸ª sharding å­—æ®µã€‚ åœ¨åšåˆ†è¡¨ä¹‹å‰ä¹Ÿè°ƒç ”è¿‡ MyCAT åŠ sharding-jdbc(ç°å·²å‡çº§ä¸º shardingsphere)ï¼Œæœ€ç»ˆè€ƒè™‘åˆ°å¯¹å¼€å‘çš„å‹å¥½æ€§åŠä¸å¢åŠ è¿ç»´å¤æ‚åº¦è¿˜æ˜¯å†³å®šåœ¨ jdbc å±‚ sharding çš„æ–¹å¼ã€‚ ä½†ç”±äºå†å²åŸå› æˆ‘ä»¬å¹¶ä¸å¤ªå¥½é›†æˆ sharding-jdbcï¼Œä½†åŸºäº sharding çš„ç‰¹ç‚¹è‡ªå·±å®ç°äº†ä¸€ä¸ªåˆ†è¡¨ç­–ç•¥ã€‚ è¿™ä¸ªç®€å•ä¹Ÿå¥½ç†è§£ï¼š 123int index = hash(shardingå­—æ®µ) % åˆ†è¡¨æ•°é‡ ;select xx from 'busy_'+index where shardingå­—æ®µ = xxx; å…¶å®å°±æ˜¯ç®—å‡ºäº†è¡¨åï¼Œç„¶åè·¯ç”±è¿‡å»æŸ¥è¯¢å³å¯ã€‚ åªæ˜¯æˆ‘ä»¬å®ç°çš„éå¸¸ç®€å•ï¼šä¿®æ”¹äº†æ‰€æœ‰çš„åº•å±‚æŸ¥è¯¢æ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½é‡Œéƒ½åšäº†è¿™æ ·çš„ä¸€ä¸ªåˆ¤æ–­ã€‚ å¹¶æ²¡æœ‰åƒ sharding-jdbc ä¸€æ ·ï¼Œä»£ç†äº†æ•°æ®åº“çš„æŸ¥è¯¢æ–¹æ³•ï¼›å…¶ä¸­è¿˜è¦åš SQLè§£æ--&gt;SQLè·¯ç”±--&gt;æ‰§è¡ŒSQL--&gt;åˆå¹¶ç»“æœ è¿™ä¸€ç³»åˆ—çš„æµç¨‹ã€‚ å¦‚æœè‡ªå·±å†åšä¸€éæ— å¼‚äºé‡æ–°é€ äº†ä¸€ä¸ªè½®å­ï¼Œå¹¶ä¸”å¹¶ä¸ä¸“ä¸šï¼Œåªæ˜¯åœ¨ç°æœ‰çš„æŠ€æœ¯æ¡ä»¶ä¸‹é€‰æ‹©äº†ä¸€ä¸ªå¿«é€Ÿå®ç°è¾¾æˆæ•ˆæœçš„æ–¹æ³•ã€‚ ä¸è¿‡è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬èŠ‚çœäº†å°† sharding å­—æ®µå“ˆå¸Œçš„è¿‡ç¨‹ï¼Œå› ä¸ºæ¯ä¸€ä¸ª IMEI å·å…¶å®éƒ½æ˜¯ä¸€ä¸ªå”¯ä¸€çš„æ•´å‹ï¼Œç›´æ¥ç”¨å®ƒåš mod è¿ç®—å³å¯ã€‚ è¿˜æœ‰ä¸€ä¸ªæ˜¯éœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„ç»„ä»¶ç”Ÿæˆè§„åˆ™ï¼Œåˆ†è¡¨åä¸èƒ½å†ä¾èµ–äºå•è¡¨çš„å­—æ®µè‡ªå¢äº†ï¼›æ–¹æ³•è¿˜æ˜¯æŒºå¤šçš„ï¼š æ¯”å¦‚æ—¶é—´æˆ³+éšæœºæ•°å¯æ»¡è¶³å¤§éƒ¨åˆ†ä¸šåŠ¡ã€‚ UUIDï¼Œç”Ÿæˆç®€å•ï¼Œä½†æ²¡æ³•åšæ’åºã€‚ é›ªèŠ±ç®—æ³•ç»Ÿä¸€ç”Ÿæˆä¸»é”®IDã€‚ å¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µåšé€‰æ‹©ã€‚ ä¸šåŠ¡è°ƒæ•´å› ä¸ºæˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ sharding-jdbc ç»„ä»¶ï¼Œæ‰€æœ‰æ²¡æœ‰åŠæ³•åšåˆ°å¯¹ä»£ç çš„ä½ä¾µå…¥æ€§ï¼›æ¯ä¸ªæ¶‰åŠåˆ°åˆ†è¡¨çš„ä¸šåŠ¡ä»£ç éƒ½éœ€è¦åšåº•å±‚æ–¹æ³•çš„æ”¹é€ ï¼ˆä¹Ÿå°±æ˜¯è·¯ç”±åˆ°æ­£ç¡®çš„è¡¨ï¼‰ã€‚ è€ƒè™‘åˆ°åç»­ä¸šåŠ¡çš„å‘å±•ï¼Œæˆ‘ä»¬å†³å®šå°†æ‹†åˆ†çš„è¡¨åˆ†ä¸º 64 å¼ ï¼›åŠ ä¸Šåç»­å¼•å…¥å¤§æ•°æ®å¹³å°è¶³ä»¥åº”å¯¹å‡ å¹´çš„æ•°æ®å¢é•¿ã€‚ è¿™é‡Œè¿˜æœ‰ä¸ªå°ç»†èŠ‚éœ€è¦æ³¨æ„ï¼šåˆ†è¡¨çš„æ•°é‡éœ€è¦ä¸º 2âˆ§N æ¬¡æ–¹ï¼Œå› ä¸ºåœ¨å–æ¨¡çš„è¿™ç§åˆ†è¡¨æ–¹å¼ä¸‹ï¼Œå³ä¾¿æ˜¯ä»Šåå†éœ€è¦åˆ†è¡¨å½±å“çš„æ•°æ®ä¹Ÿä¼šå°½é‡çš„å°ã€‚ å†ä¿®æ”¹æ—¶åªèƒ½å°†è¡¨åç§°è¿›è¡Œå…¨å±€æœç´¢ï¼Œç„¶ååŠ ä»¥ä¿®æ”¹ï¼ŒåŒæ—¶æ ¹æ®ä¿®æ”¹çš„æ–¹æ³•å€’æ¨åˆ°è¡¨ç°çš„ä¸šåŠ¡å¹¶è®°å½•ä¸‹æ¥ï¼Œæ–¹ä¾¿åç»­å›å½’æµ‹è¯•ã€‚ å½“ç„¶æ— æ³•é¿å…æŸ¥è¯¢æ—¶åˆ©ç”¨é sharding å­—æ®µå¯¼è‡´çš„å…¨è¡¨æ‰«æï¼Œè¿™æ˜¯æ‰€æœ‰åˆ†ç‰‡åéƒ½ä¼šé‡åˆ°çš„é—®é¢˜ã€‚ å› æ­¤æˆ‘ä»¬åœ¨ä¿®æ”¹åˆ†è¡¨æ–¹æ³•çš„åº•å±‚æŸ¥è¯¢æ—¶åŒæ—¶ä¹Ÿä¼šæŸ¥çœ‹æ˜¯å¦æœ‰èµ°åˆ†ç‰‡å­—æ®µï¼Œå¦‚æœä¸æ˜¯ï¼Œé‚£æ˜¯å¦å¯ä»¥è°ƒæ•´ä¸šåŠ¡ã€‚ æ¯”å¦‚å¯¹äºä¸€ä¸ªä¸Šäº¿çš„æ•°æ®æ˜¯å¦è¿˜æœ‰å¿…è¦å­˜åœ¨æŒ‰ç…§åˆ†é¡µæŸ¥è¯¢ã€æ—¥æœŸæŸ¥è¯¢ï¼Ÿè¿™æ ·çš„ä¸šåŠ¡æ˜¯å¦çœŸçš„å…·æœ‰æ„ä¹‰ï¼Ÿ æˆ‘ä»¬å°½å¯èƒ½çš„å¼•å¯¼äº§å“æŒ‰ç…§è¿™æ ·çš„æ–¹å¼æ¥è®¾è®¡äº§å“æˆ–è€…åšå‡ºè°ƒæ•´ã€‚ ä½†å¯¹äºæŠ¥è¡¨è¿™ç±»çš„éœ€æ±‚ç¡®å®ä¹Ÿæ²¡åŠæ³•ï¼Œæ¯”å¦‚ç»Ÿè®¡è¡¨ä¸­æŸç§ç±»å‹çš„æ•°æ®ï¼›è¿™ç§æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨å¤šçº¿ç¨‹çš„æ–¹å¼å»å¹¶è¡ŒæŸ¥è¯¢ç„¶åæ±‡æ€»ç»Ÿè®¡æ¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ æœ‰æ—¶ä¹Ÿæœ‰ä¸€äº›å¦ç±»åœºæ™¯ï¼š æ¯”å¦‚ä¸€ä¸ªåƒä¸‡è¡¨ä¸­æœ‰æŸä¸€ç‰¹æ®Šç±»å‹çš„æ•°æ®åªå äº†å¾ˆå°ä¸€éƒ¨åˆ†ï¼Œæ¯”å¦‚è¯´å‡ åƒä¸Šä¸‡æ¡ã€‚ è¿™æ—¶é¡µé¢ä¸Šéœ€è¦å¯¹å®ƒè¿›è¡Œåˆ†é¡µæŸ¥è¯¢æ˜¯æ¯”è¾ƒæ­£å¸¸çš„ï¼ˆæ¯”å¦‚æŸç§æŠ•è¯‰æ¶ˆæ¯ï¼Œå®¢æˆ·éœ€è¦ä¸€æ¡ä¸€æ¡çš„å•ç‹¬å¤„ç†ï¼‰ï¼Œä½†å¦‚æœæˆ‘ä»¬æŒ‰ç…§ IMEI å·æˆ–è€…æ˜¯ä¸»é”®è¿›è¡Œåˆ†ç‰‡åå†åˆ†é¡µæŸ¥è¯¢é‚£å°±æ¯”è¾ƒè›‹ç–¼äº†ã€‚ æ‰€ä»¥è¿™ç±»å‹çš„æ•°æ®å»ºè®®å•ç‹¬æ–°å»ºä¸€å¼ è¡¨æ¥ç»´æŠ¤ï¼Œä¸è¦å’Œå…¶ä»–æ•°æ®æ··åˆåœ¨ä¸€èµ·ï¼Œè¿™æ ·ä¸ç®¡æ˜¯åšåˆ†é¡µè¿˜æ˜¯ like éƒ½æ¯”è¾ƒç®€å•å’Œç‹¬ç«‹ã€‚ éªŒè¯ä»£ç æ”¹å®Œï¼Œå¼€å‘ä¹Ÿå•æµ‹å®Œæˆåæ€ä¹ˆæ¥éªŒè¯åˆ†è¡¨çš„ä¸šåŠ¡æ˜¯å¦æ­£å¸¸ä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚ ä¸€ä¸ªæ˜¯æµ‹è¯•éº»çƒ¦ï¼Œå†ä¸€ä¸ªæ˜¯ä¸‡ä¸€å“ªé‡Œæ”¹æ¼äº†è¿˜æ˜¯æŸ¥è¯¢çš„åŸè¡¨ï¼Œä½†è¿™æ ·åœ¨æµ‹è¯•ç¯å¢ƒå¹¶ä¸ä¼šæœ‰å¼‚å¸¸ï¼Œä¸€æ—¦ä¸Šçº¿äº§ç”Ÿäº†ç”Ÿäº§æ•°æ®åˆ°æ–°çš„ 64 å¼ è¡¨åæƒ³è¦å†ä¿®å¤å°±æ¯”è¾ƒéº»çƒ¦äº†ã€‚ æ‰€ä»¥æˆ‘ä»¬å–äº†ä¸ªå·§ï¼Œç›´æ¥å°†åŸè¡¨çš„è¡¨åä¿®æ”¹ï¼Œæ¯”å¦‚åŠ ä¸€ä¸ªåç¼€ï¼›è¿™æ ·åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­è§‚å¯Ÿå‰åå°æœ‰æ— æŠ¥é”™å°±æ¯”è¾ƒå®¹æ˜“æå‰å‘ç°è¿™ä¸ªé—®é¢˜ã€‚ ä¸Šçº¿æµç¨‹æµ‹è¯•éªŒæ”¶é€šè¿‡ååªæ˜¯åˆ†è¡¨è¿™ä¸ªéœ€æ±‚çš„80%ï¼Œå‰©ä¸‹å¦‚ä½•ä¸Šçº¿ä¹Ÿæ˜¯æ¯”è¾ƒå¤´ç–¼ã€‚ ä¸€æ—¦åº”ç”¨ä¸Šçº¿åæ‰€æœ‰çš„æŸ¥è¯¢ã€å†™å…¥ã€åˆ é™¤éƒ½ä¼šå…ˆèµ°è·¯ç”±ç„¶ååˆ°è¾¾æ–°è¡¨ï¼›è€Œè€æ•°æ®åœ¨åŸè¡¨é‡Œæ˜¯ä¸ä¼šå‘ç”Ÿæ”¹å˜çš„ã€‚ æ•°æ®è¿ç§»æ‰€ä»¥æˆ‘ä»¬ä¸Šçº¿å‰çš„ç¬¬ä¸€æ­¥è‡ªç„¶æ˜¯éœ€è¦å°†åŸæœ‰çš„æ•°æ®è¿›è¡Œè¿ç§»ï¼Œè¿ç§»çš„ç›®çš„æ˜¯è¦åˆ†ç‰‡åˆ°æ–°çš„ 64 å¼ è¡¨ä¸­ï¼Œè¿™æ ·æ‰ä¼šå¯¹åŸæœ‰çš„ä¸šåŠ¡æ— å½±å“ã€‚ å› æ­¤æˆ‘ä»¬éœ€è¦é¢å¤–å‡†å¤‡ä¸€ä¸ªç¨‹åºï¼Œå®ƒéœ€è¦å°†è€è¡¨é‡Œçš„æ•°æ®æŒ‰ç…§åˆ†ç‰‡è§„åˆ™å¤åˆ¶åˆ°æ–°è¡¨ä¸­ï¼› åœ¨æˆ‘ä»¬è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œç”Ÿäº§æ•°æ®æœ‰äº›å·²ç»ä¸Šäº¿äº†ï¼Œè¿™ä¸ªè¿ç§»è¿‡ç¨‹æˆ‘ä»¬åœ¨æµ‹è¯•ç¯å¢ƒæ¨¡æ‹Ÿå‘ç°è€—æ—¶æ˜¯éå¸¸ä¹…çš„ã€‚è€Œä¸”æˆ‘ä»¬è€è¡¨ä¸­å¯¹äº create_time è¿™æ ·ç”¨äºç­›é€‰æ•°æ®çš„å­—æ®µæ²¡æœ‰ç´¢å¼•ï¼ˆä»¥å‰çš„æŠ€æœ¯å€ºï¼‰ï¼Œæ‰€ä»¥æŸ¥è¯¢èµ·æ¥å°±æ›´åŠ æ…¢äº†ã€‚ æœ€åæ²¡åŠæ³•ï¼Œæˆ‘ä»¬åªèƒ½å’Œäº§å“åå•†å‘ŠçŸ¥ç”¨æˆ·å¯¹äºä¹‹å‰äº§ç”Ÿçš„æ•°æ®çŸ­æœŸå¯èƒ½ä¼šæŸ¥è¯¢ä¸åˆ°ï¼Œè¿™ä¸ªæ—¶é—´æœ€åå¯èƒ½ä¼šæŒç»­å‡ å¤©ï¼ˆæˆ‘ä»¬åªèƒ½åœ¨å‡Œæ™¨è¿ç§»ï¼Œç™½å¤©ä¼šå½±å“åˆ°æ•°æ®åº“è´Ÿè½½ï¼‰ã€‚ æ€»ç»“è¿™ä¾¿æ˜¯æˆ‘ä»¬è¿™æ¬¡çš„åˆ†è¡¨å®è·µï¼Œè™½è¯´ä¸å°‘è¿‡ç¨‹éƒ½ä¸ä¼˜é›…ï¼Œä½†å—é™äºæ¡ä»¶ä¹Ÿåªèƒ½æŠ˜ä¸­å¤„ç†ã€‚ ä½†æˆ‘ä»¬åç»­çš„è®¡åˆ’æ˜¯ï¼Œä¿®æ”¹æˆ‘ä»¬åº•å±‚çš„æ•°æ®è¿æ¥ï¼ˆç›®å‰æ˜¯è‡ªå·±å°è£…çš„ä¸€ä¸ª jar åŒ…ï¼Œå¯¼è‡´é›†æˆ sharding-jdbc æ¯”è¾ƒéº»çƒ¦ï¼‰æœ€ç»ˆé€æ¸è¿ç§»åˆ° sharding-jdbc . æœ€åå¾—å‡ºäº†å‡ ä¸ªç»“è®ºï¼š ä¸€ä¸ªå¥½çš„äº§å“è§„åˆ’éå¸¸æœ‰å¿…è¦ï¼Œå¯ä»¥åœ¨åˆç†çš„æ—¶é—´å¯¹æ•°æ®å¤„ç†ï¼ˆä¸ç®¡æ˜¯åˆ†è¡¨è¿˜æ˜¯åˆ‡å…¥å½’æ¡£ï¼‰ã€‚ æ¯å¼ è¡¨éƒ½éœ€è¦ä¸€ä¸ªå¯ä»¥ç”¨äºæ’åºæŸ¥è¯¢çš„å­—æ®µï¼ˆè‡ªå¢IDã€åˆ›å»ºæ—¶é—´ï¼‰ï¼Œæ•´ä¸ªè¿‡ç¨‹ç”±äºæ²¡æœ‰è¿™ä¸ªå­—æ®µå¯¼è‡´è€½æäº†å¾ˆé•¿æ—¶é—´ã€‚ åˆ†è¡¨å­—æ®µéœ€è¦è°¨æ…ï¼Œè¦å…¨ç›˜çš„è€ƒè™‘ä¸šåŠ¡æƒ…å†µï¼Œå°½é‡é¿å…å‡ºç°æŸ¥è¯¢æ‰«è¡¨çš„æƒ…å†µã€‚ æœ€åæ¬¢è¿ç•™è¨€è®¨è®ºã€‚ ä½ çš„ç‚¹èµä¸åˆ†äº«æ˜¯å¯¹æˆ‘æœ€å¤§çš„æ”¯æŒ]]></content>
      <categories>
        <category>æ¶æ„</category>
      </categories>
      <tags>
        <tag>db</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€å¹¶å‘åŒ…å…¥å‘æŒ‡åŒ—ã€ä¹‹é˜»å¡é˜Ÿåˆ—]]></title>
    <url>%2F2019%2F04%2F09%2Fconcurrent%2FArrayBlockingQueue%2F</url>
    <content type="text"><![CDATA[å‰è¨€è¾ƒé•¿ä¸€æ®µæ—¶é—´ä»¥æ¥æˆ‘éƒ½å‘ç°ä¸å°‘å¼€å‘è€…å¯¹ jdk ä¸­çš„ J.U.Cï¼ˆjava.util.concurrentï¼‰ä¹Ÿå°±æ˜¯ Java å¹¶å‘åŒ…çš„ä½¿ç”¨ç”šå°‘ï¼Œæ›´åˆ«è°ˆå¯¹å®ƒçš„ç†è§£äº†ï¼›ä½†è¿™å´ä¹Ÿæ˜¯æˆ‘ä»¬è¿›é˜¶çš„å¿…å¤‡å…³å¡ã€‚ ä¹‹å‰æˆ–å¤šæˆ–å°‘ä¹Ÿåˆ†äº«è¿‡ç›¸å…³å†…å®¹ï¼Œä½†éƒ½ä¸æˆä½“ç³»ï¼›äºæ˜¯ä¾¿æƒ³æ•´ç†ä¸€å¥—ä¸å¹¶å‘åŒ…ç›¸å…³çš„ç³»åˆ—æ–‡ç« ã€‚ å…¶ä¸­çš„å†…å®¹ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š æ ¹æ®å®šä¹‰è‡ªå·±å®ç°ä¸€ä¸ªå¹¶å‘å·¥å…·ã€‚ JDK çš„æ ‡å‡†å®ç°ã€‚ å®è·µæ¡ˆä¾‹ã€‚ åŸºäºè¿™ä¸‰ç‚¹æˆ‘ç›¸ä¿¡å¤§å®¶å¯¹è¿™éƒ¨åˆ†å†…å®¹ä¸è‡³äºä¸€é—®ä¸‰ä¸çŸ¥ã€‚ æ—¢ç„¶å¼€äº†ä¸€ä¸ªæ–°å‘ï¼Œå°±ä¸æƒ³åšçš„å¤ªå·®ï¼›æ‰€ä»¥æˆ‘æ‰“ç®—å°†è¿™ä¸ªåˆ—è¡¨ä¸‹çš„å¤§éƒ¨åˆ†ç±»éƒ½è®²åˆ°ã€‚ æ‰€ä»¥æœ¬æ¬¡é‡ç‚¹è®¨è®º ArrayBlockingQueueã€‚ è‡ªå·±å®ç°åœ¨è‡ªå·±å®ç°ä¹‹å‰å…ˆææ¸…æ¥šé˜»å¡é˜Ÿåˆ—çš„å‡ ä¸ªç‰¹ç‚¹ï¼š åŸºæœ¬é˜Ÿåˆ—ç‰¹æ€§ï¼šå…ˆè¿›å…ˆå‡ºã€‚ å†™å…¥é˜Ÿåˆ—ç©ºé—´ä¸å¯ç”¨æ—¶ä¼šé˜»å¡ã€‚ è·å–é˜Ÿåˆ—æ•°æ®æ—¶å½“é˜Ÿåˆ—ä¸ºç©ºæ—¶å°†é˜»å¡ã€‚ å®ç°é˜Ÿåˆ—çš„æ–¹å¼å¤šç§ï¼Œæ€»çš„æ¥è¯´å°±æ˜¯æ•°ç»„å’Œé“¾è¡¨ï¼›å…¶å®æˆ‘ä»¬åªéœ€è¦ææ¸…æ¥šå…¶ä¸­ä¸€ä¸ªå³å¯ï¼Œä¸åŒçš„ç‰¹æ€§ä¸»è¦è¡¨ç°ä¸ºæ•°ç»„å’Œé“¾è¡¨çš„åŒºåˆ«ã€‚ è¿™é‡Œçš„ ArrayBlockingQueue çœ‹åå­—å¾ˆæ˜æ˜¾æ˜¯ç”±æ•°ç»„å®ç°ã€‚ æˆ‘ä»¬å…ˆæ ¹æ®å®ƒè¿™ä¸‰ä¸ªç‰¹æ€§å°è¯•è‡ªå·±å®ç°è¯•è¯•ã€‚ åˆå§‹åŒ–é˜Ÿåˆ—æˆ‘è¿™é‡Œè‡ªå®šä¹‰äº†ä¸€ä¸ªç±»ï¼šArrayQueueï¼Œå®ƒçš„æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š 123public ArrayQueue(int size) &#123; items = new Object[size];&#125; å¾ˆæ˜æ˜¾è¿™é‡Œçš„ items å°±æ˜¯å­˜æ”¾æ•°æ®çš„æ•°ç»„ï¼›åœ¨åˆå§‹åŒ–æ—¶éœ€è¦æ ¹æ®å¤§å°åˆ›å»ºæ•°ç»„ã€‚ å†™å…¥é˜Ÿåˆ—å†™å…¥é˜Ÿåˆ—æ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦ä¾æ¬¡æŠŠæ•°æ®å­˜æ”¾åˆ°è¿™ä¸ªæ•°ç»„ä¸­å³å¯ï¼Œå¦‚ä¸‹å›¾ï¼š ä½†è¿˜æ˜¯æœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼š é˜Ÿåˆ—æ»¡çš„æ—¶å€™ï¼Œå†™å…¥çš„çº¿ç¨‹éœ€è¦è¢«é˜»å¡ã€‚ å†™å…¥è¿‡é˜Ÿåˆ—çš„æ•°é‡å¤§äºé˜Ÿåˆ—å¤§å°æ—¶éœ€è¦ä»ç¬¬ä¸€ä¸ªä¸‹æ ‡å¼€å§‹å†™ã€‚ å…ˆçœ‹ç¬¬ä¸€ä¸ªé˜Ÿåˆ—æ»¡çš„æ—¶å€™ï¼Œå†™å…¥çš„çº¿ç¨‹éœ€è¦è¢«é˜»å¡ï¼Œå…ˆæ¥è€ƒè™‘ä¸‹å¦‚ä½•æ‰èƒ½ä½¿ä¸€ä¸ªçº¿ç¨‹è¢«é˜»å¡ï¼Œçœ‹èµ·æ¥çš„è¡¨è±¡çº¿ç¨‹å¡ä½å•¥äº‹ä¹Ÿåšä¸äº†ã€‚ æœ‰å‡ ç§æ–¹æ¡ˆå¯ä»¥å®ç°è¿™ä¸ªæ•ˆæœ: Thread.sleep(timeout)çº¿ç¨‹ä¼‘çœ ã€‚ object.wait() è®©çº¿ç¨‹è¿›å…¥ waiting çŠ¶æ€ã€‚ å½“ç„¶è¿˜æœ‰ä¸€äº› joinã€LockSupport.part ç­‰ä¸åœ¨æœ¬æ¬¡çš„è®¨è®ºèŒƒå›´ã€‚ é˜»å¡é˜Ÿåˆ—è¿˜æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„ç‰¹æ€§æ˜¯ï¼šå½“é˜Ÿåˆ—ç©ºé—´å¯ç”¨æ—¶ï¼ˆå–å‡ºé˜Ÿåˆ—ï¼‰ï¼Œå†™å…¥çº¿ç¨‹éœ€è¦è¢«å”¤é†’è®©æ•°æ®å¯ä»¥å†™å…¥è¿›å»ã€‚ æ‰€ä»¥å¾ˆæ˜æ˜¾Thread.sleep(timeout)ä¸åˆé€‚ï¼Œå®ƒåœ¨åˆ°è¾¾è¶…æ—¶æ—¶é—´ä¹‹åä¾¿ä¼šç»§ç»­è¿è¡Œï¼›è¾¾ä¸åˆ°ç©ºé—´å¯ç”¨æ—¶æ‰å”¤é†’ç»§ç»­è¿è¡Œè¿™ä¸ªç‰¹ç‚¹ã€‚ å…¶å®è¿™æ ·çš„ä¸€ä¸ªç‰¹ç‚¹å¾ˆå®¹æ˜“è®©æˆ‘ä»¬æƒ³åˆ° Java çš„ç­‰å¾…é€šçŸ¥æœºåˆ¶æ¥å®ç°çº¿ç¨‹é—´é€šä¿¡ï¼›æ›´å¤šçº¿ç¨‹è§é€šä¿¡çš„æ–¹æ¡ˆå¯ä»¥å‚è€ƒè¿™é‡Œï¼šæ·±å…¥ç†è§£çº¿ç¨‹é€šä¿¡ æ‰€ä»¥æˆ‘è¿™é‡Œçš„åšæ³•æ˜¯ï¼Œä¸€æ—¦é˜Ÿåˆ—æ»¡æ—¶å°±å°†å†™å…¥çº¿ç¨‹è°ƒç”¨ object.wait() è¿›å…¥ waiting çŠ¶æ€ï¼Œç›´åˆ°ç©ºé—´å¯ç”¨æ—¶å†è¿›è¡Œå”¤é†’ã€‚ 123456789/** * é˜Ÿåˆ—æ»¡æ—¶çš„é˜»å¡é” */private Object full = new Object();/** * é˜Ÿåˆ—ç©ºæ—¶çš„é˜»å¡é” */private Object empty = new Object(); æ‰€ä»¥è¿™é‡Œå£°æ˜äº†ä¸¤ä¸ªå¯¹è±¡ç”¨äºé˜Ÿåˆ—æ»¡ã€ç©ºæƒ…å†µä¸‹çš„äº’ç›¸é€šçŸ¥ä½œç”¨ã€‚ åœ¨å†™å…¥æ•°æ®æˆåŠŸåéœ€è¦ä½¿ç”¨ empty.notify()ï¼Œè¿™æ ·çš„ç›®çš„æ˜¯å½“è·å–é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œä¸€æ—¦å†™å…¥æ•°æ®æˆåŠŸå°±å¯ä»¥æŠŠæ¶ˆè´¹é˜Ÿåˆ—çš„çº¿ç¨‹å”¤é†’ã€‚ è¿™é‡Œçš„ wait å’Œ notify æ“ä½œéƒ½éœ€è¦å¯¹å„è‡ªçš„å¯¹è±¡ä½¿ç”¨ synchronized æ–¹æ³•å—ï¼Œè¿™æ˜¯å› ä¸º wait å’Œ notify éƒ½éœ€è¦è·å–åˆ°å„è‡ªçš„é”ã€‚ æ¶ˆè´¹é˜Ÿåˆ—ä¸Šæ–‡ä¹Ÿæåˆ°äº†ï¼šå½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œè·å–é˜Ÿåˆ—çš„çº¿ç¨‹éœ€è¦è¢«é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰æ•°æ®æ—¶æ‰è¢«å”¤é†’ã€‚ ä»£ç å’Œå†™å…¥çš„éå¸¸ç±»ä¼¼ï¼Œä¹Ÿå¾ˆå¥½ç†è§£ï¼›åªæ˜¯è¿™é‡Œçš„ç­‰å¾…ã€å”¤é†’æ°å¥½æ˜¯ç›¸åçš„ï¼Œé€šè¿‡ä¸‹é¢è¿™å¼ å›¾å¯ä»¥å¾ˆå¥½ç†è§£ï¼š æ€»çš„æ¥è¯´å°±æ˜¯ï¼š å†™å…¥é˜Ÿåˆ—æ»¡æ—¶ä¼šé˜»å¡ç›´åˆ°è·å–çº¿ç¨‹æ¶ˆè´¹äº†é˜Ÿåˆ—æ•°æ®åå”¤é†’å†™å…¥çº¿ç¨‹ã€‚ æ¶ˆè´¹é˜Ÿåˆ—ç©ºæ—¶ä¼šé˜»å¡ç›´åˆ°å†™å…¥çº¿ç¨‹å†™å…¥äº†é˜Ÿåˆ—æ•°æ®åå”¤é†’æ¶ˆè´¹çº¿ç¨‹ã€‚ æµ‹è¯•å…ˆæ¥ä¸€ä¸ªåŸºæœ¬çš„æµ‹è¯•ï¼šå•çº¿ç¨‹çš„å†™å…¥å’Œæ¶ˆè´¹ã€‚ 12343123123412345 é€šè¿‡ç»“æœæ¥çœ‹æ²¡ä»€ä¹ˆé—®é¢˜ã€‚ å½“å†™å…¥çš„æ•°æ®è¶…è¿‡é˜Ÿåˆ—çš„å¤§å°æ—¶ï¼Œå°±åªèƒ½æ¶ˆè´¹ä¹‹åæ‰èƒ½æ¥ç€å†™å…¥ã€‚ 123452019-04-09 16:24:41.040 [Thread-0] INFO c.c.concurrent.ArrayQueueTest - [Thread-0]1232019-04-09 16:24:41.040 [main] INFO c.c.concurrent.ArrayQueueTest - size=32019-04-09 16:24:41.047 [main] INFO c.c.concurrent.ArrayQueueTest - 12342019-04-09 16:24:41.048 [main] INFO c.c.concurrent.ArrayQueueTest - 123452019-04-09 16:24:41.048 [main] INFO c.c.concurrent.ArrayQueueTest - 123456 ä»è¿è¡Œç»“æœä¹Ÿèƒ½çœ‹å‡ºåªæœ‰å½“æ¶ˆè´¹æ•°æ®åæ‰èƒ½æ¥ç€å¾€é˜Ÿåˆ—é‡Œå†™å…¥æ•°æ®ã€‚ è€Œå½“æ²¡æœ‰æ¶ˆè´¹æ—¶ï¼Œå†å¾€é˜Ÿåˆ—é‡Œå†™æ•°æ®åˆ™ä¼šå¯¼è‡´å†™å…¥çº¿ç¨‹è¢«é˜»å¡ã€‚ å¹¶å‘æµ‹è¯• ä¸‰ä¸ªçº¿ç¨‹å¹¶å‘å†™å…¥300æ¡æ•°æ®ï¼Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹æ¶ˆè´¹ä¸€æ¡ã€‚ 12=====0299 æœ€ç»ˆçš„é˜Ÿåˆ—å¤§å°ä¸º 299ï¼Œå¯è§çº¿ç¨‹ä¹Ÿæ˜¯å®‰å…¨çš„ã€‚ ç”±äºä¸ç®¡æ˜¯å†™å…¥è¿˜æ˜¯è·å–æ–¹æ³•é‡Œçš„æ“ä½œéƒ½éœ€è¦è·å–é”æ‰èƒ½æ“ä½œï¼Œæ‰€ä»¥æ•´ä¸ªé˜Ÿåˆ—æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ ArrayBlockingQueueä¸‹é¢æ¥çœ‹çœ‹ JDK æ ‡å‡†çš„ ArrayBlockingQueue çš„å®ç°ï¼Œæœ‰äº†ä¸Šé¢çš„åŸºç¡€ä¼šæ›´å¥½ç†è§£ã€‚ åˆå§‹åŒ–é˜Ÿåˆ— çœ‹ä¼¼è¦å¤æ‚äº›ï¼Œä½†å…¶å®é€æ­¥æ‹†åˆ†åä¹Ÿå¾ˆå¥½ç†è§£ï¼š ç¬¬ä¸€æ­¥å…¶å®å’Œæˆ‘ä»¬è‡ªå·±å†™çš„ä¸€æ ·ï¼Œåˆå§‹åŒ–ä¸€ä¸ªé˜Ÿåˆ—å¤§å°çš„æ•°ç»„ã€‚ ç¬¬äºŒæ­¥åˆå§‹åŒ–äº†ä¸€ä¸ªé‡å…¥é”ï¼Œè¿™é‡Œå…¶å®å°±å’Œæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„ synchronized ä½œç”¨ä¸€è‡´çš„ï¼› åªæ˜¯è¿™é‡Œåœ¨åˆå§‹åŒ–é‡å…¥é”çš„æ—¶å€™é»˜è®¤æ˜¯éå…¬å¹³é”ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®šä¸º true ä½¿ç”¨å…¬å¹³é”ï¼›è¿™æ ·å°±ä¼šæŒ‰ç…§é˜Ÿåˆ—çš„é¡ºåºè¿›è¡Œå†™å…¥å’Œæ¶ˆè´¹ã€‚ æ›´å¤šå…³äº ReentrantLock çš„ä½¿ç”¨å’ŒåŸç†è¯·å‚è€ƒè¿™é‡Œï¼šReentrantLock å®ç°åŸç† ä¸‰å››ä¸¤æ­¥åˆ™æ˜¯åˆ›å»ºäº† notEmpty notFull è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œä»–çš„ä½œç”¨äºç”¨æ³•å’Œä¹‹å‰ä½¿ç”¨çš„ object.wait/notify ç±»ä¼¼ã€‚ è¿™å°±æ˜¯æ•´ä¸ªåˆå§‹åŒ–çš„å†…å®¹ï¼Œå…¶å®å’Œæˆ‘ä»¬è‡ªå·±å®ç°çš„éå¸¸ç±»ä¼¼ã€‚ å†™å…¥é˜Ÿåˆ— å…¶å®ä¼šå‘ç°é˜»å¡å†™å…¥çš„åŸç†éƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œåªæ˜¯è¿™é‡Œä½¿ç”¨çš„æ˜¯ Lock æ¥æ˜¾å¼è·å–å’Œé‡Šæ”¾é”ã€‚ åŒæ—¶å…¶ä¸­çš„ notFull.await();notEmpty.signal(); å’Œæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„ object.wait/notify çš„ç”¨æ³•å’Œä½œç”¨ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ å½“ç„¶å®ƒè¿˜æ˜¯å®ç°äº†è¶…æ—¶é˜»å¡çš„ APIã€‚ ä¹Ÿæ˜¯æ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨äº†ä¸€ä¸ªå…·æœ‰è¶…æ—¶æ—¶é—´çš„ç­‰å¾…æ–¹æ³•ã€‚ æ¶ˆè´¹é˜Ÿåˆ—å†çœ‹æ¶ˆè´¹é˜Ÿåˆ—ï¼š ä¹Ÿæ˜¯å·®ä¸å¤šçš„ï¼Œä¸€çœ‹å°±æ‡‚ã€‚ è€Œå…¶ä¸­çš„è¶…æ—¶ API ä¹Ÿæ˜¯ä½¿ç”¨äº† notEmpty.awaitNanos(nanos) æ¥å®ç°è¶…æ—¶è¿”å›çš„ï¼Œå°±ä¸å…·ä½“è¯´äº†ã€‚ å®é™…æ¡ˆä¾‹è¯´äº†è¿™ä¹ˆå¤šï¼Œæ¥çœ‹ä¸€ä¸ªé˜Ÿåˆ—çš„å®é™…æ¡ˆä¾‹å§ã€‚ èƒŒæ™¯æ˜¯è¿™æ ·çš„ï¼š æœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ä¼šæŒ‰ç…§ä¸€å®šçš„é—´éš”æ—¶é—´ä»æ•°æ®åº“ä¸­è¯»å–ä¸€æ‰¹æ•°æ®ï¼Œéœ€è¦å¯¹è¿™äº›æ•°æ®åšæ ¡éªŒåŒæ—¶è°ƒç”¨ä¸€ä¸ªè¿œç¨‹æ¥å£ã€‚ ç®€å•çš„åšæ³•å°±æ˜¯ç”±è¿™ä¸ªå®šæ—¶ä»»åŠ¡çš„çº¿ç¨‹å»å®Œæˆè¯»å–æ•°æ®ã€æ¶ˆæ¯æ ¡éªŒã€è°ƒç”¨æ¥å£ç­‰æ•´ä¸ªå…¨æµç¨‹ï¼›ä½†è¿™æ ·ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼š å‡è®¾è°ƒç”¨å¤–éƒ¨æ¥å£å‡ºç°äº†å¼‚å¸¸ã€ç½‘ç»œä¸ç¨³å¯¼è‡´è€—æ—¶å¢åŠ å°±ä¼šé€ æˆæ•´ä¸ªä»»åŠ¡çš„æ•ˆç‡é™ä½ï¼Œå› ä¸ºä»–éƒ½æ˜¯ä¸²è¡Œä¼šäº’ç›¸å½±å“ã€‚ æ‰€ä»¥æˆ‘ä»¬æ”¹è¿›äº†æ–¹æ¡ˆï¼š å…¶å®å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼š ç”Ÿäº§çº¿ç¨‹ä»æ•°æ®åº“ä¸­è¯»å–æ¶ˆæ¯ä¸¢åˆ°é˜Ÿåˆ—é‡Œã€‚ æ¶ˆè´¹çº¿ç¨‹ä»é˜Ÿåˆ—é‡Œè·å–æ•°æ®åšä¸šåŠ¡é€»è¾‘ã€‚ è¿™æ ·ä¸¤ä¸ªçº¿ç¨‹å°±å¯ä»¥é€šè¿‡è¿™ä¸ªé˜Ÿåˆ—æ¥è¿›è¡Œè§£è€¦ï¼Œäº’ç›¸ä¸å½±å“ï¼ŒåŒæ—¶è¿™ä¸ªé˜Ÿåˆ—ä¹Ÿèƒ½èµ·åˆ°ç¼“å†²çš„ä½œç”¨ã€‚ ä½†åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¹Ÿæœ‰ä¸€äº›å°ç»†èŠ‚å€¼å¾—æ³¨æ„ã€‚ å› ä¸ºè¿™ä¸ªå¤–éƒ¨æ¥å£æ˜¯æ”¯æŒæ‰¹é‡æ‰§è¡Œçš„ï¼Œæ‰€ä»¥åœ¨æ¶ˆè´¹çº¿ç¨‹å–å‡ºæ•°æ®åä¼šåœ¨å†…å­˜ä¸­åšä¸€ä¸ªç´¯åŠ ï¼Œä¸€æ—¦è¾¾åˆ°é˜ˆå€¼æˆ–è€…æ˜¯ç´¯è®¡äº†ä¸€ä¸ªæ—¶é—´æ®µä¾¿å°†è¿™æ‰¹ç´¯è®¡çš„æ•°æ®å¤„ç†æ‰ã€‚ ä½†ç”±äºå¼€å‘è€…çš„å¤§æ„ï¼Œåœ¨æ¶ˆè´¹çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯ queue.take() è¿™ä¸ªé˜»å¡çš„ APIï¼›æ­£å¸¸è¿è¡Œæ²¡å•¥é—®é¢˜ã€‚ å¯ä¸€æ—¦åŸå§‹çš„æ•°æ®æºï¼Œä¹Ÿå°±æ˜¯ DB ä¸­æ²¡æ•°æ®äº†ï¼Œå¯¼è‡´é˜Ÿåˆ—é‡Œçš„æ•°æ®ä¹Ÿè¢«æ¶ˆè´¹å®Œåè¿™ä¸ªæ¶ˆè´¹çº¿ç¨‹ä¾¿ä¼šè¢«é˜»å¡ã€‚ è¿™æ ·ä¸Šä¸€è½®ç§¯ç´¯åœ¨å†…å­˜ä¸­çš„æ•°æ®ä¾¿ä¸€ç›´æ²¡æœºä¼šä½¿ç”¨ï¼Œç›´åˆ°æ•°æ®æºåˆæœ‰æ•°æ®äº†ï¼Œä¸€æ—¦ä¸­é—´é—´éš”è¾ƒé•¿æ—¶ä¾¿å¯èƒ½ä¼šå¯¼è‡´ä¸¥é‡çš„ä¸šåŠ¡å¼‚å¸¸ã€‚ æ‰€ä»¥æˆ‘ä»¬æœ€å¥½æ˜¯ä½¿ç”¨ queue.poll(timeout) è¿™æ ·å¸¦è¶…æ—¶æ—¶é—´çš„ apiï¼Œé™¤éä¸šåŠ¡ä¸Šæœ‰æ˜ç¡®çš„è¦æ±‚éœ€è¦é˜»å¡ã€‚ è¿™ä¸ªä¹ æƒ¯åŒæ ·é€‚ç”¨äºå…¶ä»–åœºæ™¯ï¼Œæ¯”å¦‚è°ƒç”¨ httpã€rpc æ¥å£ç­‰éƒ½éœ€è¦è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ã€‚ æ€»ç»“å…³äº ArrayBlockingQueue çš„ç›¸å…³åˆ†äº«ä¾¿åˆ°æ­¤ç»“æŸï¼Œæ¥ç€ä¼šç»§ç»­æ›´æ–°å…¶ä»–å¹¶å‘å®¹å™¨åŠå¹¶å‘å·¥å…·ã€‚ å¯¹æœ¬æ–‡æœ‰ä»»ä½•ç›¸å…³é—®é¢˜éƒ½å¯ä»¥ç•™è¨€è®¨è®ºã€‚ æœ¬æ–‡æ¶‰åŠåˆ°çš„æ‰€æœ‰æºç ï¼š https://github.com/crossoverJie/JCSprout/blob/master/src/main/java/com/crossoverjie/concurrent/ArrayQueue.java ä½ çš„ç‚¹èµä¸åˆ†äº«æ˜¯å¯¹æˆ‘æœ€å¤§çš„æ”¯æŒ]]></content>
      <categories>
        <category>å¹¶å‘</category>
      </categories>
      <tags>
        <tag>concurrent</tag>
        <tag>ArrayBlockingQueue</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[VLOG-007:ä¸€ä¸ªç¨‹åºå‘˜çš„å‘¨æœ«ï¼ˆä¸­ï¼‰]]></title>
    <url>%2F2019%2F03%2F30%2Fvlog%2FChinese-coder-weekends-02%2F</url>
    <content type="text"><![CDATA[æ‰¿æ¥ä¸ŠæœŸã€ŠVLOG-006:ä¸€ä¸ªç¨‹åºå‘˜çš„å‘¨æœ«ï¼ˆä¸Šï¼‰ã€‹ æœ¬æ¬¡æ˜¯å‘¨æœ«æ—¥å¸¸çš„ä¸­ç¯‡ï¼Œä¹Ÿæ˜¯æˆ‘æ¯å‘¨åšçš„æœ€é¢‘ç¹çš„ä¸€ä»¶äº‹æƒ…ã€é™ªå¥³æœ‹å‹é€›è¡—ã€‘ã€‚ å¯¼è‡´çš„ç»“æœæ˜¯æˆ‘å·²ç»æ¸…æ¥šçš„çŸ¥é“æ‰€åœ¨å•†åœˆé‡Œå¤§éƒ¨åˆ†é—¨åº—é‡Œçš„ä¼‘æ¯ä½ç½®ã€‚ å“ªé‡Œåç€èˆ’æœã€å“ªé‡Œçš„ä¿¡å·æ¯”è¾ƒå¥½ã€å“ªå®¶åº—é€›ä¸ä¹…ä¼šé©¬ä¸Šèµ°ï¼Œæ‰€ä»¥æœ€å¥½æ˜¯ä¸è¦åä¸‹ã€‚ å¯è°“æ˜¯â€œæ—±çš„æ—±æ­»ï¼Œæ¶çš„æ¶æ­»â€ æ­£ç‰‡å¼€å§‹]]></content>
      <categories>
        <category>VLOG</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[çº¿ç¨‹æ± ä¸­ä½ ä¸å®¹é”™è¿‡çš„ä¸€äº›ç»†èŠ‚]]></title>
    <url>%2F2019%2F03%2F26%2Ftroubleshoot%2Fthread-gone2%2F</url>
    <content type="text"><![CDATA[èƒŒæ™¯ä¸Šå‘¨åˆ†äº«äº†ä¸€ç¯‡ã€Šä¸€ä¸ªçº¿ç¨‹ç½¢å·¥çš„è¯¡å¼‚äº‹ä»¶ã€‹ï¼Œæœ€è¿‘ä¹Ÿåœ¨å…¬å¸å†…éƒ¨åˆ†äº«äº†è¿™ä¸ªæ¡ˆä¾‹ã€‚ æ— ç‹¬æœ‰å¶ï¼Œåœ¨å†…éƒ¨åˆ†äº«çš„æ—¶å€™ä¹Ÿæœ‰å°ä¼™ä¼´é—®äº†ä¹‹å‰åˆ†äº«æ—¶æ‰€æå‡ºçš„ä¸€ç±»é—®é¢˜ï¼š è¿™å…¶å®æ˜¯ä¸€ç±»å…±æ€§é—®é¢˜ï¼Œæˆ‘è®¤ä¸ºä¸»è¦è¿˜æ˜¯ä¸¤ä¸ªåŸå› ï¼š æˆ‘è‡ªå·±ç¡®å®ä¹Ÿæ²¡è®²æ¸…æ¥šï¼Œä¹‹å‰ç”»çš„é‚£å¼ å›¾è¿˜éœ€è¦å†å®Œå–„ï¼Œæœ‰äº›è¯¯å¯¼ã€‚ ç¬¬äºŒè¿˜æ˜¯å¤§å®¶å¯¹çº¿ç¨‹æ± çš„ç†è§£ä¸å¤Ÿæ·±åˆ»ï¼Œæ¯”å¦‚ä»Šå¤©è¦æ¢è®¨çš„å†…å®¹ã€‚ çº¿ç¨‹æ± çš„å·¥ä½œåŸç†é¦–å…ˆè¿˜æ˜¯æ¥å¤ä¹ ä¸‹çº¿ç¨‹æ± çš„åŸºæœ¬åŸç†ã€‚ æˆ‘è®¤ä¸ºçº¿ç¨‹æ± å®ƒå°±æ˜¯ä¸€ä¸ªè°ƒåº¦ä»»åŠ¡çš„å·¥å…·ã€‚ ä¼—æ‰€å‘¨çŸ¥åœ¨åˆå§‹åŒ–çº¿ç¨‹æ± ä¼šç»™å®šçº¿ç¨‹æ± çš„å¤§å°ï¼Œå‡è®¾ç°åœ¨æˆ‘ä»¬æœ‰ 1000 ä¸ªçº¿ç¨‹ä»»åŠ¡éœ€è¦è¿è¡Œï¼Œè€Œçº¿ç¨‹æ± çš„å¤§å°ä¸º 10~20ï¼Œåœ¨çœŸæ­£è¿è¡Œä»»åŠ¡çš„è¿‡ç¨‹ä¸­ä»–è‚¯å®šä¸ä¼šåˆ›å»ºè¿™1000ä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œè€Œæ˜¯å……åˆ†åˆ©ç”¨çº¿ç¨‹æ± é‡Œè¿™ 10~20 ä¸ªçº¿ç¨‹æ¥è°ƒåº¦è¿™1000ä¸ªä»»åŠ¡ã€‚ è€Œè¿™é‡Œçš„ 10~20 ä¸ªçº¿ç¨‹æœ€åä¼šç”±çº¿ç¨‹æ± å°è£…ä¸º ThreadPoolExecutor.Worker å¯¹è±¡ï¼Œè€Œè¿™ä¸ª Worker æ˜¯å®ç°äº† Runnable æ¥å£çš„ï¼Œæ‰€ä»¥ä»–è‡ªå·±æœ¬èº«å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚ æ·±å…¥åˆ†æ è¿™é‡Œæˆ‘ä»¬æ¥åšä¸€ä¸ªæ¨¡æ‹Ÿï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ã€æœ€å¤§çº¿ç¨‹æ•°ã€é˜»å¡é˜Ÿåˆ—éƒ½ä¸º2çš„çº¿ç¨‹æ± ã€‚ è¿™é‡Œå‡è®¾çº¿ç¨‹æ± å·²ç»å®Œæˆäº†é¢„çƒ­ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹æ± å†…éƒ¨å·²ç»åˆ›å»ºå¥½äº†ä¸¤ä¸ªçº¿ç¨‹ Workerã€‚ å½“æˆ‘ä»¬å¾€ä¸€ä¸ªçº¿ç¨‹æ± ä¸¢ä¸€ä¸ªä»»åŠ¡ä¼šå‘ç”Ÿä»€ä¹ˆäº‹å‘¢ï¼Ÿ ç¬¬ä¸€æ­¥æ˜¯ç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯ä»»åŠ¡æä¾›è€…ä»–æ‰§è¡Œäº†ä¸€ä¸ª execute() æ–¹æ³•ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å¾€è¿™ä¸ªå†…éƒ¨é˜Ÿåˆ—é‡Œæ”¾äº†ä¸€ä¸ªä»»åŠ¡ã€‚ ä¹‹å‰å·²ç»åˆ›å»ºå¥½äº†çš„ Worker çº¿ç¨‹ä¼šæ‰§è¡Œä¸€ä¸ª while å¾ªç¯ â€”&gt; ä¸åœçš„ä»è¿™ä¸ªå†…éƒ¨é˜Ÿåˆ—é‡Œè·å–ä»»åŠ¡ã€‚(è¿™ä¸€æ­¥æ˜¯ç«äº‰çš„å…³ç³»ï¼Œéƒ½ä¼šæŠ¢ç€ä»é˜Ÿåˆ—é‡Œè·å–ä»»åŠ¡ï¼Œç”±è¿™ä¸ªé˜Ÿåˆ—å†…éƒ¨å®ç°äº†çº¿ç¨‹å®‰å…¨ã€‚) è·å–å¾—åˆ°ä¸€ä¸ªä»»åŠ¡åï¼Œå…¶å®ä¹Ÿå°±æ˜¯æ‹¿åˆ°äº†ä¸€ä¸ª Runnable å¯¹è±¡(ä¹Ÿå°±æ˜¯ execute(Runnable task) è¿™é‡Œæ‰€æäº¤çš„ä»»åŠ¡)ï¼Œæ¥ç€æ‰§è¡Œè¿™ä¸ª Runnable çš„ run() æ–¹æ³•ï¼Œè€Œä¸æ˜¯ start()ï¼Œè¿™ç‚¹éœ€è¦æ³¨æ„åæ–‡åˆ†æåŸå› ã€‚ ç»“åˆæºç æ¥çœ‹ï¼š ä»å›¾ä¸­å…¶å®å°±å¯¹åº”äº†åˆšæ‰æåˆ°çš„äºŒä¸‰ä¸¤æ­¥ï¼š while å¾ªç¯ï¼Œä» getTask() æ–¹æ³•ä¸­ä¸€ç›´ä¸åœçš„è·å–ä»»åŠ¡ã€‚ æ‹¿åˆ°ä»»åŠ¡åï¼Œæ‰§è¡Œå®ƒçš„ run() æ–¹æ³•ã€‚ è¿™æ ·ä¸€ä¸ªçº¿ç¨‹å°±è°ƒåº¦å®Œæ¯•ï¼Œç„¶åå†æ¬¡è¿›å…¥å¾ªç¯ä»é˜Ÿåˆ—é‡Œå–ä»»åŠ¡å¹¶ä¸æ–­çš„è¿›è¡Œè°ƒåº¦ã€‚ å†æ¬¡è§£é‡Šä¹‹å‰çš„é—®é¢˜æ¥ä¸‹æ¥å›é¡¾ä¸€ä¸‹æˆ‘ä»¬ä¸Šä¸€ç¯‡æ–‡ç« æ‰€æåˆ°çš„ï¼Œå¯¼è‡´ä¸€ä¸ªçº¿ç¨‹æ²¡æœ‰è¿è¡Œçš„æ ¹æœ¬åŸå› æ˜¯ï¼š åœ¨å•ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ä¸­ä¸€ä½†æŠ›å‡ºäº†æœªè¢«æ•è·çš„å¼‚å¸¸æ—¶ï¼Œçº¿ç¨‹æ± ä¼šå›æ”¶å½“å‰çš„çº¿ç¨‹å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ Workerï¼›å®ƒä¹Ÿä¼šä¸€ç›´ä¸æ–­çš„ä»é˜Ÿåˆ—é‡Œè·å–ä»»åŠ¡æ¥æ‰§è¡Œï¼Œä½†ç”±äºè¿™æ˜¯ä¸€ä¸ªæ¶ˆè´¹çº¿ç¨‹ï¼Œæ ¹æœ¬æ²¡æœ‰ç”Ÿäº§è€…å¾€é‡Œè¾¹ä¸¢ä»»åŠ¡ï¼Œæ‰€ä»¥å®ƒä¼šä¸€ç›´ waiting åœ¨ä»é˜Ÿåˆ—é‡Œè·å–ä»»åŠ¡å¤„ï¼Œæ‰€ä»¥ä¹Ÿå°±é€ æˆäº†çº¿ä¸Šçš„é˜Ÿåˆ—æ²¡æœ‰æ¶ˆè´¹ï¼Œä¸šåŠ¡çº¿ç¨‹æ± æ²¡æœ‰æ‰§è¡Œçš„é—®é¢˜ã€‚ ç»“åˆä¹‹å‰çš„é‚£å¼ å›¾æ¥çœ‹ï¼š è¿™é‡Œå¤§å®¶é—®çš„æœ€å¤šçš„ä¸€ä¸ªç‚¹æ˜¯ï¼Œä¸ºä»€ä¹ˆä¼šæ²¡æœ‰æ˜¯æ ¹æœ¬æ²¡æœ‰ç”Ÿäº§è€…å¾€é‡Œè¾¹ä¸¢ä»»åŠ¡ï¼Œå›¾ä¸­ä¸æ˜¯æ˜æ˜ç”»çš„æœ‰ä¸€ä¸ª product å˜›ï¼Ÿ è¿™é‡Œç¡®å®æ˜¯æœ‰äº›ä¸å¤ªæ¸…æ¥šï¼Œå†æ¬¡å¼ºè°ƒä¸€æ¬¡ï¼š å›¾ä¸­çš„ product æ˜¯å¾€å†…éƒ¨é˜Ÿåˆ—é‡Œå†™æ¶ˆæ¯çš„ç”Ÿäº§è€…ï¼Œå¹¶ä¸æ˜¯å¾€è¿™ä¸ª Consumer æ‰€åœ¨çš„çº¿ç¨‹æ± ä¸­å†™ä»»åŠ¡çš„ç”Ÿäº§è€…ã€‚ å› ä¸ºå³ä¾¿ Consumer æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œå®ƒä¾ç„¶å…·æœ‰ä¸€ä¸ªå¸¸è§„çº¿ç¨‹æ± æ‰€å…·å¤‡çš„æ‰€æœ‰æ¡ä»¶ï¼š Worker è°ƒåº¦çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹æ± è¿è¡Œçš„çº¿ç¨‹ï¼›è™½ç„¶åªæœ‰ä¸€ä¸ªã€‚ å†…éƒ¨çš„é˜»å¡é˜Ÿåˆ—ï¼›è™½ç„¶é•¿åº¦åªæœ‰1ã€‚ å†æ¬¡ç»“åˆå›¾æ¥çœ‹ï¼š æ‰€ä»¥ä¹‹å‰æåˆ°çš„ã€æ²¡æœ‰ç”Ÿäº§è€…å¾€é‡Œè¾¹ä¸¢ä»»åŠ¡ã€‘æ˜¯æŒ‡å³å›¾æ”¾å¤§åçš„é‚£ä¸€å—ï¼Œä¹Ÿå°±æ˜¯å†…éƒ¨é˜Ÿåˆ—å¹¶æ²¡æœ‰å…¶ä»–çº¿ç¨‹å¾€é‡Œè¾¹ä¸¢ä»»åŠ¡æ‰§è¡Œ execute() æ–¹æ³•ã€‚ è€Œä¸€æ—¦å‘ç”Ÿæœªæ•è·çš„å¼‚å¸¸åï¼ŒWorker1 è¢«å›æ”¶ï¼Œé¡ºå¸¦çš„å®ƒæ‰€è°ƒåº¦çš„çº¿ç¨‹ task1ï¼ˆè¿™ä¸ªtask1 ä¹Ÿå°±æ˜¯åœ¨æ‰§è¡Œä¸€ä¸ª while å¾ªç¯æ¶ˆè´¹å·¦å›¾ä¸­çš„é‚£ä¸ªé˜Ÿåˆ—ï¼‰ ä¹Ÿä¼šè¢«å›æ”¶æ‰ã€‚ æ–°åˆ›å»ºçš„ Worker2 ä¼šå–ä»£ Worker1 ç»§ç»­æ‰§è¡Œ while å¾ªç¯ä»å†…éƒ¨é˜Ÿåˆ—é‡Œè·å–ä»»åŠ¡ï¼Œä½†æ­¤æ—¶è¿™ä¸ªé˜Ÿåˆ—å°±ä¸€ç›´ä¼šæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥ä¹Ÿå°±æ˜¯å¤„äº Waiting çŠ¶æ€ã€‚ æˆ‘è§‰å¾—è¿™æ³¢è§£é‡Šåº”è¯¥è¿˜æ˜¯è®²æ¸…æ¥šäº†ï¼Œæ¬¢è¿è¿˜æ²¡ææ˜ç™½çš„æœ‹å‹ç•™è¨€è®¨è®ºã€‚ ä¸ºä»€æ˜¯ run() è€Œä¸æ˜¯ start()é—®é¢˜ææ¸…æ¥šåæ¥æƒ³æƒ³ä¸ºä»€ä¹ˆçº¿ç¨‹æ± åœ¨è°ƒåº¦çš„æ—¶å€™æ‰§è¡Œçš„æ˜¯ Runnable çš„ run() æ–¹æ³•ï¼Œè€Œä¸æ˜¯ start() æ–¹æ³•å‘¢ï¼Ÿ æˆ‘ç›¸ä¿¡å¤§éƒ¨åˆ†æ²¡æœ‰çœ‹è¿‡æºç çš„åŒå­¦å¿ƒä¸­ç¬¬ä¸€ä¸ªå°è±¡å°±åº”è¯¥æ˜¯æ‰§è¡Œçš„ start() æ–¹æ³•ï¼› å› ä¸ºä¸ç®¡æ˜¯å­¦æ ¡è€å¸ˆï¼Œè¿˜æ˜¯ç½‘ä¸Šå¤§ç‰›è®²çš„éƒ½æ˜¯åªæœ‰æ‰§è¡Œäº†start() æ–¹æ³•åæ“ä½œç³»ç»Ÿæ‰ä¼šç»™æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥è¿è¡Œï¼Œè€Œ run() æ–¹æ³•åªæ˜¯ä¸€ä¸ªæ™®é€šçš„æ–¹æ³•è°ƒç”¨ã€‚ è€Œåœ¨çº¿ç¨‹æ± è¿™ä¸ªåœºæ™¯ä¸­å´æ°å¥½å°±æ˜¯è¦åˆ©ç”¨å®ƒåªæ˜¯ä¸€ä¸ªæ™®é€šæ–¹æ³•è°ƒç”¨ã€‚ å›åˆ°æˆ‘åœ¨æ–‡åˆä¸­æ‰€æåˆ°çš„ï¼šæˆ‘è®¤ä¸ºçº¿ç¨‹æ± å®ƒå°±æ˜¯ä¸€ä¸ªè°ƒåº¦ä»»åŠ¡çš„å·¥å…·ã€‚ å‡è®¾è¿™é‡Œæ˜¯è°ƒç”¨çš„ Runnable çš„ start æ–¹æ³•ï¼Œé‚£ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ã€‚ å¦‚æœæˆ‘ä»¬å¾€ä¸€ä¸ªæ ¸å¿ƒã€æœ€å¤§çº¿ç¨‹æ•°ä¸º 2 çš„çº¿ç¨‹æ± é‡Œä¸¢äº† 1000 ä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆå®ƒä¼šé¢å¤–çš„åˆ›å»º 1000 ä¸ªçº¿ç¨‹ï¼ŒåŒæ—¶æ¯ä¸ªä»»åŠ¡éƒ½æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œä¸€ä¸‹å­å°±æ‰§è¡Œå®Œæ¯•äº†ã€‚ ä»è€Œæ²¡æ³•åšåˆ°ç”±è¿™ä¸¤ä¸ª Worker çº¿ç¨‹æ¥è°ƒåº¦è¿™ 1000 ä¸ªä»»åŠ¡ï¼Œè€Œåªæœ‰å½“åšä¸€ä¸ªåŒæ­¥é˜»å¡çš„ run() æ–¹æ³•è°ƒç”¨æ—¶æ‰èƒ½æ»¡è¶³è¿™ä¸ªè¦æ±‚ã€‚ è¿™äº‹ä¹Ÿè®©æˆ‘å‘ç°ä¸€ä¸ªå¥‡ç‰¹çš„ç°è±¡ï¼šå°±æ˜¯ç½‘ä¸Šå‡ ä¹æ²¡äººè®²è¿‡ä¸ºä»€ä¹ˆåœ¨çº¿ç¨‹æ± é‡Œæ˜¯ run è€Œä¸æ˜¯ startï¼Œä¸çŸ¥é“æ˜¯å¤§å®¶éƒ½è§‰å¾—è¿™æ˜¯åŸºæ“è¿˜æ˜¯æ²¡äººä»”ç»†è€ƒè™‘è¿‡ã€‚ æ€»ç»“é’ˆå¯¹ä¹‹å‰çº¿ä¸Šäº‹æ•…çš„æ€»ç»“ä¸Šæ¬¡å·²ç»å†™å¾—å·®ä¸å¤šäº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç¿»å›å»çœ‹çœ‹ã€‚ è¿™æ¬¡å‘¢å¯èƒ½æ›´å¤šæ˜¯æˆ‘è‡ªå·±çš„æ€»ç»“ï¼Œæ¯”å¦‚å†™ä¸€ç¯‡æŠ€æœ¯åšå®¢æ—¶å¦‚æœå¤§éƒ¨åˆ†äººå¯¹æŸä¸€ä¸ªçŸ¥è¯†ç‚¹è®¨è®ºçš„æ¯”è¾ƒçƒ­çƒˆæ—¶ï¼Œé‚£ä¸€å®šæ˜¯ä½œè€…è¦ä¹ˆè®²é”™äº†ï¼Œè¦ä¹ˆæ²¡è®²æ¸…æ¥šã€‚ è¿™ç‚¹ç¡®å®æ˜¯è¦æŠŠè‡ªå·±ä½œä¸ºä¸€ä¸ªè¯»è€…çš„è§’åº¦æ¥çœ‹ï¼Œä¸ç„¶å¾ˆå®¹æ˜“å‡ºç°ä¹‹å‰çš„ä¸€äº›è¯¯è§£ã€‚ åœ¨è¿™ä¹‹å¤–å‘¢ï¼Œæˆ‘è§‰å¾—å¯¹äºçº¿ç¨‹æ± æŠŠè¿™ä¸¤ç¯‡éƒ½çœ‹å®ŒåŒæ—¶ä¹Ÿç†è§£åå¯¹äºå¤§å®¶ç†è§£çº¿ç¨‹æ± ï¼Œåˆ©ç”¨çº¿ç¨‹æ± å®Œæˆå·¥ä½œä¹Ÿæ˜¯æœ‰å¾ˆå¤§å¥½å¤„çš„ã€‚ å¦‚æœæœ‰åœ¨é¢è¯•ä¸­åŠ åˆ†çš„è®°å¾—å›æ¥ç‚¹èµã€åˆ†äº«å•Šã€‚ ä½ çš„ç‚¹èµä¸åˆ†äº«æ˜¯å¯¹æˆ‘æœ€å¤§çš„æ”¯æŒ]]></content>
      <categories>
        <category>é—®é¢˜æ’æŸ¥</category>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Thread</tag>
        <tag>concurrent</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[VLOG-006:ä¸€ä¸ªç¨‹åºå‘˜çš„å‘¨æœ«ï¼ˆä¸Šï¼‰]]></title>
    <url>%2F2019%2F03%2F21%2Fvlog%2FChinese-coder-weekends-01%2F</url>
    <content type="text"><![CDATA[ä¸Šæ¬¡å‘äº†ä¸€ä¸ªã€ŠVLOG-004ï¼šå›½äº§ç¨‹åºå‘˜çš„ä¸€å¤©ã€‹è¯„è®ºå’Œæ’­æ”¾é‡éƒ½è¿˜ä¸é”™ï¼Œè¿™æ¬¡è¶çƒ­æ‰“é“æ›´æ–°äº†å‘¨æœ«ä¸šä½™ç”Ÿæ´»æ˜¯æ€ä¹ˆæ ·çš„ã€‚ åœ¨è¿™ä¸ªè§†é¢‘ä¸­ä½ å°†çœ‹åˆ°ï¼š ä½œä¸ºä¸€ä¸ªå±…å®¶å¥½ç”·äººæ˜¯å¦‚ä½•ä½“ç°è‡ªæˆ‘ä»·å€¼çš„ï¼Ÿ æˆ‘æ˜¯å¦‚ä½•äº§å‡ºä¸€ä»½æŠ€æœ¯åšå®¢ï¼Ÿ å¥³æœ‹å‹ä¸åœ¨å®¶å¦‚ä½•æ­£è§„æ¶ˆé£æ—¶é—´ï¼Ÿ å¦‚ä½•æ’¸å¾—ä»£ç ã€ä¸‹å¾—å¨æˆ¿è®¨å¥³æœ‹å‹å¼€å¿ƒï¼Ÿ æ­£ç‰‡å¼€å§‹ è¿™ä¸ªè§†é¢‘æ˜¯ä¸Šéƒ¨åˆ†ï¼Œä¸»è¦è®°å½•çš„æ˜¯åœ¨å®¶é‡Œçš„ç”Ÿæ´»ã€‚ èµ·åºŠå¯èƒ½æ˜¯ç”±äºå¹³æ—¶æ—©èµ·ä¹ æƒ¯äº†ï¼Œæˆ‘å±…ç„¶å¿«æ”¹æ‰äº†å¤šå¹´æ‡’åºŠçš„æ¯›ç—…ï¼Œè¿‘æœŸå‘¨æœ«éƒ½æ˜¯8ã€9ç‚¹çš„æ ·å­å°±ä¼šèµ·åºŠã€‚ èµ·åºŠåç£¨è¹­åŠå¤©ä¸€ä¸å°å¿ƒå°±åˆ°äº†é¥­ç‚¹ï¼Œç”±äºå¥³æœ‹å‹ä¸Šæ—©ç­ä¸€ä¸ªäººçš„è¯å°±ç‚¹äº†å¤–å–ã€‚ åƒé¥­çš„åŒæ—¶ä¼šçœ‹çœ‹ä¸€éƒ¨ä¸‹é¥­ç¥å‰§ã€Šæ­¦æ—å¤–ä¼ ã€‹ã€‚ å®¶åŠ¡å¼€å§‹æ´—è¡£æœï¼Œæ´—è¡£æœçš„åŒæ—¶éœ€è¦æ”¶è¡£æœã€å è¡£æœä»è€Œå®ç°ä¸ªäººä»·å€¼ã€‚ å‘¨æŠ¥ å‡†å¤‡å¼€å§‹å†™å‘¨æŠ¥ï¼Œç»“æœä¸€ä¸å°å¿ƒæ²‰æµ¸äºç”µè§†ã€‚ã€‚ã€‚ 2ä¸ªå°æ—¶åå‘¨æŠ¥å®Œæˆã€‚ PPT å®Œæˆä¸‹å‘¨æŠ€æœ¯åˆ†äº«çš„ PPTï¼Œä½†å—é™äºè®¾è®¡ç»†èƒæ•´ä¸ª PPT å°†æ¯”è¾ƒéš¾çœ‹ã€‚ æŠ€æœ¯åšå®¢ å¼€å§‹å†™ä¸€ç¯‡æŠ€æœ¯åšå®¢ï¼Œåˆ†äº«äº†æˆ‘ä¸ªäººçš„ä¸€äº›ä¹ æƒ¯ï¼š å…ˆåœ¨æœ¬å­ä¸Šæ‰“å¥½æçº²ã€‚ åŠ ä¸Šä¸€ä¸ªäºŒæ¬¡å…ƒé…å›¾ã€‚ å†™åšå®¢æ—¶éœ€è¦æ³¨æ„çš„ç‚¹ã€‚ æ¶ˆé£ ç© switch ï¼Œä¹°æ¸¸æˆèŠ±çš„é’±å·²ç»éƒ½å¯ä»¥å†ä¹°ä¸€ä¸ª switch äº†ï¼ŒæœçœŸæ˜¯ä¹°æ¸¸æˆé€ä¸»æœºï¼›ä¸»è¦ç©ï¼š é©¬é‡Œå¥¥èµ›è½¦8 å–·å°„ä¹Œè´¼å¨˜ å¡å°”è¾¾ä¼ è¯´ ä»»å¤©å ‚æ˜æ˜Ÿå¤§ä¹±æ–— æ™šé¥­ ä½œä¸ºç‹åˆšå¸ˆå‚…çš„åœ¨çº¿å¼Ÿå­ï¼Œæ·±çš„å®½æ²¹çœŸä¼ ï¼Œå¿…å°†æ–™ç†å‡ºæ„ŸåŠ¨äººå¿ƒçš„ç¾å‘³ï¼›æœ¬æ¬¡ä¸ºå¤§å®¶å¸¦æ¥çš„æ˜¯å£å‘³çŒªè‚ã€‚ å…¨ç¨‹é«˜èƒ½ï¼Œè¯·å¤§å®¶é¥­å‰è§‚çœ‹ï¼ˆåƒå®Œé¥­åä¼šå¿ä¸ä½æƒ³åƒï¼‰ã€‚ ENDçœ‹åˆ°è¿™é‡Œæƒ³å¿…ä½ å·²ç»å¯¹å¼€å§‹çš„å‡ ä¸ªé—®é¢˜æœ‰äº†ç­”æ¡ˆäº†å§ï¼Œæ¥æ ¸å¯¹ä¸‹æˆ‘çš„æ ‡å‡†ç­”æ¡ˆå§ã€‚ ä½œä¸ºä¸€ä¸ªå±…å®¶å¥½ç”·äººæ˜¯å¦‚ä½•ä½“ç°è‡ªæˆ‘ä»·å€¼çš„ï¼Ÿâ€”-&gt;ä½ çš„ä»·å€¼å°±æ˜¯æ´—ç¢—ã€æ´—è¡£æœæ”¶æ‹¾å®¶åŠ¡ã€‚ æˆ‘æ˜¯å¦‚ä½•äº§å‡ºä¸€ä»½æŠ€æœ¯åšå®¢ï¼Ÿâ€”-&gt;æå‰æ„æ€ç›®å½•ã€æ–‡ç« é…å›¾ã€‚ å¥³æœ‹å‹ä¸åœ¨å®¶å¦‚ä½•æ­£è§„æ¶ˆé£æ—¶é—´ï¼Ÿâ€”-&gt;å¿…é¡»æ˜¯ switch å•Šï¼Œä¸ç„¶ä½ ä»¥ä¸ºæ˜¯å•¥ã€‚ã€‚ å¦‚ä½•æ’¸å¾—ä»£ç ã€ä¸‹å¾—å¨æˆ¿è®¨å¥³æœ‹å‹å¼€å¿ƒï¼Ÿâ€”-&gt;çœ‹ 20 éç‹åˆšå¸ˆå‚…çš„è§†é¢‘è‡ªå­¦æˆæ‰ã€‚ ä¸‹ä¸€æœŸå°†ä¼šä¸ºå¤§å®¶å¸¦æ¥å®¤å¤–ç¯‡ï¼Œä½œä¸ºä¸€ä¸ªå¤§å­¦æ¯•ä¸šåˆ°ç°åœ¨æˆåŠŸé•¿è†˜ 20 æ–¤çš„ç¯®çƒçˆ±å¥½è€…ï¼Œå¦‚ä½•ç§‘å­¦è¿åŠ¨é•¿è‚‰ï¼Œä½ å€¼å¾—æœŸå¾…ğŸ¤«ã€‚]]></content>
      <categories>
        <category>VLOG</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ä¸€ä¸ªçº¿ç¨‹ç½¢å·¥çš„è¯¡å¼‚äº‹ä»¶]]></title>
    <url>%2F2019%2F03%2F12%2Ftroubleshoot%2Fthread-gone%2F</url>
    <content type="text"><![CDATA[èƒŒæ™¯äº‹æƒ…ï¼ˆäº‹æ•…ï¼‰æ˜¯è¿™æ ·çš„ï¼Œçªç„¶æ”¶åˆ°æŠ¥è­¦ï¼Œçº¿ä¸ŠæŸä¸ªåº”ç”¨é‡Œä¸šåŠ¡é€»è¾‘æ²¡æœ‰æ‰§è¡Œï¼Œå¯¼è‡´çš„ç»“æœæ˜¯æ•°æ®åº“é‡Œçš„æŸäº›æ•°æ®æ²¡æœ‰æ›´æ–°ã€‚ è™½ç„¶æ˜¯å‰äººå†™çš„ä»£ç ï¼Œä½†ä½œä¸º Bug maker&amp;killer åªèƒ½å’¬ç€ç‰™ä¸Šäº†ã€‚ å› ä¸ºä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡å‡ºé—®é¢˜è¿™å—çš„é€»è¾‘ï¼Œæ‰€ä»¥ç®€å•ç†äº†ä¸‹å¦‚å›¾ï¼š æœ‰ä¸€ä¸ªç”Ÿäº§çº¿ç¨‹ä¸€ç›´æºæºä¸æ–­çš„å¾€é˜Ÿåˆ—å†™æ•°æ®ã€‚ æ¶ˆè´¹çº¿ç¨‹ä¹Ÿä¸€ç›´ä¸åœçš„å–å‡ºæ•°æ®åå†™å…¥åç»­çš„ä¸šåŠ¡çº¿ç¨‹æ± ã€‚ ä¸šåŠ¡çº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹ä¼šå¯¹æ¯ä¸ªä»»åŠ¡è¿›è¡Œå…¥åº“æ“ä½œã€‚ æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°çš„ï¼Œå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ã€‚ å°è¯•å®šä½æ¥ä¸‹æ¥ä¾¿æ˜¯å°è¯•å®šä½è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆä¾‹è¡Œæ£€æŸ¥äº†ä»¥ä¸‹å‡ é¡¹ï¼š æ˜¯å¦å†…å­˜æœ‰å†…å­˜æº¢å‡ºï¼Ÿ åº”ç”¨ GC æ˜¯å¦æœ‰å¼‚å¸¸ï¼Ÿ é€šè¿‡æ—¥å¿—ä»¥åŠç›‘æ§å‘ç°ä»¥ä¸Šä¸¤é¡¹éƒ½æ˜¯æ­£å¸¸çš„ã€‚ ç´§æ¥ç€ä¾¿ dump äº†çº¿ç¨‹å¿«ç…§æŸ¥çœ‹ä¸šåŠ¡çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹éƒ½åœ¨å¹²å•¥ã€‚ ç»“æœå‘ç°æ‰€æœ‰ä¸šåŠ¡çº¿ç¨‹æ± éƒ½å¤„äº waiting çŠ¶æ€ï¼Œé˜Ÿåˆ—ä¹Ÿæ˜¯ç©ºçš„ã€‚ åŒæ—¶ç”Ÿäº§è€…ä½¿ç”¨çš„é˜Ÿåˆ—å´å·²ç»æ»¡äº†ï¼Œæ²¡æœ‰ä»»ä½•æ¶ˆè´¹è¿¹è±¡ã€‚ ç»“åˆä¸Šé¢çš„æµç¨‹å›¾ä¸éš¾å‘ç°åº”è¯¥æ˜¯æ¶ˆè´¹é˜Ÿåˆ—çš„ Consumer å‡ºé—®é¢˜äº†ï¼Œå¯¼è‡´ä¸Šæ¸¸çš„é˜Ÿåˆ—ä¸èƒ½æ¶ˆè´¹ï¼Œä¸‹æœ‰çš„ä¸šåŠ¡çº¿ç¨‹æ± æ²¡äº‹å¯åšã€‚ review ä»£ç äºæ˜¯æŸ¥çœ‹äº†æ¶ˆè´¹ä»£ç çš„ä¸šåŠ¡é€»è¾‘ï¼ŒåŒæ—¶ä¹Ÿå‘ç°æ¶ˆè´¹çº¿ç¨‹æ˜¯ä¸€ä¸ªå•çº¿ç¨‹ã€‚ ç»“åˆä¹‹å‰çš„çº¿ç¨‹å¿«ç…§ï¼Œæˆ‘å‘ç°è¿™ä¸ªæ¶ˆè´¹çº¿ç¨‹ä¹Ÿæ˜¯å¤„äº waiting çŠ¶æ€ï¼Œå’Œåé¢çš„ä¸šåŠ¡çº¿ç¨‹æ± ä¸€æ¨¡ä¸€æ ·ã€‚ ä»–åšçš„äº‹æƒ…åŸºæœ¬ä¸Šå°±æ˜¯å¯¹æ¶ˆæ¯è§£æï¼Œä¹‹åä¸¢åˆ°åé¢çš„ä¸šåŠ¡çº¿ç¨‹æ± ä¸­ï¼Œæ²¡æœ‰å‘ç°ä»€ä¹ˆç‰¹åˆ«çš„åœ°æ–¹ã€‚ ä½†æ˜¯ç”±äºé‡Œé¢çš„åˆ†æ”¯ç‰¹åˆ«å¤šï¼ˆswitch caseï¼‰ï¼Œçœ‹ç€æœ‰ç‚¹å¤´ç–¼ï¼›æ‰€ä»¥æˆ‘ä¸å†™è¿™ä¸ªä¸šåŠ¡ä»£ç çš„åŒå­¦æ²Ÿé€šåä»–å‘Šè¯‰æˆ‘ç¡®å®ä¹Ÿåªæ˜¯å…¥å£å¤„è§£æäº†ä¸€ä¸‹æ•°æ®ï¼Œåç»­æ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘éƒ½æ˜¯ä¸¢åˆ°çº¿ç¨‹æ± ä¸­å¤„ç†çš„ï¼Œäºæ˜¯æˆ‘ä¾¿å¸¦ç€è¿™ä¸ªå‰æå»æ’æŸ¥äº†ï¼ˆåŸ‹ä¸‹äº†ä¼ç¬”ï¼‰ã€‚ å› ä¸ºè¿™é‡Œæ¶ˆè´¹çš„é˜Ÿåˆ—å…¶å®æ˜¯ä¸€ä¸ª disruptor é˜Ÿåˆ—ï¼›å®ƒå’Œæˆ‘ä»¬å¸¸ç”¨çš„ BlockQueue ä¸å¤ªä¸€æ ·ï¼Œä¸æ˜¯ç”±å¼€å‘è€…è‡ªå®šä¹‰ä¸€ä¸ªæ¶ˆè´¹é€»è¾‘è¿›è¡Œå¤„ç†çš„ï¼›è€Œæ˜¯åœ¨åˆå§‹åŒ–é˜Ÿåˆ—æ—¶ç›´æ¥ä¸¢ä¸€ä¸ªçº¿ç¨‹æ± è¿›å»ï¼Œå®ƒä¼šåœ¨å†…éƒ¨ä½¿ç”¨è¿™ä¸ªçº¿ç¨‹æ± è¿›è¡Œæ¶ˆè´¹ï¼ŒåŒæ—¶å›è°ƒä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œæˆ‘ä»¬å†™è‡ªå·±çš„æ¶ˆè´¹é€»è¾‘ã€‚ æ‰€ä»¥å¯¹äºå¼€å‘è€…è€Œè¨€ï¼Œè¿™ä¸ªæ¶ˆè´¹é€»è¾‘å…¶å®æ˜¯ä¸€ä¸ªé»‘ç›’ã€‚ äºæ˜¯åœ¨æˆ‘åå¤ review äº†æ¶ˆè´¹ä»£ç ä¸­çš„æ•°æ®è§£æé€»è¾‘å‘ç°ä¸å¤ªå¯èƒ½å‡ºç°é—®é¢˜åï¼Œä¾¿å¼€å§‹ç–¯ç‹‚æ€€ç–‘æ˜¯ä¸æ˜¯ disruptor è‡ªèº«çš„é—®é¢˜å¯¼è‡´è¿™ä¸ªæ¶ˆè´¹çº¿ç¨‹ç½¢å·¥äº†ã€‚ å†ç¿»äº†ä¸€é˜µ disruptor çš„æºç åä¾æ—§æ²¡å‘ç°ä»€ä¹ˆé—®é¢˜åæˆ‘å’¨è¯¢å¯¹ disruptor è¾ƒç†Ÿçš„@å’–å•¡æ‹¿é“ï¼Œåœ¨ä»–çš„å¸®åŠ©ä¸‹åœ¨æœ¬åœ°æ¨¡æ‹Ÿå‡ºæ¥å’Œç”Ÿäº§ä¸€æ ·çš„æƒ…å†µã€‚ æœ¬åœ°æ¨¡æ‹Ÿ æœ¬åœ°ä¹Ÿæ˜¯åˆ›å»ºäº†ä¸€ä¸ªå•çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œåˆ†åˆ«æ‰§è¡Œäº†ä¸¤ä¸ªä»»åŠ¡ã€‚ ç¬¬ä¸€ä¸ªä»»åŠ¡æ²¡å•¥å¥½è¯´çš„ï¼Œå°±æ˜¯ç®€å•çš„æ‰“å°ã€‚ ç¬¬äºŒä¸ªä»»åŠ¡ä¼šå¯¹ä¸€ä¸ªæ•°è¿›è¡Œç´¯åŠ ï¼ŒåŠ åˆ° 10 ä¹‹åå°±æŠ›å‡ºä¸€ä¸ªæœªæ•è·çš„å¼‚å¸¸ã€‚ æ¥ç€æˆ‘ä»¬æ¥è¿è¡Œä¸€ä¸‹ã€‚ å‘ç°å½“ä»»åŠ¡ä¸­æŠ›å‡ºä¸€ä¸ªæ²¡æœ‰æ•è·çš„å¼‚å¸¸æ—¶ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å°±ä¼šå¤„äº waiting çŠ¶æ€ï¼ŒåŒæ—¶æ‰€æœ‰çš„å †æ ˆéƒ½å’Œç”Ÿäº§ç›¸ç¬¦ã€‚ ç»†å¿ƒçš„æœ‹å‹ä¼šå‘ç°æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹åç§°å’Œå¼‚å¸¸åå¤„äº waiting çŠ¶æ€çš„çº¿ç¨‹åç§°æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™ä¸ªåç»­åˆ†æã€‚ è§£å†³é—®é¢˜ å½“åŠ å…¥å¼‚å¸¸æ•è·ååˆå¦‚ä½•å‘¢ï¼Ÿ ç¨‹åºè‚¯å®šä¼šæ­£å¸¸è¿è¡Œã€‚ åŒæ—¶ä¼šå‘ç°æ‰€æœ‰çš„ä»»åŠ¡éƒ½æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹å®Œæˆçš„ã€‚ è™½è¯´å°±æ˜¯åŠ äº†ä¸€è¡Œä»£ç ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯è¦ææ¸…æ¥šè¿™é‡Œé¢çš„é—¨é—¨é“é“ã€‚ æºç åˆ†æäºæ˜¯åªæœ‰ç›´æ¥ debug çº¿ç¨‹æ± çš„æºç æœ€å¿«äº†ï¼› é€šè¿‡åˆšæ‰çš„å¼‚å¸¸å †æ ˆæˆ‘ä»¬è¿›å…¥åˆ° ThreadPoolExecutor.java:1142 å¤„ã€‚ å‘ç°çº¿ç¨‹æ± å·²ç»å¸®æˆ‘ä»¬åšäº†å¼‚å¸¸æ•è·ï¼Œä½†ä¾ç„¶ä¼šå¾€ä¸ŠæŠ›ã€‚ åœ¨ finally å—ä¸­ä¼šæ‰§è¡Œ processWorkerExit(w, completedAbruptly) æ–¹æ³•ã€‚ çœ‹è¿‡ä¹‹å‰ã€Šå¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨å’Œç†è§£çº¿ç¨‹æ± ã€‹çš„æœ‹å‹åº”è¯¥è¿˜ä¼šæœ‰å°è±¡ã€‚ çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡éƒ½ä¼šè¢«åŒ…è£…ä¸ºä¸€ä¸ªå†…éƒ¨ Worker å¯¹è±¡æ‰§è¡Œã€‚ processWorkerExit å¯ä»¥ç®€å•çš„ç†è§£ä¸ºæ˜¯æŠŠå½“å‰è¿è¡Œçš„çº¿ç¨‹é”€æ¯ï¼ˆworkers.remove(w)ï¼‰ã€åŒæ—¶æ–°å¢ï¼ˆaddWorker()ï¼‰ä¸€ä¸ª Worker å¯¹è±¡æ¥ç€å¤„ç†ï¼› å°±åƒæ˜¯å“ªä¸ªé›¶ä»¶åæ‰åé‡æ–°æ¢äº†ä¸€ä¸ªæ–°çš„æ¥ç€å·¥ä½œï¼Œä½†æ˜¯æ—§é›¶ä»¶è´Ÿè´£çš„ä»»åŠ¡å°±æ²¡æœ‰äº†ã€‚ æ¥ä¸‹æ¥çœ‹çœ‹ addWorker() åšäº†ä»€ä¹ˆäº‹æƒ…ï¼š åªçœ‹è¿™æ¬¡æ¯”è¾ƒå…³å¿ƒçš„éƒ¨åˆ†ï¼›æ·»åŠ æˆåŠŸåä¼šç›´æ¥æ‰§è¡Œä»–çš„ start() çš„æ–¹æ³•ã€‚ ç”±äº Worker å®ç°äº† Runnable æ¥å£ï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šå°±æ˜¯è°ƒç”¨äº† runWorker() æ–¹æ³•ã€‚ åœ¨ runWorker() å…¶å®å°±æ˜¯ä¸Šæ–‡ ThreadPoolExecutor æŠ›å‡ºå¼‚å¸¸æ—¶çš„é‚£ä¸ªæ–¹æ³•ã€‚ å®ƒä¼šä»é˜Ÿåˆ—é‡Œä¸€ç›´ä¸åœçš„è·å–å¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯ getTask()ï¼›åœ¨ getTask ä¹Ÿèƒ½çœ‹å‡ºå®ƒä¼šä¸€ç›´ä»å†…ç½®çš„é˜Ÿåˆ—å–å‡ºä»»åŠ¡ã€‚ è€Œä¸€æ—¦é˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œå®ƒå°±ä¼š waiting åœ¨ workQueue.take()ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä»å †æ ˆä¸­å‘ç°çš„ 1067 è¡Œä»£ç ã€‚ çº¿ç¨‹åå­—çš„å˜åŒ– ä¸Šæ–‡è¿˜æåˆ°äº†å¼‚å¸¸åçš„çº¿ç¨‹åç§°å‘ç”Ÿäº†æ”¹å˜ï¼Œå…¶å®åœ¨ addWorker() æ–¹æ³•ä¸­å¯ä»¥çœ‹åˆ° new Worker()æ—¶å°±ä¼šé‡æ–°å‘½åçº¿ç¨‹çš„åç§°ï¼Œé»˜è®¤å°±æ˜¯æŠŠåç¼€çš„è®¡æ•°+1ã€‚ è¿™æ ·ä¸€åˆ‡éƒ½èƒ½è§£é‡Šå¾—é€šäº†ï¼ŒçœŸç›¸åªæœ‰ä¸€ä¸ªï¼š åœ¨å•ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ä¸­ä¸€ä½†æŠ›å‡ºäº†æœªè¢«æ•è·çš„å¼‚å¸¸æ—¶ï¼Œçº¿ç¨‹æ± ä¼šå›æ”¶å½“å‰çš„çº¿ç¨‹å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ Workerï¼›å®ƒä¹Ÿä¼šä¸€ç›´ä¸æ–­çš„ä»é˜Ÿåˆ—é‡Œè·å–ä»»åŠ¡æ¥æ‰§è¡Œï¼Œä½†ç”±äºè¿™æ˜¯ä¸€ä¸ªæ¶ˆè´¹çº¿ç¨‹ï¼Œæ ¹æœ¬æ²¡æœ‰ç”Ÿäº§è€…å¾€é‡Œè¾¹ä¸¢ä»»åŠ¡ï¼Œæ‰€ä»¥å®ƒä¼šä¸€ç›´ waiting åœ¨ä»é˜Ÿåˆ—é‡Œè·å–ä»»åŠ¡å¤„ï¼Œæ‰€ä»¥ä¹Ÿå°±é€ æˆäº†çº¿ä¸Šçš„é˜Ÿåˆ—æ²¡æœ‰æ¶ˆè´¹ï¼Œä¸šåŠ¡çº¿ç¨‹æ± æ²¡æœ‰æ‰§è¡Œçš„é—®é¢˜ã€‚ æ€»ç»“æ‰€ä»¥ä¹‹åçº¿ä¸Šçš„é‚£ä¸ªé—®é¢˜åŠ ä¸Šå¼‚å¸¸æ•è·ä¹‹åä¹Ÿå˜å¾—æ­£å¸¸äº†ï¼Œä½†æˆ‘è¿˜æ˜¯æœ‰ç‚¹çº³é—·çš„æ˜¯ï¼š æ—¢ç„¶åç»­æ‰€æœ‰çš„ä»»åŠ¡éƒ½æ˜¯åœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯çº¯å¼‚æ­¥äº†ï¼Œé‚£å³ä¾¿æ˜¯å‡ºç°å¼‚å¸¸ä¹Ÿä¸ä¼šæŠ›åˆ°æ¶ˆè´¹çº¿ç¨‹ä¸­å•Šã€‚ è¿™ä¸æ˜¯æŠŠæˆ‘ä¹‹å‰å‚¨å¤‡çš„çŸ¥è¯†ç‚¹æ¨ç¿»äº†å˜›ï¼Ÿä¸ä¿¡é‚ªï¼ä¹‹åæˆ‘è®©è¿ç»´ç»™äº†åŠ ä¸Šå¼‚å¸¸æ•è·åçš„çº¿ä¸Šé”™è¯¯æ—¥å¿—ã€‚ ç»“æœå‘ç°åœ¨ä¸Šæ–‡æåˆ°çš„ä¼—å¤š switch case ä¸­ï¼Œæœ€åä¸€ä¸ªç«Ÿç„¶æ˜¯ç›´æ¥æ“ä½œçš„æ•°æ®åº“ï¼Œå¯¼è‡´ä¸€ä¸ªéç©ºå­—æ®µæŠ¥é”™äº†ğŸ¤¬ï¼ï¼ è¿™äº‹ä¹Ÿç»™æˆ‘ä¸ªæ•™è®­ï¼Œè¿˜æ˜¯å¾—çœ¼è§ä¸ºå®å•Šã€‚ è™½ç„¶è¿™ä¸ªé—®é¢˜æ”¹åŠ¨å¾ˆå°è§£å†³äº†ï¼Œä½†å¤ç›˜æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯æœ‰è®¸å¤šéœ€è¦æ”¹è¿›çš„ï¼š æ¶ˆè´¹é˜Ÿåˆ—çš„çº¿ç¨‹åç§°ç«Ÿç„¶å’Œä¸šåŠ¡çº¿ç¨‹çš„å‰ç¼€ä¸€æ ·ï¼Œå¯¼è‡´æˆ‘å…‰æ‰¾å®ƒå°±èŠ±äº†è®¸å¤šæ—¶é—´ï¼Œå‘½åå¿…é¡»å¾—è°ƒæ•´ã€‚ å¼€å‘è§„èŒƒï¼Œé˜²å¾¡å¼ç¼–ç¨‹å¤§å®¶éœ€è¦å…»æˆä¹ æƒ¯ã€‚ æœªçŸ¥çš„æŠ€æœ¯æ ˆéœ€è¦è°¨æ…ï¼Œæ¯”å¦‚ disruptorï¼Œä¹‹å‰çš„å›¢é˜Ÿåº”è¯¥åªæ˜¯çœ‹äº†ä¸ªé«˜æ€§èƒ½çš„ä»‹ç»å°±ç›´æ¥ä½¿ç”¨ï¼Œå¹¶æ²¡æœ‰æ·±ç©¶å…¶åŸç†ï¼›å¯¼è‡´å‡ºç°é—®é¢˜åå¯¹å®ƒæ‹¿ä¸å‡†ã€‚ å®ä¾‹ä»£ç ï¼š https://github.com/crossoverJie/JCSprout/blob/master/src/main/java/com/crossoverjie/thread/ThreadExceptionTest.java ä½ çš„ç‚¹èµä¸åˆ†äº«æ˜¯å¯¹æˆ‘æœ€å¤§çš„æ”¯æŒ]]></content>
      <categories>
        <category>é—®é¢˜æ’æŸ¥</category>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Thread</tag>
        <tag>concurrent</tag>
        <tag>disruptor</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€è‡´æ€§ Hash ç®—æ³•çš„å®é™…åº”ç”¨]]></title>
    <url>%2F2019%2F03%2F01%2Falgorithm%2Fconsistent-hash%2F</url>
    <content type="text"><![CDATA[å‰è¨€è®°å¾—ä¸€å¹´å‰åˆ†äº«è¿‡ä¸€ç¯‡ã€Šä¸€è‡´æ€§ Hash ç®—æ³•åˆ†æã€‹ï¼Œå½“æ—¶åªæ˜¯åˆ†æäº†è¿™ä¸ªç®—æ³•çš„å®ç°åŸç†ã€è§£å†³äº†ä»€ä¹ˆé—®é¢˜ç­‰ã€‚ ä½†æ²¡æœ‰å®é™…å®ç°ä¸€ä¸ªè¿™æ ·çš„ç®—æ³•ï¼Œæ¯•ç«Ÿè¦åŠ æ·±å°è±¡è¿˜å¾—è‡ªå·±æ’¸ä¸€éï¼Œäºæ˜¯æœ¬æ¬¡å°±å½“å‰çš„ä¸€ä¸ªè·¯ç”±éœ€æ±‚æ¥ç€æ‰‹å®ç°ä¸€æ¬¡ã€‚ èƒŒæ™¯çœ‹è¿‡ã€Šä¸ºè‡ªå·±æ­å»ºä¸€ä¸ªåˆ†å¸ƒå¼ IM(å³æ—¶é€šè®¯) ç³»ç»Ÿã€‹çš„æœ‹å‹åº”è¯¥å¯¹å…¶ä¸­çš„ç™»å½•é€»è¾‘æœ‰æ‰€å°è±¡ã€‚ å…ˆç»™æ–°æ¥çš„æœ‹å‹ç®€å•ä»‹ç»ä¸‹ cim æ˜¯å¹²å•¥çš„ï¼š å…¶ä¸­æœ‰ä¸€ä¸ªåœºæ™¯æ˜¯åœ¨å®¢æˆ·ç«¯ç™»å½•æˆåŠŸåéœ€è¦ä»å¯ç”¨çš„æœåŠ¡ç«¯åˆ—è¡¨ä¸­é€‰æ‹©ä¸€å°æœåŠ¡èŠ‚ç‚¹è¿”å›ç»™å®¢æˆ·ç«¯ä½¿ç”¨ã€‚ è€Œè¿™ä¸ªé€‰æ‹©çš„è¿‡ç¨‹å°±æ˜¯ä¸€ä¸ªè´Ÿè½½ç­–ç•¥çš„è¿‡ç¨‹ï¼›ç¬¬ä¸€ç‰ˆæœ¬åšçš„æ¯”è¾ƒç®€å•ï¼Œé»˜è®¤åªæ”¯æŒè½®è¯¢çš„æ–¹å¼ã€‚ è™½ç„¶å¤Ÿç”¨ï¼Œä½†ä¸å¤Ÿä¼˜é›…ğŸ˜ã€‚ å› æ­¤æˆ‘çš„è§„åˆ’æ˜¯å†…ç½®å¤šç§è·¯ç”±ç­–ç•¥ä¾›ä½¿ç”¨è€…æ ¹æ®è‡ªå·±çš„åœºæ™¯é€‰æ‹©ï¼ŒåŒæ—¶æä¾›ç®€å•çš„ API ä¾›ç”¨æˆ·è‡ªå®šä¹‰è‡ªå·±çš„è·¯ç”±ç­–ç•¥ã€‚ å…ˆæ¥çœ‹çœ‹ä¸€è‡´æ€§ Hash ç®—æ³•çš„ä¸€äº›ç‰¹ç‚¹ï¼š æ„é€ ä¸€ä¸ª 0 ~ 2^32-1 å¤§å°çš„ç¯ã€‚ æœåŠ¡èŠ‚ç‚¹ç»è¿‡ hash ä¹‹åå°†è‡ªèº«å­˜æ”¾åˆ°ç¯ä¸­çš„ä¸‹æ ‡ä¸­ã€‚ å®¢æˆ·ç«¯æ ¹æ®è‡ªèº«çš„æŸäº›æ•°æ® hash ä¹‹åä¹Ÿå®šä½åˆ°è¿™ä¸ªç¯ä¸­ã€‚ é€šè¿‡é¡ºæ—¶é’ˆæ‰¾åˆ°ç¦»ä»–æœ€è¿‘çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¿™æ¬¡è·¯ç”±çš„æœåŠ¡èŠ‚ç‚¹ã€‚ è€ƒè™‘åˆ°æœåŠ¡èŠ‚ç‚¹çš„ä¸ªæ•°ä»¥åŠ hash ç®—æ³•çš„é—®é¢˜å¯¼è‡´ç¯ä¸­çš„æ•°æ®åˆ†å¸ƒä¸å‡åŒ€æ—¶å¼•å…¥äº†è™šæ‹ŸèŠ‚ç‚¹ã€‚ è‡ªå®šä¹‰æœ‰åº Mapæ ¹æ®è¿™äº›å®¢è§‚æ¡ä»¶æˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°é€šè¿‡è‡ªå®šä¹‰ä¸€ä¸ªæœ‰åºæ•°ç»„æ¥æ¨¡æ‹Ÿè¿™ä¸ªç¯ã€‚ è¿™æ ·æˆ‘ä»¬çš„æµç¨‹å¦‚ä¸‹ï¼š åˆå§‹åŒ–ä¸€ä¸ªé•¿åº¦ä¸º N çš„æ•°ç»„ã€‚ å°†æœåŠ¡èŠ‚ç‚¹é€šè¿‡ hash ç®—æ³•å¾—åˆ°çš„æ­£æ•´æ•°ï¼ŒåŒæ—¶å°†èŠ‚ç‚¹è‡ªèº«çš„æ•°æ®ï¼ˆhashcodeã€ipã€ç«¯å£ç­‰ï¼‰å­˜æ”¾åœ¨è¿™é‡Œã€‚ å®ŒæˆèŠ‚ç‚¹å­˜æ”¾åå°†æ•´ä¸ªæ•°ç»„è¿›è¡Œæ’åºï¼ˆæ’åºç®—æ³•æœ‰å¤šç§ï¼‰ã€‚ å®¢æˆ·ç«¯è·å–è·¯ç”±èŠ‚ç‚¹æ—¶ï¼Œå°†è‡ªèº«è¿›è¡Œ hash ä¹Ÿå¾—åˆ°ä¸€ä¸ªæ­£æ•´æ•°ï¼› éå†è¿™ä¸ªæ•°ç»„ç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæ•°æ®å¤§äºç­‰äºå½“å‰å®¢æˆ·ç«¯çš„ hash å€¼ï¼Œå°±å°†å½“å‰èŠ‚ç‚¹ä½œä¸ºè¯¥å®¢æˆ·ç«¯æ‰€è·¯ç”±çš„èŠ‚ç‚¹ã€‚ å¦‚æœæ²¡æœ‰å‘ç°æ¯”å®¢æˆ·ç«¯å¤§çš„æ•°æ®å°±è¿”å›ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæ»¡è¶³ç¯çš„ç‰¹æ€§ï¼‰ã€‚ å…ˆä¸è€ƒè™‘æ’åºæ‰€æ¶ˆè€—çš„æ—¶é—´ï¼Œå•çœ‹è¿™ä¸ªè·¯ç”±çš„æ—¶é—´å¤æ‚åº¦ï¼š æœ€å¥½æ˜¯ç¬¬ä¸€æ¬¡å°±æ‰¾åˆ°ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚ æœ€å·®ä¸ºéå†å®Œæ•°ç»„åæ‰æ‰¾åˆ°ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(N)ã€‚ ç†è®ºè®²å®Œäº†æ¥çœ‹çœ‹å…·ä½“å®è·µã€‚ æˆ‘è‡ªå®šä¹‰äº†ä¸€ä¸ªç±»ï¼šSortArrayMap ä»–çš„ä½¿ç”¨æ–¹æ³•åŠç»“æœå¦‚ä¸‹ï¼š å¯è§æœ€ç»ˆä¼šæŒ‰ç…§ key çš„å¤§å°è¿›è¡Œæ’åºï¼ŒåŒæ—¶ä¼ å…¥ hashcode = 101 æ—¶ä¼šæŒ‰ç…§é¡ºæ—¶é’ˆæ‰¾åˆ° hashcode = 1000 è¿™ä¸ªèŠ‚ç‚¹è¿›è¡Œè¿”å›ã€‚ ä¸‹é¢æ¥çœ‹çœ‹å…·ä½“çš„å®ç°ã€‚ æˆå‘˜å˜é‡å’Œæ„é€ å‡½æ•°å¦‚ä¸‹ï¼š å…¶ä¸­æœ€æ ¸å¿ƒçš„å°±æ˜¯ä¸€ä¸ª Node æ•°ç»„ï¼Œç”¨å®ƒæ¥å­˜æ”¾æœåŠ¡èŠ‚ç‚¹çš„ hashcode ä»¥åŠ value å€¼ã€‚ å…¶ä¸­çš„å†…éƒ¨ç±» Node ç»“æ„å¦‚ä¸‹ï¼š å†™å…¥æ•°æ®çš„æ–¹æ³•å¦‚ä¸‹ï¼š ç›¸ä¿¡çœ‹è¿‡ ArrayList çš„æºç åº”è¯¥æœ‰å°è±¡ï¼Œè¿™é‡Œçš„å†™å…¥é€»è¾‘å’Œå®ƒå¾ˆåƒã€‚ å†™å…¥ä¹‹å‰åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œå¦‚æœéœ€è¦åˆ™å¤åˆ¶åŸæ¥å¤§å°çš„ 1.5 å€æ•°ç»„æ¥å­˜æ”¾æ•°æ®ã€‚ ä¹‹åå°±å†™å…¥æ•°ç»„ï¼ŒåŒæ—¶æ•°ç»„å¤§å° +1ã€‚ ä½†æ˜¯å­˜æ”¾æ—¶æ˜¯æŒ‰ç…§å†™å…¥é¡ºåºå­˜æ”¾çš„ï¼Œéå†æ—¶è‡ªç„¶ä¸ä¼šæœ‰åºï¼›å› æ­¤æä¾›äº†ä¸€ä¸ª Sort æ–¹æ³•ï¼Œå¯ä»¥æŠŠå…¶ä¸­çš„æ•°æ®æŒ‰ç…§ key å…¶å®ä¹Ÿå°±æ˜¯ hashcode è¿›è¡Œæ’åºã€‚ æ’åºä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨äº† Arrays è¿™ä¸ªæ•°ç»„å·¥å…·è¿›è¡Œæ’åºï¼Œå®ƒå…¶å®æ˜¯ä½¿ç”¨äº†ä¸€ä¸ª TimSort çš„æ’åºç®—æ³•ï¼Œæ•ˆç‡è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ã€‚ æœ€ååˆ™éœ€è¦æŒ‰ç…§ä¸€è‡´æ€§ Hash çš„æ ‡å‡†é¡ºæ—¶é’ˆæŸ¥æ‰¾å¯¹åº”çš„èŠ‚ç‚¹ï¼š ä»£ç è¿˜æ˜¯æ¯”è¾ƒç®€å•æ¸…æ™°çš„ï¼›éå†æ•°ç»„å¦‚æœæ‰¾åˆ°æ¯”å½“å‰ key å¤§çš„å°±è¿”å›ï¼Œæ²¡æœ‰æŸ¥åˆ°å°±å–ç¬¬ä¸€ä¸ªã€‚ è¿™æ ·å°±åŸºæœ¬å®ç°äº†ä¸€è‡´æ€§ Hash çš„è¦æ±‚ã€‚ ps:è¿™é‡Œå¹¶ä¸åŒ…å«å…·ä½“çš„ hash æ–¹æ³•ä»¥åŠè™šæ‹ŸèŠ‚ç‚¹ç­‰åŠŸèƒ½ï¼ˆå…·ä½“å®ç°è¯·çœ‹ä¸‹æ–‡ï¼‰ï¼Œè¿™ä¸ªå¯ä»¥ç”±ä½¿ç”¨è€…æ¥å®šï¼ŒSortArrayMap å¯ä½œä¸ºä¸€ä¸ªåº•å±‚çš„æ•°æ®ç»“æ„ï¼Œæä¾›æœ‰åº Map çš„èƒ½åŠ›ï¼Œä½¿ç”¨åœºæ™¯ä¹Ÿä¸å±€é™äºä¸€è‡´æ€§ Hash ç®—æ³•ä¸­ã€‚ TreeMap å®ç°SortArrayMap è™½è¯´æ˜¯å®ç°äº†ä¸€è‡´æ€§ hash çš„åŠŸèƒ½ï¼Œä½†æ•ˆç‡è¿˜ä¸å¤Ÿé«˜ï¼Œä¸»è¦ä½“ç°åœ¨ sort æ’åºå¤„ã€‚ ä¸‹å›¾æ˜¯ç›®å‰ä¸»æµæ’åºç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ï¼š æœ€å¥½çš„ä¹Ÿå°±æ˜¯ O(N) äº†ã€‚ è¿™é‡Œå®Œå…¨å¯ä»¥æ¢ä¸€ä¸ªæ€è·¯ï¼Œä¸ç”¨å¯¹æ•°æ®è¿›è¡Œæ’åºï¼›è€Œæ˜¯åœ¨å†™å…¥çš„æ—¶å€™å°±æ’å¥½é¡ºåºï¼Œåªæ˜¯è¿™æ ·ä¼šé™ä½å†™å…¥çš„æ•ˆç‡ã€‚ æ¯”å¦‚äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œè¿™æ ·çš„æ•°æ®ç»“æ„ jdk é‡Œæœ‰ç°æˆçš„å®ç°ï¼›æ¯”å¦‚ TreeMap å°±æ˜¯ä½¿ç”¨çº¢é»‘æ ‘æ¥å®ç°çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒä¼šå¯¹ key è¿›è¡Œè‡ªç„¶æ’åºã€‚ æ¥çœ‹çœ‹ä½¿ç”¨ TreeMap å¦‚ä½•æ¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚è¿è¡Œç»“æœï¼š 1127.0.0.1000 æ•ˆæœå’Œä¸Šæ–‡ä½¿ç”¨ SortArrayMap æ˜¯ä¸€è‡´çš„ã€‚ åªä½¿ç”¨äº† TreeMap çš„ä¸€äº› APIï¼š å†™å…¥æ•°æ®å€™ï¼ŒTreeMap å¯ä»¥ä¿è¯ key çš„è‡ªç„¶æ’åºã€‚ tailMap å¯ä»¥è·å–æ¯”å½“å‰ key å¤§çš„éƒ¨åˆ†æ•°æ®ã€‚ å½“è¿™ä¸ªæ–¹æ³•æœ‰æ•°æ®è¿”å›æ—¶å–ç¬¬ä¸€ä¸ªå°±æ˜¯é¡ºæ—¶é’ˆä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹äº†ã€‚ å¦‚æœæ²¡æœ‰è¿”å›é‚£å°±ç›´æ¥å–æ•´ä¸ª Map çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒåŒæ ·ä¹Ÿå®ç°äº†ç¯å½¢ç»“æ„ã€‚ ps:è¿™é‡ŒåŒæ ·ä¹Ÿæ²¡æœ‰ hash æ–¹æ³•ä»¥åŠè™šæ‹ŸèŠ‚ç‚¹ï¼ˆå…·ä½“å®ç°è¯·çœ‹ä¸‹æ–‡ï¼‰ï¼Œå› ä¸º TreeMap å’Œ SortArrayMap ä¸€æ ·éƒ½æ˜¯ä½œä¸ºåŸºç¡€æ•°æ®ç»“æ„æ¥ä½¿ç”¨çš„ã€‚ æ€§èƒ½å¯¹æ¯”ä¸ºäº†æ–¹ä¾¿å¤§å®¶é€‰æ‹©å“ªä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œæˆ‘ç”¨ TreeMap å’Œ SortArrayMap åˆ†åˆ«å†™å…¥äº†ä¸€ç™¾ä¸‡æ¡æ•°æ®æ¥å¯¹æ¯”ã€‚ å…ˆæ˜¯ SortArrayMapï¼š è€—æ—¶ 2237 æ¯«ç§’ã€‚ TreeMapï¼š è€—æ—¶ 1316æ¯«ç§’ã€‚ ç»“æœæ˜¯å¿«äº†å°†è¿‘ä¸€å€ï¼Œæ‰€ä»¥è¿˜æ˜¯æ¨èä½¿ç”¨ TreeMap æ¥è¿›è¡Œå®ç°ï¼Œæ¯•ç«Ÿå®ƒä¸éœ€è¦é¢å¤–çš„æ’åºæŸè€—ã€‚ cim ä¸­çš„å®é™…åº”ç”¨ä¸‹é¢æ¥çœ‹çœ‹åœ¨ cim è¿™ä¸ªåº”ç”¨ä¸­æ˜¯å¦‚ä½•å…·ä½“ä½¿ç”¨çš„ï¼Œå…¶ä¸­ä¹ŸåŒ…æ‹¬ä¸Šæ–‡æåˆ°çš„è™šæ‹ŸèŠ‚ç‚¹ä»¥åŠ hash ç®—æ³•ã€‚ æ¨¡æ¿æ–¹æ³•åœ¨åº”ç”¨çš„æ—¶å€™è€ƒè™‘åˆ°å°±ç®—æ˜¯ä¸€è‡´æ€§ hash ç®—æ³•éƒ½æœ‰å¤šç§å®ç°ï¼Œä¸ºäº†æ–¹ä¾¿å…¶ä½¿ç”¨è€…æ‰©å±•è‡ªå·±çš„ä¸€è‡´æ€§ hash ç®—æ³•å› æ­¤æˆ‘å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡ç±»ï¼›å…¶ä¸­å®šä¹‰äº†ä¸€äº›æ¨¡æ¿æ–¹æ³•ï¼Œè¿™æ ·å¤§å®¶åªéœ€è¦åœ¨å­ç±»ä¸­è¿›è¡Œä¸åŒçš„å®ç°å³å¯å®Œæˆè‡ªå·±çš„ç®—æ³•ã€‚ AbstractConsistentHashï¼Œè¿™ä¸ªæŠ½è±¡ç±»çš„ä¸»è¦æ–¹æ³•å¦‚ä¸‹ï¼š add æ–¹æ³•è‡ªç„¶æ˜¯å†™å…¥æ•°æ®çš„ã€‚ sort æ–¹æ³•ç”¨äºæ’åºï¼Œä½†å­ç±»ä¹Ÿä¸ä¸€å®šéœ€è¦é‡å†™ï¼Œæ¯”å¦‚ TreeMap è¿™æ ·è‡ªå¸¦æ’åºçš„å®¹å™¨å°±ä¸ç”¨ã€‚ getFirstNodeValue è·å–èŠ‚ç‚¹ã€‚ process åˆ™æ˜¯é¢å‘å®¢æˆ·ç«¯çš„ï¼Œæœ€ç»ˆåªéœ€è¦è°ƒç”¨è¿™ä¸ªæ–¹æ³•å³å¯è¿”å›ä¸€ä¸ªèŠ‚ç‚¹ã€‚ ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹åˆ©ç”¨ SortArrayMap ä»¥åŠ AbstractConsistentHash æ˜¯å¦‚ä½•å®ç°çš„ã€‚ å°±æ˜¯å®ç°äº†å‡ ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œé€»è¾‘å’Œä¸Šæ–‡æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æŠ½å–åˆ°äº†ä¸åŒçš„æ–¹æ³•ä¸­ã€‚ åªæ˜¯åœ¨ add æ–¹æ³•ä¸­æ–°å¢äº†å‡ ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œç›¸ä¿¡å¤§å®¶ä¹Ÿçœ‹å¾—æ˜ç™½ã€‚ æŠŠè™šæ‹ŸèŠ‚ç‚¹çš„æ§åˆ¶æ”¾åˆ°å­ç±»è€Œæ²¡æœ‰æ”¾åˆ°æŠ½è±¡ç±»ä¸­ä¹Ÿæ˜¯ä¸ºäº†çµæ´»æ€§è€ƒè™‘ï¼Œå¯èƒ½ä¸åŒçš„å®ç°å¯¹è™šæ‹ŸèŠ‚ç‚¹çš„æ•°é‡è¦æ±‚ä¹Ÿä¸ä¸€æ ·ï¼Œæ‰€ä»¥ä¸å¦‚è‡ªå®šä¹‰çš„å¥½ã€‚ ä½†æ˜¯ hash æ–¹æ³•ç¡®æ˜¯æ”¾åˆ°äº†æŠ½è±¡ç±»ä¸­ï¼Œå­ç±»ä¸ç”¨é‡å†™ï¼›å› ä¸ºè¿™æ˜¯ä¸€ä¸ªåŸºæœ¬åŠŸèƒ½ï¼Œåªéœ€è¦æœ‰ä¸€ä¸ªå…¬å…±ç®—æ³•å¯ä»¥ä¿è¯ä»–æ•£åˆ—åœ°è¶³å¤Ÿå‡åŒ€å³å¯ã€‚ å› æ­¤åœ¨ AbstractConsistentHash ä¸­å®šä¹‰äº† hash æ–¹æ³•ã€‚ è¿™é‡Œçš„ç®—æ³•æ‘˜æŠ„è‡ª xxl_jobï¼Œç½‘ä¸Šä¹Ÿæœ‰å…¶ä»–ä¸åŒçš„å®ç°ï¼Œæ¯”å¦‚ FNV1_32_HASH ç­‰ï¼›å®ç°ä¸åŒä½†æ˜¯ç›®çš„éƒ½ä¸€æ ·ã€‚ è¿™æ ·å¯¹äºä½¿ç”¨è€…æ¥è¯´å°±éå¸¸ç®€å•äº†ï¼š ä»–åªéœ€è¦æ„å»ºä¸€ä¸ªæœåŠ¡åˆ—è¡¨ï¼Œç„¶åæŠŠå½“å‰çš„å®¢æˆ·ç«¯ä¿¡æ¯ä¼ å…¥ process æ–¹æ³•ä¸­å³å¯è·å¾—ä¸€ä¸ªä¸€è‡´æ€§ hash ç®—æ³•çš„è¿”å›ã€‚ åŒæ ·çš„å¯¹äºæƒ³é€šè¿‡ TreeMap æ¥å®ç°ä¹Ÿæ˜¯ä¸€æ ·çš„å¥—è·¯ï¼š ä»–è¿™é‡Œä¸éœ€è¦é‡å†™ sort æ–¹æ³•ï¼Œå› ä¸ºè‡ªèº«å†™å…¥æ—¶å·²ç»æ’å¥½åºäº†ã€‚ è€Œåœ¨ä½¿ç”¨æ—¶å¯¹äºå®¢æˆ·ç«¯æ¥è¯´åªéœ€æ±‚ä¿®æ”¹ä¸€ä¸ªå®ç°ç±»ï¼Œå…¶ä»–çš„å•¥éƒ½ä¸ç”¨æ”¹å°±å¯ä»¥äº†ã€‚ è¿è¡Œçš„æ•ˆæœä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ è¿™æ ·å¤§å®¶æƒ³è‡ªå®šä¹‰è‡ªå·±çš„ç®—æ³•æ—¶åªéœ€è¦ç»§æ‰¿ AbstractConsistentHash é‡å†™ç›¸å…³æ–¹æ³•å³å¯ï¼Œå®¢æˆ·ç«¯ä»£ç æ— é¡»æ”¹åŠ¨ã€‚ è·¯ç”±ç®—æ³•æ‰©å±•æ€§ä½†å…¶å®å¯¹äº cim æ¥è¯´çœŸæ­£çš„æ‰©å±•æ€§æ˜¯å¯¹è·¯ç”±ç®—æ³•æ¥è¯´çš„ï¼Œæ¯”å¦‚å®ƒéœ€è¦æ”¯æŒè½®è¯¢ã€hashã€ä¸€è‡´æ€§hashã€éšæœºã€LRUç­‰ã€‚ åªæ˜¯ä¸€è‡´æ€§ hash ä¹Ÿæœ‰å¤šç§å®ç°ï¼Œä»–ä»¬çš„å…³ç³»å°±å¦‚ä¸‹å›¾ï¼š åº”ç”¨è¿˜éœ€è¦æ»¡è¶³å¯¹è¿™ä¸€ç±»è·¯ç”±ç­–ç•¥çš„çµæ´»æ”¯æŒï¼Œæ¯”å¦‚æˆ‘ä¹Ÿæƒ³è‡ªå®šä¹‰ä¸€ä¸ªéšæœºçš„ç­–ç•¥ã€‚ å› æ­¤å®šä¹‰äº†ä¸€ä¸ªæ¥å£ï¼šRouteHandle 12345678910public interface RouteHandle &#123; /** * å†ä¸€æ‰¹æœåŠ¡å™¨é‡Œè¿›è¡Œè·¯ç”± * @param values * @param key * @return */ String routeServer(List&lt;String&gt; values,String key) ;&#125; å…¶ä¸­åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è·¯ç”±æ–¹æ³•ï¼›å…¥å‚åˆ†åˆ«æ˜¯æœåŠ¡åˆ—è¡¨ä»¥åŠå®¢æˆ·ç«¯ä¿¡æ¯å³å¯ã€‚ è€Œå¯¹äºä¸€è‡´æ€§ hash ç®—æ³•æ¥è¯´ä¹Ÿæ˜¯åªéœ€è¦å®ç°è¿™ä¸ªæ¥å£ï¼ŒåŒæ—¶åœ¨è¿™ä¸ªæ¥å£ä¸­é€‰æ‹©ä½¿ç”¨ SortArrayMapConsistentHash è¿˜æ˜¯ TreeMapConsistentHash å³å¯ã€‚ è¿™é‡Œè¿˜æœ‰ä¸€ä¸ª setHash çš„æ–¹æ³•ï¼Œå…¥å‚æ˜¯ AbstractConsistentHashï¼›è¿™å°±æ˜¯ç”¨äºå®¢æˆ·ç«¯æŒ‡å®šéœ€è¦ä½¿ç”¨å…·ä½“çš„é‚£ç§æ•°æ®ç»“æ„ã€‚ è€Œå¯¹äºä¹‹å‰å°±å­˜åœ¨çš„è½®è¯¢ç­–ç•¥æ¥è¯´ä¹Ÿæ˜¯åŒæ ·çš„å®ç° RouteHandle æ¥å£ã€‚ è¿™é‡Œæˆ‘åªæ˜¯æŠŠä¹‹å‰çš„ä»£ç æ¬è¿‡æ¥äº†è€Œå·²ã€‚ æ¥ä¸‹æ¥çœ‹çœ‹å®¢æˆ·ç«¯åˆ°åº•æ˜¯å¦‚ä½•ä½¿ç”¨ä»¥åŠå¦‚ä½•é€‰æ‹©ä½¿ç”¨å“ªç§ç®—æ³•ã€‚ ä¸ºäº†ä½¿å®¢æˆ·ç«¯ä»£ç å‡ ä¹ä¸åŠ¨ï¼Œæˆ‘å°†è¿™ä¸ªé€‰æ‹©çš„è¿‡ç¨‹æ”¾å…¥äº†é…ç½®æ–‡ä»¶ã€‚ å¦‚æœæƒ³ä½¿ç”¨åŸæœ‰çš„è½®è¯¢ç­–ç•¥ï¼Œå°±é…ç½®å®ç°äº† RouteHandle æ¥å£çš„è½®è¯¢ç­–ç•¥çš„å…¨é™å®šåã€‚ å¦‚æœæƒ³ä½¿ç”¨ä¸€è‡´æ€§ hash çš„ç­–ç•¥ï¼Œä¹Ÿåªéœ€è¦é…ç½®å®ç°äº† RouteHandle æ¥å£çš„ä¸€è‡´æ€§ hash ç®—æ³•çš„å…¨é™å®šåã€‚ å½“ç„¶ç›®å‰çš„ä¸€è‡´æ€§ hash ä¹Ÿæœ‰å¤šç§å®ç°ï¼Œæ‰€ä»¥ä¸€æ—¦é…ç½®ä¸ºä¸€è‡´æ€§ hash åå°±éœ€è¦å†åŠ ä¸€ä¸ªé…ç½®ç”¨äºå†³å®šä½¿ç”¨ SortArrayMapConsistentHash è¿˜æ˜¯ TreeMapConsistentHash æˆ–æ˜¯è‡ªå®šä¹‰çš„å…¶ä»–æ–¹æ¡ˆã€‚ åŒæ ·çš„ä¹Ÿæ˜¯éœ€è¦é…ç½®ç»§æ‰¿äº† AbstractConsistentHash çš„å…¨é™å®šåã€‚ ä¸ç®¡è¿™é‡Œçš„ç­–ç•¥å¦‚ä½•æ”¹å˜ï¼Œåœ¨ä½¿ç”¨å¤„ä¾ç„¶ä¿æŒä¸å˜ã€‚ åªéœ€è¦æ³¨å…¥ RouteHandleï¼Œè°ƒç”¨å®ƒçš„ routeServer æ–¹æ³•ã€‚ 123@Autowiredprivate RouteHandle routeHandle ;String server = routeHandle.routeServer(serverCache.getAll(),String.valueOf(loginReqVO.getUserId())); æ—¢ç„¶ä½¿ç”¨äº†æ³¨å…¥ï¼Œé‚£å…¶å®è¿™ä¸ªç­–ç•¥åˆ‡æ¢çš„è¿‡ç¨‹å°±åœ¨åˆ›å»º RouteHandle bean çš„æ—¶å€™å®Œæˆçš„ã€‚ ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œéœ€è¦è¯»å–ä¹‹å‰çš„é…ç½®æ–‡ä»¶æ¥åŠ¨æ€ç”Ÿæˆå…·ä½“çš„å®ç°ç±»ï¼Œä¸»è¦æ˜¯åˆ©ç”¨åå°„å®Œæˆçš„ã€‚ è¿™æ ·å¤„ç†ä¹‹åå°±æ¯”è¾ƒçµæ´»äº†ï¼Œæ¯”å¦‚æƒ³æ–°å»ºä¸€ä¸ªéšæœºçš„è·¯ç”±ç­–ç•¥ä¹Ÿæ˜¯åŒæ ·çš„å¥—è·¯ï¼›åˆ°æ—¶å€™åªéœ€è¦ä¿®æ”¹é…ç½®å³å¯ã€‚ æ„Ÿå…´è¶£çš„æœ‹å‹ä¹Ÿå¯æäº¤ PR æ¥æ–°å¢æ›´å¤šçš„è·¯ç”±ç­–ç•¥ã€‚ æ€»ç»“å¸Œæœ›çœ‹åˆ°è¿™é‡Œçš„æœ‹å‹èƒ½å¯¹è¿™ä¸ªç®—æ³•æœ‰æ‰€ç†è§£ï¼ŒåŒæ—¶å¯¹ä¸€äº›è®¾è®¡æ¨¡å¼åœ¨å®é™…çš„ä½¿ç”¨ä¹Ÿèƒ½æœ‰æ‰€å¸®åŠ©ã€‚ ç›¸ä¿¡åœ¨é‡‘ä¸‰é“¶å››çš„é¢è¯•è¿‡ç¨‹ä¸­è¿˜æ˜¯èƒ½è®©é¢è¯•å®˜çœ¼å‰ä¸€äº®çš„ï¼Œæ¯•ç«Ÿæ ¹æ®æˆ‘è¿™æ®µæ—¶é—´çš„é¢è¯•è¿‡ç¨‹æ¥çœ‹å¬è¿‡è¿™ä¸ªåè¯çš„éƒ½åœ¨å°‘æ•°ğŸ˜‚ï¼ˆå¯èƒ½ä¹Ÿæ˜¯å’Œå€™é€‰äººéƒ½åœ¨ 1~3 å¹´è¿™ä¸ªå±‚çº§æœ‰å…³ï¼‰ã€‚ ä»¥ä¸Šæ‰€æœ‰æºç ï¼š https://github.com/crossoverJie/cim å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰æ‰€å¸®åŠ©è¿˜è¯·ä¸åè½¬å‘ã€‚]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[VLOG-004ï¼šå›½äº§ç¨‹åºå‘˜çš„ä¸€å¤©]]></title>
    <url>%2F2019%2F02%2F20%2Fvlog%2FChinese-coder-daily%2F</url>
    <content type="text"><![CDATA[VLOG è¿‘äº›å¹´éå¸¸æµè¡Œï¼Œæœ€è¿‘è¿™æ®µæ—¶é—´æˆ‘ä¹Ÿæ‹äº†ä¸€äº›æ¥è®°å½•ç”Ÿæ´»ã€‚ ä¹‹å‰ä¸€ç›´æƒ³è®°å½•è‡ªå·±ä¸Šç­ç”Ÿæ´»çš„ä¸€å¤©ï¼›è‡³äºä¸ºä»€ä¹ˆæ ‡é¢˜è¦åŠ ä¸Šä¸€ä¸ªå›½äº§ä¸¤å­—ï¼Œæ˜¯å› ä¸ºä¹‹å‰çœ‹åˆ°ä¸€ä½å›½å¤–å¥³ç¨‹åºåª›çš„ä¸€å¤©ï¼ˆè§†é¢‘é“¾æ¥è§åº•éƒ¨ï¼‰ï¼Œè¿™æ¬¡æ˜¯æƒ³è®©å¤§å®¶çœ‹çœ‹åœ¨å¤©æœå›½æƒ…ä¸‹çš„åå·®ã€‚ a day in the life of a software engineer:https://www.youtube.com/watch?v=rqX8PFcOpxA æ­£ç‰‡å¼€å§‹ 08:00 èµ·åºŠæ´—æ¼±ã€‚ 8:20 å‡ºé—¨åˆ°è½»è½¨ç«™ã€‚ 8:30 åˆ°è¾¾è½»è½¨ç«™ã€‚ 9:00 åˆ°è¾¾å…¬å¸å¼€å§‹å¹²æ´»ã€‚ 10:00 ä¸€ä¸ªç”µè¯è¿œç¨‹é¢è¯•ã€‚ 11:00 ä¸€ä¸ªç”µè¯è¿œç¨‹é¢è¯•ã€‚ ä¸­é—´æœ‰ä¸€æ®µå¯¹è‡ªå·±è¿™äº›å¤©æ¥é¢è¯•ç»å†çš„ä¸€äº›åˆ†äº«ï¼Œè§†é¢‘åŠ å¿«äº†ä½†æ˜¯é‡ç‚¹å†…å®¹éƒ½æ‰“æœ‰å­—å¹•ã€‚ 12:00 åˆé¥­æ—¶é—´ã€‚ 15:00 éƒ¨é—¨å†…éƒ¨ä¼šè®®åˆ° 16 ç‚¹ã€‚ 17:00 ä¸€ä¸ªç”µè¯è¿œç¨‹é¢è¯•ã€‚ 19:00 æœ‰æ—¶é—´åšè‡ªå·±çš„æ’¸ç å·¥ä½œã€‚ 20:00 å‡†å¤‡å›å®¶ã€‚ 22:00 æ¥å¥³æœ‹å‹ä¸‹ç­ã€‚ 00:30 å®Œæˆä¸€ä¸ªç®—æ³•ï¼Œæ”¶å·¥ç¡è§‰ã€‚ ä¸‹ä¸€æ¬¡å½•å·¥ä½œ VLOG åº”è¯¥æ˜¯ç­‰æˆ‘å½“è€æ¿å’¯ï¼Œå¸Œæœ›åˆ«æ˜¯æœ‰ç”Ÿä¹‹å¹´ç³»åˆ—ã€‚ã€‚ã€‚]]></content>
      <categories>
        <category>VLOG</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åˆ©ç”¨ç­–ç•¥æ¨¡å¼ä¼˜åŒ–è¿‡å¤š if else ä»£ç ]]></title>
    <url>%2F2019%2F01%2F30%2Fjava-senior%2Fdesign-if-else%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¸å‡ºæ„å¤–ï¼Œè¿™åº”è¯¥æ˜¯å¹´å‰æœ€åä¸€æ¬¡åˆ†äº«ï¼Œæœ¬æ¬¡æ¥ä¸€ç‚¹å®é™…å¼€å‘ä¸­ä¼šç”¨åˆ°çš„å°æŠ€å·§ã€‚ æ¯”å¦‚å¹³æ—¶å¤§å®¶æ˜¯å¦éƒ½ä¼šå†™ç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼š 123456789if(a)&#123; //dosomething&#125;else if(b)&#123; //doshomething&#125;else if(c)&#123; //doshomething&#125; else&#123; ////doshomething&#125; æ¡ä»¶å°‘è¿˜å¥½ï¼Œä¸€æ—¦ else if è¿‡å¤šè¿™é‡Œçš„é€»è¾‘å°†ä¼šæ¯”è¾ƒæ··ä¹±ï¼Œå¹¶å¾ˆå®¹æ˜“å‡ºé”™ã€‚ æ¯”å¦‚è¿™æ ·ï¼š æ‘˜è‡ª cim ä¸­çš„ä¸€ä¸ªå®¢æˆ·ç«¯å‘½ä»¤çš„åˆ¤æ–­æ¡ä»¶ã€‚ åˆšå¼€å§‹æ¡ä»¶è¾ƒå°‘ï¼Œä¹Ÿå°±æ²¡ç®¡é‚£ä¹ˆå¤šç›´æ¥å†™çš„ï¼›ç°åœ¨åŠŸèƒ½å¤šäº†å¯¼è‡´æ¯æ¬¡æ–°å¢ä¸€ä¸ª else æ¡ä»¶æˆ‘éƒ½å¾—ä»”ç»†æ ¸å¯¹ï¼Œç”Ÿæ€•å½±å“ä¹‹å‰çš„é€»è¾‘ã€‚ è¿™æ¬¡ç»ˆäºå¿æ— å¯å¿å°±æŠŠä»–é‡æ„äº†ï¼Œé‡æ„ä¹‹åè¿™é‡Œçš„ç»“æ„å¦‚ä¸‹ï¼š æœ€åç›´æ¥å˜ä¸ºä¸¤è¡Œä»£ç ï¼Œç®€æ´äº†è®¸å¤šã€‚ è€Œä¹‹å‰æ‰€æœ‰çš„å®ç°é€»è¾‘éƒ½å•ç‹¬æŠ½å–åˆ°å…¶ä»–å®ç°ç±»ä¸­ã€‚ è¿™æ ·æ¯å½“æˆ‘éœ€è¦æ–°å¢ä¸€ä¸ª else é€»è¾‘ï¼Œåªéœ€è¦æ–°å¢ä¸€ä¸ªç±»å®ç°åŒä¸€ä¸ªæ¥å£ä¾¿å¯å®Œæˆã€‚æ¯ä¸ªå¤„ç†é€»è¾‘éƒ½äº’ç›¸ç‹¬ç«‹äº’ä¸å¹²æ‰°ã€‚ å®ç° æŒ‰ç…§ç›®å‰çš„å®ç°ç”»äº†ä¸€ä¸ªè‰å›¾ã€‚ æ•´ä½“æ€è·¯å¦‚ä¸‹ï¼š å®šä¹‰ä¸€ä¸ª InnerCommand æ¥å£ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª process å‡½æ•°äº¤ç»™å…·ä½“çš„ä¸šåŠ¡å®ç°ã€‚ æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡ï¼Œä¼šæœ‰å¤šä¸ªç±»å®ç° InnerCommand æ¥å£ï¼›è¿™äº›å®ç°ç±»éƒ½ä¼šæ³¨å†Œåˆ° Spring Bean å®¹å™¨ä¸­ä¾›ä¹‹åä½¿ç”¨ã€‚ é€šè¿‡å®¢æˆ·ç«¯è¾“å…¥å‘½ä»¤ï¼Œä» Spring Bean å®¹å™¨ä¸­è·å–ä¸€ä¸ª InnerCommand å®ä¾‹ã€‚ æ‰§è¡Œæœ€ç»ˆçš„ process å‡½æ•°ã€‚ ä¸»è¦æƒ³å®ç°çš„ç›®çš„å°±æ˜¯ä¸åœ¨æœ‰å¤šä¸ªåˆ¤æ–­æ¡ä»¶ï¼Œåªéœ€è¦æ ¹æ®å½“å‰å®¢æˆ·ç«¯çš„çŠ¶æ€åŠ¨æ€çš„è·å– InnerCommand å®ä¾‹ã€‚ ä»æºç ä¸Šæ¥çœ‹æœ€ä¸»è¦çš„å°±æ˜¯ InnerCommandContext ç±»ï¼Œä»–ä¼šæ ¹æ®å½“å‰å®¢æˆ·ç«¯å‘½ä»¤åŠ¨æ€è·å– InnerCommand å®ä¾‹ã€‚ ç¬¬ä¸€æ­¥æ˜¯è·å–æ‰€æœ‰çš„ InnerCommand å®ä¾‹åˆ—è¡¨ã€‚ æ ¹æ®å®¢æˆ·ç«¯è¾“å…¥çš„å‘½ä»¤ä»ç¬¬ä¸€æ­¥çš„å®ä¾‹åˆ—è¡¨ä¸­è·å–ç±»ç±»å‹ã€‚ æ ¹æ®ç±»ç±»å‹ä» Spring å®¹å™¨ä¸­è·å–å…·ä½“å®ä¾‹å¯¹è±¡ã€‚ å› æ­¤é¦–å…ˆç¬¬ä¸€æ­¥éœ€è¦ç»´æŠ¤å„ä¸ªå‘½ä»¤æ‰€å¯¹åº”çš„ç±»ç±»å‹ã€‚ æ‰€ä»¥åœ¨ä¹‹å‰çš„æšä¸¾ä¸­å°±ç»´æŠ¤äº†å‘½ä»¤å’Œç±»ç±»å‹çš„å…³ç³»ï¼Œåªéœ€è¦çŸ¥é“å‘½ä»¤å°±èƒ½çŸ¥é“ä»–çš„ç±»ç±»å‹ã€‚ è¿™æ ·æ‰èƒ½æ»¡è¶³åªéœ€è¦ä¸¤è¡Œä»£ç å°±èƒ½æ›¿æ¢ä»¥å‰å¤æ‚çš„ if elseï¼ŒåŒæ—¶ä¹Ÿèƒ½çµæ´»æ‰©å±•ã€‚ 12InnerCommand instance = innerCommandContext.getInstance(msg);instance.process(msg) ; æ€»ç»“å½“ç„¶è¿˜å¯ä»¥åšçš„æ›´çµæ´»ä¸€äº›ï¼Œæ¯”å¦‚éƒ½ä¸éœ€è¦æ˜¾å¼çš„ç»´æŠ¤å‘½ä»¤å’Œç±»ç±»å‹çš„å¯¹åº”å…³ç³»ã€‚ åªéœ€è¦åœ¨åº”ç”¨å¯åŠ¨æ—¶æ‰«ææ‰€æœ‰å®ç°äº† InnerCommand æ¥å£çš„ç±»å³å¯ï¼Œåœ¨ cicada ä¸­æœ‰ç±»ä¼¼å®ç°ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹ã€‚ è¿™æ ·ä¸€äº›å°æŠ€å·§å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚ ä»¥ä¸Šæ‰€æœ‰æºç å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹ï¼š https://github.com/crossoverJie/cim ä½ çš„ç‚¹èµä¸åˆ†äº«æ˜¯å¯¹æˆ‘æœ€å¤§çš„æ”¯æŒ]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç­–ç•¥æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é•¿è¿æ¥çš„å¿ƒè·³åŠé‡è¿è®¾è®¡]]></title>
    <url>%2F2019%2F01%2F23%2Fnetty%2Fcim03-heartbeat%2F</url>
    <content type="text"><![CDATA[å‰è¨€è¯´é“â€œå¿ƒè·³â€è¿™ä¸ªè¯å¤§å®¶éƒ½ä¸é™Œç”Ÿï¼Œå½“ç„¶ä¸æ˜¯æŒ‡ç”·å¥³ä¹‹é—´çš„å¿ƒè·³ï¼Œè€Œæ˜¯å’Œé•¿è¿æ¥ç›¸å…³çš„ã€‚ é¡¾åæ€ä¹‰å°±æ˜¯è¯æ˜æ˜¯å¦è¿˜æ´»ç€çš„ä¾æ®ã€‚ ä»€ä¹ˆåœºæ™¯ä¸‹éœ€è¦å¿ƒè·³å‘¢ï¼Ÿ ç›®å‰æˆ‘ä»¬æ¥è§¦åˆ°çš„å¤§å¤šæ˜¯ä¸€äº›åŸºäºé•¿è¿æ¥çš„åº”ç”¨éœ€è¦å¿ƒè·³æ¥â€œä¿æ´»â€ã€‚ ç”±äºåœ¨é•¿è¿æ¥çš„åœºæ™¯ä¸‹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¹¶ä¸æ˜¯ä¸€ç›´å¤„äºé€šä¿¡çŠ¶æ€ï¼Œå¦‚æœåŒæ–¹é•¿æœŸæ²¡æœ‰æ²Ÿé€šåˆ™åŒæ–¹éƒ½ä¸æ¸…æ¥šå¯¹æ–¹ç›®å‰çš„çŠ¶æ€ï¼›æ‰€ä»¥éœ€è¦å‘é€ä¸€æ®µå¾ˆå°çš„æŠ¥æ–‡å‘Šè¯‰å¯¹æ–¹â€œæˆ‘è¿˜æ´»ç€â€ã€‚ åŒæ—¶è¿˜æœ‰å¦å¤–å‡ ä¸ªç›®çš„ï¼š æœåŠ¡ç«¯æ£€æµ‹åˆ°æŸä¸ªå®¢æˆ·ç«¯è¿Ÿè¿Ÿæ²¡æœ‰å¿ƒè·³è¿‡æ¥å¯ä»¥ä¸»åŠ¨å…³é—­é€šé“ï¼Œè®©å®ƒä¸‹çº¿ã€‚ å®¢æˆ·ç«¯æ£€æµ‹åˆ°æŸä¸ªæœåŠ¡ç«¯è¿Ÿè¿Ÿæ²¡æœ‰å“åº”å¿ƒè·³ä¹Ÿèƒ½é‡è¿è·å–ä¸€ä¸ªæ–°çš„è¿æ¥ã€‚ æ­£å¥½å€Ÿç€åœ¨ cimæœ‰è¿™æ ·ä¸¤ä¸ªéœ€æ±‚æ¥èŠä¸€èŠã€‚ å¿ƒè·³å®ç°æ–¹å¼å¿ƒè·³å…¶å®æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š TCP åè®®å®ç°ï¼ˆkeepalive æœºåˆ¶ï¼‰ã€‚ åº”ç”¨å±‚è‡ªå·±å®ç°ã€‚ ç”±äº TCP åè®®è¿‡äºåº•å±‚ï¼Œå¯¹äºå¼€å‘è€…æ¥è¯´ç»´æŠ¤æ€§ã€çµæ´»åº¦éƒ½æ¯”è¾ƒå·®åŒæ—¶è¿˜ä¾èµ–äºæ“ä½œç³»ç»Ÿã€‚ æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œæ‰€è®¨è®ºçš„éƒ½æ˜¯åº”ç”¨å±‚çš„å®ç°ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨åº”ç”¨å±‚é€šå¸¸æ˜¯ç”±å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªå¿ƒè·³åŒ… ping åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°åå“åº”ä¸€ä¸ª pong è¡¨æ˜åŒæ–¹éƒ½æ´»å¾—å¥½å¥½çš„ã€‚ ä¸€æ—¦å…¶ä¸­ä¸€ç«¯å»¶è¿Ÿ N ä¸ªæ—¶é—´çª—å£æ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯åˆ™è¿›è¡Œä¸åŒçš„å¤„ç†ã€‚ å®¢æˆ·ç«¯è‡ªåŠ¨é‡è¿å…ˆæ‹¿å®¢æˆ·ç«¯æ¥è¯´å§ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªå¿ƒè·³åŒ…ï¼ŒåŒæ—¶æ”¶åˆ°æœåŠ¡ç«¯çš„å“åº”ã€‚ å¸¸è§„çš„å®ç°åº”å½“æ˜¯ï¼š å¼€å¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå®šæœŸå‘é€å¿ƒè·³åŒ…ã€‚ æ”¶åˆ°æœåŠ¡ç«¯å“åº”åæ›´æ–°æœ¬åœ°æ—¶é—´ã€‚ å†æœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡å®šæœŸæ£€æµ‹è¿™ä¸ªâ€œæœ¬åœ°æ—¶é—´â€æ˜¯å¦è¶…è¿‡é˜ˆå€¼ã€‚ è¶…è¿‡ååˆ™è®¤ä¸ºæœåŠ¡ç«¯å‡ºç°æ•…éšœï¼Œéœ€è¦é‡è¿ã€‚ è¿™æ ·ç¡®å®ä¹Ÿèƒ½å®ç°å¿ƒè·³ï¼Œä½†å¹¶ä¸å‹å¥½ã€‚ åœ¨æ­£å¸¸çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é€šä¿¡çš„æƒ…å†µä¸‹ï¼Œå®šæ—¶ä»»åŠ¡ä¾ç„¶ä¼šå‘é€å¿ƒè·³åŒ…ï¼›è¿™æ ·å°±æ˜¾å¾—æ²¡æœ‰æ„ä¹‰ï¼Œæœ‰äº›å¤šä½™ã€‚ æ‰€ä»¥ç†æƒ³çš„æƒ…å†µåº”å½“æ˜¯å®¢æˆ·ç«¯æ”¶åˆ°çš„å†™æ¶ˆæ¯ç©ºé—²æ—¶æ‰å‘é€è¿™ä¸ªå¿ƒè·³åŒ…å»ç¡®è®¤æœåŠ¡ç«¯æ˜¯å¦å¥åœ¨ã€‚ å¥½æ¶ˆæ¯æ˜¯ Netty å·²ç»ä¸ºæˆ‘ä»¬è€ƒè™‘åˆ°äº†è¿™ç‚¹ï¼Œè‡ªå¸¦äº†ä¸€ä¸ªå¼€ç®±å³ç”¨çš„ IdleStateHandler ä¸“é—¨ç”¨äºå¿ƒè·³å¤„ç†ã€‚ æ¥çœ‹çœ‹ cim ä¸­çš„å®ç°ï¼š åœ¨ pipeline ä¸­åŠ å…¥äº†ä¸€ä¸ª 10ç§’æ²¡æœ‰æ”¶åˆ°å†™æ¶ˆæ¯çš„ IdleStateHandlerï¼Œåˆ°æ—¶ä»–ä¼šå›è°ƒ ChannelInboundHandler ä¸­çš„ userEventTriggered æ–¹æ³•ã€‚ æ‰€ä»¥ä¸€æ—¦å†™è¶…æ—¶å°±ç«‹é©¬å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªå¿ƒè·³ï¼ˆåšçš„æ›´å®Œå–„åº”å½“åœ¨å¿ƒè·³å‘é€å¤±è´¥åæœ‰ä¸€å®šçš„é‡è¯•æ¬¡æ•°ï¼‰ï¼› è¿™æ ·ä¹Ÿå°±åªæœ‰åœ¨ç©ºé—²æ—¶å€™æ‰ä¼šå‘é€å¿ƒè·³åŒ…ã€‚ ä½†ä¸€æ—¦é—´éš”è®¸ä¹…æ²¡æœ‰æ”¶åˆ°æœåŠ¡ç«¯å“åº”è¿›è¡Œé‡è¿çš„é€»è¾‘åº”å½“å†™åœ¨å“ªé‡Œå‘¢ï¼Ÿ å…ˆæ¥çœ‹è¿™ä¸ªç¤ºä¾‹ï¼š å½“æ”¶åˆ°æœåŠ¡ç«¯å“åº”çš„ pong æ¶ˆæ¯æ—¶ï¼Œå°±åœ¨å½“å‰ Channel ä¸Šè®°å½•ä¸€ä¸ªæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¯´åç»­å¯ä»¥åœ¨å®šæ—¶ä»»åŠ¡ä¸­å–å‡ºè¿™ä¸ªæ—¶é—´å’Œå½“å‰æ—¶é—´çš„å·®é¢æ¥åˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜ˆå€¼ã€‚ è¶…è¿‡åˆ™é‡è¿ã€‚ åŒæ—¶åœ¨æ¯æ¬¡å¿ƒè·³æ—¶å€™éƒ½ç”¨å½“å‰æ—¶é—´å’Œä¹‹å‰æœåŠ¡ç«¯å“åº”ç»‘å®šåˆ° Channel ä¸Šçš„æ—¶é—´ç›¸å‡åˆ¤æ–­æ˜¯å¦éœ€è¦é‡è¿å³å¯ã€‚ ä¹Ÿå°±æ˜¯ heartBeatHandler.process(ctx); çš„æ‰§è¡Œé€»è¾‘ã€‚ ä¼ªä»£ç å¦‚ä¸‹ï¼š 123456789101112@Overridepublic void process(ChannelHandlerContext ctx) throws Exception &#123; long heartBeatTime = appConfiguration.getHeartBeatTime() * 1000; Long lastReadTime = NettyAttrUtil.getReaderTime(ctx.channel()); long now = System.currentTimeMillis(); if (lastReadTime != null &amp;&amp; now - lastReadTime &gt; heartBeatTime)&#123; reconnect(); &#125;&#125; IdleStateHandler è¯¯åŒºä¸€åˆ‡çœ‹èµ·æ¥ä¹Ÿæ²¡æ¯›ç—…ï¼Œä½†å®é™…ä¸Šå´æ²¡æœ‰è¿™æ ·å®ç°é‡è¿é€»è¾‘ã€‚ æœ€ä¸»è¦çš„é—®é¢˜è¿˜æ˜¯å¯¹ IdleStateHandler ç†è§£æœ‰è¯¯ã€‚ æˆ‘ä»¬å‡è®¾ä¸‹é¢çš„åœºæ™¯ï¼š å®¢æˆ·ç«¯é€šè¿‡ç™»å½•è¿ä¸Šäº†æœåŠ¡ç«¯å¹¶ä¿æŒé•¿è¿æ¥ï¼Œä¸€åˆ‡æ­£å¸¸çš„æƒ…å†µä¸‹åŒæ–¹å„å‘å¿ƒè·³åŒ…ä¿æŒè¿æ¥ã€‚ è¿™æ—¶æœåŠ¡ç«¯çªå…¥å‡ºç° down æœºï¼Œé‚£ä¹ˆç†æƒ³æƒ…å†µä¸‹åº”å½“æ˜¯å®¢æˆ·ç«¯è¿Ÿè¿Ÿæ²¡æœ‰æ”¶åˆ°æœåŠ¡ç«¯çš„å“åº”ä»è€Œ userEventTriggered æ‰§è¡Œå®šæ—¶ä»»åŠ¡ã€‚ åˆ¤æ–­å½“å‰æ—¶é—´ - UpdateWriteTime &gt; é˜ˆå€¼ æ—¶è¿›è¡Œé‡è¿ã€‚ ä½†å´äº‹ä¸æ„¿è¿ï¼Œå¹¶ä¸ä¼šæ‰§è¡Œ 2ã€3ä¸¤æ­¥ã€‚ å› ä¸ºä¸€æ—¦æœåŠ¡ç«¯ down æœºã€æˆ–è€…æ˜¯ä¸å®¢æˆ·ç«¯çš„ç½‘ç»œæ–­å¼€åˆ™ä¼šå›è°ƒå®¢æˆ·ç«¯çš„ channelInactive äº‹ä»¶ã€‚ IdleStateHandler ä½œä¸ºä¸€ä¸ª ChannelInbound ä¹Ÿé‡å†™äº† channelInactive() æ–¹æ³•ã€‚ è¿™é‡Œçš„ destroy() æ–¹æ³•ä¼šæŠŠä¹‹å‰å¼€å¯çš„å®šæ—¶ä»»åŠ¡éƒ½ç»™å–æ¶ˆæ‰ã€‚ æ‰€ä»¥å°±ä¸ä¼šå†æœ‰ä»»ä½•çš„å®šæ—¶ä»»åŠ¡æ‰§è¡Œäº†ï¼Œä¹Ÿå°±ä¸ä¼šæœ‰æœºä¼šæ‰§è¡Œè¿™ä¸ªé‡è¿ä¸šåŠ¡ã€‚ é è°±å®ç°å› æ­¤æˆ‘ä»¬å¾—æœ‰ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦é‡è¿ï¼Œä¸ä¾èµ–äº IdleStateHandlerã€‚ äºæ˜¯ cim åœ¨å®¢æˆ·ç«¯æ„ŸçŸ¥åˆ°ç½‘ç»œæ–­å¼€æ—¶å°±ä¼šå¼€å¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼š ä¹‹æ‰€ä»¥ä¸åœ¨å®¢æˆ·ç«¯å¯åŠ¨å°±å¼€å¯ï¼Œæ˜¯ä¸ºäº†èŠ‚çœä¸€ç‚¹çº¿ç¨‹æ¶ˆè€—ã€‚ç½‘ç»œé—®é¢˜è™½ç„¶ä¸å¯é¿å…ï¼Œä½†åœ¨éœ€è¦çš„æ—¶å€™å¼€å¯æ›´èƒ½èŠ‚çœèµ„æºã€‚ åœ¨è¿™ä¸ªä»»åŠ¡é‡å…¶å®å°±æ˜¯æ‰§è¡Œäº†é‡è¿ï¼Œé™äºç¯‡å¹…å…·ä½“ä»£ç å°±ä¸è´´äº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ã€‚ åŒæ—¶æ¥éªŒè¯ä¸€ä¸‹æ•ˆæœã€‚ å¯åŠ¨ä¸¤ä¸ªæœåŠ¡ç«¯ï¼Œå†å¯åŠ¨å®¢æˆ·ç«¯è¿æ¥ä¸Šä¸€å°å¹¶ä¿æŒé•¿è¿æ¥ã€‚è¿™æ—¶çªç„¶æ‰‹åŠ¨å…³é—­ä¸€å°æœåŠ¡ï¼Œå®¢æˆ·ç«¯å¯ä»¥è‡ªåŠ¨é‡è¿åˆ°å¯ç”¨çš„é‚£å°æœåŠ¡èŠ‚ç‚¹ã€‚ å¯åŠ¨å®¢æˆ·ç«¯åæœåŠ¡ç«¯ä¹Ÿèƒ½æ”¶åˆ°æ­£å¸¸çš„ ping æ¶ˆæ¯ã€‚ åˆ©ç”¨ :info å‘½ä»¤æŸ¥çœ‹å½“å‰å®¢æˆ·ç«¯çš„é“¾æ¥çŠ¶æ€å‘ç°è¿çš„æ˜¯ 9000ç«¯å£ã€‚ :info æ˜¯ä¸€ä¸ªæ–°å¢å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹ä¸€äº›å®¢æˆ·ç«¯ä¿¡æ¯ã€‚ è¿™æ—¶æˆ‘å…³æ‰è¿æ¥ä¸Šçš„è¿™å°èŠ‚ç‚¹ã€‚ 1kill -9 2142 è¿™æ—¶å®¢æˆ·ç«¯ä¼šè‡ªåŠ¨é‡è¿åˆ°å¯ç”¨çš„é‚£å°èŠ‚ç‚¹ã€‚è¿™ä¸ªèŠ‚ç‚¹ä¹Ÿæ”¶åˆ°äº†ä¸Šçº¿æ—¥å¿—ä»¥åŠå¿ƒè·³åŒ…ã€‚ æœåŠ¡ç«¯è‡ªåŠ¨å‰”é™¤ç¦»çº¿å®¢æˆ·ç«¯ç°åœ¨æ¥çœ‹çœ‹æœåŠ¡ç«¯ï¼Œå®ƒè¦å®ç°çš„æ•ˆæœå°±æ˜¯å»¶è¿Ÿ N ç§’æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„ ping åŒ…åˆ™è®¤ä¸ºå®¢æˆ·ç«¯ä¸‹çº¿äº†ï¼Œåœ¨ cim çš„åœºæ™¯ä¸‹å°±éœ€è¦æŠŠä»–è¸¢æ‰ç½®äºç¦»çº¿çŠ¶æ€ã€‚ æ¶ˆæ¯å‘é€è¯¯åŒºè¿™é‡Œä¾ç„¶æœ‰ä¸€ä¸ªè¯¯åŒºï¼Œåœ¨è°ƒç”¨ ctx.writeAndFlush() å‘é€æ¶ˆæ¯è·å–å›è°ƒæ—¶ã€‚ å…¶ä¸­æ˜¯ isSuccess å¹¶ä¸èƒ½ä½œä¸ºæ¶ˆæ¯å‘é€æˆåŠŸä¸å¦çš„æ ‡å‡†ã€‚ ä¹Ÿå°±æ˜¯è¯´å³ä¾¿æ˜¯å®¢æˆ·ç«¯ç›´æ¥æ–­ç½‘ï¼ŒæœåŠ¡ç«¯è¿™é‡Œå‘é€æ¶ˆæ¯åæ‹¿åˆ°çš„ success ä¾æ—§æ˜¯ trueã€‚ è¿™æ˜¯å› ä¸ºè¿™é‡Œçš„ success åªæ˜¯å‘ŠçŸ¥æˆ‘ä»¬æ¶ˆæ¯å†™å…¥äº† TCP ç¼“å†²åŒºæˆåŠŸäº†è€Œå·²ã€‚ å’Œæˆ‘ä¹‹å‰æœ‰ç€ä¸€æ ·é”™è¯¯ç†è§£çš„ä¸åœ¨å°‘æ•°ï¼Œè¿™æ˜¯ Netty å®˜æ–¹ç»™çš„å›å¤ã€‚ ç›¸å…³ issueï¼š https://github.com/netty/netty/issues/4915 åŒæ—¶æ„Ÿè°¢ 95è€å¾ä»¥åŠé—ªç”µä¾ çš„ä¸€èµ·æ’æŸ¥ã€‚ æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ä¾æ®æ­¤æ¥å…³é—­å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œè€Œæ˜¯è¦åƒä¸Šæ–‡ä¸€æ ·åˆ¤æ–­ Channel ä¸Šç»‘å®šçš„æ—¶é—´ä¸å½“å‰æ—¶é—´åªå·®æ˜¯å¦è¶…è¿‡äº†é˜ˆå€¼ã€‚ ä»¥ä¸Šåˆ™æ˜¯ cim æœåŠ¡ç«¯çš„å®ç°ï¼Œé€»è¾‘å’Œå¼€å¤´è¯´çš„ä¸€è‡´ï¼Œä¹Ÿå’Œ Dubbo çš„å¿ƒè·³æœºåˆ¶æœ‰äº›ç±»ä¼¼ã€‚ äºæ˜¯æ¥åšä¸ªè¯•éªŒï¼šæ­£å¸¸é€šä¿¡çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Œå½“æˆ‘æŠŠå®¢æˆ·ç«¯ç›´æ¥æ–­ç½‘æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šè‡ªåŠ¨å‰”é™¤å®¢æˆ·ç«¯ã€‚ æ€»ç»“è¿™æ ·å°±å®ç°äº†æ–‡åˆçš„ä¸¤ä¸ªè¦æ±‚ã€‚ æœåŠ¡ç«¯æ£€æµ‹åˆ°æŸä¸ªå®¢æˆ·ç«¯è¿Ÿè¿Ÿæ²¡æœ‰å¿ƒè·³è¿‡æ¥å¯ä»¥ä¸»åŠ¨å…³é—­é€šé“ï¼Œè®©å®ƒä¸‹çº¿ã€‚ å®¢æˆ·ç«¯æ£€æµ‹åˆ°æŸä¸ªæœåŠ¡ç«¯è¿Ÿè¿Ÿæ²¡æœ‰å“åº”å¿ƒè·³ä¹Ÿèƒ½é‡è¿è·å–ä¸€ä¸ªæ–°çš„è¿æ¥ã€‚ åŒæ—¶ä¹Ÿè¸©äº†ä¸¤ä¸ªè¯¯åŒºï¼Œå‘ä¸€ä¸ªäººè¸©å°±å¯ä»¥äº†ï¼Œå¸Œæœ›çœ‹è¿‡æœ¬æ–‡çš„éƒ½æœ‰æ‰€æ”¶è·é¿å…è¸©å‘ã€‚ æœ¬æ–‡æ‰€æœ‰ç›¸å…³ä»£ç éƒ½åœ¨æ­¤å¤„ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹ï¼š https://github.com/crossoverJie/cim å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰æ‰€å¸®åŠ©è¿˜è¯·ä¸åè½¬å‘ã€‚]]></content>
      <categories>
        <category>Netty</category>
        <category>cim</category>
      </categories>
      <tags>
        <tag>Heartbeat</tag>
        <tag>IM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸ºè‡ªå·±æ­å»ºä¸€ä¸ªåˆ†å¸ƒå¼ IM ç³»ç»ŸäºŒã€ä»æŸ¥æ‰¾ç®—æ³•èŠèµ·ã€‘]]></title>
    <url>%2F2019%2F01%2F14%2Fnetty%2Fcim02-v1.0.1%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æœ€è¿‘è¿™æ®µæ—¶é—´ç¡®å®æœ‰ç‚¹å¿™ï¼Œè¿™ç¯‡çš„ç›®å½•è¿˜æ˜¯åœ¨é£æœºä¸Šæ•²å‡ºæ¥äº†çš„ã€‚ è¨€å½’æ­£ä¼ ï¼Œä¸Šå‘¨æ›´æ–°äº† cim ç¬¬ä¸€ç‰ˆï¼šä¸ºè‡ªå·±æ­å»ºä¸€ä¸ªåˆ†å¸ƒå¼ IM(å³æ—¶é€šè®¯) ç³»ç»Ÿï¼›æ²¡æƒ³åˆ°åå“çƒ­çƒˆï¼Œæœ€é«˜æ—¶ä¸Šäº† GitHub Trending Java ç‰ˆå—çš„é¦–ä½ï¼Œä¸€å¤©æ”¶åˆ°äº† 300+ çš„ starã€‚ ç°åœ¨æ€»å…±ä¹Ÿæœ‰ 1.3K+ çš„ starï¼Œæœ‰å‡ åä¸ªæœ‹å‹å‚åŠ äº†æµ‹è¯•ï¼Œéå¸¸æ„Ÿè°¢å¤§å®¶çš„æ”¯æŒã€‚ åœ¨è¿™è¿‡ç¨‹ä¸­ä¹Ÿæ”¶åˆ°ä¸€äº› bug åé¦ˆï¼Œfeature å»ºè®®ï¼›å› æ­¤è¿™æ®µæ—¶é—´æˆ‘æŠŠä¸€äº›å½±å“è¾ƒå¤§çš„ bug ä»¥åŠéœ€æ±‚æ¯”è¾ƒè¿«åˆ‡çš„ feature è°ƒæ•´äº†ï¼Œæœ¬æ¬¡æ›´æ–°çš„ v1.0.1 ç‰ˆæœ¬ï¼š å®¢æˆ·ç«¯è¶…æ—¶è‡ªåŠ¨ä¸‹çº¿ã€‚ æ–°å¢ AI æ¨¡å¼ã€‚ èŠå¤©è®°å½•æŸ¥è¯¢ã€‚ åœ¨çº¿ç”¨æˆ·å‰ç¼€æ¨¡ç³ŠåŒ¹é…ã€‚ ä¸‹é¢è°ˆä¸‹å‡ ä¸ªæ¯”è¾ƒé‡ç‚¹çš„åŠŸèƒ½ã€‚ å®¢æˆ·ç«¯è¶…æ—¶è‡ªåŠ¨ä¸‹çº¿ è¿™ä¸ªåŠŸèƒ½æ¶‰åŠåˆ°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„å¿ƒè·³è®¾è®¡ï¼Œæ¯”è¾ƒæœ‰æ„æ€ï¼Œä¹Ÿè¸©äº†å‡ ä¸ªå‘ï¼›æ‰€ä»¥å‡†å¤‡ç•™åˆ°ä¸‹æ¬¡å•ç‹¬æ¥èŠã€‚ AI æ¨¡å¼å¤§å®¶åº”è¯¥è¿˜è®°å¾—è¿™ä¸ªä¹‹å‰åˆ·çˆ†æœ‹å‹åœˆçš„ ä¼°å€¼ä¸¤ä¸ªä¸€ä¸ªäº¿çš„ AI æ ¸å¿ƒä»£ç ã€‚ å’Œæˆ‘è¿™é‡Œçš„åœºæ™¯å†åˆé€‚ä¸è¿‡äº†ã€‚ äºæ˜¯æˆ‘æ–°å¢äº†ä¸€ä¸ªå‘½ä»¤ç”¨äºä¸€é”®å¼€å¯ AI æ¨¡å¼ï¼Œä½¿ç”¨æƒ…å†µå¤§æ¦‚å¦‚ä¸‹ã€‚ æ¬¢è¿å¤§å®¶æ›´æ–°æºç ä½“éªŒï¼Œèèµ„çš„è¯·ç§èŠæˆ‘ğŸ¤£ã€‚ èŠå¤©è®°å½•èŠå¤©è®°å½•ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒè¿«åˆ‡çš„åŠŸèƒ½ã€‚ ä½¿ç”¨å‘½ä»¤ :q å…³é”®å­— å³å¯æŸ¥è¯¢ä¸ä¸ªäººç›¸å…³çš„èŠå¤©è®°å½•ã€‚ è¿™ä¸ªåŠŸèƒ½å…¶å®æ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦åœ¨æ¶ˆæ¯å‘é€åŠæ¥æ”¶æ¶ˆæ¯æ—¶ä¿å­˜å³å¯ã€‚ ä½†è¦è€ƒè™‘çš„ä¸€ç‚¹æ˜¯ï¼Œè¿™ä¸ªä¿å­˜æ¶ˆæ¯æ˜¯ IO æ“ä½œï¼Œä¸å¯é¿å…çš„ä¼šæœ‰è€—æ—¶ï¼›éœ€è¦å°½é‡é¿å…å¯¹æ¶ˆæ¯å‘é€ã€æ¥æ”¶äº§ç”Ÿå½±å“ã€‚ å¼‚æ­¥å†™å…¥æ¶ˆæ¯å› æ­¤æˆ‘æŠŠæ¶ˆæ¯å†™å…¥çš„è¿‡ç¨‹å¼‚æ­¥å®Œæˆï¼Œå¯ä»¥ä¸å½±å“çœŸæ­£çš„ä¸šåŠ¡ã€‚ å®ç°èµ·æ¥ä¹ŸæŒºç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ã€‚ ä¸»çº¿ç¨‹æ”¶åˆ°æ¶ˆæ¯ä¹‹åç›´æ¥å†™å…¥é˜Ÿåˆ—ï¼Œå¦å¤–å†æœ‰ä¸€ä¸ªçº¿ç¨‹ä¸€ç›´æºæºä¸æ–­çš„ä»é˜Ÿåˆ—ä¸­å–å‡ºæ•°æ®åä¿å­˜èŠå¤©è®°å½•ã€‚ å¤§æ¦‚çš„ä»£ç å¦‚ä¸‹ï¼š å†™å…¥æ¶ˆæ¯çš„åŒæ—¶ä¼šæŠŠæ¶ˆè´¹æ¶ˆæ¯çš„çº¿ç¨‹æ‰“å¼€ï¼š è€Œæœ€ç»ˆå­˜æ”¾æ¶ˆæ¯è®°å½•çš„ç­–ç•¥ï¼Œè€ƒè™‘åè¿˜æ˜¯ä»¥æœ€ç®€å•çš„æ–¹å¼å­˜æ”¾åœ¨å®¢æˆ·ç«¯ï¼Œå¯ä»¥é™ä½å¤æ‚åº¦ã€‚ ç®€å•æ¥è¯´å°±æ˜¯æ ¹æ®å½“å‰æ—¥æœŸ+ç”¨æˆ·åå†™å…¥åˆ°ç£ç›˜é‡Œã€‚ å½“å®¢æˆ·ç«¯å…³é—­æ—¶åˆ©ç”¨çº¿ç¨‹ä¸­æ–­çš„æ–¹å¼åœæ­¢äº†æ¶ˆè´¹é˜Ÿåˆ—çš„çº¿ç¨‹ã€‚ è¿™ç‚¹çš„è®¾è®¡å…¶å®å’Œ logback å†™æ—¥å¿—çš„æ–¹å¼æ¯”è¾ƒç±»ä¼¼ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»ç¿»ç¿» logback çš„æºç ï¼Œæ›´åŠ è¯¦ç»†ã€‚ å›è°ƒæ¥å£è‡³äºæ”¶åˆ°å…¶ä»–å®¢æˆ·ç«¯å‘æ¥çš„æ¶ˆæ¯æ—¶åˆ™æ˜¯åˆ©ç”¨ä¹‹å‰é¢„ç•™çš„æ¶ˆæ¯å›è°ƒæ¥å£æ¥å†™å…¥æ—¥å¿—ã€‚ æ”¶åˆ°æ¶ˆæ¯åä¼šæ‰§è¡Œè‡ªå®šä¹‰çš„å›è°ƒæ¥å£ã€‚ äºæ˜¯åœ¨è¿™ä¸ªå›è°ƒæ–¹æ³•ä¸­å®ç°å†™å…¥é€»è¾‘å³å¯ï¼Œå½“åç»­è¿˜æœ‰å…¶ä»–çš„æ¶ˆæ¯å¤„ç†é€»è¾‘æ—¶ä¹Ÿèƒ½åœ¨è¿™é‡Œç›´æ¥æ·»åŠ ã€‚ å½“å¤„ç†é€»è¾‘å¢å¤šæ—¶æœ€å¥½æ˜¯æ”¹ä¸ºè´£ä»»é“¾æ¨¡å¼ï¼Œæ›´åŠ æ¸…æ™°æ˜“ç»´æŠ¤ã€‚ æŸ¥æ‰¾ç®—æ³•æ¥ä¸‹æ¥æ˜¯æœ¬æ–‡ç€é‡è¦è®¨è®ºçš„ä¸€ä¸ªæŸ¥æ‰¾ç®—æ³•ï¼Œå‡†ç¡®çš„è¯´æ˜¯ä¸€ä¸ªå‰ç¼€æ¨¡ç³ŠåŒ¹é…çš„ç®—æ³•ã€‚ å®ç°çš„æ•ˆæœå¦‚ä¸‹ï¼š ä½¿ç”¨å‘½ä»¤ :qu prefix å¯ä»¥æŒ‰ç…§å‰ç¼€çš„æ–¹å¼æœç´¢ç”¨æˆ·ä¿¡æ¯ã€‚ å½“ç„¶åœ¨å‘½ä»¤è¡Œä¸­å…¶å®æ„ä¹‰ä¸å¤§ï¼Œä½†æ˜¯åœ¨ç§»åŠ¨ç«¯ä¸­ç¡®æ˜¯æ¯”è¾ƒæœ‰ç”¨çš„ã€‚ç±»ä¼¼äºå¾®ä¿¡æŒ‰ç…§ç”¨æˆ·ååŒ¹é…ï¼š å› ä¸ºåæœŸæ‰“ç®—å‡ºä¸€ä¸ªç§»åŠ¨ç«¯ APPï¼Œæ‰€ä»¥å°±å…ˆæŠŠè¿™ä¸ªåŠŸèƒ½å®ç°äº†ã€‚ ä»æ•ˆæœä¹Ÿçœ‹å¾—å‡ºæ¥ï¼šå°±æ˜¯æŒ‰ç…§è¾“å…¥çš„å‰ç¼€åŒ¹é…å­—ç¬¦ä¸²ï¼ˆç›®å‰åªæ”¯æŒè‹±æ–‡ï¼‰ã€‚ åœ¨æ²¡æœ‰ä»»ä½•é™åˆ¶çš„æ¡ä»¶ä¸‹æœ€å¿«ã€æœ€ç®€å•çš„å®ç°æ–¹å¼å¯ä»¥ç›´æ¥æŠŠæ‰€æœ‰çš„å­—ç¬¦ä¸²å­˜æ”¾åœ¨ä¸€ä¸ªå®¹å™¨ä¸­ ï¼ˆListã€Setï¼‰ï¼ŒæŸ¥è¯¢æ—¶åˆ™æŒ¨ä¸ªéå†ï¼›åˆ©ç”¨ String.startsWith(&quot;prefix&quot;) è¿›è¡ŒåŒ¹é…ã€‚ ä½†è¿™æ ·ä¼šæœ‰å‡ ä¸ªé—®é¢˜ï¼š å­˜å‚¨èµ„æºæ¯”è¾ƒæµªè´¹ï¼Œä¸ç®¡æ˜¯ list è¿˜æ˜¯ Set éƒ½ä¼šæœ‰é¢å¤–çš„æŸè€—ã€‚ æŸ¥è¯¢æ•ˆç‡è¾ƒä½ï¼Œéœ€è¦éå†é›†åˆåå†éå†å­—ç¬¦ä¸²çš„ char æ•°ç»„ï¼ˆString.startsWith çš„å®ç°æ–¹å¼ï¼‰ã€‚ å­—å…¸æ ‘åŸºäºä»¥ä¸Šçš„é—®é¢˜æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä¸‹ï¼š å‡è®¾æˆ‘éœ€è¦å­˜æ”¾ java,javascript,jsp,php è¿™äº›å­—ç¬¦ä¸²æ—¶åœ¨ ArrayList ä¸­ä¼šæ€ä¹ˆå­˜æ”¾ï¼Ÿ å¾ˆæ˜æ˜¾ï¼Œä¼šæ˜¯è¿™æ ·å®Œæ•´çš„å­˜æ”¾åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼›åŒæ—¶è¿™ä¸ªæ•°ç»„è¿˜å¯èƒ½å­˜åœ¨æµªè´¹ï¼Œæ²¡æœ‰å…¨éƒ¨ä½¿ç”¨å®Œã€‚ ä½†å…¶å®ä»”ç»†è§‚å¯Ÿè¿™äº›æ•°æ®ä¼šå‘ç°æœ‰ä¸€äº›å…±åŒç‰¹ç‚¹ï¼Œæ¯”å¦‚ java,javascript æœ‰å…±åŒçš„å‰ç¼€ java;å’Œ jsp æœ‰å…±åŒçš„å‰ç¼€ jã€‚ é‚£æ˜¯å¦å¯ä»¥æŠŠè¿™äº›å‰ç¼€åˆ©ç”¨èµ·æ¥å‘¢ï¼Ÿè¿™æ ·å°±å¯ä»¥å°‘å­˜å‚¨ä¸€ä»½ã€‚ æ¯”å¦‚å†™å…¥ java,javascript è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ—¶å­˜æ”¾çš„ç»“æ„å¦‚ä¸‹ï¼š å½“å†å­˜å…¥ä¸€ä¸ª jsp æ—¶ï¼š æœ€åå†å­˜å…¥ jsf æ—¶ï¼š ç›¸ä¿¡å¤§å®¶åº”è¯¥å·²ç»çœ‹æ˜ç™½äº†ï¼ŒæŒ‰ç…§è¿™æ ·çš„å­˜å‚¨æ–¹å¼å¯ä»¥èŠ‚çœå¾ˆå¤šå†…å­˜ï¼ŒåŒæ—¶æŸ¥è¯¢æ•ˆç‡ä¹Ÿæ¯”è¾ƒé«˜ã€‚ æ¯”å¦‚æŸ¥è¯¢ä»¥ jav å¼€å¤´çš„æ•°æ®ï¼Œåªéœ€è¦ä»å¤´ç»“ç‚¹ j å¼€å§‹å¾€ä¸‹æŸ¥è¯¢ï¼Œæœ€åä¼šæŸ¥è¯¢åˆ° ava ä»¥åŠ script è¿™ä¸¤ä¸ªä¸ªç»“ç‚¹ï¼Œæ‰€ä»¥æ•´ä¸ªæŸ¥è¯¢è·¯å¾„æ‰€ç»å†çš„å­—ç¬¦æ‹¼èµ·æ¥å°±æ˜¯æŸ¥è¯¢åˆ°çš„ç»“æœjava+javascriptã€‚ å¦‚æœä»¥ b å¼€å¤´è¿›è¡ŒæŸ¥è¯¢ï¼Œé‚£ç¬¬ä¸€æ­¥å°±ä¼šç›´æ¥è¿”å›ï¼Œè¿™æ ·æ¯”åœ¨ list ä¸­çš„æ•ˆç‡é«˜å¾ˆå¤šã€‚ ä½†è¿™ä¸ªå›¾è¿˜ä¸å®Œå–„ï¼Œå› ä¸ºä¸çŸ¥é“æŸ¥è¯¢åˆ°å•¥æ—¶å€™ç®—æ˜¯åŒ¹é…åˆ°äº†ä¸€ä¸ªä¹‹å‰å†™å…¥çš„å­—ç¬¦ä¸²ã€‚ æ¯”å¦‚åœ¨ä¸Šå›¾ä¸­æ€ä¹ˆçŸ¥é“ j+ava æ˜¯ä¸€ä¸ªæˆ‘ä»¬ä¹‹å‰å†™å…¥çš„ java è¿™ä¸ªå­—ç¬¦å‘¢ã€‚ å› æ­¤æˆ‘ä»¬éœ€è¦å¯¹è¿™ç§æ˜¯ä¸€ä¸ªå®Œæ•´å­—ç¬¦ä¸²çš„æ•°æ®æ‰“ä¸Šä¸€ä¸ªæ ‡è®°ï¼š æ¯”å¦‚è¿™æ ·ï¼Œæˆ‘ä»¬å°† avaã€scriptã€pã€f è¿™å‡ ä¸ªèŠ‚ç‚¹éƒ½æ¢ä¸€ä¸ªé¢œè‰²è¡¨ç¤ºã€‚è¡¨æ˜æŸ¥è¯¢åˆ°è¿™ä¸ªå­—ç¬¦æ—¶å°±ç®—æ˜¯åŒ¹é…åˆ°äº†ä¸€ä¸ªç»“æœã€‚ è€ŒæŸ¥åˆ° s è¿™ä¸ªå­—ç¬¦é¢œè‰²ä¸å¯¹ï¼Œä»£è¡¨è¿˜éœ€è¦ç»§ç»­å¾€ä¸‹æŸ¥ã€‚ æ¯”å¦‚è¾“å…¥å…³é”®å­— js è¿›è¡ŒåŒ¹é…æ—¶ï¼Œå½“å®ƒçš„æŸ¥è¯¢è·¯å¾„èµ°åˆ° s è¿™é‡Œæ—¶åˆ¤æ–­åˆ° s çš„é¢œè‰²ä¸å¯¹ï¼Œæ‰€ä»¥ä¸ä¼šæŠŠ js ä½œä¸ºä¸€ä¸ªåŒ¹é…ç»“æœã€‚è€Œæ˜¯ç»§ç»­å¾€ä¸‹æŸ¥ï¼Œå‘ç°æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ pã€f é¢œè‰²éƒ½æ­£ç¡®ï¼Œäºæ˜¯æŠŠæŸ¥è¯¢çš„è·¯å¾„ jsp å’Œ jsf éƒ½ä½œä¸ºä¸€ä¸ªåŒ¹é…ç»“æœã€‚ è€Œåªè¾“å…¥ jï¼Œåˆ™ä¼šæŠŠä¸‹é¢æ‰€æœ‰æœ‰è‰²çš„å­—ç¬¦æ‹¼èµ·æ¥ä½œä¸ºç»“æœé›†åˆã€‚ è¿™å…¶å®å°±ä¸€ä¸ªå…¸å‹çš„å­—å…¸æ ‘ã€‚ å…·ä½“å®ç°ä¸‹é¢åˆ™æ˜¯å…·ä½“çš„ä»£ç å®ç°ï¼Œå…¶å®ç®—æ³•ä¸åƒæ˜¯å®ç°ä¸€ä¸ªä¸šåŠ¡åŠŸèƒ½è¿™æ ·å¥½ç”¨æ–‡å­—åˆ†æï¼›å…·ä½“è¿˜æ˜¯çœ‹æºç å¤šè°ƒè¯•å°±æ˜ç™½äº†ã€‚ è°ˆä¸‹å‡ ä¸ªé‡ç‚¹çš„åœ°æ–¹å§ï¼š å­—å…¸æ ‘çš„èŠ‚ç‚¹å®ç°ï¼Œå…¶ä¸­çš„ isEnd ç›¸å½“äºå›¾ä¸­çš„ä¸Šè‰²ã€‚ åˆ©ç”¨ä¸€ä¸ª Node[] children æ¥å­˜æ”¾å­èŠ‚ç‚¹ã€‚ ä¸ºäº†å¯ä»¥åŒºåˆ†å¤§å°å†™æŸ¥è¯¢ï¼Œæ‰€ä»¥å­èŠ‚ç‚¹çš„é•¿åº¦ç›¸å½“äºæ˜¯ 26*2ã€‚ å†™å…¥æ•°æ® è¿™é‡Œä»¥ä¸€ä¸ªå•æµ‹ä¸ºä¾‹ï¼Œå†™å…¥äº†ä¸‰ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£æœ€ç»ˆå½¢æˆçš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š å›¾ä¸­æœ‰ä¸ä¸Šå›¾æœ‰å‡ ç‚¹ä¸åŒï¼š æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªå­—ç¬¦ï¼Œè¿™æ ·æ ‘çš„é«˜åº¦æœ€é«˜ä¸º52ã€‚ æ¯ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹éƒ½æ˜¯é•¿åº¦ä¸º 52 çš„æ•°ç»„ï¼›æ‰€ä»¥å¯ä»¥åˆ©ç”¨æ•°ç»„çš„ä¸‹æ ‡è¡¨ç¤ºä»–ä»£è¡¨çš„å­—ç¬¦å€¼ã€‚æ¯”å¦‚ 0 å°±æ˜¯å¤§ A,26 åˆ™æ˜¯å° aï¼Œä»¥æ­¤ç±»æ¨ã€‚ æœ‰ç‚¹ç±»ä¼¼äºä¹‹å‰æåˆ°çš„å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå¯ä»¥èŠ‚çœå†…å­˜ã€‚ debug æ—¶ä¹Ÿèƒ½çœ‹å‡ºç¬¦åˆä¸Šå›¾çš„æ•°æ®ç»“æ„ï¼š æ‰€ä»¥çœŸæ­£çš„å†™å…¥æ­¥éª¤å¦‚ä¸‹ï¼š æŠŠå­—ç¬¦ä¸²æ‹†åˆ†ä¸º char æ•°ç»„ï¼Œå¹¶åˆ¤æ–­å¤§å°å†™è®¡ç®—å®ƒæ‰€å­˜æ”¾åœ¨æ•°ç»„ä¸­çš„ä½ç½® indexã€‚ å°†å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ•°ç»„çš„ index å¤„æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹ã€‚ å¦‚æœæ˜¯æœ€åä¸€ä¸ªå­—ç¬¦å°±å°†æ–°å¢çš„èŠ‚ç‚¹ç½®ä¸ºæœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä¸Šæ–‡çš„æ”¹å˜èŠ‚ç‚¹é¢œè‰²ã€‚ æœ€åå°†å½“å‰èŠ‚ç‚¹æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ–¹ä¾¿ç»§ç»­å†™å…¥ã€‚ æŸ¥è¯¢æ€»çš„æ¥è¯´è¦éº»çƒ¦ä¸€äº›ï¼Œå…¶å®å°±æ˜¯å¯¹æ ‘è¿›è¡Œæ·±åº¦éå†ï¼›æœ€ç»ˆçš„æ€æƒ³çœ‹å›¾å°±èƒ½æ˜ç™½ã€‚ æ‰€ä»¥åœ¨ cim ä¸­è¿›è¡Œæ¨¡ç³ŠåŒ¹é…æ—¶å°±ç”¨åˆ°äº†è¿™ä¸ªç»“æ„ã€‚ å­—å…¸æ ‘çš„æºç åœ¨æ­¤å¤„ï¼š https://github.com/crossoverJie/cim/blob/master/cim-common/src/main/java/com/crossoverjie/cim/common/data/construct/TrieTree.java å…¶å®åˆ©ç”¨è¿™ä¸ªç»“æ„è¿˜èƒ½å®ç°åˆ¤æ–­æŸä¸ªå‰ç¼€çš„å•è¯æ˜¯å¦åœ¨æŸå †æ•°æ®é‡Œã€æŸä¸ªå‰ç¼€çš„å•è¯å‡ºç°çš„æ¬¡æ•°ç­‰ã€‚ æ€»ç»“ç›®å‰ cim è¿˜åœ¨ç«çƒ­å†…æµ‹ä¸­ï¼ˆè™½ç„¶ç¾¤é‡Œåªæœ‰20å‡ äººï¼‰,æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ç§èŠæˆ‘æ‹‰ä½ å…¥ä¼™â˜ºï¸ å†æ²¡æœ‰æ–°çš„ BUG äº§ç”Ÿå‰ä¼šç€é‡æŠŠè¿™äº›åŠŸèƒ½å®Œæˆäº†ï¼Œä¸å‡ºæ„å¤–ä¸‹å‘¨æ›´æ–° cim çš„å¿ƒè·³é‡è¿ç­‰æœºåˆ¶ã€‚ å®Œæ•´æºç ï¼š https://github.com/crossoverJie/cim å¦‚æœè¿™ç¯‡å¯¹ä½ æœ‰æ‰€å¸®åŠ©è¿˜è¯·ä¸åè½¬å‘ã€‚]]></content>
      <categories>
        <category>Netty</category>
        <category>cim</category>
      </categories>
      <tags>
        <tag>IM</tag>
        <tag>TrieTree</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸ºè‡ªå·±æ­å»ºä¸€ä¸ªåˆ†å¸ƒå¼ IM(å³æ—¶é€šè®¯) ç³»ç»Ÿ]]></title>
    <url>%2F2019%2F01%2F02%2Fnetty%2Fcim01-started%2F</url>
    <content type="text"><![CDATA[å‰è¨€å¤§å®¶æ–°å¹´å¿«ä¹ï¼ æ–°çš„ä¸€å¹´ç¬¬ä¸€ç¯‡æŠ€æœ¯æ–‡ç« å¸Œæœ›å¼€ä¸ªå¥½å¤´ï¼Œæ‰€ä»¥å…ƒæ—¦ä¸‰å¤©æˆ‘ä¹Ÿæ²¡æ€ä¹ˆé—²ç€ï¼Œå¸Œæœ›ç»™å¤§å®¶å¸¦æ¥ä¸€ç¯‡æ¯”è¾ƒæ„Ÿå…´è¶£çš„å¹²è´§å†…å®¹ã€‚ è€è¯»è€…åº”è¯¥è¿˜è®°å¾—æˆ‘åœ¨å»å¹´å›½åº†èŠ‚å‰åˆ†äº«è¿‡ä¸€ç¯‡ã€Šè®¾è®¡ä¸€ä¸ªç™¾ä¸‡çº§çš„æ¶ˆæ¯æ¨é€ç³»ç»Ÿã€‹ï¼›è™½ç„¶æˆ‘åœ¨æ–‡ä¸­æœ‰è´´ä¸€äº›ä¼ªä»£ç ï¼Œä¾ç„¶æœ‰äº›æœ‹å‹å¸Œæœ›èƒ½ç›´æ¥åˆ†äº«ä¸€äº›å¯ä»¥è¿è¡Œçš„æºç ï¼›è¿™ä¹ˆä¹…äº†æ˜¯æ—¶å€™æŠŠå‘å¡«ä¸Šäº†ã€‚ æœ¬æ–‡è¾ƒé•¿ï¼Œé«˜èƒ½é¢„è­¦ï¼›å¸¦å¥½ç“œå­æ¿å‡³ã€‚ äºæ˜¯åœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šæˆ‘å®Œå–„äº†ä¸€äº›å†…å®¹ï¼Œå…ˆæ¥çœ‹çœ‹è¿™ä¸ªé¡¹ç›®çš„ä»‹ç»å§ï¼š CIM(CROSS-IM) ä¸€æ¬¾é¢å‘å¼€å‘è€…çš„ IM(å³æ—¶é€šè®¯)ç³»ç»Ÿï¼›åŒæ—¶æä¾›äº†ä¸€äº›ç»„ä»¶å¸®åŠ©å¼€å‘è€…æ„å»ºä¸€æ¬¾å±äºè‡ªå·±å¯æ°´å¹³æ‰©å±•çš„ IM ã€‚ å€ŸåŠ© CIM ä½ å¯ä»¥å®ç°ä»¥ä¸‹éœ€æ±‚ï¼š IM å³æ—¶é€šè®¯ç³»ç»Ÿã€‚ é€‚ç”¨äº APP çš„æ¶ˆæ¯æ¨é€ä¸­é—´ä»¶ã€‚ IOT æµ·é‡è¿æ¥åœºæ™¯ä¸­çš„æ¶ˆæ¯é€ä¼ ä¸­é—´ä»¶ã€‚ å®Œæ•´æºç æ‰˜ç®¡åœ¨ GitHub : https://github.com/crossoverJie/cim æ¼”ç¤ºæœ¬æ¬¡ä¸»è¦æ¶‰åŠåˆ° IM å³æ—¶é€šè®¯ï¼Œæ‰€ä»¥ç‰¹åœ°å½•äº†ä¸¤æ®µè§†é¢‘æ¼”ç¤ºï¼ˆç¾¤èŠã€ç§èŠï¼‰ã€‚ ç‚¹å‡»ä¸‹æ–¹é“¾æ¥å¯ä»¥æŸ¥çœ‹è§†é¢‘ç‰ˆ Demoã€‚ YouTube Bilibili ç¾¤èŠ ç§èŠ ç¾¤èŠ ç§èŠ ä¹Ÿåœ¨å…¬ç½‘éƒ¨ç½²äº†ä¸€å¥—æ¼”ç¤ºç¯å¢ƒï¼Œæƒ³è¦è¯•ä¸€è¯•çš„å¯ä»¥è”ç³»æˆ‘åŠ å…¥å†…æµ‹ç¾¤è·å–è´¦å·ä¸€èµ·å°¬èŠğŸ˜‹ã€‚ æ¶æ„è®¾è®¡ä¸‹é¢æ¥çœ‹çœ‹å…·ä½“çš„æ¶æ„è®¾è®¡ã€‚ CIM ä¸­çš„å„ä¸ªç»„ä»¶å‡é‡‡ç”¨ SpringBoot æ„å»ºã€‚ é‡‡ç”¨ Netty + Google Protocol Buffer æ„å»ºåº•å±‚é€šä¿¡ã€‚ Redis å­˜æ”¾å„ä¸ªå®¢æˆ·ç«¯çš„è·¯ç”±ä¿¡æ¯ã€è´¦å·ä¿¡æ¯ã€åœ¨çº¿çŠ¶æ€ç­‰ã€‚ Zookeeper ç”¨äº IM-server æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ã€‚ æ•´ä½“ä¸»è¦ç”±ä»¥ä¸‹æ¨¡å—ç»„æˆï¼š cim-serverIM æœåŠ¡ç«¯ï¼›ç”¨äºæ¥æ”¶ client è¿æ¥ã€æ¶ˆæ¯é€ä¼ ã€æ¶ˆæ¯æ¨é€ç­‰åŠŸèƒ½ã€‚ æ”¯æŒé›†ç¾¤éƒ¨ç½²ã€‚ cim-forward-routeæ¶ˆæ¯è·¯ç”±æœåŠ¡å™¨ï¼›ç”¨äºå¤„ç†æ¶ˆæ¯è·¯ç”±ã€æ¶ˆæ¯è½¬å‘ã€ç”¨æˆ·ç™»å½•ã€ç”¨æˆ·ä¸‹çº¿ä»¥åŠä¸€äº›è¿è¥å·¥å…·ï¼ˆè·å–åœ¨çº¿ç”¨æˆ·æ•°ç­‰ï¼‰ã€‚ cim-clientIM å®¢æˆ·ç«¯ï¼›ç»™ç”¨æˆ·ä½¿ç”¨çš„æ¶ˆæ¯ç»ˆç«¯ï¼Œä¸€ä¸ªå‘½ä»¤å³å¯å¯åŠ¨å¹¶å‘å…¶ä»–äººå‘èµ·é€šè®¯ï¼ˆç¾¤èŠã€ç§èŠï¼‰ï¼›åŒæ—¶å†…ç½®äº†ä¸€äº›å¸¸ç”¨å‘½ä»¤æ–¹ä¾¿ä½¿ç”¨ã€‚ æµç¨‹å›¾æ•´ä½“çš„æµç¨‹ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæµç¨‹å›¾å¦‚ä¸‹ï¼š å®¢æˆ·ç«¯å‘ route å‘èµ·ç™»å½•ã€‚ ç™»å½•æˆåŠŸä» Zookeeper ä¸­é€‰æ‹©å¯ç”¨ IM-server è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¹¶ä¿å­˜ç™»å½•ã€è·¯ç”±ä¿¡æ¯åˆ° Redisã€‚ å®¢æˆ·ç«¯å‘ IM-server å‘èµ·é•¿è¿æ¥ï¼ŒæˆåŠŸåä¿æŒå¿ƒè·³ã€‚ å®¢æˆ·ç«¯ä¸‹çº¿æ—¶é€šè¿‡ route æ¸…é™¤çŠ¶æ€ä¿¡æ¯ã€‚ æ‰€ä»¥å½“æˆ‘ä»¬è‡ªå·±éƒ¨ç½²æ—¶éœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š æ­å»ºåŸºç¡€ä¸­é—´ä»¶ Redisã€Zookeeperã€‚ éƒ¨ç½² cim-serverï¼Œè¿™æ˜¯çœŸæ­£çš„ IM æœåŠ¡å™¨ï¼Œä¸ºäº†æ»¡è¶³æ€§èƒ½éœ€æ±‚æ‰€ä»¥æ”¯æŒæ°´å¹³æ‰©å±•ï¼Œåªéœ€è¦æ³¨å†Œåˆ°åŒä¸€ä¸ª Zookeeper å³å¯ã€‚ éƒ¨ç½² cim-forward-routeï¼Œè¿™æ˜¯è·¯ç”±æœåŠ¡å™¨ï¼Œæ‰€æœ‰çš„æ¶ˆæ¯éƒ½éœ€è¦ç»è¿‡å®ƒã€‚ç”±äºå®ƒæ˜¯æ— çŠ¶æ€çš„ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥åˆ©ç”¨ Nginx ä»£ç†æé«˜å¯ç”¨æ€§ã€‚ cim-client çœŸæ­£é¢å‘ç”¨æˆ·çš„å®¢æˆ·ç«¯ï¼›å¯åŠ¨ä¹‹åä¼šè‡ªåŠ¨è¿æ¥ IM æœåŠ¡å™¨ä¾¿å¯ä»¥åœ¨æ§åˆ¶å°æ”¶å‘æ¶ˆæ¯äº†ã€‚ æ›´å¤šä½¿ç”¨ä»‹ç»å¯ä»¥å‚è€ƒå¿«é€Ÿå¯åŠ¨ã€‚ è¯¦ç»†è®¾è®¡æ¥ä¸‹æ¥é‡ç‚¹çœ‹çœ‹å…·ä½“çš„å®ç°ï¼Œæ¯”å¦‚ç¾¤èŠã€ç§èŠæ¶ˆæ¯å¦‚ä½•æµè½¬ï¼›IM æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡ï¼›æœåŠ¡å¦‚ä½•æ³¨å†Œå‘ç°ç­‰ç­‰ã€‚ IM æœåŠ¡ç«¯å…ˆæ¥çœ‹çœ‹æœåŠ¡ç«¯ï¼›ä¸»è¦æ˜¯å®ç°å®¢æˆ·ç«¯ä¸Šä¸‹çº¿ã€æ¶ˆæ¯ä¸‹å‘ç­‰åŠŸèƒ½ã€‚ é¦–å…ˆæ˜¯æœåŠ¡å¯åŠ¨ï¼š ç”±äºæ˜¯åœ¨ SpringBoot ä¸­æ­å»ºçš„ï¼Œæ‰€ä»¥åœ¨åº”ç”¨å¯åŠ¨æ—¶éœ€è¦å¯åŠ¨ Netty æœåŠ¡ã€‚ ä» pipline ä¸­å¯ä»¥çœ‹å‡ºä½¿ç”¨äº† Protobuf çš„ç¼–è§£ç ï¼ˆå…·ä½“æŠ¥æ–‡åœ¨å®¢æˆ·ç«¯ä¸­åˆ†æï¼‰ã€‚ æ³¨å†Œå‘ç°éœ€è¦æ»¡è¶³ IM æœåŠ¡ç«¯çš„æ°´å¹³æ‰©å±•éœ€æ±‚ï¼Œæ‰€ä»¥ cim-server æ˜¯éœ€è¦å°†è‡ªèº«æ•°æ®å‘å¸ƒåˆ°æ³¨å†Œä¸­å¿ƒçš„ã€‚ è¿™é‡Œå‚è€ƒä¹‹å‰åˆ†äº«çš„ã€Šæå®šæœåŠ¡æ³¨å†Œä¸å‘ç°ã€‹æœ‰å…·ä½“ä»‹ç»ã€‚ æ‰€ä»¥åœ¨åº”ç”¨å¯åŠ¨æˆåŠŸåéœ€è¦å°†è‡ªèº«æ•°æ®æ³¨å†Œåˆ° Zookeeper ä¸­ã€‚ æœ€ä¸»è¦çš„ç›®çš„å°±æ˜¯å°†å½“å‰åº”ç”¨çš„ ip + cim-server-port+ http-port æ³¨å†Œä¸Šå»ã€‚ ä¸Šå›¾æ˜¯æˆ‘åœ¨æ¼”ç¤ºç¯å¢ƒä¸­æ³¨å†Œçš„ä¸¤ä¸ª cim-server å®ä¾‹ï¼ˆç”±äºåœ¨ä¸€å°æœåŠ¡å™¨ï¼Œæ‰€ä»¥åªæ˜¯ç«¯å£ä¸åŒï¼‰ã€‚ è¿™æ ·åœ¨å®¢æˆ·ç«¯ï¼ˆç›‘å¬è¿™ä¸ª Zookeeper èŠ‚ç‚¹ï¼‰å°±èƒ½å®æ—¶çš„çŸ¥é“ç›®å‰å¯ç”¨çš„æœåŠ¡ä¿¡æ¯ã€‚ ç™»å½•å½“å®¢æˆ·ç«¯è¯·æ±‚ cim-forward-route ä¸­çš„ç™»å½•æ¥å£ï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰åšå®Œä¸šåŠ¡éªŒè¯ï¼ˆå°±ç›¸å½“äºæ—¥å¸¸ç™»å½•å…¶ä»–ç½‘ç«™ä¸€æ ·ï¼‰ä¹‹åï¼Œå®¢æˆ·ç«¯ä¼šå‘æœåŠ¡ç«¯å‘èµ·ä¸€ä¸ªé•¿è¿æ¥ï¼Œå¦‚ä¹‹å‰çš„æµç¨‹æ‰€ç¤ºï¼š è¿™æ—¶å®¢æˆ·ç«¯ä¼šå‘é€ä¸€ä¸ªç‰¹æ®ŠæŠ¥æ–‡ï¼Œè¡¨æ˜å½“å‰æ˜¯ç™»å½•ä¿¡æ¯ã€‚ æœåŠ¡ç«¯æ”¶åˆ°åå°±éœ€è¦å°†è¯¥å®¢æˆ·ç«¯çš„ userID å’Œå½“å‰ Channel é€šé“å…³ç³»ä¿å­˜èµ·æ¥ã€‚ åŒæ—¶ä¹Ÿç¼“å­˜äº†ç”¨æˆ·çš„ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ userID å’Œ ç”¨æˆ·åã€‚ ç¦»çº¿å½“å®¢æˆ·ç«¯æ–­çº¿åä¹Ÿéœ€è¦å°†åˆšæ‰ç¼“å­˜çš„ä¿¡æ¯æ¸…é™¤æ‰ã€‚ åŒæ—¶ä¹Ÿéœ€è¦è°ƒç”¨ route æ¥å£æ¸…é™¤ç›¸å…³ä¿¡æ¯ï¼ˆå…·ä½“æ¥å£çœ‹ä¸‹æ–‡ï¼‰ã€‚ IM è·¯ç”± ä»æ¶æ„å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè·¯ç”±å±‚æ˜¯éå¸¸é‡è¦çš„ä¸€ç¯ï¼›å®ƒæä¾›äº†ä¸€ç³»åˆ—çš„ HTTP æœåŠ¡æ‰¿æ¥äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ã€‚ ç›®å‰ä¸»è¦æ˜¯ä»¥ä¸‹å‡ ä¸ªæ¥å£ã€‚ æ³¨å†Œæ¥å£ ç”±äºæ¯ä¸€ä¸ªå®¢æˆ·ç«¯éƒ½æ˜¯éœ€è¦ç™»å½•æ‰èƒ½ä½¿ç”¨çš„ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥è‡ªç„¶æ˜¯æ³¨å†Œã€‚ è¿™é‡Œå°±è®¾è®¡çš„æ¯”è¾ƒç®€å•ï¼Œç›´æ¥åˆ©ç”¨ Redis æ¥å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼›ç”¨æˆ·ä¿¡æ¯ä¹Ÿåªæœ‰ ID å’Œ userName è€Œå·²ã€‚ åªæ˜¯ä¸ºäº†æ–¹ä¾¿æŸ¥è¯¢åœ¨ Redis ä¸­çš„ KV åˆåè¿‡æ¥å­˜å‚¨äº†ä¸€ä»½ VKï¼Œè¿™æ · ID å’Œ userName éƒ½å¿…é¡»å”¯ä¸€ã€‚ ç™»å½•æ¥å£è¿™é‡Œçš„ç™»å½•å’Œ cim-server ä¸­çš„ç™»å½•ä¸ä¸€æ ·ï¼Œå…·æœ‰ä¸šåŠ¡æ€§è´¨ï¼Œ ç™»å½•æˆåŠŸä¹‹åéœ€è¦åˆ¤æ–­æ˜¯å¦æ˜¯é‡å¤ç™»å½•ï¼ˆä¸€ä¸ªç”¨æˆ·åªèƒ½è¿è¡Œä¸€ä¸ªå®¢æˆ·ç«¯ï¼‰ã€‚ ç™»å½•æˆåŠŸåéœ€è¦ä» Zookeeper ä¸­è·å–æœåŠ¡åˆ—è¡¨ï¼ˆcim-serverï¼‰å¹¶æ ¹æ®æŸç§ç®—æ³•é€‰æ‹©ä¸€å°æœåŠ¡è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ ç™»å½•æˆåŠŸä¹‹åè¿˜éœ€è¦ä¿å­˜è·¯ç”±ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯å½“å‰ç”¨æˆ·åˆ†é…çš„æœåŠ¡å®ä¾‹ä¿å­˜åˆ° Redis ä¸­ã€‚ ä¸ºäº†å®ç°åªèƒ½ä¸€ä¸ªç”¨æˆ·ç™»å½•ï¼Œä½¿ç”¨äº† Redis ä¸­çš„ set æ¥ä¿å­˜ç™»å½•ä¿¡æ¯ï¼›åˆ©ç”¨ userID ä½œä¸º key ï¼Œé‡å¤çš„ç™»å½•å°±ä¼šå†™å…¥å¤±è´¥ã€‚ ç±»ä¼¼äº Java ä¸­çš„ HashSetï¼Œåªèƒ½å»é‡ä¿å­˜ã€‚ è·å–ä¸€å°å¯ç”¨çš„è·¯ç”±å®ä¾‹ä¹Ÿæ¯”è¾ƒç®€å•ï¼š å…ˆä» Zookeeper è·å–æ‰€æœ‰çš„æœåŠ¡å®ä¾‹åšä¸€ä¸ªå†…éƒ¨ç¼“å­˜ã€‚ è½®è¯¢é€‰æ‹©ä¸€å°æœåŠ¡å™¨ï¼ˆç›®å‰åªæœ‰è¿™ä¸€ç§ç®—æ³•ï¼Œåç»­ä¼šæ–°å¢ï¼‰ã€‚ å½“ç„¶è¦è·å– Zookeeper ä¸­çš„æœåŠ¡å®ä¾‹å‰è‡ªç„¶æ˜¯éœ€è¦ç›‘å¬ cim-server ä¹‹å‰æ³¨å†Œä¸Šå»çš„é‚£ä¸ªèŠ‚ç‚¹ã€‚ å…·ä½“ä»£ç å¦‚ä¸‹ï¼š ä¹Ÿæ˜¯åœ¨åº”ç”¨å¯åŠ¨ä¹‹åç›‘å¬ Zookeeper ä¸­çš„è·¯ç”±èŠ‚ç‚¹ï¼Œä¸€æ—¦å‘ç”Ÿå˜åŒ–å°±ä¼šæ›´æ–°å†…éƒ¨ç¼“å­˜ã€‚ è¿™é‡Œä½¿ç”¨çš„æ˜¯ Guava çš„ cacheï¼Œå®ƒåŸºäº ConcurrentHashMapï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯æ¸…é™¤ã€æ–°å¢ç¼“å­˜çš„åŸå­æ€§ã€‚ ç¾¤èŠæ¥å£è¿™æ˜¯ä¸€ä¸ªçœŸæ­£å‘æ¶ˆæ¯çš„æ¥å£ï¼Œå®ç°çš„æ•ˆæœå°±æ˜¯å…¶ä¸­ä¸€ä¸ªå®¢æˆ·ç«¯å‘æ¶ˆæ¯ï¼Œå…¶ä½™æ‰€æœ‰å®¢æˆ·ç«¯éƒ½èƒ½æ”¶åˆ°ï¼ æµç¨‹è‚¯å®šæ˜¯å®¢æˆ·ç«¯å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°ååœ¨ä¸Šæ–‡ä»‹ç»çš„ SessionSocketHolder ä¸­éå†æ‰€æœ‰ Channelï¼ˆé€šé“ï¼‰ç„¶åä¸‹å‘æ¶ˆæ¯å³å¯ã€‚ æœåŠ¡ç«¯æ˜¯å•æœºå€’ä¹Ÿå¯ä»¥ï¼Œä½†ç°åœ¨æ˜¯é›†ç¾¤è®¾è®¡ã€‚æ‰€ä»¥æ‰€æœ‰çš„å®¢æˆ·ç«¯ä¼šæ ¹æ®ä¹‹å‰çš„è½®è¯¢ç®—æ³•åˆ†é…åˆ°ä¸åŒçš„ cim-server å®ä¾‹ä¸­ã€‚ å› æ­¤å°±éœ€è¦è·¯ç”±å±‚æ¥å‘æŒ¥ä½œç”¨äº†ã€‚ è·¯ç”±æ¥å£æ”¶åˆ°æ¶ˆæ¯åé¦–å…ˆéå†å‡ºæ‰€æœ‰çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å®ä¾‹çš„å…³ç³»ã€‚ è·¯ç”±å…³ç³»åœ¨ Redis ä¸­çš„å­˜æ”¾å¦‚ä¸‹ï¼š ç”±äº Redis å•çº¿ç¨‹çš„ç‰¹è´¨ï¼Œå½“æ•°æ®é‡å¤§æ—¶ï¼›ä¸€æ—¦ä½¿ç”¨ keys åŒ¹é…æ‰€æœ‰ cim-route:* æ•°æ®ï¼Œä¼šå¯¼è‡´ Redis ä¸èƒ½å¤„ç†å…¶ä»–è¯·æ±‚ã€‚ æ‰€ä»¥è¿™é‡Œæ”¹ä¸ºä½¿ç”¨ scan å‘½ä»¤æ¥éå†æ‰€æœ‰çš„ cim-route:*ã€‚ æ¥ç€ä¼šæŒ¨ä¸ªè°ƒç”¨æ¯ä¸ªå®¢æˆ·ç«¯æ‰€åœ¨çš„æœåŠ¡ç«¯çš„ HTTP æ¥å£ç”¨äºæ¨é€æ¶ˆæ¯ã€‚ åœ¨ cim-server ä¸­çš„å®ç°å¦‚ä¸‹ï¼š cim-server æ”¶åˆ°æ¶ˆæ¯åä¼šåœ¨å†…éƒ¨ç¼“å­˜ä¸­æŸ¥è¯¢è¯¥ userID çš„é€šé“ï¼Œæ¥ç€åªéœ€è¦å‘æ¶ˆæ¯å³å¯ã€‚ åœ¨çº¿ç”¨æˆ·æ¥å£è¿™æ˜¯ä¸€ä¸ªè¾…åŠ©æ¥å£ï¼Œå¯ä»¥æŸ¥è¯¢å‡ºå½“å‰åœ¨çº¿ç”¨æˆ·ä¿¡æ¯ã€‚ å®ç°ä¹Ÿå¾ˆç®€å•ï¼Œä¹Ÿå°±æ˜¯æŸ¥è¯¢ä¹‹å‰ä¿å­˜ â€ç”¨æˆ·ç™»å½•çŠ¶æ€çš„é‚£ä¸ªå»é‡ set â€œå³å¯ã€‚ ç§èŠæ¥å£ä¹‹æ‰€ä»¥è¯´è·å–åœ¨çº¿ç”¨æˆ·æ˜¯ä¸€ä¸ªè¾…åŠ©æ¥å£ï¼Œå…¶å®å°±æ˜¯ç”¨äºè¾…åŠ©ç§èŠä½¿ç”¨çš„ã€‚ ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨ç§èŠçš„å‰æè‚¯å®šå¾—çŸ¥é“å½“å‰å“ªäº›ç”¨æˆ·åœ¨çº¿ï¼Œæ¥ç€ä½ æ‰ä¼šçŸ¥é“ä½ è¦å’Œè°è¿›è¡Œç§èŠã€‚ ç±»ä¼¼äºè¿™æ ·ï¼š åœ¨æˆ‘ä»¬è¿™ä¸ªåœºæ™¯ä¸­ï¼Œç§èŠçš„å‰æå°±æ˜¯éœ€è¦è·å¾—åœ¨çº¿ç”¨æˆ·çš„ userIDã€‚ æ‰€ä»¥ç§èŠæ¥å£åœ¨æ”¶åˆ°æ¶ˆæ¯åéœ€è¦æŸ¥è¯¢åˆ°æ¥æ”¶è€…æ‰€åœ¨çš„ cim-server å®ä¾‹ä¿¡æ¯ï¼Œåç»­çš„æ­¥éª¤å°±å’Œç¾¤èŠä¸€è‡´äº†ã€‚è°ƒç”¨æ¥æ”¶è€…æ‰€åœ¨å®ä¾‹çš„ HTTP æ¥å£ä¸‹å‘ä¿¡æ¯ã€‚ åªæ˜¯ç¾¤èŠæ˜¯éå†æ‰€æœ‰çš„åœ¨çº¿ç”¨æˆ·ï¼Œç§èŠåªå‘é€ä¸€ä¸ªçš„åŒºåˆ«ã€‚ ä¸‹çº¿æ¥å£ä¸€æ—¦å®¢æˆ·ç«¯ä¸‹çº¿ï¼Œæˆ‘ä»¬å°±éœ€è¦å°†ä¹‹å‰å­˜æ”¾åœ¨ Redis ä¸­çš„ä¸€äº›ä¿¡æ¯åˆ é™¤æ‰ï¼ˆè·¯ç”±ä¿¡æ¯ã€ç™»å½•çŠ¶æ€ï¼‰ã€‚ IM å®¢æˆ·ç«¯å®¢æˆ·ç«¯ä¸­çš„ä¸€äº›é€»è¾‘å…¶å®åœ¨ä¸Šæ–‡å·²ç»è°ˆåˆ°ä¸€äº›äº†ã€‚ ç™»å½•ç¬¬ä¸€æ­¥ä¹Ÿå°±æ˜¯ç™»å½•ï¼Œéœ€è¦åœ¨å¯åŠ¨æ—¶è°ƒç”¨ route çš„ç™»å½•æ¥å£ï¼Œè·å¾— cim-server ä¿¡æ¯å†åˆ›å»ºè¿æ¥ã€‚ ç™»å½•è¿‡ç¨‹ä¸­ route æ¥å£ä¼šåˆ¤æ–­æ˜¯å¦ä¸ºé‡å¤ç™»å½•ï¼Œé‡å¤ç™»å½•åˆ™ä¼šç›´æ¥é€€å‡ºç¨‹åºã€‚ æ¥ä¸‹æ¥æ˜¯åˆ©ç”¨ route æ¥å£è¿”å›çš„ cim-server å®ä¾‹ä¿¡æ¯ï¼ˆip+portï¼‰åˆ›å»ºè¿æ¥ã€‚ æœ€åä¸€æ­¥å°±æ˜¯å‘é€ä¸€ä¸ªç™»å½•æ ‡å¿—çš„ä¿¡æ¯åˆ°æœåŠ¡ç«¯ï¼Œè®©å®ƒä¿æŒå®¢æˆ·ç«¯å’Œ Channel çš„å…³ç³»ã€‚ è‡ªå®šä¹‰åè®®ä¸Šæ–‡æåˆ°çš„ä¸€äº›ç™»å½•æŠ¥æ–‡ã€çœŸæ­£çš„æ¶ˆæ¯æŠ¥æ–‡è¿™äº›å…¶å®éƒ½æ˜¯åœ¨æˆ‘ä»¬è‡ªå®šä¹‰åè®®ä¸­å¯ä»¥åŒºåˆ«å‡ºæ¥çš„ã€‚ ç”±äºæ˜¯ä½¿ç”¨ Google Protocol Buffer ç¼–è§£ç ï¼Œæ‰€ä»¥å…ˆçœ‹çœ‹åŸå§‹æ ¼å¼ã€‚ å…¶å®è¿™ä¸ªåè®®ä¸­ç›®å‰ä¸€å…±å°±ä¸‰ä¸ªå­—æ®µï¼š requestId å¯ä»¥ç†è§£ä¸º userIdã€‚ reqMsg å°±æ˜¯çœŸæ­£çš„æ¶ˆæ¯ã€‚ type ä¹Ÿå°±æ˜¯ä¸Šæ–‡æåˆ°çš„æ¶ˆæ¯ç±»åˆ«ã€‚ ç›®å‰ä¸»è¦æ˜¯ä¸‰ç§ç±»å‹ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒçš„ä¸šåŠ¡ï¼š å¿ƒè·³ä¸ºäº†ä¿æŒå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„è¿æ¥ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´æ²¡æœ‰å‘é€æ¶ˆæ¯éƒ½éœ€è¦è‡ªåŠ¨çš„å‘é€å¿ƒè·³ã€‚ ç›®å‰çš„ç­–ç•¥æ˜¯æ¯éš”ä¸€åˆ†é’Ÿå°±æ˜¯å‘é€ä¸€ä¸ªå¿ƒè·³åŒ…åˆ°æœåŠ¡ç«¯ï¼š è¿™æ ·æœåŠ¡ç«¯æ¯éš”ä¸€åˆ†é’Ÿæ²¡æœ‰æ”¶åˆ°ä¸šåŠ¡æ¶ˆæ¯æ—¶å°±ä¼šæ”¶åˆ° ping çš„å¿ƒè·³åŒ…ï¼š å†…ç½®å‘½ä»¤å®¢æˆ·ç«¯ä¹Ÿå†…ç½®äº†ä¸€äº›åŸºæœ¬å‘½ä»¤æ¥æ–¹ä¾¿ä½¿ç”¨ã€‚ å‘½ä»¤ æè¿° :q é€€å‡ºå®¢æˆ·ç«¯ :olu è·å–æ‰€æœ‰åœ¨çº¿ç”¨æˆ·ä¿¡æ¯ :all è·å–æ‰€æœ‰å‘½ä»¤ : æ›´å¤šå‘½ä»¤æ­£åœ¨å¼€å‘ä¸­ã€‚ã€‚ æ¯”å¦‚è¾“å…¥ :q å°±ä¼šé€€å‡ºå®¢æˆ·ç«¯ï¼ŒåŒæ—¶ä¼šå…³é—­ä¸€äº›ç³»ç»Ÿèµ„æºã€‚ å½“è¾“å…¥ :olu(onlineUser çš„ç®€å†™)å°±ä¼šå»è°ƒç”¨ route çš„è·å–æ‰€æœ‰åœ¨çº¿ç”¨æˆ·æ¥å£ã€‚ ç¾¤èŠç¾¤èŠçš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨æ§åˆ¶å°è¾“å…¥æ¶ˆæ¯å›è½¦å³å¯ã€‚ è¿™æ—¶ä¼šå»è°ƒç”¨ route çš„ç¾¤èŠæ¥å£ã€‚ ç§èŠç§èŠä¹Ÿæ˜¯åŒç†ï¼Œä½†å‰ææ˜¯éœ€è¦è§¦å‘å…³é”®å­—ï¼›ä½¿ç”¨ userId;;æ¶ˆæ¯å†…å®¹ è¿™æ ·çš„æ ¼å¼æ‰ä¼šç»™æŸä¸ªç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œæ‰€ä»¥ä¸€èˆ¬éƒ½éœ€è¦å…ˆä½¿ç”¨ :olu å‘½ä»¤è·å–æ‰€ä»¥åœ¨çº¿ç”¨æˆ·æ‰æ–¹ä¾¿ä½¿ç”¨ã€‚ æ¶ˆæ¯å›è°ƒä¸ºäº†æ»¡è¶³ä¸€äº›å®šåˆ¶éœ€æ±‚ï¼Œæ¯”å¦‚æ¶ˆæ¯éœ€è¦ä¿å­˜ä¹‹ç±»çš„ã€‚ æ‰€ä»¥åœ¨å®¢æˆ·ç«¯æ”¶åˆ°æ¶ˆæ¯ä¹‹åä¼šå›è°ƒä¸€ä¸ªæ¥å£ï¼Œåœ¨è¿™ä¸ªæ¥å£ä¸­å¯ä»¥è‡ªå®šä¹‰å®ç°ã€‚ å› æ­¤å…ˆåˆ›å»ºäº†ä¸€ä¸ª caller çš„ beanï¼Œè¿™ä¸ª bean ä¸­åŒ…å«äº†ä¸€ä¸ª CustomMsgHandleListener æ¥å£ï¼Œéœ€è¦è‡ªè¡Œå¤„ç†åªéœ€è¦å®ç°æ­¤æ¥å£å³å¯ã€‚ è‡ªå®šä¹‰ç•Œé¢ç”±äºæˆ‘è‡ªå·±ä¸æ€ä¹ˆä¼šå†™ç•Œé¢ï¼Œä½†ä¿ä¸å‡†æœ‰å…¶ä»–å¤§ç‰›ä¼šå†™ã€‚æ‰€ä»¥å®¢æˆ·ç«¯ä¸­çš„ç¾¤èŠã€ç§èŠã€è·å–åœ¨çº¿ç”¨æˆ·ã€æ¶ˆæ¯å›è°ƒç­‰ä¸šåŠ¡(ä»¥åŠä¹‹åçš„ä¸šåŠ¡)éƒ½æ˜¯ä»¥æ¥å£å½¢å¼æä¾›ã€‚ ä¹Ÿæ–¹ä¾¿åé¢åšé¡µé¢é›†æˆï¼Œåªéœ€è¦è°ƒè¿™äº›æ¥å£å°±è¡Œäº†ï¼›å…·ä½“å®ç°ä¸ç”¨æ€ä¹ˆå…³å¿ƒã€‚ æ€»ç»“cim ç›®å‰åªæ˜¯ç¬¬ä¸€ç‰ˆï¼ŒBUG å¤šï¼ŒåŠŸèƒ½å°‘ï¼ˆåªæ‹‰äº†å‡ ä¸ªç¾¤å‹åšäº†æµ‹è¯•ï¼‰ï¼›ä¸è¿‡åç»­è¿˜ä¼šæ¥ç€å®Œå–„ï¼Œè‡³å°‘è¿™ä¸€ç‰ˆä¼šç»™é‚£äº›æ²¡æœ‰ç›¸å…³ç»éªŒçš„æœ‹å‹å¸¦æ¥ä¸€äº›æ€è·¯ã€‚ åç»­è®¡åˆ’ï¼š å®Œæ•´æºç ï¼š https://github.com/crossoverJie/cim å¦‚æœè¿™ç¯‡å¯¹ä½ æœ‰æ‰€å¸®åŠ©è¿˜è¯·ä¸åè½¬å‘ã€‚]]></content>
      <categories>
        <category>Netty</category>
        <category>cim</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>Zookeeper</tag>
        <tag>IM</tag>
        <tag>æ¨é€</tag>
        <tag>IOT</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[2018 å¹´åº¦å¤ç›˜]]></title>
    <url>%2F2018%2F12%2F30%2Fannual-summary%2F2018%2F</url>
    <content type="text"><![CDATA[å‰è¨€çœ‹ç€ä»Šå¹´çš„è¿›åº¦è¡¨å·²ç»æ‰€å‰©æ— å‡ ï¼Œæ˜¯æ—¶å€™æ¥å¤ç›˜ä¸€æŠŠäº†ã€‚ ä» 16 å¹´åˆå†™åšå®¢å¼€å§‹åˆ°ç°åœ¨æˆ‘è§‰å¾—å†™å¹´ç»ˆæ€»ç»“çš„ä¹ æƒ¯ä¸é”™ï¼Œæ¯•ç«Ÿæ¯æ¬¡çœ‹ç€å»å¹´çš„ flag åˆå¯ä»¥å¤åˆ¶ç²˜è´´äº†ã€‚ ä»Šå¹´æˆ‘ä¼šä»å·¥ä½œã€æŠ€æœ¯ã€èº«ä½“ç­‰æ–¹é¢å›é¡¾ï¼Œè¿™å‡ å—ä¹Ÿæ˜¯ä»Šå¹´å˜åŒ–æœ€å¤§çš„å‡ ä¸ªç‚¹ã€‚ å·¥ä½œå…ˆè¯´å·¥ä½œå§ï¼Œè¿™ä¸ªå˜åŒ–ä¹Ÿè´¯ç©¿äº†æ•´å¹´ã€‚ ä»ä»Šå¹´å¹´åˆå¼€å§‹ï¼Œæˆ‘ä»ä¸Šä¸€ä¸ªæŠ€æœ¯å›¢é˜Ÿè°ƒåˆ°ç°åœ¨çš„éƒ¨é—¨ï¼›é¦–å…ˆæ˜¯ç»„ç»‡ç»“æ„ä¸Šçš„å˜æ›´ï¼Œå½“ç„¶æ›´ä¸»è¦çš„è¿˜æ˜¯è§’è‰²çš„å˜åŒ–ã€‚ ç”±ä¸€ä¸ªå¼€å‘äººå‘˜è½¬å˜ä¸ºå›¢é˜Ÿçš„æŠ€æœ¯è´Ÿè´£äººï¼Œè¯´å®è¯åˆšå¼€å§‹æ˜¯æªæ‰‹ä¸åŠçš„ã€‚ ä»¥å‰æˆ‘åªéœ€è¦å¯¹æˆ‘å†™çš„ä»£ç è´Ÿè´£ï¼Œç°åœ¨ä¸è¡Œäº†ã€‚å¾—å¯¹æ•´ä¸ªå›¢é˜Ÿçš„äº§å‡ºè´Ÿè´£ï¼›éœ€è¦ä¸ºæ¯ä¸€ä¸ªæˆå‘˜çš„è´¨é‡ã€æˆé•¿è´Ÿè´£ã€‚ è¿™å¯¹äºä¸€ä¸ªåˆšå…¥é—¨çš„èœé¸Ÿæ¥è¯´æŒ‘æˆ˜æ— ç–‘æ˜¯å·¨å¤§çš„ã€‚ è€Œä¸”æ•´ä¸ªç ”å‘å›¢é˜ŸåŸºæœ¬ä¸Šæ˜¯é‡å¤´ç»„å»ºï¼Œæˆ‘è¿™å…¥èŒä¸€å¹´å¤šçš„éƒ½æˆäº†å¸é¾„æœ€å¤§çš„è€å‘˜å·¥äº†ğŸ˜¢ã€‚ éšç€äººå‘˜çš„å¢åŠ ï¼Œå¯¹æˆ‘çš„è¦æ±‚ä¹Ÿè¶Šæ¥è¶Šé«˜ã€‚åœ¨è¯·æ•™äº†è€å¸æœºåä¹Ÿé€æ¸çš„èµ°ä¸Šæ­£è½¨äº†ï¼Œè™½ç„¶ä¸­é—´ä¹Ÿè¸©äº†ä¸å°‘å‘ã€‚ æ€»çš„æ¥è¯´ï¼š ä»¥å‰åªå…³æ³¨æˆ‘ä»£ç å†™çš„ 6 ä¸ 6ï¼›ç°åœ¨é‡ç‚¹æ˜¯æ•´ä¸ªå›¢é˜Ÿçš„ç ”å‘è¿›åº¦ã€è´¨é‡æŠŠæ§ã€‚è¿™ä¸¤ç‚¹æ˜¯è¯„ä¼°æˆ‘å·¥ä½œå¥½åçš„ç›´æ¥å› ç´ ã€‚ è¦æŠŠè¿™ä¸¤é¡¹æå¥½æˆ‘ä¸å¾—ä¸æé«˜ä¸€äº›é€šç”¨æŠ€èƒ½ï¼šåŒ…æ‹¬æ²Ÿé€šåè°ƒã€éœ€æ±‚åˆ¤æ–­ã€æ’æœŸé£é™©ã€äººå‘˜æµåŠ¨ç­‰ã€‚ æ˜å¹´çš„äººæ•°è¿˜ä¼šæŒç»­å¢åŠ ï¼Œè¦å­¦çš„ä¸œè¥¿è¿˜æœ‰å¾ˆå¤šã€‚ æŠ€æœ¯ä½œä¸ºä¸€ä¸ªä»£ç ä»ä¸šè€…ï¼ŒæŠ€æœ¯èƒ½åŠ›æ‰æ˜¯æˆ‘çš„æœ¬èŒå·¥ä½œã€‚ éšç€ä»Šå¹´ä¸šåŠ¡æ€§è´¨çš„å˜åŒ–ï¼Œæˆ‘æ‰€æ¥è§¦çš„æŠ€æœ¯ä¹Ÿç•¥æœ‰ä¸åŒã€‚ å‰å‡ å¹´æ‰“äº¤é“çš„ä¸»è¦æ˜¯ web ç›¸å…³çš„æŠ€æœ¯ï¼›å¤§å¤šæ•°æŠ€æœ¯æ ˆéƒ½æ˜¯å›´ç»•ç€å®ƒæ¥å±•å¼€çš„ã€‚ è€Œä»Šå¹´ä¸å¤ªä¸€æ ·çš„æ˜¯åœ¨ web çš„åŸºç¡€ä¸Šï¼Œè¿˜éœ€è¦æ¶‰åŠåˆ°ç½‘ç»œã€‚ä¸»è¦æ˜¯ç°åœ¨ä¸šåŠ¡å’Œç‰©è”ç½‘ç›¸å…³ï¼Œçœ‹å¹³å°çš„è¿˜å¥½æœ€ç›´æ¥çš„å°±æ˜¯èƒ½æ”¯æŒäº†å¤šå°‘è¿æ¥ã€‚ è¿™ä¸ªå°±éœ€è¦å¯¹ç‰©è”ç½‘ç‰¹æœ‰çš„ä¸€äº›åè®®æœ‰æ‰€äº†è§£ã€åº”ç”¨ã€‚ æ‰€ä»¥ä»Šå¹´æ¶è¡¥äº† Netty ç›¸å…³çš„çŸ¥è¯†ï¼ŒåŒæ—¶åœ¨å¹³æ—¶çš„å¼€å‘ä¸­è¿›è¡Œäº†ä¸€äº›å®è·µå‘ç°æƒ³è¦åšå¥½ç½‘ç»œè¿™ç§åº•å±‚å¼€å‘éœ€è¦å‚¨å¤‡çš„çŸ¥è¯†å¤ªå¤šäº†ã€‚ ä»€ä¹ˆæ“ä½œç³»ç»Ÿã€IOã€TCP éƒ½å¾—æŒæ¡ï¼Œæ­£å¥½ä¹Ÿè¡¥ä¹ äº†è¿™äº›çŸ­æ¿ã€‚ å¼€æºé¡¹ç›® GitHub å®˜æ–¹çš„å¹´åº¦æŠ¥å‘Šå¯ä»¥çœ‹å‡ºä»Šå¹´æ˜¯å¼€æºå¤§å¹´ã€‚ ä»æˆ‘ä»Šå¹´çš„è´¡çŒ®å›¾å¯ä»¥çœ‹å‡ºä¹ŸèŠ±äº†å¾ˆå¤šæ—¶é—´åœ¨è¿™ä¸Šé¢ã€‚ ä»æ³¨å†Œ GitHub è´¦å·ç®—èµ·æ¯å¹´çš„æäº¤é‡çœ‹èµ·æ¥ä»Šå¹´ç¡®å®æ˜¯èŠ±äº†ä¸å°‘å¿ƒæ€ï¼š æœ€æ˜¾è‘—çš„ä½“ç°å°±æ˜¯ JCSprout ä¸€å¹´æ—¶é—´æ¶¨äº† 1W7 starã€‚ ä¸»è¦å¼€æºçš„æœ‰ï¼š JCSprout Java Core Sproutï¼šå¤„äºèŒèŠ½é˜¶æ®µçš„ Java æ ¸å¿ƒçŸ¥è¯†åº“ã€‚ cicada åŸºäº Netty å®ç°çš„å¿«é€Ÿã€è½»é‡çº§ HTTP æ¡†æ¶ã€‚ distributed-redis-tool æ ¹æ®æ—¥å¸¸éœ€æ±‚å®ç°çš„ä¸€ä¸ªåˆ†å¸ƒå¼å·¥å…·ï¼ŒåŒ…æ‹¬åˆ†å¸ƒå¼é”ã€åˆ†å¸ƒå¼é™æµã€‚ netty-action çœ‹åå­—å°±çŸ¥é“ï¼Œä¸€ä¸ª netty å®æˆ˜ç›¸å…³æ¡ˆä¾‹ï¼Œç°åœ¨ä¹Ÿæ­£åœ¨ä¿®æ”¹ä¸ºå¯æ°´å¹³æ‰©å±•çš„ IM å³ä½¿é€šè®¯ç³»ç»Ÿï¼›é¢„è®¡å…ƒæ—¦åå‘å¸ƒã€‚ è¦æ„Ÿè°¢æ¯ä¸€ä½ç»™æˆ‘æ issueã€PR çš„æœ‹å‹ï¼Œå¸Œæœ›æ¥å¹´èƒ½æŠŠæŒ–çš„å‘å¡«å®ŒğŸ˜­ã€‚ æŠ€æœ¯åšå®¢ ä»å¹´åˆåˆ°ç°åœ¨ä¸€å…±æ’¸äº† 49 ç¯‡åšå®¢ï¼Œæˆ‘è¿˜ç‰¹æ„æŒ‰ç…§æ—¶é—´æ’åºã€é˜…è¯»é‡åšäº†ä¸€ä¸ªæŸ±çŠ¶å›¾ï¼ˆæ•°æ®æ¥æºä¸ºä¸ªäººåšå®¢ï¼šhttps://crossoverjie.top ï¼‰ï¼š ç»Ÿè®¡äº†ä¸€ä¸‹ï¼Œå…¨å¹´è¿™ä¸ªåšå®¢çš„é˜…è¯»æ€»æ•°ä¸ºï¼š22Wï¼Œå¹³å‡æ¯ç¯‡å·®ä¸å¤š 4500 çš„é˜…è¯»ï¼›è™½è¯´ä¸èƒ½å’Œä¸€äº›å¤§ä½¬ç›¸æ¯”ï¼Œä½†æ¯”å»å¹´å¯ä¸çŸ¥é“é«˜å“ªé‡Œå»äº†ã€‚ åŒæ—¶æœ€é«˜çš„æœ‰å°†è¿‘ 2W å½“ç„¶ä½çš„ä¹Ÿæœ‰4 500çš„é˜…è¯»æ•°ï¼Œä¸è¿‡ä»è¿™ä¸ªå›¾ä¸­è¿˜æ˜¯å¯ä»¥çœ‹å‡ºä¸€äº›è§„å¾‹çš„ã€‚ æ¯”å¦‚é˜…è¯»é‡é«˜çš„ä¹Ÿæ˜¯æ¯”è¾ƒå¸å¼•çœ¼çƒçš„ï¼Œè¿™ä¸å°±æ˜¯å¸¸è¯´çš„â€œæ ‡é¢˜å…šâ€å˜›ã€‚ å¾®ä¿¡å…¬ä¼—å·å†æ¥è°ˆè°ˆå…¬ä¼—å·ï¼Œç°åœ¨åšå…¬ä¼—å·çš„æŠ€æœ¯äººä¹Ÿè¶Šæ¥è¶Šå¤šï¼›ä¸è¿‡åœ¨ä»Šå¹´ç”³è¯·çš„è´¦å·å·²ç»æ²¡æœ‰ç•™è¨€åŠŸèƒ½äº†ï¼Œè¿˜å¥½æˆ‘ç”³è¯·çš„æ—©ï¼Œè‡³å°‘å’Œè¯»è€…æœ‰ä¸€ä¸ªäº¤æµçš„æœºä¼šã€‚ ä»Šå¹´ä¹Ÿæ˜¯æŠŠå…¬ä¼—å·ä» 0 åšåˆ°äº† 1 ï¼Œä¹Ÿå°±æ˜¯æœ‰äº† 1W+ çš„å…³æ³¨æ•°ï¼›ä¸è¿‡è¯´å®è¯æˆ‘ç¡®å®æ²¡æœ‰ç”»ä»€ä¹ˆå¿ƒæ€è¿è¥ï¼Œé‡Œé¢çš„å†…å®¹ä¹Ÿéƒ½æ˜¯åŒæ­¥äºæˆ‘çš„åšå®¢ï¼Œé™¤äº†å‡ ç¯‡ç¿»è¯‘ä¹‹å¤–å¯ä»¥è¯´æ˜¯ 100% åŸåˆ›ã€‚ å†™è¿‡æŠ€æœ¯æ–‡çš„åº”è¯¥éƒ½çŸ¥é“äº§å‡ºä¸€ç¯‡æ–‡ç« å¹¶ä¸è½»æ¾ï¼Œæ‰€ä»¥ä¸ºäº†èƒ½æ­£å‘æ¿€åŠ±æˆ‘ä¹Ÿä¼šé€‚å½“çš„æ¥ä¸€äº›å¹¿å‘Šï¼›è¿™æ ·ä¸ç®¡æ˜¯å¯¹è¯»è€…è¿˜æ˜¯æˆ‘éƒ½æœ‰å¥½å¤„ã€‚ ä¸­é€”ä¹Ÿæœ‰ä¸€äº›æœ‹å‹æ‰¾æˆ‘æŠ•ç¨¿ï¼Œç”±äºç›®å‰ä¸æ˜¯å®šä½äºåšä¸€ä¸ªè‡ªåª’ä½“ï¼›æˆ‘ä¸ªäººä¹Ÿä¸èƒ½å®Œå…¨å¯¹è½¬è½½çš„æ–‡ç« ç†è§£é€å½»ï¼Œè¿˜æ˜¯å¸Œæœ›åšä¸€ä¸ªåŸåˆ›çš„æŠ€æœ¯å·ï¼Œæ‰€ä»¥æŠ±æ­‰éƒ½æ²¡æœ‰è½¬è½½ã€‚ èº«ä½“ä»å‰å‡ å¹´çš„è®¡åˆ’è¡¨ä¸­éƒ½æåˆ°äº†èº«ä½“ï¼Œä½†å®è¯è¯´ç›´åˆ°ç°åœ¨è®°æ€§æ²¡é•¿åªæœ‰ä½“é‡é•¿äº†ã€‚ã€‚ã€‚ åŸæœ¬çƒ­çˆ±çš„ç¯®çƒä¹Ÿä»æ¯å‘¨ä¸€æ¬¡è°ƒæ•´ä¸ºä¸€ä¸ªæœˆä¸€æ¬¡ï¼Œæ›¾ç»æ½‡æ´’çš„ crossover ä¹Ÿå˜ä¸ºé”®ç›˜é‡Œä¸€ä¸ªä¸ªçš„ Bugã€‚ ä»ä¸‹é¢çš„è§†é¢‘ä¸­å¯ä»¥çœ‹å¾—å‡ºæ¥ï¼ˆéœ€è¦ FQ è§‚çœ‹ï¼‰ï¼š ç¬¬ä¸€æ®µæ˜¯äº”å¹´å‰çš„ï¼Œåé¢ä¸¤æ®µä¸ºæœ€è¿‘çš„ã€‚ æ˜å¹´çœŸå¾—ä¸Šå¿ƒäº†ï¼Œå€Ÿç€æ¬å®¶åˆ°æ–°å°åŒºå†…çš„ç¯®çƒåœºçœ‹èƒ½å¦æ‹¯æ•‘æˆ‘è¿™å¤šå¹´çš„é”®ç›˜æ‰‹ã€‚ æ€»ç»“å›é¡¾ä¸€ä¸‹å¯¹äºæˆ‘ä¸ªäººçš„å‡ ä¸ªå¤§äº‹ä»¶å§ï¼š å·¥ä½œè§’è‰²å¤§å˜åŒ–ï¼Œå¸¦æ¥çš„æŒ‘æˆ˜ä¹Ÿå¾ˆå¤§ã€‚ åšäº†å‡ ä¸ªè¿˜ç®—æˆåŠŸå¼€æºé¡¹ç›®ï¼Œå¹¶ä¸”å¸¦æ¥äº†ä¸€äº›å®è´¨æ€§çš„å¥½å¤„ã€‚ å…¬ä¼—å·ä» 0 åˆ° 1 ï¼Œå¹¶ä¸”èƒ½è¡¥è´´ä¸€äº›é¸¡è…¿é’±ã€‚ æ±‚å©šæˆåŠŸï¼Œæ„Ÿè°¢é«˜ä¸­ç­ä¸»ä»»å½“å¹´çš„ä¸æ€ä¹‹æ©ï¼ˆæ²¡æœ‰æ­å‘æˆ‘ï¼‰ã€‚ ç­‰äº†ä¸‰å¹´ç»ˆäºæ¥æˆ¿è£…ä¿®äº†ã€‚ æŒ‰ç…§å†å²ä¼ ç»Ÿç…§ä¾‹è¿˜æ˜¯å†™ä¸ªæ˜å¹´çš„ TODO-LIST å§ï¼š åˆ«æ‹–å›¢é˜Ÿåè…¿ï¼Œå¤šå’Œè€å¸æœºå­¦ä¹ ä¸‹è½¯æŠ€èƒ½ã€‚ å¼€æºé¡¹ç›®æ¥ç€æ›´æ–°ï¼Œè¿™ä¹Ÿæ˜¯å¯æŒç»­å‘å±•é“è·¯ä¹‹ä¸€ã€‚ åšå®¢ã€å…¬ä¼—å·æŒç»­è¾“å‡ºä¼˜è´¨å†…å®¹ï¼Œåªæ˜¯æ›´æ–°å‘¨æœŸå¯èƒ½ä¼šæé«˜ã€‚ è¦é€¼å°±å¾€æ­»é‡Œé€¼ï¼Œçœ‹å¹´åº•èƒ½å¦æ‰£ä¸ªç¯®ï¼ æä¸ªäº‹æƒ…ï¼Œçœ‹èƒ½å¦æŠŠå©šæ¥äº†ã€‚ å¯¹æ¥å¹´å†™æ€»ç»“çš„æˆ‘è¯šæ³çš„è¯´ä¸€å¥ï¼šåˆ«åœ¨ Ctrl+C,Ctrl+V äº†ğŸ™ã€‚]]></content>
      <categories>
        <category>annual-summary</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ä¸€æ¬¡ç”Ÿäº§ CPU 100% æ’æŸ¥ä¼˜åŒ–å®è·µ]]></title>
    <url>%2F2018%2F12%2F17%2Ftroubleshoot%2Fcpu-percent-100%2F</url>
    <content type="text"><![CDATA[å‰è¨€åˆ°äº†å¹´åº•æœç„¶éƒ½ä¸å¤ªå¹³ï¼Œæœ€è¿‘åˆæ”¶åˆ°äº†è¿ç»´æŠ¥è­¦ï¼šè¡¨ç¤ºæœ‰äº›æœåŠ¡å™¨è´Ÿè½½éå¸¸é«˜ï¼Œè®©æˆ‘ä»¬å®šä½é—®é¢˜ã€‚ è¿˜çœŸæ˜¯æƒ³ä»€ä¹ˆæ¥ä»€ä¹ˆï¼Œå‰äº›å¤©è¿˜æ•…æ„æŠŠæŸäº›æœåŠ¡å™¨çš„è´Ÿè½½æé«˜ï¼ˆæ²¡é”™ï¼Œè€æ¿è®©æˆ‘å†™ä¸ª BUGï¼ï¼‰ï¼Œä¸è¿‡è¿˜å¥½æ˜¯ä¸åŒçš„ç¯å¢ƒäº’ç›¸æ²¡æœ‰å½±å“ã€‚ å®šä½é—®é¢˜æ‹¿åˆ°é—®é¢˜åé¦–å…ˆå»æœåŠ¡å™¨ä¸Šçœ‹äº†çœ‹ï¼Œå‘ç°è¿è¡Œçš„åªæœ‰æˆ‘ä»¬çš„ Java åº”ç”¨ã€‚äºæ˜¯å…ˆç”¨ ps å‘½ä»¤æ‹¿åˆ°äº†åº”ç”¨çš„ PIDã€‚ æ¥ç€ä½¿ç”¨ top -Hp pid å°†è¿™ä¸ªè¿›ç¨‹çš„çº¿ç¨‹æ˜¾ç¤ºå‡ºæ¥ã€‚è¾“å…¥å¤§å†™çš„ P å¯ä»¥å°†çº¿ç¨‹æŒ‰ç…§ CPU ä½¿ç”¨æ¯”ä¾‹æ’åºï¼Œäºæ˜¯å¾—åˆ°ä»¥ä¸‹ç»“æœã€‚ æœç„¶æŸäº›çº¿ç¨‹çš„ CPU ä½¿ç”¨ç‡éå¸¸é«˜ã€‚ ä¸ºäº†æ–¹ä¾¿å®šä½é—®é¢˜æˆ‘ç«‹é©¬ä½¿ç”¨ jstack pid &gt; pid.log å°†çº¿ç¨‹æ ˆ dump åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ã€‚ æˆ‘åœ¨ä¸Šé¢ 100% çš„çº¿ç¨‹ä¸­éšæœºé€‰äº†ä¸€ä¸ª pid=194283 è½¬æ¢ä¸º 16 è¿›åˆ¶ï¼ˆ2f6ebï¼‰ååœ¨çº¿ç¨‹å¿«ç…§ä¸­æŸ¥è¯¢ï¼š å› ä¸ºçº¿ç¨‹å¿«ç…§ä¸­çº¿ç¨‹ ID éƒ½æ˜¯16è¿›åˆ¶å­˜æ”¾ã€‚ å‘ç°è¿™æ˜¯ Disruptor çš„ä¸€ä¸ªå †æ ˆï¼Œå‰æ®µæ—¶é—´æ­£å¥½è§£å†³è¿‡ä¸€ä¸ªç”±äº Disruptor é˜Ÿåˆ—å¼•èµ·çš„ä¸€æ¬¡ OOMï¼šå¼ºå¦‚ Disruptor ä¹Ÿå‘ç”Ÿå†…å­˜æº¢å‡ºï¼Ÿ æ²¡æƒ³åˆ°åˆæ¥ä¸€å‡ºã€‚ ä¸ºäº†æ›´åŠ ç›´è§‚çš„æŸ¥çœ‹çº¿ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œæˆ‘å°†å¿«ç…§ä¿¡æ¯ä¸Šä¼ åˆ°ä¸“é—¨åˆ†æçš„å¹³å°ä¸Šã€‚ http://fastthread.io/ å…¶ä¸­æœ‰ä¸€é¡¹èœå•å±•ç¤ºäº†æ‰€æœ‰æ¶ˆè€— CPU çš„çº¿ç¨‹ï¼Œæˆ‘ä»”ç»†çœ‹äº†ä¸‹å‘ç°å‡ ä¹éƒ½æ˜¯å’Œä¸Šé¢çš„å †æ ˆä¸€æ ·ã€‚ ä¹Ÿå°±æ˜¯è¯´éƒ½æ˜¯ Disruptor é˜Ÿåˆ—çš„å †æ ˆï¼ŒåŒæ—¶éƒ½åœ¨æ‰§è¡Œ java.lang.Thread.yield å‡½æ•°ã€‚ ä¼—æ‰€å‘¨çŸ¥ yield å‡½æ•°ä¼šè®©å½“å‰çº¿ç¨‹è®©å‡º CPU èµ„æºï¼Œå†è®©å…¶ä»–çº¿ç¨‹æ¥ç«äº‰ã€‚ æ ¹æ®åˆšæ‰çš„çº¿ç¨‹å¿«ç…§å‘ç°å¤„äº RUNNABLE çŠ¶æ€å¹¶ä¸”éƒ½åœ¨æ‰§è¡Œ yield å‡½æ•°çš„çº¿ç¨‹å¤§æ¦‚æœ‰ 30å‡ ä¸ªã€‚ å› æ­¤åˆæ­¥åˆ¤æ–­ä¸ºå¤§é‡çº¿ç¨‹æ‰§è¡Œ yield å‡½æ•°ä¹‹åäº’ç›¸ç«äº‰å¯¼è‡´ CPU ä½¿ç”¨ç‡å¢é«˜ï¼Œè€Œé€šè¿‡å¯¹å †æ ˆå‘ç°æ˜¯å’Œä½¿ç”¨ Disruptor æœ‰å…³ã€‚ è§£å†³é—®é¢˜è€Œåæˆ‘æŸ¥çœ‹äº†ä»£ç ï¼Œå‘ç°æ˜¯æ ¹æ®æ¯ä¸€ä¸ªä¸šåŠ¡åœºæ™¯åœ¨å†…éƒ¨éƒ½ä¼šä½¿ç”¨ 2 ä¸ª Disruptor é˜Ÿåˆ—æ¥è§£è€¦ã€‚ å‡è®¾ç°åœ¨æœ‰ 7 ä¸ªä¸šåŠ¡ç±»å‹ï¼Œé‚£å°±ç­‰äºæ˜¯åˆ›å»º 2*7=14 ä¸ª Disruptor é˜Ÿåˆ—ï¼ŒåŒæ—¶æ¯ä¸ªé˜Ÿåˆ—æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œä¹Ÿå°±æ˜¯æ€»å…±æœ‰ 14 ä¸ªæ¶ˆè´¹è€…ï¼ˆç”Ÿäº§ç¯å¢ƒæ›´å¤šï¼‰ã€‚ åŒæ—¶å‘ç°é…ç½®çš„æ¶ˆè´¹ç­‰å¾…ç­–ç•¥ä¸º YieldingWaitStrategy è¿™ç§ç­‰å¾…ç­–ç•¥ç¡®å®ä¼šæ‰§è¡Œ yield æ¥è®©å‡º CPUã€‚ ä»£ç å¦‚ä¸‹ï¼š åˆæ­¥çœ‹æ¥å’Œè¿™ä¸ªç­‰å¾…ç­–ç•¥æœ‰å¾ˆå¤§çš„å…³ç³»ã€‚ æœ¬åœ°æ¨¡æ‹Ÿä¸ºäº†éªŒè¯ï¼Œæˆ‘åœ¨æœ¬åœ°åˆ›å»ºäº† 15 ä¸ª Disruptor é˜Ÿåˆ—åŒæ—¶ç»“åˆç›‘æ§è§‚å¯Ÿ CPU çš„ä½¿ç”¨æƒ…å†µã€‚ åˆ›å»ºäº† 15 ä¸ª Disruptor é˜Ÿåˆ—ï¼ŒåŒæ—¶æ¯ä¸ªé˜Ÿåˆ—éƒ½ç”¨çº¿ç¨‹æ± æ¥å¾€ Disruptoré˜Ÿåˆ— é‡Œé¢å‘é€ 100W æ¡æ•°æ®ã€‚ æ¶ˆè´¹ç¨‹åºä»…ä»…åªæ˜¯æ‰“å°ä¸€ä¸‹ã€‚ è·‘äº†ä¸€æ®µæ—¶é—´å‘ç° CPU ä½¿ç”¨ç‡ç¡®å®å¾ˆé«˜ã€‚ åŒæ—¶ dump çº¿ç¨‹å‘ç°å’Œç”Ÿäº§çš„ç°è±¡ä¹Ÿæ˜¯ä¸€è‡´çš„ï¼šæ¶ˆè´¹çº¿ç¨‹éƒ½å¤„äº RUNNABLE çŠ¶æ€ï¼ŒåŒæ—¶éƒ½åœ¨æ‰§è¡Œ yieldã€‚ é€šè¿‡æŸ¥è¯¢ Disruptor å®˜æ–¹æ–‡æ¡£å‘ç°ï¼š YieldingWaitStrategy æ˜¯ä¸€ç§å……åˆ†å‹æ¦¨ CPU çš„ç­–ç•¥ï¼Œä½¿ç”¨è‡ªæ—‹ + yieldçš„æ–¹å¼æ¥æé«˜æ€§èƒ½ã€‚å½“æ¶ˆè´¹çº¿ç¨‹ï¼ˆEvent Handler threadsï¼‰çš„æ•°é‡å°äº CPU æ ¸å¿ƒæ•°æ—¶æ¨èä½¿ç”¨è¯¥ç­–ç•¥ã€‚ åŒæ—¶æŸ¥é˜…åˆ°å…¶ä»–çš„ç­‰å¾…ç­–ç•¥ BlockingWaitStrategy ï¼ˆä¹Ÿæ˜¯é»˜è®¤çš„ç­–ç•¥ï¼‰ï¼Œå®ƒä½¿ç”¨çš„æ˜¯é”çš„æœºåˆ¶ï¼Œå¯¹ CPU çš„ä½¿ç”¨ç‡ä¸é«˜ã€‚ äºæ˜¯åœ¨å’Œä¹‹å‰åŒæ ·çš„æ¡ä»¶ä¸‹å°†ç­‰å¾…ç­–ç•¥æ¢ä¸º BlockingWaitStrategyã€‚ å’Œåˆšæ‰çš„ CPU å¯¹æ¯”ä¼šå‘ç°åˆ°åé¢ä½¿ç”¨ç‡çš„ä¼šæœ‰æ˜æ˜¾çš„é™ä½ï¼›åŒæ—¶ dump çº¿ç¨‹åä¼šå‘ç°å¤§éƒ¨åˆ†çº¿ç¨‹éƒ½å¤„äº waiting çŠ¶æ€ã€‚ ä¼˜åŒ–è§£å†³çœ‹æ ·å­å°†ç­‰å¾…ç­–ç•¥æ¢ä¸º BlockingWaitStrategy å¯ä»¥å‡ç¼“ CPU çš„ä½¿ç”¨ï¼Œ ä½†ç•™æ„åˆ°å®˜æ–¹å¯¹ YieldingWaitStrategy çš„æè¿°é‡Œè°ˆé“ï¼šå½“æ¶ˆè´¹çº¿ç¨‹ï¼ˆEvent Handler threadsï¼‰çš„æ•°é‡å°äº CPU æ ¸å¿ƒæ•°æ—¶æ¨èä½¿ç”¨è¯¥ç­–ç•¥ã€‚ è€Œç°æœ‰çš„ä½¿ç”¨åœºæ™¯å¾ˆæ˜æ˜¾æ¶ˆè´¹çº¿ç¨‹æ•°å·²ç»å¤§å¤§çš„è¶…è¿‡äº†æ ¸å¿ƒ CPU æ•°äº†ï¼Œå› ä¸ºæˆ‘çš„ä½¿ç”¨æ–¹å¼æ˜¯ä¸€ä¸ª Disruptor é˜Ÿåˆ—ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œæ‰€ä»¥æˆ‘å°†é˜Ÿåˆ—è°ƒæ•´ä¸ºåªæœ‰ 1 ä¸ªå†è¯•è¯•(ç­–ç•¥ä¾ç„¶æ˜¯ YieldingWaitStrategy)ã€‚ è·‘äº†ä¸€åˆ†é’Ÿï¼Œå‘ç° CPU çš„ä½¿ç”¨ç‡ä¸€ç›´éƒ½æ¯”è¾ƒå¹³ç¨³è€Œä¸”ä¸é«˜ã€‚ æ€»ç»“æ‰€ä»¥æ’æŸ¥åˆ°æ­¤å¯ä»¥æœ‰ä¸€ä¸ªç»“è®ºäº†ï¼Œæƒ³è¦æ ¹æœ¬è§£å†³è¿™ä¸ªé—®é¢˜éœ€è¦å°†æˆ‘ä»¬ç°æœ‰çš„ä¸šåŠ¡æ‹†åˆ†ï¼›ç°åœ¨æ˜¯ä¸€ä¸ªåº”ç”¨é‡ŒåŒæ—¶å¤„ç†äº† N ä¸ªä¸šåŠ¡ï¼Œæ¯ä¸ªä¸šåŠ¡éƒ½ä¼šä½¿ç”¨å¥½å‡ ä¸ª Disruptor é˜Ÿåˆ—ã€‚ ç”±äºæ˜¯åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œæ‰€ä»¥ CPU èµ„æºéƒ½æ˜¯å…±äº«çš„ï¼Œè¿™å°±ä¼šå¯¼è‡´ CPU çš„ä½¿ç”¨ç‡å±…é«˜ä¸ä¸‹ã€‚ æ‰€ä»¥æˆ‘ä»¬çš„è°ƒæ•´æ–¹å¼å¦‚ä¸‹ï¼š ä¸ºäº†å¿«é€Ÿç¼“è§£è¿™ä¸ªé—®é¢˜ï¼Œå…ˆå°†ç­‰å¾…ç­–ç•¥æ¢ä¸º BlockingWaitStrategyï¼Œå¯ä»¥æœ‰æ•ˆé™ä½ CPU çš„ä½¿ç”¨ç‡ï¼ˆä¸šåŠ¡ä¸Šä¹Ÿè¿˜èƒ½æ¥å—ï¼‰ã€‚ ç¬¬äºŒæ­¥å°±éœ€è¦å°†åº”ç”¨æ‹†åˆ†ï¼ˆä¸Šæ–‡æ¨¡æ‹Ÿçš„ä¸€ä¸ª Disruptor é˜Ÿåˆ—ï¼‰ï¼Œä¸€ä¸ªåº”ç”¨å¤„ç†ä¸€ç§ä¸šåŠ¡ç±»å‹ï¼›ç„¶ååˆ†åˆ«å•ç‹¬éƒ¨ç½²ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥äº’ç›¸éš”ç¦»äº’ä¸å½±å“ã€‚ å½“ç„¶è¿˜æœ‰å…¶ä»–çš„ä¸€äº›ä¼˜åŒ–ï¼Œå› ä¸ºè¿™ä¹Ÿæ˜¯ä¸€ä¸ªè€ç³»ç»Ÿäº†ï¼Œè¿™æ¬¡ dump çº¿ç¨‹å±…ç„¶å‘ç°åˆ›å»ºäº† 800+ çš„çº¿ç¨‹ã€‚ åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼ä¹Ÿæ˜¯æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°æ˜¯ä¸€æ ·çš„ï¼Œå¯¼è‡´ä¸€äº›ç©ºé—²çš„çº¿ç¨‹ä¹Ÿå¾—ä¸åˆ°å›æ”¶ï¼›è¿™æ ·ä¼šæœ‰å¾ˆå¤šæ— æ„ä¹‰çš„èµ„æºæ¶ˆè€—ã€‚ æ‰€ä»¥ä¹Ÿä¼šç»“åˆä¸šåŠ¡å°†åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼è°ƒæ•´ä¸€ä¸‹ï¼Œå°†çº¿ç¨‹æ•°é™ä¸‹æ¥ï¼Œå°½é‡çš„ç‰©å°½å…¶ç”¨ã€‚ æœ¬æ–‡çš„æ¼”ç¤ºä»£ç å·²ä¸Šä¼ è‡³ GitHubï¼š https://github.com/crossoverJie/JCSprout ä½ çš„ç‚¹èµä¸åˆ†äº«æ˜¯å¯¹æˆ‘æœ€å¤§çš„æ”¯æŒ]]></content>
      <categories>
        <category>é—®é¢˜æ’æŸ¥</category>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Thread</tag>
        <tag>concurrent</tag>
        <tag>JVM</tag>
        <tag>disruptor</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ²¡é”™ï¼Œè€æ¿è®©æˆ‘å†™ä¸ª BUGï¼]]></title>
    <url>%2F2018%2F12%2F12%2Fjava-senior%2Fjava-memary-allocation%2F</url>
    <content type="text"><![CDATA[å‰è¨€æ ‡é¢˜æ²¡æœ‰çœ‹é”™ï¼ŒçœŸçš„æ˜¯è®©æˆ‘å†™ä¸ª bugï¼ åˆšæ¥åˆ°è¿™ä¸ªéœ€æ±‚æ—¶æˆ‘å†…å¿ƒæ²¡æœ‰ä¸æ¯«æ³¢æ¾œï¼Œç”šè‡³è¿˜æœ‰ç‚¹æ¿€åŠ¨ã€‚è¿™å¯æ˜¯æˆ‘ç‰¹é•¿å•Šï¼›ç»ˆäºå¯ä»¥å…‰æ˜æ­£å¤§çš„å†™ bug äº†ğŸ™„ã€‚ å…ˆæ¥çœ‹çœ‹å…·ä½“æ˜¯è¦å¹²å•¥å§ï¼Œå…¶å®ä¸»è¦å°±æ˜¯è¦è®©ä¸€äº›è´Ÿè½½å¾ˆä½çš„æœåŠ¡å™¨é¢å¤–æ¶ˆè€—ä¸€äº›å†…å­˜ã€CPU ç­‰èµ„æºï¼ˆè‡³äºèƒŒæ™¯å°±ä¸å¤šè¯´äº†ï¼‰ï¼Œè®©å®ƒçš„è´Ÿè½½å¯ä»¥æé«˜ä¸€äº›ã€‚ JVM å†…å­˜åˆ†é…å›é¡¾äºæ˜¯æˆ‘åˆ·åˆ·ä¸€æŠŠæ¢­çš„å°±æŠŠä»£ç å†™å¥½äº†ï¼Œå¤§æ¦‚å¦‚ä¸‹ï¼š å†™å®Œä¹‹åæˆ‘å°±åœ¨æƒ³ä¸€ä¸ªé—®é¢˜ï¼Œä»£ç ä¸­çš„ mem å¯¹è±¡åœ¨æ–¹æ³•æ‰§è¡Œå®Œä¹‹åä¼šä¸ä¼šè¢«ç«‹å³å›æ”¶å‘¢ï¼Ÿæˆ‘æƒ³è‚¯å®šä¼šæœ‰ä¸€éƒ¨åˆ†äººè®¤ä¸ºå°±æ˜¯åœ¨æ–¹æ³•æ‰§è¡Œå®Œä¹‹åå›æ”¶ã€‚ æˆ‘ä¹Ÿæ­£å„¿å…«ç»çš„å»è°ƒç ”äº†ä¸‹ï¼Œé—®äº†ä¸€äº›æœ‹å‹ï¼›æœä¸å…¶ç„¶ç¡®å®æœ‰ä¸€éƒ¨åˆ†è®¤ä¸ºæ˜¯åœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åå›æ”¶ã€‚ é‚£äº‹å®æƒ…å†µå¦‚ä½•å‘¢ï¼Ÿæˆ‘åšäº†ä¸€ä¸ªè¯•éªŒã€‚ æˆ‘ç”¨ä»¥ä¸‹çš„å¯åŠ¨å‚æ•°å°†åˆšæ‰è¿™ä¸ªåº”ç”¨å¯åŠ¨èµ·æ¥ã€‚ 123456java -Djava.rmi.server.hostname=10.xx.xx.xx -Djava.security.policy=jstatd.all.policy -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.port=8888 -Xms4g -Xmx4g -jar bug-0.0.1-SNAPSHOT.jar è¿™æ ·æˆ‘å°±å¯ä»¥é€šè¿‡ JMX ç«¯å£è¿œç¨‹è¿æ¥åˆ°è¿™ä¸ªåº”ç”¨è§‚å¯Ÿå†…å­˜ã€GC æƒ…å†µäº†ã€‚ å¦‚æœæ˜¯æ–¹æ³•æ‰§è¡Œå®Œæ¯•å°±å›æ”¶ mem å¯¹è±¡ï¼Œå½“æˆ‘åˆ†é… 250M å†…å­˜æ—¶ï¼›å†…å­˜å°±ä¼šæœ‰ä¸€ä¸ªæ˜æ˜¾çš„æ›²çº¿ï¼ŒåŒæ—¶ GC ä¹Ÿä¼šæ‰§è¡Œã€‚ è¿™æ—¶è§‚å¯Ÿå†…å­˜æ›²çº¿ã€‚ ä¼šå‘ç°ç¡®å®æœ‰æ˜æ˜¾çš„æ¶¨å¹…ï¼Œä½†æ˜¯ä¹‹åå¹¶æ²¡æœ‰ç«‹å³å›æ”¶ï¼Œè€Œæ˜¯ä¸€ç›´ä¿æŒåœ¨è¿™ä¸ªæ°´ä½ã€‚åŒæ—¶å·¦è¾¹çš„ GC ä¹Ÿæ²¡æœ‰ä»»ä½•çš„ååº”ã€‚ ç”¨ jstat æŸ¥çœ‹å†…å­˜å¸ƒå±€ä¹Ÿæ˜¯åŒæ ·çš„æƒ…å†µã€‚ ä¸ç®¡æ˜¯ YGC,FGC éƒ½æ²¡æœ‰ï¼Œåªæ˜¯ Eden åŒºçš„ä½¿ç”¨å æ¯”æœ‰æ‰€å¢åŠ ï¼Œæ¯•ç«Ÿåˆ†é…äº† 250M å†…å­˜å˜›ã€‚ é‚£æ€æ ·æ‰ä¼šå›æ”¶å‘¢ï¼Ÿ æˆ‘å†æ¬¡åˆ†é…äº†ä¸¤ä¸ª 250M ä¹‹åè§‚å¯Ÿå†…å­˜æ›²çº¿ã€‚ å‘ç°ç¬¬ä¸‰ä¸ª 250M çš„æ—¶å€™ Eden åŒºè¾¾åˆ°äº† 98.83% äºæ˜¯å†æ¬¡åˆ†é…æ—¶å°±éœ€è¦å›æ”¶ Eden åŒºäº§ç”Ÿäº† YGCã€‚ åŒæ—¶å†…å­˜æ›²çº¿ä¹Ÿå¾—åˆ°äº†ä¸‹é™ã€‚ æ•´ä¸ªçš„æ¢ç®—è¿‡ç¨‹å¦‚å›¾ï¼š ç”±äºåˆå§‹åŒ–çš„å †å†…å­˜ä¸º 4Gï¼Œæ‰€ä»¥ç®—å‡ºæ¥çš„ Eden åŒºå¤§æ¦‚ä¸º 1092M å†…å­˜ã€‚ åŠ ä¸Šåº”ç”¨å¯åŠ¨ Spring ä¹‹ç±»æ¶ˆè€—çš„å¤§çº¦ 20% å†…å­˜ï¼Œæ‰€ä»¥åˆ†é… 3 æ¬¡ 250M å†…å­˜å°±ä¼šå¯¼è‡´ YGCã€‚ å†æ¥å›é¡¾ä¸‹åˆšæ‰çš„é—®é¢˜ï¼š mem å¯¹è±¡æ—¢ç„¶åœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åä¸ä¼šå›æ”¶ï¼Œé‚£ä»€ä¹ˆæ—¶å€™å›æ”¶å‘¢ã€‚ å…¶å®åªè¦è®°ä½ä¸€ç‚¹å³å¯ï¼šå¯¹è±¡éƒ½éœ€è¦åƒåœ¾å›æ”¶å™¨å‘ç”Ÿ GC æ—¶æ‰èƒ½å›æ”¶ï¼›ä¸ç®¡è¿™ä¸ªå¯¹è±¡æ˜¯å±€éƒ¨å˜é‡è¿˜æ˜¯å…¨å±€å˜é‡ã€‚ é€šè¿‡åˆšæ‰çš„å®éªŒä¹Ÿå‘ç°äº†ï¼Œå½“ Eden åŒºç©ºé—´ä¸è¶³äº§ç”Ÿ YGC æ—¶æ‰ä¼šå›æ”¶æ‰æˆ‘ä»¬åˆ›å»ºçš„ mem å¯¹è±¡ã€‚ ä½†è¿™é‡Œå…¶å®è¿˜æœ‰ä¸€ä¸ªéšè—æ¡ä»¶ï¼šé‚£å°±æ˜¯è¿™ä¸ªå¯¹è±¡æ˜¯å±€éƒ¨å˜é‡ã€‚å¦‚æœè¯¥å¯¹è±¡æ˜¯å…¨å±€å˜é‡é‚£ä¾ç„¶ä¸èƒ½è¢«å›æ”¶ã€‚ ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„å¯¹è±¡ä¸å¯è¾¾ï¼Œè¿™æ ·ä¸å¯è¾¾çš„å¯¹è±¡åœ¨ GC å‘ç”Ÿæ—¶å°±ä¼šè¢«è®¤ä¸ºæ˜¯éœ€è¦å›æ”¶çš„å¯¹è±¡ä»è€Œè¿›è¡Œå›æ”¶ã€‚ åœ¨å¤šè€ƒè™‘ä¸‹ï¼Œä¸ºä»€ä¹ˆæœ‰äº›äººä¼šè®¤ä¸ºæ–¹æ³•æ‰§è¡Œå®Œæ¯•åå±€éƒ¨å˜é‡ä¼šè¢«å›æ”¶å‘¢ï¼Ÿ æˆ‘æƒ³è¿™åº”å½“æ˜¯è®°æ··äº†ï¼Œå…¶å®æ–¹æ³•æ‰§è¡Œå®Œæ¯•åå›æ”¶çš„æ˜¯æ ˆå¸§ã€‚ å®ƒæœ€ç›´æ¥çš„ç»“æœå°±æ˜¯å¯¼è‡´ mem è¿™ä¸ªå¯¹è±¡æ²¡æœ‰è¢«å¼•ç”¨äº†ã€‚ä½†æ²¡æœ‰å¼•ç”¨å¹¶ä¸ä»£è¡¨ä¼šè¢«é©¬ä¸Šå›æ”¶ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢è¯´åˆ°çš„éœ€è¦äº§ç”Ÿ GC æ‰ä¼šå›æ”¶ã€‚ æ‰€ä»¥ä½¿ç”¨çš„æ˜¯ä¸Šé¢æåˆ°çš„å¯¹è±¡ä¸å¯è¾¾æ‰€é‡‡ç”¨çš„å¯è¾¾æ€§åˆ†æç®—æ³•æ¥è¡¨æ˜å“ªäº›å¯¹è±¡éœ€è¦è¢«å›æ”¶ã€‚ å½“å¯¹è±¡æ²¡æœ‰è¢«å¼•ç”¨åä¹Ÿå°±è®¤ä¸ºä¸å¯è¾¾äº†ã€‚ è¿™é‡Œæœ‰ä¸€å¼ åŠ¨å›¾æ¯”è¾ƒæ¸…æ™°ï¼š å½“æ–¹æ³•æ‰§è¡Œå®Œä¹‹åå…¶ä¸­çš„ mem å¯¹è±¡å°±ç›¸å½“äºå›¾ä¸­çš„ Object 5ï¼Œæ‰€ä»¥åœ¨ GC æ—¶å€™å°±ä¼šå›æ”¶æ‰ã€‚ ä¼˜å…ˆåœ¨ Eden åŒºåˆ†é…å¯¹è±¡å…¶å®ä»ä¸Šé¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹å‡ºå¯¹è±¡æ˜¯ä¼˜å…ˆåˆ†é…åœ¨æ–°ç”Ÿä»£ä¸­ Eden åŒºçš„ï¼Œä½†æœ‰ä¸ªå‰æå°±æ˜¯å¯¹è±¡ä¸èƒ½å¤ªå¤§ã€‚ ä»¥å‰ä¹Ÿå†™è¿‡ç›¸å…³çš„å†…å®¹ï¼š å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£è€Œå¤§å¯¹è±¡åˆ™æ˜¯ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ä¸­ï¼ˆè‡³äºå¤šå¤§ç®—å¤§ï¼Œå¯ä»¥é€šè¿‡å‚æ•°é…ç½®ï¼‰ã€‚ å½“æˆ‘ç›´æ¥åˆ†é… 1000M å†…å­˜æ—¶ï¼Œç”±äº Eden åŒºä¸èƒ½ç›´æ¥è£…ä¸‹ï¼Œæ‰€ä»¥æ”¹ä¸ºåˆ†é…åœ¨è€å¹´ä»£ä¸­ã€‚ å¯ä»¥çœ‹åˆ° Eden åŒºå‡ ä¹æ²¡æœ‰å˜åŠ¨ï¼Œä½†æ˜¯è€å¹´ä»£å´æ¶¨äº† 37% ï¼Œæ ¹æ®ä¹‹å‰è®¡ç®—çš„è€å¹´ä»£å†…å­˜ 2730M ç®—å‡ºæ¥ä¹Ÿå·®ä¸å¤šæ˜¯ 1000M çš„å†…å­˜ã€‚ Linux å†…å­˜æŸ¥çœ‹å›åˆ°è¿™æ¬¡æˆ‘éœ€è¦å®Œæˆçš„éœ€æ±‚ï¼šå¢åŠ æœåŠ¡å™¨å†…å­˜å’Œ CPU çš„æ¶ˆè€—ã€‚ CPU è¿˜å¥½ï¼Œæœ¬èº«å°±æœ‰ä¸€å®šçš„ä½¿ç”¨ï¼ŒåŒæ—¶æ¯åˆ›å»ºä¸€ä¸ªå¯¹è±¡ä¹Ÿä¼šæ¶ˆè€—ä¸€äº› CPUã€‚ ä¸»è¦æ˜¯å†…å­˜,å…ˆæ¥çœ‹ä¸‹æ²¡å¯åŠ¨è¿™ä¸ªåº”ç”¨ä¹‹å‰çš„å†…å­˜æƒ…å†µã€‚ å¤§æ¦‚åªä½¿ç”¨äº† 3G çš„å†…å­˜ã€‚ å¯åŠ¨åº”ç”¨ä¹‹åå¤§æ¦‚åªæ¶ˆè€—äº† 600M å·¦å³çš„å†…å­˜ã€‚ ä¸ºäº†æ»¡è¶³éœ€æ±‚æˆ‘éœ€è¦åˆ†é…ä¸€äº›å†…å­˜ï¼Œä½†è¿™é‡Œæœ‰ç‚¹éœ€è¦è®²ç©¶ã€‚ ä¸èƒ½ä¸€ç›´åˆ†é…å†…å­˜ï¼Œè¿™æ ·ä¼šå¯¼è‡´ CPU è´Ÿè½½å¤ªé«˜äº†ï¼ŒåŒæ—¶å†…å­˜ä¹Ÿä¼šç”±äº GC å›æ”¶å¯¼è‡´å ç”¨ä¹Ÿä¸æ˜¯ç‰¹åˆ«å¤šã€‚ æ‰€ä»¥æˆ‘éœ€è¦å°‘é‡çš„åˆ†é…ï¼Œè®©å¤§å¤šæ•°å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œä¸ºäº†ä¸è¢«å›æ”¶éœ€è¦ä¿æŒåœ¨ç™¾åˆ†ä¹‹å…«ä¹åã€‚ åŒæ—¶ä¹Ÿéœ€è¦åˆ†é…ä¸€äº›å¤§å¯¹è±¡åˆ°è€å¹´ä»£ä¸­ï¼Œä¹Ÿè¦ä¿æŒè€å¹´ä»£çš„ä½¿ç”¨åœ¨ç™¾åˆ†ä¹‹å…«ä¹åã€‚ è¿™æ ·æ‰èƒ½æœ€å¤§é™åº¦çš„åˆ©ç”¨è¿™ 4G çš„å †å†…å­˜ã€‚ äºæ˜¯æˆ‘åšäº†ä»¥ä¸‹æ“ä½œï¼š å…ˆåˆ†é…ä¸€äº›å°å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­ï¼ˆ800Mï¼‰ä¿æŒæ–°ç”Ÿä»£åœ¨90% æ¥ç€åˆåˆ†é…äº†è€å¹´ä»£å†… *ï¼ˆ100%-å·²ä½¿ç”¨çš„28%ï¼‰ï¼›ä¹Ÿå°±æ˜¯ 2730*60%=1638M è®©è€å¹´ä»£ä¹Ÿåœ¨ 90% å·¦å³ã€‚ æ•ˆæœå¦‚ä¸Šã€‚ æœ€ä¸»è¦çš„æ˜¯ä¸€æ¬¡ GC éƒ½æ²¡æœ‰å‘ç”Ÿè¿™æ ·ä¹Ÿå°±è¾¾åˆ°äº†æˆ‘çš„ç›®çš„ã€‚ æœ€ç»ˆå†…å­˜æ¶ˆè€—äº† 3.5G å·¦å³ã€‚ æ€»ç»“è™½è¯´è¿™æ¬¡çš„éœ€æ±‚æ˜¯æ¯”è¾ƒå¥‡è‘©ï¼Œä½†æƒ³è¦ç²¾ç¡®çš„æ§åˆ¶ JVM çš„å†…å­˜åˆ†é…è¿˜æ˜¯æ²¡é‚£ä¹ˆå®¹æ˜“ã€‚ éœ€è¦å¯¹å®ƒçš„å†…å­˜å¸ƒå±€ï¼Œå›æ”¶éƒ½è¦æœ‰ä¸€å®šçš„äº†è§£ï¼Œå†™è¿™ä¸ª Bug çš„è¿‡ç¨‹ç¡®å®ä¹ŸåŠ æ·±äº†å°è±¡ï¼Œå¦‚æœå¯¹ä½ æœ‰æ‰€å¸®åŠ©è¯·ä¸è¦åå•¬ä½ çš„ç‚¹èµä¸åˆ†äº«ã€‚ ä½ çš„ç‚¹èµä¸åˆ†äº«æ˜¯å¯¹æˆ‘æœ€å¤§çš„æ”¯æŒ]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå…ƒç´ åœ¨äº¿çº§æ•°æ®ä¸­æ˜¯å¦å­˜åœ¨ï¼Ÿ]]></title>
    <url>%2F2018%2F11%2F26%2Fguava%2Fguava-bloom-filter%2F</url>
    <content type="text"><![CDATA[å‰è¨€æœ€è¿‘æœ‰æœ‹å‹é—®æˆ‘è¿™ä¹ˆä¸€ä¸ªé¢è¯•é¢˜ç›®ï¼š ç°åœ¨æœ‰ä¸€ä¸ªéå¸¸åºå¤§çš„æ•°æ®ï¼Œå‡è®¾å…¨æ˜¯ int ç±»å‹ã€‚ç°åœ¨æˆ‘ç»™ä½ ä¸€ä¸ªæ•°ï¼Œä½ éœ€è¦å‘Šè¯‰æˆ‘å®ƒæ˜¯å¦å­˜åœ¨å…¶ä¸­(å°½é‡é«˜æ•ˆ)ã€‚ éœ€æ±‚å…¶å®å¾ˆæ¸…æ™°ï¼Œåªæ˜¯è¦åˆ¤æ–­ä¸€ä¸ªæ•°æ®æ˜¯å¦å­˜åœ¨å³å¯ã€‚ ä½†è¿™é‡Œæœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„å‰æï¼šéå¸¸åºå¤§çš„æ•°æ®ã€‚ å¸¸è§„å®ç°å…ˆä¸è€ƒè™‘è¿™ä¸ªæ¡ä»¶ï¼Œæˆ‘ä»¬è„‘æµ·ä¸­å‡ºç°çš„ç¬¬ä¸€ç§æ–¹æ¡ˆæ˜¯ä»€ä¹ˆï¼Ÿ æˆ‘æƒ³å¤§å¤šæ•°æƒ³åˆ°çš„éƒ½æ˜¯ç”¨ HashMap æ¥å­˜æ”¾æ•°æ®ï¼Œå› ä¸ºå®ƒçš„å†™å…¥æŸ¥è¯¢çš„æ•ˆç‡éƒ½æ¯”è¾ƒé«˜ã€‚ å†™å…¥å’Œåˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨éƒ½æœ‰å¯¹åº”çš„ APIï¼Œæ‰€ä»¥å®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ã€‚ ä¸ºæ­¤æˆ‘å†™äº†ä¸€ä¸ªå•æµ‹ï¼Œåˆ©ç”¨ HashSet æ¥å­˜æ•°æ®ï¼ˆåº•å±‚ä¹Ÿæ˜¯ HashMap ï¼‰ï¼›åŒæ—¶ä¸ºäº†åé¢çš„å¯¹æ¯”å°†å †å†…å­˜å†™æ­»ï¼š 1-Xms64m -Xmx64m -XX:+PrintHeapAtGC -XX:+HeapDumpOnOutOfMemoryError ä¸ºäº†æ–¹ä¾¿è°ƒè¯•åŠ å…¥äº† GC æ—¥å¿—çš„æ‰“å°ï¼Œä»¥åŠå†…å­˜æº¢å‡ºå Dump å†…å­˜ã€‚ 123456789101112131415@Testpublic void hashMapTest()&#123; long star = System.currentTimeMillis(); Set&lt;Integer&gt; hashset = new HashSet&lt;&gt;(100) ; for (int i = 0; i &lt; 100; i++) &#123; hashset.add(i) ; &#125; Assert.assertTrue(hashset.contains(1)); Assert.assertTrue(hashset.contains(2)); Assert.assertTrue(hashset.contains(3)); long end = System.currentTimeMillis(); System.out.println("æ‰§è¡Œæ—¶é—´ï¼š" + (end - star));&#125; å½“æˆ‘åªå†™å…¥ 100 æ¡æ•°æ®æ—¶è‡ªç„¶æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ è¿˜æ˜¯åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œå†™å…¥ 1000W æ•°æ®è¯•è¯•ï¼š æ‰§è¡Œåé©¬ä¸Šå°±å†…å­˜æº¢å‡ºã€‚ å¯è§åœ¨å†…å­˜æœ‰é™çš„æƒ…å†µä¸‹æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚ å®é™…æƒ…å†µä¹Ÿæ˜¯å¦‚æ­¤ï¼›æ—¢ç„¶è¦åˆ¤æ–­ä¸€ä¸ªæ•°æ®æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­ï¼Œè€ƒè™‘çš„ç®—æ³•çš„æ•ˆç‡ä»¥åŠå‡†ç¡®æ€§è‚¯å®šæ˜¯è¦æŠŠæ•°æ®å…¨éƒ¨ load åˆ°å†…å­˜ä¸­çš„ã€‚ Bloom FilteråŸºäºä¸Šé¢åˆ†æçš„æ¡ä»¶ï¼Œè¦å®ç°è¿™ä¸ªéœ€æ±‚æœ€éœ€è¦è§£å†³çš„æ˜¯å¦‚ä½•å°†åºå¤§çš„æ•°æ® load åˆ°å†…å­˜ä¸­ã€‚ è€Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥æ¢ç§æ€è·¯ï¼Œå› ä¸ºåªæ˜¯éœ€è¦åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œä¹Ÿä¸æ˜¯éœ€è¦æŠŠæ•°æ®æŸ¥è¯¢å‡ºæ¥ï¼Œæ‰€ä»¥å®Œå…¨æ²¡æœ‰å¿…è¦å°†çœŸæ­£çš„æ•°æ®å­˜æ”¾è¿›å»ã€‚ ä¼Ÿå¤§çš„ç§‘å­¦å®¶ä»¬å·²ç»å¸®æˆ‘ä»¬æƒ³åˆ°äº†è¿™æ ·çš„éœ€æ±‚ã€‚ Burton Howard Bloom åœ¨ 1970 å¹´æå‡ºäº†ä¸€ä¸ªå«åš Bloom Filterï¼ˆä¸­æ–‡ç¿»è¯‘ï¼šå¸ƒéš†è¿‡æ»¤ï¼‰çš„ç®—æ³•ã€‚ å®ƒä¸»è¦å°±æ˜¯ç”¨äºè§£å†³åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Œä½†å®ƒçš„ä¼˜åŠ¿æ˜¯åªéœ€è¦å ç”¨å¾ˆå°çš„å†…å­˜ç©ºé—´ä»¥åŠæœ‰ç€é«˜æ•ˆçš„æŸ¥è¯¢æ•ˆç‡ã€‚ æ‰€ä»¥åœ¨è¿™ä¸ªåœºæ™¯ä¸‹åœ¨åˆé€‚ä¸è¿‡äº†ã€‚ Bloom Filter åŸç†ä¸‹é¢æ¥åˆ†æä¸‹å®ƒçš„å®ç°åŸç†ã€‚ å®˜æ–¹çš„è¯´æ³•æ˜¯ï¼šå®ƒæ˜¯ä¸€ä¸ªä¿å­˜äº†å¾ˆé•¿çš„äºŒçº§åˆ¶å‘é‡ï¼ŒåŒæ—¶ç»“åˆ Hash å‡½æ•°å®ç°çš„ã€‚ å¬èµ·æ¥æ¯”è¾ƒç»•ï¼Œä½†æ˜¯é€šè¿‡ä¸€ä¸ªå›¾å°±æ¯”è¾ƒå®¹æ˜“ç†è§£äº†ã€‚ å¦‚å›¾æ‰€ç¤ºï¼š é¦–å…ˆéœ€è¦åˆå§‹åŒ–ä¸€ä¸ªäºŒè¿›åˆ¶çš„æ•°ç»„ï¼Œé•¿åº¦è®¾ä¸º Lï¼ˆå›¾ä¸­ä¸º 8ï¼‰ï¼ŒåŒæ—¶åˆå§‹å€¼å…¨ä¸º 0 ã€‚ å½“å†™å…¥ä¸€ä¸ª A1=1000 çš„æ•°æ®æ—¶ï¼Œéœ€è¦è¿›è¡Œ H æ¬¡ hash å‡½æ•°çš„è¿ç®—ï¼ˆè¿™é‡Œä¸º 2 æ¬¡ï¼‰ï¼›ä¸ HashMap æœ‰ç‚¹ç±»ä¼¼ï¼Œé€šè¿‡ç®—å‡ºçš„ HashCode ä¸ L å–æ¨¡åå®šä½åˆ° 0ã€2 å¤„ï¼Œå°†è¯¥å¤„çš„å€¼è®¾ä¸º 1ã€‚ A2=2000 ä¹Ÿæ˜¯åŒç†è®¡ç®—åå°† 4ã€7 ä½ç½®è®¾ä¸º 1ã€‚ å½“æœ‰ä¸€ä¸ª B1=1000 éœ€è¦åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ—¶ï¼Œä¹Ÿæ˜¯åšä¸¤æ¬¡ Hash è¿ç®—ï¼Œå®šä½åˆ° 0ã€2 å¤„ï¼Œæ­¤æ—¶ä»–ä»¬çš„å€¼éƒ½ä¸º 1 ï¼Œæ‰€ä»¥è®¤ä¸º B1=1000 å­˜åœ¨äºé›†åˆä¸­ã€‚ å½“æœ‰ä¸€ä¸ª B2=3000 æ—¶ï¼Œä¹Ÿæ˜¯åŒç†ã€‚ç¬¬ä¸€æ¬¡ Hash å®šä½åˆ° index=4 æ—¶ï¼Œæ•°ç»„ä¸­çš„å€¼ä¸º 1ï¼Œæ‰€ä»¥å†è¿›è¡Œç¬¬äºŒæ¬¡ Hash è¿ç®—ï¼Œç»“æœå®šä½åˆ° index=5 çš„å€¼ä¸º 0ï¼Œæ‰€ä»¥è®¤ä¸º B2=3000 ä¸å­˜åœ¨äºé›†åˆä¸­ã€‚ æ•´ä¸ªçš„å†™å…¥ã€æŸ¥è¯¢çš„æµç¨‹å°±æ˜¯è¿™æ ·ï¼Œæ±‡æ€»èµ·æ¥å°±æ˜¯ï¼š å¯¹å†™å…¥çš„æ•°æ®åš H æ¬¡ hash è¿ç®—å®šä½åˆ°æ•°ç»„ä¸­çš„ä½ç½®ï¼ŒåŒæ—¶å°†æ•°æ®æ”¹ä¸º 1 ã€‚å½“æœ‰æ•°æ®æŸ¥è¯¢æ—¶ä¹Ÿæ˜¯åŒæ ·çš„æ–¹å¼å®šä½åˆ°æ•°ç»„ä¸­ã€‚ä¸€æ—¦å…¶ä¸­çš„æœ‰ä¸€ä½ä¸º 0 åˆ™è®¤ä¸ºæ•°æ®è‚¯å®šä¸å­˜åœ¨äºé›†åˆï¼Œå¦åˆ™æ•°æ®å¯èƒ½å­˜åœ¨äºé›†åˆä¸­ã€‚ æ‰€ä»¥å¸ƒéš†è¿‡æ»¤æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š åªè¦è¿”å›æ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™è‚¯å®šä¸å­˜åœ¨ã€‚ è¿”å›æ•°æ®å­˜åœ¨ï¼Œä½†åªèƒ½æ˜¯å¤§æ¦‚ç‡å­˜åœ¨ã€‚ åŒæ—¶ä¸èƒ½æ¸…é™¤å…¶ä¸­çš„æ•°æ®ã€‚ ç¬¬ä¸€ç‚¹åº”è¯¥éƒ½èƒ½ç†è§£ï¼Œé‡ç‚¹è§£é‡Šä¸‹ 2ã€3 ç‚¹ã€‚ ä¸ºä»€ä¹ˆè¿”å›å­˜åœ¨çš„æ•°æ®å´æ˜¯å¯èƒ½å­˜åœ¨å‘¢ï¼Œè¿™å…¶å®ä¹Ÿå’Œ HashMap ç±»ä¼¼ã€‚ åœ¨æœ‰é™çš„æ•°ç»„é•¿åº¦ä¸­å­˜æ”¾å¤§é‡çš„æ•°æ®ï¼Œå³ä¾¿æ˜¯å†å®Œç¾çš„ Hash ç®—æ³•ä¹Ÿä¼šæœ‰å†²çªï¼Œæ‰€ä»¥æœ‰å¯èƒ½ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„ Aã€B ä¸¤ä¸ªæ•°æ®æœ€åå®šä½åˆ°çš„ä½ç½®æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚ è¿™æ—¶æ‹¿ B è¿›è¡ŒæŸ¥è¯¢æ—¶é‚£è‡ªç„¶å°±æ˜¯è¯¯æŠ¥äº†ã€‚ åˆ é™¤æ•°æ®ä¹Ÿæ˜¯åŒç†ï¼Œå½“æˆ‘æŠŠ B çš„æ•°æ®åˆ é™¤æ—¶ï¼Œå…¶å®ä¹Ÿç›¸å½“äºæ˜¯æŠŠ A çš„æ•°æ®åˆ æ‰äº†ï¼Œè¿™æ ·ä¹Ÿä¼šé€ æˆåç»­çš„è¯¯æŠ¥ã€‚ åŸºäºä»¥ä¸Šçš„ Hash å†²çªçš„å‰æï¼Œæ‰€ä»¥ Bloom Filter æœ‰ä¸€å®šçš„è¯¯æŠ¥ç‡ï¼Œè¿™ä¸ªè¯¯æŠ¥ç‡å’Œ Hash ç®—æ³•çš„æ¬¡æ•° Hï¼Œä»¥åŠæ•°ç»„é•¿åº¦ L éƒ½æ˜¯æœ‰å…³çš„ã€‚ è‡ªå·±å®ç°ä¸€ä¸ªå¸ƒéš†è¿‡æ»¤ç®—æ³•å…¶å®å¾ˆç®€å•ä¸éš¾ç†è§£ï¼Œäºæ˜¯åˆ©ç”¨ Java å®ç°äº†ä¸€ä¸ªç®€å•çš„é›å½¢ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113public class BloomFilters &#123; /** * æ•°ç»„é•¿åº¦ */ private int arraySize; /** * æ•°ç»„ */ private int[] array; public BloomFilters(int arraySize) &#123; this.arraySize = arraySize; array = new int[arraySize]; &#125; /** * å†™å…¥æ•°æ® * @param key */ public void add(String key) &#123; int first = hashcode_1(key); int second = hashcode_2(key); int third = hashcode_3(key); array[first % arraySize] = 1; array[second % arraySize] = 1; array[third % arraySize] = 1; &#125; /** * åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ * @param key * @return */ public boolean check(String key) &#123; int first = hashcode_1(key); int second = hashcode_2(key); int third = hashcode_3(key); int firstIndex = array[first % arraySize]; if (firstIndex == 0) &#123; return false; &#125; int secondIndex = array[second % arraySize]; if (secondIndex == 0) &#123; return false; &#125; int thirdIndex = array[third % arraySize]; if (thirdIndex == 0) &#123; return false; &#125; return true; &#125; /** * hash ç®—æ³•1 * @param key * @return */ private int hashcode_1(String key) &#123; int hash = 0; int i; for (i = 0; i &lt; key.length(); ++i) &#123; hash = 33 * hash + key.charAt(i); &#125; return Math.abs(hash); &#125; /** * hash ç®—æ³•2 * @param data * @return */ private int hashcode_2(String data) &#123; final int p = 16777619; int hash = (int) 2166136261L; for (int i = 0; i &lt; data.length(); i++) &#123; hash = (hash ^ data.charAt(i)) * p; &#125; hash += hash &lt;&lt; 13; hash ^= hash &gt;&gt; 7; hash += hash &lt;&lt; 3; hash ^= hash &gt;&gt; 17; hash += hash &lt;&lt; 5; return Math.abs(hash); &#125; /** * hash ç®—æ³•3 * @param key * @return */ private int hashcode_3(String key) &#123; int hash, i; for (hash = 0, i = 0; i &lt; key.length(); ++i) &#123; hash += key.charAt(i); hash += (hash &lt;&lt; 10); hash ^= (hash &gt;&gt; 6); &#125; hash += (hash &lt;&lt; 3); hash ^= (hash &gt;&gt; 11); hash += (hash &lt;&lt; 15); return Math.abs(hash); &#125;&#125; é¦–å…ˆåˆå§‹åŒ–äº†ä¸€ä¸ª int æ•°ç»„ã€‚ å†™å…¥æ•°æ®çš„æ—¶å€™è¿›è¡Œä¸‰æ¬¡ hash è¿ç®—ï¼ŒåŒæ—¶æŠŠå¯¹åº”çš„ä½ç½®ç½®ä¸º 1ã€‚ æŸ¥è¯¢æ—¶åŒæ ·çš„ä¸‰æ¬¡ hash è¿ç®—ï¼Œå–åˆ°å¯¹åº”çš„å€¼ï¼Œä¸€æ—¦å€¼ä¸º 0 ï¼Œåˆ™è®¤ä¸ºæ•°æ®ä¸å­˜åœ¨ã€‚ å®ç°é€»è¾‘å…¶å®å°±å’Œä¸Šæ–‡æè¿°çš„ä¸€æ ·ã€‚ ä¸‹é¢æ¥æµ‹è¯•ä¸€ä¸‹ï¼ŒåŒæ ·çš„å‚æ•°ï¼š 1-Xms64m -Xmx64m -XX:+PrintHeapAtGC 123456789101112131415@Testpublic void bloomFilterTest()&#123; long star = System.currentTimeMillis(); BloomFilters bloomFilters = new BloomFilters(10000000) ; for (int i = 0; i &lt; 10000000; i++) &#123; bloomFilters.add(i + "") ; &#125; Assert.assertTrue(bloomFilters.check(1+"")); Assert.assertTrue(bloomFilters.check(2+"")); Assert.assertTrue(bloomFilters.check(3+"")); Assert.assertTrue(bloomFilters.check(999999+"")); Assert.assertFalse(bloomFilters.check(400230340+"")); long end = System.currentTimeMillis(); System.out.println("æ‰§è¡Œæ—¶é—´ï¼š" + (end - star));&#125; æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š åªèŠ±äº† 3 ç§’é’Ÿå°±å†™å…¥äº† 1000W çš„æ•°æ®åŒæ—¶åšå‡ºæ¥å‡†ç¡®çš„åˆ¤æ–­ã€‚ å½“è®©æˆ‘æŠŠæ•°ç»„é•¿åº¦ç¼©å°åˆ°äº† 100W æ—¶å°±å‡ºç°äº†ä¸€ä¸ªè¯¯æŠ¥ï¼Œ400230340 è¿™ä¸ªæ•°æ˜æ˜æ²¡åœ¨é›†åˆé‡Œï¼Œå´è¿”å›äº†å­˜åœ¨ã€‚ è¿™ä¹Ÿä½“ç°äº† Bloom Filter çš„è¯¯æŠ¥ç‡ã€‚ æˆ‘ä»¬æé«˜æ•°ç»„é•¿åº¦ä»¥åŠ hash è®¡ç®—æ¬¡æ•°å¯ä»¥é™ä½è¯¯æŠ¥ç‡ï¼Œä½†ç›¸åº”çš„ CPUã€å†…å­˜çš„æ¶ˆè€—å°±ä¼šæé«˜ï¼›è¿™å°±éœ€è¦æ ¹æ®ä¸šåŠ¡éœ€è¦è‡ªè¡Œæƒè¡¡ã€‚ Guava å®ç° åˆšæ‰çš„æ–¹å¼è™½ç„¶å®ç°äº†åŠŸèƒ½ï¼Œä¹Ÿæ»¡è¶³äº†å¤§é‡æ•°æ®ã€‚ä½†å…¶å®è§‚å¯Ÿ GC æ—¥å¿—éå¸¸é¢‘ç¹ï¼ŒåŒæ—¶è€å¹´ä»£ä¹Ÿä½¿ç”¨äº† 90%ï¼Œæ¥è¿‘å´©æºƒçš„è¾¹ç¼˜ã€‚ æ€»çš„æ¥è¯´å°±æ˜¯å†…å­˜åˆ©ç”¨ç‡åšçš„ä¸å¥½ã€‚ å…¶å® Google Guava åº“ä¸­ä¹Ÿå®ç°äº†è¯¥ç®—æ³•ï¼Œä¸‹é¢æ¥çœ‹çœ‹ä¸šç•Œæƒå¨çš„å®ç°ã€‚ 1-Xms64m -Xmx64m -XX:+PrintHeapAtGC 12345678910111213141516171819@Testpublic void guavaTest() &#123; long star = System.currentTimeMillis(); BloomFilter&lt;Integer&gt; filter = BloomFilter.create( Funnels.integerFunnel(), 10000000, 0.01); for (int i = 0; i &lt; 10000000; i++) &#123; filter.put(i); &#125; Assert.assertTrue(filter.mightContain(1)); Assert.assertTrue(filter.mightContain(2)); Assert.assertTrue(filter.mightContain(3)); Assert.assertFalse(filter.mightContain(10000000)); long end = System.currentTimeMillis(); System.out.println("æ‰§è¡Œæ—¶é—´ï¼š" + (end - star));&#125; ä¹Ÿæ˜¯åŒæ ·å†™å…¥äº† 1000W çš„æ•°æ®ï¼Œæ‰§è¡Œæ²¡æœ‰é—®é¢˜ã€‚ è§‚å¯Ÿ GC æ—¥å¿—ä¼šå‘ç°æ²¡æœ‰ä¸€æ¬¡ fullGCï¼ŒåŒæ—¶è€å¹´ä»£çš„ä½¿ç”¨ç‡å¾ˆä½ã€‚å’Œåˆšæ‰çš„ä¸€å¯¹æ¯”è¿™é‡Œæ˜æ˜¾çš„è¦å¥½ä¸Šå¾ˆå¤šï¼Œä¹Ÿå¯ä»¥å†™å…¥æ›´å¤šçš„æ•°æ®ã€‚ æºç åˆ†æé‚£å°±æ¥çœ‹çœ‹ Guava å®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚ æ„é€ æ–¹æ³•ä¸­æœ‰ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„å‚æ•°ï¼Œä¸€ä¸ªæ˜¯é¢„è®¡å­˜æ”¾å¤šå°‘æ•°æ®ï¼Œä¸€ä¸ªæ˜¯å¯ä»¥æ¥å—çš„è¯¯æŠ¥ç‡ã€‚æˆ‘è¿™é‡Œçš„æµ‹è¯• demo åˆ†åˆ«æ˜¯ 1000W ä»¥åŠ 0.01ã€‚ Guava ä¼šé€šè¿‡ä½ é¢„è®¡çš„æ•°é‡ä»¥åŠè¯¯æŠ¥ç‡å¸®ä½ è®¡ç®—å‡ºä½ åº”å½“ä¼šä½¿ç”¨çš„æ•°ç»„å¤§å° numBits ä»¥åŠéœ€è¦è®¡ç®—å‡ æ¬¡ Hash å‡½æ•° numHashFunctions ã€‚ è¿™ä¸ªç®—æ³•è®¡ç®—è§„åˆ™å¯ä»¥å‚è€ƒç»´åŸºç™¾ç§‘ã€‚ put å†™å…¥å‡½æ•°çœŸæ­£å­˜æ”¾æ•°æ®çš„ put å‡½æ•°å¦‚ä¸‹ï¼š æ ¹æ® murmur3_128 æ–¹æ³•çš„åˆ°ä¸€ä¸ª 128 ä½é•¿åº¦çš„ byte[]ã€‚ åˆ†åˆ«å–é«˜ä½ 8 ä½çš„åˆ°ä¸¤ä¸ª hash å€¼ã€‚ å†æ ¹æ®åˆå§‹åŒ–æ—¶çš„åˆ°çš„æ‰§è¡Œ hash çš„æ¬¡æ•°è¿›è¡Œ hash è¿ç®—ã€‚ 1bitsChanged |= bits.set((combinedHash &amp; Long.MAX_VALUE) % bitSize); å…¶å®ä¹Ÿæ˜¯ hashå–æ¨¡æ‹¿åˆ° index åå»èµ‹å€¼ 1. é‡ç‚¹æ˜¯ bits.set() æ–¹æ³•ã€‚ å…¶å® set æ–¹æ³•æ˜¯ BitArray ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼ŒBitArray å°±æ˜¯çœŸæ­£å­˜æ”¾æ•°æ®çš„åº•å±‚æ•°æ®ç»“æ„ã€‚ åˆ©ç”¨äº†ä¸€ä¸ª long[] data æ¥å­˜æ”¾æ•°æ®ã€‚ æ‰€ä»¥ set() æ—¶å€™ä¹Ÿæ˜¯å¯¹è¿™ä¸ª data åšå¤„ç†ã€‚ åœ¨ set ä¹‹å‰å…ˆé€šè¿‡ get() åˆ¤æ–­è¿™ä¸ªæ•°æ®æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­ï¼Œå¦‚æœå·²ç»å­˜åœ¨åˆ™ç›´æ¥è¿”å›å‘ŠçŸ¥å®¢æˆ·ç«¯å†™å…¥å¤±è´¥ã€‚ æ¥ä¸‹æ¥å°±æ˜¯é€šè¿‡ä½è¿ç®—è¿›è¡Œä½æˆ–èµ‹å€¼ã€‚ get() æ–¹æ³•çš„è®¡ç®—é€»è¾‘å’Œ set ç±»ä¼¼ï¼Œåªè¦åˆ¤æ–­ä¸º 0 å°±ç›´æ¥è¿”å›å­˜åœ¨è¯¥å€¼ã€‚ mightContain æ˜¯å¦å­˜åœ¨å‡½æ•° å‰é¢å‡ æ­¥çš„é€»è¾‘éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œåªæ˜¯è°ƒç”¨äº†åˆšæ‰çš„ get() æ–¹æ³•åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨è€Œå·²ã€‚ æ€»ç»“å¸ƒéš†è¿‡æ»¤çš„åº”ç”¨è¿˜æ˜¯è›®å¤šçš„ï¼Œæ¯”å¦‚æ•°æ®åº“ã€çˆ¬è™«ã€é˜²ç¼“å­˜å‡»ç©¿ç­‰ã€‚ ç‰¹åˆ«æ˜¯éœ€è¦ç²¾ç¡®çŸ¥é“æŸä¸ªæ•°æ®ä¸å­˜åœ¨æ—¶åšç‚¹ä»€ä¹ˆäº‹æƒ…å°±éå¸¸é€‚åˆå¸ƒéš†è¿‡æ»¤ã€‚ è¿™æ®µæ—¶é—´çš„ç ”ç©¶å‘ç°ç®—æ³•ä¹ŸæŒºæœ‰æ„æ€çš„ï¼Œåç»­åº”è¯¥ä¼šç»§ç»­åˆ†äº«ä¸€äº›ç±»ä¼¼çš„å†…å®¹ã€‚ å¦‚æœå¯¹ä½ æœ‰å¸®åŠ©é‚£å°±åˆ†äº«ä¸€ä¸‹å§ã€‚ æœ¬é—®çš„ç¤ºä¾‹ä»£ç å‚è€ƒè¿™é‡Œï¼š https://github.com/crossoverJie/JCSprout ä½ çš„ç‚¹èµä¸åˆ†äº«æ˜¯å¯¹æˆ‘æœ€å¤§çš„æ”¯æŒ]]></content>
      <categories>
        <category>Guava</category>
      </categories>
      <tags>
        <tag>Bloom Filter</tag>
        <tag>ç®—æ³•</tag>
        <tag>Hash</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†äº«ä¸€äº› Kafka æ¶ˆè´¹æ•°æ®çš„å°ç»éªŒ]]></title>
    <url>%2F2018%2F11%2F20%2Fkafka%2Fkafka-consumer%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¹‹å‰å†™è¿‡ä¸€ç¯‡ã€Šä»æºç åˆ†æå¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨ Kafka ç”Ÿäº§è€…ã€‹ ï¼Œæœ‰ç”Ÿäº§è€…è‡ªç„¶ä¹Ÿå°±æœ‰æ¶ˆè´¹è€…ã€‚ å»ºè®®å¯¹ Kakfa è¿˜æ¯”è¾ƒé™Œç”Ÿçš„æœ‹å‹å¯ä»¥å…ˆçœ‹çœ‹ã€‚ å°±æˆ‘çš„ä½¿ç”¨ç»éªŒæ¥è¯´ï¼Œå¤§éƒ¨åˆ†æƒ…å†µéƒ½æ˜¯å¤„äºæ•°æ®ä¸‹æ¸¸çš„æ¶ˆè´¹è€…è§’è‰²ã€‚ä¹Ÿç”¨ Kafka æ¶ˆè´¹è¿‡æ—¥å‡è¿‡äº¿çš„æ¶ˆæ¯ï¼ˆä¸å¾—ä¸ä½©æœ Kakfa çš„è®¾è®¡ï¼‰ï¼Œæœ¬æ–‡å°†å€ŸåŠ©æˆ‘ä½¿ç”¨ Kakfa æ¶ˆè´¹æ•°æ®çš„ç»éªŒæ¥èŠèŠå¦‚ä½•é«˜æ•ˆçš„æ¶ˆè´¹æ•°æ®ã€‚ å•çº¿ç¨‹æ¶ˆè´¹ä»¥ä¹‹å‰ç”Ÿäº§è€…ä¸­çš„ä»£ç ä¸ºä¾‹ï¼Œäº‹å…ˆå‡†å¤‡å¥½äº†ä¸€ä¸ª Topic:data-pushï¼Œ3ä¸ªåˆ†åŒºã€‚ å…ˆå¾€é‡Œè¾¹å‘é€ 100 æ¡æ¶ˆæ¯ï¼Œæ²¡æœ‰è‡ªå®šä¹‰è·¯ç”±ç­–ç•¥ï¼Œæ‰€ä»¥æ¶ˆæ¯ä¼šå‡åŒ€çš„å‘å¾€ä¸‰ä¸ªåˆ†åŒºã€‚ å…ˆæ¥è°ˆè°ˆæœ€ç®€å•çš„å•çº¿ç¨‹æ¶ˆè´¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç”±äºæ•°æ®æ•£åˆ—åœ¨ä¸‰ä¸ªä¸åŒåˆ†åŒºï¼Œæ‰€ä»¥å•ä¸ªçº¿ç¨‹éœ€è¦éå†ä¸‰ä¸ªåˆ†åŒºå°†æ•°æ®æ‹‰å–ä¸‹æ¥ã€‚ å•çº¿ç¨‹æ¶ˆè´¹çš„ç¤ºä¾‹ä»£ç ï¼š è¿™æ®µä»£ç å¤§å®¶åœ¨å®˜ç½‘ä¹Ÿå¯ä»¥æ‰¾åˆ°ï¼šå°†æ•°æ®å–å‡ºæ”¾åˆ°ä¸€ä¸ªå†…å­˜ç¼“å†²ä¸­æœ€åå†™å…¥æ•°æ®åº“çš„è¿‡ç¨‹ã€‚ å…ˆä¸è®¨è®ºå…¶ä¸­çš„ offset çš„æäº¤æ–¹å¼ã€‚ é€šè¿‡æ¶ˆè´¹æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼š å–å‡ºçš„ 100 æ¡æ•°æ®ç¡®å®æ˜¯åˆ†åˆ«éå†äº†ä¸‰ä¸ªåˆ†åŒºã€‚ å•çº¿ç¨‹æ¶ˆè´¹è™½ç„¶ç®€å•ï¼Œä½†å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š æ•ˆç‡ä½ä¸‹ã€‚å¦‚æœåˆ†åŒºæ•°å‡ åä¸Šç™¾ä¸ªï¼Œå•çº¿ç¨‹æ— æ³•é«˜æ•ˆçš„å–å‡ºæ•°æ®ã€‚ å¯ç”¨æ€§å¾ˆä½ã€‚ä¸€æ—¦æ¶ˆè´¹çº¿ç¨‹é˜»å¡ï¼Œç”šè‡³æ˜¯è¿›ç¨‹æŒ‚æ‰ï¼Œé‚£ä¹ˆæ•´ä¸ªæ¶ˆè´¹ç¨‹åºéƒ½å°†å‡ºç°é—®é¢˜ã€‚ å¤šçº¿ç¨‹æ¶ˆè´¹æ—¢ç„¶å•çº¿ç¨‹æœ‰è¯¸å¤šé—®é¢˜ï¼Œé‚£æ˜¯å¦å¯ä»¥ç”¨å¤šçº¿ç¨‹æ¥æé«˜æ•ˆç‡å‘¢ï¼Ÿ åœ¨å¤šçº¿ç¨‹ä¹‹å‰ä¸å¾—ä¸å°†æ¶ˆè´¹æ¨¡å¼åˆ†ä¸ºä¸¤ç§è¿›è¡Œæ¢è®¨ï¼šæ¶ˆè´¹ç»„ã€ç‹¬ç«‹æ¶ˆè´¹è€…ã€‚ è¿™ä¸¤ç§æ¶ˆè´¹æ¨¡å¼å¯¹åº”çš„å¤„ç†æ–¹å¼æœ‰ç€å¾ˆå¤§çš„ä¸åŒï¼Œæ‰€ä»¥å¾ˆæœ‰å¿…è¦å•ç‹¬æ¥è®²ã€‚ ç‹¬ç«‹æ¶ˆè´¹è€…æ¨¡å¼å…ˆä»ç‹¬ç«‹æ¶ˆè´¹è€…æ¨¡å¼è°ˆèµ·ï¼Œè¿™ç§æ¨¡å¼ç›¸å¯¹äºæ¶ˆè´¹ç»„æ¥è¯´ç”¨çš„ç›¸å¯¹å°ä¼—ä¸€äº›ã€‚ çœ‹ä¸€ä¸ªç®€å•ç¤ºä¾‹å³å¯çŸ¥é“å®ƒçš„ç”¨æ³•ï¼š å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šç‹¬ç«‹æ¶ˆè´¹è€…å¯ä»¥ä¸è®¾ç½® group.id å±æ€§ã€‚ ä¹Ÿæ˜¯å‘é€100æ¡æ¶ˆæ¯ï¼Œæ¶ˆè´¹ç»“æœå¦‚ä¸‹ï¼š é€šè¿‡ API å¯ä»¥çœ‹å‡ºï¼šæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æŒ‡å®šéœ€è¦æ¶ˆè´¹å“ªäº›åˆ†åŒºã€‚ æ¯”å¦‚ data-push Topic æœ‰ä¸‰ä¸ªåˆ†åŒºï¼Œæˆ‘å¯ä»¥æ‰‹åŠ¨åªæ¶ˆè´¹å…¶ä¸­çš„ 1 2 åˆ†åŒºï¼Œç¬¬ä¸‰ä¸ªå¯ä»¥è§†æƒ…å†µæ¥æ¶ˆè´¹ã€‚ åŒæ—¶å®ƒä¹Ÿæ”¯æŒå¤šçº¿ç¨‹çš„æ–¹å¼ï¼Œæ¯ä¸ªçº¿ç¨‹æ¶ˆè´¹æŒ‡å®šåˆ†åŒºè¿›è¡Œæ¶ˆè´¹ã€‚ ä¸ºäº†ç›´è§‚ï¼Œåªå‘é€äº† 10 æ¡æ•°æ®ã€‚ æ ¹æ®æ¶ˆè´¹ç»“æœå¯ä»¥çœ‹å‡ºï¼š c1 çº¿ç¨‹åªå– 0 åˆ†åŒºï¼›c2 åªå– 1 åˆ†åŒºï¼›c3 åªå– 2 åˆ†åŒºçš„æ•°æ®ã€‚ ç”šè‡³æˆ‘ä»¬å¯ä»¥å°†æ¶ˆè´¹è€…å¤šè¿›ç¨‹éƒ¨ç½²ï¼Œè¿™æ ·çš„æ¶ˆè´¹æ–¹å¼å¦‚ä¸‹ï¼š å‡è®¾ Topic:data-push çš„åˆ†åŒºæ•°ä¸º 4 ä¸ªï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥æŒ‰ç…§å›¾ä¸­çš„æ–¹å¼åˆ›å»ºä¸¤ä¸ªè¿›ç¨‹ã€‚ æ¯ä¸ªè¿›ç¨‹å†…æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å†å»æ¶ˆè´¹å¯¹åº”çš„åˆ†åŒºã€‚ è¿™æ ·å½“æˆ‘ä»¬æ€§èƒ½ä¸å¤Ÿæ–°å¢ Topic çš„åˆ†åŒºæ•°æ—¶ï¼Œæ¶ˆè´¹è€…è¿™è¾¹åªéœ€è¦è¿™æ ·æ°´å¹³æ‰©å±•å³å¯ï¼Œéå¸¸çš„çµæ´»ã€‚ è¿™ç§è‡ªå®šä¹‰åˆ†åŒºæ¶ˆè´¹çš„æ–¹å¼åœ¨æŸäº›åœºæ™¯ä¸‹è¿˜æ˜¯é€‚ç”¨çš„ï¼Œæ¯”å¦‚ç”Ÿäº§è€…æ¯æ¬¡éƒ½å°†æŸä¸€ç±»çš„æ•°æ®åªå‘å¾€ä¸€ä¸ªåˆ†åŒºã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åªé’ˆå¯¹è¿™ä¸€ä¸ªåˆ†åŒºæ¶ˆè´¹ã€‚ ä½†è¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¯ç”¨æ€§ä¸é«˜ï¼Œå½“å…¶ä¸­ä¸€ä¸ªè¿›ç¨‹æŒ‚æ‰ä¹‹åï¼›è¯¥è¿›ç¨‹è´Ÿè´£çš„åˆ†åŒºæ•°æ®æ²¡æ³•è½¬ç§»ç»™å…¶ä»–è¿›ç¨‹å¤„ç†ã€‚ æ¶ˆè´¹ç»„æ¨¡å¼æ¶ˆè´¹ç»„æ¨¡å¼åº”å½“æ˜¯ä½¿ç”¨æœ€å¤šçš„ä¸€ç§æ¶ˆè´¹æ–¹å¼ã€‚ æˆ‘ä»¬å¯ä»¥åˆ›å»º N ä¸ªæ¶ˆè´¹è€…å®ä¾‹ï¼ˆnew KafkaConsumer()ï¼‰,å½“è¿™äº›å®ä¾‹éƒ½ç”¨åŒä¸€ä¸ª group.id æ¥åˆ›å»ºæ—¶ï¼Œä»–ä»¬å°±å±äºåŒä¸€ä¸ªæ¶ˆè´¹ç»„ã€‚ åœ¨åŒä¸€ä¸ªæ¶ˆè´¹ç»„ä¸­çš„æ¶ˆè´¹å®ä¾‹å¯ä»¥æ”¶åˆ°æ¶ˆæ¯ï¼Œä½†ä¸€ä¸ªåˆ†åŒºçš„æ¶ˆæ¯åªä¼šå‘å¾€ä¸€ä¸ªæ¶ˆè´¹å®ä¾‹ã€‚ è¿˜æ˜¯å€ŸåŠ©å®˜æ–¹çš„ç¤ºä¾‹å›¾æ¥æ›´å¥½çš„ç†è§£å®ƒã€‚ æŸä¸ª Topic æœ‰å››ä¸ªåˆ†åŒº p0 p1 p2 p3ï¼ŒåŒæ—¶åˆ›å»ºäº†ä¸¤ä¸ªæ¶ˆè´¹ç»„ groupAï¼ŒgroupBã€‚ A æ¶ˆè´¹ç»„ä¸­æœ‰ä¸¤ä¸ªæ¶ˆè´¹å®ä¾‹ C1ã€C2ã€‚ B æ¶ˆè´¹ç»„ä¸­æœ‰å››ä¸ªæ¶ˆè´¹å®ä¾‹ C3ã€C4ã€C5ã€C6ã€‚ è¿™æ ·æ¶ˆæ¯æ˜¯å¦‚ä½•åˆ’åˆ†åˆ°æ¯ä¸ªæ¶ˆè´¹å®ä¾‹çš„å‘¢ï¼Ÿ é€šè¿‡å›¾ä¸­å¯ä»¥å¾—çŸ¥ï¼š A ç»„ä¸­çš„ C1 æ¶ˆè´¹äº† P0 å’Œ P3 åˆ†åŒºï¼›C2 æ¶ˆè´¹ P1ã€P2 åˆ†åŒºã€‚ B ç»„æœ‰å››ä¸ªå®ä¾‹ï¼Œæ‰€ä»¥æ¯ä¸ªå®ä¾‹æ¶ˆè´¹ä¸€ä¸ªåˆ†åŒºï¼›ä¹Ÿå°±æ˜¯æ¶ˆè´¹å®ä¾‹å’Œåˆ†åŒºæ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼š è¿™é‡Œçš„æ¶ˆè´¹å®ä¾‹ç®€å•çš„å¯ä»¥ç†è§£ä¸º new KafkaConsumerï¼Œå®ƒå’Œè¿›ç¨‹æ²¡æœ‰å…³ç³»ã€‚ æ¯”å¦‚è¯´æŸä¸ª Topic æœ‰ä¸‰ä¸ªåˆ†åŒºï¼Œä½†æ˜¯æˆ‘å¯åŠ¨äº†ä¸¤ä¸ªè¿›ç¨‹æ¥æ¶ˆè´¹å®ƒã€‚ å…¶ä¸­æ¯ä¸ªè¿›ç¨‹æœ‰ä¸¤ä¸ªæ¶ˆè´¹å®ä¾‹ï¼Œé‚£å…¶å®å°±ç›¸å½“äºæœ‰å››ä¸ªå®ä¾‹äº†ã€‚ è¿™æ—¶å¯èƒ½å°±ä¼šé—® 4 ä¸ªå®ä¾‹æ€ä¹ˆæ¶ˆè´¹ 3 ä¸ªåˆ†åŒºå‘¢ï¼Ÿ æ¶ˆè´¹ç»„è‡ªå¹³è¡¡è¿™ä¸ª Kafka å·²ç»å¸®æˆ‘åšå¥½äº†ï¼Œå®ƒä¼šæ¥åšæ¶ˆè´¹ç»„é‡Œçš„ Rebalanceã€‚ æ¯”å¦‚ä¸Šé¢çš„æƒ…å†µï¼Œ3 ä¸ªåˆ†åŒºå´æœ‰ 4 ä¸ªæ¶ˆè´¹å®ä¾‹ï¼›æœ€ç»ˆè‚¯å®šåªæœ‰ä¸‰ä¸ªå®ä¾‹èƒ½å–åˆ°æ¶ˆæ¯ã€‚ä½†è‡³äºæ˜¯å“ªä¸‰ä¸ªå‘¢ï¼Œè¿™ç‚¹ Kakfa ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åˆ†é…å¥½ã€‚ çœ‹ä¸ªä¾‹å­ï¼Œè¿˜åœ¨ä¹‹å‰çš„ data-push è¿™ä¸ª Topicï¼Œå…¶ä¸­æœ‰ä¸‰ä¸ªåˆ†åŒºã€‚ å½“å…¶ä¸­ä¸€ä¸ªè¿›ç¨‹ï¼ˆå…¶ä¸­æœ‰ä¸‰ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªæ¶ˆè´¹å®ä¾‹ï¼‰æ—¶ï¼Œæ¶ˆè´¹ç»“æœå¦‚ä¸‹ï¼š é‡Œè¾¹çš„ 20 æ¡æ•°æ®éƒ½è¢«è¿™ä¸ªè¿›ç¨‹çš„ä¸‰ä¸ªå®ä¾‹æ¶ˆè´¹æ‰ã€‚ è¿™æ—¶æˆ‘æ–°å¯åŠ¨äº†ä¸€ä¸ªè¿›ç¨‹ï¼Œç¨‹åºå’Œä¸Šé¢é‚£ä¸ªä¸€æ¨¡ä¸€æ ·ï¼›è¿™æ ·å°±ç›¸å½“äºæœ‰ä¸¤ä¸ªè¿›ç¨‹ï¼ŒåŒæ—¶å°±æ˜¯ 6 ä¸ªå®ä¾‹ã€‚ æˆ‘å†å‘é€ 10 æ¡æ¶ˆæ¯ä¼šå‘ç°ï¼š è¿›ç¨‹1 åªå–åˆ°äº†åˆ†åŒº 1 é‡Œçš„ä¸¤æ¡æ•°æ®ï¼ˆä¹‹å‰æ˜¯æ‰€æœ‰æ•°æ®éƒ½æ˜¯è¿›ç¨‹1é‡Œçš„çº¿ç¨‹è·å–çš„ï¼‰ã€‚ åŒæ—¶è¿›ç¨‹2åˆ™æ¶ˆè´¹äº†å‰©ä¸‹çš„ 8 æ¡æ¶ˆæ¯ï¼Œåˆ†åˆ«æ˜¯åˆ†åŒº 0ã€2 çš„æ•°æ®ï¼ˆæ€»çš„è¿˜æ˜¯åªæœ‰ä¸‰ä¸ªå®ä¾‹å–åˆ°äº†æ•°æ®ï¼Œåªæ˜¯åˆ†åˆ«åœ¨ä¸åŒçš„è¿›ç¨‹é‡Œï¼‰ã€‚ å½“æˆ‘å…³æ‰è¿›ç¨‹2ï¼Œå†å‘é€10æ¡æ•°æ®æ—¶ä¼šå‘ç°æ‰€æœ‰æ•°æ®åˆè¢«è¿›ç¨‹1é‡Œçš„ä¸‰ä¸ªçº¿ç¨‹æ¶ˆè´¹äº†ã€‚ é€šè¿‡è¿™äº›æµ‹è¯•ç›¸ä¿¡å¤§å®¶å·²ç»å¯ä»¥çœ‹åˆ°æ¶ˆè´¹ç»„çš„ä¼˜åŠ¿äº†ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªæ¶ˆè´¹ç»„ä¸­åˆ›å»ºå¤šä¸ªæ¶ˆè´¹å®ä¾‹æ¥è¾¾åˆ°é«˜å¯ç”¨ã€é«˜å®¹é”™çš„ç‰¹æ€§ï¼Œä¸ä¼šå‡ºç°å•çº¿ç¨‹ä»¥åŠç‹¬ç«‹æ¶ˆè´¹è€…æŒ‚æ‰ä¹‹åæ•°æ®ä¸èƒ½æ¶ˆè´¹çš„æƒ…å†µã€‚åŒæ—¶åŸºäºå¤šçº¿ç¨‹çš„æ–¹å¼ä¹Ÿæå¤§çš„æé«˜äº†æ¶ˆè´¹æ•ˆç‡ã€‚ è€Œå½“æ–°å¢æ¶ˆè´¹å®ä¾‹æˆ–è€…æ˜¯æ¶ˆè´¹å®ä¾‹æŒ‚æ‰æ—¶ Kakfa ä¼šä¸ºæˆ‘ä»¬é‡æ–°åˆ†é…æ¶ˆè´¹å®ä¾‹ä¸åˆ†åŒºçš„å…³ç³»å°±è¢«ç§°ä¸ºæ¶ˆè´¹ç»„ Rebalanceã€‚ å‘ç”Ÿè¿™ä¸ªçš„å‰ææ¡ä»¶ä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š æ¶ˆè´¹ç»„ä¸­æ–°å¢æ¶ˆè´¹å®ä¾‹ã€‚ æ¶ˆè´¹ç»„ä¸­æ¶ˆè´¹å®ä¾‹ down æ‰ã€‚ è®¢é˜…çš„ Topic åˆ†åŒºæ•°å‘ç”Ÿå˜åŒ–ã€‚ å¦‚æœæ˜¯æ­£åˆ™è®¢é˜… Topic æ—¶ï¼ŒåŒ¹é…çš„ Topic æ•°å‘ç”Ÿå˜åŒ–ä¹Ÿä¼šå¯¼è‡´ Rebalanceã€‚ æ‰€ä»¥æ¨èä½¿ç”¨è¿™æ ·çš„æ–¹å¼æ¶ˆè´¹æ•°æ®ï¼ŒåŒæ—¶æ‰©å±•æ€§ä¹Ÿéå¸¸å¥½ã€‚å½“æ€§èƒ½ä¸è¶³æ–°å¢åˆ†åŒºæ—¶åªéœ€è¦å¯åŠ¨æ–°çš„æ¶ˆè´¹å®ä¾‹åŠ å…¥åˆ°æ¶ˆè´¹ç»„ä¸­å³å¯ã€‚ æ€»ç»“æœ¬æ¬¡åªåˆ†äº«äº†å‡ ä¸ªä¸åŒæ¶ˆè´¹æ•°æ®çš„æ–¹å¼ï¼Œå¹¶æ²¡æœ‰ç€é‡ç ”ç©¶æ¶ˆè´¹å‚æ•°ã€æºç ï¼›è¿™äº›å†…å®¹æ„Ÿå…´è¶£çš„è¯å¯ä»¥åœ¨ä¸‹æ¬¡åˆ†äº«ã€‚ æ–‡ä¸­æåˆ°çš„éƒ¨åˆ†æºç å¯ä»¥åœ¨è¿™é‡ŒæŸ¥é˜…ï¼š https://github.com/crossoverJie/JCSprout æ¬¢è¿å…³æ³¨å…¬ä¼—å·ä¸€èµ·äº¤æµï¼š]]></content>
      <categories>
        <category>Kafka</category>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Kafka</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡ä¸€ä¸ªå¯æ‹”æ’çš„ IOC å®¹å™¨]]></title>
    <url>%2F2018%2F11%2F15%2Fwheel%2Fcicada6%2F</url>
    <content type="text"><![CDATA[å‰è¨€ç£¨äº†è®¸ä¹…ï¼Œå€ŸåŠ©æœ€è¿‘çš„ä¸€æ¬¡é€šå®µä¸Šçº¿ cicada ç»ˆäºæ›´æ–°äº† v2.0.0 ç‰ˆæœ¬ã€‚ ä¹‹æ‰€ä»¥å¤§çš„ç‰ˆæœ¬å·å˜ä¸º 2ï¼Œç¡®å®æ˜¯å‘ä¸‹ä¸å…¼å®¹äº†ï¼›ä¸»è¦è¡¨ç°ä¸ºï¼š ä¿®å¤äº†å‡ ä¸ªåé¦ˆçš„ bugã€‚ çµæ´»çš„è·¯ç”±æ–¹å¼ã€‚ å¯æ‹”æ’çš„ IOC å®¹å™¨é€‰æ‹©ã€‚ å…¶ä¸­é‡ç‚¹æ˜¯åé¢ä¸¤ä¸ªã€‚ æ–°çš„è·¯ç”±æ–¹å¼å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªï¼šè·¯ç”±æ–¹å¼çš„æ›´æ–°ã€‚ åœ¨ä¹‹å‰çš„ç‰ˆæœ¬æƒ³è¦å†™ä¸€ä¸ªæ¥å£å¿…é¡»çš„å®ç°ä¸€ä¸ª WorkActionï¼›è€Œä¸”æœ€éº»çƒ¦çš„æ˜¯ä¸€ä¸ªå®ç°ç±»åªèƒ½åšä¸€ä¸ªæ¥å£ã€‚ å› æ­¤ä¹Ÿæœ‰æœ‹å‹ç»™æˆ‘æè¿‡è¿™ä¸ª issueã€‚ äºæ˜¯æ”¹è¿›åçš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š æ˜¯å¦æœ‰ç‚¹ä¼¼æ›¾ç›¸è¯†çš„æ„Ÿè§‰ğŸ˜Šã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸éœ€è¦å®ç°æŸä¸ªç‰¹å®šçš„æ¥å£ï¼›åªéœ€è¦ä½¿ç”¨ä¸åŒçš„æ³¨è§£å³å¯ã€‚ åŒæ—¶ä¹Ÿæ”¯æŒè‡ªå®šä¹‰ pojo, cicada ä¼šåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­å¯¹å‚æ•°è¿›è¡Œå®ä¾‹åŒ–ã€‚ æ‹¿è¿™ä¸ª getUser æ¥å£ä¸ºä¾‹ï¼Œå½“è¿™æ ·è¯·æ±‚æ—¶è¿™äº›å‚æ•°å°±ä¼šè¢«å°è£…è¿› DemoReq ä¸­. http://127.0.0.1:5688/cicada-example/routeAction/getUser?id=1234&amp;name=zhangsan åŒæ—¶å¾—åˆ°å“åº”ï¼š 1&#123;"message":"hello =zhangsan"&#125; å®ç°è¿‡ç¨‹ä¹ŸæŒºç®€å•ï¼Œå¤§å®¶æŸ¥çœ‹æºç ä¾¿ä¼šå‘ç°ï¼›è¿™é‡Œè´´ä¸€ç‚¹æ¯”è¾ƒæ ¸å¿ƒçš„æ­¥éª¤ã€‚ æ‰«ææ‰€æœ‰ä½¿ç”¨ @CicadaAction æ³¨è§£çš„ç±»ã€‚ æ‰«ææ‰€æœ‰ä½¿ç”¨ @CicadaRoute æ³¨è§£çš„æ–¹æ³•ã€‚ å°†ä»–ä»¬çš„æ˜ å°„å…³ç³»å­˜å…¥ Map ä¸­ã€‚ è¯·æ±‚æ—¶æ ¹æ® URL å» Map ä¸­æŸ¥æ‰¾è¿™ä¸ªå…³ç³»ã€‚ åå°„æ„å»ºå‚æ•°åŠæ–¹æ³•è°ƒç”¨ã€‚ æ‰«æç±»ä»¥åŠå†™å…¥æ˜ å°„å…³ç³» è¯·æ±‚æ—¶æŸ¥è¯¢æ˜ å°„å…³ç³» åå°„è°ƒç”¨è¿™äº›æ–¹æ³• æ˜¯å¦éœ€è¦ IOC å®¹å™¨ä¸Šé¢é‚£å‡ ä¸ªæ­¥éª¤å…¶å®æˆ‘éƒ½æ˜¯ä¸€æŠŠæ¢­å†™å®Œçš„ï¼Œä½†å½“æˆ‘å†™åˆ°æ‰§è¡Œå…·ä½“æ–¹æ³•æ—¶æ„Ÿè§‰æœ‰ç‚¹æ„æ€äº†ã€‚ å¤§å®¶éƒ½çŸ¥é“åå°„è°ƒç”¨æ–¹æ³•æœ‰ä¸¤ä¸ªé‡è¦çš„å‚æ•°ï¼š obj æ–¹æ³•æ‰§è¡Œçš„å®ä¾‹ã€‚ args.. è‡ªç„¶æ˜¯æ–¹æ³•çš„å‚æ•°ã€‚ æˆ‘ç¬¬ä¸€æ¬¡å†™çš„æ—¶å€™æ˜¯è¿™æ ·çš„ï¼š 1method.invoke(method.getDeclaringClass().newInstance(), object); ç„¶åä¸€æµ‹è¯•ï¼Œä¹Ÿæ²¡é—®é¢˜ã€‚ å½“æˆ‘å†™å®Œä¹‹å review ä»£ç æ—¶å‘ç°ä¸å¯¹ï¼šè¿™æ ·è¿™é‡Œæ¯æ¬¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œè€Œä¸”åå°„è°ƒç”¨ newInstance() æ•ˆç‡ä¹Ÿä¸é«˜ã€‚ è¿™æ—¶æˆ‘ä¸è‡ªè§‰çš„æƒ³åˆ°äº† Spring ä¸­ IOC å®¹å™¨ï¼Œå’Œè¿™é‡Œåœºæ™¯ä¹Ÿéå¸¸çš„ç±»ä¼¼ã€‚ åœ¨åº”ç”¨åˆå§‹åŒ–æ—¶å°†æ‰€æœ‰çš„æ¥å£å®ä¾‹åŒ–å¹¶ä¿å­˜åˆ° bean å®¹å™¨ä¸­ï¼Œå½“éœ€è¦ä½¿ç”¨æ—¶åªéœ€è¦ä»å®¹å™¨ä¸­è·å–å³å¯ã€‚ è¿™æ ·åªæ˜¯ä¼šåœ¨å¯åŠ¨æ—¶åšå¾ˆå¤šåŠ è½½å·¥ä½œï¼Œä½†é€ ç¦åä»£å•Šã€‚ å¯æ‹”æ’çš„ IOC å®¹å™¨äºæ˜¯æˆ‘æ‰“ç®—è‡ªå·±å®ç°ä¸€ä¸ªè¿™æ ·çš„ bean å®¹å™¨ã€‚ ä½†åœ¨å®ç°ä¹‹å‰åˆæƒ³åˆ°ä¸€ä¸ª feature: ä¸å¦‚æŠŠå®ç° bean å®¹å™¨çš„æ–¹æ¡ˆäº¤ç»™ä½¿ç”¨è€…é€‰æ‹©ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨ bean å®¹å™¨ï¼Œä¹Ÿå¯ä»¥å°±ç”¨ä¹‹å‰çš„æ¯æ¬¡éƒ½åˆ›å»ºæ–°çš„å®ä¾‹ï¼Œå°±åƒ Spring ä¸­çš„ prototype ä½œç”¨åŸŸä¸€æ ·ã€‚ ç”šè‡³å¯ä»¥è‡ªå®šä¹‰å®¹å™¨å®ç°ï¼Œæ¯”å¦‚å°† bean å­˜æ”¾åˆ°æ•°æ®åº“ã€Redis éƒ½è¡Œï¼›å½“ç„¶ä¸€èˆ¬äººä¹Ÿä¸ä¼šè¿™ä¹ˆå¹²ã€‚ å’Œ SPI çš„æœºåˆ¶ä¹Ÿæœ‰ç‚¹ç±»ä¼¼ã€‚ è¦å®ç°ä¸Šè¿°çš„éœ€æ±‚å¤§è‡´éœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š ä¸€ä¸ªé€šç”¨çš„æ¥å£ï¼ŒåŒ…å«äº†æ³¨å†Œå®¹å™¨ã€ä»å®¹å™¨ä¸­è·å–å®ä¾‹ç­‰æ–¹æ³•ã€‚ BeanManager ç±»ï¼Œç”±å®ƒæ¥ç®¡ç†å…·ä½“ä½¿ç”¨å“ªç§ IOC å®¹å™¨ã€‚ æ‰€ä»¥é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªæ¥å£ï¼›CicadaBeanFactory: åŒ…å«äº†æ³¨å†Œå’Œè·å–å®ä¾‹çš„æ¥å£ã€‚ åŒæ—¶åˆ†åˆ«æœ‰ä¸¤ä¸ªä¸åŒçš„å®¹å™¨å®ç°æ–¹æ¡ˆã€‚ é»˜è®¤å®ç°ï¼›CicadaDefaultBeanï¼š ä¹Ÿå°±æ˜¯æ–‡ä¸­è¯´é“çš„ï¼Œæ¯æ¬¡éƒ½ä¼šåˆ›å»ºå®ä¾‹ï¼›ç”±äºè¿™ç§æ–¹å¼å…¶å®æ ¹æœ¬å°±æ²¡æœ‰ bean å®¹å™¨ï¼Œæ‰€ä»¥ä¹Ÿä¸å­˜åœ¨æ³¨å†Œäº†ã€‚ æ¥ä¸‹æ¥æ˜¯çœŸæ­£çš„ IOC å®¹å™¨ï¼›CicadaIocï¼š å®ƒå°†æ‰€æœ‰çš„å®ä¾‹éƒ½å­˜æ”¾åœ¨ä¸€ä¸ª Map ä¸­ã€‚ å½“ç„¶ä¹Ÿå°‘ä¸äº†åˆšæ‰æåˆ°çš„ CicadaBeanManagerï¼Œå®ƒä¼šåœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™å°†æ‰€æœ‰çš„å®ä¾‹æ³¨å†Œåˆ° bean å®¹å™¨ä¸­ã€‚ é‡ç‚¹æ˜¯å›¾ä¸­æ ‡çº¢çš„éƒ¨åˆ†ï¼š éœ€è¦æ ¹æ®ç”¨æˆ·çš„é€‰æ‹©å®ä¾‹åŒ– CicadaBeanFactory æ¥å£ã€‚ å°†æ‰€æœ‰çš„å®ä¾‹æ³¨å†Œåˆ° CicadaBeanFactory æ¥å£ä¸­ã€‚ åŒæ—¶ä¹Ÿæä¾›äº†ä¸€ä¸ªè·å–å®ä¾‹çš„æ–¹æ³•ï¼š å°±æ˜¯ç›´æ¥è°ƒç”¨ CicadaBeanFactory æ¥å£çš„æ–¹æ³•ã€‚ ç„¶ååœ¨ä¸Šæ–‡æåˆ°çš„åå°„è°ƒç”¨æ–¹æ³•å¤„å°±å˜ä¸ºï¼š ä» bean å®¹å™¨ä¸­è·å–å®ä¾‹äº†ï¼›è·å–çš„è¿‡ç¨‹å¯ä»¥æ˜¯æ¯æ¬¡éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›´æ¥ä»å®¹å™¨ä¸­è·å–å®ä¾‹ã€‚è¿™ç‚¹å¯¹äºè¿™é‡Œçš„è°ƒç”¨è€…æ¥è¯´å¹¶ä¸å…³å¿ƒã€‚ æ‰€ä»¥è¿™ä¹Ÿå®ç°äº†æ ‡é¢˜æ‰€è¯´çš„ï¼šå¯æ‹”æ’ã€‚ ä¸ºäº†å®ç°è¿™ä¸ªç›®çš„ï¼Œæˆ‘å°† CicadaIoc çš„å®ç°å•ç‹¬æ”¾åˆ°ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œä»¥ jar åŒ…çš„å½¢å¼æä¾›å®ç°ã€‚ æ‰€ä»¥å¦‚æœä½ æƒ³è¦ä½¿ç”¨ IOC å®¹å™¨çš„æ–¹å¼è·å–å®ä¾‹æ—¶åªéœ€è¦åœ¨ä½ çš„åº”ç”¨ä¸­é¢å¤–åŠ å…¥è¿™ä¸ª jar åŒ…å³å¯ã€‚ 12345&lt;dependency&gt; &lt;groupId&gt;top.crossoverjie.opensource&lt;/groupId&gt; &lt;artifactId&gt;cicada-ioc&lt;/artifactId&gt; &lt;version&gt;2.0.0&lt;/version&gt;&lt;/dependency&gt; å¦‚æœä¸ä½¿ç”¨åˆ™æ˜¯é»˜è®¤çš„ CicadaDefaultBean å®ç°ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡éƒ½ä¼šåˆ›å»ºå¯¹è±¡ã€‚ è¿™æ ·æœ‰ä¸ªå¥½å¤„ï¼š å½“ä½ è‡ªå·±æƒ³å®ç°ä¸€ä¸ª IOC å®¹å™¨æ—¶ï¼›åªéœ€è¦å®ç° cicada æä¾›çš„ CicadaBeanFactory æ¥å£ï¼Œå¹¶åœ¨ä½ çš„åº”ç”¨ä¸­åªåŠ å…¥ä½ çš„ jar åŒ…å³å¯ã€‚ å…¶ä½™æ‰€æœ‰çš„ä»£ç éƒ½ä¸éœ€è¦æ”¹å˜ï¼Œä¾¿å¯éšæ„åˆ‡æ¢ä¸çš„å®¹å™¨ã€‚ å½“ç„¶æˆ‘æ˜¯æ¨èå¤§å®¶ä½¿ç”¨ IOC å®¹å™¨çš„ï¼ˆå…¶å®å°±æ˜¯å•ä¾‹ï¼‰ï¼Œç‰ºç‰²ä¸€ç‚¹åº”ç”¨å¯åŠ¨æ—¶é—´å¸¦æ¥åç»­æ€§èƒ½çš„æå‡æ˜¯å€¼å¾—çš„ã€‚ æ€»ç»“cicada çš„å¤§å‘å¡«çš„å·®ä¸å¤šäº†ï¼Œåç»­ä¹Ÿä¼šåšä¸€äº›å°åŠŸèƒ½çš„è¿­ä»£ã€‚ è¿˜æ²¡æœ‰å…³æ³¨çš„æœ‹å‹èµ¶ç´§å…³æ³¨ä¸€æ³¢ï¼š https://github.com/TogetherOS/cicada PSï¼šè™½ç„¶æ²¡æœ‰ä»”ç»†åˆ†æ Spring IOC çš„å®ç°ï¼Œä½†ç›¸ä¿¡çœ‹å®Œæ­¤ç¯‡çš„æœ‹å‹åº”è¯¥å¯¹ Spring IOC ä»¥åŠ SpringMVC ä¼šæœ‰ä¸€äº›è‡ªå·±çš„ç†è§£ã€‚ ä½ çš„ç‚¹èµä¸åˆ†äº«æ˜¯å¯¹æˆ‘æœ€å¤§çš„æ”¯æŒ]]></content>
      <categories>
        <category>cicada</category>
        <category>è½®å­</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>HTTP</tag>
        <tag>Netty</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸æ”¹ä¸€è¡Œä»£ç å®šä½çº¿ä¸Šæ€§èƒ½é—®é¢˜]]></title>
    <url>%2F2018%2F11%2F12%2Fjava-senior%2Fcoding-online-analysis%2F</url>
    <content type="text"><![CDATA[èƒŒæ™¯æœ€è¿‘æ—¶è¿ä¸ä½³ï¼Œå‡ ä¹å¤©å¤©è¢«çº¿ä¸Šé—®é¢˜éªšæ‰°ã€‚å‰å‡ å¤©åˆšè§£å†³äº†ä¸€ä¸ª HashSet çš„å¹¶å‘é—®é¢˜ï¼Œå‘¨å…­åˆæ¥äº†ä¸€ä¸ªæ€§èƒ½é—®é¢˜ã€‚ å¤§è‡´çš„ç°è±¡æ˜¯ï¼š æˆ‘ä»¬æä¾›å‡ºå»çš„ä¸€ä¸ª OpenAPI ååº”æ—¶å¿«æ—¶æ…¢ï¼Œå¿«çš„æ—¶å€™å‡ åæ¯«ç§’ï¼Œæ…¢çš„æ—¶å€™å‡ ç§’é’Ÿæ‰å“åº”ã€‚ å°è¯•è§£å†³ç”±äºè¿™ç§ä¹Ÿä¸æ˜¯ä¸šåŠ¡é—®é¢˜ï¼Œä¸èƒ½ç›´æ¥å®šä½ã€‚æ‰€ä»¥å°è¯•åœ¨æµ‹è¯•ç¯å¢ƒå¤ç°ï¼Œä½†é—æ†¾çš„æµ‹è¯•ç¯å¢ƒè´¼å¿«ã€‚ æ²¡åŠæ³•åªèƒ½ç¡¬ç€å¤´çš®ä¸Šäº†ã€‚ ä¸­é€”æœ‰æŠ±ç€ä¾¥å¹¸å¿ƒé‡Œè®©è¿ç»´æŸ¥çœ‹äº† Nginx é‡Œ OpenAPI çš„å“åº”æ—¶é—´ï¼Œæƒ³æŠŠé”…æ‰”ç»™ç½‘ç»œã€‚ç»“æœæœç„¶æ‰“è„¸äº†ï¼›Nginx é‡Œçš„æ—¥å¿—ä¹Ÿè¡¨æ˜ç¡®å®å“åº”æ—¶é—´ç¡®å®æœ‰é—®é¢˜ã€‚ ä¸ºäº†æ¸…æ™°çš„äº†è§£è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ç®€å•æ¢³ç†äº†è¿™ä¸ªè°ƒç”¨è¿‡ç¨‹ã€‚ æ•´ä¸ªçš„æµç¨‹ç®—æ˜¯æ¯”è¾ƒå¸¸è§çš„åˆ†å±‚æ¶æ„ï¼š å®¢æˆ·ç«¯è¯·æ±‚åˆ° Nginxã€‚ Nginx è´Ÿè½½äº†åç«¯çš„ web æœåŠ¡ã€‚ web æœåŠ¡é€šè¿‡ RPC è°ƒç”¨åç«¯çš„ Service æœåŠ¡ã€‚ æ—¥å¿—å¤§æ³•æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„æ˜¯æ‰“æ—¥å¿—ï¼Œåœ¨å¯èƒ½ä¼šæ…¢çš„æ–¹æ³•æˆ–æ¥å£å¤„è®°å½•å¤„ç†æ—¶é—´æ¥åˆ¤æ–­å“ªé‡Œæœ‰é—®é¢˜ã€‚ ä½†é€šè¿‡åˆšæ‰çš„è°ƒç”¨é“¾æ¥è¯´ï¼Œè¿™ä¸ªè¯·æ±‚æµç¨‹ä¸çŸ­ã€‚åŠ æ—¥å¿—æ¶‰åŠçš„æ”¹åŠ¨è¾ƒå¤šè€Œä¸”ä¸‡ä¸€åŠ æ¼äº†è¿˜æœ‰å¯èƒ½å®šä½ä¸åˆ°é—®é¢˜ã€‚ å†ä¸€ä¸ªæ˜¯æ”¹åŠ¨ä»£ç ä¹‹åè¿˜ä¼šæ¶‰åŠåˆ°å‘ç‰ˆä¸Šçº¿ã€‚ å·¥å…·åˆ†ææ‰€ä»¥æœ€å¥½çš„æ–¹å¼å°±æ˜¯ä¸æ”¹åŠ¨ä¸€è¡Œä»£ç æŠŠè¿™ä¸ªé—®é¢˜åˆ†æå‡ºæ¥ã€‚ è¿™æ—¶å°±éœ€è¦ä¸€ä¸ª agent å·¥å…·äº†ã€‚æˆ‘ä»¬é€‰ç”¨äº†é˜¿é‡Œä»¥å‰å¼€æºçš„ Tprofile æ¥ä½¿ç”¨ã€‚ åªéœ€è¦åœ¨å¯åŠ¨å‚æ•°ä¸­åŠ å…¥ -javaagent:/xx/tprofiler.jar å³å¯ç›‘æ§ä½ æƒ³è¦ç›‘æ§çš„æ–¹æ³•è€—æ—¶ï¼Œå¹¶ä¸”å¯ä»¥ç»™ä½ è¾“å‡ºæŠ¥å‘Šï¼Œéå¸¸æ–¹ä¾¿ã€‚å¯¹ä»£ç æ²¡æœ‰ä»»ä½•ä¾µå…¥æ€§åŒæ—¶æ€§èƒ½å½±å“ä¹Ÿè¾ƒå°ã€‚ å·¥å…·ä½¿ç”¨ä¸‹é¢æ¥ç®€å•å±•ç¤ºä¸‹å¦‚ä½•ä½¿ç”¨è¿™ä¸ªå·¥å…·ã€‚ é¦–å…ˆç¬¬ä¸€æ­¥è‡ªç„¶æ˜¯ clone æºç ç„¶åæ‰“åŒ…ï¼Œå¯ä»¥å…‹éš†æˆ‘ä¿®æ”¹è¿‡çš„æºç ã€‚ å› ä¸ºè¿™ä¸ªé¡¹ç›®é˜¿é‡Œå¤šå¹´æ²¡æœ‰ç»´æŠ¤äº†ï¼Œè¿˜æ®‹ç•™ä¸€äº› bug,æˆ‘åœ¨å®ƒåŸæœ‰çš„åŸºç¡€ä¸Šä¿®å¤äº†ä¸ªå½±å“ä½¿ç”¨çš„ bugï¼ŒåŒæ—¶åšäº†ä¸€äº›ä¼˜åŒ–ã€‚ æ‰§è¡Œä»¥ä¸‹è„šæœ¬å³å¯ã€‚123git clone https://github.com/crossoverJie/TProfilermvn assembly:assembly åˆ°è¿™é‡Œä¹‹åä¼šåœ¨é¡¹ç›®çš„ TProfiler/pkg/TProfiler/lib/tprofiler-1.0.1.jar ä¸­ç”Ÿæˆå¥½æˆ‘ä»¬è¦ä½¿ç”¨çš„ jar åŒ…ã€‚ æ¥ä¸‹æ¥åªéœ€è¦å°†è¿™ä¸ª jar åŒ…é…ç½®åˆ°å¯åŠ¨å‚æ•°ä¸­ï¼ŒåŒæ—¶å†é…ç½®ä¸€ä¸ªé…ç½®æ–‡ä»¶è·¯å¾„å³å¯ã€‚ è¿™ä¸ªé…ç½®æ–‡ä»¶æˆ‘ copy å®˜æ–¹çš„è§£é‡Šã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041#log file namelogFileName = tprofiler.logmethodFileName = tmethod.logsamplerFileName = tsampler.log#basic configuration items# å¼€å§‹å–æ ·æ—¶é—´startProfTime = 1:00:00# ç»“æŸå–æ ·æ—¶é—´endProfTime = 23:00:00# å–æ ·çš„æ—¶é—´é•¿åº¦eachProfUseTime = 10# æ¯æ¬¡å–æ ·çš„æ—¶é—´é—´éš”eachProfIntervalTime = 1samplerIntervalTime = 20# ç«¯å£ï¼Œä¸»è¦ä¸è¦å†²çªäº†port = 50000debugMode = falseneedNanoTime = false# æ˜¯å¦å¿½ç•¥ get set æ–¹æ³•ignoreGetSetMethod = true#file paths æ—¥å¿—è·¯å¾„logFilePath = /data/work/logs/tprofile/$&#123;logFileName&#125;methodFilePath =/data/work/logs/tprofile/$&#123;methodFileName&#125;samplerFilePath =/data/work/logs/tprofile/$&#123;samplerFileName&#125;#include &amp; excludes itemsexcludeClassLoader = org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader# éœ€è¦ç›‘æ§çš„åŒ…includePackageStartsWith = top.crossoverjie.cicada.example.action# ä¸éœ€è¦ç›‘æ§çš„åŒ…excludePackageStartsWith = com.taobao.sketch;org.apache.velocity;com.alibaba;com.taobao.forest.domain.dataobject æœ€ç»ˆçš„å¯åŠ¨å‚æ•°å¦‚ä¸‹ï¼š 12-javaagent:/TProfiler/lib/tprofiler-1.0.1.jar-Dprofile.properties=/TProfiler/profile.properties ä¸ºäº†æ¨¡æ‹Ÿæ’æŸ¥æ¥å£å“åº”æ…¢çš„é—®é¢˜ï¼Œæˆ‘ç”¨ cicada å®ç°äº†ä¸€ä¸ª HTTP æ¥å£ã€‚å…¶ä¸­è°ƒç”¨äº†ä¸¤ä¸ªè€—æ—¶æ–¹æ³•ï¼š è¿™æ ·å½“æˆ‘å¯åŠ¨åº”ç”¨æ—¶ï¼ŒTprofile å°±ä¼šåœ¨æˆ‘é…ç½®çš„ç›®å½•è®°å½•å®ƒæ‰€æ”¶é›†çš„æ–¹æ³•ä¿¡æ¯ã€‚ æˆ‘è®¿é—®æ¥å£ http://127.0.0.1:5688/cicada-example/demoAction?name=test&amp;id=10 å‡ æ¬¡åå®ƒå°±ä¼šæŠŠæ¯ä¸ªæ–¹æ³•çš„æ˜ç»†å“åº”å†™å…¥ tprofile.logã€‚ ç”±å·¦åˆ°å³æ¯åˆ—åˆ†åˆ«ä»£è¡¨ä¸ºï¼š çº¿ç¨‹IDã€æ–¹æ³•æ ˆæ·±åº¦ã€æ–¹æ³•ç¼–å·ã€è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰ã€‚ ä½† tmethod.log è¿˜æ˜¯ç©ºçš„ï¼› è¿™æ—¶æˆ‘ä»¬åªéœ€è¦æ‰§è¡Œè¿™ä¸ªå‘½ä»¤å³å¯æŠŠæœ€æ–°çš„æ–¹æ³•é‡‡æ ·ä¿¡æ¯åˆ·åˆ° tmethod.log æ–‡ä»¶ä¸­ã€‚ 123java -cp /TProfiler/tprofiler.jar com.taobao.profile.client.TProfilerClient 127.0.0.1 50000 flushmethodflushmethod success å…¶å®å°±æ˜¯è®¿é—®äº† Tprofile æš´éœ²å‡ºçš„ä¸€ä¸ªæœåŠ¡ï¼Œä»–ä¼šè¯»å–ã€è§£æ tprofile.log åŒæ—¶å†™å…¥ tmethod.log. å…¶ä¸­çš„ç«¯å£å°±æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„ portã€‚ å†æ‰“å¼€ tmethod.log ï¼š å…¶ä¸­ä¼šè®°å½•æ–¹æ³•çš„ä¿¡æ¯ã€‚ ç¬¬ä¸€è¡Œæ•°å­—ä¸ºæ–¹æ³•çš„ç¼–å·ã€‚å¯ä»¥é€šè¿‡è¿™ä¸ªç¼–å·å» tprofile.log(æ˜ç»†)ä¸­æŸ¥è¯¢æ¯æ¬¡çš„è€—æ—¶æƒ…å†µã€‚ è¡Œæœ«çš„æ•°å­—åˆ™æ˜¯è¿™ä¸ªæ–¹æ³•åœ¨æºç ä¸­æœ€åä¸€è¡Œçš„è¡Œå·ã€‚ å…¶å®å¤§éƒ¨åˆ†çš„æ€§èƒ½åˆ†æéƒ½æ˜¯ç»Ÿè®¡æŸä¸ªæ–¹æ³•çš„å¹³å‡è€—æ—¶ã€‚ æ‰€ä»¥è¿˜éœ€è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œé€šè¿‡ tmethod.log tprofile.logæ¥ç”Ÿæˆæ¯ä¸ªæ–¹æ³•çš„å¹³å‡è€—æ—¶ã€‚ 12java -cp /TProfiler/tprofiler.jar com.taobao.profile.analysis.ProfilerLogAnalysis tprofiler.log tmethod.log topmethod.log topobject.logprint result success æ‰“å¼€ topmethod.log å°±æ˜¯æ‰€æœ‰æ–¹æ³•çš„å¹³å‡è€—æ—¶ã€‚ 4 ä¸ºè¯·æ±‚æ¬¡æ•°ã€‚ 205 ä¸ºå¹³å‡è€—æ—¶ã€‚ 818 åˆ™ä¸ºæ€»è€—æ—¶ã€‚ å’Œå®é™…æƒ…å†µæ˜¯ç›¸ç¬¦çš„ã€‚ æ–¹æ³•çš„æ˜ç»†è€—æ—¶è¿™æ˜¯å¯èƒ½è¿˜ä¼šæœ‰å…¶ä»–éœ€æ±‚ï¼›æ¯”å¦‚è¯´æˆ‘æƒ³æŸ¥è¯¢æŸä¸ªæ–¹æ³•æ‰€æœ‰çš„æ˜ç»†è€—æ—¶æ€ä¹ˆåŠå‘¢ï¼Ÿ å®˜æ–¹æ²¡æœ‰æä¾›ï¼Œä½†ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåªæ˜¯è¦éº»çƒ¦ä¸€ç‚¹ã€‚ æ¯”å¦‚æˆ‘æƒ³æŸ¥çœ‹ selectDB() çš„è€—æ—¶æ˜ç»†ï¼š é¦–å…ˆå¾—çŸ¥é“è¿™ä¸ªæ–¹æ³•çš„ç¼–å·ï¼Œåœ¨ tmethod.log ä¸­å¯ä»¥çœ‹æŸ¥åˆ°ã€‚ 12 top/crossoverjie/cicada/example/action/DemoAction:selectDB:84 ç¼–å·ä¸º 2. ä¹‹å‰æˆ‘ä»¬å°±çŸ¥é“ tprofile.log è®°å½•çš„æ˜¯æ˜ç»†ï¼Œæ‰€ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å³å¯æŸ¥çœ‹ã€‚ 1grep 2 tprofiler.log é€šè¿‡ç¬¬ä¸‰åˆ—æ–¹æ³•ç¼–å·ä¸º 2 çš„æ¥æŸ¥çœ‹æ¯æ¬¡æ‰§è¡Œçš„æ˜ç»†ã€‚ ä½†è¿™æ ·çš„æ–¹å¼æ˜¾ç„¶ä¸å¤Ÿå‹å¥½ï¼Œéœ€è¦äººä¸ºæ¥è¿‡æ»¤å¹²æ‰°ï¼Œæ­¥éª¤ä¹Ÿå¤šï¼›æ‰€ä»¥æˆ‘ä¹Ÿå‡†å¤‡åŠ ä¸Šè¿™æ ·ä¸€ä¸ªåŠŸèƒ½ã€‚ åªéœ€è¦ä¼ å…¥ä¸€ä¸ªæ–¹æ³•åç§°å³å¯æŸ¥è¯¢é‡‡é›†åˆ°çš„æ‰€æœ‰æ–¹æ³•è€—æ—¶æ˜ç»†ã€‚ æ€»ç»“å›åˆ°ä¹‹å‰çš„é—®é¢˜ï¼›çº¿ä¸Šé€šè¿‡è¿™ä¸ªå·¥å…·åˆ†ææˆ‘ä»¬å¾—åˆ°äº†å¦‚ä¸‹ç»“æœã€‚ æœ‰äº›æ–¹æ³•ç¡®å®æ‰§è¡Œæ—¶å¿«æ—¶æ…¢ï¼Œä½†éƒ½æ˜¯å’Œæ•°æ®åº“ç›¸å…³çš„ã€‚ç”±äºç›®å‰æ•°æ®åº“å‹åŠ›è¾ƒå¤§ï¼Œå‡†å¤‡åœ¨æ¥ä¸‹æ¥è¿›è¡Œå†·çƒ­æ•°æ®åˆ†ç¦»ï¼Œä»¥åŠåˆ†åº“åˆ†è¡¨ã€‚ åœ¨ç¬¬ä¸€æ­¥æ“ä½œè¿˜æ²¡å®æ–½ä¹‹å‰å°†éƒ¨åˆ†å†™æ•°æ®åº“çš„æ“ä½œæ”¹ä¸ºå¼‚æ­¥ï¼Œå‡å°å“åº”æ—¶é—´ã€‚ è€ƒè™‘æ¥å…¥ pinpoint è¿™æ ·çš„ APMå·¥å…·ã€‚ ç±»ä¼¼äº Tprofile çš„å·¥å…·ç¡®å®æŒºå¤šçš„ï¼Œæ‰¾åˆ°é€‚åˆè‡ªå·±çš„å°±å¥½ã€‚ åœ¨è¿˜æ²¡æœ‰ä½¿ç”¨ç±»ä¼¼äº pinpoint è¿™æ ·çš„åˆ†å¸ƒå¼è·Ÿè¸ªå·¥å…·ä¹‹å‰åº”è¯¥ä¼šå¤§é‡ä¾èµ–äºè¿™ä¸ªå·¥å…·ï¼Œæ‰€ä»¥åç»­è¯´ä¸å®šä¹Ÿä¼šåšä¸€äº›å®šåˆ¶ï¼Œæ¯”å¦‚å¢åŠ ä¸€äº›å¯è§†åŒ–ç•Œé¢ç­‰ï¼Œå¯ä»¥æé«˜æ’æŸ¥æ•ˆç‡ã€‚ ä½ çš„ç‚¹èµä¸åˆ†äº«æ˜¯å¯¹æˆ‘æœ€å¤§çš„æ”¯æŒ]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Thread</tag>
        <tag>Tprofile</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€æ¬¡ HashSet æ‰€å¼•èµ·çš„å¹¶å‘é—®é¢˜]]></title>
    <url>%2F2018%2F11%2F08%2Fjava-senior%2FJVM-concurrent-HashSet-problem%2F</url>
    <content type="text"><![CDATA[èƒŒæ™¯ä¸Šåˆåˆšåˆ°å…¬å¸ï¼Œå‡†å¤‡å¼€å§‹ä¸€å¤©çš„æ‘¸é±¼ä¹‹æ—…æ—¶çªç„¶æ”¶åˆ°äº†ä¸€å°ç›‘æ§ä¸­å¿ƒçš„é‚®ä»¶ã€‚ å¿ƒä¸­æš—é“ä¸å¥½ï¼Œå› ä¸ºç›‘æ§ç³»ç»Ÿä»æ¥ä¸ä¼šå‘Šè¯‰æˆ‘åº”ç”¨å®Œç¾æ—  bugï¼Œå…¶å®ç³»ç»ŸæŒºçŒ¥çã€‚ æ‰“å¼€é‚®ä»¶ä¸€çœ‹ï¼Œæœç„¶å‘ŠçŸ¥æˆ‘æœ‰ä¸€ä¸ªåº”ç”¨çš„çº¿ç¨‹æ± é˜Ÿåˆ—è¾¾åˆ°é˜ˆå€¼è§¦å‘äº†æŠ¥è­¦ã€‚ ç”±äºè¿™ä¸ªåº”ç”¨å‡ºé—®é¢˜éå¸¸å½±å“ç”¨æˆ·ä½“éªŒï¼›äºæ˜¯ç«‹é©¬è®©è¿ç»´ä¿ç•™ç°åœº dump çº¿ç¨‹å’Œå†…å­˜åŒæ—¶é‡å¯åº”ç”¨ï¼Œè¿˜å¥½é‡å¯ä¹‹åæ¢å¤æ­£å¸¸ã€‚äºæ˜¯å¼€å§‹ç€æ‰‹æ’æŸ¥é—®é¢˜ã€‚ åˆ†æé¦–å…ˆäº†è§£ä¸‹è¿™ä¸ªåº”ç”¨å¤§æ¦‚æ˜¯åšä»€ä¹ˆçš„ã€‚ ç®€å•æ¥è¯´å°±æ˜¯ä» MQ ä¸­å–å‡ºæ•°æ®ç„¶åä¸¢åˆ°åé¢çš„ä¸šåŠ¡çº¿ç¨‹æ± ä¸­åšå…·ä½“çš„ä¸šåŠ¡å¤„ç†ã€‚ è€ŒæŠ¥è­¦çš„é˜Ÿåˆ—æ­£å¥½å°±æ˜¯è¿™ä¸ªçº¿ç¨‹æ± çš„é˜Ÿåˆ—ã€‚ è·Ÿè¸ªä»£ç å‘ç°æ„å»ºçº¿ç¨‹æ± çš„æ–¹å¼å¦‚ä¸‹ï¼š 1234ThreadPoolExecutor executor = new ThreadPoolExecutor(coreSize, maxSize, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;());; put(poolName,executor); é‡‡ç”¨çš„æ˜¯é»˜è®¤çš„ LinkedBlockingQueue å¹¶æ²¡æœ‰æŒ‡å®šå¤§å°ï¼ˆè¿™ä¹Ÿæ˜¯ä¸ªå‘ï¼‰ï¼Œäºæ˜¯è¿™ä¸ªé˜Ÿåˆ—çš„é»˜è®¤å¤§å°ä¸º Integer.MAX_VALUEã€‚ ç”±äºåº”ç”¨å·²ç»é‡å¯ï¼Œåªèƒ½ä»ä»…å­˜çš„çº¿ç¨‹å¿«ç…§å’Œå†…å­˜å¿«ç…§è¿›è¡Œåˆ†æã€‚ å†…å­˜åˆ†æå…ˆåˆ©ç”¨ MAT åˆ†æäº†å†…å­˜ï¼Œçš„åˆ°äº†å¦‚ä¸‹æŠ¥å‘Šã€‚ å…¶ä¸­æœ‰ä¸¤ä¸ªæ¯”è¾ƒå¤§çš„å¯¹è±¡ï¼Œä¸€ä¸ªå°±æ˜¯ä¹‹å‰çº¿ç¨‹æ± å­˜æ”¾ä»»åŠ¡çš„ LinkedBlockingQueueï¼Œè¿˜æœ‰ä¸€ä¸ªåˆ™æ˜¯ HashSetã€‚ å½“ç„¶å…¶ä¸­é˜Ÿåˆ—å ç”¨äº†å¤§é‡çš„å†…å­˜ï¼Œæ‰€ä»¥ä¼˜å…ˆæŸ¥çœ‹ï¼ŒHashSet ä¸€ä¼šå„¿å†çœ‹ã€‚ ç”±äºé˜Ÿåˆ—çš„å¤§å°ç»™çš„å¤Ÿå¤§ï¼Œæ‰€ä»¥ç»“åˆç›®å‰çš„æƒ…å†µæ¥çœ‹åº”å½“æ˜¯çº¿ç¨‹æ± é‡Œçš„ä»»åŠ¡å¤„ç†è¾ƒæ…¢ï¼Œå¯¼è‡´é˜Ÿåˆ—çš„ä»»åŠ¡è¶Šå †è¶Šå¤šï¼Œè‡³å°‘è¿™æ˜¯ç›®å‰å¯ä»¥å¾—å‡ºçš„ç»“è®ºã€‚ çº¿ç¨‹åˆ†æå†æ¥çœ‹çœ‹çº¿ç¨‹çš„åˆ†æï¼Œè¿™é‡Œåˆ©ç”¨ fastthread.io è¿™ä¸ªç½‘ç«™è¿›è¡Œçº¿ç¨‹åˆ†æã€‚ å› ä¸ºä»è¡¨ç°æ¥çœ‹çº¿ç¨‹æ± é‡Œçš„ä»»åŠ¡è¿Ÿè¿Ÿæ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œæ‰€ä»¥ä¸»è¦çœ‹çœ‹å®ƒä»¬åœ¨å¹²å˜›ã€‚ æ­£å¥½ä»–ä»¬éƒ½å¤„äº RUNNABLE çŠ¶æ€ï¼ŒåŒæ—¶å †æ ˆå¦‚ä¸‹ï¼š å‘ç°æ­£å¥½å°±æ˜¯åœ¨å¤„ç†ä¸Šæ–‡æåˆ°çš„ HashSetï¼Œçœ‹è¿™ä¸ªå †æ ˆæ˜¯åœ¨æŸ¥è¯¢ key æ˜¯å¦å­˜åœ¨ã€‚é€šè¿‡æŸ¥çœ‹ 312 è¡Œçš„ä¸šåŠ¡ä»£ç ç¡®å®ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ è¿™é‡Œçš„çº¿ç¨‹åå­—ä¹Ÿæ˜¯ä¸ªå‘ï¼Œè®©æˆ‘æ‰¾äº†å¥½ä¹…ã€‚ å®šä½åˆ†æäº†å†…å­˜å’Œçº¿ç¨‹çš„å †æ ˆä¹‹åå…¶å®å·²ç»å¤§æ¦‚çŒœå‡ºä¸€äº›é—®é¢˜äº†ã€‚ è¿™é‡Œå…¶å®æœ‰ä¸€ä¸ªå‰æå¿˜è®°è®²åˆ°ï¼š è¿™ä¸ªå‘Šè­¦æ˜¯å‡Œæ™¨ä¸‰ç‚¹å‘å‡ºçš„é‚®ä»¶ï¼Œä½†å¹¶æ²¡æœ‰ç”µè¯æé†’ä¹‹ç±»çš„ï¼Œæ‰€ä»¥å¤§å®¶éƒ½ä¸çŸ¥é“ã€‚ åˆ°äº†æ—©ä¸Šä¸Šç­æ—¶æ‰å‘ç°å¹¶ç«‹å³ dump äº†ä¸Šé¢çš„è¯æ®ã€‚ æ‰€æœ‰æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„äº‹å®ï¼šè¿™å‡ ä¸ªä¸šåŠ¡çº¿ç¨‹åœ¨æŸ¥è¯¢ HashSet çš„æ—¶å€™è¿è¡Œäº† 6 7 ä¸ªå°æ—¶éƒ½æ²¡æœ‰è¿”å›ã€‚ é€šè¿‡ä¹‹å‰çš„ç›‘æ§æ›²çº¿å›¾ä¹Ÿå¯ä»¥çœ‹å‡ºï¼š æ“ä½œç³»ç»Ÿåœ¨ä¹‹å‰ä¸€ç›´å¤„äºé«˜è´Ÿè½½ä¸­ï¼Œç›´åˆ°æˆ‘ä»¬æ—©ä¸Šçœ‹åˆ°æŠ¥è­¦é‡å¯ä¹‹åæ‰é™ä½ã€‚ åŒæ—¶å‘ç°è¿™ä¸ªåº”ç”¨ç”Ÿäº§ä¸Šè¿è¡Œçš„æ˜¯ JDK1.7 ï¼Œæ‰€ä»¥æˆ‘åˆæ­¥è®¤ä¸ºåº”è¯¥æ˜¯åœ¨æŸ¥è¯¢ key çš„æ—¶å€™è¿›å…¥äº† HashMap çš„ç¯å½¢é“¾è¡¨å¯¼è‡´ CPU é«˜è´Ÿè½½åŒæ—¶ä¹Ÿè¿›å…¥äº†æ­»å¾ªç¯ã€‚ ä¸ºäº†éªŒè¯è¿™ä¸ªé—®é¢˜å†æ¬¡ review äº†ä»£ç ã€‚ æ•´ç†ä¹‹åçš„ä¼ªä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738//çº¿ç¨‹æ± private ExecutorService executor;private Set&lt;String&gt; set = new hashSet();private void execute()&#123; while(true)&#123; //ä» MQ ä¸­è·å–æ•°æ® String key = subMQ(); executor.excute(new Worker(key)) ; &#125;&#125;public class Worker extends Thread&#123; private String key ; public Worker(String key)&#123; this.key = key; &#125; @Override private void run()&#123; if(!set.contains(key))&#123; //æ•°æ®åº“æŸ¥è¯¢ if(queryDB(key))&#123; set.add(key); return; &#125; &#125; //è¾¾åˆ°æŸç§æ¡ä»¶æ—¶æ¸…ç©º set if(flag)&#123; set = null ; &#125; &#125; &#125; å¤§è‡´çš„æµç¨‹å¦‚ä¸‹ï¼š æºæºä¸æ–­çš„ä» MQ ä¸­è·å–æ•°æ®ã€‚ å°†æ•°æ®ä¸¢åˆ°ä¸šåŠ¡çº¿ç¨‹æ± ä¸­ã€‚ åˆ¤æ–­æ•°æ®æ˜¯å¦å·²ç»å†™å…¥äº† Setã€‚ æ²¡æœ‰åˆ™æŸ¥è¯¢æ•°æ®åº“ã€‚ ä¹‹åå†™å…¥åˆ° Set ä¸­ã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯ä½œä¸ºå…±äº«èµ„æºçš„ Set å¹¶æ²¡æœ‰åšä»»ä½•çš„åŒæ­¥å¤„ç†ã€‚ è¿™é‡Œä¼šæœ‰å¤šä¸ªçº¿ç¨‹å¹¶å‘çš„æ“ä½œï¼Œç”±äº HashSet å…¶å®æœ¬è´¨ä¸Šå°±æ˜¯ HashMapï¼Œæ‰€ä»¥å®ƒè‚¯å®šæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥ä¼šå‡ºç°ä¸¤ä¸ªé—®é¢˜ï¼š Set ä¸­çš„æ•°æ®åœ¨å¹¶å‘å†™å…¥æ—¶è¢«è¦†ç›–å¯¼è‡´æ•°æ®ä¸å‡†ç¡®ã€‚ ä¼šåœ¨æ‰©å®¹çš„æ—¶å€™å½¢æˆç¯å½¢é“¾è¡¨ã€‚ ç¬¬ä¸€ä¸ªé—®é¢˜ç›¸å¯¹äºç¬¬äºŒä¸ªè¿˜èƒ½æ¥å—ã€‚ é€šè¿‡ä¸Šæ–‡çš„å†…å­˜åˆ†ææˆ‘ä»¬å·²ç»çŸ¥é“è¿™ä¸ª set ä¸­çš„æ•°æ®å·²ç»ä¸å°‘äº†ã€‚åŒæ—¶ç”±äºåˆå§‹åŒ–æ—¶å¹¶æ²¡æœ‰æŒ‡å®šå¤§å°ï¼Œä»…ä»…åªæ˜¯é»˜è®¤å€¼ï¼Œæ‰€ä»¥åœ¨å¤§é‡çš„å¹¶å‘å†™å…¥æ—¶å€™ä¼šå¯¼è‡´é¢‘ç¹çš„æ‰©å®¹ï¼Œè€Œåœ¨ 1.7 çš„æ¡ä»¶ä¸‹åˆå¯èƒ½ä¼šå½¢æˆç¯å½¢é“¾è¡¨ã€‚ ä¸å·§çš„æ˜¯ä»£ç ä¸­ä¹Ÿæœ‰æŸ¥è¯¢æ“ä½œï¼ˆcontains()ï¼‰,è§‚å¯Ÿä¸Šæ–‡çš„å †æ ˆæƒ…å†µï¼š å‘ç°æ˜¯è¿è¡Œåœ¨ HashMap çš„ 465 è¡Œï¼Œæ¥çœ‹çœ‹ 1.7 ä¸­é‚£é‡Œå…·ä½“åœ¨åšä»€ä¹ˆï¼š å·²ç»å¾ˆæ˜æ˜¾äº†ã€‚è¿™é‡Œåœ¨éå†é“¾è¡¨ï¼ŒåŒæ—¶ç”±äºå½¢æˆäº†ç¯å½¢é“¾è¡¨å¯¼è‡´è¿™ä¸ª e.next æ°¸è¿œä¸ä¸ºç©ºï¼Œæ‰€ä»¥è¿™ä¸ªå¾ªç¯ä¹Ÿä¸ä¼šé€€å‡ºäº†ã€‚ åˆ°è¿™é‡Œå…¶å®å·²ç»æ‰¾åˆ°é—®é¢˜äº†ï¼Œä½†è¿˜æœ‰ä¸€ä¸ªç–‘é—®æ˜¯ä¸ºä»€ä¹ˆçº¿ç¨‹æ± é‡Œçš„ä»»åŠ¡é˜Ÿåˆ—ä¼šè¶Šå †è¶Šå¤šã€‚æˆ‘ç¬¬ä¸€ç›´è§‰æ˜¯ä»»åŠ¡æ‰§è¡Œå¤ªæ…¢å¯¼è‡´çš„ã€‚ ä»”ç»†æŸ¥çœ‹äº†ä»£ç å‘ç°åªæœ‰ä¸€ä¸ªåœ°æ–¹å¯èƒ½ä¼šæ…¢ï¼šä¹Ÿå°±æ˜¯æœ‰ä¸€ä¸ªæ•°æ®åº“çš„æŸ¥è¯¢ã€‚ æŠŠè¿™ä¸ª SQL æ‹¿åˆ°ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œå‘ç°ç¡®å®ä¸å¿«ï¼ŒæŸ¥çœ‹ç´¢å¼•å‘ç°éƒ½æœ‰å‘½ä¸­ã€‚ ä½†æˆ‘ä¸€çœ‹è¡¨ä¸­çš„æ•°æ®å‘ç°å·²ç»å¿«æœ‰ 7000W çš„æ•°æ®äº†ã€‚åŒæ—¶ç»è¿‡è¿ç»´å¾—çŸ¥ MySQL é‚£å°æœåŠ¡å™¨çš„ IO å‹åŠ›ä¹Ÿæ¯”è¾ƒå¤§ã€‚ æ‰€ä»¥è¿™ä¸ªåŸå› ä¹Ÿæ¯”è¾ƒæ˜æ˜¾äº†ï¼š ç”±äºæ¯æ¶ˆè´¹ä¸€æ¡æ•°æ®éƒ½è¦å»æŸ¥è¯¢ä¸€æ¬¡æ•°æ®åº“ï¼ŒMySQL æœ¬èº«å‹åŠ›å°±æ¯”è¾ƒå¤§ï¼ŒåŠ ä¸Šæ•°æ®é‡ä¹Ÿå¾ˆé«˜æ‰€ä»¥å¯¼è‡´è¿™ä¸ª IO å“åº”è¾ƒæ…¢ï¼Œå¯¼è‡´æ•´ä¸ªä»»åŠ¡å¤„ç†çš„å°±æ¯”è¾ƒæ…¢äº†ã€‚ ä½†è¿˜æœ‰ä¸€ä¸ªåŸå› ä¹Ÿä¸èƒ½å¿½è§†ï¼›ç”±äºæ‰€æœ‰çš„ä¸šåŠ¡çº¿ç¨‹åœ¨æŸä¸ªæ—¶é—´ç‚¹éƒ½è¿›å…¥äº†æ­»å¾ªç¯ï¼Œæ ¹æœ¬æ²¡æœ‰æ‰§è¡Œå®Œä»»åŠ¡çš„æœºä¼šï¼Œè€Œåé¢çš„æ•°æ®è¿˜åœ¨æºæºä¸æ–­çš„è¿›å…¥ï¼Œæ‰€ä»¥è¿™ä¸ªé˜Ÿåˆ—åªä¼šè¶Šå †è¶Šå¤šï¼ è¿™å…¶å®æ˜¯ä¸€ä¸ªè€åº”ç”¨äº†ï¼Œå¯èƒ½ä¼šæœ‰äººé—®ä¸ºä»€ä¹ˆä¹‹å‰æ²¡å‡ºç°é—®é¢˜ã€‚ è¿™æ˜¯å› ä¸ºä¹‹å‰æ•°æ®é‡éƒ½æ¯”è¾ƒå°‘ï¼Œå³ä½¿æ˜¯å¹¶å‘å†™å…¥ä¹Ÿæ²¡æœ‰å‡ºç°å¹¶å‘æ‰©å®¹å½¢æˆç¯å½¢é“¾è¡¨çš„æƒ…å†µã€‚è¿™æ®µæ—¶é—´ä¸šåŠ¡é‡çš„æš´å¢æ­£å¥½æŠŠè¿™ä¸ªéšè—çš„é›·ç»™æªå‡ºæ¥äº†ã€‚æ‰€ä»¥è¿˜æ˜¯å¾—ä¿¡å¢¨è²ä»–è€äººå®¶çš„è¯ã€‚ æ€»ç»“è‡³æ­¤æ•´ä¸ªæ’æŸ¥ç»“æŸï¼Œè€Œæˆ‘ä»¬åç»­çš„è°ƒæ•´æªæ–½å¤§æ¦‚å¦‚ä¸‹ï¼š HashSet ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ¢ä¸º ConcurrentHashMapåŒæ—¶æŠŠ value å†™æ­»ä¸€æ ·å¯ä»¥è¾¾åˆ° set çš„æ•ˆæœã€‚ æ ¹æ®æˆ‘ä»¬åé¢çš„ç›‘æ§ï¼Œåˆå§‹åŒ– ConcurrentHashMap çš„å¤§å°å°½é‡å¤§ä¸€äº›ï¼Œé¿å…é¢‘ç¹çš„æ‰©å®¹ã€‚ MySQL ä¸­å¾ˆå¤šæ•°æ®éƒ½å·²ç»ä¸ç”¨äº†ï¼Œè¿›è¡Œå†·çƒ­å¤„ç†ã€‚å°½é‡é™ä½å•è¡¨æ•°æ®é‡ã€‚åŒæ—¶åæœŸè€ƒè™‘åˆ†è¡¨ã€‚ æŸ¥æ•°æ®é‚£é‡Œè°ƒæ•´ä¸ºæŸ¥ç¼“å­˜ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ çº¿ç¨‹æ± çš„åç§°ä¸€å®šå¾—å–çš„æœ‰æ„ä¹‰ï¼Œä¸ç„¶æ˜¯è‡ªå·±ç»™è‡ªå·±å¢åŠ éš¾åº¦ã€‚ æ ¹æ®ç›‘æ§å°†çº¿ç¨‹æ± çš„é˜Ÿåˆ—å¤§å°è°ƒæ•´ä¸ºä¸€ä¸ªå…·ä½“å€¼ï¼Œå¹¶ä¸”è¦æœ‰æ‹’ç»ç­–ç•¥ã€‚ å‡çº§åˆ° JDK1.8ã€‚ å†ä¸€ä¸ªæ˜¯æŠ¥è­¦é‚®ä»¶é…Œæƒ…è€ƒè™‘ä¸ºç”µè¯é€šçŸ¥ğŸ˜‚ã€‚ HashMap çš„æ­»å¾ªç¯é—®é¢˜åœ¨ç½‘ä¸Šå±‚å‡ºä¸ç©·ï¼Œæ²¡æƒ³åˆ°è¿˜çœŸè¢«æˆ‘é‡åˆ°äº†ã€‚ç°åœ¨è¦æ»¡è¶³è¿™ä¸ªæ¡ä»¶è¿˜æ˜¯æŒºå°‘è§çš„ï¼Œæ¯”å¦‚ 1.8 ä»¥ä¸‹çš„ JDK è¿™ä¸€æ¡å¯èƒ½å¤§å¤šæ•°äººå°±ç¢°ä¸åˆ°ï¼Œæ­£å¥½åˆè¯å®äº†ä¸€æ¬¡å¢¨è²å®šå¾‹ã€‚ åŒæ—¶æˆ‘ä¼šå°†æ–‡ç« æ›´åˆ°è¿™é‡Œï¼Œæ–¹ä¾¿å¤§å®¶é˜…è¯»å’ŒæŸ¥è¯¢ã€‚ https://crossoverjie.top/JCSprout/ ä½ çš„ç‚¹èµä¸åˆ†äº«æ˜¯å¯¹æˆ‘æœ€å¤§çš„æ”¯æŒ]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Thread</tag>
        <tag>concurrent</tag>
        <tag>HashMap</tag>
        <tag>JVM</tag>
        <tag>HashSet</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[1.6W star çš„ JCSprout é˜…è¯»ä½“éªŒå¤§æå‡]]></title>
    <url>%2F2018%2F11%2F06%2Fpersonal%2F1W-star-update%2F</url>
    <content type="text"><![CDATA[ä¸‡ä¸‡æ²¡æƒ³åˆ° JCSprout æˆªæ­¢ç›®å‰å±…ç„¶æœ‰å°†è¿‘1.6W starã€‚çœŸçš„éå¸¸æ„Ÿè°¢å„ä½å¤§ä½¬çš„æ”¯æŒã€‚ å¹´åˆæ—¶åˆ›å»ºè¿™ä¸ª repo åŸæœ¬åªæ˜¯æƒ³æ ¹æ®è‡ªå·±é¢è¯•ä¸è¢«é¢è¯•çš„ç»å†è®°å½•ä¸€äº›æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œç»“æœå´æ˜¯è¶Šå†™è¶Šå¤šã€‚ åœ¨æˆ‘è‡ªå·±å®£ä¼ å’Œå…¶ä»–æŠ€æœ¯å¤§ä½¬(åŒ…æ‹¬é˜®å¤§)çš„åŠ©æ”»ä¹‹ä¸‹è¿ç»­ä¸¤ä¸ªæœˆéƒ½åœ¨ GitHub trending Javaç‰‡åŒºçš„æ¦œé¦–ã€‚ ç”šè‡³æœ‰ä¸€æ¬¡è¿˜ä¸€è·ƒåˆ°æ•´ä¸ª GitHub çš„ç¬¬ä¸€ï¼ŒåŒæ—¶è¿˜æœ‰å¸®åŠ©ä¸€äº›åŒå­¦æ‹¿åˆ°äº†å¤§å‚ offerã€‚ æ‰¯äº†è¿™ä¹ˆå¤šè¿›å…¥è¿™æ¬¡çš„æ­£é¢˜ã€‚ ä¹‹å‰æœ‰ä¸€æœ‹å‹å»ºè®®å°†æ–‡æ¡£ä»¥ gitbook çš„å½¢å¼æŸ¥çœ‹ï¼Œä¸€ç›´æ²¡æœ‰æ—¶é—´å¼„ã€‚ç›´åˆ°æœ‰ä¸€å¤©æˆ‘çœ‹åˆ°äº† docsify è¿™ä¸ªé¡¹ç›®ï¼Œç¬é—´è¢«å®ƒçš„å¤–è§‚ï¼Œé˜…è¯»æ–¹å¼æ‰€å¸å¼•ã€‚äºæ˜¯æŠ½äº†ä¸€æ™šä¸ŠæŠŠæ‰€æœ‰çš„æ–‡ç« å…¨éƒ¨è¿ç§»è¿‡å»ã€‚ ç°åœ¨æ‰“å¼€ https://crossoverjie.top/JCSprout/ å³å¯çœ‹åˆ°å…¨æ–°çš„ä¸»é¡µï¼Œå¤§æ¦‚é•¿è¿™æ ·ï¼š ç¡®å®ä¸ç®¡ä»é¢œå€¼è¿˜æ˜¯é˜…è¯»æ–¹å¼æ¥è¯´éƒ½éå¸¸ä¸é”™ï¼›å¸Œæœ›æ–°çš„ç•Œé¢èƒ½è®©æ›´å¤šçš„äººçœ‹çš„è¿›å»å­¦åˆ°ç‚¹ä¸œè¥¿ã€‚ åŒæ—¶ä¹Ÿæ›´æ–°å®Œå–„äº†å…¶ä¸­çš„ä¸€äº›å†…å®¹ã€‚æ¯”å¦‚æœ‰äº›å†™çš„æ—©çš„å†…å®¹å…¶å®å¹¶ä¸å®Œå–„ï¼Œä¹Ÿä¼˜åŒ–çš„å¤„ç†äº†ã€‚ åŒæ—¶æ¬¢è¿æ›´å¤šæœ‹å‹å‚ä¸è¿›æ¥ï¼Œä¸ç®¡æ˜¯ææ–°çš„ç‚¹å­ã€ä¿®æ”¹ bug éƒ½æ˜¯å¯ä»¥ã€‚ ä¹‹å‰çš„æ–‡ç« ä¹Ÿç•™äº†ä¸å°‘å‘ï¼ŒåŒ…æ‹¬ cicada è¿˜æœ‰å¥½å‡ ä¸ª bug å¾…å¤„ç†ã€æ¨é€çš„ç¤ºä¾‹ä»£ç ä»¥åŠ Kafka æºç çš„åç»­æ›´æ–°ã€‚ çªç„¶æœ‰ç‚¹åƒå†™é•¿ç¯‡å°è¯´çš„æ„Ÿè§‰ï¼Œè¿˜å¥½æ²¡æœ‰å¤šå°‘äººå‚¬æ›´ğŸ¤£ã€‚ ä¸å‡ºæ„å¤–æœ¬å‘¨ä¼šå†æ›´æ–°ä¸€ç¯‡ï¼Œè¯·æŒç»­å…³æ³¨ã€‚ ä½ çš„ç‚¹èµä¸è½¬å‘æ˜¯æœ€å¤§çš„æ”¯æŒã€‚]]></content>
      <categories>
        <category>Person</category>
        <category>GitHub</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ä¸€ä»½é’ˆå¯¹äºæ–°æ‰‹çš„å¤šçº¿ç¨‹å®è·µ--è¿›é˜¶ç¯‡]]></title>
    <url>%2F2018%2F10%2F31%2Fjava-senior%2Fconcurrent-in-action2%2F</url>
    <content type="text"><![CDATA[å‰è¨€åœ¨ä¸Šæ–‡ã€Šä¸€ä»½é’ˆå¯¹äºæ–°æ‰‹çš„å¤šçº¿ç¨‹å®è·µã€‹ç•™ä¸‹äº†ä¸€ä¸ªé—®é¢˜ï¼š è¿™åªæ˜¯å¤šçº¿ç¨‹å…¶ä¸­çš„ä¸€ä¸ªç”¨æ³•ï¼Œç›¸ä¿¡çœ‹åˆ°è¿™é‡Œçš„æœ‹å‹åº”è¯¥å¤šå®ƒçš„ç†è§£æ›´è¿›ä¸€æ­¥äº†ã€‚ å†ç»™å¤§å®¶ç•™ä¸ªé˜…åç»ƒä¹ ï¼Œåœºæ™¯ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼š åœ¨ Redis æˆ–è€…å…¶ä»–å­˜å‚¨ä»‹è´¨ä¸­å­˜æ”¾æœ‰ä¸Šåƒä¸‡çš„æ‰‹æœºå·ç æ•°æ®ï¼Œæ¯ä¸ªå·ç éƒ½æ˜¯å”¯ä¸€çš„ï¼Œéœ€è¦åœ¨æœ€å¿«çš„æ—¶é—´å†…æŠŠè¿™äº›å·ç å…¨éƒ¨éƒ½éå†ä¸€éã€‚ æœ‰æƒ³æ³•æ„Ÿå…´è¶£çš„æœ‹å‹æ¬¢è¿åœ¨æ–‡æœ«ç•™è¨€å‚ä¸è®¨è®ºğŸ¤”ğŸ¤¨ã€‚ ç½‘å‹ä»¬çš„æ–¹æ¡ˆ æˆ‘åœ¨å…¬ä¼—å·ä»¥åŠå…¶ä»–ä¸€äº›å¹³å°æ”¶åˆ°äº†å¤§å®¶çš„å›å¤ï¼Œæœç„¶æ˜¯ä¼—äººæ‹¾æŸ´ç«ç„°é«˜å•Šã€‚ æ„Ÿè°¢æ¯ä¸€ä½å‚ä¸çš„æœ‹å‹ã€‚ å…¶å®çœ‹äº†å¤§å®¶çš„æ–¹æ¡ˆå¤§å¤šéƒ½æƒ³åˆ°äº†æ•°æ®è‚¯å®šè¦åˆ†æ®µï¼Œå› ä¸ºå¤§é‡çš„æ•°æ®è‚¯å®šæ²¡æ³•ä¸€æ¬¡æ€§ load åˆ°å†…å­˜ã€‚ ä½†æ€ä¹ˆåŠ è½½å°±è¦è€ƒè™‘æ¸…æ¥šäº†ï¼Œæœ‰äº›äººè¯´æ”¾åœ¨æ•°æ®åº“ä¸­é€šè¿‡åˆ†é¡µçš„æ–¹å¼è¿›è¡ŒåŠ è½½ï¼Œç„¶åå°†æ¯é¡µçš„æ•°æ®ä¸¢åˆ°ä¸€ä¸ªçº¿ç¨‹é‡Œå»åšéå†ã€‚ å…¶å®æƒ³æ³•æŒºä¸é”™çš„ï¼Œä½†æœ‰ä¸ªé—®é¢˜å°±æ˜¯ï¼š è¿™æ ·è‚¯å®šä¼šå¯¼è‡´æœ‰ä¸€ä¸ªä¸»çº¿ç¨‹å»éå†æ‰€æœ‰çš„å·ç ï¼Œå³ä¾¿æ˜¯åˆ†é¡µæŸ¥è¯¢çš„é‚£ä¹Ÿå¾—å…¨éƒ¨æŸ¥è¯¢ä¸€éï¼Œæ•ˆç‡è¿˜æ˜¯å¾ˆä½ã€‚ å³ä¾¿æ˜¯åˆ†é¡µåŠ è½½å·ç ç”¨å¤šçº¿ç¨‹ï¼Œé‚£å°±ä¼šæ¶‰åŠåˆ°é”çš„é—®é¢˜ï¼Œæ€ä¹ˆä¿è¯æ¯ä¸ªçº¿ç¨‹è¯»å–çš„æ•°æ®æ˜¯äº’ä¸å†²çªçš„ã€‚ ä½†å¦‚æœå­˜å‚¨æ¢æˆ Redis çš„ String ç»“æ„è¿™æ ·å°±æ›´è¡Œä¸é€šäº†ã€‚ éå†æ•°æ®æ–¹æ¡ˆæœ‰æ²¡æœ‰ä¸€ç§åˆ©ç”¨å¤šçº¿ç¨‹åŠ è½½æ•ˆç‡é«˜ï¼Œå¹¶ä¸”çº¿ç¨‹ä¹‹é—´äº’ç›¸ä¸éœ€è¦ç«äº‰é”çš„æ–¹æ¡ˆå‘¢ï¼Ÿ ä¸‹é¢æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ¡ˆï¼š é¦–å…ˆåœ¨å­˜å‚¨è¿™åƒä¸‡å·ç çš„æ—¶å€™æˆ‘ä»¬æŠŠå®ƒçš„å·æ®µå•ç‹¬æå‡ºæ¥å¹¶å†—ä½™å­˜å‚¨ä¸€æ¬¡ã€‚ æ¯”å¦‚æœ‰ä¸ªå·ç æ˜¯ 18523981123 é‚£ä¹ˆå°±è¿˜éœ€è¦å­˜å‚¨ä¸€ä¸ªå·æ®µï¼š1852398ã€‚ è¿™æ ·å½“æˆ‘ä»¬æœ‰ä»¥ä¸‹è¿™äº›å·ç æ—¶ï¼š 18523981123 18523981124 18523981125 13123874321 13123874322 13123874323 æˆ‘ä»¬å°±è¿˜ä¼šç»´æŠ¤ä¸€ä¸ªå·æ®µæ•°æ®ä¸ºï¼š 1852398 1312387 è¿™æ ·æˆ‘æƒ³å¤§å®¶åº”è¯¥æ˜ç™½ä¸‹ä¸€æ­¥åº”å½“æ€ä¹ˆåšäº†å§ã€‚ åœ¨éœ€è¦éå†æ—¶ï¼š é€šè¿‡ä¸»çº¿ç¨‹å…ˆæŠŠæ‰€æœ‰çš„å·æ®µåŠ è½½åˆ°å†…å­˜ï¼Œå³ä¾¿æ˜¯åƒä¸‡çš„å·ç å·æ®µä¹Ÿé¡¶å¤šå‡ åƒæ¡æ•°æ®ã€‚ éå†è¿™ä¸ªå·æ®µï¼Œå°†æ¯ä¸ªå·æ®µæäº¤åˆ°ä¸€ä¸ª task çº¿ç¨‹ä¸­ã€‚ ç”±è¿™ä¸ªçº¿ç¨‹é€šè¿‡å·æ®µå†å»æŸ¥è¯¢çœŸæ­£çš„å·ç è¿›è¡Œéå†ã€‚ æœ€åæ‰€æœ‰çš„å·æ®µéƒ½æäº¤å®Œæ¯•å†ç­‰å¾…æ‰€æœ‰çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å³å¯éå†æ‰€æœ‰çš„å·ç ã€‚ è¿™æ ·åšçš„æ ¹æœ¬åŸå› å…¶å®æ˜¯é¿å…äº†çº¿ç¨‹ä¹‹é—´åŠ é”ï¼Œé€šè¿‡å·æ®µå¯ä»¥è®©æ¯ä¸ªçº¿ç¨‹åªå–è‡ªå·±é‚£ä¸€éƒ¨åˆ†æ•°æ®ã€‚ å¯èƒ½ä¼šæœ‰äººè¯´ï¼Œå¦‚æœå·ç æŒç»­å¢å¤šå¯¼è‡´å·æ®µçš„æ•°æ®ä¹Ÿè¾¾åˆ°äº†ä¸Šä¸‡ç”šè‡³å‡ åä¸‡è¿™æ€ä¹ˆåŠå‘¢ï¼Ÿ é‚£å…¶å®ä¹Ÿæ˜¯åŒæ ·çš„æ€è·¯ï¼Œå¯ä»¥å†æŠŠå·æ®µè¿›è¡Œæ‹†åˆ†ã€‚ æ¯”å¦‚ä¹‹å‰æ˜¯ 1852398 çš„å·æ®µï¼Œé‚£æˆ‘ç»§ç»­æ‹†åˆ†ä¸º 1852 ã€‚ è¿™æ ·åªéœ€è¦åœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šå†å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å»æŸ¥è¯¢å­å·æ®µå³å¯ï¼Œæœ‰ç‚¹ fork/join çš„å‘³é“ã€‚ è¿™æ ·çš„æ€è·¯å…¶å®ä¹Ÿå’Œ JDK1.7 ä¸­çš„ ConcurrentHashMap ç±»ä¼¼ï¼Œå®šä½ä¸€ä¸ªçœŸæ­£çš„æ•°æ®éœ€è¦ä¸¤æ¬¡å®šä½ã€‚ åˆ†å¸ƒå¼æ–¹æ¡ˆä¸Šé¢çš„æ–¹æ¡ˆä¹Ÿæ˜¯ç”±å±€é™æ€§çš„ï¼Œæ¯•ç«Ÿè¯´åˆ°åº•è¿˜æ˜¯ä¸€ä¸ªå•æœºåº”ç”¨ã€‚æ²¡æ³•æ‰©å±•ï¼›å¤„ç†çš„æ•°æ®å§‹ç»ˆæ˜¯æœ‰ä¸Šé™ã€‚ è¿™ä¸ªä¸Šé™å°±å’ŒæœåŠ¡å™¨çš„é…ç½®ä»¥åŠçº¿ç¨‹æ•°è¿™äº›ç›¸å…³ï¼Œè¯´çš„é«˜å¤§ä¸Šä¸€ç‚¹å…¶å®å°±æ˜¯å‚ç›´æ‰©å±•å¢åŠ å•æœºçš„å¤„ç†æ€§èƒ½ã€‚ å› æ­¤éšç€æ•°æ®é‡çš„æå‡æˆ‘ä»¬è‚¯å®šå¾—éœ€è¦é€šè¿‡æ°´å¹³æ‰©å±•çš„æ–¹å¼æ‰èƒ½è¾¾åˆ°æœ€å¥½çš„æ€§èƒ½ï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼çš„æ–¹æ¡ˆã€‚ å‡è®¾æˆ‘ç°åœ¨æœ‰ä¸Šäº¿çš„æ•°æ®éœ€è¦éå†ï¼Œä½†æˆ‘å½“å‰çš„æœåŠ¡å™¨é…ç½®åªèƒ½æ”¯æ’‘ä¸€ä¸ªåº”ç”¨å¯åŠ¨ N ä¸ªçº¿ç¨‹ 5 åˆ†é’Ÿè·‘5000W çš„æ•°æ®ã€‚ äºæ˜¯æˆ‘æ°´å¹³æ‰©å±•ï¼Œåœ¨ä¸‰å°æœåŠ¡å™¨ä¸Šå¯åŠ¨äº†ä¸‰ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ã€‚å‡è®¾ä¸€ä¸ªåº”ç”¨èƒ½è·‘ 5000W ï¼Œé‚£ä¹ˆç†è®ºä¸Šæ¥è¯´ä¸‰ä¸ªåº”ç”¨å°±å¯ä»¥è·‘1.5äº¿çš„æ•°æ®äº†ã€‚ ä½†è¿™ä¸ªçš„å‰æè¿˜æ˜¯å’Œä¸Šæ–‡ä¸€æ ·ï¼šæ¯ä¸ªåº”ç”¨åªèƒ½å¤„ç†è‡ªå·±çš„æ•°æ®ï¼Œä¸èƒ½å‡ºç°åŠ é”çš„æƒ…å†µï¼ˆè¿™æ ·ä¼šå¤§å¤§çš„é™ä½æ€§èƒ½ï¼‰ã€‚ æ‰€ä»¥æˆ‘ä»¬å¾—å¯¹åˆšæ‰çš„å·æ®µè¿›è¡Œåˆ†ç»„ã€‚ å…ˆé€šè¿‡ä¸€å¼ å›¾æ¥ç›´è§‚çš„è¡¨ç¤ºè¿™ä¸ªé€»è¾‘ï¼š å‡è®¾ç°åœ¨æˆ‘æœ‰ 9 ä¸ªå·æ®µï¼Œé‚£ä¹ˆæˆ‘å°±å¾—æŒ‰ç…§å›¾ä¸­çš„æ–¹å¼æŠŠæ•°æ®éš”ç¦»å¼€æ¥ã€‚ ç¬¬ä¸€ä¸ªæ•°æ®ç»™åº”ç”¨0ï¼Œç¬¬äºŒä¸ªæ•°æ®ç»™åº”ç”¨1ï¼Œç¬¬ä¸‰ä¸ªæ•°æ®ç»™åº”ç”¨2ã€‚åé¢çš„æ•°æ®ä»¥æ­¤ç±»æ¨ï¼ˆå°±æ˜¯ä¸€ä¸ªç®€å•çš„å–æ¨¡è¿ç®—ï¼‰ã€‚ è¿™æ ·å°±å¯ä»¥å°†å·æ®µå‡åŒ€çš„åˆ†é…ç»™ä¸åŒçš„åº”ç”¨æ¥è¿›è¡Œå¤„ç†ï¼Œç„¶åæ¯ä¸ªåº”ç”¨å†æŒ‰ç…§ä¸Šæ–‡æåˆ°çš„å°†åˆ†é…ç»™è‡ªå·±çš„å·æ®µä¸¢åˆ°çº¿ç¨‹æ± ä¸­ç”±å…·ä½“çš„çº¿ç¨‹å»æŸ¥è¯¢ã€éå†å³å¯ã€‚ åˆ†å¸ƒå¼å¸¦æ¥çš„é—®é¢˜è¿™æ ·çœ‹ä¼¼æ²¡å•¥é—®é¢˜ï¼Œä½†ä¸€æ—¦å¼•å…¥äº†åˆ†å¸ƒå¼ä¹‹åå°±ä¸å¯é¿å…çš„ä¼šå‡ºç° CAP çš„å–èˆï¼Œè¿™é‡Œä¸åšè¿‡å¤šè®¨è®ºï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥è‡ªè¡Œæœç´¢ã€‚ é¦–å…ˆè¦è§£å†³çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼š è¿™ä¸‰ä¸ªåº”ç”¨æ€ä¹ˆçŸ¥é“å®ƒè‡ªå·±åº”è¯¥å–å“ªäº›å·æ®µçš„æ•°æ®å‘¢ï¼Ÿæ¯”å¦‚ 0 å·åº”ç”¨å°±å– 0 3 6ï¼ˆè¿™ä¸ªç›¸å½“äºå·æ®µçš„ä¸‹æ ‡ï¼‰ï¼Œéš¾é“åœ¨é…ç½®æ–‡ä»¶é‡Œé…ç½®å˜›ï¼Ÿ é‚£å¦‚æœæ•°æ®é‡åˆå¢å¤§äº†ï¼Œå¯¹åº”çš„æœºå™¨æ•°ä¹Ÿå¢åŠ åˆ°äº† 5 å°ï¼Œé‚£è‡ªç„¶ 0 å·åº”ç”¨å°±ä¸æ˜¯å– 0 3 6 äº†ï¼ˆå–æ¨¡ä¹‹åæ•°æ®ä¼šå˜ï¼‰ã€‚ æ‰€ä»¥æˆ‘ä»¬å¾—éœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„è°ƒåº¦æ¥åˆ†é…å„ä¸ªåº”ç”¨ä»–ä»¬åº”å½“å–å“ªäº›å·æ®µï¼Œè¿™ä¹Ÿå°±æ˜¯æ•°æ®åˆ†ç‰‡ã€‚ å‡è®¾æˆ‘è¿™é‡Œæœ‰ä¸€ä¸ªç»Ÿä¸€çš„åˆ†é…ä¸­å¿ƒï¼Œä»–çŸ¥é“ç°åœ¨æœ‰å¤šå°‘ä¸ªåº”ç”¨æ¥å¤„ç†æ•°æ®ã€‚è¿˜æ˜¯å‡è®¾ä¸Šæ–‡çš„ä¸‰ä¸ªåº”ç”¨å§ã€‚ åœ¨çœŸæ­£å¼€å§‹éå†æ•°æ®çš„æ—¶å€™ï¼Œè¿™ä¸ªåˆ†é…ä¸­å¿ƒå°±ä¼šå»å‘Šè¯‰è¿™ä¸‰ä¸ªåº”ç”¨ï¼š ä½ ä»¬è¦å¼€å§‹å·¥ä½œäº†å•Šï¼Œ0 å·åº”ç”¨ä½ çš„å·¥ä½œå†…å®¹æ˜¯ 0 3 6ï¼Œ1 å·åº”ç”¨ä½ çš„å·¥ä½œå†…å®¹æ˜¯ 1 4 7ï¼Œ2 å·åº”ç”¨ä½ çš„å·¥ä½œå†…å®¹æ˜¯ 2 5 8ã€‚ è¿™æ ·å„ä¸ªåº”ç”¨å°±çŸ¥é“ä»–ä»¬æ‰€åº”å½“å¤„ç†çš„æ•°æ®äº†ã€‚ å½“æˆ‘ä»¬æ–°å¢äº†ä¸€ä¸ªåº”ç”¨æ¥å¤„ç†æ•°æ®æ—¶ä¹Ÿå¾ˆç®€å•ï¼ŒåŒæ ·è¿™ä¸ªåˆ†é…ä¸­å¿ƒçŸ¥é“ç°åœ¨æœ‰å¤šå°‘å°åº”ç”¨ä¼šå·¥ä½œã€‚ ä»–ä¼šå†æ‹¿ç€ç°æœ‰çš„å·æ®µå¯¹ 4(3+1å°åº”ç”¨) è¿›è¡Œå–æ¨¡ç„¶åå¯¹æ•°æ®è¿›è¡Œé‡æ–°åˆ†é…ï¼Œè¿™æ ·å°±å¯ä»¥å†æ¬¡ä¿è¯æ•°æ®åˆ†é…å‡åŒ€äº†ã€‚ åªæ˜¯åˆ†é…ä¸­å¿ƒå¦‚ä½•çŸ¥é“æœ‰å¤šå°‘åº”ç”¨å‘¢ï¼Œå…¶å®ä¹Ÿç®€å•ï¼Œåªè¦ä¸­å¿ƒå’Œåº”ç”¨ä¹‹é—´é€šä¿¡å°±å¯ä»¥äº†ã€‚æ¯”å¦‚å¯åŠ¨çš„æ—¶å€™è°ƒç”¨åˆ†é…ä¸­å¿ƒçš„æ¥å£å³å¯ã€‚ ä¸Šé¢æåˆ°çš„è¿™ä¸ªåˆ†é…ä¸­å¿ƒå…¶å®å°±æ˜¯ä¸€ä¸ªå¸¸è§çš„å®šæ—¶ä»»åŠ¡çš„åˆ†å¸ƒå¼è°ƒåº¦ä¸­å¿ƒï¼Œç”±å®ƒæ¥ç»Ÿä¸€å‘èµ·è°ƒåº¦ï¼Œå½“ç„¶åˆ†ç‰‡åªæ˜¯å®ƒå…¶ä¸­çš„ä¸€ä¸ªåŠŸèƒ½è€Œå·²ï¼ˆå…³äºè°ƒåº¦ä¸­å¿ƒä¹‹åæœ‰å…´è¶£å†ç»†è¯´ï¼‰ã€‚ æ€»ç»“æœ¬æ¬¡æ¢è®¨äº†å¤šçº¿ç¨‹çš„æ›´å¤šåº”ç”¨æ–¹å¼ï¼Œå¦‚è¦æ˜¯å¦‚ä½•é«˜æ•ˆçš„è¿è¡Œã€‚æœ€ä¸»è¦çš„ä¸€ç‚¹å…¶å®å°±æ˜¯å°½é‡çš„é¿å…åŠ é”ã€‚ åŒæ—¶å¯¹åˆ†å¸ƒå¼æ°´å¹³æ‰©å±•è°ˆäº†ä¸€äº›å¤„ç†å»ºè®®ï¼Œæœ¬æ¬¡ä¹Ÿæ˜¯éš¾å¾—çš„ä¸€è¡Œä»£ç éƒ½æ²¡è´´ï¼Œå¤§å®¶æ„Ÿå…´è¶£çš„è¯åœ¨åé¢æ›´æ–°ç›¸å…³ä»£ç ã€‚ ä¹Ÿæ¬¢è¿å¤§å®¶ç•™è¨€è®¨è®ºã€‚ğŸ˜„ ä½ çš„ç‚¹èµä¸è½¬å‘æ˜¯æœ€å¤§çš„æ”¯æŒã€‚]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>ThreadPool</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€ä»½é’ˆå¯¹äºæ–°æ‰‹çš„å¤šçº¿ç¨‹å®è·µ]]></title>
    <url>%2F2018%2F10%2F29%2Fjava-senior%2Fconcurrent-in-action%2F</url>
    <content type="text"><![CDATA[å‰è¨€ å‰æ®µæ—¶é—´åœ¨æŸä¸ªç¬¬ä¸‰æ–¹å¹³å°çœ‹åˆ°æˆ‘å†™ä½œå­—æ•°å±…ç„¶çªç ´äº† 10W å­—ï¼Œéš¾ä»¥æƒ³è±¡é«˜ä¸­ 800 å­—ä½œæ–‡æˆ‘éƒ½å¾—å·§å¦™çš„åˆ©ç”¨æ¢è¡Œæ¥å®Œæˆ(æ‡‚çš„äººè‚¯å®šä¹Ÿå¹²è¿‡ğŸ˜)ã€‚ å¹²äº†è¿™è¡Œå…»æˆäº†ä¸€ä¸ªä¹ æƒ¯ï¼šèƒ½æ’¸ç éªŒè¯çš„äº‹æƒ…éƒ½è‡ªå·±éªŒè¯ä¸€éã€‚ äºæ˜¯åœ¨ä¸Šå‘¨äº”é€šå®µåŠ ç­çš„ç©ºä½™æ—¶é—´å†™äº†ä¸€ä¸ªå·¥å…·ï¼š https://github.com/crossoverJie/NOWS åˆ©ç”¨ SpringBoot åªéœ€è¦ä¸€è¡Œå‘½ä»¤å³å¯ç»Ÿè®¡è‡ªå·±å†™äº†å¤šå°‘ä¸ªå­—ã€‚ 1java -jar nows-0.0.1-SNAPSHOT.jar /xx/Hexo/source/_posts ä¼ å…¥éœ€è¦æ‰«æçš„æ–‡ç« ç›®å½•å³å¯è¾“å‡ºç»“æœï¼ˆç›®å‰åªæ”¯æŒ .md ç»“å°¾ Markdown æ–‡ä»¶ï¼‰ å½“ç„¶ç»“æœçœ‹ä¸ªä¹å°±è¡Œï¼ˆ40 å‡ ä¸‡å­—ï¼‰ï¼Œå› ä¸ºæ—©æœŸçš„åšå®¢æˆ‘å–œæ¬¢å¤§ç¯‡çš„è´´ä»£ç ï¼Œè¿˜æœ‰ä¸€äº›è‹±æ–‡å•è¯ä¹Ÿæ²¡æœ‰è¿‡æ»¤ï¼Œæ‰€ä»¥å¯¼è‡´ç»“æœç›¸å·®è¾ƒå¤§ã€‚ å¦‚æœä»…ä»…åªæ˜¯ä¸­æ–‡æ–‡å­—ç»Ÿè®¡è‚¯å®šæ˜¯å‡†çš„ï¼Œå¹¶ä¸”è¯¥å·¥å…·å†…ç½®çµæ´»çš„æ‰©å±•æ–¹å¼ï¼Œä½¿ç”¨è€…å¯ä»¥è‡ªå®šä¹‰ç»Ÿè®¡ç­–ç•¥ï¼Œå…·ä½“è¯·çœ‹åæ–‡ã€‚ å…¶å®è¿™ä¸ªå·¥å…·æŒºç®€å•çš„ï¼Œä»£ç é‡ä¹Ÿå°‘ï¼Œæ²¡æœ‰å¤šå°‘å¯ä»¥å€¼å¾—æ‹¿å‡ºæ¥è®²çš„ã€‚ä½†ç»è¿‡æˆ‘å›å¿†ä¸ç®¡æ˜¯é¢è¯•è¿˜æ˜¯å’Œç½‘å‹ä»¬äº¤æµéƒ½å‘ç°ä¸€ä¸ªæ™®éçš„ç°è±¡ï¼š å¤§éƒ¨åˆ†æ–°æ‰‹å¼€å‘éƒ½ä¼šå»çœ‹å¤šçº¿ç¨‹ã€ä½†å‡ ä¹éƒ½æ²¡æœ‰ç›¸å…³çš„å®è·µã€‚ç”šè‡³æœ‰äº›éƒ½ä¸çŸ¥é“å¤šçº¿ç¨‹æ‹¿æ¥åœ¨å®é™…å¼€å‘ä¸­æœ‰ä»€ä¹ˆç”¨ã€‚ ä¸ºæ­¤æˆ‘æƒ³åŸºäºè¿™ä¸ªç®€å•çš„å·¥å…·ä¸ºè¿™ç±»æœ‹å‹å¸¦æ¥ä¸€ä¸ªå¯å®è·µã€æ˜“ç†è§£çš„å¤šçº¿ç¨‹æ¡ˆä¾‹ã€‚ è‡³å°‘å¯ä»¥è®©ä½ çŸ¥é“ï¼š ä¸ºä»€ä¹ˆéœ€è¦å¤šçº¿ç¨‹ï¼Ÿ æ€ä¹ˆå®ç°ä¸€ä¸ªå¤šçº¿ç¨‹ç¨‹åºï¼Ÿ å¤šçº¿ç¨‹å¸¦æ¥çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼Ÿ å•çº¿ç¨‹ç»Ÿè®¡å†è°ˆå¤šçº¿ç¨‹ä¹‹å‰å…ˆæ¥èŠèŠå•çº¿ç¨‹å¦‚ä½•å®ç°ã€‚ æœ¬æ¬¡çš„éœ€æ±‚ä¹Ÿå¾ˆç®€å•ï¼Œåªæ˜¯éœ€è¦æ‰«æä¸€ä¸ªç›®å½•è¯»å–ä¸‹é¢çš„æ‰€æœ‰æ–‡ä»¶å³å¯ã€‚ æ‰€æœ‰æˆ‘ä»¬çš„å®ç°æœ‰ä»¥ä¸‹å‡ æ­¥ï¼š è¯»å–æŸä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ã€‚ å°†æ‰€æœ‰æ–‡ä»¶çš„è·¯å¾„ä¿æŒåˆ°å†…å­˜ã€‚ éå†æ‰€æœ‰çš„æ–‡ä»¶æŒ¨ä¸ªè¯»å–æ–‡æœ¬è®°å½•å­—æ•°å³å¯ã€‚ å…ˆæ¥çœ‹å‰ä¸¤ä¸ªå¦‚ä½•å®ç°ï¼Œå¹¶ä¸”å½“æ‰«æåˆ°ç›®å½•æ—¶éœ€è¦ç»§ç»­è¯»å–å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚ è¿™æ ·çš„åœºæ™¯å°±éå¸¸é€‚åˆé€’å½’ï¼š 1234567891011121314151617181920 public List&lt;String&gt; getAllFile(String path)&#123; File f = new File(path) ; File[] files = f.listFiles(); for (File file : files) &#123; if (file.isDirectory())&#123; String directoryPath = file.getPath(); getAllFile(directoryPath); &#125;else &#123; String filePath = file.getPath(); if (!filePath.endsWith(".md"))&#123; continue; &#125; allFile.add(filePath) ; &#125; &#125; return allFile ; &#125;&#125; è¯»å–ä¹‹åå°†æ–‡ä»¶çš„è·¯å¾„ä¿æŒåˆ°ä¸€ä¸ªé›†åˆä¸­ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªé€’å½’æ¬¡æ•°éœ€è¦æ§åˆ¶ä¸‹ï¼Œé¿å…å‡ºç°æ ˆæº¢å‡º(StackOverflow)ã€‚ æœ€åè¯»å–æ–‡ä»¶å†…å®¹åˆ™æ˜¯ä½¿ç”¨ Java8 ä¸­çš„æµæ¥è¿›è¡Œè¯»å–ï¼Œè¿™æ ·ä»£ç å¯ä»¥æ›´ç®€æ´ï¼š 12Stream&lt;String&gt; stringStream = Files.lines(Paths.get(path), StandardCharsets.UTF_8);List&lt;String&gt; collect = stringStream.collect(Collectors.toList()); æ¥ä¸‹æ¥ä¾¿æ˜¯è¯»å–å­—æ•°ï¼ŒåŒæ—¶è¦è¿‡æ»¤ä¸€äº›ç‰¹æ®Šæ–‡æœ¬ï¼ˆæ¯”å¦‚æˆ‘æƒ³è¿‡æ»¤æ‰æ‰€æœ‰çš„ç©ºæ ¼ã€æ¢è¡Œã€è¶…é“¾æ¥ç­‰ï¼‰ã€‚ æ‰©å±•èƒ½åŠ›ç®€å•å¤„ç†å¯åœ¨ä¸Šé¢çš„ä»£ç ä¸­éå† collect ç„¶åæŠŠå…¶ä¸­éœ€è¦è¿‡æ»¤çš„å†…å®¹æ›¿æ¢ä¸ºç©ºå°±è¡Œã€‚ ä½†æ¯ä¸ªäººçš„æƒ³æ³•å¯èƒ½éƒ½ä¸ä¸€æ ·ã€‚æ¯”å¦‚æˆ‘åªæƒ³è¿‡æ»¤æ‰ç©ºæ ¼ã€æ¢è¡Œã€è¶…é“¾æ¥å°±è¡Œäº†ï¼Œä½†æœ‰äº›äººéœ€è¦å»æ‰å…¶ä¸­æ‰€æœ‰çš„è‹±æ–‡å•è¯ï¼Œç”šè‡³æ¢è¡Œè¿˜å¾—ç•™ç€ï¼ˆå°±åƒå†™ä½œæ–‡ä¸€æ ·å¯ä»¥å……å­—æ•°ï¼‰ã€‚ æ‰€æœ‰è¿™å°±éœ€è¦ä¸€ä¸ªæ¯”è¾ƒçµæ´»çš„å¤„ç†æ–¹å¼ã€‚ çœ‹è¿‡ä¸Šæ–‡ã€Šåˆ©ç”¨è´£ä»»é“¾æ¨¡å¼è®¾è®¡ä¸€ä¸ªæ‹¦æˆªå™¨ã€‹åº”è¯¥å¾ˆå®¹æ˜“æƒ³åˆ°è¿™æ ·çš„åœºæ™¯è´£ä»»é“¾æ¨¡å¼å†åˆé€‚ä¸è¿‡äº†ã€‚ å…³äºè´£ä»»é“¾æ¨¡å¼å…·ä½“çš„å†…å®¹å°±ä¸åœ¨è¯¦è¿°äº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥æŸ¥çœ‹ä¸Šæ–‡ã€‚ è¿™é‡Œç›´æ¥çœ‹å®ç°å§ï¼š å®šä¹‰è´£ä»»é“¾çš„æŠ½è±¡æ¥å£åŠå¤„ç†æ–¹æ³•ï¼š 12345678public interface FilterProcess &#123; /** * å¤„ç†æ–‡æœ¬ * @param msg * @return */ String process(String msg) ;&#125; å¤„ç†ç©ºæ ¼å’Œæ¢è¡Œçš„å®ç°ï¼š 1234567public class WrapFilterProcess implements FilterProcess&#123; @Override public String process(String msg) &#123; msg = msg.replaceAll("\\s*", ""); return msg ; &#125;&#125; å¤„ç†è¶…é“¾æ¥çš„å®ç°ï¼š 1234567public class HttpFilterProcess implements FilterProcess&#123; @Override public String process(String msg) &#123; msg = msg.replaceAll("^((https|http|ftp|rtsp|mms)?:\\/\\/)[^\\s]+",""); return msg ; &#125;&#125; è¿™æ ·åœ¨åˆå§‹åŒ–æ—¶éœ€è¦å°†è¿™äº›å¤„ç† handle éƒ½åŠ å…¥è´£ä»»é“¾ä¸­ï¼ŒåŒæ—¶æä¾›ä¸€ä¸ª API ä¾›å®¢æˆ·ç«¯æ‰§è¡Œå³å¯ã€‚ è¿™æ ·ä¸€ä¸ªç®€å•çš„ç»Ÿè®¡å­—æ•°çš„å·¥å…·å°±å®Œæˆäº†ã€‚ å¤šçº¿ç¨‹æ¨¡å¼åœ¨æˆ‘æœ¬åœ°ä¸€å…±å°±å‡ åç¯‡åšå®¢çš„æ¡ä»¶ä¸‹æ‰§è¡Œä¸€æ¬¡è¿˜æ˜¯å¾ˆå¿«çš„ï¼Œä½†å¦‚æœæˆ‘ä»¬çš„æ–‡ä»¶æ˜¯å‡ ä¸‡ã€å‡ åä¸‡ç”šè‡³ä¸Šç™¾ä¸‡å‘¢ã€‚ è™½ç„¶åŠŸèƒ½å¯ä»¥å®ç°ï¼Œä½†å¯ä»¥æƒ³è±¡è¿™æ ·çš„è€—æ—¶ç»å¯¹æ˜¯æˆå€çš„å¢åŠ ã€‚ è¿™æ—¶å¤šçº¿ç¨‹å°±å‘æŒ¥ä¼˜åŠ¿äº†ï¼Œç”±å¤šä¸ªçº¿ç¨‹åˆ†åˆ«å»è¯»å–æ–‡ä»¶æœ€åæ±‡æ€»ç»“æœå³å¯ã€‚ è¿™æ ·å®ç°çš„è¿‡ç¨‹å°±å˜ä¸ºï¼š è¯»å–æŸä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ã€‚ å°†æ–‡ä»¶è·¯å¾„äº¤ç”±ä¸åŒçš„çº¿ç¨‹è‡ªè¡Œå¤„ç†ã€‚ æœ€ç»ˆæ±‡æ€»ç»“æœã€‚ å¤šçº¿ç¨‹å¸¦æ¥çš„é—®é¢˜ä¹Ÿä¸æ˜¯ä½¿ç”¨å¤šçº¿ç¨‹å°±ä¸‡äº‹å¤§å‰äº†ï¼Œå…ˆæ¥çœ‹çœ‹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šå…±äº«èµ„æºã€‚ ç®€å•æ¥è¯´å°±æ˜¯æ€ä¹ˆä¿è¯å¤šçº¿ç¨‹å’Œå•çº¿ç¨‹ç»Ÿè®¡çš„æ€»å­—æ•°æ˜¯ä¸€è‡´çš„ã€‚ åŸºäºæˆ‘æœ¬åœ°çš„ç¯å¢ƒå…ˆçœ‹çœ‹å•çº¿ç¨‹è¿è¡Œçš„ç»“æœï¼š æ€»è®¡ä¸ºï¼š414142 å­—ã€‚ æ¥ä¸‹æ¥æ¢ä¸ºå¤šçº¿ç¨‹çš„æ–¹å¼ï¼š 12345678910111213141516171819202122232425262728293031323334List&lt;String&gt; allFile = scannerFile.getAllFile(strings[0]);logger.info("allFile size=[&#123;&#125;]",allFile.size());for (String msg : allFile) &#123; executorService.execute(new ScanNumTask(msg,filterProcessManager));&#125;public class ScanNumTask implements Runnable &#123; private static Logger logger = LoggerFactory.getLogger(ScanNumTask.class); private String path; private FilterProcessManager filterProcessManager; public ScanNumTask(String path, FilterProcessManager filterProcessManager) &#123; this.path = path; this.filterProcessManager = filterProcessManager; &#125; @Override public void run() &#123; Stream&lt;String&gt; stringStream = null; try &#123; stringStream = Files.lines(Paths.get(path), StandardCharsets.UTF_8); &#125; catch (Exception e) &#123; logger.error("IOException", e); &#125; List&lt;String&gt; collect = stringStream.collect(Collectors.toList()); for (String msg : collect) &#123; filterProcessManager.process(msg); &#125; &#125;&#125; ä½¿ç”¨çº¿ç¨‹æ± ç®¡ç†çº¿ç¨‹ï¼Œæ›´å¤šçº¿ç¨‹æ± ç›¸å…³çš„å†…å®¹è¯·çœ‹è¿™é‡Œï¼šã€Šå¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨å’Œç†è§£çº¿ç¨‹æ± ã€‹ æ‰§è¡Œç»“æœï¼š æˆ‘ä»¬ä¼šå‘ç°æ— è®ºæ‰§è¡Œå¤šå°‘æ¬¡ï¼Œè¿™ä¸ªå€¼éƒ½ä¼šå°äºæˆ‘ä»¬çš„é¢„æœŸå€¼ã€‚ æ¥çœ‹çœ‹ç»Ÿè®¡é‚£é‡Œæ˜¯æ€ä¹ˆå®ç°çš„ã€‚ 123456789101112@Componentpublic class TotalWords &#123; private long sum = 0 ; public void sum(int count)&#123; sum += count; &#125; public long total()&#123; return sum; &#125;&#125; å¯ä»¥çœ‹åˆ°å°±æ˜¯å¯¹ä¸€ä¸ªåŸºæœ¬ç±»å‹è¿›è¡Œç´¯åŠ è€Œå·²ã€‚é‚£å¯¼è‡´è¿™ä¸ªå€¼æ¯”é¢„æœŸå°çš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ æˆ‘æƒ³å¤§éƒ¨åˆ†äººéƒ½ä¼šè¯´ï¼šå¤šçº¿ç¨‹è¿è¡Œæ—¶ä¼šå¯¼è‡´æœ‰äº›çº¿ç¨‹æŠŠå…¶ä»–çº¿ç¨‹è¿ç®—çš„å€¼è¦†ç›–ã€‚ ä½†å…¶å®è¿™åªæ˜¯å¯¼è‡´è¿™ä¸ªé—®é¢˜çš„è¡¨è±¡ï¼Œæ ¹æœ¬åŸå› è¿˜æ˜¯æ²¡æœ‰è®²æ¸…æ¥šã€‚ å†…å­˜å¯è§æ€§æ ¸å¿ƒåŸå› å…¶å®æ˜¯ç”± Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰çš„è§„å®šå¯¼è‡´çš„ã€‚ è¿™é‡Œå¼•ç”¨ä¸€æ®µä¹‹å‰å†™çš„ã€Šä½ åº”è¯¥çŸ¥é“çš„ volatile å…³é”®å­—ã€‹ä¸€æ®µè§£é‡Šï¼š ç”±äº Java å†…å­˜æ¨¡å‹(JMM)è§„å®šï¼Œæ‰€æœ‰çš„å˜é‡éƒ½å­˜æ”¾åœ¨ä¸»å†…å­˜ä¸­ï¼Œè€Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ç€è‡ªå·±çš„å·¥ä½œå†…å­˜(é«˜é€Ÿç¼“å­˜)ã€‚ çº¿ç¨‹åœ¨å·¥ä½œæ—¶ï¼Œéœ€è¦å°†ä¸»å†…å­˜ä¸­çš„æ•°æ®æ‹·è´åˆ°å·¥ä½œå†…å­˜ä¸­ã€‚è¿™æ ·å¯¹æ•°æ®çš„ä»»ä½•æ“ä½œéƒ½æ˜¯åŸºäºå·¥ä½œå†…å­˜(æ•ˆç‡æé«˜)ï¼Œå¹¶ä¸”ä¸èƒ½ç›´æ¥æ“ä½œä¸»å†…å­˜ä»¥åŠå…¶ä»–çº¿ç¨‹å·¥ä½œå†…å­˜ä¸­çš„æ•°æ®ï¼Œä¹‹åå†å°†æ›´æ–°ä¹‹åçš„æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚ è¿™é‡Œæ‰€æåˆ°çš„ä¸»å†…å­˜å¯ä»¥ç®€å•è®¤ä¸ºæ˜¯å †å†…å­˜ï¼Œè€Œå·¥ä½œå†…å­˜åˆ™å¯ä»¥è®¤ä¸ºæ˜¯æ ˆå†…å­˜ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ‰€ä»¥åœ¨å¹¶å‘è¿è¡Œæ—¶å¯èƒ½ä¼šå‡ºç°çº¿ç¨‹ B æ‰€è¯»å–åˆ°çš„æ•°æ®æ˜¯çº¿ç¨‹ A æ›´æ–°ä¹‹å‰çš„æ•°æ®ã€‚ æ›´å¤šç›¸å…³å†…å®¹å°±ä¸å†å±•å¼€äº†ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ç¿»ç¿»ä»¥å‰çš„åšæ–‡ã€‚ ç›´æ¥æ¥è¯´å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å§ï¼ŒJDK å…¶å®å·²ç»å¸®æˆ‘ä»¬æƒ³åˆ°äº†è¿™äº›é—®é¢˜ã€‚ åœ¨ java.util.concurrent å¹¶å‘åŒ…ä¸‹æœ‰è®¸å¤šä½ å¯èƒ½ä¼šä½¿ç”¨åˆ°çš„å¹¶å‘å·¥å…·ã€‚ è¿™é‡Œå°±éå¸¸é€‚åˆ AtomicLongï¼Œå®ƒå¯ä»¥åŸå­æ€§çš„å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚ æ¥çœ‹çœ‹ä¿®æ”¹åçš„å®ç°ï¼š 123456789101112@Componentpublic class TotalWords &#123; private AtomicLong sum = new AtomicLong() ; public void sum(int count)&#123; sum.addAndGet(count) ; &#125; public long total()&#123; return sum.get() ; &#125;&#125; åªæ˜¯ä½¿ç”¨äº†å®ƒçš„ä¸¤ä¸ª API è€Œå·²ã€‚å†æ¥è¿è¡Œä¸‹ç¨‹åºä¼šå‘ç°ç»“æœå±…ç„¶è¿˜æ˜¯ä¸å¯¹ã€‚ ç”šè‡³ä¸º 0 äº†ã€‚ çº¿ç¨‹é—´é€šä¿¡è¿™æ—¶åˆå‡ºç°äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œæ¥çœ‹çœ‹è·å–æ€»è®¡æ•°æ®æ˜¯æ€ä¹ˆå®ç°çš„ã€‚ 12345678910List&lt;String&gt; allFile = scannerFile.getAllFile(strings[0]);logger.info("allFile size=[&#123;&#125;]",allFile.size());for (String msg : allFile) &#123; executorService.execute(new ScanNumTask(msg,filterProcessManager));&#125;executorService.shutdown();long total = totalWords.total();long end = System.currentTimeMillis();logger.info("total sum=[&#123;&#125;],[&#123;&#125;] ms",total,end-start); ä¸çŸ¥é“å¤§å®¶çœ‹å‡ºé—®é¢˜æ²¡æœ‰ï¼Œå…¶å®æ˜¯åœ¨æœ€åæ‰“å°æ€»æ•°æ—¶å¹¶ä¸çŸ¥é“å…¶ä»–çº¿ç¨‹æ˜¯å¦å·²ç»æ‰§è¡Œå®Œæ¯•äº†ã€‚ å› ä¸º executorService.execute() ä¼šç›´æ¥è¿”å›ï¼Œæ‰€ä»¥å½“æ‰“å°è·å–æ•°æ®æ—¶è¿˜æ²¡æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œä¹Ÿå°±å¯¼è‡´äº†è¿™æ ·çš„ç»“æœã€‚ å…³äºçº¿ç¨‹é—´é€šä¿¡ä¹‹å‰æˆ‘ä¹Ÿå†™è¿‡ç›¸å…³çš„å†…å®¹ï¼šã€Šæ·±å…¥ç†è§£çº¿ç¨‹é€šä¿¡ã€‹ å¤§æ¦‚çš„æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çº¿ç¨‹æ± çš„æ–¹å¼ï¼š åœ¨åœç”¨çº¿ç¨‹æ± ååŠ ä¸Šä¸€ä¸ªåˆ¤æ–­æ¡ä»¶å³å¯ï¼š 1234567executorService.shutdown();while (!executorService.awaitTermination(100, TimeUnit.MILLISECONDS)) &#123; logger.info("worker running");&#125;long total = totalWords.total();long end = System.currentTimeMillis();logger.info("total sum=[&#123;&#125;],[&#123;&#125;] ms",total,end-start); è¿™æ ·æˆ‘ä»¬å†æ¬¡å°è¯•ï¼Œå‘ç°æ— è®ºå¤šå°‘æ¬¡ç»“æœéƒ½æ˜¯æ­£ç¡®çš„äº†ï¼š æ•ˆç‡æå‡å¯èƒ½è¿˜ä¼šæœ‰æœ‹å‹é—®ï¼Œè¿™æ ·çš„æ–¹å¼ä¹Ÿæ²¡è§æå‡å¤šå°‘æ•ˆç‡å•Šã€‚ è¿™å…¶å®æ˜¯ç”±äºæˆ‘æœ¬åœ°æ–‡ä»¶å°‘ï¼ŒåŠ ä¸Šä¸€ä¸ªæ–‡ä»¶å¤„ç†çš„è€—æ—¶ä¹Ÿæ¯”è¾ƒçŸ­å¯¼è‡´çš„ã€‚ ç”šè‡³çº¿ç¨‹æ•°å¼€çš„å¤Ÿå¤šå¯¼è‡´é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢è¿˜æ˜¯è®©æ‰§è¡Œæ•ˆç‡é™ä½ã€‚ ä¸ºäº†æ¨¡æ‹Ÿæ•ˆç‡çš„æå‡ï¼Œæ¯å¤„ç†ä¸€ä¸ªæ–‡ä»¶æˆ‘éƒ½è®©å½“å‰çº¿ç¨‹ä¼‘çœ  100 æ¯«ç§’æ¥æ¨¡æ‹Ÿæ‰§è¡Œè€—æ—¶ã€‚ å…ˆçœ‹å•çº¿ç¨‹è¿è¡Œéœ€è¦è€—æ—¶å¤šä¹…ã€‚ æ€»å…±è€—æ—¶ï¼š[8404] ms æ¥ç€åœ¨çº¿ç¨‹æ± å¤§å°ä¸º 4 çš„æƒ…å†µä¸‹è€—æ—¶ï¼š æ€»å…±è€—æ—¶ï¼š[2350] ms å¯è§æ•ˆç‡æå‡è¿˜æ˜¯éå¸¸æ˜æ˜¾çš„ã€‚ æ›´å¤šæ€è€ƒè¿™åªæ˜¯å¤šçº¿ç¨‹å…¶ä¸­çš„ä¸€ä¸ªç”¨æ³•ï¼Œç›¸ä¿¡çœ‹åˆ°è¿™é‡Œçš„æœ‹å‹åº”è¯¥å¤šå®ƒçš„ç†è§£æ›´è¿›ä¸€æ­¥äº†ã€‚ å†ç»™å¤§å®¶ç•™ä¸ªé˜…åç»ƒä¹ ï¼Œåœºæ™¯ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼š åœ¨ Redis æˆ–è€…å…¶ä»–å­˜å‚¨ä»‹è´¨ä¸­å­˜æ”¾æœ‰ä¸Šåƒä¸‡çš„æ‰‹æœºå·ç æ•°æ®ï¼Œæ¯ä¸ªå·ç éƒ½æ˜¯å”¯ä¸€çš„ï¼Œéœ€è¦åœ¨æœ€å¿«çš„æ—¶é—´å†…æŠŠè¿™äº›å·ç å…¨éƒ¨éƒ½éå†ä¸€éã€‚ æœ‰æƒ³æ³•æ„Ÿå…´è¶£çš„æœ‹å‹æ¬¢è¿åœ¨æ–‡æœ«ç•™è¨€å‚ä¸è®¨è®ºğŸ¤”ğŸ¤¨ã€‚ æ€»ç»“å¸Œæœ›çœ‹å®Œçš„æœ‹å‹å¿ƒä¸­èƒ½å¯¹æ–‡åˆçš„å‡ ä¸ªé—®é¢˜èƒ½æœ‰è‡ªå·±çš„ç­”æ¡ˆï¼š ä¸ºä»€ä¹ˆéœ€è¦å¤šçº¿ç¨‹ï¼Ÿ æ€ä¹ˆå®ç°ä¸€ä¸ªå¤šçº¿ç¨‹ç¨‹åºï¼Ÿ å¤šçº¿ç¨‹å¸¦æ¥çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼Ÿ æ–‡ä¸­çš„ä»£ç éƒ½åœ¨æ­¤å¤„ã€‚ https://github.com/crossoverJie/NOWS ä½ çš„ç‚¹èµä¸è½¬å‘æ˜¯æœ€å¤§çš„æ”¯æŒã€‚]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>ThreadPool</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ©ç”¨è´£ä»»é“¾æ¨¡å¼è®¾è®¡ä¸€ä¸ªæ‹¦æˆªå™¨]]></title>
    <url>%2F2018%2F10%2F22%2Fwheel%2Fcicada5%2F</url>
    <content type="text"><![CDATA[å‰è¨€è¿‘æœŸåœ¨åš Cicada çš„æ‹¦æˆªå™¨åŠŸèƒ½ï¼Œæ­£å¥½ç”¨åˆ°äº†è´£ä»»é“¾æ¨¡å¼ã€‚ è¿™ä¸ªè®¾è®¡æ¨¡å¼åœ¨æ—¥å¸¸ä½¿ç”¨ä¸­é¢‘ç‡è¿˜æ˜¯æŒºé«˜çš„ï¼Œå€Ÿæ­¤æœºä¼šæ¥åˆ†æåˆ†æã€‚ è´£ä»»é“¾æ¨¡å¼å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯è´£ä»»é“¾æ¨¡å¼ã€‚ å¼•ç”¨ä¸€æ®µç»´åŸºç™¾ç§‘å¯¹å…¶çš„è§£é‡Šï¼š è´£ä»»é“¾æ¨¡å¼åœ¨é¢å‘å¯¹è±¡ç¨‹å¼è®¾è®¡é‡Œæ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œå®ƒåŒ…å«äº†ä¸€äº›å‘½ä»¤å¯¹è±¡å’Œä¸€ç³»åˆ—çš„å¤„ç†å¯¹è±¡ã€‚æ¯ä¸€ä¸ªå¤„ç†å¯¹è±¡å†³å®šå®ƒèƒ½å¤„ç†å“ªäº›å‘½ä»¤å¯¹è±¡ï¼Œå®ƒä¹ŸçŸ¥é“å¦‚ä½•å°†å®ƒä¸èƒ½å¤„ç†çš„å‘½ä»¤å¯¹è±¡ä¼ é€’ç»™è¯¥é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå¤„ç†å¯¹è±¡ã€‚è¯¥æ¨¡å¼è¿˜æè¿°äº†å¾€è¯¥å¤„ç†é“¾çš„æœ«å°¾æ·»åŠ æ–°çš„å¤„ç†å¯¹è±¡çš„æ–¹æ³•ã€‚ å…‰çœ‹è¿™æ®µæè¿°å¯èƒ½å¤§å®¶ä¼šè§‰å¾—æ‡µï¼Œç®€å•æ¥è¯´å°±æ˜¯è¯¥è®¾è®¡æ¨¡å¼ç”¨äºå¯¹æŸä¸ªå¯¹è±¡æˆ–è€…è¯·æ±‚è¿›è¡Œä¸€ç³»åˆ—çš„å¤„ç†ï¼Œè¿™äº›å¤„ç†é€»è¾‘æ­£å¥½ç»„æˆä¸€ä¸ªé“¾æ¡ã€‚ ä¸‹é¢æ¥ç®€å•æ¼”ç¤ºä½¿ç”¨ä¸ä¸ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«å’Œä¼˜åŠ¿ã€‚ è´£ä»»é“¾æ¨¡å¼çš„åº”ç”¨ä¼ ç»Ÿå®ç°å‡è®¾è¿™æ ·çš„åœºæ™¯ï¼šä¼ å…¥äº†ä¸€æ®µå†…å®¹ï¼Œéœ€è¦å¯¹è¿™æ®µæ–‡æœ¬è¿›è¡ŒåŠ å·¥ï¼›æ¯”å¦‚è¿‡æ»¤æ•æ„Ÿè¯ã€é”™åˆ«å­—ä¿®æ”¹ã€æœ€åç½²ä¸Šç‰ˆæƒç­‰æ“ä½œã€‚ å¸¸è§çš„å†™æ³•å¦‚ä¸‹ï¼š 123456789public class Main &#123; public static void main(String[] args) &#123; String msg = "å†…å®¹å†…å®¹å†…å®¹" ; String result = Process.sensitiveWord() .typo() .copyright(); &#125;&#125; è¿™æ ·çœ‹ä¼¼æ²¡å•¥é—®é¢˜ä¹Ÿèƒ½è§£å†³éœ€æ±‚ï¼Œä½†å¦‚æœæˆ‘è¿˜éœ€è¦ä¸ºä¸ºå†…å®¹åŠ ä¸Šä¸€ä¸ªç»Ÿä¸€çš„æ ‡é¢˜å‘¢ï¼Ÿåœ¨ç°æœ‰çš„æ–¹å¼ä¸‹å°±ä¸å¾—ä¸æ–°å¢å¤„ç†æ–¹æ³•ï¼Œå¹¶ä¸”æ˜¯åœ¨è¿™ä¸ªå®¢æˆ·ç«¯ï¼ˆProcessï¼‰çš„åŸºç¡€ä¸Šè¿›è¡Œæ–°å¢ã€‚ æ˜¾ç„¶è¿™æ ·çš„æ‰©å±•æ€§ä¸å¥½ã€‚ è´£ä»»é“¾æ¨¡å¼å®ç°è¿™æ—¶å€™å°±åˆ°äº†è´£ä»»é“¾æ¨¡å¼å‘æŒ¥ä½œç”¨äº†ã€‚ è¯¥éœ€æ±‚éå¸¸çš„ç¬¦åˆå¯¹æŸä¸€ä¸ªå¯¹è±¡ã€è¯·æ±‚è¿›è¡Œä¸€ç³»åˆ—å¤„ç†çš„ç‰¹å¾ã€‚ äºæ˜¯æˆ‘ä»¬å°†ä»£ç ä¿®æ”¹ï¼š è¿™æ—¶ Process å°±æ˜¯ä¸€ä¸ªæ¥å£äº†ï¼Œç”¨äºå®šä¹‰çœŸæ­£çš„å¤„ç†å‡½æ•°ã€‚ 12345678public interface Process &#123; /** * æ‰§è¡Œå¤„ç† * @param msg */ void doProcess(String msg) ;&#125; åŒæ—¶ä¹‹å‰å¯¹å†…å®¹çš„å„ç§å¤„ç†åªéœ€è¦å®ç°è¯¥æ¥å£å³å¯ï¼š 12345678910111213141516171819202122public class SensitiveWordProcess implements Process &#123; @Override public void doProcess(String msg) &#123; System.out.println(msg + "æ•æ„Ÿè¯å¤„ç†"); &#125;&#125;public class CopyrightProcess implements Process &#123; @Override public void doProcess(String msg) &#123; System.out.println(msg + "ç‰ˆæƒå¤„ç†"); &#125;&#125;public class CopyrightProcess implements Process &#123; @Override public void doProcess(String msg) &#123; System.out.println(msg + "ç‰ˆæƒå¤„ç†"); &#125;&#125; ç„¶ååªéœ€è¦ç»™å®¢æˆ·ç«¯æä¾›ä¸€ä¸ªæ‰§è¡Œå…¥å£ä»¥åŠæ·»åŠ è´£ä»»é“¾çš„å…¥å£å³å¯ï¼š 123456789101112131415161718192021222324public class MsgProcessChain &#123; private List&lt;Process&gt; chains = new ArrayList&lt;&gt;() ; /** * æ·»åŠ è´£ä»»é“¾ * @param process * @return */ public MsgProcessChain addChain(Process process)&#123; chains.add(process) ; return this ; &#125; /** * æ‰§è¡Œå¤„ç† * @param msg */ public void process(String msg)&#123; for (Process chain : chains) &#123; chain.doProcess(msg); &#125; &#125;&#125; è¿™æ ·ä½¿ç”¨èµ·æ¥å°±éå¸¸ç®€å•ï¼š 123456789101112public class Main &#123; public static void main(String[] args) &#123; String msg = "å†…å®¹å†…å®¹å†…å®¹==" ; MsgProcessChain chain = new MsgProcessChain() .addChain(new SensitiveWordProcess()) .addChain(new TypoProcess()) .addChain(new CopyrightProcess()) ; chain.process(msg) ; &#125;&#125; å½“æˆ‘éœ€è¦å†å¢åŠ ä¸€ä¸ªå¤„ç†é€»è¾‘æ—¶åªéœ€è¦æ·»åŠ ä¸€ä¸ªå¤„ç†å•å…ƒå³å¯ï¼ˆaddChain(Process process)ï¼‰ï¼Œå¹¶å¯¹å®¢æˆ·ç«¯ chain.process(msg) æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œä¸éœ€è¦åšä»»ä½•çš„æ”¹åŠ¨ã€‚ å¯èƒ½å¤§å®¶æ²¡æœ‰ç›´æ¥å†™è¿‡è´£ä»»é“¾æ¨¡å¼çš„ç›¸å…³ä»£ç ï¼Œä½†ä¸ç»æ„é—´ä½¿ç”¨åˆ°çš„å´ä¸å°‘ã€‚ æ¯”å¦‚ Netty ä¸­çš„ pipeline å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„è´£ä»»é“¾æ¨¡å¼ï¼Œå®ƒå¯ä»¥è®©ä¸€ä¸ªè¯·æ±‚åœ¨æ•´ä¸ªç®¡é“ä¸­è¿›è¡Œæµè½¬ã€‚ é€šè¿‡å®˜æ–¹å›¾å°±å¯ä»¥éå¸¸æ¸…æ¥šçš„çœ‹å‡ºæ˜¯ä¸€ä¸ªè´£ä»»é“¾æ¨¡å¼ï¼š ç”¨è´£ä»»é“¾æ¨¡å¼è®¾è®¡ä¸€ä¸ªæ‹¦æˆªå™¨å¯¹äºæ‹¦æˆªå™¨æ¥è¯´ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼å†å¥½ä¸è¿‡äº†ã€‚ ä¸‹é¢æ¥çœ‹çœ‹åœ¨ Cicada ä¸­çš„å®ç°ï¼š é¦–å…ˆæ˜¯å®šä¹‰äº†å’Œä¸Šæ–‡ Process æ¥å£ç±»ä¼¼çš„ CicadaInterceptor æŠ½è±¡ç±»ï¼š 12345678public abstract class CicadaInterceptor &#123; public boolean before(CicadaContext context,Param param) throws Exception&#123; return true; &#125; public void after(CicadaContext context,Param param) throws Exception&#123;&#125;&#125; åŒæ—¶å®šä¹‰äº†ä¸€ä¸ª InterceptProcess çš„å®¢æˆ·ç«¯ï¼š å…¶ä¸­çš„ loadInterceptors() ä¼šå°†æ‰€æœ‰çš„æ‹¦æˆªå™¨åŠ å…¥åˆ°è´£ä»»é“¾ä¸­ã€‚ å†æä¾›äº†ä¸¤ä¸ªå‡½æ•°åˆ†åˆ«å¯¹åº”äº†æ‹¦æˆªå‰å’Œæ‹¦æˆªåçš„å…¥å£ï¼š å®é™…åº”ç”¨ç°åœ¨æ¥çœ‹çœ‹å…·ä½“æ˜¯æ€ä¹ˆä½¿ç”¨çš„å§ã€‚ åœ¨è¯·æ±‚çš„ handle ä¸­é¦–å…ˆè¿›è¡ŒåŠ è½½ï¼ˆloadInterceptors(AppConfig appConfig)ï¼‰ï¼Œä¹Ÿå°±æ˜¯åˆå§‹åŒ–è´£ä»»é“¾ã€‚ æ¥ä¸‹æ¥åˆ™æ˜¯å®¢æˆ·ç«¯çš„å…¥å£ï¼›è°ƒç”¨æ‹¦æˆªå‰åçš„å…¥å£æ–¹æ³•å³å¯ã€‚ ç”±äºæ˜¯æ‹¦æˆªå™¨ï¼Œé‚£ä¹ˆåœ¨ before å‡½æ•°ä¸­æ˜¯å¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œæ‹¦æˆªçš„ã€‚åªè¦è¿”å› false å°±ä¸ä¼šç»§ç»­å‘åå¤„ç†ã€‚æ‰€ä»¥è¿™é‡Œåšäº†ä¸€ä¸ªè¿”å›å€¼çš„åˆ¤æ–­ã€‚ åŒæ—¶å¯¹äºä½¿ç”¨è€…æ¥è¯´åªéœ€è¦åˆ›å»ºæ‹¦æˆªå™¨ç±»ç»§æ‰¿ CicadaInterceptor ç±»å³å¯ã€‚ è¿™é‡Œåšäº†ä¸€ä¸ªæ¼”ç¤ºï¼Œåˆ†åˆ«æœ‰ä¸¤ä¸ªæ‹¦æˆªå™¨ï¼š è®°å½•ä¸€ä¸ªä¸šåŠ¡ handle çš„æ‰§è¡Œæ—¶é—´ã€‚ åœ¨ after é‡Œæ‰“å°äº†è¯·æ±‚å‚æ•°ã€‚ åŒæ—¶å¯åœ¨ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨ä¸­è¿”å› false è®©è¯·æ±‚è¢«æ‹¦æˆªã€‚ å…ˆæ¥åšå‰ä¸¤ä¸ªè¯•éªŒï¼š è¿™æ ·å½“æˆ‘è¯·æ±‚å…¶ä¸­ä¸€ä¸ªæ¥å£æ—¶ä¼šå°†åˆšæ‰çš„æ—¥å¿—æ‰“å°å‡ºæ¥ï¼š æ¥ä¸‹æ¥æˆ‘è®©æ‰“å°æ‰§è¡Œæ—¶é—´çš„æ‹¦æˆªå™¨ä¸­æ‹¦æˆªè¯·æ±‚ï¼ŒåŒæ—¶è¾“å…¥å‘å‰ç«¯è¾“å…¥ä¸€æ®µæ–‡æœ¬ï¼š è¯·æ±‚æ¥å£å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š åŒæ—¶åé¢çš„è¯·æ±‚å‚æ•°ä¹Ÿæ²¡æœ‰æ‰“å°å‡ºæ¥ï¼Œè¯´æ˜è¯·æ±‚ç¡®å®è¢«æ‹¦æˆªä¸‹æ¥ã€‚ åŒæ—¶æˆ‘ä¹Ÿå¯ä»¥è°ƒæ•´æ‹¦æˆªé¡ºåºï¼Œåªéœ€è¦åœ¨@Interceptor(order = 1) æ³¨è§£ä¸­å®šä¹‰è¿™ä¸ª order å±æ€§å³å¯ï¼ˆé»˜è®¤å€¼æ˜¯ 0ï¼Œè¶Šå°è¶Šå…ˆæ‰§è¡Œï¼‰ã€‚ ä¹‹å‰æ˜¯æ‰“å°è¯·æ±‚å‚æ•°çš„æ‹¦æˆªå™¨å…ˆæ‰§è¡Œï¼Œè¿™æ¬¡æˆ‘æ‰‹åŠ¨å°†å®ƒçš„ order è°ƒæ•´ä¸º 2ï¼Œè€Œæ‰“å°æ—¶é—´çš„ order ä¸º 1 ã€‚ å†æ¬¡è¯·æ±‚æ¥å£è§‚å¯Ÿåå°æ—¥å¿—ï¼š å‘ç°æ‰“å°æ‰§è¡Œæ—¶é—´çš„æ‹¦æˆªå™¨å…ˆæ‰§è¡Œã€‚ é‚£è¿™ä¸ªæ‰§è¡Œæ‰§è¡Œé¡ºåºå¦‚ä½•å®ç°è‡ªå®šä¹‰é…ç½®çš„å‘¢ï¼Ÿ å…¶å®ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæœ‰ä»¥ä¸‹å‡ æ­¥ï¼š åœ¨åŠ è½½æ‹¦æˆªå™¨æ—¶å°†æ³¨è§£é‡Œçš„ order ä¿å­˜èµ·æ¥ã€‚ è®¾ç½®æ‹¦æˆªå™¨åˆ°è´£ä»»é“¾ä¸­æ—¶é€šè¿‡åå°„å°† order çš„å€¼ä¿å­˜åˆ°å„ä¸ªæ‹¦æˆªå™¨ä¸­ã€‚ æœ€ç»ˆé€šè¿‡æ’åºé‡æ–°æ’åˆ—è¿™ä¸ªè´£ä»»é“¾çš„é¡ºåºã€‚ è´´ä¸€äº›æ ¸å¿ƒä»£ç ã€‚ æ‰«ææ‹¦æˆªå™¨æ—¶ä¿å­˜ order å€¼ï¼š ä¿å­˜ order å€¼åˆ°æ‹¦æˆªå™¨ä¸­ï¼š é‡æ–°å¯¹è´£ä»»é“¾æ’åºï¼š æ€»ç»“æ•´ä¸ªè´£ä»»é“¾æ¨¡å¼å·²ç»è®²å®Œï¼Œå¸Œæœ›å¯¹è¿™ä¸ªè®¾è®¡æ¨¡å¼è¿˜ä¸äº†è§£çš„æœ‹å‹å¸¦æ¥äº›å¸®åŠ©ã€‚ ä¸Šæ–‡ä¸­çš„æºç å¦‚ä¸‹ï¼š https://github.com/TogetherOS/cicada:ä¸€ä¸ªé«˜æ€§èƒ½ã€è½»é‡ HTTP æ¡†æ¶ https://git.io/fxKid æ¬¢è¿å…³æ³¨å…¬ä¼—å·ä¸€èµ·äº¤æµï¼š]]></content>
      <categories>
        <category>cicada</category>
        <category>è½®å­</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>HTTP</tag>
        <tag>Netty</tag>
        <tag>è´£ä»»é“¾</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†äº«å‡ ä¸ª SpringBoot å®ç”¨çš„å°æŠ€å·§]]></title>
    <url>%2F2018%2F10%2F15%2FSpringBoot%2FSpringBoot-tips%2F</url>
    <content type="text"><![CDATA[å‰è¨€æœ€è¿‘åˆ†äº«çš„ä¸€äº›æºç ã€æ¡†æ¶è®¾è®¡çš„ä¸œè¥¿ã€‚æˆ‘å‘ç°å¤§å®¶çƒ­æƒ…ä¸æ˜¯ç‰¹åˆ«é«˜ï¼Œæƒ³æƒ³å¤§å¤šæ•°åº”è¯¥è¿˜æ˜¯æ­£å„¿å…«ç»å†™ä»£ç çš„å±…å¤šï¼›è¿™æ¬¡å°±åˆ†äº«ä¸€ç‚¹æ¥åœ°æ°”çš„ï¼š SpringBoot ä½¿ç”¨ä¸­çš„ä¸€äº›å°æŠ€å·§ã€‚ ç®—ä¸ä¸Šå¤šé«˜å¤§ä¸Šçš„ä¸œè¥¿ï¼Œä½†éƒ½è¿˜æŒºæœ‰ç”¨ã€‚ å±è”½å¤–éƒ¨ä¾èµ–ç¬¬ä¸€ä¸ªæ˜¯å±è”½å¤–éƒ¨ä¾èµ–ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ æ¯”å¦‚å¤§å®¶æ—¥å¸¸å¼€å‘æ—¶å€™æœ‰æ²¡æœ‰è¿™æ ·çš„çƒ¦æ¼ï¼š é¡¹ç›®æ˜¯åŸºäº SpringCloud æˆ–è€…æ˜¯ dubbo è¿™æ ·çš„åˆ†å¸ƒå¼æœåŠ¡ï¼Œä½ éœ€è¦ä¾èµ–è®¸å¤šåŸºç¡€æœåŠ¡ã€‚ æ¯”å¦‚è¯´æŸä¸ªè®¢å•å·çš„ç”Ÿæˆã€è·å–ç”¨æˆ·ä¿¡æ¯ç­‰ã€‚ ç”±äºæœåŠ¡æ‹†åˆ†ï¼Œè¿™äº›åŠŸèƒ½éƒ½æ˜¯åœ¨å…¶ä»–åº”ç”¨ä¸­ä»¥æ¥å£çš„å½¢å¼æä¾›ï¼Œå•æµ‹è¿˜å¥½æˆ‘è¿˜å¯ä»¥åˆ©ç”¨ Mock æŠŠå®ƒå±è”½æ‰ã€‚ ä½†å¦‚æœè‡ªå·±æƒ³æŠŠåº”ç”¨å¯åŠ¨èµ·æ¥åŒæ—¶æŠŠè‡ªå·±ç›¸å…³çš„ä»£ç è·‘ä¸€éå‘¢ï¼Ÿ é€šå¸¸æœ‰å‡ ç§åšæ³•ï¼š æœ¬åœ°æŠŠæ‰€æœ‰çš„æœåŠ¡éƒ½å¯åŠ¨èµ·æ¥ã€‚ æŠŠæ³¨å†Œä¸­å¿ƒæ¢ä¸ºå¼€å‘ç¯å¢ƒï¼Œä¾èµ–å¼€å‘ç¯å¢ƒçš„æœåŠ¡ã€‚ ç›´æ¥æŠŠä»£ç æ¨é€åˆ°å¼€å‘ç¯å¢ƒè‡ªæµ‹ã€‚ çœ‹èµ·æ¥ä¸‰ç§éƒ½å¯ä»¥ï¼Œä»¥å‰æˆ‘ä¹Ÿæ˜¯è¿™ä¹ˆå¹²çš„ã€‚ä½†è¿˜æ˜¯æœ‰å‡ ä¸ªå°é—®é¢˜ï¼š æœ¬åœ°å¯åŠ¨æœ‰å¯èƒ½æœåŠ¡å¾ˆå¤šï¼Œå…¨éƒ¨èµ·æ¥ç”µè„‘èƒ½ä¸èƒ½æ’‘ä½è¿˜ä¸¤è¯´ï¼Œä¸‡ä¸€æœåŠ¡æœ‰é—®é¢˜å°±è¿›è¡Œä¸ä¸‹å»äº†ã€‚ ä¾èµ–å¼€å‘ç¯å¢ƒçš„å‰ææ˜¯ç½‘ç»œæ‰“é€šï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¼€å‘ç¯å¢ƒä»£ç å¾ˆä¸ç¨³å®šå¾ˆå¤§å¯èƒ½ä¼šå½±å“ä½ çš„æµ‹è¯•ã€‚ æ¨é€åˆ°å¼€å‘ç¯å¢ƒåº”è¯¥æ˜¯æ¯”è¾ƒé è°±çš„æ–¹æ¡ˆï¼Œä½†å¦‚æœæƒ³è°ƒè¯•åªæœ‰æ—¥å¿—å¤§æ³•ï¼Œæ²¡æœ‰æœ¬åœ° debug çš„æ•ˆç‡é«˜æ•ˆã€‚ é‚£å¦‚ä½•è§£å†³é—®é¢˜å‘¢ï¼Ÿæ—¢å¯ä»¥åœ¨æœ¬åœ°è°ƒè¯•ä¹Ÿä¸ç”¨å¯åŠ¨å…¶ä»–æœåŠ¡ã€‚ å…¶å®ä¹Ÿå¯ä»¥åˆ©ç”¨å•æµ‹çš„åšæ³•ï¼ŒæŠŠå…¶ä»–å¤–éƒ¨ä¾èµ– Mock æ‰å°±è¡Œäº†ã€‚ å¤§è‡´çš„æµç¨‹åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š SpringBoot å¯åŠ¨ä¹‹ååœ¨ Spring ä¸­æ‰¾å‡ºä½ éœ€è¦å±è”½çš„é‚£ä¸ª API çš„ beanï¼ˆé€šå¸¸æƒ…å†µä¸‹è¿™ä¸ªæ¥å£éƒ½æ˜¯äº¤ç»™ Spring ç®¡ç†çš„ï¼‰ã€‚ æ‰‹åŠ¨ä» bean å®¹å™¨ä¸­åˆ é™¤è¯¥ beanã€‚ é‡æ–°åˆ›å»ºä¸€ä¸ªè¯¥ API çš„å¯¹è±¡ï¼Œåªä¸è¿‡æ˜¯é€šè¿‡ Mock å‡ºæ¥çš„ã€‚ å†æ‰‹åŠ¨æ³¨å†Œè¿› bean å®¹å™¨ä¸­ã€‚ ä»¥ä¸‹é¢è¿™æ®µä»£ç ä¸ºä¾‹ï¼š 123456789@Overridepublic BaseResponse&lt;OrderNoResVO&gt; getUserByHystrix(@RequestBody UserReqVO userReqVO) &#123; OrderNoReqVO vo = new OrderNoReqVO(); vo.setAppId(123L); vo.setReqNo(userReqVO.getReqNo()); BaseResponse&lt;OrderNoResVO&gt; orderNo = orderServiceClient.getOrderNo(vo); return orderNo;&#125; è¿™æ˜¯ä¸€ä¸ª SpringCloud åº”ç”¨ã€‚ å®ƒä¾èµ–äº orderServiceClient è·å–ä¸€ä¸ªè®¢å•å·ã€‚ å…¶ä¸­çš„ orderServiceClient å°±æ˜¯ä¸€ä¸ªå¤–éƒ¨ APIï¼Œä¹Ÿæ˜¯è¢« Spring æ‰€ç®¡ç†ã€‚ æ›¿æ¢åŸæœ‰çš„ Beanä¸‹ä¸€æ­¥å°±æ˜¯æ›¿æ¢åŸæœ‰çš„ Beanã€‚ 12345678910111213141516171819202122232425262728293031323334@Componentpublic class OrderMockServiceConfig implements CommandLineRunner &#123; private final static Logger logger = LoggerFactory.getLogger(OrderMockServiceConfig.class); @Autowired private ApplicationContext applicationContext; @Value("$&#123;excute.env&#125;") private String env; @Override public void run(String... strings) throws Exception &#123; // éæœ¬åœ°ç¯å¢ƒä¸åšå¤„ç† if ("dev".equals(env) || "test".equals(env) || "pro".equals(env)) &#123; return; &#125; DefaultListableBeanFactory defaultListableBeanFactory = (DefaultListableBeanFactory) applicationContext.getAutowireCapableBeanFactory(); OrderServiceClient orderServiceClient = defaultListableBeanFactory.getBean(OrderServiceClient.class); logger.info("======orderServiceClient &#123;&#125;=====", orderServiceClient.getClass()); defaultListableBeanFactory.removeBeanDefinition(OrderServiceClient.class.getCanonicalName()); OrderServiceClient mockOrderApi = PowerMockito.mock(OrderServiceClient.class, invocationOnMock -&gt; BaseResponse.createSuccess(DateUtil.getLongTime() + "", "mock orderNo success")); defaultListableBeanFactory.registerSingleton(OrderServiceClient.class.getCanonicalName(), mockOrderApi); logger.info("======mockOrderApi &#123;&#125;=====", mockOrderApi.getClass()); &#125;&#125; å…¶ä¸­å®ç°äº† CommandLineRunner æ¥å£ï¼Œå¯ä»¥åœ¨ Spring å®¹å™¨åˆå§‹åŒ–å®Œæˆä¹‹åè°ƒç”¨ run() æ–¹æ³•ã€‚ ä»£ç éå¸¸ç®€å•ï¼Œç®€å•æ¥è¯´é¦–å…ˆåˆ¤æ–­ä¸‹æ˜¯ä»€ä¹ˆç¯å¢ƒï¼Œæ¯•ç«Ÿé™¤å¼€æœ¬åœ°ç¯å¢ƒå…¶ä½™çš„éƒ½æ˜¯éœ€è¦çœŸæ­£è°ƒç”¨è¿œç¨‹æœåŠ¡çš„ã€‚ ä¹‹åå°±æ˜¯è·å– bean ç„¶åæ‰‹åŠ¨åˆ é™¤æ‰ã€‚ å…³é”®çš„ä¸€æ­¥ï¼š 1234OrderServiceClient mockOrderApi = PowerMockito.mock(OrderServiceClient.class, invocationOnMock -&gt; BaseResponse.createSuccess(DateUtil.getLongTime() + "", "mock orderNo success"));defaultListableBeanFactory.registerSingleton(OrderServiceClient.class.getCanonicalName(), mockOrderApi); åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ OrderServiceClient å¯¹è±¡å¹¶æ‰‹åŠ¨æ³¨å†Œè¿›äº† Spring å®¹å™¨ä¸­ã€‚ ç¬¬ä¸€æ®µä»£ç ä½¿ç”¨çš„æ˜¯ PowerMockito.mock çš„ APIï¼Œä»–å¯ä»¥åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œè®©æ‰€æœ‰è°ƒç”¨ OrderServiceClient çš„æ–¹æ³•éƒ½ä¼šåšé»˜è®¤çš„è¿”å›ã€‚ 1BaseResponse.createSuccess(DateUtil.getLongTime() + "", "mock orderNo success")) æµ‹è¯•ä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬æ²¡æœ‰æ›¿æ¢æ—¶è°ƒç”¨åˆšæ‰é‚£ä¸ªæ¥å£å¹¶ä¸”æœ¬åœ°ä¹Ÿæ²¡æœ‰å¯åŠ¨ OrderServiceï¼š å› ä¸ºæ²¡æœ‰é…ç½® fallback æ‰€ä»¥ä¼šæŠ¥é”™ï¼Œè¡¨ç¤ºæ‰¾ä¸åˆ°è¿™ä¸ªæœåŠ¡ã€‚ æ›¿æ¢æ‰ bean æ—¶ï¼š å†æ¬¡è¯·æ±‚æ²¡æœ‰æŠ¥é”™ï¼Œå¹¶ä¸”è·å¾—äº†æˆ‘ä»¬é»˜è®¤çš„è¿”å›ã€‚ é€šè¿‡æ—¥å¿—ä¹Ÿä¼šå‘ç° OrderServiceClient æœ€åå·²ç»è¢« Mock ä»£ç†äº†ï¼Œå¹¶ä¸ä¼šå»è°ƒç”¨çœŸæ­£çš„æ–¹æ³•ã€‚ é…ç½®åŠ å¯†ä¸‹ä¸€ä¸ªåˆ™æ˜¯é…ç½®åŠ å¯†ï¼Œè¿™åº”è¯¥ç®—æ˜¯ä¸€ä¸ªåŸºæœ¬åŠŸèƒ½ã€‚ æ¯”å¦‚æˆ‘ä»¬é…ç½®æ–‡ä»¶ä¸­çš„ä¸€äº›è´¦å·å’Œå¯†ç ï¼Œéƒ½åº”è¯¥æ˜¯å¯†æ–‡ä¿å­˜çš„ã€‚ å› æ­¤è¿™æ¬¡ä½¿ç”¨äº†ä¸€ä¸ªå¼€æºç»„ä»¶æ¥å®ç°åŠ å¯†ä¸è§£å¯†ï¼Œå¹¶ä¸”å¯¹ SpringBoot éå¸¸å‹å¥½åªéœ€è¦å‡ æ®µä»£ç å³å¯å®Œæˆã€‚ é¦–å…ˆæ ¹æ®åŠ å¯†å¯†ç å°†éœ€è¦åŠ å¯†çš„é…ç½®åŠ å¯†ä¸ºå¯†æ–‡ã€‚ æ›¿æ¢åŸæœ¬æ˜æ–‡ä¿å­˜çš„é…ç½®ã€‚ å†ä½¿ç”¨æ—¶è¿›è¡Œè§£å¯†ã€‚ ä½¿ç”¨è¯¥åŒ…ä¹Ÿåªéœ€è¦å¼•å…¥ä¸€ä¸ªä¾èµ–å³å¯ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;com.github.ulisesbocchio&lt;/groupId&gt; &lt;artifactId&gt;jasypt-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.14&lt;/version&gt;&lt;/dependency&gt; åŒæ—¶å†™ä¸€ä¸ªå•æµ‹æ ¹æ®å¯†ç ç”Ÿæˆå¯†æ–‡ï¼Œå¯†ç ä¹Ÿå¯ä¿å­˜åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼š 1jasypt.encryptor.password=123456 æ¥ç€åœ¨å•æµ‹ä¸­ç”Ÿæˆå¯†æ–‡ã€‚ 1234567891011@Autowiredprivate StringEncryptor encryptor;@Testpublic void getPass() &#123; String name = encryptor.encrypt("userName"); String password = encryptor.encrypt("password"); System.out.println(name + "----------------"); System.out.println(password + "----------------");&#125; ä¹‹ååªéœ€è¦ä½¿ç”¨å¯†æ–‡å°±è¡Œã€‚ ç”±äºæˆ‘è¿™é‡Œæ˜¯å¯¹æ•°æ®åº“ç”¨æˆ·åå’Œå¯†ç åŠ å¯†ï¼Œæ‰€ä»¥è¿˜å¾—æœ‰ä¸€ä¸ªè§£å¯†çš„è¿‡ç¨‹ã€‚ åˆ©ç”¨ Spring Bean çš„ä¸€ä¸ªå¢å¼ºæ¥å£å³å¯å®ç°ï¼š 12345678910111213141516171819202122232425@Componentpublic class DataSourceProcess implements BeanPostProcessor &#123; @Autowired private StringEncryptor encryptor; @Override public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException &#123; return bean; &#125; @Override public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException &#123; if (bean instanceof DataSourceProperties)&#123; DataSourceProperties dataSourceProperties = (DataSourceProperties) bean; dataSourceProperties.setUsername(encryptor.decrypt(dataSourceProperties.getUsername())) ; dataSourceProperties.setPassword(encryptor.decrypt(dataSourceProperties.getPassword())); return dataSourceProperties ; &#125; return bean; &#125;&#125; è¿™æ ·å°±å¯ä»¥åœ¨çœŸæ­£ä½¿ç”¨æ—¶è¿˜åŸä¸ºæ˜æ–‡ã€‚ åŒæ—¶ä¹Ÿå¯ä»¥åœ¨å¯åŠ¨å‘½ä»¤ä¸­é…ç½®åˆšæ‰çš„å¯†ç ï¼š 1java -Djasypt.encryptor.password=password -jar target/jasypt-spring-boot-demo-0.0.1-SNAPSHOT.jar æ€»ç»“è¿™æ ·ä¸¤ä¸ªå°æŠ€å·§å°±è®²å®Œäº†ï¼Œå¤§å®¶æœ‰ SpringBoot çš„æ›´å¤šä½¿ç”¨æŠ€å·§æ¬¢è¿ç•™è¨€è®¨è®ºã€‚ ä¸Šæ–‡çš„ä¸€äº›å®ä¾‹ä»£ç å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼š https://github.com/crossoverJie/springboot-cloud æ¬¢è¿å…³æ³¨å…¬ä¼—å·ä¸€èµ·äº¤æµï¼š]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Mock</tag>
        <tag>åŠ å¯†</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»æºç åˆ†æå¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨ Kafka ç”Ÿäº§è€…]]></title>
    <url>%2F2018%2F10%2F11%2Fkafka%2Fkafka-product%2F</url>
    <content type="text"><![CDATA[å‰è¨€åœ¨ä¸Šæ–‡ è®¾è®¡ä¸€ä¸ªç™¾ä¸‡çº§çš„æ¶ˆæ¯æ¨é€ç³»ç»Ÿ ä¸­æåˆ°æ¶ˆæ¯æµè½¬é‡‡ç”¨çš„æ˜¯ Kafka ä½œä¸ºä¸­é—´ä»¶ã€‚ å…¶ä¸­æœ‰æœ‹å‹å’¨è¯¢åœ¨å¤§é‡æ¶ˆæ¯çš„æƒ…å†µä¸‹ Kakfa æ˜¯å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é«˜æ•ˆåŠä¸€è‡´æ€§å‘¢ï¼Ÿ æ­£å¥½ä»¥è¿™ä¸ªé—®é¢˜ç»“åˆ Kakfa çš„æºç è®¨è®ºä¸‹å¦‚ä½•æ­£ç¡®ã€é«˜æ•ˆçš„å‘é€æ¶ˆæ¯ã€‚ å†…å®¹è¾ƒå¤šï¼Œå¯¹æºç æ„Ÿå…´è¶£çš„æœ‹å‹è¯·ç³»å¥½å®‰å…¨å¸¦ğŸ˜(æºç åŸºäº v0.10.0.0 ç‰ˆæœ¬åˆ†æ)ã€‚åŒæ—¶æœ€å¥½æ˜¯æœ‰ä¸€å®šçš„ Kafka ä½¿ç”¨ç»éªŒï¼ŒçŸ¥æ™“åŸºæœ¬çš„ç”¨æ³•ã€‚ ç®€å•çš„æ¶ˆæ¯å‘é€åœ¨åˆ†æä¹‹å‰å…ˆçœ‹ä¸€ä¸ªç®€å•çš„æ¶ˆæ¯å‘é€æ˜¯æ€ä¹ˆæ ·çš„ã€‚ ä»¥ä¸‹ä»£ç åŸºäº SpringBoot æ„å»ºã€‚ é¦–å…ˆåˆ›å»ºä¸€ä¸ª org.apache.kafka.clients.producer.Producer çš„ beanã€‚ ä¸»è¦å…³æ³¨ bootstrap.serversï¼Œå®ƒæ˜¯å¿…å¡«å‚æ•°ã€‚æŒ‡çš„æ˜¯ Kafka é›†ç¾¤ä¸­çš„ broker åœ°å€ï¼Œä¾‹å¦‚ 127.0.0.1:9094ã€‚ å…¶ä½™å‡ ä¸ªå‚æ•°æš‚æ—¶ä¸åšè®¨è®ºï¼Œåæ–‡ä¼šæœ‰è¯¦ç»†ä»‹ç»ã€‚ æ¥ç€æ³¨å…¥è¿™ä¸ª bean å³å¯è°ƒç”¨å®ƒçš„å‘é€å‡½æ•°å‘é€æ¶ˆæ¯ã€‚ è¿™é‡Œæˆ‘ç»™æŸä¸€ä¸ª Topic å‘é€äº† 10W æ¡æ•°æ®ï¼Œè¿è¡Œç¨‹åºæ¶ˆæ¯æ­£å¸¸å‘é€ã€‚ ä½†è¿™ä»…ä»…åªæ˜¯åšåˆ°äº†æ¶ˆæ¯å‘é€ï¼Œå¯¹æ¶ˆæ¯æ˜¯å¦æˆåŠŸé€è¾¾å®Œå…¨æ²¡ç®¡ï¼Œç­‰äºæ˜¯çº¯å¼‚æ­¥çš„æ–¹å¼ã€‚ åŒæ­¥é‚£ä¹ˆæˆ‘æƒ³çŸ¥é“æ¶ˆæ¯åˆ°åº•å‘é€æˆåŠŸæ²¡æœ‰è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ å…¶å® Producer çš„ API å·²ç»å¸®æˆ‘ä»¬è€ƒè™‘åˆ°äº†ï¼Œå‘é€ä¹‹ååªéœ€è¦è°ƒç”¨å®ƒçš„ get() æ–¹æ³•å³å¯åŒæ­¥è·å–å‘é€ç»“æœã€‚ å‘é€ç»“æœï¼š è¿™æ ·çš„å‘é€æ•ˆç‡å…¶å®æ˜¯æ¯”è¾ƒä½ä¸‹çš„ï¼Œå› ä¸ºæ¯æ¬¡éƒ½éœ€è¦åŒæ­¥ç­‰å¾…æ¶ˆæ¯å‘é€çš„ç»“æœã€‚ å¼‚æ­¥ä¸ºæ­¤æˆ‘ä»¬åº”å½“é‡‡å–å¼‚æ­¥çš„æ–¹å¼å‘é€ï¼Œå…¶å® send() æ–¹æ³•é»˜è®¤åˆ™æ˜¯å¼‚æ­¥çš„ï¼Œåªè¦ä¸æ‰‹åŠ¨è°ƒç”¨ get() æ–¹æ³•ã€‚ ä½†è¿™æ ·å°±æ²¡æ³•è·çŸ¥å‘é€ç»“æœã€‚ æ‰€ä»¥æŸ¥çœ‹ send() çš„ API å¯ä»¥å‘ç°è¿˜æœ‰ä¸€ä¸ªå‚æ•°ã€‚ 1Future&lt;RecordMetadata&gt; send(ProducerRecord&lt;K, V&gt; producer, Callback callback); Callback æ˜¯ä¸€ä¸ªå›è°ƒæ¥å£ï¼Œåœ¨æ¶ˆæ¯å‘é€å®Œæˆä¹‹åå¯ä»¥å›è°ƒæˆ‘ä»¬è‡ªå®šä¹‰çš„å®ç°ã€‚ æ‰§è¡Œä¹‹åçš„ç»“æœï¼š åŒæ ·çš„ä¹Ÿèƒ½è·å–ç»“æœï¼ŒåŒæ—¶å‘ç°å›è°ƒçš„çº¿ç¨‹å¹¶ä¸æ˜¯ä¸Šæ–‡åŒæ­¥æ—¶çš„ä¸»çº¿ç¨‹ï¼Œè¿™æ ·ä¹Ÿèƒ½è¯æ˜æ˜¯å¼‚æ­¥å›è°ƒçš„ã€‚ åŒæ—¶å›è°ƒçš„æ—¶å€™ä¼šä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼š RecordMetadata å’Œä¸Šæ–‡ä¸€è‡´çš„æ¶ˆæ¯å‘é€æˆåŠŸåçš„å…ƒæ•°æ®ã€‚ Exception æ¶ˆæ¯å‘é€è¿‡ç¨‹ä¸­çš„å¼‚å¸¸ä¿¡æ¯ã€‚ ä½†æ˜¯è¿™ä¸¤ä¸ªå‚æ•°å¹¶ä¸ä¼šåŒæ—¶éƒ½æœ‰æ•°æ®ï¼Œåªæœ‰å‘é€å¤±è´¥æ‰ä¼šæœ‰å¼‚å¸¸ä¿¡æ¯ï¼ŒåŒæ—¶å‘é€å…ƒæ•°æ®ä¸ºç©ºã€‚ æ‰€ä»¥æ­£ç¡®çš„å†™æ³•åº”å½“æ˜¯ï¼š è‡³äºä¸ºä»€ä¹ˆä¼šåªæœ‰å‚æ•°ä¸€ä¸ªæœ‰å€¼ï¼Œåœ¨ä¸‹æ–‡çš„æºç åˆ†æä¸­ä¼šä¸€ä¸€è§£é‡Šã€‚ æºç åˆ†æç°åœ¨åªæŒæ¡äº†åŸºæœ¬çš„æ¶ˆæ¯å‘é€ï¼Œæƒ³è¦æ·±åˆ»çš„ç†è§£å‘é€ä¸­çš„ä¸€äº›å‚æ•°é…ç½®è¿˜æ˜¯å¾—æºç è¯´äº†ç®—ã€‚ é¦–å…ˆè¿˜æ˜¯æ¥è°ˆè°ˆæ¶ˆæ¯å‘é€æ—¶çš„æ•´ä¸ªæµç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼ŒKafka å¹¶ä¸æ˜¯ç®€å•çš„æŠŠæ¶ˆæ¯é€šè¿‡ç½‘ç»œå‘é€åˆ°äº† broker ä¸­ï¼Œåœ¨ Java å†…éƒ¨è¿˜æ˜¯ç»è¿‡äº†è®¸å¤šä¼˜åŒ–å’Œè®¾è®¡ã€‚ å‘é€æµç¨‹ä¸ºäº†ç›´è§‚çš„äº†è§£å‘é€çš„æµç¨‹ï¼Œç®€å•çš„ç”»äº†å‡ ä¸ªåœ¨å‘é€è¿‡ç¨‹ä¸­å…³é”®çš„æ­¥éª¤ã€‚ ä»ä¸Šè‡³ä¸‹ä¾æ¬¡æ˜¯ï¼š åˆå§‹åŒ–ä»¥åŠçœŸæ­£å‘é€æ¶ˆæ¯çš„ kafka-producer-network-thread IO çº¿ç¨‹ã€‚ å°†æ¶ˆæ¯åºåˆ—åŒ–ã€‚ å¾—åˆ°éœ€è¦å‘é€çš„åˆ†åŒºã€‚ å†™å…¥å†…éƒ¨çš„ä¸€ä¸ªç¼“å­˜åŒºä¸­ã€‚ åˆå§‹åŒ–çš„ IO çº¿ç¨‹ä¸æ–­çš„æ¶ˆè´¹è¿™ä¸ªç¼“å­˜æ¥å‘é€æ¶ˆæ¯ã€‚ æ­¥éª¤è§£ææ¥ä¸‹æ¥è¯¦è§£æ¯ä¸ªæ­¥éª¤ã€‚ åˆå§‹åŒ– è°ƒç”¨è¯¥æ„é€ æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–æ—¶ï¼Œä¸æ­¢æ˜¯ç®€å•çš„å°†åŸºæœ¬å‚æ•°å†™å…¥ KafkaProducerã€‚æ¯”è¾ƒéº»çƒ¦çš„æ˜¯åˆå§‹åŒ– Sender çº¿ç¨‹è¿›è¡Œç¼“å†²åŒºæ¶ˆè´¹ã€‚ åˆå§‹åŒ– IO çº¿ç¨‹å¤„ï¼š å¯ä»¥çœ‹åˆ° Sender çº¿ç¨‹æœ‰éœ€è¦æˆå‘˜å˜é‡ï¼Œæ¯”å¦‚ï¼š 1acks,retries,requestTimeout ç­‰ï¼Œè¿™äº›å‚æ•°ä¼šåœ¨åæ–‡åˆ†æã€‚ åºåˆ—åŒ–æ¶ˆæ¯åœ¨è°ƒç”¨ send() å‡½æ•°åå…¶å®ç¬¬ä¸€æ­¥å°±æ˜¯åºåˆ—åŒ–ï¼Œæ¯•ç«Ÿæˆ‘ä»¬çš„æ¶ˆæ¯éœ€è¦é€šè¿‡ç½‘ç»œæ‰èƒ½å‘é€åˆ° Kafkaã€‚ å…¶ä¸­çš„ valueSerializer.serialize(record.topic(), record.value()); æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åˆå§‹åŒ–æ—¶å€™æŒ‡å®šåºåˆ—åŒ–å®ç°ç±»ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å®ç°åºåˆ—åŒ–ï¼Œåªéœ€è¦å®ç° org.apache.kafka.common.serialization.Serializer æ¥å£å³å¯ã€‚ è·¯ç”±åˆ†åŒºæ¥ä¸‹æ¥å°±æ˜¯è·¯ç”±åˆ†åŒºï¼Œé€šå¸¸æˆ‘ä»¬ä½¿ç”¨çš„ Topic ä¸ºäº†å®ç°æ‰©å±•æ€§ä»¥åŠé«˜æ€§èƒ½éƒ½ä¼šåˆ›å»ºå¤šä¸ªåˆ†åŒºã€‚ å¦‚æœæ˜¯ä¸€ä¸ªåˆ†åŒºå¥½è¯´ï¼Œæ‰€æœ‰æ¶ˆæ¯éƒ½å¾€é‡Œé¢å†™å…¥å³å¯ã€‚ ä½†å¤šä¸ªåˆ†åŒºå°±ä¸å¯é¿å…éœ€è¦çŸ¥é“å†™å…¥å“ªä¸ªåˆ†åŒºã€‚ é€šå¸¸æœ‰ä¸‰ç§æ–¹å¼ã€‚ æŒ‡å®šåˆ†åŒºå¯ä»¥åœ¨æ„å»º ProducerRecord ä¸ºæ¯æ¡æ¶ˆæ¯æŒ‡å®šåˆ†åŒºã€‚ è¿™æ ·åœ¨è·¯ç”±æ—¶ä¼šåˆ¤æ–­æ˜¯å¦æœ‰æŒ‡å®šï¼Œæœ‰å°±ç›´æ¥ä½¿ç”¨è¯¥åˆ†åŒºã€‚ è¿™ç§ä¸€èˆ¬åœ¨ç‰¹æ®Šåœºæ™¯ä¸‹ä¼šä½¿ç”¨ã€‚ è‡ªå®šä¹‰è·¯ç”±ç­–ç•¥ å¦‚æœæ²¡æœ‰æŒ‡å®šåˆ†åŒºï¼Œåˆ™ä¼šè°ƒç”¨ partitioner.partition æ¥å£æ‰§è¡Œè‡ªå®šä¹‰åˆ†åŒºç­–ç•¥ã€‚ è€Œæˆ‘ä»¬ä¹Ÿåªéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªç±»å®ç° org.apache.kafka.clients.producer.Partitioner æ¥å£ï¼ŒåŒæ—¶åœ¨åˆ›å»º KafkaProducer å®ä¾‹æ—¶é…ç½® partitioner.class å‚æ•°ã€‚ é€šå¸¸éœ€è¦è‡ªå®šä¹‰åˆ†åŒºä¸€èˆ¬æ˜¯åœ¨æƒ³å°½é‡çš„ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ã€‚ æˆ–è€…æ˜¯å†™å…¥æŸäº›ç‰¹æœ‰çš„åˆ†åŒºï¼Œç”±ç‰¹åˆ«çš„æ¶ˆè´¹è€…æ¥è¿›è¡Œå¤„ç†ç­‰ã€‚ é»˜è®¤ç­–ç•¥æœ€åä¸€ç§åˆ™æ˜¯é»˜è®¤çš„è·¯ç”±ç­–ç•¥ï¼Œå¦‚æœæˆ‘ä»¬å•¥éƒ½æ²¡åšå°±ä¼šæ‰§è¡Œè¯¥ç­–ç•¥ã€‚ è¯¥ç­–ç•¥ä¹Ÿä¼šä½¿å¾—æ¶ˆæ¯åˆ†é…çš„æ¯”è¾ƒå‡åŒ€ã€‚ æ¥çœ‹çœ‹å®ƒçš„å®ç°ï¼š ç®€å•çš„æ¥è¯´åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š è·å– Topic åˆ†åŒºæ•°ã€‚ å°†å†…éƒ¨ç»´æŠ¤çš„ä¸€ä¸ªçº¿ç¨‹å®‰å…¨è®¡æ•°å™¨ +1ã€‚ ä¸åˆ†åŒºæ•°å–æ¨¡å¾—åˆ°åˆ†åŒºç¼–å·ã€‚ å…¶å®è¿™å°±æ˜¯å¾ˆå…¸å‹çš„è½®è¯¢ç®—æ³•ï¼Œæ‰€ä»¥åªè¦åˆ†åŒºæ•°ä¸é¢‘ç¹å˜åŠ¨è¿™ç§æ–¹å¼ä¹Ÿä¼šæ¯”è¾ƒå‡åŒ€ã€‚ å†™å…¥å†…éƒ¨ç¼“å­˜åœ¨ send() æ–¹æ³•æ‹¿åˆ°åˆ†åŒºåä¼šè°ƒç”¨ä¸€ä¸ª append() å‡½æ•°ï¼š è¯¥å‡½æ•°ä¸­ä¼šè°ƒç”¨ä¸€ä¸ª getOrCreateDeque() å†™å…¥åˆ°ä¸€ä¸ªå†…éƒ¨ç¼“å­˜ä¸­ batchesã€‚ æ¶ˆè´¹ç¼“å­˜åœ¨æœ€å¼€å§‹åˆå§‹åŒ–çš„ IO çº¿ç¨‹å…¶å®æ˜¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œå®ƒä¼šä¸€ç›´æ¶ˆè´¹è¿™äº›æ•°æ®ã€‚ é€šè¿‡å›¾ä¸­çš„å‡ ä¸ªå‡½æ•°ä¼šè·å–åˆ°ä¹‹å‰å†™å…¥çš„æ•°æ®ã€‚è¿™å—å†…å®¹å¯ä»¥ä¸å¿…æ·±ç©¶ï¼Œä½†å…¶ä¸­æœ‰ä¸ª completeBatch æ–¹æ³•å´éå¸¸å…³é”®ã€‚ è°ƒç”¨è¯¥æ–¹æ³•æ—¶å€™è‚¯å®šå·²ç»æ˜¯æ¶ˆæ¯å‘é€å®Œæ¯•äº†ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨ batch.done() æ¥å®Œæˆä¹‹å‰æˆ‘ä»¬åœ¨ send() æ–¹æ³•ä¸­å®šä¹‰çš„å›è°ƒæ¥å£ã€‚ ä»è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºä¸ºä»€ä¹ˆä¹‹å‰è¯´å‘é€å®Œæˆåå…ƒæ•°æ®å’Œå¼‚å¸¸ä¿¡æ¯åªä¼šå‡ºç°ä¸€ä¸ªã€‚ Producer å‚æ•°è§£æå‘é€æµç¨‹è®²å®Œäº†å†æ¥çœ‹çœ‹ Producer ä¸­æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªå‚æ•°ã€‚ acksacks æ˜¯ä¸€ä¸ªå½±å“æ¶ˆæ¯ååé‡çš„ä¸€ä¸ªå…³é”®å‚æ•°ã€‚ ä¸»è¦æœ‰ [allã€-1, 0, 1] è¿™å‡ ä¸ªé€‰é¡¹ï¼Œé»˜è®¤ä¸º 1ã€‚ ç”±äº Kafka ä¸æ˜¯é‡‡å–çš„ä¸»å¤‡æ¨¡å¼ï¼Œè€Œæ˜¯é‡‡ç”¨ç±»ä¼¼äº Zookeeper çš„ä¸»å¤‡æ¨¡å¼ã€‚ å‰ææ˜¯ Topic é…ç½®å‰¯æœ¬æ•°é‡ replica &gt; 1ã€‚ å½“ acks = all/-1 æ—¶ï¼š æ„å‘³ç€ä¼šç¡®ä¿æ‰€æœ‰çš„ follower å‰¯æœ¬éƒ½å®Œæˆæ•°æ®çš„å†™å…¥æ‰ä¼šè¿”å›ã€‚ è¿™æ ·å¯ä»¥ä¿è¯æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼ ä½†åŒæ—¶æ€§èƒ½å’Œååé‡å´æ˜¯æœ€ä½çš„ã€‚ å½“ acks = 0 æ—¶ï¼š producer ä¸ä¼šç­‰å¾…å‰¯æœ¬çš„ä»»ä½•å“åº”ï¼Œè¿™æ ·æœ€å®¹æ˜“ä¸¢å¤±æ¶ˆæ¯ä½†åŒæ—¶æ€§èƒ½å´æ˜¯æœ€å¥½çš„ï¼ å½“ acks = 1 æ—¶ï¼š è¿™æ˜¯ä¸€ç§æŠ˜ä¸­çš„æ–¹æ¡ˆï¼Œå®ƒä¼šç­‰å¾…å‰¯æœ¬ Leader å“åº”ï¼Œä½†ä¸ä¼šç­‰åˆ° follower çš„å“åº”ã€‚ ä¸€æ—¦ Leader æŒ‚æ‰æ¶ˆæ¯å°±ä¼šä¸¢å¤±ã€‚ä½†æ€§èƒ½å’Œæ¶ˆæ¯å®‰å…¨æ€§éƒ½å¾—åˆ°äº†ä¸€å®šçš„ä¿è¯ã€‚ batch.sizeè¿™ä¸ªå‚æ•°çœ‹åç§°å°±çŸ¥é“æ˜¯å†…éƒ¨ç¼“å­˜åŒºçš„å¤§å°é™åˆ¶ï¼Œå¯¹ä»–é€‚å½“çš„è°ƒå¤§å¯ä»¥æé«˜ååé‡ã€‚ ä½†ä¹Ÿä¸èƒ½æç«¯ï¼Œè°ƒå¤ªå¤§ä¼šæµªè´¹å†…å­˜ã€‚å°äº†ä¹Ÿå‘æŒ¥ä¸äº†ä½œç”¨ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå…¸å‹çš„æ—¶é—´å’Œç©ºé—´çš„æƒè¡¡ã€‚ ä¸Šå›¾æ˜¯å‡ ä¸ªä½¿ç”¨çš„ä½“ç°ã€‚ retriesretries è¯¥å‚æ•°ä¸»è¦æ˜¯æ¥åšé‡è¯•ä½¿ç”¨ï¼Œå½“å‘ç”Ÿä¸€äº›ç½‘ç»œæŠ–åŠ¨éƒ½ä¼šé€ æˆé‡è¯•ã€‚ è¿™ä¸ªå‚æ•°ä¹Ÿå°±æ˜¯é™åˆ¶é‡è¯•æ¬¡æ•°ã€‚ ä½†ä¹Ÿæœ‰ä¸€äº›å…¶ä»–é—®é¢˜ã€‚ å› ä¸ºæ˜¯é‡å‘æ‰€ä»¥æ¶ˆæ¯é¡ºåºå¯èƒ½ä¸ä¼šä¸€è‡´ï¼Œè¿™ä¹Ÿæ˜¯ä¸Šæ–‡æåˆ°å°±ç®—æ˜¯ä¸€ä¸ªåˆ†åŒºæ¶ˆæ¯ä¹Ÿä¸ä¼šæ˜¯å®Œå…¨é¡ºåºçš„æƒ…å†µã€‚ è¿˜æ˜¯ç”±äºç½‘ç»œé—®é¢˜ï¼Œæœ¬æ¥æ¶ˆæ¯å·²ç»æˆåŠŸå†™å…¥äº†ä½†æ˜¯æ²¡æœ‰æˆåŠŸå“åº”ç»™ producerï¼Œè¿›è¡Œé‡è¯•æ—¶å°±å¯èƒ½ä¼šå‡ºç°æ¶ˆæ¯é‡å¤ã€‚è¿™ç§åªèƒ½æ˜¯æ¶ˆè´¹è€…è¿›è¡Œå¹‚ç­‰å¤„ç†ã€‚ é«˜æ•ˆçš„å‘é€æ–¹å¼å¦‚æœæ¶ˆæ¯é‡çœŸçš„éå¸¸å¤§ï¼ŒåŒæ—¶åˆéœ€è¦å°½å¿«çš„å°†æ¶ˆæ¯å‘é€åˆ° Kafkaã€‚ä¸€ä¸ª producer å§‹ç»ˆä¼šæ”¶åˆ°ç¼“å­˜å¤§å°ç­‰å½±å“ã€‚ é‚£æ˜¯å¦å¯ä»¥åˆ›å»ºå¤šä¸ª producer æ¥è¿›è¡Œå‘é€å‘¢ï¼Ÿ é…ç½®ä¸€ä¸ªæœ€å¤§ producer ä¸ªæ•°ã€‚ å‘é€æ¶ˆæ¯æ—¶é¦–å…ˆè·å–ä¸€ä¸ª producerï¼Œè·å–çš„åŒæ—¶åˆ¤æ–­æ˜¯å¦è¾¾åˆ°æœ€å¤§ä¸Šé™ï¼Œæ²¡æœ‰å°±æ–°å»ºä¸€ä¸ªåŒæ—¶ä¿å­˜åˆ°å†…éƒ¨çš„ List ä¸­ï¼Œä¿å­˜æ—¶åšå¥½åŒæ­¥å¤„ç†é˜²æ­¢å¹¶å‘é—®é¢˜ã€‚ è·å–å‘é€è€…æ—¶å¯ä»¥æŒ‰ç…§é»˜è®¤çš„åˆ†åŒºç­–ç•¥ä½¿ç”¨è½®è¯¢çš„æ–¹å¼è·å–ï¼ˆä¿è¯ä½¿ç”¨å‡åŒ€ï¼‰ã€‚ è¿™æ ·åœ¨å¤§é‡ã€é¢‘ç¹çš„æ¶ˆæ¯å‘é€åœºæ™¯ä¸­å¯ä»¥æé«˜å‘é€æ•ˆç‡å‡è½»å•ä¸ª producer çš„å‹åŠ›ã€‚ å…³é—­ Produceræœ€ååˆ™æ˜¯ Producer çš„å…³é—­ï¼ŒProducer åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æ¶ˆè€—äº†ä¸å°‘èµ„æºï¼ˆçº¿ç¨‹ã€å†…å­˜ã€ç½‘ç»œç­‰ï¼‰å› æ­¤éœ€è¦æ˜¾å¼çš„å…³é—­ä»è€Œå›æ”¶è¿™äº›èµ„æºã€‚ é»˜è®¤çš„ close() æ–¹æ³•å’Œå¸¦æœ‰è¶…æ—¶æ—¶é—´çš„æ–¹æ³•éƒ½æ˜¯åœ¨ä¸€å®šçš„æ—¶é—´åå¼ºåˆ¶å…³é—­ã€‚ ä½†åœ¨è¿‡æœŸä¹‹å‰éƒ½ä¼šå¤„ç†å®Œå‰©ä½™çš„ä»»åŠ¡ã€‚ æ‰€ä»¥ä½¿ç”¨å“ªä¸€ä¸ªå¾—è§†æƒ…å†µè€Œå®šã€‚ æ€»ç»“æœ¬æ–‡å†…å®¹è¾ƒå¤šï¼Œä»å®ä¾‹å’Œæºç çš„è§’åº¦åˆ†æäº† Kafka ç”Ÿäº§è€…ã€‚ å¸Œæœ›çœ‹å®Œçš„æœ‹å‹èƒ½æœ‰æ”¶è·ï¼ŒåŒæ—¶ä¹Ÿæ¬¢è¿ç•™è¨€è®¨è®ºã€‚ ä¸å‡ºæ„å¤–ä¸‹æœŸä¼šè®¨è®º Kafka æ¶ˆè´¹è€…ã€‚ å¦‚æœå¯¹ä½ æœ‰å¸®åŠ©è¿˜è¯·åˆ†äº«è®©æ›´å¤šçš„äººçœ‹åˆ°ã€‚ æ¬¢è¿å…³æ³¨å…¬ä¼—å·ä¸€èµ·äº¤æµï¼š]]></content>
      <categories>
        <category>Kafka</category>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Kafka</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€Œé€ ä¸ªè½®å­ã€â€”â€”cicada è®¾è®¡å…¨å±€ä¸Šä¸‹æ–‡]]></title>
    <url>%2F2018%2F10%2F09%2Fwheel%2Fcicada4%2F</url>
    <content type="text"><![CDATA[å‰è¨€æœ¬æ¬¡ Cicada å·²ç»æ›´æ–°åˆ°äº† v1.0.3ã€‚ ä¸»è¦æ˜¯è§£å†³äº†ä¸¤ä¸ª issueï¼Œ#9 #8ã€‚ æ‰€ä»¥æœ¬æ¬¡çš„ä¸»è¦æ›´æ–°ä¸ºï¼š Cicada é‡‡ç”¨åˆç†çš„çº¿ç¨‹åˆ†é…æ¥å¤„ç†æ¥å…¥è¯·æ±‚çº¿ç¨‹ä»¥åŠ IO çº¿ç¨‹ã€‚ æ”¯æŒå¤šç§å“åº”æ–¹å¼ï¼ˆä»¥å‰åªæœ‰ jsonï¼Œç°åœ¨æ”¯æŒ textï¼‰ã€‚ ä¸ºäº†æ»¡è¶³ä¸Šè€…å¼•å…¥äº† contextã€‚ ä¼˜é›…åœæœºã€‚ å…¶ä¸­æˆ‘è§‰å¾—æœ€æ ¸å¿ƒä¹Ÿæœ€æœ‰ç”¨çš„å°±æ˜¯è¿™ä¸ª Contextï¼Œå¹¶ä¸ºæ­¤é‡æ„äº†å¤§éƒ¨åˆ†ä»£ç ã€‚ å¤šç§å“åº”æ–¹å¼åœ¨èµ·åˆ Cicada é»˜è®¤åªèƒ½å“åº” jsonï¼Œè¿™ä¸€ç‚¹ç¡®å®ä¸å¤Ÿçµæ´»ã€‚åŠ ä¸Šåç»­ä¹Ÿæ‰“ç®—æ”¯æŒæ¨¡æ¿è§£æï¼Œæ‰€ä»¥ä¸å¦‚ç›´æ¥åœ¨ API ä¸­åŠ å…¥å¯è®©ç”¨æˆ·è‡ªè¡Œé€‰æ‹©ä¸åŒçš„å“åº”æ–¹å¼ã€‚ å› æ­¤è°ƒæ•´åçš„ API å¦‚ä¸‹ã€‚ æƒ³è¦è¾“å‡º text/plain æ—¶ã€‚ 123456789@CicadaAction("textAction")public class TextAction implements WorkAction &#123; @Override public void execute(CicadaContext context, Param param) throws Exception &#123; String url = context.request().getUrl(); String method = context.request().getMethod(); context.text("hello world url=" + url + " method=" + method); &#125;&#125; è€Œå“åº”è¾“å‡º application/json æ—¶åªéœ€è¦æŠŠéœ€è¦å“åº”çš„å¯¹è±¡å†™å…¥åˆ° json() æ–¹æ³•ä¸­. å› æ­¤åŸæœ‰çš„ä¸šåŠ¡ action ä¸­ä¹ŸåŠ å…¥äº†ä¸€ä¸ªä¸Šä¸‹æ–‡çš„å‚æ•°ï¼š 1234567/** * abstract execute method * @param context current context * @param param request params * @throws Exception throw exception */void execute(CicadaContext context ,Param param) throws Exception; ä¸‹é¢å°±æ¥çœ‹çœ‹è¿™ä¸ª Context æ˜¯å¦‚ä½•å®Œæˆçš„ã€‚ Cicada Contextå…ˆçœ‹çœ‹æœ‰äº†è¿™ä¸ªä¸Šä¸‹æ–‡ä¹‹åå¯ä»¥åšä»€ä¹ˆã€‚ æ¯”å¦‚æœ‰äº›åœºæ™¯ä¸‹æˆ‘ä»¬éœ€è¦æ‹¿åˆ°æœ¬æ¬¡è¯·æ±‚ä¸­çš„å¤´ä¿¡æ¯ï¼Œè¿™æ—¶å°±å¯ä»¥é€šè¿‡è¿™ä¸ª Context å¯¹è±¡ç›´æ¥è·å–ã€‚ å½“ç„¶ä¸æ­¢æ˜¯å¤´ä¿¡æ¯ï¼š è·å–è¯·æ±‚å¤´ã€‚ è®¾ç½®å“åº”å¤´ã€‚ è®¾ç½® cookieã€‚ è·å–è¯·æ±‚ URLã€‚ è·å–è¯·æ±‚çš„ methodï¼ˆget/postï¼‰ç­‰ã€‚ å…¶å®é€šè¿‡è¿™äº›ç‰¹ç‚¹å¯ä»¥çœ‹å‡ºè¿™äº›ä¿¡æ¯å…¶å®éƒ½å’Œä¸€æ¬¡ è¯·æ±‚ã€å“åº” å¯†åˆ‡ç›¸å…³ï¼Œå¹¶ä¸”å„ä¸ªè¯·æ±‚ä¹‹é—´çš„ä¿¡æ¯åº”äº’ä¸å½±å“ã€‚ è¿™æ ·çš„ç‰¹æ€§æ˜¯ä¸æ˜¯éå¸¸ç†Ÿæ‚‰ï¼Œæ²¡é”™é‚£å°±æ˜¯ ThreadLocalï¼Œå®ƒå¯ä»¥å°†æ¯ä¸ªçº¿ç¨‹çš„ä¿¡æ¯å­˜å‚¨èµ·æ¥äº’ä¸å½±å“ã€‚ ThreadLocal çš„åŸç†æœ¬æ¬¡ä¸åšè¿‡å¤šåˆ†æï¼Œåªè°ˆå®ƒåœ¨ Cicada ä¸­çš„åº”ç”¨ã€‚ CicadaContext.classå…ˆæ¥çœ‹çœ‹ CicadaContext è¿™ä¸ªç±»çš„ä¸»è¦æˆå‘˜å˜é‡ä»¥åŠæ–¹æ³•ã€‚ æˆå‘˜å˜é‡æ˜¯ä¸¤ä¸ªæ¥å£ CicadaRequestã€CicadaResponseï¼Œåç§°å°±èƒ½çœ‹å‡ºè‚¯å®šæ˜¯å­˜æ”¾è¯·æ±‚å’Œå“åº”æ•°æ®çš„ã€‚ HttpDispatcher.classæƒ³è¦å­˜æ”¾æœ¬æ¬¡è¯·æ±‚çš„ä¸Šä¸‹æ–‡è‡ªç„¶æ˜¯åœ¨çœŸæ­£è¯·æ±‚åˆ†å‘çš„åœ°æ–¹ HttpDispatcherã€‚ è¿™é‡Œæ”¹çš„è¾ƒå¤§çš„å°±æ˜¯ä¸¤ä¸ªçº¢æ¡†å¤„ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯åšä¸Šä¸‹æ–‡åˆå§‹åŒ–åŠèµ‹å€¼ã€‚ ç¬¬äºŒéƒ¨åˆ†è‡ªç„¶å°±æ˜¯å¸è½½ä¸Šä¸‹æ–‡ã€‚ å…ˆçœ‹åˆå§‹åŒ–ã€‚ CicadaRequest cicadaRequest = CicadaHttpRequest.init(defaultHttpRequest) ; é¦–å…ˆæ˜¯å°† request åˆå§‹åŒ–ï¼š CicadaHttpRequest è‡ªç„¶æ˜¯å®ç°äº† CicadaRequest æ¥å£ï¼š è¿™é‡Œåªä¿å­˜äº†è¯·æ±‚çš„ URLã€method ç­‰ä¿¡æ¯ï¼Œåç»­è¦åŠ çš„è¯·æ±‚å¤´ä¹Ÿå­˜æ”¾åœ¨æ­¤å¤„å³å¯ã€‚ Response ä¹Ÿæ˜¯åŒç†çš„ã€‚ è¿™ä¸¤ä¸ªå…·ä½“çš„å®ç°ç±»éƒ½ç§æœ‰åŒ–äº†æ„é€ å‡½æ•°ï¼Œé˜²æ­¢å¤–éƒ¨ç ´åäº†æ•´ä½“æ€§ã€‚ æ¥ç€å°†å½“å‰è¯·æ±‚çš„ä¸Šä¸‹æ–‡ä¿å­˜åˆ°äº† CicadaContext ä¸­ã€‚ 1CicadaContext.setContext(new CicadaContext(cicadaRequest,cicadaResponse)); è€Œè¿™ä¸ªå‡½æ•°æœ¬è´¨ä½¿ç”¨çš„åˆ™æ˜¯ ThreadLocal æ¥å­˜æ”¾ CicadaContextã€‚ 12345678910111213public static void setContext(CicadaContext context)&#123; ThreadLocalHolder.setCicadaContext(context) ;&#125;private static final ThreadLocal&lt;CicadaContext&gt; CICADA_CONTEXT= new ThreadLocal() ;/** * set cicada context * @param context current context */public static void setCicadaContext(CicadaContext context)&#123; CICADA_CONTEXT.set(context) ;&#125; å¤„ç†ä¸šåŠ¡åŠå“åº”æ¥ç€å°±æ˜¯å¤„ç†ä¸šåŠ¡ï¼Œè°ƒç”¨ä¸åŒçš„ API åšä¸åŒå“åº”ã€‚ æ‹¿ context.text() æ¥è¯´ï¼š å…¶å®å°±æ˜¯è®¾ç½®äº†å¯¹åº”çš„å“åº”æ–¹å¼ã€ä»¥åŠæŠŠå“åº”å†…å®¹å†™å…¥äº† CicadaResponse çš„ httpContent ä¸­ã€‚ ä¸šåŠ¡å¤„ç†å®Œåè°ƒç”¨ responseContent() è¿›è¡Œå“åº”ï¼š 1responseContent(ctx,CicadaContext.getResponse().getHttpContent()); å…¶å®å°±æ˜¯åœ¨ä¸Šä¸‹æ–‡ä¸­æ‹¿åˆ°çš„å“åº”æ–¹å¼åŠå“åº”å†…å®¹è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ å¸è½½ä¸Šä¸‹æ–‡æœ€åæœ‰ç‚¹éå¸¸é‡è¦ï¼Œé‚£å°±æ˜¯ å¸è½½ä¸Šä¸‹æ–‡ã€‚ å¦‚æœè¿™é‡Œä¸åšå¤„ç†ï¼Œä¹‹åéšç€è¯·æ±‚çš„å¢å¤šï¼ŒThreadLocal é‡Œå­˜æ”¾çš„æ•°æ®ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œæœ€ç»ˆè‚¯å®šä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚ æ‰€ä»¥ CicadaContext.removeContext() å°±æ˜¯ä¸ºäº†åŠæ—¶åˆ é™¤å½“å‰ä¸Šä¸‹æ–‡ã€‚ ä¼˜é›…åœæœºæœ€åè¿˜æ–°å¢äº†ä¸€ä¸ªåœæœºçš„æ–¹æ³•ã€‚ å…¶å®ä¹Ÿå°±æ˜¯åˆ©ç”¨ Hook å‡½æ•°å®ç°çš„ã€‚ ç”±äºç›®å‰ Cicada å¼€çš„çº¿ç¨‹ï¼Œå ç”¨çš„èµ„æºéƒ½ä¸æ˜¯ç‰¹åˆ«å¤šï¼Œæ‰€ä»¥åªæ˜¯å…³é—­äº† Netty æ‰€ä½¿ç”¨çš„çº¿ç¨‹ã€‚ å¦‚æœåç»­æ–°å¢äº†è‡ªèº«çš„çº¿ç¨‹ç­‰èµ„æºï¼Œé‚£ä¹Ÿå¯ä»¥å…¨éƒ¨æ”¾åˆ°è¿™é‡Œæ¥è¿›è¡Œé‡Šæ”¾ã€‚ æ€»ç»“Cicada å·²ç»æ›´æ–°äº† 4 ä¸ªç‰ˆæœ¬ï¼Œé›å½¢éƒ½æœ‰äº†ã€‚ åç»­ä¼šé‡ç‚¹å®ç°æ¨¡æ¿è§£æå’Œæ³¨è§£è¯·æ±‚è·¯ç”±å®Œæˆï¼ŒæŠŠ MVC ä¸­çš„ view å®Œæˆå°±å·®ä¸å¤šäº†ã€‚ è¿˜æ²¡æœ‰äº†è§£çš„æœ‹å‹å¯ä»¥ç‚¹å‡»ä¸‹é¢é“¾æ¥è¿›å…¥ä¸»é¡µäº†è§£ä¸‹ğŸ˜‹ã€‚ https://github.com/TogetherOS/cicada]]></content>
      <categories>
        <category>cicada</category>
        <category>è½®å­</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>HTTP</tag>
        <tag>Netty</tag>
        <tag>ThreadLocal</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡ä¸€ä¸ªç™¾ä¸‡çº§çš„æ¶ˆæ¯æ¨é€ç³»ç»Ÿ]]></title>
    <url>%2F2018%2F09%2F25%2Fnetty%2Fmillion-sms-push%2F</url>
    <content type="text"><![CDATA[å‰è¨€é¦–å…ˆè¿Ÿåˆ°çš„ç¥å¤§å®¶ä¸­ç§‹å¿«ä¹ã€‚ æœ€è¿‘ä¸€å‘¨å¤šæ²¡æœ‰æ›´æ–°äº†ã€‚å…¶å®æˆ‘ä¸€ç›´æƒ³æ†‹ä¸€ä¸ªå¤§æ‹›ï¼Œåˆ†äº«ä¸€äº›å¤§å®¶æ„Ÿå…´è¶£çš„å¹²è´§ã€‚ é‰´äºæœ€è¿‘æˆ‘ä¸ªäººçš„å·¥ä½œå†…å®¹ï¼Œäºæ˜¯åˆ©ç”¨è¿™ä¸‰å¤©å°é•¿å‡æ†‹äº†ä¸€ä¸ªå‡ºæ¥ï¼ˆå…¶å®æ˜¯ç©äº†ä¸¤å¤©ğŸ¤£ï¼‰ã€‚ å…ˆç®€å•è¯´ä¸‹æœ¬æ¬¡çš„ä¸»é¢˜ï¼Œç”±äºæˆ‘æœ€è¿‘åšçš„æ˜¯ç‰©è”ç½‘ç›¸å…³çš„å¼€å‘å·¥ä½œï¼Œå…¶ä¸­å°±ä¸å…ä¼šé‡åˆ°å’Œè®¾å¤‡çš„äº¤äº’ã€‚ æœ€ä¸»è¦çš„å·¥ä½œå°±æ˜¯è¦æœ‰ä¸€ä¸ªç³»ç»Ÿæ¥æ”¯æŒè®¾å¤‡çš„æ¥å…¥ã€å‘è®¾å¤‡æ¨é€æ¶ˆæ¯ï¼›åŒæ—¶è¿˜å¾—æ»¡è¶³å¤§é‡è®¾å¤‡æ¥å…¥çš„éœ€æ±‚ã€‚ æ‰€ä»¥æœ¬æ¬¡åˆ†äº«çš„å†…å®¹ä¸ä½†å¯ä»¥æ»¡è¶³ç‰©è”ç½‘é¢†åŸŸåŒæ—¶è¿˜æ”¯æŒä»¥ä¸‹åœºæ™¯ï¼š åŸºäº WEB çš„èŠå¤©ç³»ç»Ÿï¼ˆç‚¹å¯¹ç‚¹ã€ç¾¤èŠï¼‰ã€‚ WEB åº”ç”¨ä¸­éœ€æ±‚æœåŠ¡ç«¯æ¨é€çš„åœºæ™¯ã€‚ åŸºäº SDK çš„æ¶ˆæ¯æ¨é€å¹³å°ã€‚ æŠ€æœ¯é€‰å‹è¦æ»¡è¶³å¤§é‡çš„è¿æ¥æ•°ã€åŒæ—¶æ”¯æŒåŒå…¨å·¥é€šä¿¡ï¼Œå¹¶ä¸”æ€§èƒ½ä¹Ÿå¾—æœ‰ä¿éšœã€‚ åœ¨ Java æŠ€æœ¯æ ˆä¸­è¿›è¡Œé€‰å‹é¦–å…ˆè‡ªç„¶æ˜¯æ’é™¤æ‰äº†ä¼ ç»Ÿ IOã€‚ é‚£å°±åªæœ‰é€‰ NIO äº†ï¼Œåœ¨è¿™ä¸ªå±‚é¢å…¶å®é€‰æ‹©ä¹Ÿä¸å¤šï¼Œè€ƒè™‘åˆ°ç¤¾åŒºã€èµ„æ–™ç»´æŠ¤ç­‰æ–¹é¢æœ€ç»ˆé€‰æ‹©äº† Nettyã€‚ æœ€ç»ˆçš„æ¶æ„å›¾å¦‚ä¸‹ï¼š ç°åœ¨çœ‹ç€è’™æ²¡å…³ç³»ï¼Œä¸‹æ–‡ä¸€ä¸€ä»‹ç»ã€‚ åè®®è§£ææ—¢ç„¶æ˜¯ä¸€ä¸ªæ¶ˆæ¯ç³»ç»Ÿï¼Œé‚£è‡ªç„¶å¾—å’Œå®¢æˆ·ç«¯å®šä¹‰å¥½åŒæ–¹çš„åè®®æ ¼å¼ã€‚ å¸¸è§å’Œç®€å•çš„æ˜¯ HTTP åè®®ï¼Œä½†æˆ‘ä»¬çš„éœ€æ±‚ä¸­æœ‰ä¸€é¡¹éœ€è¦æ˜¯åŒå…¨å·¥çš„äº¤äº’æ–¹å¼ï¼ŒåŒæ—¶ HTTP æ›´å¤šçš„æ˜¯æœåŠ¡äºæµè§ˆå™¨ã€‚æˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ªæ›´åŠ ç²¾ç®€çš„åè®®ï¼Œå‡å°‘è®¸å¤šä¸å¿…è¦çš„æ•°æ®ä¼ è¾“ã€‚ å› æ­¤æˆ‘è§‰å¾—æœ€å¥½æ˜¯åœ¨æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹å®šåˆ¶è‡ªå·±çš„ç§æœ‰åè®®ï¼Œåœ¨æˆ‘è¿™ä¸ªåœºæ™¯ä¸‹å…¶å®æœ‰æ ‡å‡†çš„ç‰©è”ç½‘åè®®ã€‚ å¦‚æœæ˜¯å…¶ä»–åœºæ™¯å¯ä»¥å€Ÿé‰´ç°åœ¨æµè¡Œçš„ RPC æ¡†æ¶å®šåˆ¶ç§æœ‰åè®®ï¼Œä½¿å¾—åŒæ–¹é€šä¿¡æ›´åŠ é«˜æ•ˆã€‚ ä¸è¿‡æ ¹æ®è¿™æ®µæ—¶é—´çš„ç»éªŒæ¥çœ‹ï¼Œä¸ç®¡æ˜¯å“ªç§æ–¹å¼éƒ½å¾—åœ¨åè®®ä¸­é¢„ç•™å®‰å…¨ç›¸å…³çš„ä½ç½®ã€‚ åè®®ç›¸å…³çš„å†…å®¹å°±ä¸è¿‡è®¨è®ºäº†ï¼Œæ›´å¤šä»‹ç»å…·ä½“çš„åº”ç”¨ã€‚ ç®€å•å®ç°é¦–å…ˆè€ƒè™‘å¦‚ä½•å®ç°åŠŸèƒ½ï¼Œå†æ¥æ€è€ƒç™¾ä¸‡è¿æ¥çš„æƒ…å†µã€‚ æ³¨å†Œé‰´æƒåœ¨åšçœŸæ­£çš„æ¶ˆæ¯ä¸Šã€ä¸‹è¡Œä¹‹å‰é¦–å…ˆè¦è€ƒè™‘çš„å°±æ˜¯é‰´æƒé—®é¢˜ã€‚ å°±åƒä½ ä½¿ç”¨å¾®ä¿¡ä¸€æ ·ï¼Œç¬¬ä¸€æ­¥æ€ä¹ˆä¹Ÿå¾—æ˜¯ç™»å½•å§ï¼Œä¸èƒ½æ— è®ºæ˜¯è°éƒ½å¯ä»¥ç›´æ¥è¿æ¥åˆ°å¹³å°ã€‚ æ‰€ä»¥ç¬¬ä¸€æ­¥å¾—æ˜¯æ³¨å†Œæ‰è¡Œã€‚ å¦‚ä¸Šé¢æ¶æ„å›¾ä¸­çš„ æ³¨å†Œ/é‰´æƒ æ¨¡å—ã€‚é€šå¸¸æ¥è¯´éƒ½éœ€è¦å®¢æˆ·ç«¯é€šè¿‡ HTTP è¯·æ±‚ä¼ é€’ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ï¼Œåå°é‰´æƒé€šè¿‡ä¹‹åä¼šå“åº”ä¸€ä¸ª tokenï¼Œå¹¶å°†è¿™ä¸ª token å’Œå®¢æˆ·ç«¯çš„å…³ç³»ç»´æŠ¤åˆ° Redis æˆ–è€…æ˜¯ DB ä¸­ã€‚ å®¢æˆ·ç«¯å°†è¿™ä¸ª token ä¹Ÿä¿å­˜åˆ°æœ¬åœ°ï¼Œä»Šåçš„æ¯ä¸€æ¬¡è¯·æ±‚éƒ½å¾—å¸¦ä¸Šè¿™ä¸ª tokenã€‚ä¸€æ—¦è¿™ä¸ª token è¿‡æœŸï¼Œå®¢æˆ·ç«¯éœ€è¦å†æ¬¡è¯·æ±‚è·å– tokenã€‚ é‰´æƒé€šè¿‡ä¹‹åå®¢æˆ·ç«¯ä¼šç›´æ¥é€šè¿‡TCP é•¿è¿æ¥åˆ°å›¾ä¸­çš„ push-server æ¨¡å—ã€‚ è¿™ä¸ªæ¨¡å—å°±æ˜¯çœŸæ­£å¤„ç†æ¶ˆæ¯çš„ä¸Šã€ä¸‹è¡Œã€‚ ä¿å­˜é€šé“å…³ç³»åœ¨è¿æ¥æ¥å…¥ä¹‹åï¼ŒçœŸæ­£å¤„ç†ä¸šåŠ¡ä¹‹å‰éœ€è¦å°†å½“å‰çš„å®¢æˆ·ç«¯å’Œ Channel çš„å…³ç³»ç»´æŠ¤èµ·æ¥ã€‚ å‡è®¾å®¢æˆ·ç«¯çš„å”¯ä¸€æ ‡è¯†æ˜¯æ‰‹æœºå·ç ï¼Œé‚£å°±éœ€è¦æŠŠæ‰‹æœºå·ç å’Œå½“å‰çš„ Channel ç»´æŠ¤åˆ°ä¸€ä¸ª Map ä¸­ã€‚ è¿™ç‚¹å’Œä¹‹å‰ SpringBoot æ•´åˆé•¿è¿æ¥å¿ƒè·³æœºåˆ¶ ç±»ä¼¼ã€‚ åŒæ—¶ä¸ºäº†å¯ä»¥é€šè¿‡ Channel è·å–åˆ°å®¢æˆ·ç«¯å”¯ä¸€æ ‡è¯†ï¼ˆæ‰‹æœºå·ç ï¼‰ï¼Œè¿˜éœ€è¦åœ¨ Channel ä¸­è®¾ç½®å¯¹åº”çš„å±æ€§ï¼š 123public static void putClientId(Channel channel, String clientId) &#123; channel.attr(CLIENT_ID).set(clientId);&#125; è·å–æ—¶æ‰‹æœºå·ç æ—¶ï¼š 123public static String getClientId(Channel channel) &#123; return (String)getAttribute(channel, CLIENT_ID);&#125; è¿™æ ·å½“æˆ‘ä»¬å®¢æˆ·ç«¯ä¸‹çº¿çš„æ—¶ä¾¿å¯ä»¥è®°å½•ç›¸å…³æ—¥å¿—ï¼š 123String telNo = NettyAttrUtil.getClientId(ctx.channel());NettySocketHolder.remove(telNo);log.info("å®¢æˆ·ç«¯ä¸‹çº¿ï¼ŒTelNo=" + telNo); è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šå­˜æ”¾å®¢æˆ·ç«¯ä¸ Channel å…³ç³»çš„ Map æœ€å¥½æ˜¯é¢„è®¾å¥½å¤§å°ï¼ˆé¿å…ç»å¸¸æ‰©å®¹ï¼‰ï¼Œå› ä¸ºå®ƒå°†æ˜¯ä½¿ç”¨æœ€ä¸ºé¢‘ç¹åŒæ—¶ä¹Ÿæ˜¯å ç”¨å†…å­˜æœ€å¤§çš„ä¸€ä¸ªå¯¹è±¡ã€‚ æ¶ˆæ¯ä¸Šè¡Œæ¥ä¸‹æ¥åˆ™æ˜¯çœŸæ­£çš„ä¸šåŠ¡æ•°æ®ä¸Šä¼ ï¼Œé€šå¸¸æ¥è¯´ç¬¬ä¸€æ­¥æ˜¯éœ€è¦åˆ¤æ–­ä¸Šä¼ æ¶ˆæ¯è¾“å…¥ä»€ä¹ˆä¸šåŠ¡ç±»å‹ã€‚ åœ¨èŠå¤©åœºæ™¯ä¸­ï¼Œæœ‰å¯èƒ½ä¸Šä¼ çš„æ˜¯æ–‡æœ¬ã€å›¾ç‰‡ã€è§†é¢‘ç­‰å†…å®¹ã€‚ æ‰€ä»¥æˆ‘ä»¬å¾—è¿›è¡ŒåŒºåˆ†ï¼Œæ¥åšä¸åŒçš„å¤„ç†ï¼›è¿™å°±å’Œå®¢æˆ·ç«¯åå•†çš„åè®®æœ‰å…³äº†ã€‚ å¯ä»¥åˆ©ç”¨æ¶ˆæ¯å¤´ä¸­çš„æŸä¸ªå­—æ®µè¿›è¡ŒåŒºåˆ†ã€‚ æ›´ç®€å•çš„å°±æ˜¯ä¸€ä¸ª JSON æ¶ˆæ¯ï¼Œæ‹¿å‡ºä¸€ä¸ªå­—æ®µç”¨äºåŒºåˆ†ä¸åŒæ¶ˆæ¯ã€‚ ä¸ç®¡æ˜¯å“ªç§åªæœ‰å¯ä»¥åŒºåˆ†å‡ºæ¥å³å¯ã€‚ æ¶ˆæ¯è§£æä¸ä¸šåŠ¡è§£è€¦æ¶ˆæ¯å¯ä»¥è§£æä¹‹åä¾¿æ˜¯å¤„ç†ä¸šåŠ¡ï¼Œæ¯”å¦‚å¯ä»¥æ˜¯å†™å…¥æ•°æ®åº“ã€è°ƒç”¨å…¶ä»–æ¥å£ç­‰ã€‚ æˆ‘ä»¬éƒ½çŸ¥é“åœ¨ Netty ä¸­å¤„ç†æ¶ˆæ¯ä¸€èˆ¬æ˜¯åœ¨ channelRead() æ–¹æ³•ä¸­ã€‚ åœ¨è¿™é‡Œå¯ä»¥è§£ææ¶ˆæ¯ï¼ŒåŒºåˆ†ç±»å‹ã€‚ ä½†å¦‚æœæˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘ä¹Ÿå†™åœ¨é‡Œé¢ï¼Œé‚£è¿™é‡Œçš„å†…å®¹å°†æ˜¯å·¨å¤šæ— æ¯”ã€‚ ç”šè‡³æˆ‘ä»¬åˆ†ä¸ºå¥½å‡ ä¸ªå¼€å‘æ¥å¤„ç†ä¸åŒçš„ä¸šåŠ¡ï¼Œè¿™æ ·å°†ä¼šå‡ºç°è®¸å¤šå†²çªã€éš¾ä»¥ç»´æŠ¤ç­‰é—®é¢˜ã€‚ æ‰€ä»¥éå¸¸æœ‰å¿…è¦å°†æ¶ˆæ¯è§£æä¸ä¸šåŠ¡å¤„ç†å®Œå…¨åˆ†ç¦»å¼€æ¥ã€‚ è¿™æ—¶é¢å‘æ¥å£ç¼–ç¨‹å°±å‘æŒ¥ä½œç”¨äº†ã€‚ è¿™é‡Œçš„æ ¸å¿ƒä»£ç å’Œ ã€Œé€ ä¸ªè½®å­ã€â€”â€”cicada(è½»é‡çº§ WEB æ¡†æ¶) æ˜¯ä¸€è‡´çš„ã€‚ éƒ½æ˜¯å…ˆå®šä¹‰ä¸€ä¸ªæ¥å£ç”¨äºå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œç„¶ååœ¨è§£ææ¶ˆæ¯ä¹‹åé€šè¿‡åå°„åˆ›å»ºå…·ä½“çš„å¯¹è±¡æ‰§è¡Œå…¶ä¸­çš„å¤„ç†å‡½æ•°å³å¯ã€‚ è¿™æ ·ä¸åŒçš„ä¸šåŠ¡ã€ä¸åŒçš„å¼€å‘äººå‘˜åªéœ€è¦å®ç°è¿™ä¸ªæ¥å£åŒæ—¶å®ç°è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘å³å¯ã€‚ ä¼ªä»£ç å¦‚ä¸‹ï¼š æƒ³è¦äº†è§£ cicada çš„å…·ä½“å®ç°è¯·ç‚¹å‡»è¿™é‡Œï¼š https://github.com/TogetherOS/cicada ä¸Šè¡Œè¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼›ç”±äºæ˜¯åŸºäºé•¿è¿æ¥ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯éœ€è¦å®šæœŸå‘é€å¿ƒè·³åŒ…ç”¨äºç»´æŠ¤æœ¬æ¬¡è¿æ¥ã€‚åŒæ—¶æœåŠ¡ç«¯ä¹Ÿä¼šæœ‰ç›¸åº”çš„æ£€æŸ¥ï¼ŒN ä¸ªæ—¶é—´é—´éš”æ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯ä¹‹åå°†ä¼šä¸»åŠ¨æ–­å¼€è¿æ¥èŠ‚çœèµ„æºã€‚ è¿™ç‚¹ä½¿ç”¨ä¸€ä¸ª IdleStateHandler å°±å¯å®ç°ï¼Œæ›´å¤šå†…å®¹å¯ä»¥æŸ¥çœ‹ Netty(ä¸€) SpringBoot æ•´åˆé•¿è¿æ¥å¿ƒè·³æœºåˆ¶ã€‚ æ¶ˆæ¯ä¸‹è¡Œæœ‰äº†ä¸Šè¡Œè‡ªç„¶ä¹Ÿæœ‰ä¸‹è¡Œã€‚æ¯”å¦‚åœ¨èŠå¤©çš„åœºæ™¯ä¸­ï¼Œæœ‰ä¸¤ä¸ªå®¢æˆ·ç«¯è¿ä¸Šäº† push-server,ä»–ä»¬ç›´æ¥éœ€è¦ç‚¹å¯¹ç‚¹é€šä¿¡ã€‚ è¿™æ—¶çš„æµç¨‹æ˜¯ï¼š A å°†æ¶ˆæ¯å‘é€ç»™æœåŠ¡å™¨ã€‚ æœåŠ¡å™¨æ”¶åˆ°æ¶ˆæ¯ä¹‹åï¼Œå¾—çŸ¥æ¶ˆæ¯æ˜¯è¦å‘é€ç»™ Bï¼Œéœ€è¦åœ¨å†…å­˜ä¸­æ‰¾åˆ° B çš„ Channelã€‚ é€šè¿‡ B çš„ Channel å°† A çš„æ¶ˆæ¯è½¬å‘ä¸‹å»ã€‚ è¿™å°±æ˜¯ä¸€ä¸ªä¸‹è¡Œçš„æµç¨‹ã€‚ ç”šè‡³ç®¡ç†å‘˜éœ€è¦ç»™æ‰€æœ‰åœ¨çº¿ç”¨æˆ·å‘é€ç³»ç»Ÿé€šçŸ¥ä¹Ÿæ˜¯ç±»ä¼¼ï¼š éå†ä¿å­˜é€šé“å…³ç³»çš„ Mapï¼ŒæŒ¨ä¸ªå‘é€æ¶ˆæ¯å³å¯ã€‚è¿™ä¹Ÿæ˜¯ä¹‹å‰éœ€è¦å­˜æ”¾åˆ° Map ä¸­çš„ä¸»è¦åŸå› ã€‚ ä¼ªä»£ç å¦‚ä¸‹ï¼š å…·ä½“å¯ä»¥å‚è€ƒï¼š https://github.com/crossoverJie/netty-action/ åˆ†å¸ƒå¼æ–¹æ¡ˆå•æœºç‰ˆçš„å®ç°äº†ï¼Œç°åœ¨ç€é‡è®²è®²å¦‚ä½•å®ç°ç™¾ä¸‡è¿æ¥ã€‚ ç™¾ä¸‡è¿æ¥å…¶å®åªæ˜¯ä¸€ä¸ªå½¢å®¹è¯ï¼Œæ›´å¤šçš„æ˜¯æƒ³è¡¨è¾¾å¦‚ä½•æ¥å®ç°ä¸€ä¸ªåˆ†å¸ƒå¼çš„æ–¹æ¡ˆï¼Œå¯ä»¥çµæ´»çš„æ°´å¹³æ‹“å±•ä»è€Œèƒ½æ”¯æŒæ›´å¤šçš„è¿æ¥ã€‚ å†åšè¿™ä¸ªäº‹å‰é¦–å…ˆå¾—ææ¸…æ¥šæˆ‘ä»¬å•æœºç‰ˆçš„èƒ½æ”¯æŒå¤šå°‘è¿æ¥ã€‚å½±å“è¿™ä¸ªçš„å› ç´ å°±æ¯”è¾ƒå¤šäº†ã€‚ æœåŠ¡å™¨è‡ªèº«é…ç½®ã€‚å†…å­˜ã€CPUã€ç½‘å¡ã€Linux æ”¯æŒçš„æœ€å¤§æ–‡ä»¶æ‰“å¼€æ•°ç­‰ã€‚ åº”ç”¨è‡ªèº«é…ç½®ï¼Œå› ä¸º Netty æœ¬èº«éœ€è¦ä¾èµ–äºå †å¤–å†…å­˜ï¼Œä½†æ˜¯ JVM æœ¬èº«ä¹Ÿæ˜¯éœ€è¦å ç”¨ä¸€éƒ¨åˆ†å†…å­˜çš„ï¼Œæ¯”å¦‚å­˜æ”¾é€šé“å…³ç³»çš„å¤§ Mapã€‚è¿™ç‚¹éœ€è¦ç»“åˆè‡ªèº«æƒ…å†µè¿›è¡Œè°ƒæ•´ã€‚ ç»“åˆä»¥ä¸Šçš„æƒ…å†µå¯ä»¥æµ‹è¯•å‡ºå•ä¸ªèŠ‚ç‚¹èƒ½æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°ã€‚ å•æœºæ— è®ºæ€ä¹ˆä¼˜åŒ–éƒ½æ˜¯æœ‰ä¸Šé™çš„ï¼Œè¿™ä¹Ÿæ˜¯åˆ†å¸ƒå¼ä¸»è¦è§£å†³çš„é—®é¢˜ã€‚ æ¶æ„ä»‹ç»åœ¨å°†å…·ä½“å®ç°ä¹‹å‰é¦–å…ˆå¾—è®²è®²ä¸Šæ–‡è´´å‡ºçš„æ•´ä½“æ¶æ„å›¾ã€‚ å…ˆä»å·¦è¾¹å¼€å§‹ã€‚ ä¸Šæ–‡æåˆ°çš„ æ³¨å†Œé‰´æƒ æ¨¡å—ä¹Ÿæ˜¯é›†ç¾¤éƒ¨ç½²çš„ï¼Œé€šè¿‡å‰ç½®çš„ Nginx è¿›è¡Œè´Ÿè½½ã€‚ä¹‹å‰ä¹Ÿæè¿‡äº†å®ƒä¸»è¦çš„ç›®çš„æ˜¯æ¥åšé‰´æƒå¹¶è¿”å›ä¸€ä¸ª token ç»™å®¢æˆ·ç«¯ã€‚ ä½†æ˜¯ push-server é›†ç¾¤ä¹‹åå®ƒåˆå¤šäº†ä¸€ä¸ªä½œç”¨ã€‚é‚£å°±æ˜¯å¾—è¿”å›ä¸€å°å¯ä¾›å½“å‰å®¢æˆ·ç«¯ä½¿ç”¨çš„ push-serverã€‚ å³ä¾§çš„ å¹³å° ä¸€èˆ¬æŒ‡ç®¡ç†å¹³å°ï¼Œå®ƒå¯ä»¥æŸ¥çœ‹å½“å‰çš„å®æ—¶åœ¨çº¿æ•°ã€ç»™æŒ‡å®šå®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯ç­‰ã€‚ æ¨é€æ¶ˆæ¯åˆ™éœ€è¦ç»è¿‡ä¸€ä¸ªæ¨é€è·¯ç”±ï¼ˆpush-serverï¼‰æ‰¾åˆ°çœŸæ­£çš„æ¨é€èŠ‚ç‚¹ã€‚ å…¶ä½™çš„ä¸­é—´ä»¶å¦‚ï¼šRedisã€Zookeeperã€Kafkaã€MySQL éƒ½æ˜¯ä¸ºäº†è¿™äº›åŠŸèƒ½æ‰€å‡†å¤‡çš„ï¼Œå…·ä½“çœ‹ä¸‹é¢çš„å®ç°ã€‚ æ³¨å†Œå‘ç°é¦–å…ˆç¬¬ä¸€ä¸ªé—®é¢˜åˆ™æ˜¯ æ³¨å†Œå‘ç°ï¼Œpush-server å˜ä¸ºå¤šå°ä¹‹åå¦‚ä½•ç»™å®¢æˆ·ç«¯é€‰æ‹©ä¸€å°å¯ç”¨çš„èŠ‚ç‚¹æ˜¯ç¬¬ä¸€ä¸ªéœ€è¦è§£å†³çš„ã€‚ è¿™å—çš„å†…å®¹å…¶å®å·²ç»åœ¨ åˆ†å¸ƒå¼(ä¸€) æå®šæœåŠ¡æ³¨å†Œä¸å‘ç° ä¸­è¯¦ç»†è®²è¿‡äº†ã€‚ æ‰€æœ‰çš„ push-server åœ¨å¯åŠ¨æ—¶å€™éœ€è¦å°†è‡ªèº«çš„ä¿¡æ¯æ³¨å†Œåˆ° Zookeeper ä¸­ã€‚ æ³¨å†Œé‰´æƒ æ¨¡å—ä¼šè®¢é˜… Zookeeper ä¸­çš„èŠ‚ç‚¹ï¼Œä»è€Œå¯ä»¥è·å–æœ€æ–°çš„æœåŠ¡åˆ—è¡¨ã€‚ç»“æ„å¦‚ä¸‹ï¼š ä»¥ä¸‹æ˜¯ä¸€äº›ä¼ªä»£ç ï¼š åº”ç”¨å¯åŠ¨æ³¨å†Œ Zookeeperã€‚ å¯¹äºæ³¨å†Œé‰´æƒæ¨¡å—æ¥è¯´åªéœ€è¦è®¢é˜…è¿™ä¸ª Zookeeper èŠ‚ç‚¹ï¼š è·¯ç”±ç­–ç•¥æ—¢ç„¶èƒ½è·å–åˆ°æ‰€æœ‰çš„æœåŠ¡åˆ—è¡¨ï¼Œé‚£å¦‚ä½•é€‰æ‹©ä¸€å°åˆšå¥½åˆé€‚çš„ push-server ç»™å®¢æˆ·ç«¯ä½¿ç”¨å‘¢ï¼Ÿ è¿™ä¸ªè¿‡ç¨‹é‡ç‚¹è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š å°½é‡ä¿è¯å„ä¸ªèŠ‚ç‚¹çš„è¿æ¥å‡åŒ€ã€‚ å¢åˆ èŠ‚ç‚¹æ˜¯å¦è¦åš Rebalanceã€‚ é¦–å…ˆä¿è¯å‡è¡¡æœ‰ä»¥ä¸‹å‡ ç§ç®—æ³•ï¼š è½®è¯¢ã€‚æŒ¨ä¸ªå°†å„ä¸ªèŠ‚ç‚¹åˆ†é…ç»™å®¢æˆ·ç«¯ã€‚ä½†ä¼šå‡ºç°æ–°å¢èŠ‚ç‚¹åˆ†é…ä¸å‡åŒ€çš„æƒ…å†µã€‚ Hash å–æ¨¡çš„æ–¹å¼ã€‚ç±»ä¼¼äº HashMapï¼Œä½†ä¹Ÿä¼šå‡ºç°è½®è¯¢çš„é—®é¢˜ã€‚å½“ç„¶ä¹Ÿå¯ä»¥åƒ HashMap é‚£æ ·åšä¸€æ¬¡ Rebalanceï¼Œè®©æ‰€æœ‰çš„å®¢æˆ·ç«¯é‡æ–°è¿æ¥ã€‚ä¸è¿‡è¿™æ ·ä¼šå¯¼è‡´æ‰€æœ‰çš„è¿æ¥å‡ºç°ä¸­æ–­é‡è¿ï¼Œä»£ä»·æœ‰ç‚¹å¤§ã€‚ ç”±äº Hash å–æ¨¡æ–¹å¼çš„é—®é¢˜å¸¦æ¥äº†ä¸€è‡´æ€§ Hashç®—æ³•ï¼Œä½†ä¾ç„¶ä¼šæœ‰ä¸€éƒ¨åˆ†çš„å®¢æˆ·ç«¯éœ€è¦ Rebalanceã€‚ æƒé‡ã€‚å¯ä»¥æ‰‹åŠ¨è°ƒæ•´å„ä¸ªèŠ‚ç‚¹çš„è´Ÿè½½æƒ…å†µï¼Œç”šè‡³å¯ä»¥åšæˆè‡ªåŠ¨çš„ï¼ŒåŸºäºç›‘æ§å½“æŸäº›èŠ‚ç‚¹è´Ÿè½½è¾ƒé«˜å°±è‡ªåŠ¨è°ƒä½æƒé‡ï¼Œè´Ÿè½½è¾ƒä½çš„å¯ä»¥æé«˜æƒé‡ã€‚ è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼š å½“æˆ‘ä»¬åœ¨é‡å¯éƒ¨åˆ†åº”ç”¨è¿›è¡Œå‡çº§æ—¶ï¼Œåœ¨è¯¥èŠ‚ç‚¹ä¸Šçš„å®¢æˆ·ç«¯æ€ä¹ˆå¤„ç†ï¼Ÿ ç”±äºæˆ‘ä»¬æœ‰å¿ƒè·³æœºåˆ¶ï¼Œå½“å¿ƒè·³ä¸é€šä¹‹åå°±å¯ä»¥è®¤ä¸ºè¯¥èŠ‚ç‚¹å‡ºç°é—®é¢˜äº†ã€‚é‚£å°±å¾—é‡æ–°è¯·æ±‚æ³¨å†Œé‰´æƒæ¨¡å—è·å–ä¸€ä¸ªå¯ç”¨çš„èŠ‚ç‚¹ã€‚åœ¨å¼±ç½‘æƒ…å†µä¸‹åŒæ ·é€‚ç”¨ã€‚ å¦‚æœè¿™æ—¶å®¢æˆ·ç«¯æ­£åœ¨å‘é€æ¶ˆæ¯ï¼Œåˆ™éœ€è¦å°†æ¶ˆæ¯ä¿å­˜åˆ°æœ¬åœ°ç­‰å¾…è·å–åˆ°æ–°çš„èŠ‚ç‚¹ä¹‹åå†æ¬¡å‘é€ã€‚ æœ‰çŠ¶æ€è¿æ¥åœ¨è¿™æ ·çš„åœºæ™¯ä¸­ä¸åƒæ˜¯ HTTP é‚£æ ·æ˜¯æ— çŠ¶æ€çš„ï¼Œæˆ‘ä»¬å¾—æ˜ç¡®çš„çŸ¥é“å„ä¸ªå®¢æˆ·ç«¯å’Œè¿æ¥çš„å…³ç³»ã€‚ åœ¨ä¸Šæ–‡çš„å•æœºç‰ˆä¸­æˆ‘ä»¬å°†è¿™ä¸ªå…³ç³»ä¿å­˜åˆ°æœ¬åœ°çš„ç¼“å­˜ä¸­ï¼Œä½†åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­æ˜¾ç„¶è¡Œä¸é€šäº†ã€‚ æ¯”å¦‚åœ¨å¹³å°å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå®ƒå¾—é¦–å…ˆçŸ¥é“è¿™ä¸ªå®¢æˆ·ç«¯çš„é€šé“ä¿å­˜åœ¨å“ªå°èŠ‚ç‚¹ä¸Šã€‚ å€ŸåŠ©æˆ‘ä»¬ä»¥å‰çš„ç»éªŒï¼Œè¿™æ ·çš„é—®é¢˜è‡ªç„¶å¾—å¼•å…¥ä¸€ä¸ªç¬¬ä¸‰æ–¹ä¸­é—´ä»¶ç”¨æ¥å­˜æ”¾è¿™ä¸ªå…³ç³»ã€‚ ä¹Ÿå°±æ˜¯æ¶æ„å›¾ä¸­çš„å­˜æ”¾è·¯ç”±å…³ç³»çš„ Redisï¼Œåœ¨å®¢æˆ·ç«¯æ¥å…¥ push-server æ—¶éœ€è¦å°†å½“å‰å®¢æˆ·ç«¯å”¯ä¸€æ ‡è¯†å’ŒæœåŠ¡èŠ‚ç‚¹çš„ ip+port å­˜è¿› Redisã€‚ åŒæ—¶åœ¨å®¢æˆ·ç«¯ä¸‹çº¿æ—¶å€™å¾—åœ¨ Redis ä¸­åˆ æ‰è¿™ä¸ªè¿æ¥å…³ç³»ã€‚ è¿™æ ·åœ¨ç†æƒ³æƒ…å†µä¸‹å„ä¸ªèŠ‚ç‚¹å†…å­˜ä¸­çš„ map å…³ç³»åŠ èµ·æ¥åº”è¯¥æ­£å¥½ç­‰äº Redis ä¸­çš„æ•°æ®ã€‚ ä¼ªä»£ç å¦‚ä¸‹ï¼š è¿™é‡Œå­˜æ”¾è·¯ç”±å…³ç³»çš„æ—¶å€™ä¼šæœ‰å¹¶å‘é—®é¢˜ï¼Œæœ€å¥½æ˜¯æ¢ä¸ºä¸€ä¸ª lua è„šæœ¬ã€‚ æ¨é€è·¯ç”±è®¾æƒ³è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šç®¡ç†å‘˜éœ€è¦ç»™æœ€è¿‘æ³¨å†Œçš„å®¢æˆ·ç«¯æ¨é€ä¸€ä¸ªç³»ç»Ÿæ¶ˆæ¯ä¼šæ€ä¹ˆåšï¼Ÿ ç»“åˆæ¶æ„å›¾ å‡è®¾è¿™æ‰¹å®¢æˆ·ç«¯æœ‰ 10W ä¸ªï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦å°†è¿™æ‰¹å·ç é€šè¿‡å¹³å°ä¸‹çš„ Nginx ä¸‹å‘åˆ°ä¸€ä¸ªæ¨é€è·¯ç”±ä¸­ã€‚ ä¸ºäº†æé«˜æ•ˆç‡ç”šè‡³å¯ä»¥å°†è¿™æ‰¹å·ç å†æ¬¡åˆ†æ•£åˆ°æ¯ä¸ª push-route ä¸­ã€‚ æ‹¿åˆ°å…·ä½“å·ç ä¹‹åå†æ ¹æ®å·ç çš„æ•°é‡å¯åŠ¨å¤šçº¿ç¨‹çš„æ–¹å¼å»ä¹‹å‰çš„è·¯ç”± Redis ä¸­è·å–å®¢æˆ·ç«¯æ‰€å¯¹åº”çš„ push-serverã€‚ å†é€šè¿‡ HTTP çš„æ–¹å¼è°ƒç”¨ push-server è¿›è¡ŒçœŸæ­£çš„æ¶ˆæ¯ä¸‹å‘ï¼ˆNetty ä¹Ÿå¾ˆå¥½çš„æ”¯æŒ HTTP åè®®ï¼‰ã€‚ æ¨é€æˆåŠŸä¹‹åéœ€è¦å°†ç»“æœæ›´æ–°åˆ°æ•°æ®åº“ä¸­ï¼Œä¸åœ¨çº¿çš„å®¢æˆ·ç«¯å¯ä»¥æ ¹æ®ä¸šåŠ¡å†æ¬¡æ¨é€ç­‰ã€‚ æ¶ˆæ¯æµè½¬ä¹Ÿè®¸æœ‰äº›åœºæ™¯å¯¹äºå®¢æˆ·ç«¯ä¸Šè¡Œçš„æ¶ˆæ¯éå¸¸çœ‹é‡ï¼Œéœ€è¦åšæŒä¹…åŒ–ï¼Œå¹¶ä¸”æ¶ˆæ¯é‡éå¸¸å¤§ã€‚ åœ¨ push-sever åšä¸šåŠ¡æ˜¾ç„¶ä¸åˆé€‚ï¼Œè¿™æ—¶å®Œå…¨å¯ä»¥é€‰æ‹© Kafka æ¥è§£è€¦ã€‚ å°†æ‰€æœ‰ä¸Šè¡Œçš„æ•°æ®ç›´æ¥å¾€ Kafka é‡Œä¸¢åå°±ä¸ç®¡äº†ã€‚ å†ç”±æ¶ˆè´¹ç¨‹åºå°†æ•°æ®å–å‡ºå†™å…¥æ•°æ®åº“ä¸­å³å¯ã€‚ å…¶å®è¿™å—å†…å®¹ä¹Ÿå¾ˆå€¼å¾—è®¨è®ºï¼Œå¯ä»¥å…ˆçœ‹è¿™ç¯‡äº†è§£ä¸‹ï¼šå¼ºå¦‚ Disruptor ä¹Ÿå‘ç”Ÿå†…å­˜æº¢å‡ºï¼Ÿ åç»­è°ˆåˆ° Kafka å†åšè¯¦ç»†ä»‹ç»ã€‚ åˆ†å¸ƒå¼é—®é¢˜åˆ†å¸ƒå¼è§£å†³äº†æ€§èƒ½é—®é¢˜ä½†å´å¸¦æ¥äº†å…¶ä»–éº»çƒ¦ã€‚ åº”ç”¨ç›‘æ§æ¯”å¦‚å¦‚ä½•çŸ¥é“çº¿ä¸Šå‡ åä¸ª push-server èŠ‚ç‚¹çš„å¥åº·çŠ¶å†µï¼Ÿ è¿™æ—¶å°±å¾—ç›‘æ§ç³»ç»Ÿå‘æŒ¥ä½œç”¨äº†ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å„ä¸ªèŠ‚ç‚¹å½“å‰çš„å†…å­˜ä½¿ç”¨æƒ…å†µã€GCã€‚ ä»¥åŠæ“ä½œç³»ç»Ÿæœ¬èº«çš„å†…å­˜ä½¿ç”¨ï¼Œæ¯•ç«Ÿ Netty å¤§é‡ä½¿ç”¨äº†å †å¤–å†…å­˜ã€‚ åŒæ—¶éœ€è¦ç›‘æ§å„ä¸ªèŠ‚ç‚¹å½“å‰çš„åœ¨çº¿æ•°ï¼Œä»¥åŠ Redis ä¸­çš„åœ¨çº¿æ•°ã€‚ç†è®ºä¸Šè¿™ä¸¤ä¸ªæ•°åº”è¯¥æ˜¯ç›¸ç­‰çš„ã€‚ è¿™æ ·ä¹Ÿå¯ä»¥çŸ¥é“ç³»ç»Ÿçš„ä½¿ç”¨æƒ…å†µï¼Œå¯ä»¥çµæ´»çš„ç»´æŠ¤è¿™äº›èŠ‚ç‚¹æ•°é‡ã€‚ æ—¥å¿—å¤„ç†æ—¥å¿—è®°å½•ä¹Ÿå˜å¾—å¼‚å¸¸é‡è¦äº†ï¼Œæ¯”å¦‚å“ªå¤©åé¦ˆæœ‰ä¸ªå®¢æˆ·ç«¯ä¸€ç›´è¿ä¸ä¸Šï¼Œä½ å¾—çŸ¥é“é—®é¢˜å‡ºåœ¨å“ªé‡Œã€‚ æœ€å¥½æ˜¯ç»™æ¯æ¬¡è¯·æ±‚éƒ½åŠ ä¸Šä¸€ä¸ª traceID è®°å½•æ—¥å¿—ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ—¥å¿—åœ¨å„ä¸ªèŠ‚ç‚¹ä¸­æŸ¥çœ‹åˆ°åº•æ˜¯å¡åœ¨äº†å“ªé‡Œã€‚ ä»¥åŠ ELK è¿™äº›å·¥å…·éƒ½å¾—ç”¨èµ·æ¥æ‰è¡Œã€‚ æ€»ç»“æœ¬æ¬¡æ˜¯ç»“åˆæˆ‘æ—¥å¸¸ç»éªŒå¾—å‡ºçš„ï¼Œæœ‰äº›å‘å¯èƒ½åœ¨å·¥ä½œä¸­å¹¶æ²¡æœ‰è¸©åˆ°ï¼Œæ‰€æœ‰è¿˜ä¼šæœ‰ä¸€äº›é—æ¼çš„åœ°æ–¹ã€‚ å°±ç›®å‰æ¥çœ‹æƒ³åšä¸€ä¸ªç¨³å®šçš„æ¨é€ç³»ç»Ÿå…¶å®æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œå…¶ä¸­æ¶‰åŠåˆ°çš„ç‚¹éå¸¸å¤šï¼Œåªæœ‰çœŸæ­£åšè¿‡ä¹‹åæ‰ä¼šçŸ¥é“ã€‚ çœ‹å®Œä¹‹åè§‰å¾—æœ‰å¸®åŠ©çš„è¿˜è¯·ä¸åè½¬å‘åˆ†äº«ã€‚ æ¬¢è¿å…³æ³¨å…¬ä¼—å·ä¸€èµ·äº¤æµï¼š]]></content>
      <categories>
        <category>Netty</category>
      </categories>
      <tags>
        <tag>Kafka</tag>
        <tag>Redis</tag>
        <tag>Zookeeper</tag>
        <tag>æ¨é€</tag>
        <tag>è·¯ç”±ç­–ç•¥</tag>
        <tag>æ³¨å†Œå‘ç°</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€Œé€ ä¸ªè½®å­ã€â€”â€”cicada è®¾è®¡ä¸€ä¸ªé…ç½®æ¨¡å—]]></title>
    <url>%2F2018%2F09%2F14%2Fwheel%2Fcicada3%2F</url>
    <content type="text"><![CDATA[å‰è¨€åœ¨å‰ä¸¤æ¬¡çš„ cicada ç‰ˆæœ¬ä¸­å…¶å®è¿˜ä¸æ”¯æŒè¯»å–é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚å¯¹ç«¯å£ã€è·¯ç”±çš„é…ç½®ã€‚ å› æ­¤æˆ‘æŒ‰ç…§è‡ªå·±çš„æƒ³æ³•åˆ›å»ºäº†ä¸€ä¸ª issue ï¼Œä¹Ÿæ”¶é›†åˆ°äº†ä¸€äº›å¾ˆä¸é”™çš„å»ºè®®ã€‚ æœ€ç»ˆå…¶å®è¿˜æ˜¯æŒ‰ç…§æˆ‘ä¹‹å‰çš„æƒ³æ³•æ¥åšäº†è¿™ä¸ªé…ç½®ç®¡ç†ã€‚ åŒæ—¶å°† cicada å‡çº§åˆ°äº† v1.0.2ã€‚ ç›®æ ‡åœ¨åšä¹‹å‰æ˜¯è¦æŠŠéœ€æ±‚æƒ³å¥½ï¼Œåˆ°åº•æ€æ ·çš„ä¸€ä¸ªé…ç½®ç®¡ç†æ˜¯å¯¹å¼€å‘äººå‘˜æ¥è¯´æ¯”è¾ƒå‹å¥½çš„ï¼Ÿ æˆ‘è®¤ä¸ºæœ‰ä»¥ä¸‹å‡ ç‚¹: å¯ä»¥è‡ªå®šä¹‰é…ç½®ï¼Œå¹¶ä¸”æ”¯æŒä¸åŒçš„ç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰ã€‚ ä½¿ç”¨çµæ´»ã€‚å¯¹ä½¿ç”¨è€…æ¥è¯´ä¸è¦æœ‰å¤ªå¤šçš„æŸç¼šã€‚ ç†è®ºä¸Šæ¥è¯´é…ç½®è¿™ä¸ªä¸œè¥¿åº”å½“å®Œå…¨ç‹¬ç«‹å‡ºæ¥ï¼Œç”±ä¸€ä¸ªé…ç½®ä¸­å¿ƒæ¥è´Ÿè´£ç®¡ç†å¹¶ä¸”è¿™æ ·å¯ä»¥ä¸åº”ç”¨è§£è€¦ã€‚ ä¸è¿‡è¿™æ ·çš„å®ç°å’Œå½“å‰ cicada çš„å®šä¹‰æœ‰äº›å†²çªï¼Œæˆ‘æƒ³å°½é‡å°çš„ä¾èµ–ç¬¬ä¸‰æ–¹ç»„ä»¶å¹¶å¯ä»¥å®Œå…¨ç‹¬ç«‹è¿è¡Œã€‚ å› æ­¤åŸºäºè¿™æ ·çš„æƒ…å†µä¾¿æœ‰äº†ä»¥ä¸‹çš„å®ç°ã€‚ ä½¿ç”¨åœ¨çœ‹å®ç°ä¹‹å‰å…ˆçœ‹çœ‹åŸºäºç›®å‰çš„é…ç½®ç®¡ç†å¦‚ä½•åœ¨ä¸šåŠ¡ä¸­ä½¿ç”¨èµ·æ¥ã€‚ ç»“åˆç°åœ¨å¤§å®¶ä½¿ç”¨ SpringBoot çš„ä¹ æƒ¯ï¼Œcicada é»˜è®¤ä¼šè¯»å– classpath ä¸‹çš„ application.properties é…ç½®æ–‡ä»¶ã€‚å¹¶ä¸”ä¼šé»˜è®¤è¯»å–å…¶ä¸­çš„åº”ç”¨ç«¯å£ä»¥åŠåˆå§‹è·¯ç”±åœ°å€ã€‚ åŒæ—¶ä¹Ÿæ–°å¢äº†ä¸€ä¸ª apiã€‚ 12345678910111213public class MainStart &#123; public static void main(String[] args) throws Exception &#123; CicadaServer.start(MainStart.class,"/cicada-example") ; &#125;&#125;public class MainStart &#123; public static void main(String[] args) throws Exception &#123; CicadaServer.start(MainStart.class) ; &#125;&#125; è¿™æ ·åœ¨ä¸ä¼ é»˜è®¤åœ°å€çš„æ—¶å€™ cicada ä¼šä» application.properties ä¸­è¯»å–ã€‚ è€ƒè™‘åˆ°åé¢å¯ç»´æŠ¤çš„æƒ…å†µï¼Œcicada ä¹Ÿæ”¯æŒé…ç½®å„ç§ä¸åŒçš„é…ç½®æ–‡ä»¶ã€‚ ä½¿ç”¨ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦ç»§æ‰¿ cicada æä¾›çš„ä¸€ä¸ªæŠ½è±¡ç±»å³å¯ã€‚ 1234567891011121314151617public class KafkaConfiguration extends AbstractCicadaConfiguration &#123; public KafkaConfiguration() &#123; super.setPropertiesName("kafka.properties"); &#125;&#125;public class RedisConfiguration extends AbstractCicadaConfiguration &#123; public RedisConfiguration() &#123; super.setPropertiesName("redis.properties"); &#125;&#125; æŒ‰ç…§è¿™æ ·çš„é…ç½®ä¹Ÿä¼šé»˜è®¤ä» classpath è¯»å–è¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶ã€‚ å½“ç„¶è¿™é‡Œæœ‰ä¸ªå‰æï¼šä»£ç é‡Œé…ç½®çš„æ–‡ä»¶åå¿…é¡»å¾—å’Œé…ç½®æ–‡ä»¶åç§°ç›¸åŒã€‚ é‚£å¦‚ä½•åœ¨ä¸šåŠ¡ä¸­è¯»å–è¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶çš„å†…å®¹å‘¢ï¼Ÿ è¿™ä¹Ÿç®€å•ï¼Œä»£ç ä¸€çœ‹å°±æ‡‚ï¼š é¦–å…ˆéœ€è¦é€šè¿‡ ConfigurationHolder è·å–å„è‡ªä¸åŒé…ç½®çš„ç®¡ç†å¯¹è±¡ï¼ˆéœ€è¦æ˜¾å¼æŒ‡å®šç±»ç±»å‹ï¼‰ã€‚ é€šè¿‡ get() æ–¹æ³•ç›´æ¥è·å–é…ç½®ã€‚ åŒæ—¶ä¹Ÿæ”¯æŒè·å– application.properties é‡Œçš„é…ç½®ã€‚ åŒæ—¶ä¸ºäº†æ”¯æŒåœ¨ä¸åŒç¯å¢ƒçš„ä½¿ç”¨ï¼Œå½“é…ç½®äº†å¯åŠ¨å‚æ•°å°†ä¼šä¼˜å…ˆè¯»å–ã€‚ 123-Dapplication.properties=/xx/application.properties-Dkafka.properties=/xx/kakfa.properties-Dredis.properties=/xx/redis.properties è¿™æ ·ç®—æ˜¯åŸºæœ¬å®ç°äº†ä¸Šè¿°çš„é…ç½®è¦æ±‚ã€‚ å®ç°è¦å®ç°ä»¥ä¸Šçš„åŠŸèƒ½æœ‰å‡ ä¸ªæ ¸å¿ƒç‚¹ï¼š åŠ è½½æ‰€æœ‰é…ç½®æ–‡ä»¶ã€‚ å°†ä¸åŒçš„é…ç½®æ–‡ä»¶ç”¨ä¸åŒçš„å¯¹è±¡è¿›è¡Œç®¡ç†ã€‚ æä¾›ç®€æ˜“çš„æ¥å£ä½¿ç”¨ã€‚ ç”±äº cicada éœ€è¦æ”¯æŒå¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œæ‰€æœ‰éœ€è¦å®šä¹‰ä¸€ä¸ªæŠ½è±¡ç±»ä¾›æ‰€æœ‰çš„é…ç½®ç®¡ç†å®ç°ã€‚ å®šä¹‰æ¯”è¾ƒç®€å•ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æˆå‘˜å˜é‡ï¼š æ–‡ä»¶åç§°ï¼šç”¨äºåˆå§‹åŒ–æ—¶é€šè¿‡åç§°åŠ è½½é…ç½®æ–‡ä»¶ã€‚ Properties å…¶å®å°±æ˜¯ä¸€ä¸ª Map ç»“æ„çš„ç¼“å­˜ï¼Œç”¨äºå­˜æ”¾æ‰€æœ‰çš„é…ç½®ã€‚å½“ç„¶å¯¹å¤–æä¾›çš„æŸ¥è¯¢æ˜¯åŸºäºå®ƒçš„ã€‚ æ¥ç€å°±æ˜¯åœ¨åˆå§‹åŒ–æ—¶éœ€è¦æ‰¾å‡ºæ‰€æœ‰ç»§æ‰¿äº† AbstractCicadaConfiguration çš„ç±»ã€‚ æŸ¥è¯¢å‡ºæ¥ä¹‹åè‡ªç„¶æ˜¯è¦è¿›è¡Œéå†åŒæ—¶åå°„åˆ›å»ºå¯¹è±¡ã€‚ ç”±äºä¹‹å‰å·²ç»è°ƒç”¨äº† super.setPropertiesName(&quot;redis.properties&quot;); æ¥èµ‹å€¼é…ç½®æ–‡ä»¶åç§°ï¼Œæ‰€ä»¥è¿˜éœ€è¦åœ¨éå†è¿‡ç¨‹ä¸­å°† Properties è¿›è¡Œèµ‹å€¼ã€‚ åŒæ—¶åœ¨è¿™é‡Œä¹Ÿä½“ç°å‡ºä¼˜å…ˆè¯»å–çš„æ˜¯ VM å¯åŠ¨å‚æ•°ä¸­çš„é…ç½®æ–‡ä»¶ã€‚ 1String systemProperty = System.getProperty(conf.getPropertiesName()); éœ€è¦é¢å¤–æä¸€ç‚¹çš„æ˜¯ï¼šåœ¨æŸ¥æ‰¾æ‰€æœ‰ç”¨æˆ·è‡ªå®šä¹‰çš„é…ç½®ç®¡ç†ç±»æ—¶éœ€è¦æ‰‹åŠ¨å°† cicada å†…ç½®çš„ApplicationConfiguration åŠ å…¥å…¶ä¸­ã€‚ å› ä¸ºä½¿ç”¨åº”ç”¨çš„åŒ…åé€šè¿‡åå°„æ˜¯æŸ¥è¯¢ä¸å‡ºè¯¥ç±»çš„ã€‚ ä¿å­˜è‡ªå®šä¹‰é…ç½®ç®¡ç†ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·åœ¨ä½¿ç”¨æ—¶å€™å¯ä»¥éšæ„çš„è¯»å–å„ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥è¿˜éœ€è¦å°†åå°„åˆ›å»ºçš„å¯¹è±¡ä¿å­˜åˆ°ä¸€ä¸ªå†…éƒ¨ç¼“å­˜ä¸­ï¼Œæ ¸å¿ƒä»£ç å°±æ˜¯ä¸Šä¸Šå›¾ä¸­çš„è¿™æ®µä»£ç ï¼š 12// add configuration cacheConfigurationHolder.addConfiguration(aClass.getName(), conf); å…¶ä¸­ ConfigurationHolder çš„å®šä¹‰å¦‚ä¸‹ã€‚ å…¶å®ä¹Ÿæ˜¯åˆ©ç”¨ä¸€ä¸ª Map æ¥å­˜æ”¾è¿™äº›å¯¹è±¡ã€‚ è¿™æ ·åœ¨ä½¿ç”¨æ—¶å€™åªéœ€è¦å–å‡ºå³å¯ã€‚ 12KafkaConfiguration configuration = (KafkaConfiguration) getConfiguration(KafkaConfiguration.class);String brokerList = configuration.get("kafka.broker.list"); é‡æ„æœ¬æ¬¡å‡çº§åŒæ—¶è¿˜é‡æ„äº†éƒ¨åˆ†ä»£ç ï¼Œæ¯”å¦‚å¯åŠ¨ç±»ã€‚ ç°åœ¨çœ‹ä¸Šå»è¦æ¸…çˆ½å’Œç›´æ¥çš„å¤šï¼š å…¶ä¸­ä¹Ÿæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚ å¤§å®¶å¦‚æœæŸ¥çœ‹æ—¥å¿—çš„è¯ä¼šå‘ç°åº”ç”¨å¯åŠ¨ä¹‹åä¼šæ‰“å°æœ¬æ¬¡çš„è€—æ—¶ï¼Œè‡ªç„¶å°±æ˜¯åœ¨å¯åŠ¨æ—¶å€™è®°å½•ä¸€ä¸ªæ—¶é—´ï¼Œåˆå§‹åŒ–å®Œæ¯•ä¹‹åè®°å½•ä¸€ä¸ªå³å¯ã€‚ åœ¨ä¹‹å‰çš„å®ç°ä¸­ç”±äºéƒ½æ˜¯åœ¨ä¸€ä¸ªæ–¹æ³•å†…ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨å°±è¡Œäº†ã€‚ ä½†ç°åœ¨ä¼˜åŒ–ä¹‹åè·¨è¶Šäº†ä¸åŒçš„æ–¹æ³•å’Œç±»ï¼Œéš¾é“è¦æŠŠæ—¶é—´ä½œä¸ºå‚æ•°åœ¨å„ä¸ªæ–¹æ³•ä¹‹å‰ä¼ é€’å˜›ï¼Ÿ é‚£æœªå…å¤ªä¸ä¼˜é›…äº†ã€‚ æ‰€ä»¥ ThreadLocal å°±æœ‰äº†å‘æŒ¥ä½™åœ°ã€‚ åœ¨åˆå§‹åŒ–çš„æ–¹æ³•ä¸­æˆ‘å°†å½“å‰æ—¶é—´å†™å…¥ï¼š 1ThreadLocalHolder.setLocalTime(System.currentTimeMillis()); åœ¨æœ€åè®°å½•æ—¥å¿—çš„åœ°æ–¹ç›´æ¥å–å‡ºæ¯”è¾ƒå³å¯ï¼š è¿™æ ·ä½¿ç”¨èµ·æ¥å°±å®Œå…¨ä¸éœ€è¦ç®¡ä»€ä¹ˆå‚æ•°ä¼ é€’äº†ã€‚ åŒæ—¶ ThreadLocalHolder çš„å®šä¹‰ï¼š è¿™é‡Œè¿˜æ˜¯æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œåœ¨è¿™ç§é•¿ç”Ÿå‘½å‘¨æœŸçš„å®¹å™¨ä¸­ä¸€å®šå¾—è¦è®°å¾—åŠæ—¶æ¸…é™¤ã€‚ æˆ‘è¿™é‡Œçš„æ—¶é—´åœ¨æŸ¥è¯¢ä¸€æ¬¡ä¹‹åå°±ä¸ç”¨äº†ï¼Œæ‰€ä»¥å®Œå…¨æ”¾å¿ƒçš„åœ¨ getLocalTime() æ–¹æ³•ä¸­åˆ æ‰ã€‚ æ€»ç»“è¿™å°±æ˜¯æœ¬æ¬¡ v1.0.2 ä¸­çš„å‡çº§å†…å®¹ï¼ŒåŒ…å«äº†é…ç½®æ”¯æŒä»¥åŠä»£ç é‡æ„ã€‚å…¶ä¸­æœ‰äº›å†…å®¹æˆ‘è§‰å¾—å¯¹æ¥è§¦å°‘çš„åŒå­¦æ¥è¯´è¿˜æ˜¯æŒºæœ‰å¸®åŠ©çš„ã€‚ å…³äºä¸Šä¸¤æ¬¡çš„ç‰ˆæœ¬ä»‹ç»è¯·æŸ¥çœ‹è¿™é‡Œï¼š ã€Œé€ ä¸ªè½®å­ã€â€”â€”cicada(è½»é‡çº§ WEB æ¡†æ¶) ã€Œé€ ä¸ªè½®å­ã€â€”â€”cicada æºç åˆ†æ è¿˜æ²¡ç‚¹å…³æ³¨çš„æœ‹å‹å¯ä»¥ç‚¹æ³¢å…³æ³¨ï¼š https://github.com/TogetherOS/cicada ä¹Ÿæ¬¢è¿å¤§å®¶å‚ä¸ä¸€èµ·ç»´æŠ¤ï¼ã€‚ åŒæ—¶åç»­å…³äº cicada çš„æ›´æ–°ä¼šæ”¾æ…¢ä¸€äº›ã€‚ä¼šä»‹ç»ä¸€äº›å¹³æ—¶å®æˆ˜ç›¸å…³çš„å†…å®¹ï¼Œæ¯”å¦‚ Kafka ä¹‹ç±»çš„ï¼Œè¯·æŒç»­å…³æ³¨ã€‚ ä½ çš„ç‚¹èµä¸è½¬å‘æ˜¯æœ€å¤§çš„æ”¯æŒã€‚]]></content>
      <categories>
        <category>cicada</category>
        <category>è½®å­</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>HTTP</tag>
        <tag>Netty</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€è¯‘ã€‘å¦‚ä½•é«˜æ•ˆçš„ä½¿ç”¨ Git]]></title>
    <url>%2F2018%2F09%2F07%2Ftranslation%2Fhow-to-use-git-efficiently%2F</url>
    <content type="text"><![CDATA[åŸæ–‡é“¾æ¥ ä»£ç æ˜¨å¤©è¿˜æ˜¯è¿è¡Œå¥½å¥½çš„ä»Šå¤©å°±ä¸è¡Œäº†ã€‚ ä»£ç è¢«åˆ äº†ã€‚ çªç„¶å‡ºç°äº†ä¸€ä¸ªå¥‡æ€ªçš„ bugï¼Œä½†æ˜¯æ²¡äººçŸ¥é“æ€ä¹ˆå›äº‹ã€‚ å¦‚æœä½ å‡ºç°è¿‡ä¸Šé¢çš„ä»»ä½•ä¸€ç§æƒ…å†µï¼Œé‚£æœ¬ç¯‡æ–‡ç« å°±æ˜¯ä¸ºä½ å‡†å¤‡çš„ã€‚ é™¤äº†çŸ¥é“ git add, git commit , git push ä¹‹å¤–ï¼ŒGit ä¸­è¿˜éœ€è¦å…¶ä»–é‡è¦çš„æŠ€æœ¯éœ€è¦æŒæ¡ã€‚é•¿è¿œæ¥çœ‹å¯¹æˆ‘ä»¬æ˜¯æœ‰å¸®åŠ©çš„ã€‚è¿™é‡Œæˆ‘å°†å‘ä½ å±•ç¤º Git çš„æœ€ä½³å®è·µã€‚ Git å·¥ä½œæµå½“æœ‰å¤šä¸ªå¼€å‘è€…åŒæ—¶æ¶‰åŠåˆ°ä¸€ä¸ªé¡¹ç›®æ—¶é‚£ä¹ˆå°±éå¸¸æœ‰å¿…è¦æ­£ç¡®ä½¿ç”¨ Git å·¥ä½œæµã€‚ è¿™é‡Œæˆ‘å°†ä»‹ç»ä¸€ç§å·¥ä½œæµï¼Œå®ƒåœ¨ä¸€ä¸ªå¤šäººå¤§å‹é¡¹ç›®ä¸­å°†éå¸¸æœ‰ç”¨ã€‚ å‰è¨€çªç„¶æœ‰ä¸€å¤©ï¼Œä½ æˆä¸ºäº†ä¸€ä¸ªé¡¹ç›®çš„æŠ€æœ¯ Leader å¹¶è®¡åˆ’åšå‡ºä¸‹ä¸€ä¸ª Facebookã€‚åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ä½ æœ‰ä¸‰ä¸ªå¼€å‘äººå‘˜ã€‚ Aliceï¼šä¸€ä¸ªå¼€å‘å°ç™½ã€‚ Bobï¼šæ‹¥æœ‰ä¸€å¹´å·¥ä½œç»éªŒï¼Œäº†è§£åŸºæœ¬å¼€å‘ã€‚ Johnï¼šä¸‰å¹´å¼€å‘ç»éªŒï¼Œç†Ÿç»ƒå¼€å‘æŠ€èƒ½ã€‚ ä½ ï¼šè¯¥é¡¹ç›®çš„æŠ€æœ¯è´Ÿè´£äººã€‚ Git å¼€å‘æµç¨‹Master åˆ†æ”¯ Master åˆ†æ”¯åº”è¯¥å§‹ç»ˆå’Œç”Ÿäº§ç¯å¢ƒä¿æŒä¸€è‡´ã€‚ ç”±äº master å’Œç”Ÿäº§ä»£ç æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥æ²¡æœ‰äººåŒ…æ‹¬æŠ€æœ¯è´Ÿè´£äººèƒ½åœ¨ master ä¸Šç›´æ¥å¼€å‘ã€‚ çœŸæ­£çš„å¼€å‘ä»£ç åº”å½“å†™åœ¨å…¶ä»–åˆ†æ”¯ä¸Šã€‚ Release(å‘å¸ƒ) åˆ†æ”¯ å½“é¡¹ç›®å¼€å§‹æ—¶ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯åˆ›å»ºå‘å¸ƒåˆ†æ”¯ã€‚å‘å¸ƒåˆ†æ”¯æ˜¯åŸºäº master åˆ†æ”¯åˆ›å»ºè€Œæ¥ã€‚ æ‰€æœ‰ä¸æœ¬é¡¹ç›®ç›¸å…³çš„ä»£ç éƒ½åœ¨å‘å¸ƒåˆ†æ”¯ä¸­ï¼Œè¿™ä¸ªåˆ†æ”¯ä¹Ÿæ˜¯ä¸€ä¸ªä»¥ release/ å¼€å¤´çš„æ™®é€šåˆ†æ”¯ã€‚ æ¯”å¦‚è¿™æ¬¡çš„å‘å¸ƒåˆ†æ”¯åä¸º release/fbã€‚ å¯èƒ½æœ‰å¤šä¸ªé¡¹ç›®éƒ½åŸºäºåŒä¸€ä»½ä»£ç è¿è¡Œï¼Œå› æ­¤å¯¹äºæ¯ä¸€ä¸ªé¡¹ç›®æ¥è¯´éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„å‘å¸ƒåˆ†æ”¯ã€‚å‡è®¾ç°åœ¨è¿˜æœ‰ä¸€ä¸ªé¡¹ç›®æ­£åœ¨å¹¶è¡Œè¿è¡Œï¼Œé‚£å°±å¾—ä¸ºè¿™ä¸ªé¡¹ç›®åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„å‘å¸ƒåˆ†æ”¯æ¯”å¦‚ release/messengerã€‚ éœ€è¦å•ç‹¬çš„å‘å¸ƒåˆ†æ”¯çš„åŸå› æ˜¯ï¼šå¤šä¸ªå¹¶è¡Œé¡¹ç›®æ˜¯åŸºäºåŒä¸€ä»½ä»£ç è¿è¡Œçš„ï¼Œä½†æ˜¯é¡¹ç›®ä¹‹é—´ä¸èƒ½æœ‰å†²çªã€‚ Feature(åŠŸèƒ½åˆ†æ”¯) branch å¯¹äºåº”ç”¨ä¸­çš„æ¯ä¸€ä¸ªåŠŸèƒ½éƒ½åº”è¯¥åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„åŠŸèƒ½åˆ†æ”¯ï¼Œè¿™ä¼šç¡®ä¿è¿™äº›åŠŸèƒ½èƒ½è¢«å•ç‹¬æ„å»ºã€‚ åŠŸèƒ½åˆ†æ”¯ä¹Ÿå’Œå…¶ä»–åˆ†æ”¯ä¸€æ ·ï¼Œåªæ˜¯ä»¥ feature/ å¼€å¤´ã€‚ ç°åœ¨ä½œä¸ºæŠ€æœ¯ Leaderï¼Œä½ è¦æ±‚ Alice å»åš Facebook çš„ç™»å½•é¡µé¢ã€‚å› æ­¤ä»–åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„åŠŸèƒ½åˆ†æ”¯ã€‚æŠŠä»–å‘½åä¸º feature/loginã€‚Alice å°†ä¼šåœ¨è¿™ä¸ªåˆ†æ”¯ä¸Šç¼–å†™æ‰€æœ‰çš„ç™»å½•ä»£ç ã€‚ è¿™ä¸ªåŠŸèƒ½åˆ†æ”¯é€šå¸¸æ˜¯åŸºäº Release(å‘å¸ƒ) åˆ†æ”¯ åˆ›å»ºè€Œæ¥ã€‚ Bob çš„ä»»åŠ¡ä¸ºåˆ›å»ºæ·»åŠ å¥½å‹é¡µé¢ï¼Œå› æ­¤ä»–åˆ›å»ºäº†ä¸€ä¸ªåä¸º feature/friendrequest çš„åŠŸèƒ½åˆ†æ”¯ã€‚ John åˆ™è¢«å®‰æ’æ„å»ºæ¶ˆæ¯æµï¼Œå› æ­¤åˆ›å»ºäº†ä¸€ä¸ª feature/newsfeed çš„åŠŸèƒ½åˆ†æ”¯ã€‚ æ‰€æœ‰çš„å¼€å‘äººå‘˜éƒ½åœ¨è‡ªå·±çš„åˆ†æ”¯ä¸Šè¿›è¡Œå¼€å‘ï¼Œç›®å‰ä¸ºæ­¢éƒ½å¾ˆæ­£å¸¸ã€‚ ç°åœ¨å½“ Alice å®Œæˆäº†ä»–çš„ç™»å½•å¼€å‘ï¼Œä»–éœ€è¦å°†ä»–çš„åŠŸèƒ½åˆ†æ”¯ feature/login å‘é€ç»™ Release(å‘å¸ƒ) åˆ†æ”¯ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡å‘èµ·ä¸€ä¸ª pull request å®Œæˆçš„ã€‚ Pull requesté¦–å…ˆ pull request ä¸èƒ½å’Œ git pull ææ··äº†ã€‚ å¼€å‘äººå‘˜ä¸èƒ½ç›´æ¥å‘ Release(å‘å¸ƒ) åˆ†æ”¯æ¨é€ä»£ç ï¼ŒæŠ€æœ¯ Leader éœ€è¦åœ¨åŠŸèƒ½åˆ†æ”¯åˆå¹¶åˆ° Release(å‘å¸ƒ) åˆ†æ”¯ä¹‹å‰åšå¥½ä»£ç å®¡æŸ¥ã€‚è¿™ä¹Ÿæ˜¯é€šè¿‡ pull request å®Œæˆçš„ã€‚ Alice èƒ½å¤ŸæŒ‰ç…§å¦‚ä¸‹ GitHub æ–¹å¼æäº¤ pull requestã€‚ åœ¨åˆ†æ”¯åå­—çš„æ—è¾¹æœ‰ä¸€ä¸ª â€œNew pull requestâ€ æŒ‰é’®ï¼Œç‚¹å‡»ä¹‹åå°†ä¼šæ˜¾ç¤ºå¦‚ä¸‹ç•Œé¢ï¼š æ¯”è¾ƒåˆ†æ”¯æ˜¯ Alice çš„åŠŸèƒ½åˆ†æ”¯ feature/loginã€‚ base åˆ†æ”¯åˆ™åº”è¯¥æ˜¯å‘å¸ƒåˆ†æ”¯ release/fbã€‚ ç‚¹å‡»ä¹‹å Alice éœ€è¦ä¸ºè¿™ä¸ª pull request è¾“å…¥åç§°å’Œæè¿°ï¼Œæœ€åå†ç‚¹å‡» â€œCreate Pull Requestâ€ æŒ‰é’®ã€‚ åŒæ—¶ Alice éœ€è¦ä¸ºè¿™ä¸ª pull request æŒ‡å®šä¸€ä¸ª reviewerã€‚ä½œä¸ºæŠ€æœ¯ Leader çš„ä½ è¢«é€‰ä¸ºæœ¬æ¬¡ pull request çš„ reviewerã€‚ ä½ å®Œæˆä»£ç å®¡æŸ¥ä¹‹åå°±éœ€è¦æŠŠè¿™ä¸ªåŠŸèƒ½åˆ†æ”¯åˆå¹¶åˆ° Release(å‘å¸ƒ) åˆ†æ”¯ã€‚ ç°åœ¨ä½ å·²ç»æŠŠ feature/login åˆ†æ”¯åˆå¹¶åˆ° release/fbï¼Œå¹¶ä¸” Alice éå¸¸é«˜å…´ä»–çš„ä»£ç è¢«åˆå¹¶äº†ã€‚ ä»£ç å†²çª ğŸ˜  Bob å®Œæˆäº†ä»–çš„ç¼–ç å·¥ä½œï¼ŒåŒæ—¶å‘ release/fb åˆ†æ”¯å‘èµ·äº†ä¸€ä¸ª pull requestã€‚ å› ä¸ºå‘å¸ƒåˆ†æ”¯å·²ç»åˆå¹¶äº†ç™»å½•çš„ä»£ç ï¼Œè¿™æ—¶ä»£ç å†²çªå‘ç”Ÿäº†ã€‚è§£å†³å†²çªå’Œåˆå¹¶ä»£ç æ˜¯ reviewer çš„è´£ä»»ã€‚åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œä½œä¸ºæŠ€æœ¯ Leader å°±éœ€è¦è§£å†³å†²çªå’Œåˆå¹¶ä»£ç äº†ã€‚ ç°åœ¨ John ä¹Ÿå·²ç»å®Œæˆäº†ä»–çš„å¼€å‘ï¼ŒåŒæ—¶ä¹Ÿæƒ³æŠŠä»£ç åˆå¹¶åˆ°å‘å¸ƒåˆ†æ”¯ã€‚ä½† John éå¸¸æ“…é•¿äºè§£å†³ä»£ç å†²çªã€‚ä»–å°† release/fb ä¸Šæœ€æ–°çš„ä»£ç åˆå¹¶åˆ°ä»–è‡ªå·±çš„åŠŸèƒ½åˆ†æ”¯ feature/newsfeed ï¼ˆé€šè¿‡ git pull æˆ– git merge å‘½ä»¤ï¼‰ã€‚åŒæ—¶ä»–è§£å†³äº†æ‰€æœ‰å­˜åœ¨çš„å†²çªï¼Œç°åœ¨ feature/newsfeed å·²ç»æœ‰äº†æ‰€æœ‰å‘å¸ƒåˆ†æ”¯ release/fb çš„ä»£ç ã€‚ æœ€å John åˆ›å»ºäº†ä¸€ä¸ª pull requestï¼Œç”±äº John å·²ç»è§£å†³äº†æ‰€æœ‰é—®é¢˜ï¼Œæ‰€ä»¥æœ¬æ¬¡ pull request ä¸ä¼šå†æœ‰å†²çªäº†ã€‚ å› æ­¤é€šå¸¸æœ‰ä¸¤ç§æ–¹å¼æ¥è§£å†³ä»£ç å†²çªï¼š pull request çš„ reviewer éœ€è¦è§£å†³æ‰€æœ‰çš„ä»£ç å†²çªã€‚ å¼€å‘äººå‘˜éœ€è¦ç¡®ä¿å°†å‘å¸ƒåˆ†æ”¯çš„æœ€æ–°ä»£ç åˆå¹¶åˆ°åŠŸèƒ½åˆ†æ”¯ï¼Œå¹¶ä¸”è§£å†³æ‰€æœ‰çš„å†²çªã€‚ è¿˜æ˜¯ Master åˆ†æ”¯ä¸€æ—¦é¡¹ç›®å®Œæˆï¼Œå‘å¸ƒåˆ†æ”¯çš„ä»£ç éœ€è¦åˆå¹¶å› master åˆ†æ”¯ï¼ŒåŒæ—¶éœ€è¦å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒã€‚ å› æ­¤ç”Ÿäº§ç¯å¢ƒä¸­çš„ä»£ç æ€»æ˜¯å’Œ master åˆ†æ”¯ä¿æŒä¸€è‡´ã€‚åŒæ—¶å¯¹äºä»Šåçš„ä»»ä½•é¡¹ç›®æ¥è¯´éƒ½æ˜¯è¦ç¡®ä¿ master ä»£ç æ˜¯æœ€æ–°çš„ã€‚ æˆ‘ä»¬ç°åœ¨å›¢é˜Ÿå°±æ˜¯æŒ‰ç…§è¿™æ ·çš„æ–¹å¼è¿›è¡Œå¼€å‘ï¼Œç¡®å®å¯ä»¥å°½å¯èƒ½çš„å‡å°‘ä»£ç ç®¡ç†ä¸Šçš„é—®é¢˜ã€‚ é¢˜å¤–è¯åƒä¹‹å‰é‚£ç¯‡ã€Šå¦‚ä½•æˆä¸ºä¸€ä½ã€Œä¸é‚£ä¹ˆå·®ã€çš„ç¨‹åºå‘˜ã€‹è¯´çš„é‚£æ ·ï¼Œå»ºè®®å¤§å®¶éƒ½å¤šçœ‹çœ‹å›½å¤–çš„ä¼˜è´¨åšå®¢ã€‚ ç”šè‡³å°è¯•å’Œä½œè€…äº¤æµï¼Œç»è¿‡æ²Ÿé€šåŸä½œè€…ä¹Ÿä¼šåœ¨åŸæ–‡ä¸­è´´ä¸Šæˆ‘çš„ç¿»è¯‘é“¾æ¥ã€‚å¤§å®¶äº’æƒ äº’åˆ©ä½¿å¥½çš„æ–‡ç« è½¬æ’­çš„æ›´å¹¿ã€‚ ä½ çš„ç‚¹èµä¸è½¬å‘æ˜¯æœ€å¤§çš„æ”¯æŒã€‚]]></content>
      <categories>
        <category>ç¿»è¯‘</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€Œé€ ä¸ªè½®å­ã€â€”â€”cicada æºç åˆ†æ]]></title>
    <url>%2F2018%2F09%2F05%2Fwheel%2Fcicada2%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¸¤å¤©å‰å†™äº†æ–‡ç« ã€Šã€Œé€ ä¸ªè½®å­ã€â€”â€”cicada(è½»é‡çº§ WEB æ¡†æ¶)ã€‹ å‘å¤§å®¶ä»‹ç»äº† cicada ä¹‹åæ”¶åˆ°å¾ˆå¤šåé¦ˆï¼Œä¹Ÿæœ‰è®¸å¤šä¸é”™çš„å»ºè®®ã€‚ åŒæ—¶åœ¨ GitHub ä¹Ÿæ”¶è·äº† 100 å¤šé¢— å°â™¥â™¥ï¼ˆç»å¯¹ä¸æ˜¯åˆ·çš„ã€‚ã€‚ï¼‰ ä¹Ÿæœ‰æœ‹å‹å¸Œæœ›èƒ½å‡ºä¸€ä¸ªæºç ä»‹ç»ï¼Œæœ¬æ–‡å°±ç›®å‰çš„ v1.0.1 ç‰ˆæœ¬æ¥ä¸€èµ·åˆ†æåˆ†æã€‚ æ²¡æœ‰çœ‹é”™ï¼Œåˆšå‘å¸ƒå°±ä¿®å¤äº†ä¸€ä¸ª bugï¼Œæƒ³è¦è¯•ç”¨çš„è¯·å‡çº§åˆ° 1.0.1 å§ã€‚ æŠ€æœ¯é€‰å‹ä¸€èˆ¬åœ¨åšä¸€ä¸ªæ–°ç©æ„ä¹‹å‰éƒ½ä¼šæœ‰æŠ€æœ¯é€‰å‹çš„è¿‡ç¨‹ï¼Œä½†è¿™ç‚¹åœ¨åš cicada çš„æ—¶å€™å´å¼‚å¸¸ç®€å•ã€‚ å› ä¸ºæˆ‘çš„éœ€æ±‚æ˜¯æƒ³æä¾›ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP æœåŠ¡ï¼Œçºµè§‚æ•´ä¸ªå¼€æºç•Œå…¶å®é€‰æ‹©ä¸å¤šã€‚ åŠ ä¸Šæœ€è¿‘æˆ‘åœ¨åš Netty ç›¸å…³çš„å¼€å‘ï¼Œæ‰€ä»¥è‡ªç„¶è€Œç„¶å°±é€‰æ‹©äº†å®ƒã€‚ åŒæ—¶ Netty è‡ªå¸¦äº†å¯¹ HTTP åè®®çš„ç¼–è§£ç å™¨ï¼Œå¯ä»¥éå¸¸ç®€å•å¿«é€Ÿçš„å¼€å‘ä¸€ä¸ª HTTP æœåŠ¡å™¨ã€‚æˆ‘åªéœ€è¦æŠŠç²¾åŠ›æ”¾åœ¨å‚æ•°å¤„ç†ã€è·¯ç”±ç­‰ä¸šåŠ¡å¤„ç†ä¸Šå³å¯ã€‚ åŒæ—¶ Netty ä¹Ÿæ˜¯åŸºäº NIO å®ç°ï¼Œæ€§èƒ½ä¸Šä¹Ÿæœ‰ä¿è¯ã€‚å…³äº Netty ç›¸å…³å†…å®¹å¯ä»¥å‚è€ƒè¿™é‡Œã€‚ ä¸‹é¢æ¥é‡ç‚¹åˆ†æå…¶ä¸­çš„å„ä¸ªè¿‡ç¨‹ã€‚ è·¯ç”±è§„åˆ™æœ€æ ¸å¿ƒçš„è‡ªç„¶å°±æ˜¯ HTTP çš„å¤„ç† handleï¼Œå¯¹åº”çš„å°±æ˜¯ HttpHandle ç±»ã€‚ æŸ¥çœ‹æºç å…¶å®å¾ˆå®¹æ˜“çœ‹å‡ºå…·ä½“çš„æ­¥éª¤ï¼Œæ³¨é‡Šä¹Ÿå¾ˆæ˜æ˜¾ã€‚ è¿™é‡Œåªåˆ†æé‡ç‚¹åŠŸèƒ½ã€‚ å…ˆæ¥è€ƒè™‘ä¸‹éœ€æ±‚ã€‚ é¦–å…ˆä½œä¸ºä¸€ä¸ª HTTP æ¡†æ¶ï¼Œè‡ªç„¶æ˜¯å¾—è®©ä½¿ç”¨è€…èƒ½æœ‰åœ°æ–¹æ¥å®ç°ä¸šåŠ¡ä»£ç ï¼›å°±åƒå’±ä»¬ç°åœ¨ä½¿ç”¨ SpringMVC æ—¶å†™çš„ controller ä¸€æ ·ã€‚ å…¶å®å½“æ—¶è€ƒè™‘è¿‡ä¸‰ç§æ–¹æ¡ˆï¼š åƒ SpringMVC ä¸€æ ·å®šä¹‰æ³¨è§£ï¼Œåªè¦å£°æ˜äº†å¯¹åº”æ³¨è§£æˆ‘å°±è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªä¸šåŠ¡ç±»ã€‚ ç”¨è¿‡ Struts2 çš„åŒå­¦åº”è¯¥æœ‰å°è±¡ï¼Œå®ƒçš„ä¸šåŠ¡ç±» Action éƒ½æ˜¯é…ç½®åˆ°ä¸€ä¸ª XML ä¸­ï¼›åœ¨é‡Œé¢é…ç½®æ¥å£å¯¹åº”çš„ä¸šåŠ¡å¤„ç†ç±»ã€‚ åŒæ ·çš„æ€è·¯ï¼Œåªæ˜¯æŠŠ XML æ–‡ä»¶æ¢æˆ properties é…ç½®æ–‡ä»¶ï¼Œåœ¨é‡Œé¢ç¼–å†™ JSON æ ¼å¼çš„å¯¹åº”å…³ç³»ã€‚ è¿™æ—¶å°±å¾—åˆ†æå„ä¸ªæ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹äº†ã€‚ æ–¹æ¡ˆäºŒå’Œä¸‰å…¶å®å°±æ˜¯ XML å’Œ json çš„å¯¹æ¯”äº†ï¼›XML ä¼šè®©ç»´æŠ¤è€…æ„Ÿåˆ°ç»“æ„æ¸…æ™°ï¼ŒåŒæ—¶ä¾¿äºç»´æŠ¤å’Œæ–°å¢ã€‚ JSON å°±ä¸å¤ªæ–¹ä¾¿å¤„ç†äº†ï¼Œå¹¶ä¸”åœ¨è¿™æ ·çš„åœºæ™¯å¹¶ä¸ç”¨äºä¼ è¾“è‡ªç„¶ä¹Ÿå‘æŒ¥ä¸å‡ºä¼˜åŠ¿ã€‚ æœ€åè€ƒè™‘åˆ°ç°åœ¨æµè¡Œçš„ SpringBoot éƒ½åœ¨å» XMLï¼Œè¦æ˜¯å†æä¸€ä¸ªä¾èµ–äº XML çš„ä¸œè¥¿ä¹Ÿè·Ÿä¸ä¸Šå¤§å®¶çš„ä½¿ç”¨ä¹ æƒ¯ã€‚ äºæ˜¯å°±é‡‡ç”¨ç±»ä¼¼äº SpringMVC è¿™æ ·çš„æ³¨è§£å½¢å¼ã€‚ æ—¢ç„¶é‡‡ç”¨äº†æ³¨è§£ï¼Œé‚£æ¡†æ¶æ€ä¹ˆçŸ¥é“ç”¨æˆ·è®¿é—®æŸä¸ªæ¥å£æ—¶èƒ½å¯¹åº”åˆ°ä¸šåŠ¡ç±»å‘¢ï¼Ÿ æ‰€ä»¥é¦–å…ˆç¬¬ä¸€æ­¥è‡ªç„¶æ˜¯éœ€è¦å°†åŠ æœ‰æ³¨è§£çš„ç±»å…¨éƒ¨æ‰«æä¸€éï¼Œæ”¾åˆ°ä¸€ä¸ªæœ¬åœ°ç¼“å­˜ä¸­ã€‚ è¿™æ ·æ‰èƒ½æ–¹ä¾¿åç»­çš„è·¯ç”±å®šä½ã€‚ è·¯ç”±ç­–ç•¥å…¶ä¸­æ ¸å¿ƒçš„æºç åœ¨ routeAction æ–¹æ³•ä¸­ã€‚ é¦–å…ˆä¼šå…¨å±€æ‰«æä½¿ç”¨äº† @CicadaAction çš„æ³¨è§£ï¼Œç„¶åå†æ ¹æ®è¯·æ±‚åœ°å€æ‰¾åˆ°å¯¹åº”çš„ä¸šåŠ¡ç±»ã€‚ å…¨å±€æ‰«æä»£ç ï¼š é¦–å…ˆæ˜¯è·å–åˆ°é¡¹ç›®ä¸­è‡ªå®šä¹‰çš„æ‰€æœ‰ç±»ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦åŠ æœ‰ @CicadaAction æ³¨è§£ã€‚ æ˜¯ç›®æ ‡ç±»åˆ™æŠŠä»–ç¼“å­˜åˆ°ä¸€ä¸ªæœ¬åœ° Map ä¸­ï¼Œæ–¹ä¾¿ä¸‹æ¬¡è®¿é—®æ—¶å¯ä»¥ä¸å†æ‰«æç›´æ¥ä»ç¼“å­˜ä¸­è·å–å³å¯ï¼ˆåå°„å¾ˆè€—æ€§èƒ½ï¼‰ã€‚ æ‰§è¡Œå®Œ routeAction åä¼šè·å¾—çœŸæ­£çš„ä¸šåŠ¡ç±»ç±»å‹ã€‚ Class&lt;?&gt; actionClazz = routeAction(queryStringDecoder, appConfig); ä¼ å‚æ–¹å¼æ‹¿åˆ°ä¸šåŠ¡ç±»çš„ç±»ç±»å‹ä¹‹åå°±æˆåŠŸä¸€å¤§åŠäº†ï¼Œåªéœ€è¦åå°„ç”Ÿæˆå®ƒçš„å¯¹è±¡ç„¶åæ‰§è¡Œæ–¹æ³•å³å¯ã€‚ åœ¨æ‰§è¡Œæ–¹æ³•ä¹‹å‰åˆè¦æ¶‰åŠåˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå‚æ•°æˆ‘è¯¥æ€ä¹ˆä¼ é€’å‘¢ï¼Ÿ è€ƒè™‘åˆ°çµæ´»æ€§æˆ‘é‡‡ç”¨äº†æœ€ç®€ç­” Map æ–¹å¼ã€‚ å› æ­¤å®šä¹‰äº†ä¸€ä¸ªé€šç”¨çš„ Param æ¥å£å¹¶ç»§æ‰¿äº† Map æ¥å£ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344public interface Param extends Map&lt;String, Object&gt; &#123; /** * get String * @param param * @return */ String getString(String param); /** * get Integer * @param param * @return */ Integer getInteger(String param); /** * get Long * @param param * @return */ Long getLong(String param); /** * get Double * @param param * @return */ Double getDouble(String param); /** * get Float * @param param * @return */ Float getFloat(String param); /** * get Boolean * @param param * @return */ Boolean getBoolean(String param) ;&#125; å…¶ä¸­å°è£…äº†å‡ ç§åŸºæœ¬ç±»å‹çš„è·å–æ–¹å¼ã€‚ åŒæ—¶åœ¨ buildParamMap() æ–¹æ³•ä¸­ï¼Œå°†æ¥å£ä¸­çš„å‚æ•°å°è£…åˆ°è¿™ä¸ª Map ä¸­ã€‚ 1Param paramMap = buildParamMap(queryStringDecoder); ä¸šåŠ¡æ‰§è¡Œæœ€ååªéœ€è¦æ‰§è¡Œä¸šåŠ¡å³å¯ï¼›ç”±äºåœ¨ä¸Šæ–‡å·²ç»è·å–åˆ°ä¸šåŠ¡ç±»çš„ç±»ç±»å‹ï¼Œæ‰€ä»¥è¿™é‡Œé€šè¿‡åå°„å³å¯è°ƒç”¨ã€‚ åŒæ—¶ä¹Ÿå®šä¹‰äº†ä¸€ä¸ªä¸šåŠ¡ç±»éœ€è¦å®ç°çš„ä¸€ä¸ªé€šç”¨æ¥å£ WorkActionï¼Œæƒ³è¦å®ç°å…·ä½“ä¸šåŠ¡åªè¦å®ç°å®ƒå°±è¡Œã€‚ è€Œè¿™é‡Œçš„æ–¹æ³•å‚æ•°è‡ªç„¶å°±æ˜¯åˆšæ‰å®šä¹‰çš„å‚æ•°æ¥å£ Paramã€‚ ç”±äºæ‰€æœ‰çš„ä¸šåŠ¡ç±»éƒ½æ˜¯å®ç°äº† WorkActionï¼Œæ‰€ä»¥åœ¨åå°„æ—¶éƒ½å¯ä»¥å®šä¹‰ä¸º WorkAction å¯¹è±¡ã€‚ 12WorkAction action = (WorkAction) actionClazz.newInstance();WorkRes execute = action.execute(paramMap); æœ€åå°†æ„å»ºå¥½çš„å‚æ•° map ä¼ å…¥å³å¯ã€‚ å“åº”è¿”å›æœ‰äº†è¯·æ±‚é‚£è‡ªç„¶ä¹Ÿå¾—æœ‰å“åº”ï¼Œè§‚å¯Ÿåˆšæ‰å®šä¹‰çš„ WorkAction æ¥å£å¯ä»¥å‘ç°å…¶å®å®šä¹‰äº†ä¸€ä¸ª WorkRes å“åº”ç±»ã€‚ æ‰€æœ‰çš„å“åº”æ•°æ®éƒ½éœ€è¦å°è£…åˆ°è¿™ä¸ªå¯¹è±¡ä¸­ã€‚ è¿™ä¸ªæ²¡å•¥å¥½è¯´çš„ï¼Œéƒ½æ˜¯ä¸€äº›åŸºæœ¬æ•°æ®ã€‚ æœ€ååœ¨ responseMsg() æ–¹æ³•ä¸­å°†å“åº”æ•°æ®ç¼–ç ä¸º JSON è¾“å‡ºå³å¯ã€‚ æ‹¦æˆªå™¨è®¾è®¡æ‹¦æˆªå™¨ä¹Ÿæ˜¯ä¸€ä¸ªæ¡†æ¶åŸºæœ¬çš„åŠŸèƒ½ï¼Œç”¨å¤„éå¸¸å¤šã€‚ cicada çš„å®ç°åŸç†éå¸¸ç®€å•ï¼Œå°±æ˜¯åœ¨ WorkAction æ¥å£æ‰§è¡Œä¸šåŠ¡é€»è¾‘ä¹‹å‰è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ã€æ‰§è¡Œå®Œæ¯•ä¹‹åè°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³•ã€‚ ä¹Ÿæ˜¯åŒæ ·çš„æ€è·¯éœ€è¦å®šä¹‰ä¸€ä¸ªæ¥å£ CicadaInterceptorï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªæ–¹æ³•ã€‚ çœ‹æ–¹æ³•åå­—è‡ªç„¶ä¹Ÿèƒ½çœ‹å‡ºå…·ä½“ä½œç”¨ã€‚ åŒæ—¶åœ¨è¿™ä¸¤ä¸ªæ–¹æ³•ä¸­æ‰§è¡Œå…·ä½“çš„è°ƒç”¨ã€‚ è¿™é‡Œé‡ç‚¹è¦çœ‹çœ‹ interceptorBefore æ–¹æ³•ã€‚ å…¶ä¸­ä¹Ÿæ˜¯åŠ å…¥äº†ä¸€ä¸ªç¼“å­˜ï¼Œå°½é‡çš„å‡å°‘åå°„æ“ä½œã€‚ é€‚é…å™¨å°±è¿™æ ·çš„æ‹¦æˆªå™¨æ¥å£æ˜¯å¤Ÿç”¨äº†ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„ä¸šåŠ¡éƒ½éœ€è¦å®ç°ä¸¤ä¸ªæ¥å£ã€‚ å› æ­¤ä¹Ÿæä¾›äº†ä¸€ä¸ªé€‚é…å™¨ AbstractCicadaInterceptorAdapterã€‚ å®ƒä½œä¸ºä¸€ä¸ªæŠ½è±¡ç±»å®ç°äº† CicadaInterceptor æ¥å£ï¼Œè¿™æ ·åç»­çš„æ‹¦æˆªä¸šåŠ¡ä¹Ÿå¯ç»§æ‰¿è¯¥æ¥å£é€‰æ‹©æ€§çš„å®ç°æ–¹æ³•å³å¯ã€‚ ç±»ä¼¼äºè¿™æ ·ï¼š æ€»ç»“v1.0.1 ç‰ˆæœ¬çš„ cicada å°±ä»‹ç»å®Œæ¯•äº†ï¼Œå…¶ä¸­çš„åŸç†å’Œæºç éƒ½æ¯”è¾ƒç®€å•ã€‚ å¤§é‡ä½¿ç”¨äº†åå°„å’Œä¸€äº›è®¾è®¡æ¨¡å¼ã€å¤šæ€ç­‰åº”ç”¨ï¼Œè¿™æ–¹é¢ç»éªŒè¾ƒå°‘çš„æœ‹å‹å¯ä»¥å‚è€ƒä¸‹ã€‚ åŒæ—¶ä¹Ÿæœ‰å¾ˆå¤šä¸è¶³ï¼›æ¯”å¦‚ä¼ å‚åç»­ä¼šè€ƒè™‘æ›´åŠ ä¼˜é›…çš„æ–¹å¼ã€æ‹¦æˆªå™¨ç›®å‰å†™çš„æ¯”è¾ƒæ­»ï¼Œåç»­ä¼šåˆ©ç”¨åŠ¨æ€ä»£ç†å®ç°è‡ªå®šä¹‰æ‹¦æˆªã€‚ å…¶å® cicada åªæ˜¯åˆ©ç”¨å‘¨æœ«ä¸¤å¤©æ—¶é—´åšçš„ï¼Œbug è‚¯å®šå°‘ä¸äº†ï¼›ä¹Ÿæ¬¢è¿å¤§å®¶åœ¨ GitHub ä¸Šæ issue å‚ä¸ã€‚ æœ€åè´´ä¸‹é¡¹ç›®åœ°å€ï¼š https://github.com/TogetherOS/cicada ä½ çš„ç‚¹èµä¸è½¬å‘æ˜¯æœ€å¤§çš„æ”¯æŒã€‚]]></content>
      <categories>
        <category>cicada</category>
        <category>è½®å­</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>HTTP</tag>
        <tag>Netty</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€Œé€ ä¸ªè½®å­ã€â€”â€”cicada(è½»é‡çº§ WEB æ¡†æ¶)]]></title>
    <url>%2F2018%2F09%2F03%2Fwheel%2Fcicada1%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¿—è¯è¯´ ã€Œä¸è¦é‡å¤é€ è½®å­ã€ï¼Œå…³äºæ˜¯å¦æœ‰å¿…è¦ä¸å†æœ¬æ¬¡è®¨è®ºèŒƒå›´ã€‚ åˆ›å»ºè¿™ä¸ªé¡¹ç›®çš„ä¸»è¦ç›®çš„è¿˜æ˜¯æå‡è‡ªå·±ï¼Œçœ‹çœ‹å’ŒçŸ¥åç±»å¼€æºé¡¹ç›®çš„å·®è·ä»¥åŠå­¦ä¹ ä¼˜ç§€çš„å¼€æºæ–¹å¼ã€‚ å¥½äº†ï¼Œç°åœ¨ç€é‡æ¥è°ˆè°ˆ cicada è¿™ä¸ªé¡¹ç›®çš„æ ¸å¿ƒåŠŸèƒ½ã€‚ æˆ‘æŠŠä»–å®šä¹‰ä¸ºä¸€ä¸ªå¿«é€Ÿã€è½»é‡çº§ WEB æ¡†æ¶ï¼›æ²¡æœ‰è¿‡å¤šçš„ä¾èµ–ï¼Œæ ¸å¿ƒ jar åŒ…ä»… 30KBã€‚ ä¹Ÿä»…éœ€è¦ä¸€è¡Œä»£ç å³å¯å¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡ã€‚ ç‰¹æ€§ç°åœ¨æ¥è°ˆè°ˆé‡è¦çš„å‡ ä¸ªç‰¹æ€§ã€‚ å½“å‰ç‰ˆæœ¬ä¸»è¦å®ç°äº†åŸºæœ¬çš„è¯·æ±‚ã€å“åº”ã€è‡ªå®šä¹‰å‚æ•°ä»¥åŠæ‹¦æˆªå™¨åŠŸèƒ½ã€‚ åŠŸèƒ½è™½å°‘ï¼Œä½†äº”è„ä¿±å…¨ã€‚ åœ¨ä»Šåçš„è¿­ä»£è¿‡ç¨‹ä¸­ä¼šé€æ¸å®Œå–„ä¸Šå›¾åŠŸèƒ½ï¼Œæœ‰å¥½çš„æƒ³æ³•ä¹Ÿæ¬¢è¿æ https://github.com/crossoverJie/cicada/issuesã€‚ å¿«é€Ÿå¯åŠ¨ä¸‹é¢æ¥çœ‹çœ‹å¦‚ä½•å¿«é€Ÿå¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡ã€‚ åªéœ€è¦åˆ›å»ºä¸€ä¸ª Maven é¡¹ç›®ï¼Œå¹¶å¼•å…¥æ ¸å¿ƒåŒ…ã€‚ 12345&lt;dependency&gt; &lt;groupId&gt;top.crossoverjie.opensource&lt;/groupId&gt; &lt;artifactId&gt;cicada-core&lt;/artifactId&gt; &lt;version&gt;1.0.1&lt;/version&gt;&lt;/dependency&gt; å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå†é…ç½®ä¸€ä¸ªå¯åŠ¨ç±»å³å¯ã€‚ 123456public class MainStart &#123; public static void main(String[] args) throws InterruptedException &#123; CicadaServer.start(MainStart.class,"/cicada-example") ; &#125;&#125; é…ç½®ä¸šåŠ¡ Actionå½“ç„¶æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªå®ç°ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹ã€‚cicada æä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œåªéœ€è¦å®ç°è¯¥æ¥å£å³å¯å®ç°å…·ä½“é€»è¾‘ã€‚ åˆ›å»ºä¸šåŠ¡ Action å®ç° top.crossoverjie.cicada.server.action.WorkAction æ¥å£ã€‚ 123456789101112131415161718192021222324@CicadaAction(value = "demoAction")public class DemoAction implements WorkAction &#123; private static final Logger LOGGER = LoggerBuilder.getLogger(DemoAction.class) ; private static AtomicLong index = new AtomicLong() ; @Override public WorkRes&lt;DemoResVO&gt; execute(Param paramMap) throws Exception &#123; String name = paramMap.getString("name"); Integer id = paramMap.getInteger("id"); LOGGER.info("name=[&#123;&#125;],id=[&#123;&#125;]" , name,id); DemoResVO demoResVO = new DemoResVO() ; demoResVO.setIndex(index.incrementAndGet()); WorkRes&lt;DemoResVO&gt; res = new WorkRes(); res.setCode(StatusEnum.SUCCESS.getCode()); res.setMessage(StatusEnum.SUCCESS.getMessage()); res.setDataBody(demoResVO) ; return res; &#125;&#125; åŒæ—¶éœ€è¦å†è‡ªå®šä¹‰ç±»ä¸­åŠ ä¸Š @CicadaAction æ³¨è§£ï¼Œå¹¶éœ€è¦æŒ‡å®šä¸€ä¸ª valueï¼Œè¯¥ value ä¸»è¦æ˜¯ä¸ºäº†åœ¨è¯·æ±‚è·¯ç”±æ—¶èƒ½æ‰¾åˆ°ä¸šåŠ¡ç±»ã€‚ è¿™æ ·å¯åŠ¨åº”ç”¨å¹¶è®¿é—® http://127.0.0.1:7317/cicada-example/demoAction?name=12345&amp;id=10 ä¾¿èƒ½æ‰§è¡Œä¸šåŠ¡é€»è¾‘åŒæ—¶å¾—åˆ°æœåŠ¡ç«¯çš„è¿”å›ã€‚ ç›®å‰é»˜è®¤æ”¯æŒçš„æ˜¯ json å“åº”ï¼ŒåæœŸä¹Ÿä¼šåŠ ä¸Šæ¨¡æ¿è§£æã€‚ æœåŠ¡ä¸­ä¹Ÿä¼šæ‰“å°ç›¸å…³æ—¥å¿—ã€‚ çµæ´»çš„å‚æ•°é…ç½®è¿™é‡Œæ‰€æœ‰çš„è¯·æ±‚å‚æ•°éƒ½å°è£…åœ¨ Param ä¸­ï¼Œå¯ä»¥åˆ©ç”¨å…¶ä¸­çš„å„ç§ API è·å–è¯·æ±‚æ•°æ®ã€‚ ä¹‹æ‰€ä»¥æ˜¯çµæ´»çš„ï¼šæˆ‘ä»¬ç”šè‡³å¯ä»¥è¿™æ ·è¯·æ±‚ï¼š 1234http://127.0.0.1:7317/cicada-example/demoAction?jsonData=&quot;info&quot;: &#123; &quot;age&quot;: 22, &quot;name&quot;: &quot;zhangsan&quot; &#125; è¿™æ ·å°±å¯ä»¥ä¼ é€’ä»»æ„ç»“æ„çš„æ•°æ®ï¼Œåªè¦ä¸šåŠ¡å¤„ç†æ—¶è¿›è¡Œè§£æå³å¯ã€‚ è‡ªå®šä¹‰æ‹¦æˆªå™¨æ‹¦æˆªå™¨æ˜¯ä¸€ä¸ªæ¡†æ¶çš„åŸºæœ¬åŠŸèƒ½ï¼Œå¯ä»¥åˆ©ç”¨æ‹¦æˆªå™¨å®ç°æ—¥å¿—è®°å½•ã€äº‹åŠ¡æäº¤ç­‰é€šç”¨å·¥ä½œã€‚ ä¸ºæ­¤ cicada æä¾›ä¸€ä¸ªæ¥å£: top.crossoverjie.cicada.server.intercept.CicadaInterceptorã€‚ æˆ‘ä»¬åªéœ€è¦å®ç°è¯¥æ¥å£å³å¯ç¼–å†™æ‹¦æˆªåŠŸèƒ½ï¼š 123456789101112131415161718192021@Interceptor(value = "executeTimeInterceptor")public class ExecuteTimeInterceptor implements CicadaInterceptor &#123; private static final Logger LOGGER = LoggerBuilder.getLogger(ExecuteTimeInterceptor.class); private Long start; private Long end; @Override public void before(Param param) &#123; start = System.currentTimeMillis(); &#125; @Override public void after(Param param) &#123; end = System.currentTimeMillis(); LOGGER.info("cast [&#123;&#125;] times", end - start); &#125;&#125; è¿™é‡Œæ¼”ç¤ºçš„æ˜¯è®°å½•æ‰€æœ‰ action çš„æ‰§è¡Œæ—¶é—´ã€‚ ç›®å‰é»˜è®¤åªå®ç°äº† action çš„æ‹¦æˆªï¼ŒåæœŸä¹Ÿä¼šåŠ å…¥è‡ªå®šä¹‰æ‹¦æˆªå™¨ã€‚ æ‹¦æˆªé€‚é…å™¨è™½è¯´åœ¨æ‹¦æˆªå™¨ä¸­æä¾›äº† before/after ä¸¤ä¸ªæ–¹æ³•ï¼Œä½†ä¹Ÿä¸æ˜¯æ‰€æœ‰çš„æ–¹æ³•éƒ½éœ€è¦å®ç°ã€‚ å› æ­¤ cicada æä¾›äº†ä¸€ä¸ªé€‚é…å™¨ï¼š top.crossoverjie.cicada.server.intercept.AbstractCicadaInterceptorAdapter æˆ‘ä»¬éœ€è¦ç»§æ‰¿ä»–ä¾¿å¯æŒ‰éœ€å®ç°å…¶ä¸­çš„æŸä¸ªæ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011@Interceptor(value = "loggerInterceptor")public class LoggerInterceptorAbstract extends AbstractCicadaInterceptorAdapter &#123; private static final Logger LOGGER = LoggerBuilder.getLogger(LoggerInterceptorAbstract.class) ; @Override public void before(Param param) &#123; LOGGER.info("logger param=[&#123;&#125;]",param.toString()); &#125;&#125; æ€§èƒ½æµ‹è¯•æ—¢ç„¶æ˜¯ä¸€ä¸ª HTTP æœåŠ¡æ¡†æ¶ï¼Œé‚£æ€§èƒ½è‡ªç„¶ä¹Ÿå¾—ä¿è¯ã€‚ åœ¨æµ‹è¯•æ¡ä»¶ä¸ºï¼š300 å¹¶å‘è¿ç»­å‹æµ‹ä¸¤è½®ï¼›1G å†…å­˜ã€å•æ ¸ CPUã€1Mbpsã€‚ç”¨ Jmeter å‹æµ‹æƒ…å†µå¦‚ä¸‹ï¼š åŒæ ·çš„æœåŠ¡å™¨ç”¨ Tomcat æ¥å‹æµ‹çœ‹çœ‹ç»“æœã€‚ Tomcat çš„çº¿ç¨‹æ± é…ç½®: 12&lt;Executor name="tomcatThreadPool" namePrefix="consumer-exec-" maxThreads="510" minSpareThreads="10"/&gt; æˆ‘è¿™é‡Œè¯·æ±‚çš„æ˜¯ Tomcat çš„ä¸€ä¸ª doc ç›®å½•ï¼Œè™½è¯´ç»“æœçœ‹ä¼¼ cicada çš„æ€§èƒ½æ¯” Tomcat è¿˜å¼ºã€‚ ä½†å…¶å®è¿™ä¸ªå¯¹æ¯”è¿‡ç¨‹ä¸­çš„å˜é‡å¹¶æ²¡æœ‰å®Œå…¨æ§åˆ¶å¥½ï¼ŒTomcat æ‰€è¿”å›çš„æ˜¯ HTMLï¼Œè€Œ cicada ä»…ä»…è¿”å›äº† jsonï¼Œå½“ç„¶é—®é¢˜ä¹Ÿä¸æ­¢è¿™äº›ã€‚ ä½†è¿˜æ˜¯èƒ½è¯´æ˜ cicada ç›®å‰çš„æ€§èƒ½è¿˜æ˜¯ä¸é”™çš„ã€‚ æ€»ç»“æœ¬æ–‡æ²¡æœ‰è¿‡å¤šè®¨è®º cicada å®ç°åŸç†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹æºç ï¼Œéƒ½æ¯”è¾ƒç®€å•ã€‚ åœ¨åç»­çš„æ›´æ–°ä¸­ä¼šä»”ç»†æ¢è®¨è¿™å—å†…å®¹ã€‚ åŒæ—¶ä¸å‡ºæ„å¤– cicada ä¼šæŒç»­æ›´æ–°ï¼Œæœªæ¥ä¹Ÿä¼šåŠ å…¥æ›´å¤šå®ç”¨çš„åŠŸèƒ½ã€‚ ç”šè‡³æˆ‘ä¼šåœ¨é€‚å½“çš„æ—¶æœºå°†å®ƒåº”ç”¨äºæˆ‘çš„ç”Ÿäº§é¡¹ç›®ï¼Œä¹Ÿå¸Œæœ›æ›´å¤šæœ‹å‹èƒ½å‚ä¸è¿›æ¥ä¸€èµ·æŠŠè¿™ä¸ªã€Œè½®å­ã€åšçš„æ›´å¥½ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/cicada ä½ çš„ç‚¹èµä¸è½¬å‘æ˜¯æœ€å¤§çš„æ”¯æŒã€‚]]></content>
      <categories>
        <category>cicada</category>
        <category>è½®å­</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>HTTP</tag>
        <tag>Netty</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¼ºå¦‚ Disruptor ä¹Ÿå‘ç”Ÿå†…å­˜æº¢å‡ºï¼Ÿ]]></title>
    <url>%2F2018%2F08%2F29%2Fjava-senior%2FOOM-Disruptor%2F</url>
    <content type="text"><![CDATA[å‰è¨€OutOfMemoryError é—®é¢˜ç›¸ä¿¡å¾ˆå¤šæœ‹å‹éƒ½é‡åˆ°è¿‡ï¼Œç›¸å¯¹äºå¸¸è§çš„ä¸šåŠ¡å¼‚å¸¸ï¼ˆæ•°ç»„è¶Šç•Œã€ç©ºæŒ‡é’ˆç­‰ï¼‰æ¥è¯´è¿™ç±»é—®é¢˜æ˜¯å¾ˆéš¾å®šä½å’Œè§£å†³çš„ã€‚ æœ¬æ–‡ä»¥æœ€è¿‘ç¢°åˆ°çš„ä¸€æ¬¡çº¿ä¸Šå†…å­˜æº¢å‡ºçš„å®šä½ã€è§£å†³é—®é¢˜çš„æ–¹å¼å±•å¼€ï¼›å¸Œæœ›èƒ½å¯¹ç¢°åˆ°ç±»ä¼¼é—®é¢˜çš„åŒå­¦å¸¦æ¥æ€è·¯å’Œå¸®åŠ©ã€‚ ä¸»è¦ä»è¡¨ç°--&gt;æ’æŸ¥--&gt;å®šä½--&gt;è§£å†³ å››ä¸ªæ­¥éª¤æ¥åˆ†æå’Œè§£å†³é—®é¢˜ã€‚ è¡¨è±¡æœ€è¿‘æˆ‘ä»¬ç”Ÿäº§ä¸Šçš„ä¸€ä¸ªåº”ç”¨ä¸æ–­çš„çˆ†å‡ºå†…å­˜æº¢å‡ºï¼Œå¹¶ä¸”éšç€ä¸šåŠ¡é‡çš„å¢é•¿å‡ºç°çš„é¢‘æ¬¡è¶Šæ¥è¶Šé«˜ã€‚ è¯¥ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘éå¸¸ç®€å•ï¼Œå°±æ˜¯ä» Kafka ä¸­å°†æ•°æ®æ¶ˆè´¹ä¸‹æ¥ç„¶åæ‰¹é‡çš„åšæŒä¹…åŒ–æ“ä½œã€‚ è€Œç°è±¡åˆ™æ˜¯éšç€ Kafka çš„æ¶ˆæ¯è¶Šå¤šï¼Œå‡ºç°çš„å¼‚å¸¸çš„é¢‘æ¬¡å°±è¶Šå¿«ã€‚ç”±äºå½“æ—¶è¿˜æœ‰å…¶ä»–å·¥ä½œæ‰€ä»¥åªèƒ½è®©è¿ç»´åšé‡å¯ï¼Œå¹¶ä¸”ç›‘æ§å¥½å †å†…å­˜ä»¥åŠ GC æƒ…å†µã€‚ é‡å¯å¤§æ³•è™½å¥½ï¼Œå¯æ˜¯ä¾ç„¶ä¸èƒ½æ ¹æœ¬è§£å†³é—®é¢˜ã€‚ æ’æŸ¥äºæ˜¯æˆ‘ä»¬æƒ³æ ¹æ®è¿ç»´ä¹‹å‰æ”¶é›†åˆ°çš„å†…å­˜æ•°æ®ã€GC æ—¥å¿—å°è¯•åˆ¤æ–­å“ªé‡Œå‡ºç°é—®é¢˜ã€‚ ç»“æœå‘ç°è€å¹´ä»£çš„å†…å­˜ä½¿ç”¨å°±ç®—æ˜¯å‘ç”Ÿ GC ä¹Ÿä¸€ç›´å±…é«˜ä¸ä¸‹ï¼Œè€Œä¸”éšç€æ—¶é—´æ¨ç§»ä¹Ÿè¶Šæ¥è¶Šé«˜ã€‚ ç»“åˆ jstat çš„æ—¥å¿—å‘ç°å°±ç®—æ˜¯å‘ç”Ÿäº† FGC è€å¹´ä»£ä¹Ÿå·²ç»å›æ”¶ä¸äº†ï¼Œå†…å­˜å·²ç»åˆ°é¡¶ã€‚ ç”šè‡³æœ‰å‡ å°åº”ç”¨ FGC è¾¾åˆ°äº†ä¸Šç™¾æ¬¡ï¼Œæ—¶é—´ä¹Ÿé«˜çš„å¯æ€•ã€‚ è¿™è¯´æ˜åº”ç”¨çš„å†…å­˜ä½¿ç”¨è‚¯å®šæ˜¯æœ‰é—®é¢˜çš„ï¼Œæœ‰è®¸å¤šèµ–çš®å¯¹è±¡å§‹ç»ˆå›æ”¶ä¸æ‰ã€‚ å®šä½ç”±äºç”Ÿäº§ä¸Šçš„å†…å­˜ dump æ–‡ä»¶éå¸¸å¤§ï¼Œè¾¾åˆ°äº†å‡ åGã€‚ä¹Ÿæ˜¯ç”±äºæˆ‘ä»¬çš„å†…å­˜è®¾ç½®å¤ªå¤§æœ‰å…³ã€‚ æ‰€ä»¥å¯¼è‡´æƒ³ä½¿ç”¨ MAT åˆ†æéœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´ã€‚ å› æ­¤æˆ‘ä»¬ä¾¿æƒ³æ˜¯å¦å¯ä»¥åœ¨æœ¬åœ°å¤ç°ï¼Œè¿™æ ·å°±è¦å¥½å®šä½çš„å¤šã€‚ ä¸ºäº†å°½å¿«çš„å¤ç°é—®é¢˜ï¼Œæˆ‘å°†æœ¬åœ°åº”ç”¨æœ€å¤§å †å†…å­˜è®¾ç½®ä¸º 150Mã€‚ ç„¶ååœ¨æ¶ˆè´¹ Kafka é‚£é‡Œ Mock ä¸ºä¸€ä¸ª while å¾ªç¯ä¸€ç›´ä¸æ–­çš„ç”Ÿæˆæ•°æ®ã€‚ åŒæ—¶å½“åº”ç”¨å¯åŠ¨ä¹‹ååˆ©ç”¨ VisualVM è¿ä¸Šåº”ç”¨å®æ—¶ç›‘æ§å†…å­˜ã€GC çš„ä½¿ç”¨æƒ…å†µã€‚ ç»“æœè·‘äº† 10 å‡ åˆ†é’Ÿå†…å­˜ä½¿ç”¨å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚æ ¹æ®å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ¯äº§ç”Ÿä¸€æ¬¡ GC å†…å­˜éƒ½èƒ½æœ‰æ•ˆçš„å›æ”¶ï¼Œæ‰€ä»¥è¿™æ ·å¹¶æ²¡æœ‰å¤ç°é—®é¢˜ã€‚ æ²¡æ³•å¤ç°é—®é¢˜å°±å¾ˆéš¾å®šä½äº†ã€‚äºæ˜¯æˆ‘ä»¬ review ä»£ç ï¼Œå‘ç°ç”Ÿäº§çš„é€»è¾‘å’Œæˆ‘ä»¬ç”¨ while å¾ªç¯ Mock æ•°æ®è¿˜ä¸å¤ªä¸€æ ·ã€‚ æŸ¥çœ‹ç”Ÿäº§çš„æ—¥å¿—å‘ç°æ¯æ¬¡ä» Kafka ä¸­å–å‡ºçš„éƒ½æ˜¯å‡ ç™¾æ¡æ•°æ®ï¼Œè€Œæˆ‘ä»¬ Mock æ—¶æ¯æ¬¡åªèƒ½äº§ç”Ÿä¸€æ¡ã€‚ ä¸ºäº†å°½å¯èƒ½çš„æ¨¡æ‹Ÿç”Ÿäº§æƒ…å†µä¾¿åœ¨æœåŠ¡å™¨ä¸Šè·‘ç€ä¸€ä¸ªç”Ÿäº§è€…ç¨‹åºï¼Œä¸€ç›´æºæºä¸æ–­çš„å‘ Kafka ä¸­å‘é€æ•°æ®ã€‚ æœç„¶ä¸å‡ºæ„å¤–åªè·‘äº†ä¸€åˆ†å¤šé’Ÿå†…å­˜å°±é¡¶ä¸ä½äº†ï¼Œè§‚å¯Ÿå·¦å›¾å‘ç° GC çš„é¢‘æ¬¡éå¸¸é«˜ï¼Œä½†æ˜¯å†…å­˜çš„å›æ”¶å´æ˜¯ç›¸å½¢è§æ‹™ã€‚ åŒæ—¶åå°ä¹Ÿå¼€å§‹æ‰“å°å†…å­˜æº¢å‡ºäº†ï¼Œè¿™æ ·ä¾¿å¤ç°å‡ºé—®é¢˜ã€‚ è§£å†³ä»ç›®å‰çš„è¡¨ç°æ¥çœ‹å°±æ˜¯å†…å­˜ä¸­æœ‰è®¸å¤šå¯¹è±¡ä¸€ç›´å­˜åœ¨å¼ºå¼•ç”¨å…³ç³»å¯¼è‡´å¾—ä¸åˆ°å›æ”¶ã€‚ äºæ˜¯ä¾¿æƒ³çœ‹çœ‹åˆ°åº•æ˜¯ä»€ä¹ˆå¯¹è±¡å ç”¨äº†è¿™ä¹ˆå¤šçš„å†…å­˜ï¼Œåˆ©ç”¨ VisualVM çš„ HeapDump åŠŸèƒ½å¯ä»¥ç«‹å³ dump å‡ºå½“å‰åº”ç”¨çš„å†…å­˜æƒ…å†µã€‚ ç»“æœå‘ç° com.lmax.disruptor.RingBuffer ç±»å‹çš„å¯¹è±¡å ç”¨äº†å°†è¿‘ 50% çš„å†…å­˜ã€‚ çœ‹åˆ°è¿™ä¸ªåŒ…è‡ªç„¶å°±æƒ³åˆ°äº† Disruptor ç¯å½¢é˜Ÿåˆ—ã€‚ å†æ¬¡ review ä»£ç å‘ç°ï¼šä» Kafka é‡Œå–å‡ºçš„ 700 æ¡æ•°æ®æ˜¯ç›´æ¥å¾€ Disruptor é‡Œä¸¢çš„ã€‚ è¿™é‡Œä¹Ÿå°±èƒ½è¯´æ˜ä¸ºä»€ä¹ˆç¬¬ä¸€æ¬¡æ¨¡æ‹Ÿæ•°æ®æ²¡å¤ç°é—®é¢˜äº†ã€‚ æ¨¡æ‹Ÿçš„æ—¶å€™æ˜¯ä¸€ä¸ªå¯¹è±¡æ”¾è¿›é˜Ÿåˆ—é‡Œï¼Œè€Œç”Ÿäº§çš„æƒ…å†µæ˜¯ 700 æ¡æ•°æ®æ”¾è¿›é˜Ÿåˆ—é‡Œã€‚è¿™ä¸ªæ•°æ®é‡æ˜¯ 700 å€çš„å·®è·ã€‚ è€Œ Disruptor ä½œä¸ºä¸€ä¸ªç¯å½¢é˜Ÿåˆ—ï¼Œå†å¯¹è±¡æ²¡æœ‰è¢«è¦†ç›–ä¹‹å‰æ˜¯ä¸€ç›´å­˜åœ¨çš„ã€‚ æˆ‘ä¹Ÿåšäº†ä¸€ä¸ªå®éªŒï¼Œè¯æ˜ç¡®å®å¦‚æ­¤ã€‚ æˆ‘è®¾ç½®é˜Ÿåˆ—å¤§å°ä¸º 8 ï¼Œä» 0~9 å¾€é‡Œé¢å†™ 10 æ¡æ•°æ®ï¼Œå½“å†™åˆ° 8 çš„æ—¶å€™å°±ä¼šæŠŠä¹‹å‰ 0 çš„ä½ç½®è¦†ç›–æ‰ï¼Œåé¢çš„ä»¥æ­¤ç±»æ¨ï¼ˆç±»ä¼¼äº HashMap çš„å–æ¨¡å®šä½ï¼‰ã€‚ æ‰€ä»¥åœ¨ç”Ÿäº§ä¸Šå‡è®¾æˆ‘ä»¬çš„é˜Ÿåˆ—å¤§å°æ˜¯ 1024ï¼Œé‚£ä¹ˆéšç€ç³»ç»Ÿçš„è¿è¡Œæœ€ç»ˆè‚¯å®šä¼šå¯¼è‡´ 1024 ä¸ªä½ç½®ä¸Šè£…æ»¡äº†å¯¹è±¡ï¼Œè€Œä¸”æ¯ä¸ªä½ç½®æ˜¯ 700 ä¸ªï¼ äºæ˜¯æŸ¥çœ‹äº†ç”Ÿäº§ä¸Š Disruptor çš„ RingBuffer é…ç½®ï¼Œç»“æœæ˜¯ï¼š1024*1024ã€‚ è¿™ä¸ªæ•°é‡çº§å°±éå¸¸å“äººäº†ã€‚ ä¸ºäº†éªŒè¯æ˜¯å¦æ˜¯è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘åœ¨æœ¬åœ°å°†è¯¥å€¼æ¢ä¸º 2 ï¼Œä¸€ä¸ªæœ€å°å€¼è¯•è¯•ã€‚ åŒæ ·çš„ 128M å†…å­˜ï¼Œä¹Ÿæ˜¯é€šè¿‡ Kafka ä¸€ç›´æºæºä¸æ–­çš„å–å‡ºæ•°æ®ã€‚é€šè¿‡ç›‘æ§å¦‚ä¸‹ï¼š è·‘äº† 20 å‡ åˆ†é’Ÿç³»ç»Ÿä¸€åˆ‡æ­£å¸¸ï¼Œæ¯å½“ä¸€æ¬¡ GC éƒ½èƒ½å›æ”¶å¤§éƒ¨åˆ†å†…å­˜ï¼Œæœ€ç»ˆå‘ˆç°é”¯é½¿çŠ¶ã€‚ è¿™æ ·é—®é¢˜å°±æ‰¾åˆ°äº†ï¼Œä¸è¿‡ç”Ÿäº§ä¸Šè¿™ä¸ªå€¼å…·ä½“è®¾ç½®å¤šå°‘è¿˜å¾—æ ¹æ®ä¸šåŠ¡æƒ…å†µæµ‹è¯•æ‰èƒ½çŸ¥é“ï¼Œä½†åŸæœ‰çš„ 1024*1024 æ˜¯ç»å¯¹ä¸èƒ½å†ä½¿ç”¨äº†ã€‚ æ€»ç»“è™½ç„¶åˆ°äº†æœ€åä¹Ÿå°±æ”¹äº†ä¸€è¡Œä»£ç (è¿˜æ²¡æ”¹ï¼Œç›´æ¥ä¿®æ”¹é…ç½®)ï¼Œä½†è¿™æ’æŸ¥è¿‡ç¨‹æˆ‘è§‰å¾—æ˜¯æœ‰æ„ä¹‰çš„ã€‚ ä¹Ÿä¼šè®©å¤§éƒ¨åˆ†è§‰å¾— JVM è¿™æ ·çš„é»‘ç›’éš¾ä»¥ä¸‹æ‰‹çš„åŒå­¦æœ‰ä¸€ä¸ªç›´è§‚çš„æ„Ÿå—ã€‚ åŒæ—¶ä¹Ÿå¾—æ„Ÿå¹ Disruptor ä¸œè¥¿è™½å¥½ï¼Œä¹Ÿä¸èƒ½ä¹±ç”¨å“¦ï¼ ç›¸å…³æ¼”ç¤ºä»£ç æŸ¥çœ‹ï¼š https://github.com/crossoverJie/JCSprout/tree/master/src/main/java/com/crossoverjie/disruptor ä½ çš„ç‚¹èµä¸è½¬å‘æ˜¯æœ€å¤§çš„æ”¯æŒã€‚]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Thread</tag>
        <tag>concurrent</tag>
        <tag>JVM</tag>
        <tag>OOM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼(ä¸€) æå®šæœåŠ¡æ³¨å†Œä¸å‘ç°]]></title>
    <url>%2F2018%2F08%2F27%2Fdistributed%2Fdistributed-discovery-zk%2F</url>
    <content type="text"><![CDATA[èƒŒæ™¯æœ€è¿‘åœ¨åšåˆ†å¸ƒå¼ç›¸å…³çš„å·¥ä½œï¼Œç”±äºäººæ‰‹ä¸å¤Ÿåªèƒ½æˆ‘ä¸€ä¸ªäººæ¥æ€¼ï¼›çœ‹ç€è¿™æ®µæ—¶é—´çš„åŠ ç­è¡¨æƒ³æƒ³å°±æ˜¯å¤Ÿæƒ¨çš„ã€‚ ä¸è¿‡å…¶ä¸­ä¹Ÿæœ‰é‡åˆ°çš„ä¸å°‘æœ‰æ„æ€çš„äº‹æƒ…ä»Šåå†æ‹¿æ¥åˆ†äº«ï¼Œä»Šå¤©é‡ç‚¹æ¥è®¨è®ºæœåŠ¡çš„æ³¨å†Œä¸å‘ç°ã€‚ åˆ†å¸ƒå¼å¸¦æ¥çš„é—®é¢˜æˆ‘çš„ä¸šåŠ¡æ¯”è¾ƒç®€å•ï¼Œåªæ˜¯éœ€è¦çŸ¥é“ç°åœ¨æœ‰å“ªäº›æœåŠ¡å®ä¾‹å¯ä¾›ä½¿ç”¨å°±å¯ä»¥äº†ï¼ˆå¹¶ä¸æ˜¯åšè¿œç¨‹è°ƒç”¨ï¼Œåªéœ€è¦æ‹¿åˆ°ä¿¡æ¯å³å¯ï¼‰ã€‚ è¦å®ç°è¿™ä¸€åŠŸèƒ½æœ€ç®€å•çš„æ–¹å¼å¯ä»¥åœ¨åº”ç”¨ä¸­é…ç½®æ‰€æœ‰çš„æœåŠ¡èŠ‚ç‚¹ï¼Œè¿™æ ·æ¯æ¬¡åœ¨ä½¿ç”¨æ—¶åªéœ€è¦é€šè¿‡æŸç§ç®—æ³•ä»é…ç½®åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªå°±å¯ä»¥äº†ã€‚ ä½†è¿™æ ·ä¼šæœ‰ä¸€ä¸ªéå¸¸ä¸¥é‡çš„é—®é¢˜ï¼š ç”±äºåº”ç”¨éœ€è¦æ ¹æ®åº”ç”¨è´Ÿè½½æƒ…å†µæ¥çµæ´»çš„è°ƒæ•´æœåŠ¡èŠ‚ç‚¹çš„æ•°é‡ï¼Œè¿™æ ·æˆ‘çš„é…ç½®å°±ä¸èƒ½å†™æ­»ã€‚ ä¸ç„¶å°±ä¼šå‡ºç°è¦ä¹ˆæ–°å¢çš„èŠ‚ç‚¹æ²¡æœ‰è®¿é—®æˆ–è€…æ˜¯å·²ç» down æ‰çš„èŠ‚ç‚¹å´æœ‰è¯·æ±‚ï¼Œè¿™æ ·è‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚ å¾€å¾€è¦è§£å†³è¿™ç±»åˆ†å¸ƒå¼é—®é¢˜éƒ½éœ€è¦ä¸€ä¸ªå…¬å…±çš„åŒºåŸŸæ¥ä¿å­˜è¿™äº›ä¿¡æ¯ï¼Œæ¯”å¦‚æ˜¯å¦å¯ä»¥åˆ©ç”¨ Redisï¼Ÿ æ¯ä¸ªèŠ‚ç‚¹å¯åŠ¨ä¹‹åéƒ½å‘ Redis æ³¨å†Œä¿¡æ¯ï¼Œå…³é—­æ—¶ä¹Ÿåˆ é™¤æ•°æ®ã€‚ å…¶å®å°±æ˜¯å­˜æ”¾èŠ‚ç‚¹çš„ ip + portï¼Œç„¶ååœ¨éœ€è¦çŸ¥é“æœåŠ¡èŠ‚ç‚¹ä¿¡æ¯æ—¶å€™åªéœ€è¦å» Redis ä¸­è·å–å³å¯ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä½†è¿™æ ·ä¼šå¯¼è‡´æ¯æ¬¡ä½¿ç”¨æ—¶éƒ½éœ€è¦é¢‘ç¹çš„å»æŸ¥è¯¢ Redisï¼Œä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜æˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¬¡æŸ¥è¯¢ä¹‹ååœ¨æœ¬åœ°ç¼“å­˜ä¸€ä»½æœ€æ–°çš„æ•°æ®ã€‚è¿™æ ·ä¼˜å…ˆä»æœ¬åœ°è·å–ç¡®å®å¯ä»¥æé«˜æ•ˆç‡ã€‚ ä½†åŒæ ·åˆä¼šå‡ºç°æ–°çš„é—®é¢˜ï¼Œå¦‚æœæœåŠ¡æä¾›è€…çš„èŠ‚ç‚¹æ–°å¢æˆ–è€…åˆ é™¤æ¶ˆè´¹è€…è¿™è¾¹æ ¹æœ¬å°±ä¸çŸ¥é“æƒ…å†µã€‚ è¦è§£å†³è¿™ä¸ªé—®é¢˜æœ€å…ˆæƒ³åˆ°çš„åº”è¯¥å°±æ˜¯åˆ©ç”¨å®šæ—¶ä»»åŠ¡å®šæœŸå»æ›´æ–°æœåŠ¡åˆ—è¡¨ã€‚ ä»¥ä¸Šçš„æ–¹æ¡ˆè‚¯å®šä¸å®Œç¾ï¼Œå¹¶ä¸”ä¸ä¼˜é›…ã€‚ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š åŸºäºå®šæ—¶ä»»åŠ¡ä¼šå¯¼è‡´å¾ˆå¤šæ— æ•ˆçš„æ›´æ–°ã€‚ å®šæ—¶ä»»åŠ¡å­˜åœ¨å‘¨æœŸæ€§ï¼Œæ²¡æ³•åšåˆ°å®æ—¶ï¼Œè¿™æ ·å°±å¯èƒ½å­˜åœ¨è¯·æ±‚å¼‚å¸¸ã€‚ å¦‚æœæœåŠ¡è¢«å¼ºè¡Œ killï¼Œæ²¡æ³•åŠæ—¶æ¸…é™¤ Redisï¼Œè¿™æ ·è¿™ä¸ªçœ‹ä¼¼å¯ç”¨çš„æœåŠ¡å°†æ°¸è¿œä¸å¯ç”¨ï¼ æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´åŠ é è°±çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™æ ·çš„åœºæ™¯å…¶å®å’Œ Dubbo éå¸¸ç±»ä¼¼ã€‚ ç”¨è¿‡çš„åŒå­¦è‚¯å®šå¯¹è¿™å¼ å›¾ä¸é™Œç”Ÿã€‚ å¼•ç”¨è‡ª Dubbo å®˜ç½‘ å…¶ä¸­æœ‰ä¸€å—éå¸¸æ ¸å¿ƒçš„å†…å®¹ï¼ˆçº¢æ¡†å‡ºï¼‰å°±æ˜¯æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ã€‚ é€šå¸¸æ¥è¯´æ¶ˆè´¹è€…æ˜¯éœ€è¦çŸ¥é“æœåŠ¡æä¾›è€…çš„ç½‘ç»œåœ°å€(ip + port)æ‰èƒ½å‘èµ·è¿œç¨‹è°ƒç”¨ï¼Œè¿™å—å†…å®¹å’Œæˆ‘ä¸Šé¢çš„éœ€æ±‚å…¶å®éå¸¸ç±»ä¼¼ã€‚ è€Œ Dubbo åˆ™æ˜¯åˆ©ç”¨ Zookeeper æ¥è§£å†³é—®é¢˜ã€‚ Zookeeper èƒ½åšä»€ä¹ˆåœ¨å…·ä½“è®¨è®ºæ€ä¹ˆå®ç°ä¹‹å‰å…ˆçœ‹çœ‹ Zookeeper çš„å‡ ä¸ªé‡è¦ç‰¹æ€§ã€‚ Zookeeper å®ç°äº†ä¸€ä¸ªç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿçš„æ ‘çŠ¶ç»“æ„ï¼š è¿™äº›èŠ‚ç‚¹è¢«ç§°ä¸º znode(åå­—å«ä»€ä¹ˆä¸é‡è¦)ï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥å­˜æ”¾ä¸€å®šçš„æ•°æ®ã€‚ æœ€ä¸»è¦çš„æ˜¯ znode æœ‰å››ç§ç±»å‹ï¼š æ°¸ä¹…èŠ‚ç‚¹ï¼ˆé™¤éæ‰‹åŠ¨åˆ é™¤ï¼ŒèŠ‚ç‚¹æ°¸è¿œå­˜åœ¨ï¼‰ æ°¸ä¹…æœ‰åºèŠ‚ç‚¹ï¼ˆæŒ‰ç…§åˆ›å»ºé¡ºåºä¼šä¸ºæ¯ä¸ªèŠ‚ç‚¹æœ«å°¾å¸¦ä¸Šä¸€ä¸ªåºå·å¦‚ï¼šroot-1ï¼‰ ç¬æ—¶èŠ‚ç‚¹ï¼ˆåˆ›å»ºå®¢æˆ·ç«¯ä¸ Zookeeper ä¿æŒè¿æ¥æ—¶èŠ‚ç‚¹å­˜åœ¨ï¼Œæ–­å¼€æ—¶åˆ™åˆ é™¤å¹¶ä¼šæœ‰ç›¸åº”çš„é€šçŸ¥ï¼‰ ç¬æ—¶æœ‰åºèŠ‚ç‚¹ï¼ˆåœ¨ç¬æ—¶èŠ‚ç‚¹çš„åŸºç¡€ä¸ŠåŠ ä¸Šäº†é¡ºåºï¼‰ è€ƒè™‘ä¸‹ä¸Šæ–‡ä½¿ç”¨ Redis æœ€å¤§çš„ä¸€ä¸ªé—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ å…¶å®å°±æ˜¯ä¸èƒ½å®æ—¶çš„æ›´æ–°æœåŠ¡æä¾›è€…çš„ä¿¡æ¯ã€‚ é‚£åˆ©ç”¨ Zookeeper æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ ä¸»è¦çœ‹ç¬¬ä¸‰ä¸ªç‰¹æ€§ï¼šç¬æ—¶èŠ‚ç‚¹ Zookeeper æ˜¯ä¸€ä¸ªå…¸å‹çš„è§‚å¯Ÿè€…æ¨¡å¼ã€‚ ç”±äºç¬æ—¶èŠ‚ç‚¹çš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬çš„æ¶ˆè´¹è€…å¯ä»¥è®¢é˜…ç¬æ—¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚ å½“æ–°å¢ã€åˆ é™¤èŠ‚ç‚¹æ—¶æ‰€æœ‰çš„ç¬æ—¶èŠ‚ç‚¹ä¹Ÿä¼šè‡ªåŠ¨æ›´æ–°ã€‚ æ›´æ–°æ—¶ä¼šç»™è®¢é˜…è€…å‘èµ·é€šçŸ¥å‘Šè¯‰æœ€æ–°çš„èŠ‚ç‚¹ä¿¡æ¯ã€‚ è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®æ—¶è·å–æœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿåªéœ€è¦åœ¨ç¬¬ä¸€æ¬¡è·å–åˆ—è¡¨æ—¶ç¼“å­˜åˆ°æœ¬åœ°ï¼›ä¹Ÿä¸éœ€è¦é¢‘ç¹å’Œ Zookeeper äº§ç”Ÿäº¤äº’ï¼Œåªç”¨ç­‰å¾…é€šçŸ¥æ›´æ–°å³å¯ã€‚ å¹¶ä¸”ä¸ç®¡åº”ç”¨ä»€ä¹ˆåŸå› èŠ‚ç‚¹ down æ‰åä¹Ÿä¼šåœ¨ Zookeeper ä¸­åˆ é™¤è¯¥ä¿¡æ¯ã€‚ æ•ˆæœæ¼”ç¤ºè¿™æ ·å®ç°æ–¹å¼å°±å˜ä¸ºè¿™æ ·ã€‚ ä¸ºæ­¤æˆ‘æ–°å»ºäº†ä¸€ä¸ªåº”ç”¨æ¥è¿›è¡Œæ¼”ç¤ºï¼š https://github.com/crossoverJie/netty-action/tree/master/netty-action-zk å°±æ˜¯ä¸€ä¸ªç®€å•çš„ SpringBoot åº”ç”¨ï¼Œåªæ˜¯åšäº†å‡ ä»¶äº‹æƒ…ã€‚ åº”ç”¨å¯åŠ¨æ—¶æ–°å¼€ä¸€ä¸ªçº¿ç¨‹ç”¨äºå‘ Zookeeper æ³¨å†ŒæœåŠ¡ã€‚ åŒæ—¶ç›‘å¬ä¸€ä¸ªèŠ‚ç‚¹ç”¨äºæ›´æ–°æœ¬åœ°æœåŠ¡åˆ—è¡¨ã€‚ æä¾›ä¸€ä¸ªæ¥å£ç”¨äºè¿”å›ä¸€ä¸ªå¯æœ‰çš„æœåŠ¡èŠ‚ç‚¹ã€‚ æˆ‘åœ¨æœ¬åœ°å¯åŠ¨äº†ä¸¤ä¸ªåº”ç”¨åˆ†åˆ«æ˜¯ï¼š127.0.0.1:8083,127.0.0.1:8084ã€‚æ¥çœ‹çœ‹æ•ˆæœå›¾ã€‚ ä¸¤ä¸ªåº”ç”¨å¯åŠ¨å®Œæˆï¼š å½“å‰ Zookeeper çš„å¯è§†åŒ–æ ‘çŠ¶ç»“æ„ï¼š å½“æƒ³çŸ¥é“æ‰€æœ‰çš„æœåŠ¡èŠ‚ç‚¹ä¿¡æ¯æ—¶ï¼š æƒ³è¦è·å–ä¸€ä¸ªå¯ç”¨çš„æœåŠ¡èŠ‚ç‚¹æ—¶ï¼š è¿™é‡Œåªæ˜¯é‡‡å–äº†ç®€å•çš„è½®è¯¢ã€‚ å½“ down æ‰ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼šåº”ç”¨ä¼šæ”¶åˆ°é€šçŸ¥æ›´æ–°æœ¬åœ°ç¼“å­˜ã€‚åŒæ—¶ Zookeeper ä¸­çš„èŠ‚ç‚¹ä¼šè‡ªåŠ¨åˆ é™¤ã€‚ å†æ¬¡è·å–æœ€æ–°èŠ‚ç‚¹æ—¶ï¼š å½“èŠ‚ç‚¹æ¢å¤æ—¶è‡ªç„¶ä¹Ÿèƒ½è·å–åˆ°æœ€æ–°ä¿¡æ¯ã€‚æœ¬åœ°ç¼“å­˜ä¹Ÿä¼šåŠæ—¶æ›´æ–°ã€‚ ç¼–ç å®ç°å®ç°èµ·æ¥å€’ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä¸»è¦å°±æ˜¯ ZKClient çš„ api ä½¿ç”¨ã€‚ è´´å‡ æ®µæ¯”è¾ƒæ ¸å¿ƒçš„å§ã€‚ æ³¨å†Œ å¯åŠ¨æ³¨å†Œ Zookeeperã€‚ ä¸»è¦é€»è¾‘éƒ½åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­ã€‚ é¦–å…ˆåˆ›å»ºçˆ¶èŠ‚ç‚¹ã€‚å¦‚ä¸Šå›¾çš„ Zookeeper èŠ‚ç‚¹æ‰€ç¤ºï¼›éœ€è¦å…ˆåˆ›å»º /route æ ¹èŠ‚ç‚¹ï¼Œåˆ›å»ºçš„æ—¶å€™ä¼šåˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨ã€‚ æ¥ç€éœ€è¦åˆ¤æ–­æ˜¯å¦éœ€è¦å°†è‡ªå·±æ³¨å†Œåˆ° Zookeeper ä¸­ï¼Œå› ä¸ºæœ‰äº›èŠ‚ç‚¹åªæ˜¯ç”¨äºæœåŠ¡å‘ç°ï¼Œä»–è‡ªèº«æ˜¯ä¸éœ€è¦æ‰¿æ‹…ä¸šåŠ¡åŠŸèƒ½ï¼ˆæ˜¯æˆ‘è‡ªå·±é¡¹ç›®çš„éœ€æ±‚ï¼‰ã€‚ å°†å½“å‰åº”ç”¨çš„æ‰€åœ¨ ip ä»¥åŠç«¯å£æ³¨å†Œä¸Šå»ï¼ŒåŒæ—¶éœ€è¦ç›‘å¬æ ¹èŠ‚ç‚¹ /route ï¼Œè¿™æ ·æ‰èƒ½åœ¨å…¶ä»–æœåŠ¡ä¸Šä¸‹çº¿æ—¶å€™è·å¾—é€šçŸ¥ã€‚ æ ¹æ®æœ¬åœ°ç¼“å­˜ ç›‘å¬åˆ°æœåŠ¡å˜åŒ– 12345678910111213public void subscribeEvent(String path) &#123; zkClient.subscribeChildChanges(path, new IZkChildListener() &#123; @Override public void handleChildChange(String parentPath, List&lt;String&gt; currentChilds) throws Exception &#123; logger.info("æ¸…é™¤/æ›´æ–°æœ¬åœ°ç¼“å­˜ parentPath=ã€&#123;&#125;ã€‘,currentChilds=ã€&#123;&#125;ã€‘", parentPath,currentChilds.toString()); //æ›´æ–°æ‰€æœ‰ç¼“å­˜/å…ˆåˆ é™¤ å†æ–°å¢ serverCache.updateCache(currentChilds) ; &#125; &#125;);&#125; å¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯æ›´æ–°äº†æœ¬åœ°ç¼“å­˜ï¼Œè¯¥ç¼“å­˜é‡‡ç”¨äº† Guava æä¾›çš„ Cacheï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥æŸ¥çœ‹ä¹‹å‰çš„æºç åˆ†æã€‚ 123456789101112/** * æ›´æ–°æ‰€æœ‰ç¼“å­˜/å…ˆåˆ é™¤ å†æ–°å¢ * * @param currentChilds */public void updateCache(List&lt;String&gt; currentChilds) &#123; cache.invalidateAll(); for (String currentChild : currentChilds) &#123; String key = currentChild.split("-")[1]; addCache(key); &#125;&#125; å®¢æˆ·ç«¯è´Ÿè½½ åŒæ—¶åœ¨å®¢æˆ·ç«¯æä¾›äº†ä¸€ä¸ªè´Ÿè½½ç®—æ³•ã€‚ å…¶å®å°±æ˜¯ä¸€ä¸ªè½®è¯¢çš„å®ç°ï¼š 1234567891011121314151617/** * é€‰å–æœåŠ¡å™¨ * * @return */public String selectServer() &#123; List&lt;String&gt; all = getAll(); if (all.size() == 0) &#123; throw new RuntimeException("è·¯ç”±åˆ—è¡¨ä¸ºç©º"); &#125; Long position = index.incrementAndGet() % all.size(); if (position &lt; 0) &#123; position = 0L; &#125; return all.get(position.intValue());&#125; å½“ç„¶è¿™é‡Œå¯ä»¥æ‰©å±•å‡ºæ›´å¤šçš„å¦‚æƒé‡ã€éšæœºã€LRU ç­‰ç®—æ³•ã€‚ Zookeeper å…¶ä»–ä¼˜åŠ¿åŠé—®é¢˜Zookeeper è‡ªç„¶æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„åˆ†å¸ƒå¼åè°ƒå·¥å…·ï¼Œåˆ©ç”¨å®ƒçš„ç‰¹æ€§è¿˜å¯ä»¥æœ‰å…¶ä»–ä½œç”¨ã€‚ æ•°æ®å˜æ›´å‘é€é€šçŸ¥è¿™ä¸€ç‰¹æ€§å¯ä»¥å®ç°ç»Ÿä¸€é…ç½®ä¸­å¿ƒï¼Œå†ä¹Ÿä¸éœ€è¦åœ¨æ¯ä¸ªæœåŠ¡ä¸­å•ç‹¬ç»´æŠ¤é…ç½®ã€‚ åˆ©ç”¨ç¬æ—¶æœ‰åºèŠ‚ç‚¹è¿˜å¯ä»¥å®ç°åˆ†å¸ƒå¼é”ã€‚ åœ¨å®ç°æ³¨å†Œã€å‘ç°è¿™ä¸€éœ€æ±‚æ—¶ï¼ŒZookeeper å…¶å®å¹¶ä¸æ˜¯æœ€ä¼˜é€‰ã€‚ ç”±äº Zookeeper åœ¨ CAP ç†è®ºä¸­é€‰æ‹©äº† CPï¼ˆä¸€è‡´æ€§ã€åˆ†åŒºå®¹é”™æ€§ï¼‰ï¼Œå½“ Zookeeper é›†ç¾¤æœ‰åŠæ•°èŠ‚ç‚¹ä¸å¯ç”¨æ—¶æ˜¯ä¸èƒ½è·å–åˆ°ä»»ä½•æ•°æ®çš„ã€‚ å¯¹äºä¸€è‡´æ€§æ¥è¯´è‡ªç„¶æ²¡å•¥é—®é¢˜ï¼Œä½†åœ¨æ³¨å†Œã€å‘ç°çš„åœºæ™¯ä¸‹æ›´åŠ æ¨è Eurekaï¼Œå·²ç»åœ¨ SpringCloud ä¸­å¾—åˆ°éªŒè¯ã€‚å…·ä½“å°±ä¸åœ¨æœ¬æ–‡è®¨è®ºäº†ã€‚ ä½†é‰´äºæˆ‘çš„ä½¿ç”¨åœºæ™¯æ¥è¯´ Zookeeper å·²ç»èƒ½å¤Ÿèƒœä»»ã€‚ æ€»ç»“æœ¬æ–‡æ‰€æœ‰å®Œæ•´ä»£ç éƒ½æ‰˜ç®¡åœ¨ GitHubã€‚ https://github.com/crossoverJie/netty-actionã€‚ ä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„æ³¨å†Œã€å‘ç°åŠŸèƒ½å®ç°äº†ï¼Œä½†åˆ†å¸ƒå¼åº”ç”¨è¿œè¿œä¸æ­¢è¿™äº›ã€‚ ç”±äºç½‘ç»œéš”ç¦»ä¹‹åå¸¦æ¥çš„ä¸€ç³»åˆ—é—®é¢˜è¿˜éœ€è¦æˆ‘ä»¬ç”¨å…¶ä»–æ–¹å¼ä¸€ä¸€å®Œå–„ï¼›åç»­ä¼šç»§ç»­æ›´æ–°åˆ†å¸ƒå¼ç›¸å…³å†…å®¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹ä¸å¦¨æŒç»­å…³æ³¨ã€‚ ä½ çš„ç‚¹èµä¸è½¬å‘æ˜¯æœ€å¤§çš„æ”¯æŒã€‚]]></content>
      <categories>
        <category>Distributed</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Zookeeper</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»€ä¹ˆæ ·çš„ç®€å†ä¸ä¼šè¢«ä¸¢è¿›å›æ”¶ç«™]]></title>
    <url>%2F2018%2F08%2F21%2Fskill%2Fresume%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä»å»å¹´æ ¡æ‹›å¼€å§‹åˆ°ç°åœ¨è´Ÿè´£éƒ¨é—¨çš„é¢è¯•ï¼Œä»æˆ‘æ‰‹ä¸Šæµèµ°çš„ç®€å†å¤šå¤šå°‘å°‘ä¹Ÿæœ‰ä¸Šç™¾å°äº†ã€‚ åŒæ—¶æœ€è¿‘ç§‹æ‹›åˆè¦å¼€å§‹äº†ï¼Œå°±æƒ³ç€æŠŠæˆ‘è¿™ä¸€å¹´æ¥ç­›é€‰ç®€å†çš„ç»éªŒåˆ†äº«ç»™å¤§å®¶ï¼Œå¤šå°‘è¿˜æ˜¯èƒ½æé«˜ä¸€äº›å‘½ä¸­ç‡ã€‚ çªå‡ºä¼˜åŠ¿ã€Œç®€å†ã€è‡ªç„¶æ˜¯çªå‡ºç®€å•çš„å¥½ï¼Œç›¸ä¿¡å¤§éƒ¨åˆ†é¢è¯•å®˜éƒ½ä¸æ˜¯å…¨èŒåšé¢è¯•å·¥ä½œï¼›å¤šæ•°éƒ½æ˜¯å·¥ä½œä¹‹ä½™ç­›é€‰ç®€å†ã€‚ å°±æˆ‘çš„æƒ…å†µæ¥è¯´ï¼Œæ¯å¤©éƒ½éœ€è¦åœ¨å·¥ä½œä¸­æŒ¤å‡ºä¸€éƒ¨åˆ†æ—¶é—´ä» 10 å‡ ä»½ç®€å†ä¸­æŒ‘é€‰å‡ºæ¯”è¾ƒé è°±çš„ã€‚ æ€»å…±å¤§æ¦‚èŠ±è´¹ 5 åˆ†é’Ÿçš„æ—¶é—´ï¼Œå¹³å‡ç®—ä¸‹æ¥å·®ä¸å¤šä¸€ä»½ç®€å†åªæœ‰ 30Sã€‚ç°åœ¨æˆ‘ç»ˆäºç›¸ä¿¡å½“åˆè¯­æ–‡è€å¸ˆè¯´ï¼šâ€œé«˜è€ƒè¯­æ–‡ä½œæ–‡é˜…å·åªæœ‰å‡ åç§’çš„æ—¶é—´â€ã€‚ æ—¢ç„¶æ—¶é—´å¾ˆçŸ­ï¼Œå°±éœ€è¦åƒå†™ä½œæ–‡ä¸€æ ·çªå‡ºäº®ç‚¹ã€‚ åšå®¢ã€GitHubä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘åœ¨ç®€å†å¼€å¤´çš„ä¸ªäººä»‹ç»æ æœ‰çœ‹åˆ°ä¸ªäººåšå®¢ã€GitHub é“¾æ¥ç­‰ï¼Œä¸€èˆ¬éƒ½ä¼šç‚¹è¿›å»ç§ç§ã€‚ ä¸çŸ¥é“æ˜¯å¦æ˜¯åŸå¸‚åŸå› ï¼Œæˆ‘è¿™é‡Œå‡ ä¹ 10 ä»½ç®€å†ä¸­æœ‰ä¸¤ä»½è´´æœ‰ä¸ªäººåšå®¢ã€1 ä»½è´´æœ‰ GitHub é“¾æ¥ã€‚ å“ªæ€•é‡Œé¢çš„å†…å®¹ä¸æ˜¯éå¸¸å¸å¼•äººï¼Œä½†ç›¸æ¯”æ¥è¯´è¿™æ ·çš„ç®€å†ä¼šæ¯”å…¶ä»–å¤šèŠ±ä¸Šä¸€äº›é˜…è¯»æ—¶é—´ï¼Œè‡ªç„¶å°è±¡å°±æ›´åŠ æ·±åˆ»ã€‚ å¦‚æœåŒæ—¶å†…å®¹è¿˜éå¸¸ä¸é”™ï¼Œé‚£å°±æ›´æ˜¯åŠ åˆ†é¡¹äº†ã€‚ è¿™å°±å’Œä¸Šç¯‡ã€Šå¦‚ä½•æˆä¸ºä¸€ä½ã€Œä¸é‚£ä¹ˆå·®ã€çš„ç¨‹åºå‘˜ã€‹ä¸è°‹è€Œåˆï¼š é¡¹ç›®ç‰¹è‰²é€šå¸¸ç®€å†çš„æ ¸å¿ƒåŒºåŸŸå°±æ˜¯é¡¹ç›®ä»‹ç»ã€‚ è¿™å—æˆ‘è§‰å¾—å¯ä»¥é€‚å½“å‡å°‘é¡¹ç›®å…·ä½“çš„ä¸šåŠ¡æè¿°ï¼ˆè‡ªç„¶ä¸æ˜¯ä¸å†™ï¼‰ï¼Œå› ä¸ºå…·ä½“çš„é¡¹ç›®äº†è§£ä¸€èˆ¬ä¼šåœ¨ç®€å†è¯„ä¼°é€šè¿‡ååœ¨é¢è¯•ä¸­è¯¦èŠã€‚ æ‰€ä»¥è¿™é‡Œæˆ‘å»ºè®®é‡ç‚¹æè¿°ä¸‹è‡ªå·±è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œä¼˜åŒ–äº†ä»€ä¹ˆåœ°æ–¹ï¼›æ¯”å¦‚ï¼š è§£å†³äº† XX æœåŠ¡è¯·æ±‚è¶…æ—¶çš„é—®é¢˜ã€‚ ä¼˜åŒ–äº†æ¥å£ï¼Œå°† QPS ç”± 1000 æå‡åˆ°äº† 5000 ç­‰ç­‰ã€‚ å¤§æ¦‚æ˜¯è¿™ä¸ªæ–¹å‘çš„ä»‹ç»ã€‚ éœ€è¦é¿å…åŒæ—¶ç®€å†ä¸­ä¹Ÿæœ‰è®¸å¤šéœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚ é¦–å…ˆæ˜¯å°‘ç”¨ç²¾é€šçš„å­—çœ¼ï¼ŒçœŸçš„ç²¾é€šä¹Ÿå°±ç®—äº†ï¼Œä¸ç„¶ä¸€å®šä¼šè¢«ä»”ç»†è¯¢é—®ã€‚ å†ä¸€ä¸ªæ˜¯åŸºæœ¬é”™è¯¯å°½é‡å°‘å‡ºï¼Œæ¯”å¦‚è¿™æ ·çš„ï¼š è¿™æ˜¯å½“æ—¶éš¾å¾—çœ‹åˆ°è´´äº† GitHub åœ°å€ï¼Œåå­—å±…ç„¶è¿˜å†™é”™ã€‚ä¸è¿‡æˆ‘è¿˜æ˜¯ç‚¹è¿›å»çœ‹äº†ï¼Œä¹Ÿæ˜¯æ²¡å•¥è¥å…»ã€‚ ç”šè‡³ä¹‹å‰è¿˜æ”¶åˆ°ä¸€å°ç®€å†ï¼Œæœ€è¿‘ä¸€æ¬¡çš„å·¥ä½œç»å†ç«Ÿç„¶æ˜¯å…¬å¸ CEOï¼Œä½†ä¸€çœ‹å·¥ä½œå¹´çºªä¹Ÿæ‰ 25 å²å·¥ä½œä¸‰å¹´è€Œå·²ã€‚ è¿™æ ·çš„æè¿°å°±éå¸¸å°´å°¬ï¼Œå»ºè®®å¦‚æœæ˜¯åˆ›ä¸šè€…çš„èº«ä»½æ²¡ä»€ä¹ˆé—®é¢˜ã€‚ä½†è¿™ä¹ˆå¤§ä¸€ä¸ª title æ˜¾ç„¶ä¸é€‚åˆæ‹¿æ¥é¢è¯•ã€‚ è¿˜æœ‰å°±æ˜¯é™„ä»¶æ ¼å¼ï¼Œå»ºè®®æœ€å¥½ä½¿ç”¨ PDF è¿™æ ·é€šç”¨çš„æ ¼å¼åœ¨æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿæ‰“å¼€éƒ½æ²¡é—®é¢˜ã€‚ word å°±éå¸¸å®¹æ˜“å‡ºç°å˜å½¢ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·çš„æˆ‘åªèƒ½çœ‹åˆ°èº«é«˜ã€‚ 1~3 å¹´ç”±äºç°é˜¶æ®µæˆ‘ä¸»è¦å…³æ³¨çš„æ˜¯ 1~5 å¹´è¿™ä¸ªèŒƒå›´ï¼Œé€šå¸¸ä¹Ÿä¼šåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µã€‚ 1~3 å¹´å¤šæ•°æ˜¯åˆä¸­çº§å²—ä½ï¼Œè¿™éƒ¨åˆ†æœ‹å‹æˆ‘è§‰å¾—åº”å½“æŠŠç®€å†é‡å¿ƒæ”¾åœ¨å­¦ä¹ èƒ½åŠ›ã€ç§¯æä¸»åŠ¨æ€§ä¸Šé¢ã€‚ å› ä¸ºåœ¨é¡¹ç›®ç»éªŒå¹¶æ²¡æœ‰é‚£ä¹ˆä¸°å¯Œï¼Œæ‰€æœ‰éœ€è¦ä»å…¶ä»–æ–¹é¢ä½“ç°å‡ºè‡ªå·±çš„ä¼˜åŠ¿ã€‚æ¯”å¦‚è¯´æ‰å®çš„åŸºç¡€ã€‚ 3~5 å¹´3~5 å¹´ä¸€èˆ¬æ˜¯ä¸­é«˜çº§å²—ä½ï¼Œè¿™æ—¶æˆ‘è§‰å¾—éœ€è¦çªå‡ºè‡ªå·±è§£å†³é—®é¢˜çš„èƒ½åŠ›ã€è®¾è®¡äº§å‡ºæ–¹æ¡ˆè¿™äº›æŠ€èƒ½è¡¨ç°å‡ºæ¥ã€‚ åŒæ—¶æœ€å¥½åœ¨ç®€å†ä¸­ä½“ç°å‡ºå¹¶å‘ã€å¤šçº¿ç¨‹ã€åˆ†å¸ƒå¼ç›¸å…³çš„ç»éªŒã€‚ æœ€æ€•çš„å°±æ˜¯è¿™ä¸ªé˜¶æ®µç»™äººçš„æ„Ÿè§‰è¿˜æ˜¯ 1~3 å¹´çš„æ°´å¹³ï¼Œä½†è¦çš„è–ªèµ„å¯æ˜¯ N å€ã€‚ æ€»ç»“æœ€åæ¨èä¸€ä¸ªåœ¨çº¿ç®€å†æ¨¡æ¿ï¼šhttp://cv.ftqq.com/ ã€‚ï¼ˆä¸æ˜¯å¹¿å‘Šï¼Œæˆ‘ä¸ªäººä¹Ÿåœ¨ç”¨ã€‚easy å¤§ä½¬çœ‹åˆ°äº†è®°å¾—ç»™æˆ‘å¹¿å‘Šè´¹ã€‚ï¼‰ ä»¥ä¸Šå…¨æ˜¯æˆ‘ä¸ªäººä¸»è§‚æ„Ÿå—ï¼Œæ¬¢è¿ç•™è¨€è®¨è®ºã€‚ ä½ çš„ç‚¹èµä¸è½¬å‘æ˜¯æœ€å¤§çš„æ”¯æŒã€‚]]></content>
      <categories>
        <category>å°æŠ€å·§</category>
      </categories>
      <tags>
        <tag>ç®€å†</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[GitHub 1W star æˆå°±è¾¾æˆï¼]]></title>
    <url>%2F2018%2F08%2F17%2Fpersonal%2F1W-star%2F</url>
    <content type="text"><![CDATA[èµ·å› æ„Ÿè°¢å„ä½å¤§ä½¬çš„æ”¯æŒæ”¶è·äº†äººç”Ÿç¬¬ä¸€ä¸ªï¼ˆå¾ˆæœ‰å¯èƒ½ä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªï¼‰1W star é¡¹ç›®ã€‚ ä»ä»Šå¹´ä¸€æœˆä»½åˆ›å»ºé¡¹ç›®è‡³ä»Š 8 ä¸ªæœˆæ—¶é—´ã€‚ ä¸€å…±å…³é—­äº† 27 ä¸ª issueï¼Œ47 ä¸ª RPï¼Œæ€»å…±æœ‰ 11 ä½å°ä¼™ä¼´å‚ä¸ç»´æŠ¤ã€‚ ç¥å¥‡èˆ¬çš„è¿ç»­ä¸¤ä¸ªæœˆä¸Šäº† GitHub Java çƒ­é—¨æ¦œé¦–ã€‚ æ•´ä¸ªçƒ­åº¦èµ°åŠ¿å›¾ä¹Ÿæ˜¯ä¸€è·¯å‘åŒ—ï¼š è¿‡ç¨‹ä¸­ä¹Ÿæœ‰è®¸å¤šæœ‹å‹åé¦ˆå¾—åˆ°äº†å¸®åŠ©ï¼Œè‡ªå·±ç¡®å®æ²¡æƒ³åˆ°èƒ½èµ·åˆ°è¿™ä¹ˆå¥½çš„ä½œç”¨ã€‚ æ›´åè¶è¿™æœºä¼šæˆ‘æƒ³ç»™é¡¹ç›®é‡æ–°æ¢ä¸ªåå­—ï¼Œå› ä¸ºæˆ‘å‘ç°åšåˆ°ç°åœ¨è¿™é‡Œé¢å¹¶ä¸ä»…ä»…åŒ…å«é¢è¯•çš„å†…å®¹ã€‚ æˆ‘ä»¬ä¹Ÿä¸åº”è¯¥åªä¸ºäº†é¢è¯•è€Œä½¿ç”¨è¯¥é¡¹ç›®ï¼Œé‡Œé¢æ‰€æœ‰çš„æŠ€æœ¯å†…å®¹æˆ‘è®¤ä¸ºéƒ½åº”è¯¥å¯¹å®é™…å¼€å‘èµ·åˆ°å¸®åŠ©ï¼Œè®©å¤§å®¶å°‘èµ°å¼¯è·¯ã€‚ æ‰€æœ‰æˆ‘æŠŠé¡¹ç›®é‡å‘½åä¸ºï¼š JCSprout : Java Core Sproutï¼šå¤„äºèŒèŠ½é˜¶æ®µçš„ Java æ ¸å¿ƒçŸ¥è¯†åº“ã€‚ è¿˜åˆ›å»ºäº† logoã€‚ æ•´ä¸ªæŠ€æœ¯é“è·¯éå¸¸æ¼«é•¿ï¼Œè¿™ä¸€ç‚¹å°æˆå°±åªæ˜¯ä¸€é¢—å°èŒèŠ½ï¼Œå¸Œæœ›æœ€åèƒ½ç”Ÿæ ¹å‘èŠ½ã€‚ æœªæ¥ä»Šåæˆ‘ä¾ç„¶ä¼šæŒç»­ç»´æŠ¤ï¼Œä¹Ÿå¸Œæœ›æ›´å¤šçš„æœ‹å‹å‚ä¸è¿›æ¥ã€‚ è¿˜è¦æŠŠä¹‹å‰ç»™è‡ªå·±æŒ–çš„å‘å¡«å¥½ï¼š HTTP SpringBoot Tomcat ç­‰ åæœŸè¿˜ä¼šç»§ç»­æ·»åŠ ä¸€äº›æºç è§£æã€æœ€ä½³å®è·µç­‰å†…å®¹ã€‚ è¿˜æ²¡æœ‰å…³æ³¨çš„æœ‹å‹éš¾é“ä¸æƒ³è¿›æ¥çœ‹çœ‹å˜›ï¼Ÿæœ€æ–°åœ°å€ï¼š https://github.com/crossoverJie/JCSprout ä½ çš„ç‚¹èµä¸è½¬å‘æ˜¯æœ€å¤§çš„æ”¯æŒã€‚]]></content>
      <categories>
        <category>Person</category>
        <category>GitHub</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•æˆä¸ºä¸€ä½ã€Œä¸é‚£ä¹ˆå·®ã€çš„ç¨‹åºå‘˜]]></title>
    <url>%2F2018%2F08%2F12%2Fpersonal%2Fhow-to-be-developer%2F</url>
    <content type="text"><![CDATA[å‰è¨€å·²ç»è®°ä¸æ¸…æœ‰å¤šå°‘è¯»è€…é—®è¿‡ï¼š åšä¸»ï¼Œä½ æ˜¯æ€ä¹ˆå­¦ä¹ çš„ï¼Ÿåƒæˆ‘è¿™æ ·çš„æƒ…å†µæœ‰å•¥å¥½çš„å»ºè®®å˜›ï¼Ÿ ä¹Ÿä¸çŸ¥é“å•¥æ—¶å€™æˆ‘å±…ç„¶æˆäººç”Ÿå¯¼å¸ˆäº†ã€‚å½“ç„¶æˆ‘ä¸æ’æ–¥è¿™äº›é—®é¢˜ï¼Œå’Œå¤§å®¶äº¤æµéƒ½æ˜¯å­¦ä¹ çš„è¿‡ç¨‹ã€‚ å› æ­¤ä¹Ÿè®¸è¯ºä¼šå‡†å¤‡ä¸€ç¯‡å…³äºå­¦ä¹ æ–¹é¢çš„æ–‡ç« ï¼›æ‰€ä»¥æœ¬æ–‡å…¶å®å‡†å¤‡äº†å¾ˆä¹…ï¼Œç¯‡å¹…è¾ƒé•¿ï¼Œå¤§å®¶è€å¿ƒçœ‹å®Œå¸Œæœ›èƒ½æœ‰æ”¶è·ã€‚ ä»¥ä¸‹å†…å®¹ä»…ä»£è¡¨æˆ‘ä»ä¸šä»¥æ¥æ‰€ç§¯ç´¯çš„ç›¸å…³ç»éªŒï¼Œæˆ‘ä¼šä»ç¡¬æŠ€èƒ½ã€è½¯å®åŠ›è¿™äº›æ–¹é¢å°½é‡é˜è¿°æˆ‘æ‰€è®¤ä¸ºçš„ â€œä¸é‚£ä¹ˆå·®çš„ç¨‹åºå‘˜â€ åº”å½“åšåˆ°å“ªäº›æŠ€èƒ½ã€‚ æŠ€èƒ½æ ‘ä½œä¸ºä¸€åç ä»£ç çš„æŠ€æœ¯å·¥äººï¼Œæ€ä¹ˆè¯´å¹²çš„è¿˜æ˜¯æŠ€æœ¯æ´»ã€‚ æ—¢ç„¶æ˜¯æŠ€æœ¯æ´»é‚£ä¸“ä¸šå®åŠ›å°±å¾—è¿‡ç¡¬ï¼Œä¸‹é¢æˆ‘ä¼šæŒ‰ç…§ç›¸å…³ç±»åˆ«è°ˆè°ˆæˆ‘ä»¬åº”è¯¥æŒæ¡å“ªäº›ã€‚ è®¡ç®—æœºåŸºç¡€ä¸€åå’Œç”µè„‘æ‰“äº¤é“çš„å·¥ç§ï¼Œè®¡ç®—æœºæ˜¯æˆ‘ä»¬èµ–ä»¥ç”Ÿå­˜çš„å·¥å…·ã€‚æ‰€ä»¥ä¸€äº›åŸºç¡€æŠ€èƒ½æ˜¯æˆ‘ä»¬åº”è¯¥å’Œå¿…é¡»æŒæ¡çš„ã€‚ æ¯”å¦‚ç½‘ç»œç›¸å…³çš„çŸ¥è¯†ã€‚ å…¶ä¸­å°±åŒ…å«äº† TCP åè®®ï¼Œå®ƒå’Œ UDP çš„å·®å¼‚ã€‚éœ€è¦ç†è§£ TCP ä¸‰æ¬¡æ¡æ‰‹çš„å«ä¹‰ï¼Œæ‹†ã€ç²˜åŒ…ç­‰é—®é¢˜ã€‚ å½“ç„¶ä¸Šå±‚æœ€å¸¸è§çš„ HTTP ä¹Ÿéœ€è¦äº†è§£ï¼Œç”šè‡³æ˜¯ç†Ÿæ‚‰ã€‚ è¿™å—æ¨èã€Šå›¾è§£ HTTPã€‹ä¸€ä¹¦ã€‚ æ¥ç€æ˜¯æ“ä½œç³»ç»Ÿç›¸å…³çŸ¥è¯†ã€‚ ç”±äºå·¥ä½œåä½ å†™çš„å¤§éƒ¨åˆ†ä»£ç éƒ½æ˜¯è¿è¡Œåœ¨ Linux æœåŠ¡å™¨ä¸Šï¼Œæ‰€ä»¥å¯¹äºè¿™ä¸ªçœ‹å®ƒè„¸è‰²è¡Œäº‹ä¸»ä½ ä¹Ÿå¾—ç†Ÿæ‚‰æ‰è¡Œã€‚ æ¯”å¦‚è¿›ç¨‹ã€çº¿ç¨‹ã€å†…å­˜ç­‰æ¦‚å¿µï¼›æœåŠ¡å™¨å¸¸è§çš„å‘½ä»¤ä½¿ç”¨ï¼Œè¿™ä¸ªæ²¡å•¥çªé—¨å°±æ˜¯å¾—å¹³æ—¶å¤šæ•²æ•²å¤šæ€»ç»“ã€‚ æˆ‘ä¹Ÿæ˜¯ä¹‹å‰å…¼èŒäº†åŠå¹´è¿ç»´æ‰ç®—æ˜¯å¯¹è¿™ä¸€å—æ¯”è¾ƒç†Ÿæ‚‰ã€‚ Linux è¿™ä¸ªè‡ªç„¶æ˜¯æ¨èä¸šç•Œéå¸¸å‡ºåçš„ã€Šé¸Ÿå“¥çš„ Linux ç§æˆ¿èœã€‹ã€‚ å½“ä½œä¸ºä¸€ä¸ªåˆå­¦è€…å­¦ä¹ è¿™äº›ä¸œè¥¿æ—¶è‚¯å®šä¼šè§‰å¾—æ¯ç‡¥ä¹å‘³ï¼Œå¤§å­¦ä¸€èˆ¬åœ¨è®²ä¸“ä¸šè¯¾ä¹‹å‰éƒ½ä¼šæœ‰è¿™äº›åŸºç¡€å­¦ç§‘ã€‚æˆ‘ç›¸ä¿¡å¤§éƒ¨åˆ†åŒå­¦åº”è¯¥éƒ½æ²¡æ€ä¹ˆä»”ç»†å¬è®²ï¼Œå› ä¸ºç¡®å®è¿™äº›ä¸œè¥¿å°±ç®—æ˜¯å­¦ä¼šäº†è®°ç†Ÿäº†ä¹Ÿæ²¡æœ‰å¤ªå¤šç›´æ¥çš„æ¿€åŠ±ã€‚ ä½†å½“ä½ å·¥ä½œå‡ å¹´ä¹‹åä¼šå‘ç°ï¼Œåªè¦ä½ è¿˜åœ¨åšè®¡ç®—æœºç›¸å…³çš„å·¥ä½œï¼Œè¿™äº›éƒ½æ˜¯ç»•ä¸å¼€çš„ï¼Œå½“å“ªå¤©è¿™äº›çŸ¥è¯†ä¸ç»æ„çš„å¸®åŠ©åˆ°ä½ æ—¶ä½ ä¼šåº†å¹¸å½“åˆæ­£ç¡®çš„é€‰æ‹©ã€‚ æ•°æ®ç»“æ„ä¸ç®—æ³•æ¥ä¸‹æ¥ä¼šè°ˆåˆ°å¦ä¸€é—¨æ¯ç‡¥çš„è¯¾ç¨‹ï¼šæ•°æ®ç»“æ„ã€‚ è¿™å—å½“åˆåœ¨å¤§å­¦æ—¶ä¹Ÿæ˜¯æœ€ä¸å—å¾…è§çš„ä¸€é—¨è¯¾ç¨‹ï¼Œä¹Ÿæ˜¯æˆ‘å”¯ä¸€æŒ‚è¿‡çš„ç§‘ç›®ã€‚ è®°å¾—å½“æ—¶æ¯æ¬¡ä¸Šè¯¾è€å¸ˆå°±è®©å¤§å®¶ç”¨ C è¯­è¨€ç»ƒä¹ ä¹¦ä¸Šçš„ä¹ é¢˜ï¼Œçœ‹ç€ä¸€ä¸ªä¸ªæ‹†å¼€éƒ½è®¤è¯†çš„å­—æ¯ç»„åˆåœ¨ä¸€èµ·å°±å…­äº²ä¸è®¤æˆ‘æœæ–­é€‰æ‹©äº†æ”¾å¼ƒã€‚ è¿™ä¹Ÿé€ æˆç°åœ¨çš„æˆ‘æ¯éš”ä¸€æ®µæ—¶é—´å°±è¦çœ‹äºŒå‰æ ‘ã€çº¢é»‘æ ‘ã€æ ˆã€é˜Ÿåˆ—ç­‰çŸ¥è¯†ï¼ŒåŠ æ·±å°è±¡ã€‚ ç®—æ³•è¿™ä¸ªä¸œè¥¿æˆ‘ç¡®å®æ²¡æœ‰å•¥å‘è¨€æƒï¼Œä¹‹å‰åšæŒåˆ·äº†éƒ¨åˆ† LeetCode çš„é¢˜ç›®ä¹Ÿå¤§å¤šåœç•™åœ¨åˆä¸­çº§ã€‚ ä½†åƒåŸºæœ¬çš„æŸ¥æ‰¾ã€æ’åºç®—æ³•æˆ‘è§‰å¾—è¿˜æ˜¯è¦ä¼šçš„ï¼Œä¸ä¸€å®šè¦æ‰‹å†™å‡ºæ¥ä½†è¦ç†è§£å…¶æ€è·¯ã€‚ æ‰€ä»¥å¼ºçƒˆå»ºè®®è¿˜åœ¨å¤§å­¦åŒå­¦ä»¬ç§¯æå‚ä¸ä¸€äº› ACM æ¯”èµ›ï¼Œç»å¯¹æ˜¯ä»Šåçš„åŠ åˆ†åˆ©å™¨ã€‚ è¿™ä¸€å—å†…å®¹å¯èƒ½ä¼šåœ¨åº”å±Šç”Ÿæ ¡æ‹›æ—¶å‘æŒ¥è¾ƒå¤§ä½œç”¨ï¼Œåœ¨å·¥ä½œä¸­å¦‚æœä½ çš„æœ¬èŒå·¥ä½œæ˜¯ Java Web å¼€å‘çš„è¯ï¼Œè¿™ä¸€å—æ¶‰çŒçš„å‡ ç‡è¿˜æ˜¯æ¯”è¾ƒä½ã€‚ ä¸è¿‡ä¸€æ—¦ä½ æ¥è§¦åˆ°äº†æ¨¡å‹è®¾è®¡ã€ä¸­é—´ä»¶ã€é«˜æ•ˆå­˜å‚¨ã€æŸ¥è¯¢ç­‰å†…å®¹è¿™äº›ä¹Ÿæ˜¯ç»•ä¸è¿‡çš„åã€‚ è¿™å—å†…å®¹å’Œä¸Šé¢çš„è®¡ç®—æœºåŸºç¡€å·®ä¸å¤šï¼Œå¯¹äºæˆ‘ä»¬ Java å¼€å‘æ¥è¯´æˆ‘è§‰å¾—å¹³æ—¶é™¤äº†å¤šåˆ·åˆ· LeetCode åŠ æ·±å°è±¡ä¹‹å¤–ï¼Œåœ¨æ—¥å¸¸å¼€å‘ä¸­æ¯é€‰æ‹©ä¸€ä¸ªå®¹å™¨å­˜æ”¾æ•°æ®æ—¶æƒ³æƒ³ä¸ºä»€ä¹ˆé€‰å®ƒï¼Ÿæœ‰æ²¡æœ‰æ›´å¥½çš„å­˜å‚¨æ–¹å¼ï¼Ÿå†™å…¥ã€æŸ¥è¯¢æ•ˆç‡å¦‚ä½•ï¼Ÿ åŒæ ·çš„åšæŒä¸‹å»ï¼Œä»Šåè‚¯å®šæ”¶è´§é¢‡ä¸°ã€‚ åŒæ—¶æ¨èã€Šç®—æ³•ï¼ˆç¬¬4ç‰ˆï¼‰ã€‹ Java åŸºç¡€è¿™é‡Œå¤§éƒ¨åˆ†çš„è¯»è€…éƒ½æ˜¯ Java ç›¸å…³ï¼Œæ‰€ä»¥è¿™ä¸ªå¼ºç›¸å…³çš„æŠ€èƒ½éå¸¸é‡è¦ã€‚ Java åŸºç¡€åˆ™æ˜¯èµ°å‘ Java é«˜çº§çš„å¿…ç»ä¹‹è·¯ã€‚ è¿™é‡ŒæŠ›å¼€åŸºæœ¬è¯­æ³•ä¸è°ˆï¼Œé‡ç‚¹è®¨è®ºå®é™…å·¥ä½œä¸­é«˜é¢‘æ¬¡çš„ä¸œè¥¿ã€‚ åŸºæœ¬å®¹å™¨ï¼Œå¦‚ï¼šHashMapã€ArrayListã€HashSetã€LinkedList ç­‰ï¼Œä¸ä½†è¦ä¼šç”¨è¿˜å¾—äº†è§£å…¶ä¸­çš„åŸç†ã€‚è¿™æ ·æ‰èƒ½åœ¨ä¸åŒçš„åœºæ™¯é€‰æ‹©æœ€ä¼˜çš„è®¾è®¡ã€‚ IOã€NIO ä¹Ÿæ˜¯éœ€è¦æŒæ¡ã€‚æ—¥å¸¸å¼€å‘ä¸­å¤§éƒ¨åˆ†æ˜¯åœ¨å’Œç£ç›˜ã€ç½‘ç»œï¼ˆå†™æ—¥å¿—ã€æ•°æ®åº“ã€Redisï¼‰æ‰“äº¤é“ï¼Œè¿™äº›éƒ½æ˜¯ IO çš„è¿‡ç¨‹ã€‚ å¸¸è§çš„è®¾è®¡æ¨¡å¼å¦‚ï¼šä»£ç†ã€å·¥å‚ã€å›è°ƒã€æ„å»ºè€…æ¨¡å¼ï¼Œè¿™å¯¹å¼€å‘çµæ´»ã€æ‰©å±•æ€§å¼ºçš„åº”ç”¨æœ‰å¾ˆå¤§å¸®åŠ©ã€‚ Java å¤šçº¿ç¨‹æ˜¯éå¸¸é‡è¦çš„ç‰¹æ€§ï¼Œæ—¥å¸¸å¼€å‘å¾ˆå¤šã€‚èƒ½ç†è§£çº¿ç¨‹æ¨¡å‹ã€å¤šçº¿ç¨‹ä¼˜ç¼ºç‚¹ã€ä»¥åŠå¦‚ä½•é¿å…ã€‚ è‰¯å¥½çš„å•æµ‹ä¹ æƒ¯ï¼Œå¾ˆå¤šäººè§‰å¾—å†™å•æµ‹æµªè´¹æ—¶é—´æ²¡æœ‰æ„ä¹‰ã€‚ä½†æ­£æ˜¯æœ‰äº†å•æµ‹å¯ä»¥æå‰æš´éœ²å‡ºè®¸å¤šé—®é¢˜ï¼Œå‡å°‘æµ‹è¯•è¿”å·¥å‡ ç‡ï¼Œæé«˜ä»£ç è´¨é‡ã€‚ è‰¯å¥½çš„ç¼–ç¨‹è§„èŒƒï¼Œè¿™ä¸ªå¯ä»¥å‚è€ƒã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹ä»¥åŠåœ¨å®ƒåŸºç¡€ä¸Šä¼˜åŒ–çš„ã€Šå”¯å“ä¼š Java æ‰‹å†Œã€‹ ã€ŠJavaæ ¸å¿ƒæŠ€æœ¯Â·å· Iã€‹å€¼å¾—æ¨èã€‚ å¤šçº¿ç¨‹åº”ç”¨æœ‰äº†æ‰å®çš„åŸºç¡€ä¹‹åæ¥è°ˆè°ˆå¤šçº¿ç¨‹ã€å¹¶å‘ç›¸å…³çš„å†…å®¹ã€‚ æƒ³è®©è‡ªå·±çš„ title é‡ŒåŠ ä¸Šâ€œé«˜çº§â€ä¸¤å­—è‚¯å®šå¾—ç»è¿‡å¹¶å‘çš„æ´—ç¤¼ã€‚ è¿™é‡Œè°ˆè®ºçš„å¹¶å‘ä¸»è¦æ˜¯æŒ‡å•åº”ç”¨é‡Œçš„åœºæ™¯ï¼Œå¤šåº”ç”¨çš„å¯ä»¥çœ‹åæ–‡çš„åˆ†å¸ƒå¼å†…å®¹ã€‚ å¤šçº¿ç¨‹çš„å‡ºç°ä¸»è¦æ˜¯ä¸ºäº†æé«˜ CPU çš„åˆ©ç”¨ç‡ã€ä»»åŠ¡çš„æ‰§è¡Œæ•ˆç‡ã€‚ä½†å¹¶ä¸æ˜¯ç”¨äº†å¤šçº¿ç¨‹å°±ä¸€å®šèƒ½è¾¾åˆ°è¿™æ ·çš„æ•ˆæœï¼Œå› ä¸ºå®ƒåŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸€äº›é—®é¢˜ï¼š ä¸Šä¸‹æ–‡åˆ‡æ¢ å…±äº«èµ„æº å¯è§æ€§ã€åŸå­æ€§ã€æœ‰åºæ€§ç­‰ã€‚ ä¸€æ—¦ä½¿ç”¨äº†å¤šçº¿ç¨‹é‚£è‚¯å®šä¼šæ¯”å•çº¿ç¨‹çš„ç¨‹åºè¦å˜å¾—å¤æ‚å’Œä¸å¯æ§ï¼Œç”šè‡³ä½¿ç”¨ä¸å½“è¿˜ä¼šæ¯”å•çº¿ç¨‹æ…¢ã€‚æ‰€ä»¥è¦è€ƒè™‘æ¸…æ¥šæ˜¯å¦çœŸçš„éœ€è¦å¤šçº¿ç¨‹ã€‚ ä¼šç”¨äº†ä¹‹åä¹Ÿè¦è€ƒè™‘ä¸ºå•¥å¤šçº¿ç¨‹ä¼šå‡ºç°é‚£æ ·çš„é—®é¢˜ï¼Œè¿™æ—¶å°±éœ€è¦ç†è§£å†…å­˜æ¨¡å‹ã€å¯è§æ€§ä¹‹ç±»çš„çŸ¥è¯†ç‚¹ã€‚ åŒæ ·çš„è§£å†³æ–¹å¼åˆæœ‰å“ªäº›ï¼Ÿå„è‡ªçš„ä¼˜ç¼ºç‚¹ä¹Ÿéœ€è¦æŒæ¡ã€‚ è°ˆåˆ°å¤šçº¿ç¨‹å°±ä¸å¾—ä¸æå¹¶å‘åŒ…ä¸‹é¢çš„å†…å®¹ java.util.concurrentã€‚ æœ€å¸¸ç”¨åŠéœ€è¦æŒæ¡çš„æœ‰ï¼š åŸå­ç±»ï¼šç”¨äºå¹¶å‘åœºæ™¯çš„åŸå­æ“ä½œã€‚ é˜Ÿåˆ—ã€‚å¸¸ç”¨äºè§£è€¦ï¼Œéœ€è¦äº†è§£å…¶å®ç°åŸç†ã€‚ å¹¶å‘å·¥å…·ï¼Œå¦‚ ConcurrentHashMapã€CountDownLatch ä¹‹ç±»çš„å·¥å…·ä½¿ç”¨ä»¥åŠåŸç†ã€‚ çº¿ç¨‹æ± ä½¿ç”¨ï¼Œä»¥åŠç›¸å…³åŸç†ã€‚ é”ç›¸å…³å†…å®¹ï¼šsynchronizedã€ReentrantLock çš„ä½¿ç”¨åŠåŸç†ã€‚ è¿™ä¸€å—çš„å†…å®¹å¯ä»¥ç„¶æˆ‘ä»¬çŸ¥é“å†™ JDK å¤§ç‰›å¤„ç†å¹¶å‘çš„æ€è·¯ï¼Œå¯¹æˆ‘ä»¬è‡ªå·±ç¼–å†™é«˜è´¨é‡çš„å¤šçº¿ç¨‹ç¨‹åºä¹Ÿæœ‰å¾ˆå¤šå¸®åŠ©ã€‚ æ¨èã€ŠJava å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹å¾ˆå¥½çš„å¹¶å‘å…¥é—¨ä¹¦ç±ã€‚ JVM è™šæ‹Ÿæœºæƒ³è¦æ·±å…¥ Java ï¼ŒJVM æ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚å¯¹äºå¤§éƒ¨åˆ†å·¥ä½œ 1~3 å¹´çš„å¼€å‘è€…æ¥è¯´ç›´æ¥æ¥è§¦è¿™ä¸€äº›å†…å®¹æ˜¯æ¯”è¾ƒå°‘çš„ã€‚ åˆ°äº† 3~5 å¹´è¿™ä¸ªé˜¶æ®µå°±å¿…é¡»å¾—äº†è§£äº†ï¼Œä»¥ä¸‹å†…å®¹æˆ‘è§‰å¾—æ˜¯å¿…é¡»è¦æŒæ¡çš„ï¼š JVM å†…å­˜åˆ’åˆ†ï¼ŒçŸ¥é“å“ªå—å†…å­˜å­˜æ”¾å“ªäº›å†…å®¹ï¼›çº¿ç¨‹å®‰å…¨ä¸å¦ï¼›å†…å­˜ä¸å¤Ÿæ€ä¹ˆå¤„ç†ç­‰ã€‚ ä¸åŒæƒ…å†µçš„å†…å­˜æº¢å‡ºã€æ ˆæº¢å‡ºï¼Œä»¥åŠå®šä½è§£å†³æ–¹æ¡ˆã€‚ åˆ†ä»£çš„åƒåœ¾å›æ”¶ç­–ç•¥ã€‚ çº¿ä¸Šé—®é¢˜å®šä½åŠç›¸å…³è§£å†³æ–¹æ¡ˆã€‚ ä¸€ä¸ªç±»çš„åŠ è½½ã€åˆ›å»ºå¯¹è±¡ã€åƒåœ¾å›æ”¶ã€ç±»å¸è½½çš„æ•´ä¸ªè¿‡ç¨‹ã€‚ æŒæ¡è¿™äº›å†…å®¹çœŸçš„å¯¹å®é™…åˆ†æé—®é¢˜èµ·åˆ°å·¨å¤§å¸®åŠ©ã€‚ å¯¹æ­¤å¼ºåŠ›æ¨èã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ï¼Œè¿™æœ¬ä¹¦ååå¤å¤çœ‹è¿‡å¥½å‡ éï¼Œæ¯ä¸ªé˜¶æ®µé˜…è¯»éƒ½æœ‰ä¸åŒçš„æ”¶è·ã€‚ æ•°æ®åº“åš WEB åº”ç”¨å¼€å‘çš„åŒå­¦è‚¯å®šè¦å’Œæ•°æ®åº“æ‰“ä¸å°‘äº¤é“ï¼Œè€Œä¸”é€šå¸¸æ¥è¯´ä¸€ä¸ªç³»ç»Ÿæœ€å…ˆå‡ºç°ç“¶é¢ˆå¾€å¾€éƒ½æ˜¯æ•°æ®åº“ï¼Œè¯´æ•°æ®åº“æ˜¯å‹åˆ°ç³»ç»Ÿçš„æœ€åä¸€æ ¹ç¨»è‰ä¸€ç‚¹ä¹Ÿä¸ä¸ºè¿‡ã€‚ æ‰€ä»¥å¯¹æ•°æ®åº“çš„æŒæ¡ä¹Ÿæ˜¯éå¸¸æœ‰å¿…è¦ã€‚æ‹¿äº’è”ç½‘ç”¨çš„è¾ƒå¤šçš„ MySQL æ•°æ®åº“ä¸ºä¾‹ï¼Œä¸€äº›å¿…é¡»æŒæ¡çš„çŸ¥è¯†ç‚¹ï¼š ç´¢å¼•çš„æ•°æ®ç»“æ„åŠåŸç†ã€å“ªäº›å­—æ®µåº”å½“åˆ›å»ºç´¢å¼•ã€‚ é’ˆå¯¹äºä¸€ä¸ªæ…¢ SQL çš„ä¼˜åŒ–æ€è·¯ã€‚ æ•°æ®åº“æ°´å¹³å‚ç›´æ‹†åˆ†çš„æ–¹æ¡ˆï¼Œéœ€è¦äº†è§£ä¸šç•Œå¸¸ç”¨çš„ MyCATã€sharding-sphere ç­‰ä¸­é—´ä»¶ã€‚ å¸¸è§„ä½¿ç”¨å¯ä»¥å‚è€ƒã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹ä¸­çš„æ•°æ®åº“ç« èŠ‚ï¼Œæƒ³è¦æ·±å…¥äº†è§£ MySQL é‚£è‚¯å®šå¾—æ¨èç»å…¸çš„ã€Šé«˜æ€§èƒ½ MySQLã€‹ä¸€ä¹¦äº†ã€‚ åˆ†å¸ƒå¼æŠ€æœ¯éšç€äº’è”ç½‘çš„å‘å±•ï¼Œä¼ ç»Ÿçš„å•ä½“åº”ç”¨è¶Šæ¥è¶Šä¸é€‚åˆç°æœ‰åœºæ™¯ã€‚ å› æ­¤åˆ†å¸ƒå¼æŠ€æœ¯å‡ºç°äº†ï¼Œè¿™å—æ¶µç›–çš„å†…å®¹å¤ªå¤šäº†ï¼Œç»éªŒæœ‰é™åªèƒ½åˆ—ä¸¾æˆ‘æ—¥å¸¸ä½¿ç”¨åˆ°çš„ä¸€äº›å†…å®¹ï¼š é¦–å…ˆæ˜¯ä¸€äº›åŸºç¡€ç†è®ºå¦‚ï¼šCAP å®šç†ï¼ŒçŸ¥é“åˆ†å¸ƒå¼ç³»ç»Ÿä¼šå¸¦æ¥çš„ä¸€äº›é—®é¢˜ä»¥åŠå„ä¸ªåº”ç”¨æƒè¡¡çš„æ–¹å¼ã€‚ äº†è§£è¿‘äº›å¹´å¤§çƒ­çš„å¾®æœåŠ¡ç›¸å…³å®šä¹‰ã€æ¥æºä»¥åŠå¯¹æ¯”ï¼Œæœ‰æ¡ä»¶çš„å¯ä»¥é˜…è¯» martin fowler çš„åŸæ–‡ Microservicesï¼Œæˆ–è€…ä¹Ÿå¯ä»¥æœç´¢ç›¸å…³çš„å›½å†…ç¿»è¯‘ã€‚ å¯¹ Dubboã€SpringCloud ç­‰åˆ†å¸ƒå¼æ¡†æ¶çš„ä½¿ç”¨ï¼Œæœ€å¥½æ˜¯è¦äº†è§£åŸç†ã€‚ æ¥ç€è¦å¯¹åˆ†å¸ƒå¼å¸¦æ¥çš„é—®é¢˜æå‡ºè§£å†³æ–¹æ¡ˆã€‚å¦‚åˆ†å¸ƒå¼é”ã€åˆ†å¸ƒå¼é™æµã€åˆ†å¸ƒå¼äº‹åŠ¡ã€åˆ†å¸ƒå¼ç¼“å­˜ã€åˆ†å¸ƒå¼ IDã€æ¶ˆæ¯ä¸­é—´ä»¶ç­‰ã€‚ ä¹Ÿè¦äº†è§£ä¸€äº›åˆ†å¸ƒå¼ä¸­çš„è´Ÿè½½ç®—æ³•ï¼šæƒé‡ã€Hashã€ä¸€è‡´æ€§ Hashã€æ•…éšœè½¬ç§»ã€LRU ç­‰ã€‚ æœ€å¥½èƒ½åšä¸€ä¸ªå®è·µå¦‚ï¼šç§’æ€æ¶æ„å®è·µ ä¹‹å‰æœ‰å¼€æºä¸€ä¸ªåˆ†å¸ƒå¼ç›¸å…³è§£å†³ç»„ä»¶ï¼š https://github.com/crossoverJie/distributed-redis-tool åŒæ—¶æ¨èä¸€æœ¬å…¥é—¨ç§‘æ™®ã€Šå¤§å‹ç½‘ç«™æŠ€æœ¯æ¶æ„ã€‹ï¼Œå‡ºç‰ˆæ—¶é—´æœ‰ç‚¹æ—©ï¼Œä»ä¸­å¯ä»¥å­¦ä¹ ä¸€äº›æ€è·¯ã€‚ æ‡‚ç‚¹æ¶æ„ç›¸ä¿¡å¤§å®¶éƒ½æœ‰ä¸€ä¸ªæ¶æ„å¸ˆçš„æ¢¦æƒ³ã€‚ æ¶æ„å¸ˆç»™äººçš„æ„Ÿè§‰å°±æ˜¯ç”»ç”»å›¾çº¸ï¼Œæ­å¥½æ¶å­ï¼Œä¸‹é¢çš„äººå‘˜æ¥æ·»ç –åŠ ç“¦æœ€ç»ˆäº§å‡ºã€‚ ä½†å…¶å®éœ€è¦çš„å†…åŠŸä¹Ÿè¦éå¸¸æ·±åšï¼Œå°±ä¸Šé¢åˆ—ä¸¾çš„æ ·æ ·éœ€è¦æŒæ¡ï¼Œåº•å±‚åˆ°æ“ä½œç³»ç»Ÿã€ç®—æ³•ï¼›ä¸Šå±‚åˆ°åº”ç”¨ã€æ¡†æ¶éƒ½éœ€è¦éå¸¸ç²¾é€šã€‚ï¼ˆPPT æ¶æ„å¸ˆé™¤å¤–ï¼‰ æˆ‘è‡ªèº«å‚ä¸æ¶æ„ç»éªŒä¹Ÿä¸å¤šï¼Œæ‰€ä»¥åªèƒ½æä¾›æœ‰é™çš„å»ºè®®ã€‚ é¦–å…ˆåˆ†å¸ƒå¼è‚¯å®šå¾—æŒæ¡ï¼Œæ¯•ç«Ÿç°åœ¨å¤§éƒ¨åˆ†çš„æ¶æ„éƒ½æ˜¯åŸºäºåˆ†å¸ƒå¼çš„ã€‚ è¿™å…¶ä¸­å°±å¾—æ ¹æ® CAP ç†è®ºç»“åˆé¡¹ç›®æƒ…å†µæ¥é€‰æ‹©ä¸€è‡´æ€§è¿˜æ˜¯å¯ç”¨æ€§ï¼ŒåŒæ—¶å¦‚ä½•åšå¥½é€‚åˆç°æœ‰å›¢é˜Ÿçš„æŠ€æœ¯é€‰å‹ã€‚ è¿™é‡Œæ¨èä¸‹å¼€æ¶›è€å¸ˆçš„ã€Šäº¿çº§æµé‡ç½‘ç«™æ¶æ„æ ¸å¿ƒæŠ€æœ¯ã€‹ï¼Œåˆ—ä¸¾äº†å¾ˆå¤šæ¶æ„å®ä¾‹ï¼Œä¸è¿‡ç½‘ä¸Šè¤’è´¬ä¸ä¸€ï¼Œä½†å¯¹äºåˆšå…¥é—¨æ¶æ„çš„èƒ½ç§‘æ™®ä¸å°‘çŸ¥è¯†ã€‚ å¦‚ä½•å­¦ä¹ è°ˆå®Œäº†æŠ€èƒ½æ ‘ï¼Œç°åœ¨æ¥èŠèŠå¦‚ä½•å­¦ä¹ ï¼Œè¿™ä¹Ÿæ˜¯è¢«é—®çš„æœ€å¤šçš„ä¸€ä¸ªè¯é¢˜ã€‚ è€Œå…³äºå­¦ä¹ è®¨è®ºçš„æœ€å¤šçš„ä¹Ÿæ˜¯çœ‹è§†é¢‘è¿˜æ˜¯çœ‹ä¹¦ï¼Ÿ è§†é¢‘ä¸å¾—ä¸æ‰¿è®¤è§†é¢‘æ˜¯è·å–çŸ¥è¯†æœ€ä¾¿æ·çš„æ¥æºï¼Œæ¯•ç«ŸåŒ…å«äº†å›¾ã€æ–‡ã€å£°ã€‚ å¤§å­¦å‡ å¹´æ—¶é—´å…¶å®æˆ‘ä¹Ÿæ²¡å¥½å¥½ä¸Šä¸“ä¸šè¯¾ï¼Œæˆ‘è®°å¾—çœŸæ­£å…¥é—¨ Java è¿˜æ˜¯ä¸€ä¸ªæš‘å‡èŠ±äº†ä¸¤ä¸ªæœˆçš„æ—¶é—´å¤©å¤©åœ¨å®¶é‡Œçœ‹ â€é©¬å£«å…µâ€œ è€å¸ˆçš„è§†é¢‘æ•™ç¨‹ï¼Œå½“æ—¶çš„èµ„æºä¹Ÿå¾ˆè€äº†ï¼Œè®°å¾—å¥½åƒæ˜¯ 07 å¹´å‡ºçš„è§†é¢‘ï¼ˆç”¨çš„è¿˜æ˜¯ Google ï¼‰ã€‚ é‚£æ®µæ—¶é—´æ—©èµ·æ™šç¡ï¼Œæ¯å¤©å­¦åˆ°ä¸œè¥¿ä¹‹åé©¬ä¸Šå®è·µï¼Œå¿ƒé‡Œä¹Ÿå¾ˆæœ‰æˆå°±æ„Ÿã€‚åæ¥å¼€å­¦ä¹‹åä¸€åº¦æˆä¸ºåŒå­¦ä»¬çœ¼ä¸­çš„â€å­¦éœ¸â€œäººç‰©ã€‚ ç°åœ¨æ‰“å¼€æˆ‘ 12 å¹´çš„ç”µè„‘ï¼Œç¡¬ç›˜é‡Œè¿˜èººç€å¥½å‡ å G çš„æ•™å­¦è§†é¢‘ã€‚ çœ‹ä¹¦å·¥ä½œåæ—¶é—´çœŸçš„å¾ˆå®è´µï¼Œå®Œå…¨æ²¡æœ‰äº†å­¦ç”Ÿç”Ÿæ¶¯çš„æƒ³å­¦å°±å­¦çš„è‡ªç”±ã€‚æ‰€ä»¥ç°åœ¨æˆ‘ä¸»è¦çŸ¥è¯†æ¥æºè¿˜æ˜¯ä¹¦ç±ã€‚ è¿™äº›æ˜¯æˆ‘æœ€è¿‘çœ‹çš„ä¹¦ï¼š çœ‹ä¹¦åˆä¼šæ¶‰åŠåˆ°ç”µå­ä¹¦å’Œçº¸è´¨ä¹¦çš„åŒºåˆ«ï¼Œæˆ‘ä¸ªäººæ¯”è¾ƒå–œæ¬¢çº¸è´¨ä¹¦ã€‚æ¯•ç«Ÿæˆ‘å¯ä»¥æ–¹ä¾¿çš„è®°ç¬”è®°ä»¥åŠå¯ä»¥éšæ—¶åˆ‡æ¢ç« èŠ‚ã€‚æœ€ä¸»è¦çš„è¿˜æ˜¯ä»å°å…»æˆçš„é—»ä¹¦é¦™çš„ä¹ æƒ¯ã€‚ çŸ¥è¯†ä»˜è´¹è¿‘å‡ å¹´çŸ¥è¯†ä»˜è´¹è¶Šæ¥è¶Šæµè¡Œï¼Œè®¸å¤šå¤§ä½¬ä¹ŸåŠ å…¥äº†è¿™ä¸ªè¡Œåˆ—ï¼Œäººä»¬ä¹Ÿé€æ¸åœ¨ä¹ æƒ¯ä¸ºçŸ¥è¯†å»ä»˜è´¹ã€‚ è¯´å®è¯å†™ä¸€å¥½ç¯‡æ–‡ç« å‡ºä¸€ä»½è§†é¢‘éƒ½éå¸¸ä¸å®¹æ˜“ï¼Œèƒ½æœ‰æ­£å‘çš„æ¿€åŠ±ï¼Œä½œè€…æ‰èƒ½æŒç»­è¾“å‡ºæ›´å¥½çš„å†…å®¹ã€‚ è¿™å—æˆ‘è§‰å¾—å›½å†…åšçš„æ¯”è¾ƒå¥½æˆ‘ä¹Ÿä¸ºä¹‹ä»˜è´¹çš„æœ‰æå®¢æ—¶é—´ã€å¤§ä½¬çš„çŸ¥è¯†æ˜Ÿçƒç­‰ã€‚ è¿™ä¸‰ç‚¹æ²¡æœ‰ç»å¯¹çš„å¥½åä¹‹åˆ†ï¼Œå…¶å®å¯ä»¥çœ‹å‡ºæˆ‘åˆšå…¥é—¨çš„æ—¶å€™çœ‹è§†é¢‘ï¼Œå·¥ä½œä¹‹åçœ‹ä¹¦åŠçŸ¥è¯†ä»˜è´¹å†…å®¹ã€‚ è§†é¢‘çš„å¥½å¤„æ˜¯å¯ä»¥è·Ÿç€é‡Œé¢è€å¸ˆçš„æ€è·¯ä¸€æ­¥ä¸€æ­¥å¾€ä¸‹èµ°ï¼Œæ¯”è¾ƒæœ‰éŸ³è§†é¢‘ä»£å…¥æ„Ÿå¼ºï¼Œå°±åƒå­¦æ ¡è€å¸ˆè®²è¯¾ä¸€æ ·ã€‚ ä½†ç”±äºå†…å®¹è¾ƒé•¿ä½¿è¯»è€…æ²¡æ³•çŸ¥æ™“å…¶ä¸­çš„é‡ç‚¹ï¼Œç”šè‡³éƒ½ä¸æ•¢å¿«è¿›ç”Ÿæ€•é”™è¿‡äº†å“ªä¸ªé‡è¦çŸ¥è¯†ï¼Œç°åœ¨ç”±äº IT è¶Šæ¥è¶Šç«ï¼Œç½‘ä¸Šçš„è§†é¢‘ä¹Ÿå¾ˆå¤šå¯¼è‡´è´¨é‡å‚å·®ä¸é½ä¹Ÿä¸æˆä½“ç³»ã€‚ è€Œçœ‹ä¹¦å¯ä»¥é€‰æ‹©æ€§çš„æµè§ˆè‡ªå·±æ„Ÿå…´è¶£çš„ç« èŠ‚ï¼Œè´¹è§£çš„å†…å®¹ä¹Ÿæ–¹ä¾¿åå¤é˜…è¯» æ‰€ä»¥å»ºè®®åˆšå…¥é—¨çš„åŒå­¦å¯ä»¥çœ‹çœ‹è§†é¢‘è·Ÿç€å­¦ï¼Œå‚ä¸å·¥ä½œä¸€æ®µæ—¶é—´åå¯ä»¥å°è¯•å¤šçœ‹çœ‹ä¹¦ã€‚ å½“ç„¶è¿™ä¸æ˜¯ç»å¯¹çš„ï¼Œæ‰¾åˆ°é€‚åˆè‡ªå·±çš„å­¦ä¹ æ–¹å¼å°±å¥½ã€‚ä½†ä¸ç®¡æ˜¯è§†é¢‘è¿˜æ˜¯çœ‹ä¹¦éƒ½è¦å¤šåšå¤šå®è·µã€‚ æ‰“é€ ä¸ªäººå“ç‰Œä¸ªäººå“ç‰Œçœ‹ä¼¼å¾ˆç¨‹åºå‘˜è¿™ä¸ªèŒä¸šä¸æ€ä¹ˆæ²¾è¾¹ï¼Œä½†åœ¨ç°ä»Šçš„äº’è”ç½‘æ—¶ä»£å¯¹äºæ¯ä¸ªäººæ¥è¯´éƒ½å¾ˆé‡è¦ã€‚ ä»¥å¾€æˆ‘ä»¬åœ¨å†™ç®€å†æˆ–æ˜¯è¯„ä¼°ä»–äººç®€å†çš„æ—¶å€™å¾€å¾€ä¸ä¼šæƒ³åˆ°å»ç½‘ç»œæœç´¢ä»–çš„ä¸ªäººä¿¡æ¯ï¼Œä½†åœ¨è¿™ä¸ªä¿¡æ¯çˆ†ç‚¸çš„æ—¶ä»£ä½ åœ¨ç½‘ä¸Šç•™ä¸‹çš„ä¸€ç‚¹å°è®°éƒ½èƒ½è¢«å‘ç°ã€‚ åšå®¢å› æ­¤æˆ‘ä»¬éœ€è¦ç»´æŠ¤å¥½è‡ªå·±çš„åç‰‡ï¼Œæ¯”å¦‚å…ˆæ­å»ºè‡ªå·±çš„ä¸ªäººåšå®¢ã€‚ åšå®¢çš„å¥½å¤„æˆ‘ä¹Ÿè°ˆè¿‡å‡ æ¬¡äº†ï¼Œå‰æœŸå…³æ³¨äººå°‘æ²¡å…³ç³»ï¼Œé‡è¦çš„æ˜¯åšæŒï¼Œå½“ä½ å†™åˆ° 50ã€100ç¯‡æ–‡ç« åä½ ä¼šå‘ç°è‡ªå·±åœ¨è¿™è¿‡ç¨‹ä¸­ä¸€å®šæ˜¯çš„åˆ°äº†æé«˜ã€‚ GitHubç¬¬äºŒç‚¹å°±å’ŒæŠ€æœ¯äººæ¯”è¾ƒç›¸å…³äº†ï¼šå‚ä¸ç»´æŠ¤å¥½è‡ªå·±çš„ GitHubã€‚ ç”±äº GitHub çš„ç‰¹æ®Šå±æ€§ï¼Œç»´æŠ¤å¥½åå¯ä»¥æ›´å¥½çš„æ‰“é€ ä¸ªäººå“ç‰Œã€‚ Talk is cheap. Show me the code å¯ä¸æ˜¯éšä¾¿è¯´è¯´çš„ã€‚ æƒ³è¦ç»´æŠ¤å¥½å¯ä»¥ä»å‡ ä¸ªæ–¹é¢ç€æ‰‹ï¼š å‚ä¸ä»–äººçš„é¡¹ç›®ï¼Œä¸ç®¡æ˜¯ä»£ç åº“è¿˜æ˜¯çŸ¥è¯†åº“éƒ½å¯ä»¥ï¼Œå…ˆèå…¥è¿›ç¤¾åŒºã€‚ å‘èµ·è‡ªå·±çš„å¼€æºé¡¹ç›®ï¼Œä¸ç®¡æ˜¯å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­çš„å°ç—›ç‚¹ï¼Œè¿˜æ˜¯ç²¾å¿ƒæ•´ç†çš„çŸ¥è¯†ç‚¹éƒ½å¯ä»¥ã€‚ ä½†è¿™è¿‡ç¨‹ä¸­æœ‰å‡ ç‚¹è¿˜æ˜¯è¦æ³¨æ„ï¼š æˆ‘ä»¬éœ€è¦éµå®ˆ GitHub çš„ç¤¾äº¤ç¤¼ä»ªã€‚èƒ½ç”¨è‹±æ–‡å°½é‡å°±ç”¨è‹±æ–‡ï¼Œç‰¹åˆ«æ˜¯åœ¨å›½å¤–å‚åº“ä¸­ã€‚ å°½é‡å°‘ push ä¸€äº›ä¸ä»£ç å·¥ä½œæ— å…³çš„å†…å®¹ï¼Œæˆ‘è®¤ä¸ºè¿™å¹¶ä¸èƒ½æé«˜è‡ªå·±çš„å“ç‰Œã€‚ åˆ«å»åˆ· starã€‚è¿™ä¹Ÿæ˜¯è¿‘æœŸæ‰æµè¡Œèµ·æ¥ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆæ€»æœ‰ä¸€äº›äººä¼šé’»è¿™ç§ç©ºå­ï¼Œåˆ·èµ·æ¥çš„çƒ­åº¦å¯¹è‡ªå·±å¹¶æ²¡æœ‰ä»»ä½•æé«˜ã€‚ è¿™é‡Œæœ‰ä¸€ç¯‡å›½å¤–å¤§ä½¬å†™çš„ How to build your personal brand as a new developer : https://medium.freecodecamp.org/building-your-personal-brand-as-a-new-web-developer-f6d4150fd217 English æŒºé‡è¦å†æ¥è°ˆè°ˆè‹±è¯­çš„é‡è¦æ€§ï¼Œæˆ‘è®°å¾—åˆšä¸Šå¤§å­¦æ—¶è€å¸ˆä»¥åŠä¸€äº›åŸ¹è®­æœºæ„éƒ½ä¼šè¯´ï¼š åˆ«æ€•è‡ªå·±è‹±è¯­å·®å°±å­¦ä¸äº†ç¼–ç¨‹ï¼ŒçœŸæ­£å¸¸ç”¨çš„å°±é‚£äº›è¯è¯­ã€‚ è¿™å¥è¯è™½æ²¡é”™ï¼Œä½†è‹±è¯­åœ¨å¯¹ IT è¿™è¡Œæ¥è¯´è¿˜æ˜¯æœ‰ç€æå¤§çš„åŠ åˆ†èƒ½åŠ›ã€‚ æ‹¿å¸¸è§çš„ JDK é‡Œçš„æºç æ³¨é‡Šä¹Ÿæ˜¯çº¯è‹±æ–‡çš„ï¼Œå¦‚æœè‹±è¯­è¿˜ä¸é”™çš„è¯ï¼Œä¸€äº› Spring çš„ä¸œè¥¿å®Œå…¨å¯ä»¥è‡ªå­¦ï¼Œç›´æ¥å» Spring å®˜ç½‘å°±å¯ä»¥æŸ¥çœ‹ï¼Œç”šè‡³åé¢å‡ºçš„ SpringCloudï¼Œå®˜æ–¹èµ„æ–™å°±æ˜¯æœ€å¥½çš„æ•™ç¨‹ã€‚ å†æœ‰å°±æ˜¯å¹³æ—¶æŸ¥èµ„æ–™æ—¶ï¼Œæœ‰æ¡ä»¶çš„å¯ä»¥å°è¯•ç”¨ Google + è‹±æ–‡ æœç´¢ï¼Œä½ ä¼šå‘ç°æ–°çš„ä¸–ç•Œã€‚ ä¸ç„¶ä¹Ÿä¸ä¼šæœ‰é¢å‘ Google/Stack Overflow ç¼–ç¨‹ã€‚ å¯¹äºè‹±è¯­å¥½çš„åŒå­¦è‡ªç„¶ä¸æ€•ï¼Œé‚£ä¸æ€ä¹ˆå¥½çš„å’‹åŠå‘¢ï¼Ÿ æ¯”å¦‚æˆ‘ï¼Œä½†æˆ‘åœ¨åšæŒä»¥ä¸‹å‡ ç‚¹ï¼š æ‰€æœ‰çš„æ‰‹æœºã€ç”µè„‘ç³»ç»Ÿç»Ÿç»Ÿæ¢æˆè‹±è¯­è¯­è¨€ï¼Œå…»æˆä¹ æƒ¯ï¼ˆä¸è¿‡ä¹Ÿæœ‰å°´å°¬çš„è¿èœå•éƒ½æ‰¾ä¸åˆ°çš„æƒ…å†µï¼‰ã€‚ è®¢é˜…ä¸€äº›è‹±è¯­å‘¨åˆŠï¼Œæ¯”å¦‚ â€æ¹¾åŒºæ—¥æŠ¥â€œã€‚ å®šæœŸå»ç±»ä¼¼äº https://medium.com/ è¿™æ ·å…·æœ‰å½±å“åŠ›çš„å›½å¤–ç¤¾åŒºé˜…è¯»æ–‡ç« ã€‚ è™½ç„¶ç°åœ¨æˆ‘ä¹Ÿè°ˆä¸ä¸Šå¤šå¥½ï¼Œä½†ç›®å‰æˆ‘ä¹Ÿåœ¨åŠªåŠ›ï¼Œå¸Œæœ›å¤§å®¶ä¹Ÿä¸€èµ·åšæŒã€‚ æ¨èä¸€æœ¬è¿‘æœŸåœ¨çœ‹çš„ä¹¦ã€Šç¨‹åºå‘˜çš„è‹±è¯­ã€‹ã€‚ ä¿æŒç«äº‰åŠ›æŠ€æœ¯è¿™ä¸ªè¡Œä¸šå‘å±•è¿…é€Ÿã€å˜åŒ–å¤ªå¿«ï¼Œæ¯å¹´ä¹Ÿéƒ½æœ‰æ— æ•°ç›¸å…³è¡Œä¸šæ¯•ä¸šç”ŸåŠ å…¥ç«äº‰ï¼Œç¨ä¸ç•™ç¥å°±ä¼šè¢«èµ¶ä¸Šç”šè‡³è¶…è¶Šã€‚ æ‰€ä»¥æˆ‘ä»¬æ— æ—¶æ— åˆ»éƒ½å¾—ä¿æŒç«äº‰åŠ›ã€‚ å¤šçš„è°ˆä¸ä¸Šï¼Œæˆ‘åªèƒ½è°ˆä¸‹ç›®å‰æˆ‘åœ¨åšçš„äº‹æƒ…ï¼š æ‰“å¥½åŸºç¡€ã€‚ä¸æ˜¯å­¦äº†ä¹‹åå°±å¿˜äº†ï¼Œéœ€è¦ä¸åœçš„å»çœ‹ï¼Œå·©å›ºï¼ŒåŸºç¡€æ˜¯ä¸‡å˜ä¸ç¦»å…¶å®—çš„ã€‚ å¤šçœ‹æºç ï¼Œäº†è§£åŸç†ï¼Œä¸è¦åœç•™åœ¨è°ƒå‚ä¾ çš„å¢ƒç•Œã€‚ å…³æ³¨è¡Œä¸šå‘å±•ã€æ–°æŠ€æœ¯ã€æ–°åŠ¨æ€è‡³å°‘ä¸èƒ½è½ä¼äº†ã€‚ äº‰å–æ¯å‘¨äº§å‡ºä¸€ç¯‡æŠ€æœ¯ç›¸å…³æ–‡ç« ã€‚ ç§¯æå‚ä¸å¼€æºé¡¹ç›®ã€‚ æ€ç»´å¯¼å›¾ ç»“åˆä¸Šæ–‡äº§å‡ºäº†ä¸€ä¸ªæ€ç»´å¯¼å›¾æ›´ç›´è§‚äº›ã€‚ æ€»ç»“æœ¬æ–‡ç»“åˆäº†è‡ªèº«çš„ä¸€äº›ç»éªŒåˆ—ä¸¾äº†ä¸€äº›æ–¹æ³•ï¼Œä¸ä¸€å®šå¯¹æ¯ä½éƒ½æœ‰æ•ˆéœ€è¦è‡ªè¡Œåˆ¤æ–­ã€‚ ä¹Ÿååå¤å¤å†™äº†å·®ä¸å¤šä¸€å‘¨çš„æ—¶é—´ï¼Œå¸Œæœ›å¯¹åœ¨è¿™æ¡è·¯ä¸Šå’Œæ­£åœ¨è·¯ä¸Šçš„æœ‹å‹ä»¬èµ·åˆ°ä¸€äº›ä½œç”¨ã€‚ å¤§éƒ¨åˆ†éƒ½åªæ˜¯è°ˆäº†ä¸ªæ€è·¯ï¼Œå…¶å®æ¯ä¸€é¡¹å•èŠéƒ½èƒ½å†™å¾ˆå¤šã€‚æ¯ä¸ªç‚¹éƒ½æœ‰æ¨èä¸€æœ¬ä¹¦ç±ï¼Œæœ‰æ›´å¥½å»ºè®®æ¬¢è¿ç•™è¨€è®¨è®ºã€‚ ä¸Šæ–‡å¤§éƒ¨åˆ†çš„çŸ¥è¯†ç‚¹éƒ½æœ‰ç»´æŠ¤åœ¨ GitHub ä¸Šï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ï¼š https://github.com/crossoverJie/JCSprout]]></content>
      <categories>
        <category>Person</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Netty(ä¸‰) ä»€ä¹ˆæ˜¯ TCP æ‹†ã€ç²˜åŒ…ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ]]></title>
    <url>%2F2018%2F08%2F03%2Fnetty%2FNetty(3)TCP-Sticky%2F</url>
    <content type="text"><![CDATA[å‰è¨€è®°å¾—å‰æ®µæ—¶é—´æˆ‘ä»¬ç”Ÿäº§ä¸Šçš„ä¸€ä¸ªç½‘å…³å‡ºç°äº†æ•…éšœã€‚ è¿™ä¸ªç½‘å…³é€»è¾‘éå¸¸ç®€å•ï¼Œå°±æ˜¯æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ç„¶åè§£ææŠ¥æ–‡æœ€åå‘é€çŸ­ä¿¡ã€‚ ä½†è¿™ä¸ªè¯·æ±‚å¹¶ä¸æ˜¯å¸¸è§çš„ HTTP ï¼Œè€Œæ˜¯åˆ©ç”¨ Netty è‡ªå®šä¹‰çš„åè®®ã€‚ æœ‰ä¸ªå‰ææ˜¯ï¼šç½‘å…³æ˜¯éœ€è¦è¯»å–ä¸€æ®µå®Œæ•´çš„æŠ¥æ–‡æ‰èƒ½è¿›è¡Œåé¢çš„é€»è¾‘ã€‚ é—®é¢˜æ˜¯æœ‰å¤©çªç„¶å‘ç°ç½‘å…³è§£ææŠ¥æ–‡å‡ºé”™ï¼ŒæŸ¥çœ‹äº†å®¢æˆ·ç«¯çš„å‘é€æ—¥å¿—ä¹Ÿæ²¡å‘ç°é—®é¢˜ï¼Œæœ€åé€šè¿‡æ—¥å¿—å‘ç°æ”¶åˆ°äº†è®¸å¤šä¸å®Œæ•´çš„æŠ¥æ–‡ï¼Œæœ‰äº›è¿˜å¤šäº†ã€‚ äºæ˜¯æƒ³ä¼šä¸ä¼šæ˜¯ TCP æ‹†ã€ç²˜åŒ…å¸¦æ¥çš„é—®é¢˜ï¼Œæœ€ååˆ©ç”¨ Netty è‡ªå¸¦çš„æ‹†åŒ…å·¥å…·è§£å†³äº†è¯¥é—®é¢˜ã€‚ è¿™ä¾¿æœ‰äº†æ­¤æ–‡ã€‚ TCP åè®®é—®é¢˜è™½ç„¶è§£å†³äº†ï¼Œä½†è¿˜æ˜¯å¾—æƒ³æƒ³åŸå› ï¼Œä¸ºå•¥ä¼šè¿™æ ·ï¼Ÿæ‰“ç ´ç ‚é”…é—®åˆ°åº•æ‰æ˜¯ä¸€ä¸ªé è°±çš„ç¨‹åºå‘˜ã€‚ è¿™å°±å¾—ä» TCP è¿™ä¸ªåè®®è¯´èµ·äº†ã€‚ TCP æ˜¯ä¸€ä¸ªé¢å‘å­—èŠ‚æµçš„åè®®ï¼Œå®ƒæ˜¯æ€§è´¨æ˜¯æµå¼çš„ï¼Œæ‰€ä»¥å®ƒå¹¶æ²¡æœ‰åˆ†æ®µã€‚å°±åƒæ°´æµä¸€æ ·ï¼Œä½ æ²¡æ³•çŸ¥é“ä»€ä¹ˆæ—¶å€™å¼€å§‹ï¼Œä»€ä¹ˆæ—¶å€™ç»“æŸã€‚ æ‰€ä»¥ä»–ä¼šæ ¹æ®å½“å‰çš„å¥—æ¥å­—ç¼“å†²åŒºçš„æƒ…å†µè¿›è¡Œæ‹†åŒ…æˆ–æ˜¯ç²˜åŒ…ã€‚ ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ª TCP åè®®ä¼ è¾“çš„è¿‡ç¨‹ï¼š å‘é€ç«¯çš„å­—èŠ‚æµéƒ½ä¼šå…ˆä¼ å…¥ç¼“å†²åŒºï¼Œå†é€šè¿‡ç½‘ç»œä¼ å…¥åˆ°æ¥æ”¶ç«¯çš„ç¼“å†²åŒºä¸­ï¼Œæœ€ç»ˆç”±æ¥æ”¶ç«¯è·å–ã€‚ å½“æˆ‘ä»¬å‘é€ä¸¤ä¸ªå®Œæ•´åŒ…åˆ°æ¥æ”¶ç«¯çš„æ—¶å€™ï¼š æ­£å¸¸æƒ…å†µä¼šæ¥æ”¶åˆ°ä¸¤ä¸ªå®Œæ•´çš„æŠ¥æ–‡ã€‚ ä½†ä¹Ÿæœ‰ä»¥ä¸‹çš„æƒ…å†µï¼š æ¥æ”¶åˆ°çš„æ˜¯ä¸€ä¸ªæŠ¥æ–‡ï¼Œå®ƒæ˜¯ç”±å‘é€çš„ä¸¤ä¸ªæŠ¥æ–‡ç»„æˆçš„ï¼Œè¿™æ ·å¯¹äºåº”ç”¨ç¨‹åºæ¥è¯´å°±å¾ˆéš¾å¤„ç†äº†ï¼ˆè¿™æ ·ç§°ä¸ºç²˜åŒ…ï¼‰ã€‚ è¿˜æœ‰å¯èƒ½å‡ºç°ä¸Šé¢è¿™æ ·çš„è™½ç„¶æ”¶åˆ°äº†ä¸¤ä¸ªåŒ…ï¼Œä½†æ˜¯é‡Œé¢çš„å†…å®¹å´æ˜¯äº’ç›¸åŒ…å«ï¼Œå¯¹äºåº”ç”¨æ¥è¯´ä¾ç„¶æ— æ³•è§£æï¼ˆæ‹†åŒ…ï¼‰ã€‚ å¯¹äºè¿™æ ·çš„é—®é¢˜åªèƒ½é€šè¿‡ä¸Šå±‚çš„åº”ç”¨æ¥è§£å†³ï¼Œå¸¸è§çš„æ–¹å¼æœ‰ï¼š åœ¨æŠ¥æ–‡æœ«å°¾å¢åŠ æ¢è¡Œç¬¦è¡¨æ˜ä¸€æ¡å®Œæ•´çš„æ¶ˆæ¯ï¼Œè¿™æ ·åœ¨æ¥æ”¶ç«¯å¯ä»¥æ ¹æ®è¿™ä¸ªæ¢è¡Œç¬¦æ¥åˆ¤æ–­æ¶ˆæ¯æ˜¯å¦å®Œæ•´ã€‚ å°†æ¶ˆæ¯åˆ†ä¸ºæ¶ˆæ¯å¤´ã€æ¶ˆæ¯ä½“ã€‚å¯ä»¥åœ¨æ¶ˆæ¯å¤´ä¸­å£°æ˜æ¶ˆæ¯çš„é•¿åº¦ï¼Œæ ¹æ®è¿™ä¸ªé•¿åº¦æ¥è·å–æŠ¥æ–‡ï¼ˆæ¯”å¦‚ 808 åè®®ï¼‰ã€‚ è§„å®šå¥½æŠ¥æ–‡é•¿åº¦ï¼Œä¸è¶³çš„ç©ºä½è¡¥é½ï¼Œå–çš„æ—¶å€™æŒ‰ç…§é•¿åº¦æˆªå–å³å¯ã€‚ ä»¥ä¸Šçš„è¿™äº›æ–¹å¼æˆ‘ä»¬åœ¨ Netty çš„ pipline ä¸­é‡ŒåŠ å…¥å¯¹åº”çš„è§£ç å™¨éƒ½å¯ä»¥æ‰‹åŠ¨å®ç°ã€‚ ä½†å…¶å® Netty å·²ç»å¸®æˆ‘ä»¬åšå¥½äº†ï¼Œå®Œå…¨å¯ä»¥å¼€ç®±å³ç”¨ã€‚ æ¯”å¦‚ï¼š LineBasedFrameDecoder å¯ä»¥åŸºäºæ¢è¡Œç¬¦è§£å†³ã€‚ DelimiterBasedFrameDecoderå¯åŸºäºåˆ†éš”ç¬¦è§£å†³ã€‚ FixedLengthFrameDecoderå¯æŒ‡å®šé•¿åº¦è§£å†³ã€‚ å­—ç¬¦ä¸²æ‹†ã€ç²˜åŒ…ä¸‹é¢æ¥æ¨¡æ‹Ÿä¸€ä¸‹æœ€ç®€å•çš„å­—ç¬¦ä¸²ä¼ è¾“ã€‚ è¿˜æ˜¯åœ¨ä¹‹å‰çš„ https://github.com/crossoverJie/netty-action è¿›è¡Œæ¼”ç¤ºã€‚ åœ¨ Netty å®¢æˆ·ç«¯ä¸­åŠ äº†ä¸€ä¸ªå…¥å£å¯ä»¥å¾ªç¯å‘é€ 100 æ¡å­—ç¬¦ä¸²æŠ¥æ–‡åˆ°æ¥æ”¶ç«¯ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940/** * å‘æœåŠ¡ç«¯å‘æ¶ˆæ¯ å­—ç¬¦ä¸² * @param stringReqVO * @return */@ApiOperation("å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œå­—ç¬¦ä¸²")@RequestMapping(value = "sendStringMsg", method = RequestMethod.POST)@ResponseBodypublic BaseResponse&lt;NULLBody&gt; sendStringMsg(@RequestBody StringReqVO stringReqVO)&#123; BaseResponse&lt;NULLBody&gt; res = new BaseResponse(); for (int i = 0; i &lt; 100; i++) &#123; heartbeatClient.sendStringMsg(stringReqVO.getMsg()) ; &#125; // åˆ©ç”¨ actuator æ¥è‡ªå¢ counterService.increment(Constants.COUNTER_CLIENT_PUSH_COUNT); SendMsgResVO sendMsgResVO = new SendMsgResVO() ; sendMsgResVO.setMsg("OK") ; res.setCode(StatusEnum.SUCCESS.getCode()) ; res.setMessage(StatusEnum.SUCCESS.getMessage()) ; return res ;&#125;/** * å‘é€æ¶ˆæ¯å­—ç¬¦ä¸² * * @param msg */public void sendStringMsg(String msg) &#123; ByteBuf message = Unpooled.buffer(msg.getBytes().length) ; message.writeBytes(msg.getBytes()) ; ChannelFuture future = channel.writeAndFlush(message); future.addListener((ChannelFutureListener) channelFuture -&gt; LOGGER.info("å®¢æˆ·ç«¯æ‰‹åŠ¨å‘æ¶ˆæ¯æˆåŠŸ=&#123;&#125;", msg));&#125; æœåŠ¡ç«¯ç›´æ¥æ‰“å°å³å¯ï¼š 12345@Overrideprotected void channelRead0(ChannelHandlerContext ctx, String msg) throws Exception &#123; LOGGER.info("æ”¶åˆ°msg=&#123;&#125;", msg);&#125; é¡ºä¾¿æä¸€ä¸‹ï¼Œè¿™é‡ŒåŠ çš„æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²çš„è§£ç å™¨ï¼š.addLast(new StringDecoder()) å…¶å®å°±æ˜¯æŠŠæ¶ˆæ¯è§£æä¸ºå­—ç¬¦ä¸²ã€‚ 1234@Overrideprotected void decode(ChannelHandlerContext ctx, ByteBuf msg, List&lt;Object&gt; out) throws Exception &#123; out.add(msg.toString(charset));&#125; åœ¨ Swagger ä¸­è°ƒç”¨äº†å®¢æˆ·ç«¯çš„æ¥å£ç”¨äºç»™æœåŠ¡ç«¯å‘é€äº† 100 æ¬¡æ¶ˆæ¯ï¼š æ­£å¸¸æƒ…å†µä¸‹æ¥æ”¶ç«¯åº”è¯¥æ‰“å° 100 æ¬¡ hello æ‰å¯¹ï¼Œä½†æ˜¯æŸ¥çœ‹æ—¥å¿—ä¼šå‘ç°ï¼š æ”¶åˆ°çš„å†…å®¹æœ‰å®Œæ•´çš„ã€å¤šçš„ã€å°‘çš„ã€æ‹¼æ¥çš„ï¼›è¿™ä¹Ÿå°±å¯¹åº”äº†ä¸Šé¢æåˆ°çš„æ‹†åŒ…ã€ç²˜åŒ…ã€‚ è¯¥æ€ä¹ˆè§£å†³å‘¢ï¼Ÿè¿™ä¾¿å¯é‡‡ç”¨ä¹‹å‰æåˆ°çš„ LineBasedFrameDecoder åˆ©ç”¨æ¢è¡Œç¬¦è§£å†³ã€‚ åˆ©ç”¨ LineBasedFrameDecoder è§£å†³é—®é¢˜LineBasedFrameDecoder è§£ç å™¨ä½¿ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨ pipline é“¾æ¡ä¸Šæ·»åŠ å³å¯ã€‚ 123//å­—ç¬¦ä¸²è§£æ,æ¢è¡Œé˜²æ‹†åŒ….addLast(new LineBasedFrameDecoder(1024)).addLast(new StringDecoder()) æ„é€ å‡½æ•°ä¸­ä¼ å…¥äº† 1024 æ˜¯æŒ‡æŠ¥çš„é•¿åº¦æœ€å¤§ä¸è¶…è¿‡è¿™ä¸ªå€¼ï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹æ–‡çš„æºç åˆ†æã€‚ ç„¶åæˆ‘ä»¬å†è¿›è¡Œä¸€æ¬¡æµ‹è¯•çœ‹çœ‹ç»“æœï¼š æ³¨æ„ï¼Œç”±äº LineBasedFrameDecoder è§£ç å™¨æ˜¯é€šè¿‡æ¢è¡Œç¬¦æ¥åˆ¤æ–­çš„ï¼Œæ‰€ä»¥åœ¨å‘é€æ—¶ï¼Œä¸€æ¡å®Œæ•´çš„æ¶ˆæ¯éœ€è¦åŠ ä¸Š \nã€‚ æœ€ç»ˆçš„ç»“æœï¼š ä»”ç»†è§‚å¯Ÿæ—¥å¿—ï¼Œå‘ç°ç¡®å®æ²¡æœ‰ä¸€æ¡è¢«æ‹†ã€ç²˜åŒ…ã€‚ LineBasedFrameDecoder çš„åŸç†ç›®çš„è¾¾åˆ°äº†ï¼Œæ¥çœ‹çœ‹å®ƒçš„å®ç°åŸç†ï¼š ç¬¬ä¸€æ­¥ä¸»è¦å°±æ˜¯ findEndOfLine æ–¹æ³•å»æ‰¾åˆ°å½“å‰æŠ¥æ–‡ä¸­æ˜¯å¦å­˜åœ¨åˆ†éš”ç¬¦ï¼Œå­˜åœ¨å°±ä¼šè¿”å›åˆ†éš”ç¬¦æ‰€åœ¨çš„ä½ç½®ã€‚ åˆ¤æ–­æ˜¯å¦éœ€è¦ä¸¢å¼ƒï¼Œé»˜è®¤ä¸º false ï¼Œç¬¬ä¸€æ¬¡èµ°è¿™ä¸ªé€»è¾‘ï¼ˆä¸‹æ–‡ä¼šåˆ¤æ–­æ˜¯å¦éœ€è¦æ”¹ä¸º trueï¼‰ã€‚ å¦‚æœæŠ¥æ–‡ä¸­å­˜åœ¨æ¢è¡Œç¬¦ï¼Œå°±ä¼šå°†æ•°æ®æˆªå–åˆ°é‚£ä¸ªä½ç½®ã€‚ å¦‚æœä¸å­˜åœ¨æ¢è¡Œç¬¦ï¼ˆæœ‰å¯èƒ½æ˜¯æ‹†åŒ…ã€ç²˜åŒ…ï¼‰ï¼Œå°±çœ‹å½“å‰æŠ¥æ–‡çš„é•¿åº¦æ˜¯å¦å¤§äºé¢„è®¾çš„é•¿åº¦ã€‚å¤§äºåˆ™éœ€è¦ç¼“å­˜è¿™ä¸ªæŠ¥æ–‡é•¿åº¦ï¼Œå¹¶å°† discarding è®¾ä¸º trueã€‚ å¦‚æœæ˜¯éœ€è¦ä¸¢å¼ƒæ—¶ï¼Œåˆ¤æ–­æ˜¯å¦æ‰¾åˆ°äº†æ¢è¡Œç¬¦ï¼Œå­˜åœ¨åˆ™éœ€è¦ä¸¢å¼ƒæ‰ä¹‹å‰è®°å½•çš„é•¿åº¦ç„¶åæˆªå–æ•°æ®ã€‚ å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ¢è¡Œç¬¦ï¼Œåˆ™å°†ä¹‹å‰ç¼“å­˜çš„æŠ¥æ–‡é•¿åº¦è¿›è¡Œç´¯åŠ ï¼Œç”¨äºä¸‹æ¬¡æŠ›å¼ƒã€‚ ä»è¿™ä¸ªé€»è¾‘ä¸­å¯ä»¥çœ‹å‡ºå°±æ˜¯å¯»æ‰¾æŠ¥æ–‡ä¸­æ˜¯å¦åŒ…å«æ¢è¡Œç¬¦ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„æˆªå–ã€‚ ç”±äºæ˜¯é€šè¿‡ç¼“å†²åŒºè¯»å–çš„ï¼Œæ‰€ä»¥å³ä½¿è¿™æ¬¡æ²¡æœ‰æ¢è¡Œç¬¦çš„æ•°æ®ï¼Œåªè¦ä¸‹ä¸€æ¬¡çš„æŠ¥æ–‡å­˜åœ¨æ¢è¡Œç¬¦ï¼Œä¸Šä¸€è½®çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢ã€‚ é«˜æ•ˆçš„ç¼–ç æ–¹å¼ Google Protocolä¸Šé¢æåˆ°çš„å…¶å®å°±æ˜¯åœ¨è§£ç ä¸­è¿›è¡Œæ“ä½œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„æ‹†ã€ç²˜åŒ…å·¥å…·ã€‚ ç¼–è§£ç çš„ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†å¯ä»¥ç¼–ç æˆå­—èŠ‚æµç”¨äºåœ¨ç½‘ç»œä¸­ä¼ è¾“ã€æŒä¹…åŒ–å­˜å‚¨ã€‚ Java ä¸­ä¹Ÿå¯ä»¥å®ç° Serializable æ¥å£æ¥å®ç°åºåˆ—åŒ–ï¼Œä½†ç”±äºå®ƒæ€§èƒ½ç­‰åŸå› åœ¨ä¸€äº› RPC è°ƒç”¨ä¸­ç”¨çš„å¾ˆå°‘ã€‚ è€Œ Google Protocol åˆ™æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„åºåˆ—åŒ–æ¡†æ¶ï¼Œä¸‹é¢æ¥æ¼”ç¤ºåœ¨ Netty ä¸­å¦‚ä½•ä½¿ç”¨ã€‚ å®‰è£…é¦–å…ˆç¬¬ä¸€æ­¥è‡ªç„¶æ˜¯å®‰è£…ï¼š åœ¨å®˜ç½‘ä¸‹è½½å¯¹åº”çš„åŒ…ã€‚ æœ¬åœ°é…ç½®ç¯å¢ƒå˜é‡ï¼š å½“æ‰§è¡Œ protoc --version å‡ºç°ä»¥ä¸‹ç»“æœè¡¨æ˜å®‰è£…æˆåŠŸï¼š å®šä¹‰è‡ªå·±çš„åè®®æ ¼å¼æ¥ç€æ˜¯éœ€è¦æŒ‰ç…§å®˜æ–¹è¦æ±‚çš„è¯­æ³•å®šä¹‰è‡ªå·±çš„åè®®æ ¼å¼ã€‚ æ¯”å¦‚æˆ‘è¿™é‡Œéœ€è¦å®šä¹‰ä¸€ä¸ªè¾“å…¥è¾“å‡ºçš„æŠ¥æ–‡æ ¼å¼ï¼š BaseRequestProto.proto: 12345678910111213syntax = "proto2";package protocol;option java_package = "com.crossoverjie.netty.action.protocol";option java_outer_classname = "BaseRequestProto";message RequestProtocol &#123; required int32 requestId = 2; required string reqMsg = 1; &#125; BaseResponseProto.proto: 12345678910111213syntax = "proto2";package protocol;option java_package = "com.crossoverjie.netty.action.protocol";option java_outer_classname = "BaseResponseProto";message ResponseProtocol &#123; required int32 responseId = 2; required string resMsg = 1; &#125; å†é€šè¿‡ 1protoc --java_out=/dev BaseRequestProto.proto BaseResponseProto.proto protoc å‘½ä»¤å°†åˆšæ‰å®šä¹‰çš„åè®®æ ¼å¼è½¬æ¢ä¸º Java ä»£ç ï¼Œå¹¶ç”Ÿæˆåœ¨ /dev ç›®å½•ã€‚ åªéœ€è¦å°†ç”Ÿæˆçš„ä»£ç æ‹·è´åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼ŒåŒæ—¶å¼•å…¥ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;com.google.protobuf&lt;/groupId&gt; &lt;artifactId&gt;protobuf-java&lt;/artifactId&gt; &lt;version&gt;3.4.0&lt;/version&gt;&lt;/dependency&gt; åˆ©ç”¨ Protocol çš„ç¼–è§£ç ä¹Ÿéå¸¸ç®€å•ï¼š 1234567891011121314151617181920212223242526272829303132333435public class ProtocolUtil &#123; public static void main(String[] args) throws InvalidProtocolBufferException &#123; BaseRequestProto.RequestProtocol protocol = BaseRequestProto.RequestProtocol.newBuilder() .setRequestId(123) .setReqMsg("ä½ å¥½å•Š") .build(); byte[] encode = encode(protocol); BaseRequestProto.RequestProtocol parseFrom = decode(encode); System.out.println(protocol.toString()); System.out.println(protocol.toString().equals(parseFrom.toString())); &#125; /** * ç¼–ç  * @param protocol * @return */ public static byte[] encode(BaseRequestProto.RequestProtocol protocol)&#123; return protocol.toByteArray() ; &#125; /** * è§£ç  * @param bytes * @return * @throws InvalidProtocolBufferException */ public static BaseRequestProto.RequestProtocol decode(byte[] bytes) throws InvalidProtocolBufferException &#123; return BaseRequestProto.RequestProtocol.parseFrom(bytes); &#125;&#125; åˆ©ç”¨ BaseRequestProto æ¥åšä¸€ä¸ªæ¼”ç¤ºï¼Œå…ˆç¼–ç å†è§£ç æœ€åæ¯”è¾ƒæœ€ç»ˆçš„ç»“æœæ˜¯å¦ç›¸åŒã€‚ç­”æ¡ˆè‚¯å®šæ˜¯ä¸€è‡´çš„ã€‚ åˆ©ç”¨ protoc å‘½ä»¤ç”Ÿæˆçš„ Java æ–‡ä»¶é‡Œå·²ç»å¸®æˆ‘ä»¬æŠŠç¼–è§£ç å…¨éƒ¨éƒ½å°è£…å¥½äº†ï¼Œåªéœ€è¦ç®€å•è°ƒç”¨å°±è¡Œäº†ã€‚ å¯ä»¥çœ‹å‡º Protocol åˆ›å»ºå¯¹è±¡ä½¿ç”¨çš„æ˜¯æ„å»ºè€…æ¨¡å¼ï¼Œå¯¹ä½¿ç”¨è€…æ¥è¯´æ¸…æ™°æ˜“è¯»ï¼Œæ›´å¤šå…³äºæ„å»ºå™¨çš„å†…å®¹å¯ä»¥å‚è€ƒè¿™é‡Œã€‚ æ›´å¤šå…³äº Google Protocol å†…å®¹è¯·æŸ¥çœ‹å®˜æ–¹å¼€å‘æ–‡æ¡£ã€‚ ç»“åˆ NettyNetty å·²ç»è‡ªå¸¦äº†å¯¹ Google protobuf çš„ç¼–è§£ç å™¨ï¼Œä¹Ÿæ˜¯åªéœ€è¦åœ¨ pipline ä¸­æ·»åŠ å³å¯ã€‚ server ç«¯ï¼š 123456789101112131415// google Protobuf ç¼–è§£ç .addLast(new ProtobufDecoder(BaseRequestProto.RequestProtocol.getDefaultInstance())).addLast(new ProtobufEncoder())``` å®¢æˆ·ç«¯ï¼š```java// google Protobuf ç¼–è§£ç .addLast(new ProtobufDecoder(BaseResponseProto.ResponseProtocol.getDefaultInstance())).addLast(new ProtobufEncoder()) ç¨å¾®æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ„å»º ProtobufDecoder æ—¶éœ€è¦æ˜¾å¼æŒ‡å®šè§£ç å™¨éœ€è¦è§£ç æˆä»€ä¹ˆç±»å‹ã€‚ æˆ‘è¿™é‡ŒæœåŠ¡ç«¯æ¥æ”¶çš„æ˜¯ BaseRequestProtoï¼Œå®¢æˆ·ç«¯æ”¶åˆ°çš„æ˜¯æœåŠ¡ç«¯å“åº”çš„ BaseResponseProto æ‰€ä»¥å°±è®¾ç½®äº†å¯¹åº”çš„å®ä¾‹ã€‚ åŒæ ·çš„æä¾›äº†ä¸€ä¸ªæ¥å£å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ï¼Œå½“æœåŠ¡ç«¯æ”¶åˆ°äº†ä¸€ä¸ªç‰¹æ®ŠæŒ‡ä»¤æ—¶ä¹Ÿä¼šå‘å®¢æˆ·ç«¯è¿”å›å†…å®¹ï¼š 12345678910111213@Overrideprotected void channelRead0(ChannelHandlerContext ctx, BaseRequestProto.RequestProtocol msg) throws Exception &#123; LOGGER.info("æ”¶åˆ°msg=&#123;&#125;", msg.getReqMsg()); if (999 == msg.getRequestId())&#123; BaseResponseProto.ResponseProtocol responseProtocol = BaseResponseProto.ResponseProtocol.newBuilder() .setResponseId(1000) .setResMsg("æœåŠ¡ç«¯å“åº”") .build(); ctx.writeAndFlush(responseProtocol) ; &#125;&#125; åœ¨ swagger ä¸­è°ƒç”¨ç›¸å…³æ¥å£ï¼š åœ¨æ—¥å¿—å¯ä»¥çœ‹åˆ°æœåŠ¡ç«¯æ”¶åˆ°äº†æ¶ˆæ¯ï¼ŒåŒæ—¶å®¢æˆ·ç«¯ä¹Ÿæ”¶åˆ°äº†è¿”å›ï¼š è™½è¯´ Netty å°è£…äº† Google Protobuf ç›¸å…³çš„ç¼–è§£ç å·¥å…·ï¼Œå…¶å®æŸ¥çœ‹å®ƒçš„ç¼–ç å·¥å…·å°±ä¼šå‘ç°ä¹Ÿæ˜¯åˆ©ç”¨ä¸Šæ–‡æåˆ°çš„ api å®ç°çš„ã€‚ Protocol æ‹†ã€ç²˜åŒ…Google Protocol çš„ä½¿ç”¨ç¡®å®éå¸¸ç®€å•ï¼Œä½†è¿˜æ˜¯æœ‰å€¼çš„æ³¨æ„çš„åœ°æ–¹ï¼Œæ¯”å¦‚å®ƒä¾ç„¶ä¼šæœ‰æ‹†ã€ç²˜åŒ…é—®é¢˜ã€‚ ä¸å¦¨æ¨¡æ‹Ÿä¸€ä¸‹ï¼š è¿ç»­å‘é€ 100 æ¬¡æ¶ˆæ¯çœ‹æœåŠ¡ç«¯æ”¶åˆ°çš„æ€ä¹ˆæ ·ï¼š ä¼šå‘ç°æœåŠ¡ç«¯åœ¨è§£ç çš„æ—¶å€™æŠ¥é”™ï¼Œå…¶å®å°±æ˜¯è¢«æ‹†ã€ç²˜åŒ…äº†ã€‚ è¿™ç‚¹ Netty è‡ªç„¶ä¹Ÿè€ƒè™‘åˆ°äº†ï¼Œæ‰€ä»¥å·²ç»æä¾›äº†ç›¸å…³çš„å·¥å…·ã€‚ 123//æ‹†åŒ…è§£ç .addLast(new ProtobufVarint32FrameDecoder()).addLast(new ProtobufVarint32LengthFieldPrepender()) åªéœ€è¦åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åŠ ä¸Šè¿™ä¸¤ä¸ªç¼–è§£ç å·¥å…·å³å¯ï¼Œå†æ¥å‘é€ä¸€ç™¾æ¬¡è¯•è¯•ã€‚ æŸ¥çœ‹æ—¥å¿—å‘ç°æ²¡æœ‰å‡ºç°ä¸€æ¬¡å¼‚å¸¸ï¼Œ100 æ¡ä¿¡æ¯å…¨éƒ¨éƒ½æ¥æ”¶åˆ°äº†ã€‚ è¿™ä¸ªç¼–è§£ç å·¥å…·å¯ä»¥ç®€å•ç†è§£ä¸ºæ˜¯åœ¨æ¶ˆæ¯ä½“ä¸­åŠ äº†ä¸€ä¸ª 32 ä½é•¿åº¦çš„æ•´å½¢å­—æ®µï¼Œç”¨äºè¡¨æ˜å½“å‰æ¶ˆæ¯é•¿åº¦ã€‚ æ€»ç»“ç½‘ç»œè¿™å—åŒæ ·æ˜¯è®¡ç®—æœºçš„åŸºç¡€ï¼Œç”±äºè¿‘æœŸåœ¨åšç›¸å…³çš„å·¥ä½œæ‰€ä»¥æ¥è§¦çš„æ¯”è¾ƒå¤šï¼Œä¹Ÿç®—æ˜¯ç»™å¤§å­¦è¡¥è¯¾äº†ã€‚ åé¢ä¼šæ¥ç€æ›´æ–° Netty ç›¸å…³çš„å†…å®¹ï¼Œæœ€åä¼šäº§å‡ºä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP ä»¥åŠ RPC æ¡†æ¶ï¼Œæ•¬è¯·æœŸå¾…ã€‚ ä¸Šæ–‡ç›¸å…³çš„ä»£ç ï¼š https://github.com/crossoverJie/netty-action å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview æ¬¢è¿å…³æ³¨å…¬ä¼—å·ä¸€èµ·äº¤æµï¼š]]></content>
      <categories>
        <category>Netty</category>
      </categories>
      <tags>
        <tag>æ‹†åŒ…</tag>
        <tag>ç²˜åŒ…</tag>
        <tag>protobuf</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨å’Œç†è§£çº¿ç¨‹æ± ]]></title>
    <url>%2F2018%2F07%2F29%2Fjava-senior%2FThreadPool%2F</url>
    <content type="text"><![CDATA[å‰è¨€å¹³æ—¶æ¥è§¦è¿‡å¤šçº¿ç¨‹å¼€å‘çš„ç«¥é‹åº”è¯¥éƒ½æˆ–å¤šæˆ–å°‘äº†è§£è¿‡çº¿ç¨‹æ± ï¼Œä¹‹å‰å‘å¸ƒçš„ã€Šé˜¿é‡Œå·´å·´ Java æ‰‹å†Œã€‹é‡Œä¹Ÿæœ‰ä¸€æ¡ï¼š å¯è§çº¿ç¨‹æ± çš„é‡è¦æ€§ã€‚ ç®€å•æ¥è¯´ä½¿ç”¨çº¿ç¨‹æ± æœ‰ä»¥ä¸‹å‡ ä¸ªç›®çš„ï¼š çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œä¸èƒ½é¢‘ç¹çš„åˆ›å»ºã€‚ è§£è€¦ä½œç”¨ï¼›çº¿ç¨‹çš„åˆ›å»ºäºæ‰§è¡Œå®Œå…¨åˆ†å¼€ï¼Œæ–¹ä¾¿ç»´æŠ¤ã€‚ åº”å½“å°†å…¶æ”¾å…¥ä¸€ä¸ªæ± å­ä¸­ï¼Œå¯ä»¥ç»™å…¶ä»–ä»»åŠ¡è¿›è¡Œå¤ç”¨ã€‚ çº¿ç¨‹æ± åŸç†è°ˆåˆ°çº¿ç¨‹æ± å°±ä¼šæƒ³åˆ°æ± åŒ–æŠ€æœ¯ï¼Œå…¶ä¸­æœ€æ ¸å¿ƒçš„æ€æƒ³å°±æ˜¯æŠŠå®è´µçš„èµ„æºæ”¾åˆ°ä¸€ä¸ªæ± å­ä¸­ï¼›æ¯æ¬¡ä½¿ç”¨éƒ½ä»é‡Œé¢è·å–ï¼Œç”¨å®Œä¹‹ååˆæ”¾å›æ± å­ä¾›å…¶ä»–äººä½¿ç”¨ï¼Œæœ‰ç‚¹åƒå¤§é”…é¥­çš„æ„æ€ã€‚ é‚£åœ¨ Java ä¸­åˆæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ åœ¨ JDK 1.5 ä¹‹åæ¨å‡ºäº†ç›¸å…³çš„ apiï¼Œå¸¸è§çš„åˆ›å»ºçº¿ç¨‹æ± æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š Executors.newCachedThreadPool()ï¼šæ— é™çº¿ç¨‹æ± ã€‚ Executors.newFixedThreadPool(nThreads)ï¼šåˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ã€‚ Executors.newSingleThreadExecutor()ï¼šåˆ›å»ºå•ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚ å…¶å®çœ‹è¿™ä¸‰ç§æ–¹å¼åˆ›å»ºçš„æºç å°±ä¼šå‘ç°ï¼š 12345public static ExecutorService newCachedThreadPool() &#123; return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable&gt;());&#125; å®é™…ä¸Šè¿˜æ˜¯åˆ©ç”¨ ThreadPoolExecutor ç±»å®ç°çš„ã€‚ æ‰€ä»¥æˆ‘ä»¬é‡ç‚¹æ¥çœ‹ä¸‹ ThreadPoolExecutor æ˜¯æ€ä¹ˆç©çš„ã€‚ é¦–å…ˆæ˜¯åˆ›å»ºçº¿ç¨‹çš„ apiï¼š 1ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, RejectedExecutionHandler handler) è¿™å‡ ä¸ªæ ¸å¿ƒå‚æ•°çš„ä½œç”¨ï¼š corePoolSize ä¸ºçº¿ç¨‹æ± çš„åŸºæœ¬å¤§å°ã€‚ maximumPoolSize ä¸ºçº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹å¤§å°ã€‚ keepAliveTime å’Œ unit åˆ™æ˜¯çº¿ç¨‹ç©ºé—²åçš„å­˜æ´»æ—¶é—´ã€‚ workQueue ç”¨äºå­˜æ”¾ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ã€‚ handler å½“é˜Ÿåˆ—å’Œæœ€å¤§çº¿ç¨‹æ± éƒ½æ»¡äº†ä¹‹åçš„é¥±å’Œç­–ç•¥ã€‚ äº†è§£äº†è¿™å‡ ä¸ªå‚æ•°å†æ¥çœ‹çœ‹å®é™…çš„è¿ç”¨ã€‚ é€šå¸¸æˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨: 1threadPool.execute(new Job()); è¿™æ ·çš„æ–¹å¼æ¥æäº¤ä¸€ä¸ªä»»åŠ¡åˆ°çº¿ç¨‹æ± ä¸­ï¼Œæ‰€ä»¥æ ¸å¿ƒçš„é€»è¾‘å°±æ˜¯ execute() å‡½æ•°äº†ã€‚ åœ¨å…·ä½“åˆ†æä¹‹å‰å…ˆäº†è§£ä¸‹çº¿ç¨‹æ± ä¸­æ‰€å®šä¹‰çš„çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€éƒ½å’Œçº¿ç¨‹çš„æ‰§è¡Œå¯†åˆ‡ç›¸å…³ï¼š RUNNING è‡ªç„¶æ˜¯è¿è¡ŒçŠ¶æ€ï¼ŒæŒ‡å¯ä»¥æ¥å—ä»»åŠ¡æ‰§è¡Œé˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ SHUTDOWN æŒ‡è°ƒç”¨äº† shutdown() æ–¹æ³•ï¼Œä¸å†æ¥å—æ–°ä»»åŠ¡äº†ï¼Œä½†æ˜¯é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡å¾—æ‰§è¡Œå®Œæ¯•ã€‚ STOP æŒ‡è°ƒç”¨äº† shutdownNow() æ–¹æ³•ï¼Œä¸å†æ¥å—æ–°ä»»åŠ¡ï¼ŒåŒæ—¶æŠ›å¼ƒé˜»å¡é˜Ÿåˆ—é‡Œçš„æ‰€æœ‰ä»»åŠ¡å¹¶ä¸­æ–­æ‰€æœ‰æ­£åœ¨æ‰§è¡Œä»»åŠ¡ã€‚ TIDYING æ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œåœ¨è°ƒç”¨ shutdown()/shutdownNow() ä¸­éƒ½ä¼šå°è¯•æ›´æ–°ä¸ºè¿™ä¸ªçŠ¶æ€ã€‚ TERMINATED ç»ˆæ­¢çŠ¶æ€ï¼Œå½“æ‰§è¡Œ terminated() åä¼šæ›´æ–°ä¸ºè¿™ä¸ªçŠ¶æ€ã€‚ ç”¨å›¾è¡¨ç¤ºä¸ºï¼š ç„¶åçœ‹çœ‹ execute() æ–¹æ³•æ˜¯å¦‚ä½•å¤„ç†çš„ï¼š è·å–å½“å‰çº¿ç¨‹æ± çš„çŠ¶æ€ã€‚ å½“å‰çº¿ç¨‹æ•°é‡å°äº coreSize æ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹è¿è¡Œã€‚ å¦‚æœå½“å‰çº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œå¹¶ä¸”å†™å…¥é˜»å¡é˜Ÿåˆ—æˆåŠŸã€‚ åŒé‡æ£€æŸ¥ï¼Œå†æ¬¡è·å–çº¿ç¨‹çŠ¶æ€ï¼›å¦‚æœçº¿ç¨‹çŠ¶æ€å˜äº†ï¼ˆéè¿è¡ŒçŠ¶æ€ï¼‰å°±éœ€è¦ä»é˜»å¡é˜Ÿåˆ—ç§»é™¤ä»»åŠ¡ï¼Œå¹¶å°è¯•åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚åŒæ—¶æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚ å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸ºç©ºå°±æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¹¶æ‰§è¡Œã€‚ å¦‚æœåœ¨ç¬¬ä¸‰æ­¥çš„åˆ¤æ–­ä¸ºéè¿è¡ŒçŠ¶æ€ï¼Œå°è¯•æ–°å»ºçº¿ç¨‹ï¼Œå¦‚æœå¤±è´¥åˆ™æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚ è¿™é‡Œå€ŸåŠ©ã€ŠèŠèŠå¹¶å‘ã€‹çš„ä¸€å¼ å›¾æ¥æè¿°è¿™ä¸ªæµç¨‹ï¼š å¦‚ä½•é…ç½®çº¿ç¨‹æµç¨‹èŠå®Œäº†å†æ¥çœ‹çœ‹ä¸Šæ–‡æåˆ°äº†å‡ ä¸ªæ ¸å¿ƒå‚æ•°åº”è¯¥å¦‚ä½•é…ç½®å‘¢ï¼Ÿ æœ‰ä¸€ç‚¹æ˜¯è‚¯å®šçš„ï¼Œçº¿ç¨‹æ± è‚¯å®šæ˜¯ä¸æ˜¯è¶Šå¤§è¶Šå¥½ã€‚ é€šå¸¸æˆ‘ä»¬æ˜¯éœ€è¦æ ¹æ®è¿™æ‰¹ä»»åŠ¡æ‰§è¡Œçš„æ€§è´¨æ¥ç¡®å®šçš„ã€‚ IO å¯†é›†å‹ä»»åŠ¡ï¼šç”±äºçº¿ç¨‹å¹¶ä¸æ˜¯ä¸€ç›´åœ¨è¿è¡Œï¼Œæ‰€ä»¥å¯ä»¥å°½å¯èƒ½çš„å¤šé…ç½®çº¿ç¨‹ï¼Œæ¯”å¦‚ CPU ä¸ªæ•° * 2 CPU å¯†é›†å‹ä»»åŠ¡ï¼ˆå¤§é‡å¤æ‚çš„è¿ç®—ï¼‰åº”å½“åˆ†é…è¾ƒå°‘çš„çº¿ç¨‹ï¼Œæ¯”å¦‚ CPU ä¸ªæ•°ç›¸å½“çš„å¤§å°ã€‚ å½“ç„¶è¿™äº›éƒ½æ˜¯ç»éªŒå€¼ï¼Œæœ€å¥½çš„æ–¹å¼è¿˜æ˜¯æ ¹æ®å®é™…æƒ…å†µæµ‹è¯•å¾—å‡ºæœ€ä½³é…ç½®ã€‚ ä¼˜é›…çš„å…³é—­çº¿ç¨‹æ± æœ‰è¿è¡Œä»»åŠ¡è‡ªç„¶ä¹Ÿæœ‰å…³é—­ä»»åŠ¡ï¼Œä»ä¸Šæ–‡æåˆ°çš„ 5 ä¸ªçŠ¶æ€å°±èƒ½çœ‹å‡ºå¦‚ä½•æ¥å…³é—­çº¿ç¨‹æ± ã€‚ å…¶å®æ— éå°±æ˜¯ä¸¤ä¸ªæ–¹æ³• shutdown()/shutdownNow()ã€‚ ä½†ä»–ä»¬æœ‰ç€é‡è¦çš„åŒºåˆ«ï¼š shutdown() æ‰§è¡Œååœæ­¢æ¥å—æ–°ä»»åŠ¡ï¼Œä¼šæŠŠé˜Ÿåˆ—çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ã€‚ shutdownNow() ä¹Ÿæ˜¯åœæ­¢æ¥å—æ–°ä»»åŠ¡ï¼Œä½†ä¼šä¸­æ–­æ‰€æœ‰çš„ä»»åŠ¡ï¼Œå°†çº¿ç¨‹æ± çŠ¶æ€å˜ä¸º stopã€‚ ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šä¸­æ–­çº¿ç¨‹ï¼Œç”¨æˆ·å¯è‡ªè¡Œåˆ¤æ–­æ˜¯å¦éœ€è¦å“åº”ä¸­æ–­ã€‚ shutdownNow() è¦æ›´ç®€å•ç²—æš´ï¼Œå¯ä»¥æ ¹æ®å®é™…åœºæ™¯é€‰æ‹©ä¸åŒçš„æ–¹æ³•ã€‚ æˆ‘é€šå¸¸æ˜¯æŒ‰ç…§ä»¥ä¸‹æ–¹å¼å…³é—­çº¿ç¨‹æ± çš„ï¼š 123456789101112long start = System.currentTimeMillis();for (int i = 0; i &lt;= 5; i++) &#123; pool.execute(new Job());&#125;pool.shutdown();while (!pool.awaitTermination(1, TimeUnit.SECONDS)) &#123; LOGGER.info("çº¿ç¨‹è¿˜åœ¨æ‰§è¡Œã€‚ã€‚ã€‚");&#125;long end = System.currentTimeMillis();LOGGER.info("ä¸€å…±å¤„ç†äº†ã€&#123;&#125;ã€‘", (end - start)); pool.awaitTermination(1, TimeUnit.SECONDS) ä¼šæ¯éš”ä¸€ç§’é’Ÿæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦æ‰§è¡Œå®Œæ¯•ï¼ˆçŠ¶æ€ä¸º TERMINATEDï¼‰ï¼Œå½“ä» while å¾ªç¯é€€å‡ºæ—¶å°±è¡¨æ˜çº¿ç¨‹æ± å·²ç»å®Œå…¨ç»ˆæ­¢äº†ã€‚ SpringBoot ä½¿ç”¨çº¿ç¨‹æ± 2018 å¹´äº†ï¼ŒSpringBoot ç››è¡Œï¼›æ¥çœ‹çœ‹åœ¨ SpringBoot ä¸­åº”å½“æ€ä¹ˆé…ç½®å’Œä½¿ç”¨çº¿ç¨‹æ± ã€‚ æ—¢ç„¶ç”¨äº† SpringBoot ï¼Œé‚£è‡ªç„¶å¾—å‘æŒ¥ Spring çš„ç‰¹æ€§ï¼Œæ‰€ä»¥éœ€è¦ Spring æ¥å¸®æˆ‘ä»¬ç®¡ç†çº¿ç¨‹æ± ï¼š 12345678910111213141516171819202122@Configurationpublic class TreadPoolConfig &#123; /** * æ¶ˆè´¹é˜Ÿåˆ—çº¿ç¨‹ * @return */ @Bean(value = "consumerQueueThreadPool") public ExecutorService buildConsumerQueueThreadPool()&#123; ThreadFactory namedThreadFactory = new ThreadFactoryBuilder() .setNameFormat("consumer-queue-thread-%d").build(); ExecutorService pool = new ThreadPoolExecutor(5, 5, 0L, TimeUnit.MILLISECONDS, new ArrayBlockingQueue&lt;Runnable&gt;(5),namedThreadFactory,new ThreadPoolExecutor.AbortPolicy()); return pool ; &#125;&#125; ä½¿ç”¨æ—¶ï¼š 12345678910111213@Resource(name = "consumerQueueThreadPool")private ExecutorService consumerQueueThreadPool;@Overridepublic void execute() &#123; //æ¶ˆè´¹é˜Ÿåˆ— for (int i = 0; i &lt; 5; i++) &#123; consumerQueueThreadPool.execute(new ConsumerQueueThread()); &#125;&#125; å…¶å®ä¹ŸæŒºç®€å•ï¼Œå°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹æ± çš„ beanï¼Œåœ¨ä½¿ç”¨æ—¶ç›´æ¥ä» Spring ä¸­å–å‡ºå³å¯ã€‚ ç›‘æ§çº¿ç¨‹æ± è°ˆåˆ°äº† SpringBootï¼Œä¹Ÿå¯åˆ©ç”¨å®ƒ actuator ç»„ä»¶æ¥åšçº¿ç¨‹æ± çš„ç›‘æ§ã€‚ çº¿ç¨‹æ€ä¹ˆè¯´éƒ½æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¯¹çº¿ç¨‹æ± çš„ç›‘æ§å¯ä»¥çŸ¥é“è‡ªå·±ä»»åŠ¡æ‰§è¡Œçš„çŠ¶å†µã€æ•ˆç‡ç­‰ã€‚ å…³äº actuator å°±ä¸å†ç»†è¯´äº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹è¿™ç¯‡ï¼Œæœ‰è¯¦ç»†æ•´ç†è¿‡å¦‚ä½•æš´éœ²ç›‘æ§ç«¯ç‚¹ã€‚ å…¶å® ThreadPool æœ¬èº«å·²ç»æä¾›äº†ä¸å°‘ api å¯ä»¥è·å–çº¿ç¨‹çŠ¶æ€ï¼š å¾ˆå¤šæ–¹æ³•çœ‹åå­—å°±çŸ¥é“å…¶å«ä¹‰ï¼Œåªéœ€è¦å°†è¿™äº›ä¿¡æ¯æš´éœ²åˆ° SpringBoot çš„ç›‘æ§ç«¯ç‚¹ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å¯è§†åŒ–é¡µé¢æŸ¥çœ‹å½“å‰çš„çº¿ç¨‹æ± çŠ¶æ€äº†ã€‚ ç”šè‡³æˆ‘ä»¬å¯ä»¥ç»§æ‰¿çº¿ç¨‹æ± æ‰©å±•å…¶ä¸­çš„å‡ ä¸ªå‡½æ•°æ¥è‡ªå®šä¹‰ç›‘æ§é€»è¾‘ï¼š çœ‹è¿™äº›åç§°å’Œå®šä¹‰éƒ½çŸ¥é“ï¼Œè¿™æ˜¯è®©å­ç±»æ¥å®ç°çš„ã€‚ å¯ä»¥åœ¨çº¿ç¨‹æ‰§è¡Œå‰ã€åã€ç»ˆæ­¢çŠ¶æ€æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚ çº¿ç¨‹æ± éš”ç¦» çº¿ç¨‹æ± çœ‹ä¼¼å¾ˆç¾å¥½ï¼Œä½†ä¹Ÿä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ã€‚ å¦‚æœæˆ‘ä»¬å¾ˆå¤šä¸šåŠ¡éƒ½ä¾èµ–äºåŒä¸€ä¸ªçº¿ç¨‹æ± ,å½“å…¶ä¸­ä¸€ä¸ªä¸šåŠ¡å› ä¸ºå„ç§ä¸å¯æ§çš„åŸå› æ¶ˆè€—äº†æ‰€æœ‰çš„çº¿ç¨‹ï¼Œå¯¼è‡´çº¿ç¨‹æ± å…¨éƒ¨å æ»¡ã€‚ è¿™æ ·å…¶ä»–çš„ä¸šåŠ¡ä¹Ÿå°±ä¸èƒ½æ­£å¸¸è¿è½¬äº†ï¼Œè¿™å¯¹ç³»ç»Ÿçš„æ‰“å‡»æ˜¯å·¨å¤§çš„ã€‚ æ¯”å¦‚æˆ‘ä»¬ Tomcat æ¥å—è¯·æ±‚çš„çº¿ç¨‹æ± ï¼Œå‡è®¾å…¶ä¸­ä¸€äº›å“åº”ç‰¹åˆ«æ…¢ï¼Œçº¿ç¨‹èµ„æºå¾—ä¸åˆ°å›æ”¶é‡Šæ”¾ï¼›çº¿ç¨‹æ± æ…¢æ…¢è¢«å æ»¡ï¼Œæœ€åçš„æƒ…å†µå°±æ˜¯æ•´ä¸ªåº”ç”¨éƒ½ä¸èƒ½æä¾›æœåŠ¡ã€‚ æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†çº¿ç¨‹æ± è¿›è¡Œéš”ç¦»ã€‚ é€šå¸¸çš„åšæ³•æ˜¯æŒ‰ç…§ä¸šåŠ¡è¿›è¡Œåˆ’åˆ†ï¼š æ¯”å¦‚ä¸‹å•çš„ä»»åŠ¡ç”¨ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œè·å–æ•°æ®çš„ä»»åŠ¡ç”¨å¦ä¸€ä¸ªçº¿ç¨‹æ± ã€‚è¿™æ ·å³ä½¿å…¶ä¸­ä¸€ä¸ªå‡ºç°é—®é¢˜æŠŠçº¿ç¨‹æ± è€—å°½ï¼Œé‚£ä¹Ÿä¸ä¼šå½±å“å…¶ä»–çš„ä»»åŠ¡è¿è¡Œã€‚ hystrix éš”ç¦»è¿™æ ·çš„éœ€æ±‚ Hystrix å·²ç»å¸®æˆ‘ä»¬å®ç°äº†ã€‚ Hystrix æ˜¯ä¸€æ¬¾å¼€æºçš„å®¹é”™æ’ä»¶ï¼Œå…·æœ‰ä¾èµ–éš”ç¦»ã€ç³»ç»Ÿå®¹é”™é™çº§ç­‰åŠŸèƒ½ã€‚ ä¸‹é¢æ¥çœ‹çœ‹ Hystrix ç®€å•çš„åº”ç”¨ï¼š é¦–å…ˆéœ€è¦å®šä¹‰ä¸¤ä¸ªçº¿ç¨‹æ± ï¼Œåˆ†åˆ«ç”¨äºæ‰§è¡Œè®¢å•ã€å¤„ç†ç”¨æˆ·ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101/** * Function:è®¢å•æœåŠ¡ * * @author crossoverJie * Date: 2018/7/28 16:43 * @since JDK 1.8 */public class CommandOrder extends HystrixCommand&lt;String&gt; &#123; private final static Logger LOGGER = LoggerFactory.getLogger(CommandOrder.class); private String orderName; public CommandOrder(String orderName) &#123; super(Setter.withGroupKey( //æœåŠ¡åˆ†ç»„ HystrixCommandGroupKey.Factory.asKey("OrderGroup")) //çº¿ç¨‹åˆ†ç»„ .andThreadPoolKey(HystrixThreadPoolKey.Factory.asKey("OrderPool")) //çº¿ç¨‹æ± é…ç½® .andThreadPoolPropertiesDefaults(HystrixThreadPoolProperties.Setter() .withCoreSize(10) .withKeepAliveTimeMinutes(5) .withMaxQueueSize(10) .withQueueSizeRejectionThreshold(10000)) .andCommandPropertiesDefaults( HystrixCommandProperties.Setter() .withExecutionIsolationStrategy(HystrixCommandProperties.ExecutionIsolationStrategy.THREAD)) ) ; this.orderName = orderName; &#125; @Override public String run() throws Exception &#123; LOGGER.info("orderName=[&#123;&#125;]", orderName); TimeUnit.MILLISECONDS.sleep(100); return "OrderName=" + orderName; &#125;&#125;/** * Function:ç”¨æˆ·æœåŠ¡ * * @author crossoverJie * Date: 2018/7/28 16:43 * @since JDK 1.8 */public class CommandUser extends HystrixCommand&lt;String&gt; &#123; private final static Logger LOGGER = LoggerFactory.getLogger(CommandUser.class); private String userName; public CommandUser(String userName) &#123; super(Setter.withGroupKey( //æœåŠ¡åˆ†ç»„ HystrixCommandGroupKey.Factory.asKey("UserGroup")) //çº¿ç¨‹åˆ†ç»„ .andThreadPoolKey(HystrixThreadPoolKey.Factory.asKey("UserPool")) //çº¿ç¨‹æ± é…ç½® .andThreadPoolPropertiesDefaults(HystrixThreadPoolProperties.Setter() .withCoreSize(10) .withKeepAliveTimeMinutes(5) .withMaxQueueSize(10) .withQueueSizeRejectionThreshold(10000)) //çº¿ç¨‹æ± éš”ç¦» .andCommandPropertiesDefaults( HystrixCommandProperties.Setter() .withExecutionIsolationStrategy(HystrixCommandProperties.ExecutionIsolationStrategy.THREAD)) ) ; this.userName = userName; &#125; @Override public String run() throws Exception &#123; LOGGER.info("userName=[&#123;&#125;]", userName); TimeUnit.MILLISECONDS.sleep(100); return "userName=" + userName; &#125;&#125; api ç‰¹åˆ«ç®€æ´æ˜“æ‡‚ï¼Œå…·ä½“è¯¦æƒ…è¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚ ç„¶åæ¨¡æ‹Ÿè¿è¡Œï¼š 12345678910111213141516171819public static void main(String[] args) throws Exception &#123; CommandOrder commandPhone = new CommandOrder("æ‰‹æœº"); CommandOrder command = new CommandOrder("ç”µè§†"); //é˜»å¡æ–¹å¼æ‰§è¡Œ String execute = commandPhone.execute(); LOGGER.info("execute=[&#123;&#125;]", execute); //å¼‚æ­¥éé˜»å¡æ–¹å¼ Future&lt;String&gt; queue = command.queue(); String value = queue.get(200, TimeUnit.MILLISECONDS); LOGGER.info("value=[&#123;&#125;]", value); CommandUser commandUser = new CommandUser("å¼ ä¸‰"); String name = commandUser.execute(); LOGGER.info("name=[&#123;&#125;]", name);&#125; è¿è¡Œç»“æœï¼š å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªä»»åŠ¡åˆ†æˆäº†ä¸¤ä¸ªçº¿ç¨‹æ± è¿è¡Œï¼Œä»–ä»¬ä¹‹é—´äº’ä¸å¹²æ‰°ã€‚ è·å–ä»»åŠ¡ä»»åŠ¡ç»“æœæ”¯æŒåŒæ­¥é˜»å¡å’Œå¼‚æ­¥éé˜»å¡æ–¹å¼ï¼Œå¯è‡ªè¡Œé€‰æ‹©ã€‚ å®ƒçš„å®ç°åŸç†å…¶å®å®¹æ˜“çŒœåˆ°ï¼š åˆ©ç”¨ä¸€ä¸ª Map æ¥å­˜æ”¾ä¸åŒä¸šåŠ¡å¯¹åº”çš„çº¿ç¨‹æ± ã€‚ é€šè¿‡åˆšæ‰çš„æ„é€ å‡½æ•°ä¹Ÿèƒ½è¯æ˜ï¼š è¿˜è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼š è‡ªå®šä¹‰çš„ Command å¹¶ä¸æ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œæ¯æ¬¡æ‰§è¡Œéœ€è¦ new ä¸€ä¸ªå®ä¾‹ï¼Œä¸ç„¶ä¼šæŠ¥ This instance can only be executed once. Please instantiate a new instance. å¼‚å¸¸ã€‚ æ€»ç»“æ± åŒ–æŠ€æœ¯ç¡®å®åœ¨å¹³æ—¶åº”ç”¨å¹¿æ³›ï¼Œç†Ÿç»ƒæŒæ¡èƒ½æé«˜ä¸å°‘æ•ˆç‡ã€‚ æ–‡æœ«çš„ hystrix æºç ï¼š https://github.com/crossoverJie/Java-Interview/tree/master/src/main/java/com/crossoverjie/hystrix æœ€åæ’æ’­ä¸ªå°å¹¿å‘Šï¼š Java-Interview æˆªæ­¢ç›®å‰å°†è¿‘ 8K starã€‚ è¿™æ¬¡å®šä¸ªå°ç›®æ ‡ï¼šäº‰å–å†²å‡» 1W starã€‚ æ„Ÿè°¢å„ä½è€é“çš„æ”¯æŒä¸ç‚¹èµã€‚ æ¬¢è¿å…³æ³¨å…¬ä¼—å·ä¸€èµ·äº¤æµï¼š]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>ThreadPool</tag>
        <tag>Hystirx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HashMap? ConcurrentHashMap? ç›¸ä¿¡çœ‹å®Œè¿™ç¯‡æ²¡äººèƒ½éš¾ä½ä½ ï¼]]></title>
    <url>%2F2018%2F07%2F23%2Fjava-senior%2FConcurrentHashMap%2F</url>
    <content type="text"><![CDATA[å‰è¨€Map è¿™æ ·çš„ Key Value åœ¨è½¯ä»¶å¼€å‘ä¸­æ˜¯éå¸¸ç»å…¸çš„ç»“æ„ï¼Œå¸¸ç”¨äºåœ¨å†…å­˜ä¸­å­˜æ”¾æ•°æ®ã€‚ æœ¬ç¯‡ä¸»è¦æƒ³è®¨è®º ConcurrentHashMap è¿™æ ·ä¸€ä¸ªå¹¶å‘å®¹å™¨ï¼Œåœ¨æ­£å¼å¼€å§‹ä¹‹å‰æˆ‘è§‰å¾—æœ‰å¿…è¦è°ˆè°ˆ HashMapï¼Œæ²¡æœ‰å®ƒå°±ä¸ä¼šæœ‰åé¢çš„ ConcurrentHashMapã€‚ HashMapä¼—æ‰€å‘¨çŸ¥ HashMap åº•å±‚æ˜¯åŸºäº æ•°ç»„ + é“¾è¡¨ ç»„æˆçš„ï¼Œä¸è¿‡åœ¨ jdk1.7 å’Œ 1.8 ä¸­å…·ä½“å®ç°ç¨æœ‰ä¸åŒã€‚ Base 1.71.7 ä¸­çš„æ•°æ®ç»“æ„å›¾ï¼š å…ˆæ¥çœ‹çœ‹ 1.7 ä¸­çš„å®ç°ã€‚ è¿™æ˜¯ HashMap ä¸­æ¯”è¾ƒæ ¸å¿ƒçš„å‡ ä¸ªæˆå‘˜å˜é‡ï¼›çœ‹çœ‹åˆ†åˆ«æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ åˆå§‹åŒ–æ¡¶å¤§å°ï¼Œå› ä¸ºåº•å±‚æ˜¯æ•°ç»„ï¼Œæ‰€ä»¥è¿™æ˜¯æ•°ç»„é»˜è®¤çš„å¤§å°ã€‚ æ¡¶æœ€å¤§å€¼ã€‚ é»˜è®¤çš„è´Ÿè½½å› å­ï¼ˆ0.75ï¼‰ table çœŸæ­£å­˜æ”¾æ•°æ®çš„æ•°ç»„ã€‚ Map å­˜æ”¾æ•°é‡çš„å¤§å°ã€‚ æ¡¶å¤§å°ï¼Œå¯åœ¨åˆå§‹åŒ–æ—¶æ˜¾å¼æŒ‡å®šã€‚ è´Ÿè½½å› å­ï¼Œå¯åœ¨åˆå§‹åŒ–æ—¶æ˜¾å¼æŒ‡å®šã€‚ é‡ç‚¹è§£é‡Šä¸‹è´Ÿè½½å› å­ï¼š ç”±äºç»™å®šçš„ HashMap çš„å®¹é‡å¤§å°æ˜¯å›ºå®šçš„ï¼Œæ¯”å¦‚é»˜è®¤åˆå§‹åŒ–ï¼š 123456789101112131415161718public HashMap() &#123; this(DEFAULT_INITIAL_CAPACITY, DEFAULT_LOAD_FACTOR);&#125;public HashMap(int initialCapacity, float loadFactor) &#123; if (initialCapacity &lt; 0) throw new IllegalArgumentException("Illegal initial capacity: " + initialCapacity); if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException("Illegal load factor: " + loadFactor); this.loadFactor = loadFactor; threshold = initialCapacity; init();&#125; ç»™å®šçš„é»˜è®¤å®¹é‡ä¸º 16ï¼Œè´Ÿè½½å› å­ä¸º 0.75ã€‚Map åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¸æ–­çš„å¾€é‡Œé¢å­˜æ”¾æ•°æ®ï¼Œå½“æ•°é‡è¾¾åˆ°äº† 16 * 0.75 = 12 å°±éœ€è¦å°†å½“å‰ 16 çš„å®¹é‡è¿›è¡Œæ‰©å®¹ï¼Œè€Œæ‰©å®¹è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ° rehashã€å¤åˆ¶æ•°æ®ç­‰æ“ä½œï¼Œæ‰€ä»¥éå¸¸æ¶ˆè€—æ€§èƒ½ã€‚ å› æ­¤é€šå¸¸å»ºè®®èƒ½æå‰é¢„ä¼° HashMap çš„å¤§å°æœ€å¥½ï¼Œå°½é‡çš„å‡å°‘æ‰©å®¹å¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚ æ ¹æ®ä»£ç å¯ä»¥çœ‹åˆ°å…¶å®çœŸæ­£å­˜æ”¾æ•°æ®çš„æ˜¯ transient Entry&lt;K,V&gt;[] table = (Entry&lt;K,V&gt;[]) EMPTY_TABLE; è¿™ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆå®ƒåˆæ˜¯å¦‚ä½•å®šä¹‰çš„å‘¢ï¼Ÿ Entry æ˜¯ HashMap ä¸­çš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œä»ä»–çš„æˆå‘˜å˜é‡å¾ˆå®¹æ˜“çœ‹å‡ºï¼š key å°±æ˜¯å†™å…¥æ—¶çš„é”®ã€‚ value è‡ªç„¶å°±æ˜¯å€¼ã€‚ å¼€å§‹çš„æ—¶å€™å°±æåˆ° HashMap æ˜¯ç”±æ•°ç»„å’Œé“¾è¡¨ç»„æˆï¼Œæ‰€ä»¥è¿™ä¸ª next å°±æ˜¯ç”¨äºå®ç°é“¾è¡¨ç»“æ„ã€‚ hash å­˜æ”¾çš„æ˜¯å½“å‰ key çš„ hashcodeã€‚ çŸ¥æ™“äº†åŸºæœ¬ç»“æ„ï¼Œé‚£æ¥çœ‹çœ‹å…¶ä¸­é‡è¦çš„å†™å…¥ã€è·å–å‡½æ•°ï¼š put æ–¹æ³•12345678910111213141516171819202122public V put(K key, V value) &#123; if (table == EMPTY_TABLE) &#123; inflateTable(threshold); &#125; if (key == null) return putForNullKey(value); int hash = hash(key); int i = indexFor(hash, table.length); for (Entry&lt;K,V&gt; e = table[i]; e != null; e = e.next) &#123; Object k; if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123; V oldValue = e.value; e.value = value; e.recordAccess(this); return oldValue; &#125; &#125; modCount++; addEntry(hash, key, value, i); return null;&#125; åˆ¤æ–­å½“å‰æ•°ç»„æ˜¯å¦éœ€è¦åˆå§‹åŒ–ã€‚ å¦‚æœ key ä¸ºç©ºï¼Œåˆ™ put ä¸€ä¸ªç©ºå€¼è¿›å»ã€‚ æ ¹æ® key è®¡ç®—å‡º hashcodeã€‚ æ ¹æ®è®¡ç®—å‡ºçš„ hashcode å®šä½å‡ºæ‰€åœ¨æ¡¶ã€‚ å¦‚æœæ¡¶æ˜¯ä¸€ä¸ªé“¾è¡¨åˆ™éœ€è¦éå†åˆ¤æ–­é‡Œé¢çš„ hashcodeã€key æ˜¯å¦å’Œä¼ å…¥ key ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰åˆ™è¿›è¡Œè¦†ç›–ï¼Œå¹¶è¿”å›åŸæ¥çš„å€¼ã€‚ å¦‚æœæ¡¶æ˜¯ç©ºçš„ï¼Œè¯´æ˜å½“å‰ä½ç½®æ²¡æœ‰æ•°æ®å­˜å…¥ï¼›æ–°å¢ä¸€ä¸ª Entry å¯¹è±¡å†™å…¥å½“å‰ä½ç½®ã€‚ 123456789101112131415void addEntry(int hash, K key, V value, int bucketIndex) &#123; if ((size &gt;= threshold) &amp;&amp; (null != table[bucketIndex])) &#123; resize(2 * table.length); hash = (null != key) ? hash(key) : 0; bucketIndex = indexFor(hash, table.length); &#125; createEntry(hash, key, value, bucketIndex);&#125;void createEntry(int hash, K key, V value, int bucketIndex) &#123; Entry&lt;K,V&gt; e = table[bucketIndex]; table[bucketIndex] = new Entry&lt;&gt;(hash, key, value, e); size++;&#125; å½“è°ƒç”¨ addEntry å†™å…¥ Entry æ—¶éœ€è¦åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ã€‚ å¦‚æœéœ€è¦å°±è¿›è¡Œä¸¤å€æ‰©å……ï¼Œå¹¶å°†å½“å‰çš„ key é‡æ–° hash å¹¶å®šä½ã€‚ è€Œåœ¨ createEntry ä¸­ä¼šå°†å½“å‰ä½ç½®çš„æ¡¶ä¼ å…¥åˆ°æ–°å»ºçš„æ¡¶ä¸­ï¼Œå¦‚æœå½“å‰æ¡¶æœ‰å€¼å°±ä¼šåœ¨ä½ç½®å½¢æˆé“¾è¡¨ã€‚ get æ–¹æ³•å†æ¥çœ‹çœ‹ get å‡½æ•°ï¼š 123456789101112131415161718192021222324public V get(Object key) &#123; if (key == null) return getForNullKey(); Entry&lt;K,V&gt; entry = getEntry(key); return null == entry ? null : entry.getValue();&#125;final Entry&lt;K,V&gt; getEntry(Object key) &#123; if (size == 0) &#123; return null; &#125; int hash = (key == null) ? 0 : hash(key); for (Entry&lt;K,V&gt; e = table[indexFor(hash, table.length)]; e != null; e = e.next) &#123; Object k; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; return null;&#125; é¦–å…ˆä¹Ÿæ˜¯æ ¹æ® key è®¡ç®—å‡º hashcodeï¼Œç„¶åå®šä½åˆ°å…·ä½“çš„æ¡¶ä¸­ã€‚ åˆ¤æ–­è¯¥ä½ç½®æ˜¯å¦ä¸ºé“¾è¡¨ã€‚ ä¸æ˜¯é“¾è¡¨å°±æ ¹æ® keyã€key çš„ hashcode æ˜¯å¦ç›¸ç­‰æ¥è¿”å›å€¼ã€‚ ä¸ºé“¾è¡¨åˆ™éœ€è¦éå†ç›´åˆ° key åŠ hashcode ç›¸ç­‰æ—¶å€™å°±è¿”å›å€¼ã€‚ å•¥éƒ½æ²¡å–åˆ°å°±ç›´æ¥è¿”å› null ã€‚ Base 1.8ä¸çŸ¥é“ 1.7 çš„å®ç°å¤§å®¶çœ‹å‡ºéœ€è¦ä¼˜åŒ–çš„ç‚¹æ²¡æœ‰ï¼Ÿ å…¶å®ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„åœ°æ–¹å°±æ˜¯ï¼š å½“ Hash å†²çªä¸¥é‡æ—¶ï¼Œåœ¨æ¡¶ä¸Šå½¢æˆçš„é“¾è¡¨ä¼šå˜çš„è¶Šæ¥è¶Šé•¿ï¼Œè¿™æ ·åœ¨æŸ¥è¯¢æ—¶çš„æ•ˆç‡å°±ä¼šè¶Šæ¥è¶Šä½ï¼›æ—¶é—´å¤æ‚åº¦ä¸º O(N)ã€‚ å› æ­¤ 1.8 ä¸­é‡ç‚¹ä¼˜åŒ–äº†è¿™ä¸ªæŸ¥è¯¢æ•ˆç‡ã€‚ 1.8 HashMap ç»“æ„å›¾ï¼š å…ˆæ¥çœ‹çœ‹å‡ ä¸ªæ ¸å¿ƒçš„æˆå‘˜å˜é‡ï¼š 12345678910111213141516171819202122232425262728static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // aka 16/** * The maximum capacity, used if a higher value is implicitly specified * by either of the constructors with arguments. * MUST be a power of two &lt;= 1&lt;&lt;30. */static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;/** * The load factor used when none specified in constructor. */static final float DEFAULT_LOAD_FACTOR = 0.75f;static final int TREEIFY_THRESHOLD = 8;transient Node&lt;K,V&gt;[] table;/** * Holds cached entrySet(). Note that AbstractMap fields are used * for keySet() and values(). */transient Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;/** * The number of key-value mappings contained in this map. */transient int size; å’Œ 1.7 å¤§ä½“ä¸Šéƒ½å·®ä¸å¤šï¼Œè¿˜æ˜¯æœ‰å‡ ä¸ªé‡è¦çš„åŒºåˆ«ï¼š TREEIFY_THRESHOLD ç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘çš„é˜ˆå€¼ã€‚ HashEntry ä¿®æ”¹ä¸º Nodeã€‚ Node çš„æ ¸å¿ƒç»„æˆå…¶å®ä¹Ÿæ˜¯å’Œ 1.7 ä¸­çš„ HashEntry ä¸€æ ·ï¼Œå­˜æ”¾çš„éƒ½æ˜¯ key value hashcode next ç­‰æ•°æ®ã€‚ å†æ¥çœ‹çœ‹æ ¸å¿ƒæ–¹æ³•ã€‚ put æ–¹æ³• çœ‹ä¼¼è¦æ¯” 1.7 çš„å¤æ‚ï¼Œæˆ‘ä»¬ä¸€æ­¥æ­¥æ‹†è§£ï¼š åˆ¤æ–­å½“å‰æ¡¶æ˜¯å¦ä¸ºç©ºï¼Œç©ºçš„å°±éœ€è¦åˆå§‹åŒ–ï¼ˆresize ä¸­ä¼šåˆ¤æ–­æ˜¯å¦è¿›è¡Œåˆå§‹åŒ–ï¼‰ã€‚ æ ¹æ®å½“å‰ key çš„ hashcode å®šä½åˆ°å…·ä½“çš„æ¡¶ä¸­å¹¶åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºè¡¨æ˜æ²¡æœ‰ Hash å†²çªå°±ç›´æ¥åœ¨å½“å‰ä½ç½®åˆ›å»ºä¸€ä¸ªæ–°æ¡¶å³å¯ã€‚ å¦‚æœå½“å‰æ¡¶æœ‰å€¼ï¼ˆ Hash å†²çªï¼‰ï¼Œé‚£ä¹ˆå°±è¦æ¯”è¾ƒå½“å‰æ¡¶ä¸­çš„ keyã€key çš„ hashcode ä¸å†™å…¥çš„ key æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰å°±èµ‹å€¼ç»™ e,åœ¨ç¬¬ 8 æ­¥çš„æ—¶å€™ä¼šç»Ÿä¸€è¿›è¡Œèµ‹å€¼åŠè¿”å›ã€‚ å¦‚æœå½“å‰æ¡¶ä¸ºçº¢é»‘æ ‘ï¼Œé‚£å°±è¦æŒ‰ç…§çº¢é»‘æ ‘çš„æ–¹å¼å†™å…¥æ•°æ®ã€‚ å¦‚æœæ˜¯ä¸ªé“¾è¡¨ï¼Œå°±éœ€è¦å°†å½“å‰çš„ keyã€value å°è£…æˆä¸€ä¸ªæ–°èŠ‚ç‚¹å†™å…¥åˆ°å½“å‰æ¡¶çš„åé¢ï¼ˆå½¢æˆé“¾è¡¨ï¼‰ã€‚ æ¥ç€åˆ¤æ–­å½“å‰é“¾è¡¨çš„å¤§å°æ˜¯å¦å¤§äºé¢„è®¾çš„é˜ˆå€¼ï¼Œå¤§äºæ—¶å°±è¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚ å¦‚æœåœ¨éå†è¿‡ç¨‹ä¸­æ‰¾åˆ° key ç›¸åŒæ—¶ç›´æ¥é€€å‡ºéå†ã€‚ å¦‚æœ e != null å°±ç›¸å½“äºå­˜åœ¨ç›¸åŒçš„ key,é‚£å°±éœ€è¦å°†å€¼è¦†ç›–ã€‚ æœ€ååˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œæ‰©å®¹ã€‚ get æ–¹æ³•12345678910111213141516171819202122232425public V get(Object key) &#123; Node&lt;K,V&gt; e; return (e = getNode(hash(key), key)) == null ? null : e.value;&#125;final Node&lt;K,V&gt; getNode(int hash, Object key) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k; if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (first = tab[(n - 1) &amp; hash]) != null) &#123; if (first.hash == hash &amp;&amp; // always check first node ((k = first.key) == key || (key != null &amp;&amp; key.equals(k)))) return first; if ((e = first.next) != null) &#123; if (first instanceof TreeNode) return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key); do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; while ((e = e.next) != null); &#125; &#125; return null;&#125; get æ–¹æ³•çœ‹èµ·æ¥å°±è¦ç®€å•è®¸å¤šäº†ã€‚ é¦–å…ˆå°† key hash ä¹‹åå–å¾—æ‰€å®šä½çš„æ¡¶ã€‚ å¦‚æœæ¡¶ä¸ºç©ºåˆ™ç›´æ¥è¿”å› null ã€‚ å¦åˆ™åˆ¤æ–­æ¡¶çš„ç¬¬ä¸€ä¸ªä½ç½®(æœ‰å¯èƒ½æ˜¯é“¾è¡¨ã€çº¢é»‘æ ‘)çš„ key æ˜¯å¦ä¸ºæŸ¥è¯¢çš„ keyï¼Œæ˜¯å°±ç›´æ¥è¿”å› valueã€‚ å¦‚æœç¬¬ä¸€ä¸ªä¸åŒ¹é…ï¼Œåˆ™åˆ¤æ–­å®ƒçš„ä¸‹ä¸€ä¸ªæ˜¯çº¢é»‘æ ‘è¿˜æ˜¯é“¾è¡¨ã€‚ çº¢é»‘æ ‘å°±æŒ‰ç…§æ ‘çš„æŸ¥æ‰¾æ–¹å¼è¿”å›å€¼ã€‚ ä¸ç„¶å°±æŒ‰ç…§é“¾è¡¨çš„æ–¹å¼éå†åŒ¹é…è¿”å›å€¼ã€‚ ä»è¿™ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼ˆget/putï¼‰å¯ä»¥çœ‹å‡º 1.8 ä¸­å¯¹å¤§é“¾è¡¨åšäº†ä¼˜åŒ–ï¼Œä¿®æ”¹ä¸ºçº¢é»‘æ ‘ä¹‹åæŸ¥è¯¢æ•ˆç‡ç›´æ¥æé«˜åˆ°äº† O(logn)ã€‚ ä½†æ˜¯ HashMap åŸæœ‰çš„é—®é¢˜ä¹Ÿéƒ½å­˜åœ¨ï¼Œæ¯”å¦‚åœ¨å¹¶å‘åœºæ™¯ä¸‹ä½¿ç”¨æ—¶å®¹æ˜“å‡ºç°æ­»å¾ªç¯ã€‚ 123456789final HashMap&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();for (int i = 0; i &lt; 1000; i++) &#123; new Thread(new Runnable() &#123; @Override public void run() &#123; map.put(UUID.randomUUID().toString(), ""); &#125; &#125;).start();&#125; ä½†æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿç®€å•åˆ†æä¸‹ã€‚ çœ‹è¿‡ä¸Šæ–‡çš„è¿˜è®°å¾—åœ¨ HashMap æ‰©å®¹çš„æ—¶å€™ä¼šè°ƒç”¨ resize() æ–¹æ³•ï¼Œå°±æ˜¯è¿™é‡Œçš„å¹¶å‘æ“ä½œå®¹æ˜“åœ¨ä¸€ä¸ªæ¡¶ä¸Šå½¢æˆç¯å½¢é“¾è¡¨ï¼›è¿™æ ·å½“è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„ key æ—¶ï¼Œè®¡ç®—å‡ºçš„ index æ­£å¥½æ˜¯ç¯å½¢é“¾è¡¨çš„ä¸‹æ ‡å°±ä¼šå‡ºç°æ­»å¾ªç¯ã€‚ å¦‚ä¸‹å›¾ï¼š éå†æ–¹å¼è¿˜æœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„æ˜¯ HashMap çš„éå†æ–¹å¼ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹å‡ ç§ï¼š 123456789101112Iterator&lt;Map.Entry&lt;String, Integer&gt;&gt; entryIterator = map.entrySet().iterator(); while (entryIterator.hasNext()) &#123; Map.Entry&lt;String, Integer&gt; next = entryIterator.next(); System.out.println("key=" + next.getKey() + " value=" + next.getValue()); &#125; Iterator&lt;String&gt; iterator = map.keySet().iterator(); while (iterator.hasNext())&#123; String key = iterator.next(); System.out.println("key=" + key + " value=" + map.get(key)); &#125; å¼ºçƒˆå»ºè®®ä½¿ç”¨ç¬¬ä¸€ç§ EntrySet è¿›è¡Œéå†ã€‚ ç¬¬ä¸€ç§å¯ä»¥æŠŠ key value åŒæ—¶å–å‡ºï¼Œç¬¬äºŒç§è¿˜å¾—éœ€è¦é€šè¿‡ key å–ä¸€æ¬¡ valueï¼Œæ•ˆç‡è¾ƒä½ã€‚ ç®€å•æ€»ç»“ä¸‹ HashMapï¼šæ— è®ºæ˜¯ 1.7 è¿˜æ˜¯ 1.8 å…¶å®éƒ½èƒ½çœ‹å‡º JDK æ²¡æœ‰å¯¹å®ƒåšä»»ä½•çš„åŒæ­¥æ“ä½œï¼Œæ‰€ä»¥å¹¶å‘ä¼šå‡ºé—®é¢˜ï¼Œç”šè‡³ 1.7 ä¸­å‡ºç°æ­»å¾ªç¯å¯¼è‡´ç³»ç»Ÿä¸å¯ç”¨ï¼ˆ1.8 å·²ç»ä¿®å¤æ­»å¾ªç¯é—®é¢˜ï¼‰ã€‚ å› æ­¤ JDK æ¨å‡ºäº†ä¸“é¡¹ä¸“ç”¨çš„ ConcurrentHashMap ï¼Œè¯¥ç±»ä½äº java.util.concurrent åŒ…ä¸‹ï¼Œä¸“é—¨ç”¨äºè§£å†³å¹¶å‘é—®é¢˜ã€‚ åšæŒçœ‹åˆ°è¿™é‡Œçš„æœ‹å‹ç®—æ˜¯å·²ç»æŠŠ ConcurrentHashMap çš„åŸºç¡€å·²ç»æ‰“ç‰¢äº†ï¼Œä¸‹é¢æ­£å¼å¼€å§‹åˆ†æã€‚ ConcurrentHashMapConcurrentHashMap åŒæ ·ä¹Ÿåˆ†ä¸º 1.7 ã€1.8 ç‰ˆï¼Œä¸¤è€…åœ¨å®ç°ä¸Šç•¥æœ‰ä¸åŒã€‚ Base 1.7å…ˆæ¥çœ‹çœ‹ 1.7 çš„å®ç°ï¼Œä¸‹é¢æ˜¯ä»–çš„ç»“æ„å›¾ï¼š å¦‚å›¾æ‰€ç¤ºï¼Œæ˜¯ç”± Segment æ•°ç»„ã€HashEntry ç»„æˆï¼Œå’Œ HashMap ä¸€æ ·ï¼Œä»ç„¶æ˜¯æ•°ç»„åŠ é“¾è¡¨ã€‚ å®ƒçš„æ ¸å¿ƒæˆå‘˜å˜é‡ï¼š 1234567/** * Segment æ•°ç»„ï¼Œå­˜æ”¾æ•°æ®æ—¶é¦–å…ˆéœ€è¦å®šä½åˆ°å…·ä½“çš„ Segment ä¸­ã€‚ */final Segment&lt;K,V&gt;[] segments;transient Set&lt;K&gt; keySet;transient Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet; Segment æ˜¯ ConcurrentHashMap çš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œä¸»è¦çš„ç»„æˆå¦‚ä¸‹ï¼š 12345678910111213141516 static final class Segment&lt;K,V&gt; extends ReentrantLock implements Serializable &#123; private static final long serialVersionUID = 2249069246763182397L; // å’Œ HashMap ä¸­çš„ HashEntry ä½œç”¨ä¸€æ ·ï¼ŒçœŸæ­£å­˜æ”¾æ•°æ®çš„æ¡¶ transient volatile HashEntry&lt;K,V&gt;[] table; transient int count; transient int modCount; transient int threshold; final float loadFactor; &#125; çœ‹çœ‹å…¶ä¸­ HashEntry çš„ç»„æˆï¼š å’Œ HashMap éå¸¸ç±»ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯å…¶ä¸­çš„æ ¸å¿ƒæ•°æ®å¦‚ value ï¼Œä»¥åŠé“¾è¡¨éƒ½æ˜¯ volatile ä¿®é¥°çš„ï¼Œä¿è¯äº†è·å–æ—¶çš„å¯è§æ€§ã€‚ åŸç†ä¸Šæ¥è¯´ï¼šConcurrentHashMap é‡‡ç”¨äº†åˆ†æ®µé”æŠ€æœ¯ï¼Œå…¶ä¸­ Segment ç»§æ‰¿äº ReentrantLockã€‚ä¸ä¼šåƒ HashTable é‚£æ ·ä¸ç®¡æ˜¯ put è¿˜æ˜¯ get æ“ä½œéƒ½éœ€è¦åšåŒæ­¥å¤„ç†ï¼Œç†è®ºä¸Š ConcurrentHashMap æ”¯æŒ CurrencyLevel (Segment æ•°ç»„æ•°é‡)çš„çº¿ç¨‹å¹¶å‘ã€‚æ¯å½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®ä¸€ä¸ª Segment æ—¶ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çš„ Segmentã€‚ ä¸‹é¢ä¹Ÿæ¥çœ‹çœ‹æ ¸å¿ƒçš„ put get æ–¹æ³•ã€‚ put æ–¹æ³•1234567891011public V put(K key, V value) &#123; Segment&lt;K,V&gt; s; if (value == null) throw new NullPointerException(); int hash = hash(key); int j = (hash &gt;&gt;&gt; segmentShift) &amp; segmentMask; if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObject // nonvolatile; recheck (segments, (j &lt;&lt; SSHIFT) + SBASE)) == null) // in ensureSegment s = ensureSegment(j); return s.put(key, hash, value, false);&#125; é¦–å…ˆæ˜¯é€šè¿‡ key å®šä½åˆ° Segmentï¼Œä¹‹ååœ¨å¯¹åº”çš„ Segment ä¸­è¿›è¡Œå…·ä½“çš„ putã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243final V put(K key, int hash, V value, boolean onlyIfAbsent) &#123; HashEntry&lt;K,V&gt; node = tryLock() ? null : scanAndLockForPut(key, hash, value); V oldValue; try &#123; HashEntry&lt;K,V&gt;[] tab = table; int index = (tab.length - 1) &amp; hash; HashEntry&lt;K,V&gt; first = entryAt(tab, index); for (HashEntry&lt;K,V&gt; e = first;;) &#123; if (e != null) &#123; K k; if ((k = e.key) == key || (e.hash == hash &amp;&amp; key.equals(k))) &#123; oldValue = e.value; if (!onlyIfAbsent) &#123; e.value = value; ++modCount; &#125; break; &#125; e = e.next; &#125; else &#123; if (node != null) node.setNext(first); else node = new HashEntry&lt;K,V&gt;(hash, key, value, first); int c = count + 1; if (c &gt; threshold &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY) rehash(node); else setEntryAt(tab, index, node); ++modCount; count = c; oldValue = null; break; &#125; &#125; &#125; finally &#123; unlock(); &#125; return oldValue;&#125; è™½ç„¶ HashEntry ä¸­çš„ value æ˜¯ç”¨ volatile å…³é”®è¯ä¿®é¥°çš„ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯å¹¶å‘çš„åŸå­æ€§ï¼Œæ‰€ä»¥ put æ“ä½œæ—¶ä»ç„¶éœ€è¦åŠ é”å¤„ç†ã€‚ é¦–å…ˆç¬¬ä¸€æ­¥çš„æ—¶å€™ä¼šå°è¯•è·å–é”ï¼Œå¦‚æœè·å–å¤±è´¥è‚¯å®šå°±æœ‰å…¶ä»–çº¿ç¨‹å­˜åœ¨ç«äº‰ï¼Œåˆ™åˆ©ç”¨ scanAndLockForPut() è‡ªæ—‹è·å–é”ã€‚ å°è¯•è‡ªæ—‹è·å–é”ã€‚ å¦‚æœé‡è¯•çš„æ¬¡æ•°è¾¾åˆ°äº† MAX_SCAN_RETRIES åˆ™æ”¹ä¸ºé˜»å¡é”è·å–ï¼Œä¿è¯èƒ½è·å–æˆåŠŸã€‚ å†ç»“åˆå›¾çœ‹çœ‹ put çš„æµç¨‹ã€‚ å°†å½“å‰ Segment ä¸­çš„ table é€šè¿‡ key çš„ hashcode å®šä½åˆ° HashEntryã€‚ éå†è¯¥ HashEntryï¼Œå¦‚æœä¸ä¸ºç©ºåˆ™åˆ¤æ–­ä¼ å…¥çš„ key å’Œå½“å‰éå†çš„ key æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰åˆ™è¦†ç›–æ—§çš„ valueã€‚ ä¸ä¸ºç©ºåˆ™éœ€è¦æ–°å»ºä¸€ä¸ª HashEntry å¹¶åŠ å…¥åˆ° Segment ä¸­ï¼ŒåŒæ—¶ä¼šå…ˆåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ã€‚ æœ€åä¼šè§£é™¤åœ¨ 1 ä¸­æ‰€è·å–å½“å‰ Segment çš„é”ã€‚ get æ–¹æ³•1234567891011121314151617public V get(Object key) &#123; Segment&lt;K,V&gt; s; // manually integrate access methods to reduce overhead HashEntry&lt;K,V&gt;[] tab; int h = hash(key); long u = (((h &gt;&gt;&gt; segmentShift) &amp; segmentMask) &lt;&lt; SSHIFT) + SBASE; if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(segments, u)) != null &amp;&amp; (tab = s.table) != null) &#123; for (HashEntry&lt;K,V&gt; e = (HashEntry&lt;K,V&gt;) UNSAFE.getObjectVolatile (tab, ((long)(((tab.length - 1) &amp; h)) &lt;&lt; TSHIFT) + TBASE); e != null; e = e.next) &#123; K k; if ((k = e.key) == key || (e.hash == h &amp;&amp; key.equals(k))) return e.value; &#125; &#125; return null;&#125; get é€»è¾‘æ¯”è¾ƒç®€å•ï¼š åªéœ€è¦å°† Key é€šè¿‡ Hash ä¹‹åå®šä½åˆ°å…·ä½“çš„ Segment ï¼Œå†é€šè¿‡ä¸€æ¬¡ Hash å®šä½åˆ°å…·ä½“çš„å…ƒç´ ä¸Šã€‚ ç”±äº HashEntry ä¸­çš„ value å±æ€§æ˜¯ç”¨ volatile å…³é”®è¯ä¿®é¥°çš„ï¼Œä¿è¯äº†å†…å­˜å¯è§æ€§ï¼Œæ‰€ä»¥æ¯æ¬¡è·å–æ—¶éƒ½æ˜¯æœ€æ–°å€¼ã€‚ ConcurrentHashMap çš„ get æ–¹æ³•æ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œå› ä¸ºæ•´ä¸ªè¿‡ç¨‹éƒ½ä¸éœ€è¦åŠ é”ã€‚ Base 1.81.7 å·²ç»è§£å†³äº†å¹¶å‘é—®é¢˜ï¼Œå¹¶ä¸”èƒ½æ”¯æŒ N ä¸ª Segment è¿™ä¹ˆå¤šæ¬¡æ•°çš„å¹¶å‘ï¼Œä½†ä¾ç„¶å­˜åœ¨ HashMap åœ¨ 1.7 ç‰ˆæœ¬ä¸­çš„é—®é¢˜ã€‚ é‚£å°±æ˜¯æŸ¥è¯¢éå†é“¾è¡¨æ•ˆç‡å¤ªä½ã€‚ å› æ­¤ 1.8 åšäº†ä¸€äº›æ•°æ®ç»“æ„ä¸Šçš„è°ƒæ•´ã€‚ é¦–å…ˆæ¥çœ‹ä¸‹åº•å±‚çš„ç»„æˆç»“æ„ï¼š çœ‹èµ·æ¥æ˜¯ä¸æ˜¯å’Œ 1.8 HashMap ç»“æ„ç±»ä¼¼ï¼Ÿ å…¶ä¸­æŠ›å¼ƒäº†åŸæœ‰çš„ Segment åˆ†æ®µé”ï¼Œè€Œé‡‡ç”¨äº† CAS + synchronized æ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§ã€‚ ä¹Ÿå°† 1.7 ä¸­å­˜æ”¾æ•°æ®çš„ HashEntry æ”¹ä¸º Nodeï¼Œä½†ä½œç”¨éƒ½æ˜¯ç›¸åŒçš„ã€‚ å…¶ä¸­çš„ val next éƒ½ç”¨äº† volatile ä¿®é¥°ï¼Œä¿è¯äº†å¯è§æ€§ã€‚ put æ–¹æ³•é‡ç‚¹æ¥çœ‹çœ‹ put å‡½æ•°ï¼š æ ¹æ® key è®¡ç®—å‡º hashcode ã€‚ åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œåˆå§‹åŒ–ã€‚ f å³ä¸ºå½“å‰ key å®šä½å‡ºçš„ Nodeï¼Œå¦‚æœä¸ºç©ºè¡¨ç¤ºå½“å‰ä½ç½®å¯ä»¥å†™å…¥æ•°æ®ï¼Œåˆ©ç”¨ CAS å°è¯•å†™å…¥ï¼Œå¤±è´¥åˆ™è‡ªæ—‹ä¿è¯æˆåŠŸã€‚ å¦‚æœå½“å‰ä½ç½®çš„ hashcode == MOVED == -1,åˆ™éœ€è¦è¿›è¡Œæ‰©å®¹ã€‚ å¦‚æœéƒ½ä¸æ»¡è¶³ï¼Œåˆ™åˆ©ç”¨ synchronized é”å†™å…¥æ•°æ®ã€‚ å¦‚æœæ•°é‡å¤§äº TREEIFY_THRESHOLD åˆ™è¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚ get æ–¹æ³• æ ¹æ®è®¡ç®—å‡ºæ¥çš„ hashcode å¯»å€ï¼Œå¦‚æœå°±åœ¨æ¡¶ä¸Šé‚£ä¹ˆç›´æ¥è¿”å›å€¼ã€‚ å¦‚æœæ˜¯çº¢é»‘æ ‘é‚£å°±æŒ‰ç…§æ ‘çš„æ–¹å¼è·å–å€¼ã€‚ å°±ä¸æ»¡è¶³é‚£å°±æŒ‰ç…§é“¾è¡¨çš„æ–¹å¼éå†è·å–å€¼ã€‚ 1.8 åœ¨ 1.7 çš„æ•°æ®ç»“æ„ä¸Šåšäº†å¤§çš„æ”¹åŠ¨ï¼Œé‡‡ç”¨çº¢é»‘æ ‘ä¹‹åå¯ä»¥ä¿è¯æŸ¥è¯¢æ•ˆç‡ï¼ˆO(logn)ï¼‰ï¼Œç”šè‡³å–æ¶ˆäº† ReentrantLock æ”¹ä¸ºäº† synchronizedï¼Œè¿™æ ·å¯ä»¥çœ‹å‡ºåœ¨æ–°ç‰ˆçš„ JDK ä¸­å¯¹ synchronized ä¼˜åŒ–æ˜¯å¾ˆåˆ°ä½çš„ã€‚ æ€»ç»“çœ‹å®Œäº†æ•´ä¸ª HashMap å’Œ ConcurrentHashMap åœ¨ 1.7 å’Œ 1.8 ä¸­ä¸åŒçš„å®ç°æ–¹å¼ç›¸ä¿¡å¤§å®¶å¯¹ä»–ä»¬çš„ç†è§£åº”è¯¥ä¼šæ›´åŠ åˆ°ä½ã€‚ å…¶å®è¿™å—ä¹Ÿæ˜¯é¢è¯•çš„é‡ç‚¹å†…å®¹ï¼Œé€šå¸¸çš„å¥—è·¯æ˜¯ï¼š è°ˆè°ˆä½ ç†è§£çš„ HashMapï¼Œè®²è®²å…¶ä¸­çš„ get put è¿‡ç¨‹ã€‚ 1.8 åšäº†ä»€ä¹ˆä¼˜åŒ–ï¼Ÿ æ˜¯çº¿ç¨‹å®‰å…¨çš„å˜›ï¼Ÿ ä¸å®‰å…¨ä¼šå¯¼è‡´å“ªäº›é—®é¢˜ï¼Ÿ å¦‚ä½•è§£å†³ï¼Ÿæœ‰æ²¡æœ‰çº¿ç¨‹å®‰å…¨çš„å¹¶å‘å®¹å™¨ï¼Ÿ ConcurrentHashMap æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ 1.7ã€1.8 å®ç°æœ‰ä½•ä¸åŒï¼Ÿä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Ÿ è¿™ä¸€ä¸²é—®é¢˜ç›¸ä¿¡å¤§å®¶ä»”ç»†çœ‹å®Œéƒ½èƒ½æ€¼å›é¢è¯•å®˜ã€‚ é™¤äº†é¢è¯•ä¼šé—®åˆ°ä¹‹å¤–å¹³æ—¶çš„åº”ç”¨å…¶å®ä¹Ÿè›®å¤šï¼Œåƒä¹‹å‰è°ˆåˆ°çš„ Guava ä¸­ Cache çš„å®ç°å°±æ˜¯åˆ©ç”¨ ConcurrentHashMap çš„æ€æƒ³ã€‚ åŒæ—¶ä¹Ÿèƒ½å­¦ä¹  JDK ä½œè€…å¤§ç‰›ä»¬çš„ä¼˜åŒ–æ€è·¯ä»¥åŠå¹¶å‘è§£å†³æ–¹æ¡ˆã€‚ å…¶å®å†™è¿™ç¯‡çš„å‰ææ˜¯æºäº GitHub ä¸Šçš„ä¸€ä¸ª Issuesï¼Œä¹Ÿå¸Œæœ›å¤§å®¶èƒ½å‚ä¸è¿›æ¥ï¼Œå…±åŒç»´æŠ¤å¥½è¿™ä¸ªé¡¹ç›®ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview æ¬¢è¿å…³æ³¨å…¬ä¼—å·ä¸€èµ·äº¤æµï¼š]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>concurrent</tag>
        <tag>ConcurrentHashMap</tag>
        <tag>HashMap</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Guava æºç åˆ†æï¼ˆCache åŸç†ã€äºŒé˜¶æ®µã€‘ï¼‰]]></title>
    <url>%2F2018%2F07%2F16%2Fguava%2Fguava-cache-2%2F</url>
    <content type="text"><![CDATA[å‰è¨€åœ¨ä¸Šæ–‡ã€ŒGuava æºç åˆ†æï¼ˆCache åŸç†ï¼‰ã€ä¸­åˆ†æäº† Guava Cache çš„ç›¸å…³åŸç†ã€‚ æ–‡æœ«æåˆ°äº†å›æ”¶æœºåˆ¶ã€ç§»é™¤æ—¶é—´é€šçŸ¥ç­‰å†…å®¹ï¼Œè®¸å¤šæœ‹å‹ä¹ŸæŒºæ„Ÿå…´è¶£ï¼Œè¿™æ¬¡å°±è¿™ä¸¤ä¸ªå†…å®¹å†æ¥åˆ†æåˆ†æã€‚ åœ¨å¼€å§‹ä¹‹å‰å…ˆè¡¥ä¹ ä¸‹ Java è‡ªå¸¦çš„ä¸¤ä¸ªç‰¹æ€§ï¼ŒGuava ä¸­éƒ½æœ‰å…·ä½“çš„åº”ç”¨ã€‚ Java ä¸­çš„å¼•ç”¨é¦–å…ˆæ˜¯ Java ä¸­çš„å¼•ç”¨ã€‚ åœ¨ä¹‹å‰åˆ†äº«è¿‡ JVM æ˜¯æ ¹æ®å¯è¾¾æ€§åˆ†æç®—æ³•æ‰¾å‡ºéœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåˆ¤æ–­å¯¹è±¡çš„å­˜æ´»çŠ¶æ€éƒ½å’Œå¼•ç”¨æœ‰å…³ã€‚ åœ¨ JDK1.2 ä¹‹å‰è¿™ç‚¹è®¾è®¡çš„éå¸¸ç®€å•ï¼šä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€åªæœ‰å¼•ç”¨å’Œæ²¡è¢«å¼•ç”¨ä¸¤ç§åŒºåˆ«ã€‚ è¿™æ ·çš„åˆ’åˆ†å¯¹åƒåœ¾å›æ”¶ä¸æ˜¯å¾ˆå‹å¥½ï¼Œå› ä¸ºæ€»æœ‰ä¸€äº›å¯¹è±¡çš„çŠ¶æ€å¤„äºè¿™ä¸¤ä¹‹é—´ã€‚ å› æ­¤ 1.2 ä¹‹åæ–°å¢äº†å››ç§çŠ¶æ€ç”¨äºæ›´ç»†ç²’åº¦çš„åˆ’åˆ†å¼•ç”¨å…³ç³»ï¼š å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰:è¿™ç§å¯¹è±¡æœ€ä¸ºå¸¸è§ï¼Œæ¯”å¦‚ A a = new A();è¿™å°±æ˜¯å…¸å‹çš„å¼ºå¼•ç”¨ï¼›è¿™æ ·çš„å¼ºå¼•ç”¨å…³ç³»æ˜¯ä¸èƒ½è¢«åƒåœ¾å›æ”¶çš„ã€‚ è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰:è¿™æ ·çš„å¼•ç”¨è¡¨æ˜ä¸€äº›æœ‰ç”¨ä½†ä¸æ˜¯å¿…è¦çš„å¯¹è±¡ï¼Œåœ¨å°†å‘ç”Ÿåƒåœ¾å›æ”¶ä¹‹å‰æ˜¯éœ€è¦å°†è¿™æ ·çš„å¯¹è±¡å†æ¬¡å›æ”¶ã€‚ å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰:è¿™æ˜¯ä¸€ç§æ¯”è½¯å¼•ç”¨è¿˜å¼±çš„å¼•ç”¨å…³ç³»ï¼Œä¹Ÿæ˜¯å­˜æ”¾éå¿…é¡»çš„å¯¹è±¡ã€‚å½“åƒåœ¾å›æ”¶æ—¶ï¼Œæ— è®ºå½“å‰å†…å­˜æ˜¯å¦è¶³å¤Ÿï¼Œè¿™æ ·çš„å¯¹è±¡éƒ½ä¼šè¢«å›æ”¶ã€‚ è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰:è¿™æ˜¯ä¸€ç§æœ€å¼±çš„å¼•ç”¨å…³ç³»ï¼Œç”šè‡³æ²¡æ³•é€šè¿‡å¼•ç”¨æ¥è·å–å¯¹è±¡ï¼Œå®ƒå”¯ä¸€çš„ä½œç”¨å°±æ˜¯åœ¨è¢«å›æ”¶æ—¶å¯ä»¥è·å¾—é€šçŸ¥ã€‚ äº‹ä»¶å›è°ƒäº‹ä»¶å›è°ƒå…¶å®æ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œæ¯”å¦‚ä¹‹å‰è®²è¿‡çš„ Netty å°±ä½¿ç”¨äº†è¿™æ ·çš„è®¾è®¡ã€‚ è¿™é‡Œé‡‡ç”¨ä¸€ä¸ª demoï¼Œè¯•ä¸‹å¦‚ä¸‹åŠŸèƒ½ï¼š Caller å‘ Notifier æé—®ã€‚ æé—®æ–¹å¼æ˜¯å¼‚æ­¥ï¼Œæ¥ç€åšå…¶ä»–äº‹æƒ…ã€‚ Notifier æ”¶åˆ°é—®é¢˜æ‰§è¡Œè®¡ç®—ç„¶åå›è°ƒ Caller å‘ŠçŸ¥ç»“æœã€‚ åœ¨ Java ä¸­åˆ©ç”¨æ¥å£æ¥å®ç°å›è°ƒï¼Œæ‰€ä»¥éœ€è¦å®šä¹‰ä¸€ä¸ªæ¥å£ï¼š 12345678public interface CallBackListener &#123; /** * å›è°ƒé€šçŸ¥å‡½æ•° * @param msg */ void callBackNotify(String msg) ;&#125; Caller ä¸­è°ƒç”¨ Notifier æ‰§è¡Œæé—®ï¼Œè°ƒç”¨æ—¶å°†æ¥å£ä¼ é€’è¿‡å»ï¼š 1234567891011121314151617181920212223242526272829303132333435public class Caller &#123; private final static Logger LOGGER = LoggerFactory.getLogger(Caller.class); private CallBackListener callBackListener ; private Notifier notifier ; private String question ; /** * ä½¿ç”¨ */ public void call()&#123; LOGGER.info("å¼€å§‹æé—®"); //æ–°å»ºçº¿ç¨‹ï¼Œè¾¾åˆ°å¼‚æ­¥æ•ˆæœ new Thread(new Runnable() &#123; @Override public void run() &#123; try &#123; notifier.execute(Caller.this,question); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;).start(); LOGGER.info("æé—®å®Œæ¯•ï¼Œæˆ‘å»å¹²å…¶ä»–äº‹äº†"); &#125; //éšè— getter/setter &#125; Notifier æ”¶åˆ°æé—®ï¼Œæ‰§è¡Œè®¡ç®—ï¼ˆè€—æ—¶æ“ä½œï¼‰ï¼Œæœ€ååšå‡ºå“åº”ï¼ˆå›è°ƒæ¥å£ï¼Œå‘Šè¯‰ Caller ç»“æœï¼‰ã€‚ 12345678910111213141516public class Notifier &#123; private final static Logger LOGGER = LoggerFactory.getLogger(Notifier.class); public void execute(Caller caller, String msg) throws InterruptedException &#123; LOGGER.info("æ”¶åˆ°æ¶ˆæ¯=ã€&#123;&#125;ã€‘", msg); LOGGER.info("ç­‰å¾…å“åº”ä¸­ã€‚ã€‚ã€‚ã€‚ã€‚"); TimeUnit.SECONDS.sleep(2); caller.getCallBackListener().callBackNotify("æˆ‘åœ¨åŒ—äº¬ï¼"); &#125;&#125; æ¨¡æ‹Ÿæ‰§è¡Œï¼š 123456789101112131415public static void main(String[] args) &#123; Notifier notifier = new Notifier() ; Caller caller = new Caller() ; caller.setNotifier(notifier) ; caller.setQuestion("ä½ åœ¨å“ªå„¿ï¼"); caller.setCallBackListener(new CallBackListener() &#123; @Override public void callBackNotify(String msg) &#123; LOGGER.info("å›å¤=ã€&#123;&#125;ã€‘" ,msg); &#125; &#125;); caller.call();&#125; æœ€åæ‰§è¡Œç»“æœï¼š 123452018-07-15 19:52:11.105 [main] INFO c.crossoverjie.guava.callback.Caller - å¼€å§‹æé—®2018-07-15 19:52:11.118 [main] INFO c.crossoverjie.guava.callback.Caller - æé—®å®Œæ¯•ï¼Œæˆ‘å»å¹²å…¶ä»–äº‹äº†2018-07-15 19:52:11.117 [Thread-0] INFO c.c.guava.callback.Notifier - æ”¶åˆ°æ¶ˆæ¯=ã€ä½ åœ¨å“ªå„¿ï¼ã€‘2018-07-15 19:52:11.121 [Thread-0] INFO c.c.guava.callback.Notifier - ç­‰å¾…å“åº”ä¸­ã€‚ã€‚ã€‚ã€‚ã€‚2018-07-15 19:52:13.124 [Thread-0] INFO com.crossoverjie.guava.callback.Main - å›å¤=ã€æˆ‘åœ¨åŒ—äº¬ï¼ã€‘ è¿™æ ·ä¸€ä¸ªæ¨¡æ‹Ÿçš„å¼‚æ­¥äº‹ä»¶å›è°ƒå°±å®Œæˆäº†ã€‚ Guava çš„ç”¨æ³•Guava å°±æ˜¯åˆ©ç”¨äº†ä¸Šæ–‡çš„ä¸¤ä¸ªç‰¹æ€§æ¥å®ç°äº†å¼•ç”¨å›æ”¶åŠç§»é™¤é€šçŸ¥ã€‚ å¼•ç”¨å¯ä»¥åœ¨åˆå§‹åŒ–ç¼“å­˜æ—¶åˆ©ç”¨ï¼š CacheBuilder.weakKeys() CacheBuilder.weakValues() CacheBuilder.softValues() æ¥è‡ªå®šä¹‰é”®å’Œå€¼çš„å¼•ç”¨å…³ç³»ã€‚ åœ¨ä¸Šæ–‡çš„åˆ†æä¸­å¯ä»¥çœ‹å‡º Cache ä¸­çš„ ReferenceEntry æ˜¯ç±»ä¼¼äº HashMap çš„ Entry å­˜æ”¾æ•°æ®çš„ã€‚ æ¥çœ‹çœ‹ ReferenceEntry çš„å®šä¹‰ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344 interface ReferenceEntry&lt;K, V&gt; &#123; /** * Returns the value reference from this entry. */ ValueReference&lt;K, V&gt; getValueReference(); /** * Sets the value reference for this entry. */ void setValueReference(ValueReference&lt;K, V&gt; valueReference); /** * Returns the next entry in the chain. */ @Nullable ReferenceEntry&lt;K, V&gt; getNext(); /** * Returns the entry's hash. */ int getHash(); /** * Returns the key for this entry. */ @Nullable K getKey(); /* * Used by entries that use access order. Access entries are maintained in a doubly-linked list. * New entries are added at the tail of the list at write time; stale entries are expired from * the head of the list. */ /** * Returns the time that this entry was last accessed, in ns. */ long getAccessTime(); /** * Sets the entry access time in ns. */ void setAccessTime(long time);&#125; åŒ…å«äº†å¾ˆå¤šå¸¸ç”¨çš„æ“ä½œï¼Œå¦‚å€¼å¼•ç”¨ã€é”®å¼•ç”¨ã€è®¿é—®æ—¶é—´ç­‰ã€‚ æ ¹æ® ValueReference&lt;K, V&gt; getValueReference(); çš„å®ç°ï¼š å…·æœ‰å¼ºå¼•ç”¨å’Œå¼±å¼•ç”¨çš„ä¸åŒå®ç°ã€‚ key ä¹Ÿæ˜¯ç›¸åŒçš„é“ç†ï¼š å½“ä½¿ç”¨è¿™æ ·çš„æ„é€ æ–¹å¼æ—¶ï¼Œå¼±å¼•ç”¨çš„ key å’Œ value éƒ½ä¼šè¢«åƒåœ¾å›æ”¶ã€‚ å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ˜¾å¼çš„å›æ”¶ï¼š 1234567891011121314151617/** * Discards any cached value for key &#123;@code key&#125;. * å•ä¸ªå›æ”¶ */void invalidate(Object key);/** * Discards any cached values for keys &#123;@code keys&#125;. * * @since 11.0 */void invalidateAll(Iterable&lt;?&gt; keys);/** * Discards all entries in the cache. */void invalidateAll(); å›è°ƒæ”¹é€ äº†ä¹‹å‰çš„ä¾‹å­ï¼š 1234567891011121314loadingCache = CacheBuilder.newBuilder() .expireAfterWrite(2, TimeUnit.SECONDS) .removalListener(new RemovalListener&lt;Object, Object&gt;() &#123; @Override public void onRemoval(RemovalNotification&lt;Object, Object&gt; notification) &#123; LOGGER.info("åˆ é™¤åŸå› =&#123;&#125;ï¼Œåˆ é™¤ key=&#123;&#125;,åˆ é™¤ value=&#123;&#125;",notification.getCause(),notification.getKey(),notification.getValue()); &#125; &#125;) .build(new CacheLoader&lt;Integer, AtomicLong&gt;() &#123; @Override public AtomicLong load(Integer key) throws Exception &#123; return new AtomicLong(0); &#125; &#125;); æ‰§è¡Œç»“æœï¼š 1234562018-07-15 20:41:07.433 [main] INFO c.crossoverjie.guava.CacheLoaderTest - å½“å‰ç¼“å­˜å€¼=0,ç¼“å­˜å¤§å°=12018-07-15 20:41:07.442 [main] INFO c.crossoverjie.guava.CacheLoaderTest - ç¼“å­˜çš„æ‰€æœ‰å†…å®¹=&#123;1000=0&#125;2018-07-15 20:41:07.443 [main] INFO c.crossoverjie.guava.CacheLoaderTest - job running times=102018-07-15 20:41:10.461 [main] INFO c.crossoverjie.guava.CacheLoaderTest - åˆ é™¤åŸå› =EXPIREDï¼Œåˆ é™¤ key=1000,åˆ é™¤ value=12018-07-15 20:41:10.462 [main] INFO c.crossoverjie.guava.CacheLoaderTest - å½“å‰ç¼“å­˜å€¼=0,ç¼“å­˜å¤§å°=12018-07-15 20:41:10.462 [main] INFO c.crossoverjie.guava.CacheLoaderTest - ç¼“å­˜çš„æ‰€æœ‰å†…å®¹=&#123;1000=0&#125; å¯ä»¥çœ‹å‡ºå½“ç¼“å­˜è¢«åˆ é™¤çš„æ—¶å€™ä¼šå›è°ƒæˆ‘ä»¬è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œå¹¶å‘ŠçŸ¥åˆ é™¤åŸå› ã€‚ é‚£ä¹ˆ Guava æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ æ ¹æ® LocalCache ä¸­çš„ getLiveValue() ä¸­åˆ¤æ–­ç¼“å­˜è¿‡æœŸæ—¶ï¼Œè·Ÿç€è¿™é‡Œçš„è°ƒç”¨å…³ç³»å°±ä¼šä¸€ç›´è·Ÿåˆ°ï¼š removeValueFromChain() ä¸­çš„ï¼š enqueueNotification() æ–¹æ³•ä¼šå°†å›æ”¶çš„ç¼“å­˜ï¼ˆåŒ…å«äº† keyï¼Œvalueï¼‰ä»¥åŠå›æ”¶åŸå› åŒ…è£…æˆä¹‹å‰å®šä¹‰çš„äº‹ä»¶æ¥å£åŠ å…¥åˆ°ä¸€ä¸ªæœ¬åœ°é˜Ÿåˆ—ä¸­ã€‚ è¿™æ ·ä¸€çœ‹ä¹Ÿæ²¡æœ‰å›è°ƒæˆ‘ä»¬åˆå§‹åŒ–æ—¶å€™çš„äº‹ä»¶å•Šã€‚ ä¸è¿‡ç”¨è¿‡é˜Ÿåˆ—çš„åŒå­¦åº”è¯¥èƒ½çŒœå‡ºï¼Œæ—¢ç„¶è¿™é‡Œå†™å…¥é˜Ÿåˆ—ï¼Œé‚£å°±è‚¯å®šå°±æœ‰æ¶ˆè´¹ã€‚ æˆ‘ä»¬å›åˆ°è·å–ç¼“å­˜çš„åœ°æ–¹ï¼š åœ¨ finally ä¸­æ‰§è¡Œäº† postReadCleanup() æ–¹æ³•ï¼›å…¶å®åœ¨è¿™é‡Œé¢å°±æ˜¯å¯¹åˆšæ‰çš„é˜Ÿåˆ—è¿›è¡Œäº†æ¶ˆè´¹ï¼š ä¸€ç›´è·Ÿè¿›æ¥å°±ä¼šå‘ç°è¿™é‡Œæ¶ˆè´¹äº†é˜Ÿåˆ—ï¼Œå°†ä¹‹å‰åŒ…è£…å¥½çš„ç§»é™¤æ¶ˆæ¯è°ƒç”¨äº†æˆ‘ä»¬è‡ªå®šä¹‰çš„äº‹ä»¶ï¼Œè¿™æ ·å°±å®Œæˆäº†ä¸€æ¬¡äº‹ä»¶å›è°ƒã€‚ æ€»ç»“ä»¥ä¸Šæ‰€æœ‰æºç ï¼š https://github.com/crossoverJie/Java-Interview/blob/master/src/main/java/com/crossoverjie/guava/callback/Main.java é€šè¿‡åˆ†æ Guava çš„æºç å¯ä»¥è®©æˆ‘ä»¬å­¦ä¹ åˆ°é¡¶çº§çš„è®¾è®¡åŠå®ç°æ–¹å¼ï¼Œç”šè‡³è‡ªå·±ä¹Ÿèƒ½å°è¯•ç¼–å†™ã€‚ Guava é‡Œè¿˜æœ‰å¾ˆå¤šå¼ºå¤§çš„å¢å¼ºå®ç°ï¼Œå€¼å¾—æˆ‘ä»¬å†å¥½å¥½ç ”ç©¶ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview æ¬¢è¿å…³æ³¨å…¬ä¼—å·ä¸€èµ·äº¤æµï¼š]]></content>
      <categories>
        <category>Guava</category>
      </categories>
      <tags>
        <tag>Cache</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€æ¬¡çº¿ä¸Šé—®é¢˜æ’æŸ¥æ‰€å¼•å‘çš„æ€è€ƒ]]></title>
    <url>%2F2018%2F07%2F08%2Fjava-senior%2FJVM-Troubleshoot%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¹‹å‰æˆ–å¤šæˆ–å°‘åˆ†äº«è¿‡ä¸€äº›å†…å­˜æ¨¡å‹ã€å¯¹è±¡åˆ›å»ºä¹‹ç±»çš„å†…å®¹ï¼Œå…¶å®å¤§éƒ¨åˆ†äººçœ‹å®Œéƒ½æ˜¯æ‡µæ‡µæ‡‚æ‡‚ï¼Œä¹Ÿä¸çŸ¥é“è¿™äº›çš„å®é™…æ„ä¹‰ã€‚ ç›´åˆ°æœ‰ä¸€å¤©ä½ ä¼šç¢°åˆ°çº¿ä¸Šå¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜ï¼Œå¦‚ï¼š çº¿ç¨‹æ‰§è¡Œä¸€ä¸ªä»»åŠ¡è¿Ÿè¿Ÿæ²¡æœ‰è¿”å›ï¼Œåº”ç”¨å‡æ­»ã€‚ æ¥å£å“åº”ç¼“æ…¢ï¼Œç”šè‡³è¯·æ±‚è¶…æ—¶ã€‚ CPU é«˜è´Ÿè½½è¿è¡Œã€‚ è¿™ç±»é—®é¢˜å¹¶ä¸åƒä¸€ä¸ªç©ºæŒ‡é’ˆã€æ•°ç»„è¶Šç•Œè¿™æ ·æ˜æ˜¾å¥½æŸ¥ï¼Œè¿™æ—¶å°±éœ€è¦åˆšæ‰æåˆ°çš„å†…å­˜æ¨¡å‹ã€å¯¹è±¡åˆ›å»ºã€çº¿ç¨‹ç­‰ç›¸å…³çŸ¥è¯†ç»“åˆåœ¨ä¸€èµ·æ¥æ’æŸ¥é—®é¢˜äº†ã€‚ æ­£å¥½è¿™æ¬¡å€ŸåŠ©ä¹‹å‰çš„ä¸€æ¬¡ç”Ÿäº§é—®é¢˜æ¥èŠèŠå¦‚ä½•æ’æŸ¥å’Œè§£å†³é—®é¢˜ã€‚ ç”Ÿäº§ç°è±¡é¦–å…ˆçœ‹çœ‹é—®é¢˜çš„èƒŒæ™¯å§ï¼š æˆ‘è¿™å…¶å®æ˜¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œåœ¨å›ºå®šçš„æ—¶é—´ä¼šå¼€å¯ N ä¸ªçº¿ç¨‹å¹¶å‘çš„ä» Redis ä¸­è·å–æ•°æ®è¿›è¡Œè¿ç®—ã€‚ ä¸šåŠ¡é€»è¾‘éå¸¸ç®€å•ï¼Œä½†åº”ç”¨ä¸€èˆ¬æ¶‰åŠåˆ°å¤šçº¿ç¨‹ä¹‹åå†ç®€å•çš„äº‹æƒ…éƒ½è¦å°å¿ƒå¯¹å¾…ã€‚ æœä¸å…¶ç„¶è¿™æ¬¡å°±å‡ºé—®é¢˜äº†ã€‚ ç°è±¡:åŸæœ¬åªéœ€è¦æ‰§è¡Œå‡ åˆ†é’Ÿçš„ä»»åŠ¡æ‰§è¡Œäº†å‡ ä¸ªå°æ—¶éƒ½æ²¡é€€å‡ºã€‚ç¿»éäº†æ‰€æœ‰çš„æ—¥å¿—éƒ½æ²¡æ‰¾åˆ°å¼‚å¸¸ã€‚ äºæ˜¯ä¾¿å¼€å§‹å®šä½é—®é¢˜ä¹‹è·¯ã€‚ å®šä½é—®é¢˜æ—¢ç„¶æ²¡åŠæ³•ç›´æ¥ä»æ—¥å¿—ä¸­å‘ç°å¼‚å¸¸ï¼Œé‚£å°±åªèƒ½çœ‹çœ‹åº”ç”¨åˆ°åº•åœ¨å¹²å˜›äº†ã€‚ æœ€å¸¸è§çš„å·¥å…·å°±æ˜¯ JDK è‡ªå¸¦çš„é‚£ä¸€å¥—ã€‚ è¿™æ¬¡æˆ‘ä½¿ç”¨äº† jstack æ¥æŸ¥çœ‹çº¿ç¨‹çš„æ‰§è¡Œæƒ…å†µï¼Œå®ƒçš„ä½œç”¨å…¶å®å°±æ˜¯ dump å½“å‰çš„çº¿ç¨‹å †æ ˆã€‚ å½“ç„¶åœ¨ dump ä¹‹å‰æ˜¯éœ€è¦çŸ¥é“æˆ‘åº”ç”¨çš„ pid çš„ï¼Œå¯ä»¥ä½¿ç”¨ jps -v è¿™æ ·çš„æ–¹å¼åˆ—å‡ºæ‰€æœ‰çš„ Java è¿›ç¨‹ã€‚ å½“ç„¶å¦‚æœçŸ¥é“å…³é”®å­—çš„è¯ç›´æ¥ä½¿ç”¨ ps aux|grep java ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ æ‹¿åˆ° pid=1523 äº†ä¹‹åå°±å¯ä»¥åˆ©ç”¨ jstack 1523 &gt; 1523.log è¿™æ ·çš„æ–¹å¼å°† dump æ–‡ä»¶è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ä¸­ã€‚ å¦‚æœåº”ç”¨ç®€å•ä¸å¤æ‚ï¼Œçº¿ç¨‹è¿™äº›ä¹Ÿæ¯”è¾ƒå°‘å…¶å®å¯ä»¥ç›´æ¥æ‰“å¼€æŸ¥çœ‹ã€‚ ä½†å¤æ‚çš„åº”ç”¨å¯¼å‡ºæ¥çš„æ—¥å¿—æ–‡ä»¶ä¹Ÿæ¯”è¾ƒå¤§è¿˜æ˜¯å»ºè®®ç”¨ä¸“ä¸šçš„åˆ†æå·¥å…·ã€‚ æˆ‘è¿™é‡Œçš„æ—¥å¿—æ¯”è¾ƒå°‘ç›´æ¥æ‰“å¼€å°±å¯ä»¥äº†ã€‚ å› ä¸ºæˆ‘æ¸…æ¥šçŸ¥é“åº”ç”¨ä¸­å¼€å¯çš„çº¿ç¨‹åç§°ï¼Œæ‰€ä»¥ç›´æ¥æ ¹æ®çº¿ç¨‹åå°±å¯ä»¥åœ¨æ—¥å¿—ä¸­æ‰¾åˆ°ç›¸å…³çš„å †æ ˆï¼š æ‰€ä»¥é€šå¸¸å»ºè®®å¤§å®¶çº¿ç¨‹åå­—ç»™çš„æœ‰æ„ä¹‰ï¼Œåœ¨æ’æŸ¥é—®é¢˜æ—¶å¾ˆæœ‰å¿…è¦ã€‚ å…¶å®å…¶ä»–å‡ ä¸ªçº¿ç¨‹éƒ½å’Œè¿™é‡Œçš„å †æ ˆç±»ä¼¼ï¼Œå¾ˆæ˜æ˜¾çš„çœ‹å‡ºéƒ½æ˜¯åœ¨åš Redis è¿æ¥ã€‚ äºæ˜¯æˆ‘ç™»å½• Redis æŸ¥çœ‹äº†å½“å‰çš„è¿æ¥æ•°ï¼Œå‘ç°å·²ç»éå¸¸é«˜äº†ã€‚ è¿™æ · Redis çš„å“åº”è‡ªç„¶ä¹Ÿå°±å˜æ…¢äº†ã€‚ æ¥ç€åˆ©ç”¨ jps -v åˆ—å‡ºäº†å½“å‰æ‰€ä»¥åœ¨è·‘çš„ Java è¿›ç¨‹ï¼Œæœä¸å…¶ç„¶æœ‰å¥½å‡ ä¸ªåº”ç”¨éƒ½åœ¨æŸ¥è¯¢ Redisï¼Œè€Œä¸”éƒ½æ˜¯å¹¶å‘è¿æ¥ï¼Œé—®é¢˜è‡ªç„¶å°±æ‰¾åˆ°äº†ã€‚ è§£å†³åŠæ³• æ‰€ä»¥é—®é¢˜çš„ä¸»è¦åŸå› æ˜¯ï¼šå¤§é‡çš„åº”ç”¨å¹¶å‘æŸ¥è¯¢ Redisï¼Œå¯¼è‡´ Redis çš„æ€§èƒ½é™ä½ã€‚ æ—¢ç„¶æ‰¾åˆ°äº†é—®é¢˜ï¼Œé‚£å¦‚ä½•è§£å†³å‘¢ï¼Ÿ å‡å°‘åŒæ—¶æŸ¥è¯¢ Redis çš„åº”ç”¨ï¼Œåˆ†å¼€æ—¶æ®µé™ä½ Redis çš„å‹åŠ›ã€‚ å°† Redis å¤åˆ¶å‡ ä¸ªé›†ç¾¤ï¼Œå„ä¸ªåº”ç”¨åˆ†å¼€æŸ¥è¯¢ã€‚ä½†æ˜¯è¿™æ ·ä¼šæ¶‰åŠåˆ°æ•°æ®çš„åŒæ­¥ç­‰è¿ç»´æ“ä½œï¼Œæˆ–è€…ç”±ç¨‹åºäº†è¿›è¡ŒåŒæ­¥ä¹Ÿä¼šå¢åŠ å¤æ‚åº¦ã€‚ ç›®å‰æˆ‘ä»¬é€‰æ‹©çš„æ˜¯ç¬¬ä¸€ä¸ªæ–¹æ¡ˆï¼Œæ•ˆæœå¾ˆæ˜æ˜¾ã€‚ æœ¬åœ°æ¨¡æ‹Ÿä¸Šæ–‡ä»‹ç»çš„æ˜¯çº¿ç¨‹ç›¸å…³é—®é¢˜ï¼Œç°åœ¨æ¥åˆ†æä¸‹å†…å­˜çš„é—®é¢˜ã€‚ ä»¥è¿™ä¸ªç±»ä¸ºä¾‹ï¼š https://github.com/crossoverJie/Java-Interview/blob/master/src/main/java/com/crossoverjie/oom/heap/HeapOOM.java 123456789public class HeapOOM &#123; public static void main(String[] args) &#123; List&lt;String&gt; list = new ArrayList&lt;&gt;(10) ; while (true)&#123; list.add("1") ; &#125; &#125;&#125; å¯åŠ¨å‚æ•°å¦‚ä¸‹ï¼š 1234-Xms20m-Xmx20m-XX:+HeapDumpOnOutOfMemoryError-XX:HeapDumpPath=/Users/xx/Documents ä¸ºäº†æ›´å¿«çš„çªå‡ºå†…å­˜é—®é¢˜å°†å †çš„æœ€å¤§å†…å­˜å›ºå®šåœ¨ 20Mï¼ŒåŒæ—¶åœ¨ JVM å‡ºç° OOM çš„æ—¶å€™è‡ªåŠ¨ dump å†…å­˜åˆ° /Users/xx/Documents(ä¸é…è·¯å¾„åˆ™ä¼šç”Ÿæˆåœ¨å½“å‰ç›®å½•)ã€‚ æ‰§è¡Œä¹‹åæœä¸å…¶ç„¶å‡ºç°äº†å¼‚å¸¸ï¼š åŒæ—¶å¯¹åº”çš„å†…å­˜ dump æ–‡ä»¶ä¹Ÿç”Ÿæˆäº†ã€‚ å†…å­˜åˆ†æè¿™æ—¶å°±éœ€è¦ç›¸åº”çš„å·¥å…·è¿›è¡Œåˆ†æäº†ï¼Œæœ€å¸¸ç”¨çš„è‡ªç„¶å°±æ˜¯ MAT äº†ã€‚ æˆ‘è¯•äº†ä¸€ä¸ªåœ¨çº¿å·¥å…·ä¹Ÿä¸é”™ï¼ˆæ–‡ä»¶å¤§äº†å°±ä¸é€‚åˆäº†ï¼‰ï¼š http://heaphero.io/index.jsp ä¸Šä¼ åˆšæ‰ç”Ÿæˆçš„å†…å­˜æ–‡ä»¶ä¹‹åï¼š å› ä¸ºæ˜¯å†…å­˜æº¢å‡ºï¼Œæ‰€ä»¥ä¸»è¦è§‚å¯Ÿä¸‹å¤§å¯¹è±¡ï¼š ä¹Ÿæœ‰ç›¸åº”æç¤ºï¼Œè¿™ä¸ªå¾ˆæœ‰å¯èƒ½å°±æ˜¯å†…å­˜æº¢å‡ºçš„å¯¹è±¡ï¼Œç‚¹è¿›å»ä¹‹åï¼š çœ‹åˆ°è¿™ä¸ªå †æ ˆå…¶å®å°±å¾ˆæ˜æ˜¾äº†ï¼š åœ¨å‘ ArrayList ä¸­ä¸åœçš„å†™å…¥æ•°æ®æ—¶ï¼Œä¼šå¯¼è‡´é¢‘ç¹çš„æ‰©å®¹ä¹Ÿå°±æ˜¯æ•°ç»„å¤åˆ¶è¿™äº›è¿‡ç¨‹ï¼Œæœ€ç»ˆè¾¾åˆ° 20M çš„ä¸Šé™å¯¼è‡´å†…å­˜æº¢å‡ºäº†ã€‚ æ›´å¤šå»ºè®®ä¸Šæ–‡è¯´è¿‡ï¼Œä¸€æ—¦ä½¿ç”¨äº†å¤šçº¿ç¨‹ï¼Œé‚£å°±è¦æ ¼å¤–å°å¿ƒã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›æ—¥å¸¸å»ºè®®ï¼š å°½é‡ä¸è¦åœ¨çº¿ç¨‹ä¸­åšå¤§é‡è€—æ—¶çš„ç½‘ç»œæ“ä½œï¼Œå¦‚æŸ¥è¯¢æ•°æ®åº“ï¼ˆå¯ä»¥çš„è¯åœ¨ä¸€å¼€å§‹å°±å°†æ•°æ®ä»ä» DB ä¸­æŸ¥å‡ºå‡†å¤‡å¥½ï¼‰ã€‚ å°½å¯èƒ½çš„å‡å°‘å¤šçº¿ç¨‹ç«äº‰é”ã€‚å¯ä»¥å°†æ•°æ®åˆ†æ®µï¼Œå„ä¸ªçº¿ç¨‹åˆ†åˆ«è¯»å–ã€‚ å¤šåˆ©ç”¨ CAS+è‡ªæ—‹ çš„æ–¹å¼æ›´æ–°æ•°æ®ï¼Œå‡å°‘é”çš„ä½¿ç”¨ã€‚ åº”ç”¨ä¸­åŠ ä¸Š -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/tmp å‚æ•°ï¼Œåœ¨å†…å­˜æº¢å‡ºæ—¶è‡³å°‘å¯ä»¥æ‹¿åˆ°å†…å­˜æ—¥å¿—ã€‚ çº¿ç¨‹æ± ç›‘æ§ã€‚å¦‚çº¿ç¨‹æ± å¤§å°ã€é˜Ÿåˆ—å¤§å°ã€æœ€å¤§çº¿ç¨‹æ•°ç­‰æ•°æ®ï¼Œå¯æå‰åšå¥½é¢„ä¼°ã€‚ JVM ç›‘æ§ï¼Œå¯ä»¥çœ‹åˆ°å †å†…å­˜çš„æ¶¨å¹…è¶‹åŠ¿ï¼ŒGC æ›²çº¿ç­‰æ•°æ®ï¼Œä¹Ÿå¯ä»¥æå‰åšå¥½å‡†å¤‡ã€‚ æ€»ç»“çº¿ä¸Šé—®é¢˜å®šä½éœ€è¦ç»¼åˆæŠ€èƒ½ï¼Œæ‰€ä»¥æ˜¯éœ€è¦ä¸€äº›åŸºç¡€æŠ€èƒ½ã€‚å¦‚çº¿ç¨‹ã€å†…å­˜æ¨¡å‹ã€Linux ç­‰ã€‚ å½“ç„¶è¿™äº›é—®é¢˜æ²¡æœ‰å®æ“è¿‡éƒ½æ˜¯çº¸ä¸Šè°ˆå…µï¼›å¦‚æœç¬¬ä¸€æ¬¡ç¢°åˆ°çº¿ä¸Šé—®é¢˜ï¼Œä¸è¦æ…Œå¼ ï¼Œåè€Œåº”è¯¥åº†å¹¸è§£å†³ä¹‹åä½ åˆä¼šä¹ å¾—ä¸€é¡¹æŠ€èƒ½ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview æ¬¢è¿å…³æ³¨å…¬ä¼—å·ä¸€èµ·äº¤æµï¼š]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Thread</tag>
        <tag>concurrent</tag>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Netty(äºŒ) ä»çº¿ç¨‹æ¨¡å‹çš„è§’åº¦çœ‹ Netty ä¸ºä»€ä¹ˆæ˜¯é«˜æ€§èƒ½çš„ï¼Ÿ]]></title>
    <url>%2F2018%2F07%2F04%2Fnetty%2FNetty(2)Thread-model%2F</url>
    <content type="text"><![CDATA[å‰è¨€åœ¨ä¹‹å‰çš„ SpringBoot æ•´åˆé•¿è¿æ¥å¿ƒè·³æœºåˆ¶ ä¸€æ–‡ä¸­è®¤è¯†äº† Nettyã€‚ ä½†å…¶å®åªæ˜¯èƒ½ç”¨ï¼Œä¸ºä»€ä¹ˆè¦ç”¨ Nettyï¼Ÿå®ƒæœ‰å“ªäº›ä¼˜åŠ¿ï¼Ÿè¿™äº›å…¶å®éƒ½ä¸æ¸…æ¥šã€‚ æœ¬æ–‡å°±æ¥ä»å†å²æºå¤´è¯´é“è¯´é“ã€‚ ä¼ ç»Ÿ IOåœ¨ Netty ä»¥åŠ NIO å‡ºç°ä¹‹å‰ï¼Œæˆ‘ä»¬å†™ IO åº”ç”¨å…¶å®ç”¨çš„éƒ½æ˜¯ç”¨ java.io.* ä¸‹æ‰€æä¾›çš„åŒ…ã€‚ æ¯”å¦‚ä¸‹é¢çš„ä¼ªä»£ç ï¼š 123456789ServeSocket serverSocket = new ServeSocket(8080);Socket socket = serverSocket.accept() ;BufferReader in = .... ;String request ; while((request = in.readLine()) != null)&#123; new Thread(new Task()).start()&#125; å¤§æ¦‚æ˜¯è¿™æ ·ï¼Œå…¶å®ä¸»è¦æƒ³è¡¨è¾¾çš„æ˜¯ï¼šè¿™æ ·ä¸€ä¸ªçº¿ç¨‹åªèƒ½å¤„ç†ä¸€ä¸ªè¿æ¥ã€‚ å¦‚æœæ˜¯ 100 ä¸ªå®¢æˆ·ç«¯è¿æ¥é‚£å°±å¾—å¼€ 100 ä¸ªçº¿ç¨‹ï¼Œ1000 é‚£å°±å¾— 1000 ä¸ªçº¿ç¨‹ã€‚ è¦çŸ¥é“çº¿ç¨‹èµ„æºéå¸¸å®è´µï¼Œæ¯æ¬¡çš„åˆ›å»ºéƒ½ä¼šå¸¦æ¥æ¶ˆè€—ï¼Œè€Œä¸”æ¯ä¸ªçº¿ç¨‹è¿˜å¾—ä¸ºå®ƒåˆ†é…å¯¹åº”çš„æ ˆå†…å­˜ã€‚ å³ä¾¿æ˜¯æˆ‘ä»¬ç»™ JVM è¶³å¤Ÿçš„å†…å­˜ï¼Œå¤§é‡çº¿ç¨‹æ‰€å¸¦æ¥çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ä¹Ÿæ˜¯å—ä¸äº†çš„ã€‚ å¹¶ä¸”ä¼ ç»Ÿ IO æ˜¯é˜»å¡æ¨¡å¼ï¼Œæ¯ä¸€æ¬¡çš„å“åº”å¿…é¡»çš„æ˜¯å‘èµ· IO è¯·æ±‚ï¼Œå¤„ç†è¯·æ±‚å®Œæˆå†åŒæ—¶è¿”å›ï¼Œç›´æ¥çš„ç»“æœå°±æ˜¯æ€§èƒ½å·®ï¼Œååé‡ä½ã€‚ Reactor æ¨¡å‹å› æ­¤ä¸šç•Œå¸¸ç”¨çš„é«˜æ€§èƒ½ IO æ¨¡å‹æ˜¯ Reactorã€‚ å®ƒæ˜¯ä¸€ç§å¼‚æ­¥ã€éé˜»å¡çš„äº‹ä»¶é©±åŠ¨æ¨¡å‹ã€‚ é€šå¸¸ä¹Ÿè¡¨ç°ä¸ºä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼š å•çº¿ç¨‹ ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼š å®ƒæ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹æ¥æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå¹¶å°†è¯¥è¯·æ±‚åˆ†å‘åˆ°å¯¹åº”çš„äº‹ä»¶å¤„ç† handler ä¸­ï¼Œæ•´ä¸ªè¿‡ç¨‹å®Œå…¨æ˜¯å¼‚æ­¥éé˜»å¡çš„ï¼›å¹¶ä¸”å®Œå…¨ä¸å­˜åœ¨å…±äº«èµ„æºçš„é—®é¢˜ã€‚æ‰€ä»¥ç†è®ºä¸Šæ¥è¯´ååé‡ä¹Ÿè¿˜ä¸é”™ã€‚ ä½†ç”±äºæ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå¯¹å¤šæ ¸ CPU åˆ©ç”¨ç‡ä¸é«˜ï¼Œä¸€æ—¦æœ‰å¤§é‡çš„å®¢æˆ·ç«¯è¿æ¥ä¸Šæ¥æ€§èƒ½å¿…ç„¶ä¸‹é™ï¼Œç”šè‡³ä¼šæœ‰å¤§é‡è¯·æ±‚æ— æ³•å“åº”ã€‚æœ€åçš„æƒ…å†µæ˜¯ä¸€æ—¦è¿™ä¸ªçº¿ç¨‹å“ªé‡Œæ²¡æœ‰å¤„ç†å¥½è¿›å…¥äº†æ­»å¾ªç¯é‚£æ•´ä¸ªæœåŠ¡éƒ½å°†ä¸å¯ç”¨ï¼ å¤šçº¿ç¨‹ å› æ­¤äº§ç”Ÿäº†å¤šçº¿ç¨‹æ¨¡å‹ã€‚ å…¶å®æœ€å¤§çš„æ”¹è¿›å°±æ˜¯å°†åŸæœ‰çš„äº‹ä»¶å¤„ç†æ”¹ä¸ºäº†å¤šçº¿ç¨‹ã€‚ å¯ä»¥åŸºäº Java è‡ªèº«çš„çº¿ç¨‹æ± å®ç°ï¼Œè¿™æ ·åœ¨å¤§é‡è¯·æ±‚çš„å¤„ç†ä¸Šæ€§èƒ½æç¤ºæ˜¯å·¨å¤§çš„ã€‚ è™½ç„¶å¦‚æ­¤ï¼Œä½†ç†è®ºä¸Šæ¥è¯´ä¾ç„¶æœ‰ä¸€ä¸ªåœ°æ–¹æ˜¯å•ç‚¹çš„ï¼›é‚£å°±æ˜¯å¤„ç†å®¢æˆ·ç«¯è¿æ¥çš„çº¿ç¨‹ã€‚ å› ä¸ºå¤§å¤šæ•°æœåŠ¡ç«¯åº”ç”¨æˆ–å¤šæˆ–å°‘åœ¨è¿æ¥æ—¶éƒ½ä¼šå¤„ç†ä¸€äº›ä¸šåŠ¡ï¼Œå¦‚é‰´æƒä¹‹ç±»çš„ï¼Œå½“è¿æ¥çš„å®¢æˆ·ç«¯è¶Šæ¥è¶Šå¤šæ—¶è¿™ä¸€ä¸ªçº¿ç¨‹ä¾ç„¶ä¼šå­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚ äºæ˜¯åˆæœ‰äº†ä¸‹é¢çš„çº¿ç¨‹æ¨¡å‹ã€‚ ä¸»ä»å¤šçº¿ç¨‹ è¯¥æ¨¡å‹å°†å®¢æˆ·ç«¯è¿æ¥é‚£ä¸€å—çš„çº¿ç¨‹ä¹Ÿæ”¹ä¸ºå¤šçº¿ç¨‹ï¼Œç§°ä¸ºä¸»çº¿ç¨‹ã€‚ åŒæ—¶ä¹Ÿæ˜¯å¤šä¸ªå­çº¿ç¨‹æ¥å¤„ç†äº‹ä»¶å“åº”ï¼Œè¿™æ ·æ— è®ºæ˜¯è¿æ¥è¿˜æ˜¯äº‹ä»¶éƒ½æ˜¯é«˜æ€§èƒ½çš„ã€‚ Netty å®ç°ä»¥ä¸Šè°ˆäº†è¿™ä¹ˆå¤šå…¶å® Netty çš„çº¿ç¨‹æ¨¡å‹ä¸ä¹‹çš„ç±»ä¼¼ã€‚ æˆ‘ä»¬å›åˆ°ä¹‹å‰ SpringBoot æ•´åˆé•¿è¿æ¥å¿ƒè·³æœºåˆ¶TCP-Heartbeat/) ä¸­çš„æœåŠ¡ç«¯ä»£ç ï¼š 1234567891011121314151617181920212223242526private EventLoopGroup boss = new NioEventLoopGroup();private EventLoopGroup work = new NioEventLoopGroup();/** * å¯åŠ¨ Netty * * @return * @throws InterruptedException */@PostConstructpublic void start() throws InterruptedException &#123; ServerBootstrap bootstrap = new ServerBootstrap() .group(boss, work) .channel(NioServerSocketChannel.class) .localAddress(new InetSocketAddress(nettyPort)) //ä¿æŒé•¿è¿æ¥ .childOption(ChannelOption.SO_KEEPALIVE, true) .childHandler(new HeartbeatInitializer()); ChannelFuture future = bootstrap.bind().sync(); if (future.isSuccess()) &#123; LOGGER.info("å¯åŠ¨ Netty æˆåŠŸ"); &#125;&#125; å…¶å®è¿™é‡Œçš„ boss å°±ç›¸å½“äº Reactor æ¨¡å‹ä¸­å¤„ç†å®¢æˆ·ç«¯è¿æ¥çš„çº¿ç¨‹æ± ã€‚ work è‡ªç„¶å°±æ˜¯å¤„ç†äº‹ä»¶çš„çº¿ç¨‹æ± äº†ã€‚ é‚£ä¹ˆå¦‚ä½•æ¥å®ç°ä¸Šæ–‡çš„ä¸‰ç§æ¨¡å¼å‘¢ï¼Ÿå…¶å®ä¹Ÿå¾ˆç®€å•ï¼š å•çº¿ç¨‹æ¨¡å‹ï¼š 1234private EventLoopGroup group = new NioEventLoopGroup();ServerBootstrap bootstrap = new ServerBootstrap() .group(group) .childHandler(new HeartbeatInitializer()); å¤šçº¿ç¨‹æ¨¡å‹ï¼š 12345private EventLoopGroup boss = new NioEventLoopGroup(1);private EventLoopGroup work = new NioEventLoopGroup();ServerBootstrap bootstrap = new ServerBootstrap() .group(boss,work) .childHandler(new HeartbeatInitializer()); ä¸»ä»å¤šçº¿ç¨‹ï¼š 12345private EventLoopGroup boss = new NioEventLoopGroup();private EventLoopGroup work = new NioEventLoopGroup();ServerBootstrap bootstrap = new ServerBootstrap() .group(boss,work) .childHandler(new HeartbeatInitializer()); ç›¸ä¿¡å¤§å®¶ä¸€çœ‹ä¹Ÿæ˜ç™½ã€‚ æ€»ç»“å…¶å®çœ‹è¿‡äº† Netty çš„çº¿ç¨‹æ¨¡å‹ä¹‹åèƒ½å¦å¯¹æˆ‘ä»¬å¹³æ—¶åšé«˜æ€§èƒ½åº”ç”¨å¸¦æ¥ç‚¹å¯å‘å‘¢ï¼Ÿ æˆ‘è®¤ä¸ºæ˜¯å¯ä»¥çš„ï¼š æ¥å£åŒæ­¥è½¬å¼‚æ­¥å¤„ç†ã€‚ å›è°ƒé€šçŸ¥ç»“æœã€‚ å¤šçº¿ç¨‹æé«˜å¹¶å‘æ•ˆç‡ã€‚ æ— éä¹Ÿå°±æ˜¯è¿™äº›ï¼Œåªæ˜¯åšäº†è¿™äº›ä¹‹åå°±ä¼šå¸¦æ¥å…¶ä»–é—®é¢˜ï¼š å¼‚æ­¥ä¹‹åäº‹åŠ¡å¦‚ä½•ä¿è¯ï¼Ÿ å›è°ƒå¤±è´¥çš„æƒ…å†µï¼Ÿ å¤šçº¿ç¨‹æ‰€å¸¦æ¥çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€å…±äº«èµ„æºçš„é—®é¢˜ã€‚ è¿™å°±æ˜¯ä¸€ä¸ªåšå¼ˆçš„è¿‡ç¨‹ï¼Œæƒ³è¦åšåˆ°ä¸€ä¸ªå°½é‡é«˜æ•ˆçš„åº”ç”¨æ˜¯éœ€è¦ä¸æ–­ç£¨åˆè¯•é”™çš„ã€‚ ä¸Šæ–‡ç›¸å…³çš„ä»£ç ï¼š https://github.com/crossoverJie/netty-action æ¬¢è¿å…³æ³¨å…¬ä¼—å·ä¸€èµ·äº¤æµï¼š]]></content>
      <categories>
        <category>Netty</category>
      </categories>
      <tags>
        <tag>å†…å­˜æ¨¡å‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€ä¸ªå­¦æ¸£çš„é˜¿é‡Œä¹‹è·¯]]></title>
    <url>%2F2018%2F06%2F21%2Fpersonal%2FInterview-experience%2F</url>
    <content type="text"><![CDATA[å‰è¨€æœ€è¿‘æœ‰äº›æœ‹å‹åœ¨é¢è¯•é˜¿é‡Œï¼ŒåŠ ä¸Š Java-Interview é¡¹ç›®çš„åŸå› ä¹Ÿæœ‰å°ä¼™ä¼´å’Œæˆ‘è®¨è®ºï¼Œè¿‘æœŸä¹Ÿåœ¨è´Ÿè´£éƒ¨é—¨çš„æ‹›è˜ï¼Œè¿™è®©æˆ‘æƒ³èµ·å¹´åˆé‚£æ®µé•¿è¾¾ä¸‰ä¸ªæœˆçš„å¥‡è‘©é¢è¯•ç»å†ğŸ¤£ã€‚ æœ¬æ¥æ²¡æƒ³æ‹¿å‡ºæ¥è¯´çš„ï¼Œæ¯•ç«Ÿæœ€åä¹Ÿæ²¡æˆã€‚ ä½†ç”±äºé‚£å‡ ä¸ªæœˆçš„ç»å†è®©æˆ‘äº†è§£åˆ°äº†å¤§å‚çš„å·¥ä½œæ–¹å¼ã€å¯¹å€™é€‰åŒå­¦çš„è€ƒå¯Ÿé‡ç‚¹ä»¥åŠé¢è¯•å®˜çš„å¥—è·¯ç­‰éƒ½æœ‰äº†å…¨æ–°çš„è®¤è¯†ã€‚ å½“ç„¶æœ€é‡è¦çš„æ˜¯è¿™æ®µæ—¶é—´çš„æŸ¥æ¼è¡¥ç¼ºä¹Ÿè®©è‡ªå·±ç²¾è¿›ä¸å°‘ã€‚ å…ˆäº¤ä»£ä¸‹èƒŒæ™¯å§ï¼š ä»å»å¹´ 12 æœˆåˆ°ä»Šå¹´ä¸‰æœˆåº•ï¼Œæˆ‘å‰å‰ååé¢äº†é˜¿é‡Œä¸‰ä¸ªéƒ¨é—¨ã€‚ å…¶ä¸­ä¸¤ä¸ªéƒ¨é—¨é€šè¿‡äº†æŠ€æœ¯é¢è¯•ï¼Œè¿˜æœ‰ä¸€ä¸ªè·ªåœ¨äº†ä¸‰é¢ã€‚ å…‰çœ‹ç»“æœè¿˜ä¸é”™ï¼Œä½†æ•´ä¸ªæµç¨‹å ªç§°æ›²æŠ˜ã€‚ ä¸‹é¢æˆ‘ä¼šå°½é‡æè¿°æµç¨‹ä»¥åŠå¤§è‡´çš„é¢è¯•é¢˜ç›®å¤§çº²ï¼Œå¸Œæœ›å¯¹æƒ³è¦è·³æ§½ã€æ­£åœ¨é¢è¯•çš„åŒå­¦å¸¦æ¥ç‚¹çµæ„Ÿï¼Œå¸®åŠ©å¯èƒ½è°ˆä¸ä¸Šï¼Œä½†å¯å‘è¿˜æ˜¯èƒ½æœ‰ã€‚ ä»¥ä¸‹å†…å®¹è¾ƒé•¿ï¼Œè¯·å†æ¬¡å¤‡å¥½ç“œå­æ¿å‡³ã€‚ A éƒ¨é—¨é¦–å…ˆæ˜¯ç¬¬ä¸€æ¬¡æœºä¼šï¼Œå»å¹´ 12 æœˆä»½æœ‰ä½å¤§ä½¬åŠ æˆ‘ï¼Œåæ¥æ‰çŸ¥é“æ˜¯ä¸€ä¸ªéƒ¨é—¨çš„æŠ€æœ¯ Leader åœ¨ç½‘ä¸Šçœ‹åˆ°æˆ‘çš„åšå®¢ï¼Œé—®æˆ‘æƒ³ä¸æƒ³æ¥é˜¿é‡Œè¯•è¯•ã€‚ è¿™æ—¶è·ç¦»ä¸Šæ¬¡é¢é˜¿é‡Œä¹Ÿè¿‡å»ä¸€å¹´å¤šäº†ï¼Œä¹Ÿæƒ³çœ‹çœ‹ç°åœ¨å‡ æ–¤å‡ ä¸¤ï¼Œäºæ˜¯ä¾¿åŒæ„äº†ã€‚ åœ¨æ¨èä¸€å‘¨ä¹‹åæ”¶åˆ°äº†æ­å·æ‰“æ¥çš„ç”µè¯ï¼Œè¯´æ¥ä¹Ÿå·§ï¼Œé‚£æ—¶å€™æˆ‘æ­£åœ¨æœºåœºå€™æœºï¼Œè·ç¦»ç™»è®°è¿˜æœ‰å¤§æ¦‚ä¸€ä¸ªå°æ—¶ï¼Œå¿ƒæƒ³æ—¶é—´è‚¯å®šå¤Ÿäº†ã€‚ é‚£æ˜¯æˆ‘æ—¶éš”ä¸€å¹´å¤šç¬¬ä¸€æ¬¡é¢è¯•ï¼Œè¿˜æ˜¯åœ¨æœºåœºè¿™æ ·å˜ˆæ‚çš„ç¯å¢ƒé‡Œã€‚å¤šå¤šå°‘å°‘è¿˜æ˜¯æœ‰äº›ç´§å¼ ã€‚ ä¸€é¢ä»¥ä¸‹æ˜¯æˆ‘å°è±¡æ¯”è¾ƒæ·±åˆ»çš„å†…å®¹ï¼š é¢è¯•å®˜ï¼š è°ˆè°ˆä½ åšè¿‡é¡¹ç›®ä¸­å°è±¡è¾ƒæ·±æˆ–è‡ªè®¤ä¸ºåšçš„æ¯”è¾ƒå¥½çš„åœ°æ–¹ï¼Ÿ åšä¸»ï¼š æˆ‘è§‰å¾—æˆ‘åœ¨ XX åšçš„ä¸é”™ï¼Œç”¨äº† XX éœ€æ±‚å®ç° XX åŠŸèƒ½ï¼Œæ€§èƒ½æé«˜äº† N å€ã€‚ é¢è¯•å®˜ï¼š ä½ è¯´ä½¿ç”¨åˆ°äº† AOP ï¼Œèƒ½è°ˆè°ˆå®ƒçš„å®ç°åŸç†å˜›ï¼Ÿ åšä¸»ï¼š å®ƒæ˜¯ä¾é åŠ¨æ€ä»£ç†å®ç°çš„ï¼ŒåŠ¨æ€ä»£ç†åˆåˆ†ä¸º JDK è‡ªèº«çš„ä»¥åŠ CGLIB ã€‚ã€‚ã€‚ã€‚ é¢è¯•å®˜ï¼š å—¯ï¼Œèƒ½è¯´è¯´ä»–ä»¬çš„ä¸åŒåŠä¼˜ç¼ºç‚¹å˜›ï¼Ÿ åšä¸»ï¼š JDK æ˜¯åŸºäºæ¥å£å®ç°ï¼Œè€Œ CGLIB ç»§æ‰¿ä»£ç†ç±»ã€‚ã€‚ã€‚ å°±æ˜¯è¿™æ ·ä¼šä¸€ç›´é—®ä¸‹å»ï¼Œå¦‚æœèŠçš„å·®ä¸å¤šäº†å°±å¼€å§‹é—®ä¸€äº›é›¶æ•£çš„é—®é¢˜ï¼š JMM å†…å­˜æ¨¡å‹ï¼Œå¦‚ä½•åˆ’åˆ†çš„ï¼Ÿåˆ†åˆ«å­˜å‚¨ä»€ä¹ˆå†…å®¹ï¼Ÿçº¿ç¨‹å®‰å…¨ä¸å¦ï¼Ÿ ç±»åŠ è½½æœºåˆ¶ï¼Œè°ˆåˆ°åŒäº²å§”æ´¾æ¨¡å‹åä¼šé—®åˆ°å“ªäº›è¿åäº†åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦åŒäº²å§”æ´¾ï¼Ÿå¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿ å¹³æ—¶æ€ä¹ˆä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿæœ‰å“ªäº›å¥½å¤„ï¼Ÿçº¿ç¨‹æ± çš„å‡ ä¸ªæ ¸å¿ƒå‚æ•°çš„æ„ä¹‰ï¼Ÿ çº¿ç¨‹é—´é€šä¿¡çš„æ–¹å¼ï¼Ÿ HashMap çš„åŸç†ï¼Ÿå½“è°ˆåˆ°çº¿ç¨‹ä¸å®‰å…¨æ—¶è‡ªç„¶å¼•ç”³å‡º ConcurrentHashMap ï¼Œå®ƒçš„å®ç°åŸç†ï¼Ÿ åˆ†åº“åˆ†è¡¨å¦‚ä½•è®¾è®¡ï¼Ÿå‚ç›´æ‹†åˆ†ã€æ°´å¹³æ‹†åˆ†ï¼Ÿ ä¸šåŠ¡ ID çš„ç”Ÿæˆè§„åˆ™ï¼Œæœ‰å“ªäº›æ–¹å¼ï¼Ÿ SQL è°ƒä¼˜ï¼Ÿå¹³æ—¶ä½¿ç”¨æ•°æ®åº“æœ‰å“ªäº›æ³¨æ„ç‚¹ï¼Ÿ å½“ä¸€ä¸ªåº”ç”¨å¯åŠ¨ç¼“æ…¢å¦‚ä½•ä¼˜åŒ–ï¼Ÿ å¤§æ¦‚æ˜¯ä»¥ä¸Šè¿™äº›ï¼Œå½“èŠåˆ°å€’æ•°ç¬¬äºŒä¸ªæ—¶æˆ‘å·²ç»ç™»æœºäº†ã€‚æœ€åä¸å¾—ä¸æå‰æŒ‚æ–­ï¼Œç»“æŸä¹‹å‰å‘Šè¯‰æˆ‘ä¹‹åä¼šæ¢ä¸€ä¸ªåŒäº‹å’Œæˆ‘æ²Ÿé€šï¼Œå¬åˆ°è¿™æ ·çš„å›å¤ä¸€é¢åº”è¯¥æ˜¯è¿‡äº†ï¼Œåé¢ä¹Ÿç¡®å®è¯å®äº†è¿™ç‚¹ã€‚ äºŒé¢å¤§æ¦‚è¿‡äº†ä¸€å‘¨ï¼ŒäºŒé¢å¦‚æœŸè€Œè‡³ã€‚ æˆ‘å¬å£°éŸ³å¾ˆç†Ÿï¼Œå°±å°è¯•é—®ä¸‹æ˜¯ä¸æ˜¯ä¹‹å‰ä¸€é¢çš„é¢è¯•å®˜ï¼Œç»“æœçœŸæ˜¯ã€‚ ç”±äºäºŒé¢çš„é¢è¯•å®˜ä¸´æ—¶æœ‰äº‹æ‰€ä»¥ä»–æ¥æ›¿ä¸€ä¸‹ã€‚äºæ˜¯æˆ‘èµ¶ç´§é—®ä»–èƒ½å¦æŠŠä¹‹å‰ç­”çš„ä¸å¥½çš„å†è¯´è¯´ï¼Ÿçš„åˆ°äº†è‚¯å®šçš„ç­”å¤åå¼€å§‹äº†æˆ‘çš„è¡¨æ¼”ã€‚ æœ‰äº†ç¬¬ä¸€æ¬¡çš„ç»éªŒè¿™ä¸€æ¬¡è‡ªç„¶ä¹Ÿè½»è½¦ç†Ÿè·¯ï¼ŒåŸæœ¬æ„Ÿè§‰ä¸€åˆ‡å°½åœ¨æŒæ¡å´è¢«å‘ŠçŸ¥éœ€è¦ç¬”è¯•çªç„¶è¢«æ¿€é†’ã€‚ ç¬”è¯•æ˜¯ä¸€ä¸ªåœ¨çº¿å¹³å°ï¼Œéœ€è¦åœ¨ç½‘é¡µä¸­å†™ä»£ç ï¼Œä¼šæœ‰ä¸€ä¸ªæ˜ç¡®çš„é¢˜ç›®ï¼š ä»ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­æ ¹æ®å…³é”®å­—è¯»å–æ—¥å¿—ï¼Œè®°å½•å‡ºç°çš„æ¬¡æ•°ï¼Œæœ€åæŒ‰ç…§æ¬¡æ•°æ’åºæ‰“å°ã€‚ åœ¨è¿™è¿‡ç¨‹ä¸­åˆ‡è®°è¦å’Œé¢è¯•å®˜å¤šå¤šäº¤æµï¼Œå› ä¸ºç¬”è¯•æœ‰æ—¶é—´é™åˆ¶ï¼Œåˆ«åˆ°æœ€åå‘ç°é¢˜ç›®ç†è§£é”™äº†ï¼Œè¿™å°±å’Œé«˜è€ƒä½œæ–‡å†™å®Œå‘ç°æ–¹å‘é”™äº†ä¸€æ ·è¦å‘½ã€‚ è€Œä¸”åœ¨æ²Ÿé€šè¿‡ç¨‹ä¸­ä½“ç°å‡ºä½ è§£é¢˜çš„æ€è·¯ï¼Œå³ä½¿æœ€ç»ˆç»“æœä¸å¯¹ï¼Œä½†è¯´ä¸å®šæ€è€ƒçš„è¿‡ç¨‹å¾ˆç¬¦åˆé¢è¯•å®˜çš„èƒƒå£å“¦ã€‚è¿™ä¹Ÿå’Œä»Šå¹´çš„é«˜è€ƒæ”¹å·ä¸€æ ·ï¼›è¿‡ç¨‹æ­£ç¡®å¾—é«˜åˆ†ï¼Œåªæœ‰ç»“æœå¾—ä½åˆ†ã€‚ ä¸‰é¢åˆè¿‡äº†å·®ä¸å¤šä¸€å‘¨çš„æ—¶é—´æ¥åˆ°äº†ä¸‰é¢çš„ç”µè¯ï¼Œä¸€èˆ¬åˆ°äº†ä¸‰é¢ä¼šæ˜¯æŠ€æœ¯ Leader ä¹‹ç±»çš„è§’è‰²ã€‚ è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸ä¼šè¿‡å¤šå¼ºè°ƒæŠ€æœ¯ç»†èŠ‚ï¼Œæ›´å¤šçš„è€ƒå¯Ÿè½¯ä»¶èƒ½ï¼Œæ¯”å¦‚å›¢é˜Ÿåä½œã€å­¦ä¹ èƒ½åŠ›ç­‰ã€‚ ä½†æˆ‘è®°å¾—ä¹Ÿé—®äº†ä»¥ä¸‹ä¸€äº›æŠ€æœ¯é—®é¢˜ï¼š è°ˆè°ˆä½ æ‰€ç†è§£çš„ HTTP åè®®ï¼Ÿ å¯¹ TCP çš„ç†è§£ï¼Ÿä¸‰æ¬¡æ¡æ‰‹ï¼Ÿæ»‘åŠ¨çª—å£ï¼Ÿ åŸºæœ¬ç®—æ³•ï¼ŒBase64 ç­‰ã€‚ Java å†…å­˜æ¨¡å‹ï¼ŒHappen Before çš„ç†è§£ã€‚ ä¸€å‘¨ä¹‹åæˆ‘æ¥åˆ°äº† HR åŠ©ç†çš„ç”µè¯çº¦äº†å’Œ HRBP ä»¥åŠäº§å“æŠ€æœ¯è´Ÿè´£äººçš„è§†é¢‘é¢è¯•ã€‚ ä½†æ˜¯æˆ‘å´æ²¡æœ‰é¢ä¸‹å»ï¼Œå…·ä½“åŸå› å¾—å¾€ä¸‹çœ‹ã€‚ B éƒ¨é—¨åœ¨ A éƒ¨é—¨ä¸‰é¢å®Œæˆåï¼Œæˆ‘ç­‰äº†å·®ä¸å¤šä¸€æ˜ŸæœŸï¼Œè¿™æœŸé—´æˆ‘å´æ”¶åˆ°äº†ä¸€å°é‚®ä»¶ã€‚ å¤§æ¦‚å†…å®¹æ˜¯ä»–åœ¨ GitHub ä¸Šçœ‹åˆ°çš„æˆ‘ï¼Œä»–ä»¬çš„æŠ€æœ¯æ€»ç›‘å¯¹æˆ‘å¾ˆæ„Ÿå…´è¶£ï¼ˆæˆ‘éƒ½ä¸æ•¢ç›¸ä¿¡æˆ‘çš„çœ¼é•œï¼‰ï¼Œé—®æˆ‘æƒ³ä¸æƒ³æ¥é˜¿é‡Œè¯•è¯•ã€‚ æˆ‘å¯¹æ¯”äº† A B éƒ¨é—¨çš„åŒºåˆ«å‘ç° B éƒ¨é—¨åœ¨åšçš„äº‹æƒ…ä¸Šç¡®å®æ›´åŠ æœ‰è¯±æƒ‘åŠ›ï¼Œä¹‹åæˆ‘è¡¨è¾¾äº†æœ‰ä¸€ä¸ªé¢è¯•æ­£åœ¨æµç¨‹ä¸­çš„é¡¾è™‘ï¼›å¯¹æ–¹è¡¨ç¤ºå¯ä»¥ç§ä¸‹å’Œæˆ‘å¿«é€Ÿçš„è¿›è¡Œä¸‰é¢ï¼Œå¦‚æœä¸€åˆ‡æ²¡é—®é¢˜å†äº¤ç”±æˆ‘è‡ªè¡Œé€‰æ‹©ã€‚è‡³å°‘å¯¹åŒæ–¹éƒ½æ˜¯ä¸€ä¸ªåŒèµ¢å˜›ã€‚ æˆ‘æƒ³ä¹Ÿä¸äºï¼Œå¹¶ä¸”å¯¹æ–¹å¾ˆæœ‰è¯šæ„ï¼Œå°±ç­”åº”è¯•è¯•ï¼›äºæ˜¯ä¾¿æœ‰äº†ä¸‹é¢çš„é¢è¯•ï¼š ä¸€é¢é¢è¯•å®˜ï¼š å¯¹ Java é”çš„ç†è§£ï¼Ÿ åšä¸»ï¼š æˆ‘è°ˆåˆ°äº† synchronizeï¼ŒLock æ¥å£çš„åº”ç”¨ã€‚ é¢è¯•å®˜ï¼š ä»–ä»¬ä¸¤è€…çš„åŒºåˆ«ä»¥åŠä¼˜ç¼ºç‚¹å‘¢ï¼Ÿ åšä¸»ï¼š synchronize åœ¨ JDK1.6 ä¹‹å‰ç§°ä¸ºé‡é‡é”ï¼Œæ˜¯é€šè¿‡è¿›å‡ºå¯¹è±¡ç›‘è§†å™¨æ¥å®ç°åŒæ­¥çš„ï¼›1.6 ä¹‹ååšäº† XX ä¼˜åŒ–ã€‚ã€‚ã€‚ è€Œ ReentrantLock æ˜¯åˆ©ç”¨äº†ä¸€ä¸ªå·§å¦™æ•°æ®ç»“æ„å®ç°çš„ï¼Œå¹¶ä¸”åŠ é”è§£é”æ˜¯æ˜¾å¼çš„ã€‚ã€‚ã€‚ ä¹‹ååˆå¼•ç”³åˆ°åˆ†å¸ƒå¼é”ï¼Œå…‰è¿™å—å°±èŠäº†å·®ä¸å¤šåŠä¸ªå°æ—¶ã€‚ ä¹‹ååˆèŠåˆ°äº†æˆ‘çš„å¼€æºé¡¹ç›®ï¼š æ˜¯å¦‚ä½•æƒ³åšè¿™ä¸ªé¡¹ç›®çš„ï¼Ÿ å·²ç»æœ‰ä¸€äº›å…³æ³¨äº†åç»­æ˜¯å¦‚ä½•è§„åˆ’çš„ï¼Ÿ ä½ ä»Šåçš„å­¦ä¹ è®¡åˆ’æ˜¯ä»€ä¹ˆï¼Ÿ å¹³æ—¶çœ‹å“ªäº›ä¹¦ï¼Ÿ ä¹‹åæŠ€æœ¯èŠçš„ä¸æ˜¯å¾ˆå¤šï¼Œä½†å¯¹äºä¸ªäººå‘å±•å´èŠäº†ä¸å°‘ã€‚ å…³äºé”ç›¸å…³çš„å†…å®¹å¯ä»¥å‚è€ƒè¿™é‡Œï¼šReentrantLock å®ç°åŸç† synchronize å…³é”®å­—åŸç† äºŒé¢éš”äº†å·®ä¸å¤šä¸€å¤©çš„æ—¶é—´ï¼ŒäºŒé¢å¾ˆå¿«å°±æ¥äº†ã€‚ å†…å®¹ä¸æ˜¯å¾ˆå¤šï¼š çº¿ç¨‹é—´é€šä¿¡çš„å¤šç§æ–¹å¼ï¼Ÿ é™æµç®—æ³•ï¼Ÿå•æœºé™æµï¼Ÿåˆ†å¸ƒå¼é™æµï¼Ÿ æåˆ°äº† Guava Cache ,äº†è§£å®ƒçš„å®ç°åŸç†å˜›ï¼Ÿ å¦‚ä½•å®šä½ä¸€ä¸ªçº¿ä¸Šé—®é¢˜ï¼Ÿ CPU é«˜è´Ÿè½½ï¼ŸOOM æ’æŸ¥ç­‰ï¼Ÿ èŠå®Œä¹‹åè¡¨ç¤ºç¬¬äºŒå¤©åº”è¯¥ä¼šæœ‰ä¸‰é¢ã€‚ ä¸‰é¢ä¸‰é¢çš„é¢è¯•å®˜åº”è¯¥æ˜¯ä¹‹å‰é‚®ä»¶ä¸­æåˆ°çš„é‚£ä½æ€»ç›‘å¤§ä½¬ï¼Œä»¥å‰åº”è¯¥ä¹Ÿæ˜¯ä¸€çº¿çš„æŠ€æœ¯å¤§ç‰›ï¼›èŠçš„é—®é¢˜ä¸æ˜¯å¾ˆå¤šï¼š è°ˆè°ˆå¯¹ Netty çš„ç†è§£ï¼Ÿ Netty çš„çº¿ç¨‹æ¨¡å‹ï¼Ÿ å†™ä¸€ä¸ª LRU ç¼“å­˜ã€‚ ç¬”è¯•æœ¬ä»¥ä¸ºæŠ€æœ¯é¢è¯•å®Œäº†ï¼Œç»“æœåé¢å‘ŠçŸ¥æ‰€æœ‰çš„é¢è¯•æµç¨‹éƒ½å¾—æœ‰ç¬”è¯•äº†ï¼Œäºæ˜¯åˆå‚ä¸äº†ä¸€æ¬¡ç¬”è¯•ï¼š äº¤æ›¿æ‰“å°å¥‡å¶æ•° è¿™ä¸ªç›¸å¯¹æ¯”è¾ƒç®€å•ï¼ŒåŸºäºé”ã€ç­‰å¾…å”¤é†’æœºåˆ¶éƒ½æ˜¯å¯ä»¥çš„ã€‚æœ€åä¹Ÿå‘ŠçŸ¥ç¬”è¯•é€šè¿‡ã€‚ ä¹‹ååœ¨æ¨èæˆ‘çš„é‚£ä½å¤§ä½¬çš„å¸®åŠ©ä¸‹æˆå‰§èˆ¬çš„é€šè¿‡äº†æ•´ä¸ªæŠ€æœ¯è½®ï¼ˆçœŸçš„å¾ˆæ„Ÿè°¢ä»–çš„è®¤å¯ï¼‰ï¼Œå¹¶ä¸”å¾—çŸ¥è¿™ä¸ªæ¶ˆæ¯æ˜¯åœ¨æˆ‘åˆšå¥½å’Œ A éƒ¨é—¨çº¦å¥½è§†é¢‘é¢è¯•æ—¶é—´ä¹‹åã€‚ ä¹Ÿå°±æ„å‘³ç€æˆ‘å¿…é¡»æ‹’æ‰ä¸€ä¸ªéƒ¨é—¨ï¼ æ²¡çœ‹é”™ï¼Œæ˜¯æˆ‘è¦æ‹’æ‰ä¸€ä¸ªã€‚è¿™å¯¹æˆ‘æ¥è¯´ç¡®å®å¤ªéš¾äº†ï¼Œæˆ‘å‹æ ¹æ²¡æƒ³è¿‡è¿˜æœ‰ä¸¤ä¸ªæœºä¼šæ‘†åœ¨æˆ‘é¢å‰ã€‚ æœ€åå‡­ç€ä¸ªäººçš„çˆ±å¥½ä»¥åŠ B éƒ¨é—¨çš„çƒ­æƒ…æˆ‘å¾ˆä¸å¥½æ„æ€çš„æ‹’æ‰äº† A éƒ¨é—¨ã€‚ã€‚ã€‚ HR é¢åœ¨é¢è¿™ä¹‹å‰æˆ‘ä»æ¥æ²¡æœ‰é¢è¿‡è¿™æ ·å¤§å‚çš„ HR æµç¨‹ï¼Œäºæ˜¯ç–¯ç‹‚æœç´¢ï¼Œå¸Œæœ›èƒ½å¼¥è¡¥ç‚¹ç»éªŒã€‚ ä¹Ÿè®¸è¿™å°±æ˜¯ä¹æç”Ÿæ‚²å§ï¼Œæˆ‘ç¡®å®çŒœä¸­äº† HR é—®çš„å¤§éƒ¨åˆ†é—®é¢˜ï¼Œä½†é—æ†¾çš„æ˜¯æœ€ç»ˆä¾ç„¶æ²¡èƒ½é€šè¿‡ã€‚ åæ¥æˆ‘åœ¨æƒ³å¦‚æœæˆ‘æ²¡æœ‰æ‹’æ‰ A ï¼Œä¼šä¸ä¼šç»“å±€ä¸ä¸€æ ·äº†ï¼Ÿ ä½†ç°å®å°±æ˜¯å¦‚æ­¤ï¼Œæ²¡æœ‰é‚£ä¹ˆå¤šå‡è®¾ï¼Œå¹¶ä¸”æ¯ä¸ªäººä¹Ÿå¾—ä¸ºè‡ªå·±çš„é€‰æ‹©è´Ÿè´£ï¼ å¤§æ¦‚çš„é—®é¢˜æ˜¯ï¼š ä¸ºä»€ä¹ˆæƒ³æ¥é˜¿é‡Œï¼Ÿ ä¸ªäººåšçš„æœ€æˆåŠŸæœ€æœ‰æŒ‘æˆ˜çš„äº‹æƒ…æ˜¯ä»€ä¹ˆï¼Ÿ å·¥ä½œä¸­æœ€éš¾å¿˜çš„ç»å†ï¼Ÿ å¯¹åŠ å…¥æˆ‘ä»¬å›¢é˜Ÿæœ‰ä½•æœŸå¾…ï¼Ÿ C éƒ¨é—¨HR è¿™å…³è¢« Pass ä¹‹åæ²¡å¤šä¹…æˆ‘å±…ç„¶åˆæ”¶åˆ°äº†ç¬¬ä¸‰ä¸ªéƒ¨é—¨çš„é‚€çº¦ã€‚ è¯´å®è¯å½“æ—¶æˆ‘æ˜¯æ‹’ç»çš„ï¼Œä¹‹å‰ç»å†äº†å°†è¿‘ä¸¤ä¸ªæœˆçš„æ—¶é—´å´æ²¡èƒ½å¦‚æ„¿æˆ‘å†…å¿ƒæ˜¯å´©æºƒçš„ã€‚ æˆ‘å‘è”ç³»æˆ‘çš„å¤§ä½¬è¡¨è¾¾äº†æˆ‘çš„æƒ³æ³•ï¼Œä»–å€’è§‰å¾—æˆ‘æœ€åè¢« pass çš„åŸå› æ˜¯ä¸ªå°é—®é¢˜ï¼Œå†å°è¯•çš„è¯ä¼šæœ‰å¾ˆå¤§çš„å‡ ç‡é€šè¿‡ã€‚ æˆ‘æŠŠè¿™äº‹ç»™æœ‹å‹è¯´äº†ä¹‹åä¹Ÿæ”¯æŒæˆ‘å†è¯•è¯•ï¼Œåæ­£ä¹Ÿæ²¡å•¥æŸå¤±å˜›ï¼Œè€Œä¸”é¢è¯•çš„çŠ¶æ€è¿˜åœ¨ã€‚ æ‰€ä»¥æˆ‘åˆè¢«æ‰“äº†é¸¡è¡€ï¼Œæ‰æœ‰äº†ä¸‹é¢çš„é¢è¯•ç»è¿‡ï¼š ä¸€é¢é¢è¯•å®˜ï¼š æœåŠ¡åŒ–æ¡†æ¶çš„é€‰å‹å’Œå·®å¼‚ï¼Ÿ åšä¸»ï¼š ä¸€èµ·æ¢è®¨äº† SpringCloudã€Dubboã€Thrift çš„å·®å¼‚ï¼Œä¼˜ç¼ºç‚¹ç­‰ã€‚ é¢è¯•å®˜ï¼š ä¸€è‡´æ€§ Hash ç®—æ³•çš„åŸç†ï¼Ÿ åšä¸»ï¼š å°†æ•°æ® Hash ä¹‹åè½åˆ°ä¸€ä¸ª 0 ~ 2^32-1 æ„æˆçš„ä¸€ä¸ªç¯ä¸Šã€‚ã€‚ã€‚ã€‚ é¢è¯•å®˜ï¼š è°ˆè°ˆä½ ç†è§£çš„ Zookeeperï¼Ÿ åšä¸»ï¼š ä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼åè°ƒå™¨ã€‚ã€‚ã€‚ é¢è¯•å®˜ï¼š å¦‚ä½•å¤„ç† MQ é‡å¤æ¶ˆè´¹ï¼Ÿ åšä¸»ï¼š ä¸šåŠ¡å¹‚ç­‰å¤„ç†ã€‚ã€‚ã€‚ã€‚ é¢è¯•å®˜ï¼š å®¢æˆ·ç«¯è´Ÿè½½ç®—æ³•ï¼Ÿ åšä¸»ï¼š è½®è¯¢ã€éšæœºã€ä¸€è‡´æ€§ Hashã€æ•…éšœè½¬ç§»ã€LRU ç­‰ã€‚ã€‚ é¢è¯•å®˜ï¼š long ç±»å‹çš„èµ‹å€¼æ˜¯å¦æ˜¯åŸå­çš„ï¼Ÿ åšä¸»ï¼š ä¸æ˜¯ã€‚ã€‚ã€‚ é¢è¯•å®˜ï¼š volatile å…³é”®å­—çš„åŸç†åŠä½œç”¨ï¼Ÿhappen Beforeï¼Ÿ åšä¸»ï¼š å¯è§æ€§ã€ä¸€è‡´æ€§ã€‚ã€‚ äºŒé¢ä¸€é¢ä¹‹åå¤§æ¦‚ä¸€å‘¨çš„æ—¶é—´æ¥åˆ°äº†äºŒé¢çš„ç”µè¯ï¼š åŸä»¥ä¸ºä¼šåƒä¹‹å‰ä¸€æ ·ç›´æ¥è¿›å…¥ç¬”è¯•ï¼Œè¿™æ¬¡ä¸Šæ¥å…ˆç®€å•èŠäº†ä¸‹ï¼š è°ˆè°ˆå¯¹å¾®æœåŠ¡çš„ç†è§£ï¼Œå¥½å¤„ä»¥åŠå¼Šç«¯ï¼Ÿ åˆ†å¸ƒå¼ç¼“å­˜çš„è®¾è®¡ï¼Ÿçƒ­ç‚¹ç¼“å­˜ï¼Ÿ ä¹‹åæ‰æ­£å¼è¿›å…¥ç¬”è¯•æµç¨‹ï¼š è¿™æ¬¡ä¸»è¦è€ƒå¯Ÿè®¾è®¡èƒ½åŠ›ï¼Œå…¶å®å°±æ˜¯å¯¹è®¾è®¡æ¨¡å¼çš„ç†è§£ï¼Ÿèƒ½å¦åº”å¯¹åç»­çš„æ‰©å±•æ€§ã€‚ ç¬”è¯•å®Œäº†ä¹‹åä¹Ÿå’Œé¢è¯•å®˜äº¤æµï¼ŒåŸä»¥ä¸ºä¼šæ˜¯ç®—æ³•ä¹‹ç±»çš„æµ‹è¯•ï¼Œåæ¥å¾—çŸ¥ä»–èƒ½çœ‹åˆ°å‰å‡ è½®çš„ç¬”è¯•æƒ…å†µï¼Œç‰¹åœ°æŒ‘çš„æ²¡æœ‰åšè¿‡çš„æ–¹å‘ã€‚ æ‰€ä»¥å¤§å®¶ä¹Ÿä¸ç”¨åˆ»æ„å»æŠ¼é¢˜ï¼Œæ€»æœ‰ä½ æƒ³ä¸åˆ°çš„ï¼Œå¹³æ—¶å¤šç§¯ç´¯æ‰æ˜¯ç¡¬é“ç†ã€‚ ä¸‰é¢åˆè¿‡äº†ä¸¤å‘¨å·¦å³ï¼Œå¾—åˆ° HR é€šçŸ¥ï¼›å¸Œæœ›èƒ½è¿‡å»æ­å·å‚åŠ ç°åœºé¢è¯•ã€‚å¹¶ä¸”é˜¿é‡ŒåŒ…äº†æ¥å›çš„æœºç¥¨é…’åº—ç­‰ã€‚ å¯è§é˜¿é‡Œå¯¹äººæ‰æ¸´æœ›è¿˜æ˜¯èˆå¾—ä¸‹æˆæœ¬çš„ã€‚ æ—¢ç„¶éƒ½è¿™æ ·äº†ï¼Œå°±å½“æˆä¸€æ¬¡æ—…æ¸¸æ‰€ä»¥å»äº†ä¸€è¶Ÿæ­å·ã€‚ ç°åœºé¢çš„æ—¶å€™æœ‰åˆ«äºå…¶ä»–é¢è¯•ï¼Œæ˜¯ç”±ä¸¤ä¸ªé¢è¯•å®˜åŒæ—¶å‚ä¸ï¼š ç»™ä¸€ä¸ªåœºæ™¯ï¼Œè°ˆè°ˆä½ çš„æ¶æ„æ–¹å¼ã€‚ è¿™å°±å¯¹å¹³æ—¶çš„ç§¯ç´¯è¦æ±‚è¾ƒé«˜äº†ã€‚ è¿˜æœ‰ä¸€ä¸ªå°è±¡è¾ƒæ·±çš„æ˜¯ï¼š åœ¨ç½‘é¡µä¸Šç‚¹å‡»ä¸€ä¸ªæŒ‰é’®åˆ°æœåŠ¡å™¨çš„æ•´ä¸ªæµç¨‹ï¼Œå°½é‡å®Œæ•´ã€‚ å…¶å®ä¹‹å‰çœ‹è¿‡ï¼Œå¥½åƒæ˜¯ Google çš„ä¸€ä¸ªé¢è¯•é¢˜ã€‚ å®Œäº†ä¹‹åè®©æˆ‘å›å»ç­‰é€šçŸ¥ï¼Œæ²¡æœ‰è§åˆ° HR æˆ‘å°±çŸ¥é“å‡‰äº†ï¼Œæœä¸å…¶ç„¶ã€‚ æ€»ç»“çœ‹åˆ°è¿™é‡Œçš„æœ‹å‹åº”è¯¥éƒ½æ˜¯è€é“äº†ï¼Œæˆ‘ä¹ŸæŠŠä¸Šæ–‡æåˆ°çš„å¤§å¤šæ•°é¢è¯•é¢˜æ•´ç†åœ¨äº† GitHubï¼š å‚åº“åœ°å€ï¼š https://github.com/crossoverJie/Java-Interview æœ€åæ€»ç»“ä¸‹è¿™å°†è¿‘å››ä¸ªæœˆçš„é¢è¯•å¿ƒå¾—ï¼š ä¸€å®šè¦ç§¯æçš„æ¨é”€è‡ªå·±ï¼Œåƒåœ¨ A éƒ¨é—¨çš„ä¸‰é¢æ—¶ï¼Œç”±äºåŸºç¡€ç­”å¾—ä¸æ˜¯å¾ˆå¥½ï¼›æ‰€ä»¥æœ€åæˆ‘è¡¨è¾¾äº†è‡ªå·±çš„æ€åº¦ï¼Œå¯¹å·¥ä½œã€æŠ€æœ¯çš„ç§¯ææ€§ã€‚è®©é¢è¯•å®˜çœ‹åˆ°ä½ çš„æ½œåŠ›å€¼å¾—ä¸€ä¸ª HC åé¢ã€‚ é¢è¯•è¿‡ç¨‹ä¸­é‡åˆ°è‡ªå·±çš„ä¸ä¼šçš„å¯ä»¥ä¸»åŠ¨æå‡ºï¼Œåˆ‡ä¸å¯ä¸æ‡‚è£…æ‡‚ï¼Œè¿™ä¸€é—®å°±éœ²é¦…ã€‚å¯ä»¥å°†é¢è¯•å®˜å¼•å¯¼åˆ°è‡ªå·±æ“…é•¿çš„é¢†åŸŸã€‚æ¯”å¦‚å½“æ—¶æˆ‘æ­£å¥½ç ”ç©¶äº†é”ï¼Œæ‰€ä»¥å’Œé¢è¯•å®˜ä¸€èŠå°±æ˜¯åŠå°æ—¶è¿™å°±æ˜¯åŠ åˆ†é¡¹ã€‚ å¹³æ—¶è¦ä¸»åŠ¨ç§¯ç´¯çŸ¥è¯†ã€‚å†™åšå®¢å’Œå‚ä¸å¼€æºé¡¹ç›®å°±æ˜¯å¾ˆå¥½çš„æ–¹å¼ã€‚ åšå®¢å¯ä»¥è®°å½•è‡ªå·±è¸©è¿‡çš„å‘ï¼ŒåŠ æ·±å°è±¡ï¼Œè€Œä¸”åœ¨å†™çš„è¿‡ç¨‹ä¸­å¯ä»¥æŸ¥æ¼è¡¥ç¼ºï¼Œæœ€åæŠŠæ•´ä¸ªçŸ¥è¯†ä½“ç³»å·©å›ºçš„æ¯”è¾ƒç‰¢å›ºï¼Œè‰¯å¥½çš„å†…å®¹è¿˜å¯ä»¥å¾—åˆ°æ„æƒ³ä¸åˆ°çš„æ”¶è·ï¼Œæ¯”å¦‚æˆ‘ç¬¬ä¸€æ¬¡é¢è¯•çš„æœºä¼šã€‚ GitHub æ˜¯å¼€å‘è€…çš„ä¸€å¼ åç‰‡ï¼Œç§¯æå‚ä¸å¼€æºé¡¹ç›®å¯ä»¥å’Œå…¨çƒå¤§ä½¬å¤´è„‘é£æš´ï¼Œå¹¶ä¸”åœ¨é¢è¯•è¿‡ç¨‹ä¸­ç»å¯¹æ˜¯ä¸€ä¸ªåŠ åˆ†åˆ©å™¨ã€‚ é¢è¯•å®˜ä¸€èˆ¬æœ€åéƒ½ä¼šé—®ä½ æœ‰ä»€ä¹ˆè¦é—®æˆ‘çš„ï¼Ÿåƒä¸‡ä¸è¦é—®ä¸€äº›å…¬å¸ç¦åˆ©å¾…é‡ä¹‹ç±»çš„é—®é¢˜ã€‚å¯ä»¥é—®ä¸‹æœ¬æ¬¡é¢è¯•çš„è¡¨ç°ï¼Ÿè¿˜æœ‰å“ªäº›éœ€è¦å®Œå–„çš„ï¼Ÿä»è€ŒçŸ¥é“è‡ªå·±ç­”å¾—å¦‚ä½•ä¹Ÿèƒ½è¡¥å…¨è‡ªå·±ã€‚ è¿˜æœ‰ä¸€ç‚¹ï¼šä¸è¦åœ¨æŸæ¬¡é¢è¯•å¤±åˆ©åå¦å®šè‡ªå·±ï¼Œæœ‰æ—¶çœŸçš„ä¸æ˜¯è‡ªå·±èƒ½åŠ›ä¸è¡Œã€‚è¿™ä¸ªä¹Ÿè®²ç¼˜åˆ†ã€‚ å¡ç¿å¤±é©¬ç„‰çŸ¥éç¦ æˆ‘å°±æ˜¯ä¸ªä¾‹å­ï¼Œè™½ç„¶æœ€åæ²¡èƒ½å»æˆé˜¿é‡Œï¼Œç°åœ¨åœ¨å…¬å¸ä¹Ÿæ˜¯ä¸€ä¸ªéƒ¨é—¨çš„æŠ€æœ¯è´Ÿè´£äººï¼Œåœ¨æˆ‘ä»¬åŸå¸‚è¿˜æœ‰ä¸ªçªï¼Œæ¸©é¦¨çš„å®¶ï¼Œå’Œå¥³æœ‹å‹ä¸€èµ·ä¸ºæƒ³è¦çš„ç”Ÿæ´»åŠªåŠ›å¥‹æ–—ã€‚ æ¬¢è¿å…³æ³¨ä½œè€…å…¬ä¼—å·äºæˆ‘äº¤æµğŸ¤—ã€‚]]></content>
      <categories>
        <category>Interview</category>
        <category>Person</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Guava æºç åˆ†æï¼ˆCache åŸç†ï¼‰]]></title>
    <url>%2F2018%2F06%2F13%2Fguava%2Fguava-cache%2F</url>
    <content type="text"><![CDATA[å‰è¨€Google å‡ºçš„ Guava æ˜¯ Java æ ¸å¿ƒå¢å¼ºçš„åº“ï¼Œåº”ç”¨éå¸¸å¹¿æ³›ã€‚ æˆ‘å¹³æ—¶ç”¨çš„ä¹ŸæŒºé¢‘ç¹ï¼Œè¿™æ¬¡å°±å€ŸåŠ©æ—¥å¸¸ä½¿ç”¨çš„ Cache ç»„ä»¶æ¥çœ‹çœ‹ Google å¤§ç‰›ä»¬æ˜¯å¦‚ä½•è®¾è®¡çš„ã€‚ ç¼“å­˜ æœ¬æ¬¡ä¸»è¦è®¨è®ºç¼“å­˜ã€‚ ç¼“å­˜åœ¨æ—¥å¸¸å¼€å‘ä¸­ä¸¾è¶³è½»é‡ï¼Œå¦‚æœä½ çš„åº”ç”¨å¯¹æŸç±»æ•°æ®æœ‰ç€è¾ƒé«˜çš„è¯»å–é¢‘æ¬¡ï¼Œå¹¶ä¸”æ”¹åŠ¨è¾ƒå°æ—¶é‚£å°±éå¸¸é€‚åˆåˆ©ç”¨ç¼“å­˜æ¥æé«˜æ€§èƒ½ã€‚ ç¼“å­˜ä¹‹æ‰€ä»¥å¯ä»¥æé«˜æ€§èƒ½æ˜¯å› ä¸ºå®ƒçš„è¯»å–æ•ˆç‡å¾ˆé«˜ï¼Œå°±åƒæ˜¯ CPU çš„ L1ã€L2ã€L3 ç¼“å­˜ä¸€æ ·ï¼Œçº§åˆ«è¶Šé«˜ç›¸åº”çš„è¯»å–é€Ÿåº¦ä¹Ÿä¼šè¶Šå¿«ã€‚ ä½†ä¹Ÿä¸æ˜¯ä»€ä¹ˆå¥½å¤„éƒ½å ï¼Œè¯»å–é€Ÿåº¦å¿«äº†ä½†æ˜¯å®ƒçš„å†…å­˜æ›´å°èµ„æºæ›´å®è´µï¼Œæ‰€ä»¥æˆ‘ä»¬åº”å½“ç¼“å­˜çœŸæ­£éœ€è¦çš„æ•°æ®ã€‚ å…¶å®ä¹Ÿå°±æ˜¯å…¸å‹çš„ç©ºé—´æ¢æ—¶é—´ã€‚ ä¸‹é¢è°ˆè°ˆ Java ä¸­æ‰€ç”¨åˆ°çš„ç¼“å­˜ã€‚ JVM ç¼“å­˜é¦–å…ˆæ˜¯ JVM ç¼“å­˜ï¼Œä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯å †ç¼“å­˜ã€‚ å…¶å®å°±æ˜¯åˆ›å»ºä¸€äº›å…¨å±€å˜é‡ï¼Œå¦‚ Mapã€List ä¹‹ç±»çš„å®¹å™¨ç”¨äºå­˜æ”¾æ•°æ®ã€‚ è¿™æ ·çš„ä¼˜åŠ¿æ˜¯ä½¿ç”¨ç®€å•ä½†æ˜¯ä¹Ÿæœ‰ä»¥ä¸‹é—®é¢˜ï¼š åªèƒ½æ˜¾å¼çš„å†™å…¥ï¼Œæ¸…é™¤æ•°æ®ã€‚ ä¸èƒ½æŒ‰ç…§ä¸€å®šçš„è§„åˆ™æ·˜æ±°æ•°æ®ï¼Œå¦‚ LRUï¼ŒLFUï¼ŒFIFO ç­‰ã€‚ æ¸…é™¤æ•°æ®æ—¶çš„å›è°ƒé€šçŸ¥ã€‚ å…¶ä»–ä¸€äº›å®šåˆ¶åŠŸèƒ½ç­‰ã€‚ Ehcacheã€Guava Cacheæ‰€ä»¥å‡ºç°äº†ä¸€äº›ä¸“é—¨ç”¨ä½œ JVM ç¼“å­˜çš„å¼€æºå·¥å…·å‡ºç°äº†ï¼Œå¦‚æœ¬æ–‡æåˆ°çš„ Guava Cacheã€‚ å®ƒå…·æœ‰ä¸Šæ–‡ JVM ç¼“å­˜ä¸å…·æœ‰çš„åŠŸèƒ½ï¼Œå¦‚è‡ªåŠ¨æ¸…é™¤æ•°æ®ã€å¤šç§æ¸…é™¤ç®—æ³•ã€æ¸…é™¤å›è°ƒç­‰ã€‚ ä½†ä¹Ÿæ­£å› ä¸ºæœ‰äº†è¿™äº›åŠŸèƒ½ï¼Œè¿™æ ·çš„ç¼“å­˜å¿…ç„¶ä¼šå¤šå‡ºè®¸å¤šä¸œè¥¿éœ€è¦é¢å¤–ç»´æŠ¤ï¼Œè‡ªç„¶ä¹Ÿå°±å¢åŠ äº†ç³»ç»Ÿçš„æ¶ˆè€—ã€‚ åˆ†å¸ƒå¼ç¼“å­˜åˆšæ‰æåˆ°çš„ä¸¤ç§ç¼“å­˜å…¶å®éƒ½æ˜¯å †å†…ç¼“å­˜ï¼Œåªèƒ½åœ¨å•ä¸ªèŠ‚ç‚¹ä¸­ä½¿ç”¨ï¼Œè¿™æ ·åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹å°±æ‹›æ¶ä¸ä½äº†ã€‚ äºæ˜¯ä¹Ÿæœ‰äº†ä¸€äº›ç¼“å­˜ä¸­é—´ä»¶ï¼Œå¦‚ Redisã€Memcachedï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å¯ä»¥å…±äº«å†…å­˜ã€‚ å…·ä½“ä¸åœ¨æœ¬æ¬¡çš„è®¨è®ºèŒƒå›´ã€‚ Guava Cache ç¤ºä¾‹ä¹‹æ‰€ä»¥æƒ³åˆ° Guava çš„ Cacheï¼Œä¹Ÿæ˜¯æœ€è¿‘åœ¨åšä¸€ä¸ªéœ€æ±‚ï¼Œå¤§ä½“å¦‚ä¸‹ï¼š ä» Kafka å®æ—¶è¯»å–å‡ºåº”ç”¨ç³»ç»Ÿçš„æ—¥å¿—ä¿¡æ¯ï¼Œè¯¥æ—¥å¿—ä¿¡æ¯åŒ…å«äº†åº”ç”¨çš„å¥åº·çŠ¶å†µã€‚å¦‚æœåœ¨æ—¶é—´çª—å£ N å†…å‘ç”Ÿäº† X æ¬¡å¼‚å¸¸ä¿¡æ¯ï¼Œç›¸åº”çš„æˆ‘å°±éœ€è¦ä½œå‡ºåé¦ˆï¼ˆæŠ¥è­¦ã€è®°å½•æ—¥å¿—ç­‰ï¼‰ã€‚ å¯¹æ­¤ Guava çš„ Cache å°±éå¸¸é€‚åˆï¼Œæˆ‘åˆ©ç”¨äº†å®ƒçš„ N ä¸ªæ—¶é—´å†…ä¸å†™å…¥æ•°æ®æ—¶ç¼“å­˜å°±æ¸…ç©ºçš„ç‰¹ç‚¹ï¼Œåœ¨æ¯æ¬¡è¯»å–æ•°æ®æ—¶åˆ¤æ–­å¼‚å¸¸ä¿¡æ¯æ˜¯å¦å¤§äº X å³å¯ã€‚ ä¼ªä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132@Value("$&#123;alert.in.time:2&#125;")private int time ;@Beanpublic LoadingCache buildCache()&#123; return CacheBuilder.newBuilder() .expireAfterWrite(time, TimeUnit.MINUTES) .build(new CacheLoader&lt;Long, AtomicLong&gt;() &#123; @Override public AtomicLong load(Long key) throws Exception &#123; return new AtomicLong(0); &#125; &#125;);&#125;/** * åˆ¤æ–­æ˜¯å¦éœ€è¦æŠ¥è­¦ */public void checkAlert() &#123; try &#123; if (counter.get(KEY).incrementAndGet() &gt;= limit) &#123; LOGGER.info("***********æŠ¥è­¦***********"); //å°†ç¼“å­˜æ¸…ç©º counter.get(KEY).getAndSet(0L); &#125; &#125; catch (ExecutionException e) &#123; LOGGER.error("Exception", e); &#125;&#125; é¦–å…ˆæ˜¯æ„å»ºäº† LoadingCache å¯¹è±¡ï¼Œåœ¨ N åˆ†é’Ÿå†…ä¸å†™å…¥æ•°æ®æ—¶å°±å›æ”¶ç¼“å­˜ï¼ˆå½“é€šè¿‡ Key è·å–ä¸åˆ°ç¼“å­˜æ—¶ï¼Œé»˜è®¤è¿”å› 0ï¼‰ã€‚ ç„¶ååœ¨æ¯æ¬¡æ¶ˆè´¹æ—¶å€™è°ƒç”¨ checkAlert() æ–¹æ³•è¿›è¡Œæ ¡éªŒï¼Œè¿™æ ·å°±å¯ä»¥è¾¾åˆ°ä¸Šæ–‡çš„éœ€æ±‚ã€‚ æˆ‘ä»¬æ¥è®¾æƒ³ä¸‹ Guava å®ƒæ˜¯å¦‚ä½•å®ç°è¿‡æœŸè‡ªåŠ¨æ¸…é™¤æ•°æ®ï¼Œå¹¶ä¸”æ˜¯å¯ä»¥æŒ‰ç…§ LRU è¿™æ ·çš„æ–¹å¼æ¸…é™¤çš„ã€‚ å¤§èƒ†å‡è®¾ä¸‹ï¼š å†…éƒ¨é€šè¿‡ä¸€ä¸ªé˜Ÿåˆ—æ¥ç»´æŠ¤ç¼“å­˜çš„é¡ºåºï¼Œæ¯æ¬¡è®¿é—®è¿‡çš„æ•°æ®ç§»åŠ¨åˆ°é˜Ÿåˆ—å¤´éƒ¨ï¼Œå¹¶ä¸”é¢å¤–å¼€å¯ä¸€ä¸ªçº¿ç¨‹æ¥åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸå°±åˆ æ‰ã€‚æœ‰ç‚¹ç±»ä¼¼äºæˆ‘ä¹‹å‰å†™è¿‡çš„ åŠ¨æ‰‹å®ç°ä¸€ä¸ª LRU cache èƒ¡é€‚è¯´è¿‡ï¼šå¤§èƒ†å‡è®¾å°å¿ƒè®ºè¯ ä¸‹é¢æ¥çœ‹çœ‹ Guava åˆ°åº•æ˜¯æ€ä¹ˆå®ç°ã€‚ åŸç†åˆ†æçœ‹åŸç†æœ€å¥½ä¸è¿‡æ˜¯è·Ÿä»£ç ä¸€æ­¥æ­¥èµ°äº†ï¼š ç¤ºä¾‹ä»£ç åœ¨è¿™é‡Œï¼š https://github.com/crossoverJie/Java-Interview/blob/master/src/main/java/com/crossoverjie/guava/CacheLoaderTest.java ä¸ºäº†èƒ½çœ‹å‡º Guava æ˜¯æ€ä¹ˆåˆ é™¤è¿‡æœŸæ•°æ®çš„åœ¨è·å–ç¼“å­˜ä¹‹å‰ä¼‘çœ äº† 5 ç§’é’Ÿï¼Œè¾¾åˆ°äº†è¶…æ—¶æ¡ä»¶ã€‚ æœ€ç»ˆä¼šå‘ç°åœ¨ com.google.common.cache.LocalCache ç±»çš„ 2187 è¡Œæ¯”è¾ƒå…³é”®ã€‚ å†è·Ÿè¿›å»ä¹‹å‰ç¬¬ 2182 è¡Œä¼šå‘ç°å…ˆè¦åˆ¤æ–­ count æ˜¯å¦å¤§äº 0ï¼Œè¿™ä¸ª count ä¿å­˜çš„æ˜¯å½“å‰ç¼“å­˜çš„æ•°é‡ï¼Œå¹¶ç”¨ volatile ä¿®é¥°ä¿è¯äº†å¯è§æ€§ã€‚ æ›´å¤šå…³äº volatile çš„ç›¸å…³ä¿¡æ¯å¯ä»¥æŸ¥çœ‹ ä½ åº”è¯¥çŸ¥é“çš„ volatile å…³é”®å­— æ¥ç€å¾€ä¸‹è·Ÿåˆ°ï¼š 2761 è¡Œï¼Œæ ¹æ®æ–¹æ³•åç§°å¯ä»¥çœ‹å‡ºæ˜¯åˆ¤æ–­å½“å‰çš„ Entry æ˜¯å¦è¿‡æœŸï¼Œè¯¥ entry å°±æ˜¯é€šè¿‡ key æŸ¥è¯¢åˆ°çš„ã€‚ è¿™é‡Œå°±å¾ˆæ˜æ˜¾çš„çœ‹å‡ºæ˜¯æ ¹æ®æ ¹æ®æ„å»ºæ—¶æŒ‡å®šçš„è¿‡æœŸæ–¹å¼æ¥åˆ¤æ–­å½“å‰ key æ˜¯å¦è¿‡æœŸäº†ã€‚ å¦‚æœè¿‡æœŸå°±å¾€ä¸‹èµ°ï¼Œå°è¯•è¿›è¡Œè¿‡æœŸåˆ é™¤ï¼ˆéœ€è¦åŠ é”ï¼Œåé¢ä¼šå…·ä½“è®¨è®ºï¼‰ã€‚ åˆ°äº†è¿™é‡Œä¹Ÿå¾ˆæ¸…æ™°äº†ï¼š è·å–å½“å‰ç¼“å­˜çš„æ€»æ•°é‡ è‡ªå‡ä¸€ï¼ˆå‰é¢è·å–äº†é”ï¼Œæ‰€ä»¥çº¿ç¨‹å®‰å…¨ï¼‰ åˆ é™¤å¹¶å°†æ›´æ–°çš„æ€»æ•°èµ‹å€¼åˆ° countã€‚ å…¶å®å¤§ä½“ä¸Šå°±æ˜¯è¿™ä¸ªæµç¨‹ï¼ŒGuava å¹¶æ²¡æœ‰æŒ‰ç…§ä¹‹å‰çŒœæƒ³çš„å¦èµ·ä¸€ä¸ªçº¿ç¨‹æ¥ç»´æŠ¤è¿‡æœŸæ•°æ®ã€‚ åº”è¯¥æ˜¯ä»¥ä¸‹åŸå› ï¼š æ–°èµ·çº¿ç¨‹éœ€è¦èµ„æºæ¶ˆè€—ã€‚ ç»´æŠ¤è¿‡æœŸæ•°æ®è¿˜è¦è·å–é¢å¤–çš„é”ï¼Œå¢åŠ äº†æ¶ˆè€—ã€‚ è€Œåœ¨æŸ¥è¯¢æ—¶å€™é¡ºå¸¦åšäº†è¿™äº›äº‹æƒ…ï¼Œä½†æ˜¯å¦‚æœè¯¥ç¼“å­˜è¿Ÿè¿Ÿæ²¡æœ‰è®¿é—®ä¹Ÿä¼šå­˜åœ¨æ•°æ®ä¸èƒ½è¢«å›æ”¶çš„æƒ…å†µï¼Œä¸è¿‡è¿™å¯¹äºä¸€ä¸ªé«˜ååçš„åº”ç”¨æ¥è¯´ä¹Ÿä¸æ˜¯é—®é¢˜ã€‚ æ€»ç»“æœ€åå†æ¥æ€»ç»“ä¸‹ Guava çš„ Cacheã€‚ å…¶å®åœ¨ä¸Šæ–‡è·Ÿä»£ç æ—¶ä¼šå‘ç°é€šè¿‡ä¸€ä¸ª key å®šä½æ•°æ®æ—¶æœ‰ä»¥ä¸‹ä»£ç ï¼š å¦‚æœæœ‰çœ‹è¿‡ ConcurrentHashMap çš„åŸç† åº”è¯¥ä¼šæƒ³åˆ°è¿™å…¶å®éå¸¸ç±»ä¼¼ã€‚ å…¶å® Guava Cache ä¸ºäº†æ»¡è¶³å¹¶å‘åœºæ™¯çš„ä½¿ç”¨ï¼Œæ ¸å¿ƒçš„æ•°æ®ç»“æ„å°±æ˜¯æŒ‰ç…§ ConcurrentHashMap æ¥çš„ï¼Œè¿™é‡Œä¹Ÿæ˜¯ä¸€ä¸ª key å®šä½åˆ°ä¸€ä¸ªå…·ä½“ä½ç½®çš„è¿‡ç¨‹ã€‚ å…ˆæ‰¾åˆ° Segmentï¼Œå†æ‰¾å…·ä½“çš„ä½ç½®ï¼Œç­‰äºæ˜¯åšäº†ä¸¤æ¬¡ Hash å®šä½ã€‚ ä¸Šæ–‡æœ‰ä¸€ä¸ªå‡è®¾æ˜¯å¯¹çš„ï¼Œå®ƒå†…éƒ¨ä¼šç»´æŠ¤ä¸¤ä¸ªé˜Ÿåˆ— accessQueue,writeQueue ç”¨äºè®°å½•ç¼“å­˜é¡ºåºï¼Œè¿™æ ·æ‰å¯ä»¥æŒ‰ç…§é¡ºåºæ·˜æ±°æ•°æ®ï¼ˆç±»ä¼¼äºåˆ©ç”¨ LinkedHashMap æ¥åš LRU ç¼“å­˜ï¼‰ã€‚ åŒæ—¶ä»ä¸Šæ–‡çš„æ„å»ºæ–¹å¼æ¥çœ‹ï¼Œå®ƒä¹Ÿæ˜¯æ„å»ºè€…æ¨¡å¼æ¥åˆ›å»ºå¯¹è±¡çš„ã€‚ å› ä¸ºä½œä¸ºä¸€ä¸ªç»™å¼€å‘è€…ä½¿ç”¨çš„å·¥å…·ï¼Œéœ€è¦æœ‰å¾ˆå¤šçš„è‡ªå®šä¹‰å±æ€§ï¼Œåˆ©ç”¨æ„å»ºåˆ™æ¨¡å¼å†åˆé€‚ä¸è¿‡äº†ã€‚ Guava å…¶å®è¿˜æœ‰å¾ˆå¤šä¸œè¥¿æ²¡è°ˆåˆ°ï¼Œæ¯”å¦‚å®ƒåˆ©ç”¨ GC æ¥å›æ”¶å†…å­˜ï¼Œç§»é™¤æ•°æ®æ—¶çš„å›è°ƒé€šçŸ¥ç­‰ã€‚ä¹‹åå†æ¥ç€è®¨è®ºã€‚ æ‰«ç å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼Œç¬¬ä¸€æ—¶é—´è·å–æ¶ˆæ¯ã€‚]]></content>
      <categories>
        <category>Guava</category>
      </categories>
      <tags>
        <tag>Cache</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼å·¥å…·çš„ä¸€æ¬¡å°å‡çº§â«]]></title>
    <url>%2F2018%2F06%2F07%2Fdistributed-lock%2Fdistributed-lock-redis-update%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¹‹å‰åœ¨åš ç§’æ€æ¶æ„å®è·µ æ—¶æœ‰æåˆ°å¯¹ distributed-redis-tool çš„ä¸€æ¬¡å°å‡çº§ï¼Œä½†æ˜¯æ²¡æœ‰ç»†è¯´ã€‚ å…¶å®ä¸»è¦åŸå› æ˜¯ï¼š ç§’æ€æ—¶æˆ‘åšå‹æµ‹ï¼šç”±äºé›†æˆäº†è¿™ä¸ªé™æµç»„ä»¶ï¼Œå¹¶å‘åˆæ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥å¯¼è‡´è¿æ¥ã€æ–­å¼€ Redis éå¸¸é¢‘ç¹ã€‚æœ€ç»ˆå¯¼è‡´è·å–ä¸äº† Redis connection çš„å¼‚å¸¸ã€‚ æ± åŒ–æŠ€æœ¯è¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å¯¹ç¨€ç¼ºèµ„æºä½¿ç”¨ä¸å–„å¯¼è‡´çš„ã€‚ ä½•ä¸ºç¨€ç¼ºèµ„æºï¼Ÿå¸¸è§çš„æœ‰ï¼š çº¿ç¨‹ æ•°æ®åº“è¿æ¥ ç½‘ç»œè¿æ¥ç­‰ è¿™äº›èµ„æºéƒ½æœ‰å…±åŒçš„ç‰¹ç‚¹ï¼šåˆ›å»ºé”€æ¯æˆæœ¬è¾ƒé«˜ã€‚ è¿™é‡Œæ¶‰åŠåˆ°çš„ Redis è¿æ¥ä¹Ÿå±äºè¯¥ç±»èµ„æºã€‚ æˆ‘ä»¬å¸Œæœ›å°†è¿™äº›ç¨€æœ‰èµ„æºç®¡ç†èµ·æ¥æ”¾åˆ°ä¸€ä¸ªæ± å­é‡Œï¼Œå½“éœ€è¦æ—¶å°±ä»ä¸­è·å–ï¼Œç”¨å®Œå°±æ”¾å›å»ï¼Œä¸å¤Ÿç”¨æ—¶å°±ç­‰å¾…ï¼ˆæˆ–è¿”å›ï¼‰ã€‚ è¿™æ ·æˆ‘ä»¬åªéœ€è¦åˆå§‹åŒ–å¹¶ç»´æŠ¤å¥½è¿™ä¸ªæ± å­ï¼Œå°±èƒ½é¿å…é¢‘ç¹çš„åˆ›å»ºã€é”€æ¯è¿™äº›èµ„æºï¼ˆä¹Ÿæœ‰èµ„æºé•¿æœŸæœªä½¿ç”¨éœ€è¦ç¼©å®¹çš„æƒ…å†µï¼‰ã€‚ é€šå¸¸æˆ‘ä»¬ç§°è¿™é¡¹å§¿åŠ¿ä¸ºæ± åŒ–æŠ€æœ¯ï¼Œå¦‚å¸¸è§çš„ï¼š çº¿ç¨‹æ±  å„ç§èµ„æºçš„è¿æ¥æ± ç­‰ã€‚ ä¸ºæ­¤æˆ‘å°†ä½¿ç”¨åˆ° Redis çš„ åˆ†å¸ƒå¼é”ã€åˆ†å¸ƒå¼é™æµ éƒ½å‡çº§ä¸ºåˆ©ç”¨è¿æ¥æ± æ¥è·å– Redis çš„è¿æ¥ã€‚ è¿™é‡Œä»¥åˆ†å¸ƒå¼é”ä¸ºä¾‹ï¼š å°†ä½¿ç”¨çš„ api ä¿®æ”¹ä¸ºï¼š åŸæœ‰ï¼š 123456789101112131415161718@Configurationpublic class RedisLockConfig &#123; @Bean public RedisLock build()&#123; //Need to get Redis connection RedisLock redisLock = new RedisLock() ; HostAndPort hostAndPort = new HostAndPort("127.0.0.1",7000) ; JedisCluster jedisCluster = new JedisCluster(hostAndPort) ; RedisLock redisLock = new RedisLock.Builder(jedisCluster) .lockPrefix("lock_test") .sleepTime(100) .build(); return redisLock ; &#125;&#125; ç°åœ¨ï¼š123456789101112131415161718@Configurationpublic class RedisLockConfig &#123; private Logger logger = LoggerFactory.getLogger(RedisLockConfig.class); @Autowired private JedisConnectionFactory jedisConnectionFactory; @Bean public RedisLock build() &#123; RedisLock redisLock = new RedisLock.Builder(jedisConnectionFactory,RedisToolsConstant.SINGLE) .lockPrefix("lock_") .sleepTime(100) .build(); return redisLock; &#125;&#125; å°†ä»¥å‰çš„ Jedis ä¿®æ”¹ä¸º JedisConnectionFactoryï¼Œåç»­çš„ Redis è¿æ¥å°±å¯é€šè¿‡è¿™ä¸ªå¯¹è±¡è·å–ã€‚ å¹¶ä¸”æ˜¾ç¤ºçš„ä¼ å…¥ä½¿ç”¨ RedisCluster è¿˜æ˜¯å•æœºçš„ Redisã€‚ æ‰€ä»¥åœ¨çœŸæ­£æ“ä½œ Redis æ—¶éœ€è¦ä¿®æ”¹ï¼š 1234567891011121314151617181920212223242526272829303132333435public boolean tryLock(String key, String request) &#123; //get connection Object connection = getConnection(); String result ; if (connection instanceof Jedis)&#123; result = ((Jedis) connection).set(lockPrefix + key, request, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, 10 * TIME); ((Jedis) connection).close(); &#125;else &#123; result = ((JedisCluster) connection).set(lockPrefix + key, request, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, 10 * TIME); try &#123; ((JedisCluster) connection).close(); &#125; catch (IOException e) &#123; logger.error("IOException",e); &#125; &#125; if (LOCK_MSG.equals(result)) &#123; return true; &#125; else &#123; return false; &#125;&#125;//è·å–è¿æ¥private Object getConnection() &#123; Object connection ; if (type == RedisToolsConstant.SINGLE)&#123; RedisConnection redisConnection = jedisConnectionFactory.getConnection(); connection = redisConnection.getNativeConnection(); &#125;else &#123; RedisClusterConnection clusterConnection = jedisConnectionFactory.getClusterConnection(); connection = clusterConnection.getNativeConnection() ; &#125; return connection;&#125; æœ€å¤§çš„æ”¹å˜å°±æ˜¯å°†åŸæœ‰æ“ä½œ Redis çš„å¯¹è±¡ï¼ˆT extends JedisCommandsï¼‰æ”¹ä¸ºä»è¿æ¥æ± ä¸­è·å–ã€‚ ç”±äºä½¿ç”¨äº† org.springframework.data.redis.connection.jedis.JedisConnectionFactory ä½œä¸º Redis è¿æ¥æ± ã€‚ æ‰€ä»¥éœ€è¦å†ä½¿ç”¨æ—¶æ„ä»¶å¥½è¿™ä¸ªå¯¹è±¡ï¼š 1234567891011121314151617181920212223242526272829JedisPoolConfig config = new JedisPoolConfig();config.setMaxIdle(10);config.setMaxTotal(300);config.setMaxWaitMillis(10000);config.setTestOnBorrow(true);config.setTestOnReturn(true);RedisClusterConfiguration redisClusterConfiguration = new RedisClusterConfiguration();redisClusterConfiguration.addClusterNode(new RedisNode("10.19.13.51", 7000));//å•æœºJedisConnectionFactory jedisConnectionFactory = new JedisConnectionFactory(config);//é›†ç¾¤//JedisConnectionFactory jedisConnectionFactory = new JedisConnectionFactory(redisClusterConfiguration) ;jedisConnectionFactory.setHostName("47.98.194.60");jedisConnectionFactory.setPort(6379);jedisConnectionFactory.setPassword("");jedisConnectionFactory.setTimeout(100000);jedisConnectionFactory.afterPropertiesSet();//jedisConnectionFactory.setShardInfo(new JedisShardInfo("47.98.194.60", 6379));//JedisCluster jedisCluster = new JedisCluster(hostAndPort);HostAndPort hostAndPort = new HostAndPort("10.19.13.51", 7000);JedisCluster jedisCluster = new JedisCluster(hostAndPort);redisLock = new RedisLock.Builder(jedisConnectionFactory, RedisToolsConstant.SINGLE) .lockPrefix("lock_") .sleepTime(100) .build(); çœ‹èµ·æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦æ„å»ºå¯¹è±¡çš„è¾ƒå¤šã€‚ ä½†æ•´åˆ Spring ä½¿ç”¨æ—¶å°±è¦æ¸…æ™°è®¸å¤šã€‚ é…åˆ SpringSpring å¾ˆå¤§çš„ä¸€ä¸ªä½œç”¨å°±æ˜¯å¸®æˆ‘ä»¬ç®¡ç†å¯¹è±¡ï¼Œæ‰€ä»¥åƒä¸Šæ–‡é‚£äº›çœ‹ä¼¼å¾ˆå¤æ‚çš„å¯¹è±¡éƒ½å¯ä»¥äº¤ç”±å®ƒæ¥ç®¡ç†ï¼š 12345678910111213141516171819202122232425&lt;!-- jedis é…ç½® --&gt; &lt;bean id="JedispoolConfig" class="redis.clients.jedis.JedisPoolConfig"&gt; &lt;property name="maxIdle" value="$&#123;redis.maxIdle&#125;"/&gt; &lt;property name="maxTotal" value="$&#123;redis.maxTotal&#125;"/&gt; &lt;property name="maxWaitMillis" value="$&#123;redis.maxWait&#125;"/&gt; &lt;property name="testOnBorrow" value="$&#123;redis.testOnBorrow&#125;"/&gt; &lt;property name="testOnReturn" value="$&#123;redis.testOnBorrow&#125;"/&gt; &lt;/bean&gt; &lt;!-- redisæœåŠ¡å™¨ä¸­å¿ƒ --&gt; &lt;bean id="connectionFactory" class="org.springframework.data.redis.connection.jedis.JedisConnectionFactory"&gt; &lt;property name="poolConfig" ref="JedispoolConfig"/&gt; &lt;property name="port" value="$&#123;redis.port&#125;"/&gt; &lt;property name="hostName" value="$&#123;redis.host&#125;"/&gt; &lt;property name="password" value="$&#123;redis.password&#125;"/&gt; &lt;property name="timeout" value="$&#123;redis.timeout&#125;"&gt;&lt;/property&gt; &lt;/bean&gt; &lt;bean id="redisTemplate" class="org.springframework.data.redis.core.RedisTemplate"&gt; &lt;property name="connectionFactory" ref="connectionFactory"/&gt; &lt;property name="keySerializer"&gt; &lt;bean class="org.springframework.data.redis.serializer.StringRedisSerializer"/&gt; &lt;/property&gt; &lt;property name="valueSerializer"&gt; &lt;bean class="org.springframework.data.redis.serializer.StringRedisSerializer"/&gt; &lt;/property&gt; &lt;/bean&gt; è¿™ä¸ªå…¶å®æ²¡å¤šå°‘å¥½è¯´çš„ï¼Œå°±ç®—æ˜¯æ¢æˆ SpringBoot ä¹Ÿæ˜¯åˆ›å»º JedispoolConfig,connectionFactory,redisTemplate è¿™äº› bean å³å¯ã€‚ æ€»ç»“æ¢ä¸ºè¿æ¥æ± ä¹‹åå†è¿›è¡Œå‹æµ‹è‡ªç„¶æ²¡æœ‰å‡ºç°è·å–ä¸äº† Redis è¿æ¥çš„å¼‚å¸¸ï¼ˆå¹¶å‘è¾¾åˆ°ä¸€å®šçš„é‡ä¹Ÿä¼šå‡ºé”™ï¼‰è¯´æ˜æ›´æ–°æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ æ¨èæœ‰ç”¨åˆ°è¯¥ç»„ä»¶çš„æœ‹å‹éƒ½å‡çº§ä¸‹ï¼Œä¹Ÿæ¬¢è¿æå‡º Issues å’Œ PRã€‚ é¡¹ç›®åœ°å€ï¼š https://github.com/crossoverJie/distributed-redis-tool]]></content>
      <categories>
        <category>Distributed Tools</category>
      </categories>
      <tags>
        <tag>Distributed Lock</tag>
        <tag>Distributed Limited</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®°äº 2018 å¹´é«˜è€ƒï¼]]></title>
    <url>%2F2018%2F06%2F06%2Fexam%2F2018-06-07-The-university-entrance-exam%2F</url>
    <content type="text"><![CDATA[2012/02/28 2012å¹´äºŒæœˆäºŒåå…«æ—¥ã€‚ è¿™å¤©å­¦æ ¡ä¸¾è¡Œäº†é«˜è€ƒ 100 å¤©èª“å¸ˆå¤§ä¼šï¼Œå½“æ—¶å®Œå…¨ä¸çŸ¥é“æ„å‘³ç€ä»€ä¹ˆï¼Œåªæ„Ÿè§‰ç°åœºçƒ­è¡€æ²¸è…¾ã€æ¿€æƒ…é«˜æ¶¨ï¼Œå¿ƒé‡Œå‘Šè¯‰è‡ªå·±å°±ç®—åªå‰©ä¸‹ 100 å¤©æˆ‘ä¹Ÿèƒ½è€ƒä¸Šæ¸…åå…¶æ¬¡ä¹Ÿæ˜¯åŒ—å¤§ã€‚ 2012/06/03 2012å¹´å…­æœˆä¸‰æ—¥ã€‚ æ™šè‡ªä¹ æ‹¿å‡ºå‰æ®µæ—¶é—´åˆšæ‹çš„æ¯•ä¸šåˆç…§ï¼Œæ¨æ­»æ‘„å½±å¸ˆï¼Œæ²¡æœ‰æŠ“æ‹åˆ°æˆ‘æœ€å¸…çš„è§’åº¦ğŸ˜¡ã€‚ 2012/06/04 2012å¹´å…­æœˆå››æ—¥ã€‚ ç¦»æ ¡å‰çš„æœ€åä¸€æ™šï¼Œæˆ‘ä»¬åƒå¾€å¸¸æ¯å‘¨çš„éŸ³ä¹æ™šè‡ªä¹ ä¸€æ ·ï¼Œç”±éŸ³ä¹å§”å‘˜ï¼ˆ@çŒªå¨…ï¼‰å¸¦ç€å¤§å®¶å”±å¯ç±³å°å­çš„é’æ˜¥çºªå¿µå†Œã€‚ å°çº¢å§ï¼ˆç­ä¸»ä»»ï¼‰ç‰¹åˆ«çš„æ²¡æ¥æŸ¥å²—ã€‚ å¿ƒé‡Œæƒ³ç€ï¼Œè¿™å°±æ˜¯é’æ˜¥å˜›ï¼Ÿä¹Ÿä¸è¿‡å¦‚æ­¤ã€‚ å¤§å®¶æ‹¿ç€çƒ­å’Œçš„æ‰‹æœºï¼ˆæ‰å‘çš„ï¼Œå¹³æ—¶ä¼šæ”¶ï¼‰è‚†æ„çš„æ‹ç€ç…§ç‰‡ï¼š é‚£æ—¶æ²¡æœ‰ç¾é¢œã€æ²¡æœ‰ä¿®å›¾ï¼Œä¸€åˆ‡éƒ½æ˜¯é‚£ä¹ˆå’Œè°ã€‚ 2012/06/05 2012å¹´å…­æœˆäº”æ—¥ã€‚ æ˜¯è¿›æ´¥ï¼ˆæ±Ÿæ´¥ï¼‰èµ¶è€ƒï¼Œèµ°æ—¶ç‰¹åœ°åœ¨å…­é£Ÿå ‚ä¹°äº†ä¸€ä¸ªåŒ…å­ï¼Œæ²¡æƒ³åˆ°æ˜¯åœ¨å­¦æ ¡æœ€åä¸€é¡¿æ—©é¤ã€‚ è½¦ä¸Šå¤§å®¶æœ‰è¯´æœ‰ç¬‘ï¼Œå—¯ï¼Œå°±åƒæ˜¯èµ„æ·±å¯¼æ¸¸å¸¦çš„ä¸€ä¸ªä½ä»·æ—…æ¸¸å›¢ï¼Œæ¯äººå¿ƒé‡Œå……æ»¡äº†æƒŠå–œå´ä¸çŸ¥å³å°†é¢ä¸´ä»€ä¹ˆã€‚ 2012/06/07 2012å¹´å…­æœˆä¸ƒæ—¥ã€‚ å¤§å®¶åœ¨å„è‡ªçš„è€ƒåœºå¥‹ç¬”ç–¾ä¹¦ï¼Œç”¨ä¸¤å¤©å››åœºè€ƒè¯•æ¥ä¸ºé«˜ä¸­ä¸‰å¹´ç”»ä¸Šå¥å·ã€‚ æœ‰çš„æ¢¦æƒ³è¿›å…¥ç†æƒ³çš„å¤§å­¦ã€å’Œå¿ƒä»ªçš„ TA é•¿ç›¸å®å®ˆï¼Œå½“ç„¶ä¹Ÿæœ‰å›å®¶ç»§æ‰¿ç™¾ä¸‡å®¶äº§ğŸ˜‚ã€‚ è€Œæˆ‘å½“æ—¶åªæƒ³å¿«é€Ÿçš„ç»“æŸè¿™ä¸€åˆ‡ï¼Œé«˜ä¸­ä¸‰å¹´ï¼Œç‰¹åˆ«æ˜¯é«˜ä¸‰è¿™å¹´çœŸçš„æ˜¯å¤Ÿäº†ã€‚æ¯å¤©åšä¸å®Œçš„å·å­ï¼ŒèƒŒä¸å®Œçš„è¯—è¯ï¼Œè¿˜å¾—æƒ³ç€ä¸ºé™ˆå®¶è€ç¥–å®—å‡ºä¸€ä½æ­£å„¿å…«ç»çš„å¤§å­¦ç”Ÿã€‚ æ‰€ä»¥è€ƒè¯•å®Œå…¨é‡‡ç”¨äººå·åˆä¸€çš„å¿ƒæ€ï¼ˆèƒ½åšå°±åšï¼Œä¸ä¼šå°±è¿‡ï¼‰å¿«é€Ÿçš„è¿‡å®Œäº†è¿™ä¸¤å¤©ã€‚ è¿™äº›ä½œæ–‡é¢˜ç›®è¿˜çœ‹å¾—æ‡‚å˜›ã€‚ã€‚ 2018/06/07 2018å¹´å…­æœˆä¸ƒæ—¥ã€‚ é«˜ä¸­å­¦è¿‡è®¸å¤šå…³äºæ—¶å…‰é£é€çš„æˆè¯­ã€å¤è¯—ï¼Œä½†éƒ½æ²¡æœ‰äº²èº«ä½“ä¼šé‚£ä¹ˆæ·±åˆ»ï¼ å…­å¹´æ—¶é—´ï¼Œçº¢äº†æ¨±æ¡ƒï¼Œç»¿äº†èŠ­è•‰ã€‚ æœ‰çš„æ­¥å…¥èŒåœºã€å‡èŒåŠ è–ªã€æ±‚å©šæˆåŠŸã€ç©¿ä¸Šå©šçº±ã€ç»„å»ºå®¶åº­ã€åˆä¸ºäººæ¯ã€‚ æ¯äººéƒ½è¿‡ç€å„è‡ªçš„ç”Ÿæ´»ï¼Œä½†ä¸€æ—¦ç›¸è§å°±æœ‰æ•°ä¸å°½çš„è¯é¢˜ï¼ˆ@æ±Ÿæºï¼‰ï¼Œé€ƒè¯¾æ‰“çƒã€ç¿»å¢™ä¸Šç½‘ã€æš—æ‹å¥³ç¥ã€å¤©å¤©å‘ä¸Šã€ä½œä¸šå·å­ã€‚ è¿™å¥è¯é€ç»™é«˜2012çº§10ç­çš„æ‰€æœ‰åŒå­¦ï¼š æ„¿ä½ å‡ºèµ°åŠç”Ÿï¼Œå½’æ¥ä»æ˜¯å°‘å¹´ ä¸€å¤§æ³¢å›¾ç‰‡å³å°†è¢­æ¥ï¼š æ‘†æ‹è™½å¥½ï¼Œä¸è¦æŠ½çƒŸå“¦ï¼š å°çº¢å§ç”Ÿæ—¥å¿«ä¹ï¼Œæ°¸è¿œåå…«ï¼š é›†ä½“ç”Ÿæ—¥ï¼Œå¹´å¹´åå…«ï¼š çŠ¶å…ƒä¹¦æ‘Šï¼Œä¸æ˜¯ç¬¬ä¸€ä¸å–ï¼š]]></content>
      <categories>
        <category>å°æƒ…ç»ª</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Netty(ä¸€) SpringBoot æ•´åˆé•¿è¿æ¥å¿ƒè·³æœºåˆ¶]]></title>
    <url>%2F2018%2F05%2F24%2Fnetty%2FNetty(1)TCP-Heartbeat%2F</url>
    <content type="text"><![CDATA[å‰è¨€Netty æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ NIO ç½‘ç»œæ¡†æ¶ï¼Œæœ¬æ–‡åŸºäº SpringBoot ä»¥å¸¸è§çš„å¿ƒè·³æœºåˆ¶æ¥è®¤è¯† Nettyã€‚ æœ€ç»ˆèƒ½è¾¾åˆ°çš„æ•ˆæœï¼š å®¢æˆ·ç«¯æ¯éš” N ç§’æ£€æµ‹æ˜¯å¦éœ€è¦å‘é€å¿ƒè·³ã€‚ æœåŠ¡ç«¯ä¹Ÿæ¯éš” N ç§’æ£€æµ‹æ˜¯å¦éœ€è¦å‘é€å¿ƒè·³ã€‚ æœåŠ¡ç«¯å¯ä»¥ä¸»åŠ¨ push æ¶ˆæ¯åˆ°å®¢æˆ·ç«¯ã€‚ åŸºäº SpringBoot ç›‘æ§ï¼Œå¯ä»¥æŸ¥çœ‹å®æ—¶è¿æ¥ä»¥åŠå„ç§åº”ç”¨ä¿¡æ¯ã€‚ æ•ˆæœå¦‚ä¸‹ï¼š IdleStateHandlerNetty å¯ä»¥ä½¿ç”¨ IdleStateHandler æ¥å®ç°è¿æ¥ç®¡ç†ï¼Œå½“è¿æ¥ç©ºé—²æ—¶é—´å¤ªé•¿ï¼ˆæ²¡æœ‰å‘é€ã€æ¥æ”¶æ¶ˆæ¯ï¼‰æ—¶åˆ™ä¼šè§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼Œæˆ‘ä»¬ä¾¿å¯åœ¨è¯¥äº‹ä»¶ä¸­å®ç°å¿ƒè·³æœºåˆ¶ã€‚ å®¢æˆ·ç«¯å¿ƒè·³å½“å®¢æˆ·ç«¯ç©ºé—²äº† N ç§’æ²¡æœ‰ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯æ—¶ä¼šè‡ªåŠ¨å‘é€ä¸€ä¸ªå¿ƒè·³æ¥ç»´æŒè¿æ¥ã€‚ æ ¸å¿ƒä»£ç ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334public class EchoClientHandle extends SimpleChannelInboundHandler&lt;ByteBuf&gt; &#123; private final static Logger LOGGER = LoggerFactory.getLogger(EchoClientHandle.class); @Override public void userEventTriggered(ChannelHandlerContext ctx, Object evt) throws Exception &#123; if (evt instanceof IdleStateEvent)&#123; IdleStateEvent idleStateEvent = (IdleStateEvent) evt ; if (idleStateEvent.state() == IdleState.WRITER_IDLE)&#123; LOGGER.info("å·²ç» 10 ç§’æ²¡æœ‰å‘é€ä¿¡æ¯ï¼"); //å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ CustomProtocol heartBeat = SpringBeanFactory.getBean("heartBeat", CustomProtocol.class); ctx.writeAndFlush(heartBeat).addListener(ChannelFutureListener.CLOSE_ON_FAILURE) ; &#125; &#125; super.userEventTriggered(ctx, evt); &#125; @Override protected void channelRead0(ChannelHandlerContext channelHandlerContext, ByteBuf in) throws Exception &#123; //ä»æœåŠ¡ç«¯æ”¶åˆ°æ¶ˆæ¯æ—¶è¢«è°ƒç”¨ LOGGER.info("å®¢æˆ·ç«¯æ”¶åˆ°æ¶ˆæ¯=&#123;&#125;",in.toString(CharsetUtil.UTF_8)) ; &#125;&#125; å®ç°éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨äº‹ä»¶å›è°ƒä¸­å‘é€ä¸€ä¸ªæ¶ˆæ¯å³å¯ã€‚ ç”±äºæ•´åˆäº† SpringBoot ï¼Œæ‰€ä»¥å‘é€çš„å¿ƒè·³ä¿¡æ¯æ˜¯ä¸€ä¸ªå•ä¾‹çš„ Beanã€‚ 123456789101112@Configurationpublic class HeartBeatConfig &#123; @Value("$&#123;channel.id&#125;") private long id ; @Bean(value = "heartBeat") public CustomProtocol heartBeat()&#123; return new CustomProtocol(id,"ping") ; &#125;&#125; è¿™é‡Œæ¶‰åŠåˆ°äº†è‡ªå®šä¹‰åè®®çš„å†…å®¹ï¼Œè¯·ç»§ç»­æŸ¥çœ‹ä¸‹æ–‡ã€‚ å½“ç„¶å°‘ä¸äº†å¯åŠ¨å¼•å¯¼ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344@Componentpublic class HeartbeatClient &#123; private final static Logger LOGGER = LoggerFactory.getLogger(HeartbeatClient.class); private EventLoopGroup group = new NioEventLoopGroup(); @Value("$&#123;netty.server.port&#125;") private int nettyPort; @Value("$&#123;netty.server.host&#125;") private String host; private SocketChannel channel; @PostConstruct public void start() throws InterruptedException &#123; Bootstrap bootstrap = new Bootstrap(); bootstrap.group(group) .channel(NioSocketChannel.class) .handler(new CustomerHandleInitializer()) ; ChannelFuture future = bootstrap.connect(host, nettyPort).sync(); if (future.isSuccess()) &#123; LOGGER.info("å¯åŠ¨ Netty æˆåŠŸ"); &#125; channel = (SocketChannel) future.channel(); &#125; &#125;public class CustomerHandleInitializer extends ChannelInitializer&lt;Channel&gt; &#123; @Override protected void initChannel(Channel ch) throws Exception &#123; ch.pipeline() //10 ç§’æ²¡å‘é€æ¶ˆæ¯ å°†IdleStateHandler æ·»åŠ åˆ° ChannelPipeline ä¸­ .addLast(new IdleStateHandler(0, 10, 0)) .addLast(new HeartbeatEncode()) .addLast(new EchoClientHandle()) ; &#125;&#125; æ‰€ä»¥å½“åº”ç”¨å¯åŠ¨æ¯éš” 10 ç§’ä¼šæ£€æµ‹æ˜¯å¦å‘é€è¿‡æ¶ˆæ¯ï¼Œä¸ç„¶å°±ä¼šå‘é€å¿ƒè·³ä¿¡æ¯ã€‚ æœåŠ¡ç«¯å¿ƒè·³æœåŠ¡å™¨ç«¯çš„å¿ƒè·³å…¶å®ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œä¹Ÿéœ€è¦åœ¨ ChannelPipeline ä¸­æ·»åŠ ä¸€ä¸ª IdleStateHandler ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344public class HeartBeatSimpleHandle extends SimpleChannelInboundHandler&lt;CustomProtocol&gt; &#123; private final static Logger LOGGER = LoggerFactory.getLogger(HeartBeatSimpleHandle.class); private static final ByteBuf HEART_BEAT = Unpooled.unreleasableBuffer(Unpooled.copiedBuffer(new CustomProtocol(123456L,"pong").toString(),CharsetUtil.UTF_8)); /** * å–æ¶ˆç»‘å®š * @param ctx * @throws Exception */ @Override public void channelInactive(ChannelHandlerContext ctx) throws Exception &#123; NettySocketHolder.remove((NioSocketChannel) ctx.channel()); &#125; @Override public void userEventTriggered(ChannelHandlerContext ctx, Object evt) throws Exception &#123; if (evt instanceof IdleStateEvent)&#123; IdleStateEvent idleStateEvent = (IdleStateEvent) evt ; if (idleStateEvent.state() == IdleState.READER_IDLE)&#123; LOGGER.info("å·²ç»5ç§’æ²¡æœ‰æ”¶åˆ°ä¿¡æ¯ï¼"); //å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ ctx.writeAndFlush(HEART_BEAT).addListener(ChannelFutureListener.CLOSE_ON_FAILURE) ; &#125; &#125; super.userEventTriggered(ctx, evt); &#125; @Override protected void channelRead0(ChannelHandlerContext ctx, CustomProtocol customProtocol) throws Exception &#123; LOGGER.info("æ”¶åˆ°customProtocol=&#123;&#125;", customProtocol); //ä¿å­˜å®¢æˆ·ç«¯ä¸ Channel ä¹‹é—´çš„å…³ç³» NettySocketHolder.put(customProtocol.getId(),(NioSocketChannel)ctx.channel()) ; &#125;&#125; è¿™é‡Œæœ‰ç‚¹éœ€è¦æ³¨æ„ï¼š å½“æœ‰å¤šä¸ªå®¢æˆ·ç«¯è¿ä¸Šæ¥æ—¶ï¼ŒæœåŠ¡ç«¯éœ€è¦åŒºåˆ†å¼€ï¼Œä¸ç„¶å“åº”æ¶ˆæ¯å°±ä¼šå‘ç”Ÿæ··ä¹±ã€‚ æ‰€ä»¥æ¯å½“æœ‰ä¸ªè¿æ¥ä¸Šæ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½å°†å½“å‰çš„ Channel ä¸è¿ä¸Šçš„å®¢æˆ·ç«¯ ID è¿›è¡Œå…³è”ï¼ˆå› æ­¤æ¯ä¸ªè¿ä¸Šçš„å®¢æˆ·ç«¯ ID éƒ½å¿…é¡»å”¯ä¸€ï¼‰ã€‚ è¿™é‡Œé‡‡ç”¨äº†ä¸€ä¸ª Map æ¥ä¿å­˜è¿™ä¸ªå…³ç³»ï¼Œå¹¶ä¸”åœ¨æ–­å¼€è¿æ¥æ—¶è‡ªåŠ¨å–æ¶ˆè¿™ä¸ªå…³è”ã€‚ 12345678910111213141516171819public class NettySocketHolder &#123; private static final Map&lt;Long, NioSocketChannel&gt; MAP = new ConcurrentHashMap&lt;&gt;(16); public static void put(Long id, NioSocketChannel socketChannel) &#123; MAP.put(id, socketChannel); &#125; public static NioSocketChannel get(Long id) &#123; return MAP.get(id); &#125; public static Map&lt;Long, NioSocketChannel&gt; getMAP() &#123; return MAP; &#125; public static void remove(NioSocketChannel nioSocketChannel) &#123; MAP.entrySet().stream().filter(entry -&gt; entry.getValue() == nioSocketChannel).forEach(entry -&gt; MAP.remove(entry.getKey())); &#125;&#125; å¯åŠ¨å¼•å¯¼ç¨‹åºï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859Componentpublic class HeartBeatServer &#123; private final static Logger LOGGER = LoggerFactory.getLogger(HeartBeatServer.class); private EventLoopGroup boss = new NioEventLoopGroup(); private EventLoopGroup work = new NioEventLoopGroup(); @Value("$&#123;netty.server.port&#125;") private int nettyPort; /** * å¯åŠ¨ Netty * * @return * @throws InterruptedException */ @PostConstruct public void start() throws InterruptedException &#123; ServerBootstrap bootstrap = new ServerBootstrap() .group(boss, work) .channel(NioServerSocketChannel.class) .localAddress(new InetSocketAddress(nettyPort)) //ä¿æŒé•¿è¿æ¥ .childOption(ChannelOption.SO_KEEPALIVE, true) .childHandler(new HeartbeatInitializer()); ChannelFuture future = bootstrap.bind().sync(); if (future.isSuccess()) &#123; LOGGER.info("å¯åŠ¨ Netty æˆåŠŸ"); &#125; &#125; /** * é”€æ¯ */ @PreDestroy public void destroy() &#123; boss.shutdownGracefully().syncUninterruptibly(); work.shutdownGracefully().syncUninterruptibly(); LOGGER.info("å…³é—­ Netty æˆåŠŸ"); &#125;&#125; public class HeartbeatInitializer extends ChannelInitializer&lt;Channel&gt; &#123; @Override protected void initChannel(Channel ch) throws Exception &#123; ch.pipeline() //äº”ç§’æ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯ å°†IdleStateHandler æ·»åŠ åˆ° ChannelPipeline ä¸­ .addLast(new IdleStateHandler(5, 0, 0)) .addLast(new HeartbeatDecoder()) .addLast(new HeartBeatSimpleHandle()); &#125;&#125; ä¹Ÿæ˜¯åŒæ ·å°†IdleStateHandler æ·»åŠ åˆ° ChannelPipeline ä¸­ï¼Œä¹Ÿä¼šæœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯5ç§’æ ¡éªŒä¸€æ¬¡æ˜¯å¦æœ‰æ”¶åˆ°æ¶ˆæ¯ï¼Œå¦åˆ™å°±ä¸»åŠ¨å‘é€ä¸€æ¬¡è¯·æ±‚ã€‚ å› ä¸ºæµ‹è¯•æ˜¯æœ‰ä¸¤ä¸ªå®¢æˆ·ç«¯è¿ä¸Šæ‰€ä»¥æœ‰ä¸¤ä¸ªæ—¥å¿—ã€‚ è‡ªå®šä¹‰åè®®ä¸Šæ–‡å…¶å®éƒ½çœ‹åˆ°äº†ï¼šæœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯é‡‡ç”¨çš„æ˜¯è‡ªå®šä¹‰çš„ POJO è¿›è¡Œé€šè®¯çš„ã€‚ æ‰€ä»¥éœ€è¦åœ¨å®¢æˆ·ç«¯è¿›è¡Œç¼–ç ï¼ŒæœåŠ¡ç«¯è¿›è¡Œè§£ç ï¼Œä¹Ÿéƒ½åªéœ€è¦å„è‡ªå®ç°ä¸€ä¸ªç¼–è§£ç å™¨å³å¯ã€‚ CustomProtocolï¼š 1234567public class CustomProtocol implements Serializable&#123; private static final long serialVersionUID = 4671171056588401542L; private long id ; private String content ; //çœç•¥ getter/setter&#125; å®¢æˆ·ç«¯çš„ç¼–ç å™¨ï¼š 123456789public class HeartbeatEncode extends MessageToByteEncoder&lt;CustomProtocol&gt; &#123; @Override protected void encode(ChannelHandlerContext ctx, CustomProtocol msg, ByteBuf out) throws Exception &#123; out.writeLong(msg.getId()) ; out.writeBytes(msg.getContent().getBytes()) ; &#125;&#125; ä¹Ÿå°±æ˜¯è¯´æ¶ˆæ¯çš„å‰å…«ä¸ªå­—èŠ‚ä¸º headerï¼Œå‰©ä½™çš„å…¨æ˜¯ contentã€‚ æœåŠ¡ç«¯çš„è§£ç å™¨ï¼š 12345678910111213141516public class HeartbeatDecoder extends ByteToMessageDecoder &#123; @Override protected void decode(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out) throws Exception &#123; long id = in.readLong() ; byte[] bytes = new byte[in.readableBytes()] ; in.readBytes(bytes) ; String content = new String(bytes) ; CustomProtocol customProtocol = new CustomProtocol() ; customProtocol.setId(id); customProtocol.setContent(content) ; out.add(customProtocol) ; &#125;&#125; åªéœ€è¦æŒ‰ç…§åˆšæ‰çš„è§„åˆ™è¿›è¡Œè§£ç å³å¯ã€‚ å®ç°åŸç†å…¶å®è”æƒ³åˆ° IdleStateHandler çš„åŠŸèƒ½ï¼Œè‡ªç„¶ä¹Ÿèƒ½æƒ³åˆ°å®ƒå®ç°çš„åŸç†ï¼š åº”è¯¥ä¼šå­˜åœ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡çš„çº¿ç¨‹å»å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚ æ¥çœ‹çœ‹å®ƒçš„æºç ï¼š é¦–å…ˆæ˜¯æ„é€ å‡½æ•°: 12345678public IdleStateHandler( int readerIdleTimeSeconds, int writerIdleTimeSeconds, int allIdleTimeSeconds) &#123; this(readerIdleTimeSeconds, writerIdleTimeSeconds, allIdleTimeSeconds, TimeUnit.SECONDS);&#125; å…¶å®å°±æ˜¯åˆå§‹åŒ–äº†å‡ ä¸ªæ•°æ®ï¼š readerIdleTimeSecondsï¼šä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ•°æ®è¯»å– writerIdleTimeSecondsï¼šä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ•°æ®å‘é€ allIdleTimeSecondsï¼šä»¥ä¸Šä¸¤ç§æ»¡è¶³å…¶ä¸­ä¸€ä¸ªå³å¯ å› ä¸º IdleStateHandler ä¹Ÿæ˜¯ä¸€ç§ ChannelHandlerï¼Œæ‰€ä»¥ä¼šåœ¨ channelActive ä¸­åˆå§‹åŒ–ä»»åŠ¡ï¼š 1234567891011121314151617181920212223242526272829303132333435@Overridepublic void channelActive(ChannelHandlerContext ctx) throws Exception &#123; // This method will be invoked only if this handler was added // before channelActive() event is fired. If a user adds this handler // after the channelActive() event, initialize() will be called by beforeAdd(). initialize(ctx); super.channelActive(ctx);&#125;private void initialize(ChannelHandlerContext ctx) &#123; // Avoid the case where destroy() is called before scheduling timeouts. // See: https://github.com/netty/netty/issues/143 switch (state) &#123; case 1: case 2: return; &#125; state = 1; initOutputChanged(ctx); lastReadTime = lastWriteTime = ticksInNanos(); if (readerIdleTimeNanos &gt; 0) &#123; readerIdleTimeout = schedule(ctx, new ReaderIdleTimeoutTask(ctx), readerIdleTimeNanos, TimeUnit.NANOSECONDS); &#125; if (writerIdleTimeNanos &gt; 0) &#123; writerIdleTimeout = schedule(ctx, new WriterIdleTimeoutTask(ctx), writerIdleTimeNanos, TimeUnit.NANOSECONDS); &#125; if (allIdleTimeNanos &gt; 0) &#123; allIdleTimeout = schedule(ctx, new AllIdleTimeoutTask(ctx), allIdleTimeNanos, TimeUnit.NANOSECONDS); &#125;&#125; ä¹Ÿå°±æ˜¯ä¼šæŒ‰ç…§æˆ‘ä»¬ç»™å®šçš„æ—¶é—´åˆå§‹åŒ–å‡ºå®šæ—¶ä»»åŠ¡ã€‚ æ¥ç€åœ¨ä»»åŠ¡çœŸæ­£æ‰§è¡Œæ—¶è¿›è¡Œåˆ¤æ–­ï¼š 1234567891011121314151617181920212223242526272829303132private final class ReaderIdleTimeoutTask extends AbstractIdleTask &#123; ReaderIdleTimeoutTask(ChannelHandlerContext ctx) &#123; super(ctx); &#125; @Override protected void run(ChannelHandlerContext ctx) &#123; long nextDelay = readerIdleTimeNanos; if (!reading) &#123; nextDelay -= ticksInNanos() - lastReadTime; &#125; if (nextDelay &lt;= 0) &#123; // Reader is idle - set a new timeout and notify the callback. readerIdleTimeout = schedule(ctx, this, readerIdleTimeNanos, TimeUnit.NANOSECONDS); boolean first = firstReaderIdleEvent; firstReaderIdleEvent = false; try &#123; IdleStateEvent event = newIdleStateEvent(IdleState.READER_IDLE, first); channelIdle(ctx, event); &#125; catch (Throwable t) &#123; ctx.fireExceptionCaught(t); &#125; &#125; else &#123; // Read occurred before the timeout - set a new timeout with shorter delay. readerIdleTimeout = schedule(ctx, this, nextDelay, TimeUnit.NANOSECONDS); &#125; &#125;&#125; å¦‚æœæ»¡è¶³æ¡ä»¶åˆ™ä¼šç”Ÿæˆä¸€ä¸ª IdleStateEvent äº‹ä»¶ã€‚ SpringBoot ç›‘æ§ç”±äºæ•´åˆäº† SpringBoot ä¹‹åä¸ä½†å¯ä»¥åˆ©ç”¨ Spring å¸®æˆ‘ä»¬ç®¡ç†å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨å®ƒæ¥åšåº”ç”¨ç›‘æ§ã€‚ actuator ç›‘æ§å½“æˆ‘ä»¬ä¸ºå¼•å…¥äº†: 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&lt;/dependency&gt; å°±å¼€å¯äº† SpringBoot çš„ actuator ç›‘æ§åŠŸèƒ½ï¼Œä»–å¯ä»¥æš´éœ²å‡ºå¾ˆå¤šç›‘æ§ç«¯ç‚¹ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚ å¦‚ä¸€äº›åº”ç”¨ä¸­çš„ä¸€äº›ç»Ÿè®¡æ•°æ®ï¼š å­˜åœ¨çš„ Beansï¼š æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ï¼šhttps://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html ä½†æ˜¯å¦‚æœæˆ‘æƒ³ç›‘æ§ç°åœ¨æˆ‘çš„æœåŠ¡ç«¯æœ‰å¤šå°‘å®¢æˆ·ç«¯è¿ä¸Šæ¥äº†ï¼Œåˆ†åˆ«çš„ ID æ˜¯å¤šå°‘ï¼Ÿ å…¶å®å°±æ˜¯å®æ—¶æŸ¥çœ‹æˆ‘å†…éƒ¨å®šä¹‰çš„é‚£ä¸ªå…³è”å…³ç³»çš„ Mapã€‚ è¿™å°±éœ€è¦æš´éœ²è‡ªå®šä¹‰ç«¯ç‚¹äº†ã€‚ è‡ªå®šä¹‰ç«¯ç‚¹æš´éœ²çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼š ç»§æ‰¿ AbstractEndpoint å¹¶å¤å†™å…¶ä¸­çš„ invoke å‡½æ•°ï¼š 1234567891011121314151617public class CustomEndpoint extends AbstractEndpoint&lt;Map&lt;Long,NioSocketChannel&gt;&gt; &#123; /** * ç›‘æ§ç«¯ç‚¹çš„ è®¿é—®åœ°å€ * @param id */ public CustomEndpoint(String id) &#123; //false è¡¨ç¤ºä¸æ˜¯æ•æ„Ÿç«¯ç‚¹ super(id, false); &#125; @Override public Map&lt;Long, NioSocketChannel&gt; invoke() &#123; return NettySocketHolder.getMAP(); &#125;&#125; å…¶å®å°±æ˜¯è¿”å›äº† Map ä¸­çš„æ•°æ®ã€‚ å†é…ç½®ä¸€ä¸ªè¯¥ç±»å‹çš„ Bean å³å¯ï¼š 12345678910111213@Configurationpublic class EndPointConfig &#123; @Value("$&#123;monitor.channel.map.key&#125;") private String channelMap; @Bean public CustomEndpoint buildEndPoint()&#123; CustomEndpoint customEndpoint = new CustomEndpoint(channelMap) ; return customEndpoint ; &#125;&#125; è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„ monitor.channel.map.key æ¥è®¿é—®äº†ï¼š ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥æ—¶ï¼š ä¸¤ä¸ªå®¢æˆ·ç«¯è¿æ¥æ—¶ï¼š æ•´åˆ SBAè¿™æ ·å…¶å®ç›‘æ§åŠŸèƒ½å·²ç»å¯ä»¥æ»¡è¶³äº†ï¼Œä½†èƒ½ä¸èƒ½å±•ç¤ºçš„æ›´ç¾è§‚ã€å¹¶ä¸”å¤šä¸ªåº”ç”¨ä¹Ÿå¯ä»¥æ–¹ä¾¿æŸ¥çœ‹å‘¢ï¼Ÿ æœ‰è¿™æ ·çš„å¼€æºå·¥å…·å¸®æˆ‘ä»¬åšåˆ°äº†ï¼š https://github.com/codecentric/spring-boot-admin ç®€å•æ¥è¯´æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¯¥å·¥å…·å°† actuator æš´éœ²å‡ºæ¥çš„æ¥å£å¯è§†åŒ–å¹¶èšåˆçš„å±•ç¤ºåœ¨é¡µé¢ä¸­ï¼š æ¥å…¥ä¹Ÿå¾ˆç®€å•ï¼Œé¦–å…ˆéœ€è¦å¼•å…¥ä¾èµ–ï¼š 1234&lt;dependency&gt; &lt;groupId&gt;de.codecentric&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-admin-starter-client&lt;/artifactId&gt;&lt;/dependency&gt; å¹¶åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ï¼š 1234# å…³é—­å¥åº·æ£€æŸ¥æƒé™management.security.enabled=false# SpringAdmin åœ°å€spring.boot.admin.url=http://127.0.0.1:8888 åœ¨å¯åŠ¨åº”ç”¨ä¹‹å‰å…ˆè®² SpringBootAdmin éƒ¨ç½²å¥½ï¼š è¿™ä¸ªåº”ç”¨å°±æ˜¯ä¸€ä¸ªçº¯ç²¹çš„ SpringBoot ï¼Œåªéœ€è¦åœ¨ä¸»å‡½æ•°ä¸ŠåŠ å…¥ @EnableAdminServer æ³¨è§£ã€‚ 12345678910@SpringBootApplication@Configuration@EnableAutoConfiguration@EnableAdminServerpublic class AdminApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(AdminApplication.class, args); &#125;&#125; å¼•å…¥ï¼š 12345678910&lt;dependency&gt; &lt;groupId&gt;de.codecentric&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-admin-starter-server&lt;/artifactId&gt; &lt;version&gt;1.5.7&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;de.codecentric&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-admin-server-ui&lt;/artifactId&gt; &lt;version&gt;1.5.6&lt;/version&gt;&lt;/dependency&gt; ä¹‹åç›´æ¥å¯åŠ¨å°±è¡Œäº†ã€‚ è¿™æ ·æˆ‘ä»¬åœ¨ SpringBootAdmin çš„é¡µé¢ä¸­å°±å¯ä»¥æŸ¥çœ‹å¾ˆå¤šåº”ç”¨ä¿¡æ¯äº†ã€‚ æ›´å¤šå†…å®¹è¯·å‚è€ƒå®˜æ–¹æŒ‡å—ï¼š http://codecentric.github.io/spring-boot-admin/1.5.6/ è‡ªå®šä¹‰ç›‘æ§æ•°æ®å…¶å®æˆ‘ä»¬å®Œå…¨å¯ä»¥å€ŸåŠ© actuator ä»¥åŠè¿™ä¸ªå¯è§†åŒ–é¡µé¢å¸®æˆ‘ä»¬ç›‘æ§ä¸€äº›ç®€å•çš„åº¦é‡ä¿¡æ¯ã€‚ æ¯”å¦‚æˆ‘åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸­å†™äº†ä¸¤ä¸ª Rest æ¥å£ç”¨äºå‘å¯¹æ–¹å‘é€æ¶ˆæ¯ã€‚ åªæ˜¯æƒ³è¦è®°å½•åˆ†åˆ«å‘é€äº†å¤šå°‘æ¬¡ï¼š å®¢æˆ·ç«¯ï¼š 123456789101112131415161718192021222324252627282930313233343536@Controller@RequestMapping("/")public class IndexController &#123; /** * ç»Ÿè®¡ service */ @Autowired private CounterService counterService; @Autowired private HeartbeatClient heartbeatClient ; /** * å‘æœåŠ¡ç«¯å‘æ¶ˆæ¯ * @param sendMsgReqVO * @return */ @ApiOperation("å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯") @RequestMapping("sendMsg") @ResponseBody public BaseResponse&lt;SendMsgResVO&gt; sendMsg(@RequestBody SendMsgReqVO sendMsgReqVO)&#123; BaseResponse&lt;SendMsgResVO&gt; res = new BaseResponse(); heartbeatClient.sendMsg(new CustomProtocol(sendMsgReqVO.getId(),sendMsgReqVO.getMsg())) ; // åˆ©ç”¨ actuator æ¥è‡ªå¢ counterService.increment(Constants.COUNTER_CLIENT_PUSH_COUNT); SendMsgResVO sendMsgResVO = new SendMsgResVO() ; sendMsgResVO.setMsg("OK") ; res.setCode(StatusEnum.SUCCESS.getCode()) ; res.setMessage(StatusEnum.SUCCESS.getMessage()) ; res.setDataBody(sendMsgResVO) ; return res ; &#125;&#125; åªè¦æˆ‘ä»¬å¼•å…¥äº† actuator çš„åŒ…ï¼Œé‚£å°±å¯ä»¥ç›´æ¥æ³¨å…¥ counterService ï¼Œåˆ©ç”¨å®ƒæ¥å¸®æˆ‘ä»¬è®°å½•æ•°æ®ã€‚ å½“æˆ‘ä»¬è°ƒç”¨è¯¥æ¥å£æ—¶ï¼š åœ¨ç›‘æ§é¡µé¢ä¸­å¯ä»¥æŸ¥è¯¢åˆšæ‰çš„è°ƒç”¨æƒ…å†µï¼š æœåŠ¡ç«¯ä¸»åŠ¨ push æ¶ˆæ¯ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œåªæ˜¯éœ€è¦åœ¨å‘é€æ—¶å€™æ ¹æ®å®¢æˆ·ç«¯çš„ ID æŸ¥è¯¢åˆ°å…·ä½“çš„ Channel å‘é€ï¼š æ€»ç»“ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªç®€å• Netty å¿ƒè·³ç¤ºä¾‹ï¼Œå¹¶æ¼”ç¤ºäº† SpringBoot çš„ç›‘æ§ï¼Œä¹‹åä¼šç»§ç»­æ›´æ–° Netty ç›¸å…³å†…å®¹ï¼Œæ¬¢è¿å…³æ³¨åŠæŒ‡æ­£ã€‚ æœ¬æ–‡æ‰€æœ‰ä»£ç ï¼š https://github.com/crossoverJie/netty-action å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>Netty</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>TCP</tag>
        <tag>Heartbeat</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[1K star+ çš„é¡¹ç›®æ˜¯å¦‚ä½•ç‚¼æˆçš„ï¼Ÿ]]></title>
    <url>%2F2018%2F05%2F15%2Fskill%2F1Kstar%2F</url>
    <content type="text"><![CDATA[å‰è¨€é¦–å…ˆæ ‡é¢˜å…šä¸€ä¸‹ï¼Œå…¶å®è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯è®°å½•æˆ‘çš„ç¬¬äºŒä¸ªè¿‡ 1K star çš„é¡¹ç›® Java-Interviewï¼Œé¡ºä¾¿åˆ†äº«ä¸‹å…¶ä¸­çš„è¿‡ç¨‹åŠç»éªŒã€‚ éœ€æ±‚é€‰æ‹©Java-Interviewä¹‹æ‰€ä»¥è¦åšè¿™ä¸ªé¡¹ç›®ä¸»è¦æ˜¯å½“æ—¶æˆ‘æ­£åœ¨é¢é˜¿é‡Œçš„ä¸¤ä¸ªéƒ¨é—¨ï¼Œéå¸¸å¹¸è¿çš„æ˜¯æŠ€æœ¯é¢éƒ½è¿‡äº†ã€‚å…¶ä¸­çš„è¿‡ç¨‹çœŸæ˜¯è®©æˆ‘å—ç›ŠåŒªæµ…æ›´æ˜¯å°è±¡æ·±åˆ»ï¼Œæ‰€ä»¥å°±æƒ³æŠŠæœŸé—´çš„é—®é¢˜è®°å½•ä¸‹æ¥ï¼ŒåŠ ä¸Šè‡ªå·±çš„ç†è§£å¸Œæœ›èƒ½å¯¹å…¶ä»–æœ‹å‹èµ·åˆ°å¸®åŠ©ã€‚ æ­£å¥½é‚£æ®µæ—¶é—´ä¹Ÿæ˜¯ä¼ è¯´ä¸­çš„é‡‘ä¸‰é“¶å››ï¼Œæ‰€ä»¥æ— å½¢ä¸­ä¹Ÿå«é¡ºåŠ¿è€Œä¸ºå§ğŸ˜ã€‚ SSMè¿™ä¸ªé¡¹ç›®çš„å†å²å°±æ¯”è¾ƒæ‚ ä¹…äº†ï¼Œæˆ‘çœ‹äº†ä¸‹ç¬¬ä¸€æ¬¡æäº¤å·®ä¸å¤šæ˜¯ä¸¤å¹´å‰ã€‚ ä»è¿™ä¸ªåå­—ä¹Ÿå¯ä»¥çœ‹å‡ºå½“åˆè¿˜æ˜¯ä¸€ä¸ªåˆšå…¥è¡Œæ²¡å¤šä¹…çš„å°èœé¸Ÿï¼Œå› ä¸ºä¹‹å‰åœ¨å­¦ Java çš„æ—¶å€™çœŸçš„èµ°äº†å¾ˆå¤šå†¤æ‰è·¯ï¼Œæ‰€ä»¥ä»å¤´å¼€å§‹è®°å½•åˆ°ç°åœ¨æ•´ä¸ªè¿‡ç¨‹æ‰€å­¦åˆ°çš„ä¸œè¥¿ï¼Œè¸©è¿‡çš„å‘ã€‚ ç”±äºæ˜¯é¢å‘å°ç™½ï¼Œå…¥é—¨ç®€å•ï¼Œä¸Šæ‰‹è¾ƒå¿«ä¹Ÿå–çš„äº†ä¸€å®šçš„å…³æ³¨ã€‚ å…¶å®ä»è¿™ä¸¤ä¸ªé¡¹ç›®å¯ä»¥çœ‹å‡ºé€‰æ‹©ä¸€ä¸ªæ–¹å‘æ˜¯å¾ˆé‡è¦çš„ã€‚ ä»¥åŠè¯¥é¡¹ç›®è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œé•¿æœŸçš„è§„åˆ’ï¼Œå—ä¼—æ˜¯å“ªäº›éƒ½è¦è€ƒè™‘æ¸…æ¥š(æ€ä¹ˆæœ‰ç‚¹åƒåšäº§å“ğŸ˜…ï¼Œå…¶å®è¿™å°±æ˜¯ä½ è‡ªå·±çš„äº§å“)ã€‚ æ¯”å¦‚è¿™ä¸¤ä¸ªé¡¹ç›®çš„ç›®æ ‡ï¼š Java-Interviewï¼šæŒç»­æ›´æ–°é¢è¯•é—®é¢˜ï¼Œå¸Œæœ›èƒ½è®©é¢è¯•è€…çŸ¥å…¶ç„¶ä¹ŸçŸ¥å…¶æ‰€ä»¥ç„¶ã€‚ SSMï¼šåšä¸»ä»å°ç™½åˆ°ç°åœ¨å®é™…å¼€å‘æ‰€é‡åˆ°çš„é—®é¢˜è®°å½•ï¼Œä»¥åŠå®æˆ˜ç»éªŒï¼Œç°åœ¨é€æ¸ä¼šåˆ†äº«ä¸€äº›éš¾ç‚¹ä»¥åŠåº•å±‚ã€‚å—ä¼—å¤§å¤šæ˜¯å°ç™½ã€‚ æ–‡æ¡£å¾ˆé‡è¦æ—¢ç„¶é¡¹ç›®åšå‡ºæ¥æ˜¯ç»™äººç”¨çš„ï¼Œé‚£æ–‡æ¡£å°±æ˜¾å¾—è‡³å…³é‡è¦äº†ã€‚ å°±åƒæ—¥å¸¸å’Œå‰ç«¯æ€¼æ¥å£æ—¶ï¼Œæœ‰ä¸€ä¸ªæ ‡å‡†çš„æ–‡æ¡£è¾“å‡ºæ¯”åœ¨ç™½æ¿ä¸ŠæŠ˜è…¾åŠå¤©è¦é«˜çš„å¤šã€‚ å…¶å®ä»”ç»†è§‚å¯Ÿ GitHub ä¸Šçƒ­é—¨çš„é¡¹ç›®ï¼Œä¼šå‘ç°ä»–ä»¬çš„æ–‡æ¡£å‡ ä¹éƒ½æœ‰ä¸€äº›å…±åŒç»“æ„ï¼š ç®€å•æè¿°é¡¹ç›®æ˜¯å¹²ä»€ä¹ˆçš„ã€‚ å¿«é€Ÿå¯åŠ¨ã€‚ æœ€è¿‘æ›´æ–°ã€‚ Q/A ç­”ç–‘ã€‚ é¡¹ç›®æˆªå›¾ã€‚ ä¸»è¦ç›®çš„å°±æ˜¯è¦ç®€å•æ˜“è¯»ï¼Œå¿«é€Ÿä¸Šæ‰‹ã€‚ ç„¶åæŠŠä¸€äº›å¤æ‚çš„å¦‚ç³»ç»Ÿè®¾è®¡ã€å¼€å‘æŒ‡å—ç­‰å¯ä»¥æ”¾åˆ° wiki ä¸­ã€‚ åˆ‡è®°ä¸è¦ä»€ä¹ˆä¸œè¥¿éƒ½å¾€ README.MD ä¸­å†™ï¼Œä¿æŒä¸€ä¸ªç®€æ´çš„æ–‡æ¡£å¯ä»¥åŠ åˆ†å“¦ã€‚ å½“ç„¶ä¹Ÿå¯ä»¥åœ¨é¦–é¡µåŠ å…¥ä¸€äº›å¾½ç« å¦‚ï¼š ä¹Ÿèƒ½èµ·åˆ°ä¸€äº›ç§¯æä½œç”¨ã€‚ ç§¯ææ¨èä»£ç è´¨é‡è¿™ä¸ªå°±ä¸å¤šè¯´äº†ï¼Œè¿™åº”è¯¥æ˜¯æœ€åŸºæœ¬çš„è¦æ±‚ã€‚ ä¿—è¯è¯´ï¼šé…’é¦™ä¸æ€•å··å­æ·±ã€‚ ä½†å¯¹äºåšå¼€æºé¡¹ç›®æ¥è¯´å°±ä¸å¤ªé€‚åº”äº†ï¼Œå½“ä½ å¹¸è¾›è‹¦è‹¦åšäº†ä¸€ä¸ªè‡ªè®¤ä¸ºå¾ˆä¸é”™çš„é¡¹ç›®ï¼Œç»“æœä¸€å¹´è¿‡å»äº†éƒ½æ— äººé—®æ´¥ï¼Œè¿™ä¸å…ä¼šæœ‰ç‚¹æ‰“å‡»ç§¯ææ€§ã€‚ æ‰€ä»¥é€‚å½“çš„è‡ªæˆ‘æ¨èå°±å¾ˆæœ‰å¿…è¦äº†ã€‚ ä¸Šå›¾æ˜¯æˆ‘åšå®¢ã€é¡¹ç›®çš„ä¸»è¦æµé‡æ¥æºã€‚ ä¸‹é¢æ˜¯æˆ‘è‡ªèº«ä½“éªŒæ¯”è¾ƒä¼˜è´¨çš„æ¨èæ¸ é“ï¼š å¼€å‘è€…å¤´æ¡ï¼šç”±äºæˆªå›¾çš„æ—¶å€™æ²¡æœ‰æ–°å‘æ–‡ç« ï¼Œä¹‹å‰é‚£ç¯‡ç§’æ€æ¶æ„å®è·µå‘äº†ä¹‹ååšå®¢ 80% çš„æµé‡éƒ½æ˜¯ä»å¤´æ¡è¿‡æ¥çš„ï¼Œè€Œä¸”è´¨é‡å¾ˆé«˜ï¼Œä¸å¾—ä¸ç‚¹ä¸ªèµã€‚ å¹¶å‘ç¼–ç¨‹ç½‘: å¹¶å‘ç¼–ç¨‹ç½‘æ˜¯ç”±é˜¿é‡Œå¤§ç‰›æ¸…è‹±(ä¹°äº†é‚£æœ¬ã€Šå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹å°±è¢«åœˆç²‰äº†)åˆ›åŠçš„ï¼Œå…¶ä¸­çš„æ–‡ç« è´¨é‡æ™®éè¾ƒé«˜(å¯¼è‡´ä¹Ÿä¼šæœ‰ä¸€ç‚¹å†™ä½œé—¨æ§›)ã€‚ç”±äºç½‘ç«™çš„æµé‡ä¹Ÿæ¯”è¾ƒé«˜ï¼Œåªè¦ä½ çš„æ–‡ç« è´¨é‡ä¸é”™è‚¯å®šä¼šå¾—åˆ°å¥½å¤„ã€‚ æ˜é‡‘ï¼šæ˜é‡‘è¿™ä¸¤å¹´ä¹Ÿæ¯”è¾ƒç«ï¼Œæ˜¯ä¸“é—¨åšå¼€å‘è€…å†…å®¹çš„ï¼Œä¹Ÿæ˜¯ç½‘ç«™æµé‡ä¸é”™ã€‚ å¼€æºä¸­å›½ï¼šå¼€æºä¸­å›½çš„åšå®¢ä¹Ÿä¸é”™ï¼Œè‡ªå·±ä¹Ÿæœ‰ä»£ç æ‰˜ç®¡ï¼Œä½†æˆ‘è¿˜æ˜¯æ›´å–œæ¬¢ç”¨ GitHubï¼Œä¸€èˆ¬ä¸Šäº†ç¼–è¾‘æ¨èéƒ½ä¼šæœ‰ä¸é”™çš„è®¿é—®é‡ã€‚ V2EXï¼šå¤§åé¼é¼çš„ V ç«™ï¼Œå…¶å®å—ä¼—è¾ƒå°‘ï¼Œæ­£å› ä¸ºå¦‚æ­¤ä¹Ÿå½¢æˆäº†ç‹¬æœ‰çš„æ–‡åŒ–ï¼Œå› æ­¤ä¹Ÿæ˜¯æˆ‘æ¯å¤©æ¯”é€›(æ‘¸é±¼)çš„ç½‘ç«™ï¼Œç”±äºå—ä¼—å¤§å¤šæ˜¯å¼€å‘è€…æ‰€ä»¥ä¹Ÿèƒ½å¾—åˆ°å¾ˆå¤šæœ‰ç”¨çš„åé¦ˆã€‚ å¤§ä½¬æ¨èï¼šæœ€å¿«æ·çš„æ–¹å¼å…¶å®å°±æ˜¯å£å£ç›¸ä¼ ï¼Œå…¶ä¸­å½“ç„¶æ˜¯å¤§ä½¬çš„æ•ˆç‡æœ€é«˜ã€‚ä¹‹å‰æœ‰ä¸ªçº¯æ´çš„å¾®ç¬‘ã€ç¨‹åºçŒ¿DD éƒ½æŠ•è¿‡ç¨¿ï¼Œä¹Ÿèƒ½å¸¦æ¥ä¸é”™çš„æµé‡ã€‚ ç®€ä¹¦:æœ¬æ¥ä¸æƒ³æ¨èç®€ä¹¦çš„ï¼ˆä¹‹å‰çš„äº‹ä»¶ä»¥åŠç°åœ¨é¸¡æ±¤å¤ªå¤šï¼‰ï¼Œä½†æ˜¯æµé‡è¿˜å¯ä»¥ï¼Œç°åœ¨å°±çº¯ç²¹å½“åšåšå®¢å¤‡ä»½çš„å·¥å…·äº†ã€‚ åšæŒä¸‹æ¥ä¹‹åä¼šå‘ç°ï¼šåªè¦è‡ªå·±åšæŒã€ä¿è¯è´¨é‡æœ€åä¼šå½¢æˆè‡ªå·±çš„é˜…è¯»åœˆå­ï¼Œåˆ°åé¢ç”šè‡³ä¼šæœ‰å…¶ä»–æœ‹å‹ä¸»åŠ¨æ¥æ‰¾ä½ åˆ†äº«ï¼Œè¿™äº›éƒ½æ˜¯è‡ªæˆ‘æå‡çš„è¿‡ç¨‹ã€‚ ä¸å¿˜åˆå¿ƒå½“åˆåšçš„ç¬¬ä¸€ä¸ªå¼€æºé¡¹ç›®å°±æ˜¯ SSMï¼Œå®Œå…¨å—å¤Ÿå­¦ä¹ æ—¶æ‰¾èµ„æ–™çš„ç—›è‹¦ï¼Œä¹Ÿå¾—åˆ°äº†å¾ˆå¤šäººçš„å¸®åŠ©ï¼Œæ‰€ä»¥æ‰æœ‰äº†è¯¥é¡¹ç›®ã€‚ å¹³æ—¶å·¥ä½œä¸­æˆ–å¤šæˆ–å°‘éƒ½ä¼šç”¨åˆ°å¼€æºé¡¹ç›®ï¼Œå…¶å®æˆ‘ä»¬å¤§éƒ¨åˆ†äººä¹Ÿå†™ä¸å‡º Springã€Guava è¿™æ ·çš„é¡¹ç›®ï¼Œåªæ˜¯å†è¿™è¿‡ç¨‹ä¸­å¯ä»¥å‚ä¸è¿›å»ï¼Œæ”¶è·ä¹Ÿæ˜¯éå¸¸ä¸°å¯Œçš„ã€‚ ä¸¤å¹´å‰å‚ä¸å¼€æºåˆ°ç°åœ¨æœ‰æ”¶åˆ°é¢è¯•é‚€è¯·ã€ç‰©è´¨å¥–åŠ±è¿™äº›éƒ½æ˜¯æ­£é¢ç§¯æçš„ï¼Œå¯ä»¥é¼“åŠ±æˆ‘ä»¬æ¥ç€åšä¸‹å»ã€‚ ä½†æœ€å¤šçš„è¿˜æ˜¯åœ¨è¿™è¿‡ç¨‹ä¸­ç»“è¯†äº†å¾ˆå¤šæœ‹å‹ï¼ŒæŠ€æœ¯èƒ½åŠ›æå‡ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œè¿™äº›éƒ½æ˜¯ä¿æŒè‡ªæˆ‘å¯æŒç»­å‘å±•çš„å¿…è¦æ¡ä»¶ã€‚]]></content>
      <categories>
        <category>å°æŠ€å·§</category>
      </categories>
      <tags>
        <tag>GitHub</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(åå…«) ç§’æ€æ¶æ„å®è·µ]]></title>
    <url>%2F2018%2F05%2F07%2Fssm%2FSSM18-seconds-kill%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¹‹å‰åœ¨ Java-Interview ä¸­æåˆ°è¿‡ç§’æ€æ¶æ„çš„è®¾è®¡ï¼Œè¿™æ¬¡åŸºäºå…¶ä¸­çš„ç†è®ºç®€å•å®ç°äº†ä¸€ä¸‹ã€‚ æœ¬æ¬¡é‡‡ç”¨å¾ªåºæ¸è¿›çš„æ–¹å¼é€æ­¥æé«˜æ€§èƒ½è¾¾åˆ°å¹¶å‘ç§’æ€çš„æ•ˆæœï¼Œæ–‡ç« è¾ƒé•¿è¯·å‡†å¤‡å¥½ç“œå­æ¿å‡³(liushuizhangğŸ˜‚)ã€‚ æœ¬æ–‡æ‰€æœ‰æ¶‰åŠçš„ä»£ç ï¼š https://github.com/crossoverJie/SSM https://github.com/crossoverJie/distributed-redis-tool æœ€ç»ˆæ¶æ„å›¾ï¼š å…ˆç®€å•æ ¹æ®è¿™ä¸ªå›¾è°ˆä¸‹è¯·æ±‚çš„æµè½¬ï¼Œå› ä¸ºåé¢ä¸ç®¡æ€ä¹ˆæ”¹è¿›è¿™ä¸ªéƒ½æ˜¯æ²¡æœ‰å˜çš„ã€‚ å‰ç«¯è¯·æ±‚è¿›å…¥ web å±‚ï¼Œå¯¹åº”çš„ä»£ç å°±æ˜¯ controllerã€‚ ä¹‹åå°†çœŸæ­£çš„åº“å­˜æ ¡éªŒã€ä¸‹å•ç­‰è¯·æ±‚å‘å¾€ Service å±‚ï¼ˆå…¶ä¸­ RPC è°ƒç”¨ä¾ç„¶é‡‡ç”¨çš„ dubboï¼Œåªæ˜¯æ›´æ–°ä¸ºæœ€æ–°ç‰ˆæœ¬ï¼Œæœ¬æ¬¡ä¸ä¼šè¿‡å¤šè®¨è®º dubbo ç›¸å…³çš„ç»†èŠ‚ï¼Œæœ‰å…´è¶£çš„å¯ä»¥æŸ¥çœ‹ åŸºäºdubboçš„åˆ†å¸ƒå¼æ¶æ„ï¼‰ã€‚ Service å±‚å†å¯¹æ•°æ®è¿›è¡Œè½åœ°ï¼Œä¸‹å•å®Œæˆã€‚ æ— é™åˆ¶å…¶å®æŠ›å¼€ç§’æ€è¿™ä¸ªåœºæ™¯æ¥è¯´æ­£å¸¸çš„ä¸€ä¸ªä¸‹å•æµç¨‹å¯ä»¥ç®€å•åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š æ ¡éªŒåº“å­˜ æ‰£åº“å­˜ åˆ›å»ºè®¢å• æ”¯ä»˜ åŸºäºä¸Šæ–‡çš„æ¶æ„æ‰€ä»¥æˆ‘ä»¬æœ‰äº†ä»¥ä¸‹å®ç°ï¼š å…ˆçœ‹çœ‹å®é™…é¡¹ç›®çš„ç»“æ„ï¼š è¿˜æ˜¯å’Œä»¥å‰ä¸€æ ·ï¼š æä¾›å‡ºä¸€ä¸ª API ç”¨äº Service å±‚å®ç°ï¼Œä»¥åŠ web å±‚æ¶ˆè´¹ã€‚ web å±‚ç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ª SpringMVCã€‚ Service å±‚åˆ™æ˜¯çœŸæ­£çš„æ•°æ®è½åœ°ã€‚ SSM-SECONDS-KILL-ORDER-CONSUMER åˆ™æ˜¯åæ–‡ä¼šæåˆ°çš„ Kafka æ¶ˆè´¹ã€‚ æ•°æ®åº“ä¹Ÿæ˜¯åªæœ‰ç®€å•çš„ä¸¤å¼ è¡¨æ¨¡æ‹Ÿä¸‹å•ï¼š 1234567891011121314151617CREATE TABLE `stock` ( `id` int(11) unsigned NOT NULL AUTO_INCREMENT, `name` varchar(50) NOT NULL DEFAULT '' COMMENT 'åç§°', `count` int(11) NOT NULL COMMENT 'åº“å­˜', `sale` int(11) NOT NULL COMMENT 'å·²å”®', `version` int(11) NOT NULL COMMENT 'ä¹è§‚é”ï¼Œç‰ˆæœ¬å·', PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;CREATE TABLE `stock_order` ( `id` int(11) unsigned NOT NULL AUTO_INCREMENT, `sid` int(11) NOT NULL COMMENT 'åº“å­˜ID', `name` varchar(30) NOT NULL DEFAULT '' COMMENT 'å•†å“åç§°', `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´', PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=55 DEFAULT CHARSET=utf8; web å±‚ controller å®ç°: 12345678910111213141516171819@Autowiredprivate StockService stockService;@Autowiredprivate OrderService orderService;@RequestMapping("/createWrongOrder/&#123;sid&#125;")@ResponseBodypublic String createWrongOrder(@PathVariable int sid) &#123; logger.info("sid=[&#123;&#125;]", sid); int id = 0; try &#123; id = orderService.createWrongOrder(sid); &#125; catch (Exception e) &#123; logger.error("Exception",e); &#125; return String.valueOf(id);&#125; å…¶ä¸­ web ä½œä¸ºä¸€ä¸ªæ¶ˆè´¹è€…è°ƒç”¨çœ‹ OrderService æä¾›å‡ºæ¥çš„ dubbo æœåŠ¡ã€‚ Service å±‚ï¼ŒOrderService å®ç°ï¼š é¦–å…ˆæ˜¯å¯¹ API çš„å®ç°(ä¼šåœ¨ API æä¾›å‡ºæ¥å£)ï¼š 1234567891011@Servicepublic class OrderServiceImpl implements OrderService &#123; @Resource(name = "DBOrderService") private com.crossoverJie.seconds.kill.service.OrderService orderService ; @Override public int createWrongOrder(int sid) throws Exception &#123; return orderService.createWrongOrder(sid); &#125;&#125; è¿™é‡Œåªæ˜¯ç®€å•è°ƒç”¨äº† DBOrderService ä¸­çš„å®ç°ï¼ŒDBOrderService æ‰æ˜¯çœŸæ­£çš„æ•°æ®è½åœ°ï¼Œä¹Ÿå°±æ˜¯å†™æ•°æ®åº“äº†ã€‚ DBOrderService å®ç°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546Transactional(rollbackFor = Exception.class)@Service(value = "DBOrderService")public class OrderServiceImpl implements OrderService &#123; @Resource(name = "DBStockService") private com.crossoverJie.seconds.kill.service.StockService stockService; @Autowired private StockOrderMapper orderMapper; @Override public int createWrongOrder(int sid) throws Exception&#123; //æ ¡éªŒåº“å­˜ Stock stock = checkStock(sid); //æ‰£åº“å­˜ saleStock(stock); //åˆ›å»ºè®¢å• int id = createOrder(stock); return id; &#125; private Stock checkStock(int sid) &#123; Stock stock = stockService.getStockById(sid); if (stock.getSale().equals(stock.getCount())) &#123; throw new RuntimeException("åº“å­˜ä¸è¶³"); &#125; return stock; &#125; private int saleStock(Stock stock) &#123; stock.setSale(stock.getSale() + 1); return stockService.updateStockById(stock); &#125; private int createOrder(Stock stock) &#123; StockOrder order = new StockOrder(); order.setSid(stock.getId()); order.setName(stock.getName()); int id = orderMapper.insertSelective(order); return id; &#125; &#125; é¢„å…ˆåˆå§‹åŒ–äº† 10 æ¡åº“å­˜ã€‚ æ‰‹åŠ¨è°ƒç”¨ä¸‹ createWrongOrder/1 æ¥å£å‘ç°ï¼š åº“å­˜è¡¨ï¼š è®¢å•è¡¨ï¼š ä¸€åˆ‡çœ‹èµ·æ¥éƒ½æ²¡æœ‰é—®é¢˜ï¼Œæ•°æ®ä¹Ÿæ­£å¸¸ã€‚ ä½†æ˜¯å½“ç”¨ JMeter å¹¶å‘æµ‹è¯•æ—¶ï¼š æµ‹è¯•é…ç½®æ˜¯ï¼š300ä¸ªçº¿ç¨‹å¹¶å‘ï¼Œæµ‹è¯•ä¸¤è½®æ¥çœ‹çœ‹æ•°æ®åº“ä¸­çš„ç»“æœï¼š è¯·æ±‚éƒ½å“åº”æˆåŠŸï¼Œåº“å­˜ç¡®å®ä¹Ÿæ‰£å®Œäº†ï¼Œä½†æ˜¯è®¢å•å´ç”Ÿæˆäº† 124 æ¡è®°å½•ã€‚ è¿™æ˜¾ç„¶æ˜¯å…¸å‹çš„è¶…å–ç°è±¡ã€‚ å…¶å®ç°åœ¨å†å»æ‰‹åŠ¨è°ƒç”¨æ¥å£ä¼šè¿”å›åº“å­˜ä¸è¶³ï¼Œä½†ä¸ºæ—¶æ™šçŸ£ã€‚ ä¹è§‚é”æ›´æ–°æ€ä¹ˆæ¥é¿å…ä¸Šè¿°çš„ç°è±¡å‘¢ï¼Ÿ æœ€ç®€å•çš„åšæ³•è‡ªç„¶æ˜¯ä¹è§‚é”äº†ï¼Œè¿™é‡Œä¸è¿‡å¤šè®¨è®ºè¿™ä¸ªï¼Œä¸ç†Ÿæ‚‰çš„æœ‹å‹å¯ä»¥çœ‹ä¸‹è¿™ç¯‡ã€‚ æ¥çœ‹çœ‹å…·ä½“å®ç°ï¼š å…¶å®å…¶ä»–çš„éƒ½æ²¡æ€ä¹ˆæ”¹ï¼Œä¸»è¦æ˜¯ Service å±‚ã€‚ 123456789101112131415161718192021@Overridepublic int createOptimisticOrder(int sid) throws Exception &#123; //æ ¡éªŒåº“å­˜ Stock stock = checkStock(sid); //ä¹è§‚é”æ›´æ–°åº“å­˜ saleStockOptimistic(stock); //åˆ›å»ºè®¢å• int id = createOrder(stock); return id;&#125;private void saleStockOptimistic(Stock stock) &#123; int count = stockService.updateStockByOptimistic(stock); if (count == 0)&#123; throw new RuntimeException("å¹¶å‘æ›´æ–°åº“å­˜å¤±è´¥") ; &#125;&#125; å¯¹åº”çš„ XMLï¼š 1234567891011&lt;update id="updateByOptimistic" parameterType="com.crossoverJie.seconds.kill.pojo.Stock"&gt; update stock &lt;set&gt; sale = sale + 1, version = version + 1, &lt;/set&gt; WHERE id = #&#123;id,jdbcType=INTEGER&#125; AND version = #&#123;version,jdbcType=INTEGER&#125;&lt;/update&gt; åŒæ ·çš„æµ‹è¯•æ¡ä»¶ï¼Œæˆ‘ä»¬å†è¿›è¡Œä¸Šé¢çš„æµ‹è¯• /createOptimisticOrder/1ï¼š è¿™æ¬¡å‘ç°æ— è®ºæ˜¯åº“å­˜è®¢å•éƒ½æ˜¯ OK çš„ã€‚ æŸ¥çœ‹æ—¥å¿—å‘ç°ï¼š å¾ˆå¤šå¹¶å‘è¯·æ±‚ä¼šå“åº”é”™è¯¯ï¼Œè¿™å°±è¾¾åˆ°äº†æ•ˆæœã€‚ æé«˜ååé‡ä¸ºäº†è¿›ä¸€æ­¥æé«˜ç§’æ€æ—¶çš„ååé‡ä»¥åŠå“åº”æ•ˆç‡ï¼Œè¿™é‡Œçš„ web å’Œ Service éƒ½è¿›è¡Œäº†æ¨ªå‘æ‰©å±•ã€‚ web åˆ©ç”¨ Nginx è¿›è¡Œè´Ÿè½½ã€‚ Service ä¹Ÿæ˜¯å¤šå°åº”ç”¨ã€‚ å†ç”¨ JMeter æµ‹è¯•æ—¶å¯ä»¥ç›´è§‚çš„çœ‹åˆ°æ•ˆæœã€‚ ç”±äºæˆ‘æ˜¯åœ¨é˜¿é‡Œäº‘çš„ä¸€å°å°æ°´ç®¡æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•çš„ï¼ŒåŠ ä¸Šé…ç½®ä¸é«˜ã€åº”ç”¨éƒ½åœ¨åŒä¸€å°ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰å®Œå…¨ä½“ç°å‡ºæ€§èƒ½ä¸Šçš„ä¼˜åŠ¿ï¼ˆ Nginx åšè´Ÿè½½è½¬å‘æ—¶å€™ä¹Ÿä¼šå¢åŠ é¢å¤–çš„ç½‘ç»œæ¶ˆè€—ï¼‰ã€‚ shell è„šæœ¬å®ç°ç®€å•çš„ CIç”±äºåº”ç”¨å¤šå°éƒ¨ç½²ä¹‹åï¼Œæ‰‹åŠ¨å‘ç‰ˆæµ‹è¯•çš„ç—›è‹¦ç›¸ä¿¡ç»å†è¿‡çš„éƒ½æœ‰ä½“ä¼šã€‚ è¿™æ¬¡å¹¶æ²¡æœ‰ç²¾åŠ›å»æ­å»ºå®Œæ•´çš„ CI CDï¼Œåªæ˜¯å†™äº†ä¸€ä¸ªç®€å•çš„è„šæœ¬å®ç°äº†è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œå¸Œæœ›å¯¹è¿™æ–¹é¢æ²¡æœ‰ç»éªŒçš„åŒå­¦å¸¦æ¥ä¸€ç‚¹å¯å‘ï¼š æ„å»º web12345678910111213141516171819202122232425262728293031323334353637383940414243#!/bin/bash# æ„å»º web æ¶ˆè´¹è€…#read appnameappname=&quot;consumer&quot;echo &quot;input=&quot;$appnamePID=$(ps -ef | grep $appname | grep -v grep | awk &apos;&#123;print $2&#125;&apos;)# éå†æ€æ‰ pidfor var in $&#123;PID[@]&#125;;do echo &quot;loop pid= $var&quot; kill -9 $vardoneecho &quot;kill $appname success&quot;cd ..git pullcd SSM-SECONDS-KILLmvn -Dmaven.test.skip=true clean packageecho &quot;build war success&quot;cp /home/crossoverJie/SSM/SSM-SECONDS-KILL/SSM-SECONDS-KILL-WEB/target/SSM-SECONDS-KILL-WEB-2.2.0-SNAPSHOT.war /home/crossoverJie/tomcat/tomcat-dubbo-consumer-8083/webappsecho &quot;cp tomcat-dubbo-consumer-8083/webapps ok!&quot;cp /home/crossoverJie/SSM/SSM-SECONDS-KILL/SSM-SECONDS-KILL-WEB/target/SSM-SECONDS-KILL-WEB-2.2.0-SNAPSHOT.war /home/crossoverJie/tomcat/tomcat-dubbo-consumer-7083-slave/webappsecho &quot;cp tomcat-dubbo-consumer-7083-slave/webapps ok!&quot;sh /home/crossoverJie/tomcat/tomcat-dubbo-consumer-8083/bin/startup.shecho &quot;tomcat-dubbo-consumer-8083/bin/startup.sh success&quot;sh /home/crossoverJie/tomcat/tomcat-dubbo-consumer-7083-slave/bin/startup.shecho &quot;tomcat-dubbo-consumer-7083-slave/bin/startup.sh success&quot;echo &quot;start $appname success&quot; æ„å»º Service1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253# æ„å»ºæœåŠ¡æä¾›è€…#read appnameappname=&quot;provider&quot;echo &quot;input=&quot;$appnamePID=$(ps -ef | grep $appname | grep -v grep | awk &apos;&#123;print $2&#125;&apos;)#if [ $? -eq 0 ]; then# echo &quot;process id:$PID&quot;#else# echo &quot;process $appname not exit&quot;# exit#fi# éå†æ€æ‰ pidfor var in $&#123;PID[@]&#125;;do echo &quot;loop pid= $var&quot; kill -9 $vardoneecho &quot;kill $appname success&quot;cd ..git pullcd SSM-SECONDS-KILLmvn -Dmaven.test.skip=true clean packageecho &quot;build war success&quot;cp /home/crossoverJie/SSM/SSM-SECONDS-KILL/SSM-SECONDS-KILL-SERVICE/target/SSM-SECONDS-KILL-SERVICE-2.2.0-SNAPSHOT.war /home/crossoverJie/tomcat/tomcat-dubbo-provider-8080/webappsecho &quot;cp tomcat-dubbo-provider-8080/webapps ok!&quot;cp /home/crossoverJie/SSM/SSM-SECONDS-KILL/SSM-SECONDS-KILL-SERVICE/target/SSM-SECONDS-KILL-SERVICE-2.2.0-SNAPSHOT.war /home/crossoverJie/tomcat/tomcat-dubbo-provider-7080-slave/webappsecho &quot;cp tomcat-dubbo-provider-7080-slave/webapps ok!&quot;sh /home/crossoverJie/tomcat/tomcat-dubbo-provider-8080/bin/startup.shecho &quot;tomcat-dubbo-provider-8080/bin/startup.sh success&quot;sh /home/crossoverJie/tomcat/tomcat-dubbo-provider-7080-slave/bin/startup.shecho &quot;tomcat-dubbo-provider-8080/bin/startup.sh success&quot;echo &quot;start $appname success&quot; ä¹‹åæ¯å½“æˆ‘æœ‰æ›´æ–°ï¼Œåªéœ€è¦æ‰§è¡Œè¿™ä¸¤ä¸ªè„šæœ¬å°±å¯ä»¥å¸®æˆ‘è‡ªåŠ¨æ„å»ºã€‚ éƒ½æ˜¯æœ€åŸºç¡€çš„ Linux å‘½ä»¤ï¼Œç›¸ä¿¡å¤§å®¶éƒ½çœ‹å¾—æ˜ç™½ã€‚ ä¹è§‚é”æ›´æ–° + åˆ†å¸ƒå¼é™æµä¸Šæ–‡çš„ç»“æœçœ‹ä¼¼æ²¡æœ‰é—®é¢˜ï¼Œå…¶å®è¿˜å·®å¾—è¿œå‘¢ã€‚ è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿäº† 300 ä¸ªå¹¶å‘æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å½“è¯·æ±‚è¾¾åˆ°äº† 3000 ï¼Œ3Wï¼Œ300W å‘¢ï¼Ÿ è™½è¯´å¯ä»¥æ¨ªå‘æ‰©å±•å¯ä»¥æ”¯æ’‘æ›´å¤šçš„è¯·æ±‚ã€‚ ä½†æ˜¯èƒ½ä¸èƒ½åˆ©ç”¨æœ€å°‘çš„èµ„æºè§£å†³é—®é¢˜å‘¢ï¼Ÿ å…¶å®ä»”ç»†åˆ†æä¸‹ä¼šå‘ç°ï¼š å‡è®¾æˆ‘çš„å•†å“ä¸€å…±åªæœ‰ 10 ä¸ªåº“å­˜ï¼Œé‚£ä¹ˆæ— è®ºä½ å¤šå°‘äººæ¥ä¹°å…¶å®æœ€ç»ˆä¹Ÿæœ€å¤šåªæœ‰ 10 äººå¯ä»¥ä¸‹å•æˆåŠŸã€‚ æ‰€ä»¥å…¶ä¸­ä¼šæœ‰ 99% çš„è¯·æ±‚éƒ½æ˜¯æ— æ•ˆçš„ã€‚ å¤§å®¶éƒ½çŸ¥é“ï¼šå¤§å¤šæ•°åº”ç”¨æ•°æ®åº“éƒ½æ˜¯å‹å€’éª†é©¼çš„æœ€åä¸€æ ¹ç¨»è‰ã€‚ é€šè¿‡ Druid çš„ç›‘æ§æ¥çœ‹çœ‹ä¹‹å‰è¯·æ±‚æ•°æ®åº“çš„æƒ…å†µï¼š å› ä¸º Service æ˜¯ä¸¤ä¸ªåº”ç”¨ã€‚ æ•°æ®åº“ä¹Ÿæœ‰ 20 å¤šä¸ªè¿æ¥ã€‚ æ€ä¹ˆæ ·æ¥ä¼˜åŒ–å‘¢ï¼Ÿå…¶å®å¾ˆå®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯åˆ†å¸ƒå¼é™æµã€‚ æˆ‘ä»¬å°†å¹¶å‘æ§åˆ¶åœ¨ä¸€ä¸ªå¯æ§çš„èŒƒå›´ä¹‹å†…ï¼Œç„¶åå¿«é€Ÿå¤±è´¥è¿™æ ·å°±èƒ½æœ€å¤§ç¨‹åº¦çš„ä¿æŠ¤ç³»ç»Ÿã€‚ distributed-redis-tool â¬†ï¸v1.0.3ä¸ºæ­¤è¿˜å¯¹ https://github.com/crossoverJie/distributed-redis-tool è¿›è¡Œäº†å°å°çš„å‡çº§ã€‚ å› ä¸ºåŠ ä¸Šè¯¥ç»„ä»¶ä¹‹åæ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šç»è¿‡ Redisï¼Œæ‰€ä»¥å¯¹ Redis èµ„æºçš„ä½¿ç”¨ä¹Ÿæ˜¯è¦éå¸¸å°å¿ƒã€‚ API æ›´æ–°ä¿®æ”¹ä¹‹åçš„ API å¦‚ä¸‹ï¼š 123456789101112131415161718192021@Configurationpublic class RedisLimitConfig &#123; private Logger logger = LoggerFactory.getLogger(RedisLimitConfig.class); @Value("$&#123;redis.limit&#125;") private int limit; @Autowired private JedisConnectionFactory jedisConnectionFactory; @Bean public RedisLimit build() &#123; RedisLimit redisLimit = new RedisLimit.Builder(jedisConnectionFactory, RedisToolsConstant.SINGLE) .limit(limit) .build(); return redisLimit; &#125;&#125; è¿™é‡Œæ„å»ºå™¨æ”¹ç”¨äº† JedisConnectionFactoryï¼Œæ‰€ä»¥å¾—é…åˆ Spring æ¥ä¸€èµ·ä½¿ç”¨ã€‚ å¹¶åœ¨åˆå§‹åŒ–æ—¶æ˜¾ç¤ºä¼ å…¥ Redis æ˜¯ä»¥é›†ç¾¤æ–¹å¼éƒ¨ç½²è¿˜æ˜¯å•æœºï¼ˆå¼ºçƒˆå»ºè®®é›†ç¾¤ï¼Œé™æµä¹‹åå¯¹ Redis è¿˜æ˜¯æœ‰ä¸€å®šçš„å‹åŠ›ï¼‰ã€‚ é™æµå®ç°æ—¢ç„¶ API æ›´æ–°äº†ï¼Œå®ç°è‡ªç„¶ä¹Ÿè¦ä¿®æ”¹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546/** * limit traffic * @return if true */public boolean limit() &#123; //get connection Object connection = getConnection(); Object result = limitRequest(connection); if (FAIL_CODE != (Long) result) &#123; return true; &#125; else &#123; return false; &#125;&#125;private Object limitRequest(Object connection) &#123; Object result = null; String key = String.valueOf(System.currentTimeMillis() / 1000); if (connection instanceof Jedis)&#123; result = ((Jedis)connection).eval(script, Collections.singletonList(key), Collections.singletonList(String.valueOf(limit))); ((Jedis) connection).close(); &#125;else &#123; result = ((JedisCluster) connection).eval(script, Collections.singletonList(key), Collections.singletonList(String.valueOf(limit))); try &#123; ((JedisCluster) connection).close(); &#125; catch (IOException e) &#123; logger.error("IOException",e); &#125; &#125; return result;&#125;private Object getConnection() &#123; Object connection ; if (type == RedisToolsConstant.SINGLE)&#123; RedisConnection redisConnection = jedisConnectionFactory.getConnection(); connection = redisConnection.getNativeConnection(); &#125;else &#123; RedisClusterConnection clusterConnection = jedisConnectionFactory.getClusterConnection(); connection = clusterConnection.getNativeConnection() ; &#125; return connection;&#125; å¦‚æœæ˜¯åŸç”Ÿçš„ Spring åº”ç”¨å¾—é‡‡ç”¨ @SpringControllerLimit(errorCode = 200) æ³¨è§£ã€‚ å®é™…ä½¿ç”¨å¦‚ä¸‹ï¼š web ç«¯ï¼š 123456789101112131415161718/** * ä¹è§‚é”æ›´æ–°åº“å­˜ é™æµ * @param sid * @return */@SpringControllerLimit(errorCode = 200)@RequestMapping("/createOptimisticLimitOrder/&#123;sid&#125;")@ResponseBodypublic String createOptimisticLimitOrder(@PathVariable int sid) &#123; logger.info("sid=[&#123;&#125;]", sid); int id = 0; try &#123; id = orderService.createOptimisticOrder(sid); &#125; catch (Exception e) &#123; logger.error("Exception",e); &#125; return String.valueOf(id);&#125; Service ç«¯å°±æ²¡ä»€ä¹ˆæ›´æ–°äº†ï¼Œä¾ç„¶æ˜¯é‡‡ç”¨çš„ä¹è§‚é”æ›´æ–°æ•°æ®åº“ã€‚ å†å‹æµ‹çœ‹ä¸‹æ•ˆæœ /createOptimisticLimitOrderByRedis/1ï¼š é¦–å…ˆæ˜¯çœ‹ç»“æœæ²¡æœ‰é—®é¢˜ï¼Œå†çœ‹æ•°æ®åº“è¿æ¥ä»¥åŠå¹¶å‘è¯·æ±‚æ•°éƒ½æœ‰æ˜æ˜¾çš„ä¸‹é™ã€‚ ä¹è§‚é”æ›´æ–° + åˆ†å¸ƒå¼é™æµ + Redis ç¼“å­˜å…¶å®ä»”ç»†è§‚å¯Ÿ Druid ç›‘æ§æ•°æ®å‘ç°è¿™ä¸ª SQL è¢«å¤šæ¬¡æŸ¥è¯¢ï¼š å…¶å®è¿™æ˜¯å®æ—¶æŸ¥è¯¢åº“å­˜çš„ SQLï¼Œä¸»è¦æ˜¯ä¸ºäº†åœ¨æ¯æ¬¡ä¸‹å•ä¹‹å‰åˆ¤æ–­æ˜¯å¦è¿˜æœ‰åº“å­˜ã€‚ è¿™ä¹Ÿæ˜¯ä¸ªä¼˜åŒ–ç‚¹ã€‚ è¿™ç§æ•°æ®æˆ‘ä»¬å®Œå…¨å¯ä»¥æ”¾åœ¨å†…å­˜ä¸­ï¼Œæ•ˆç‡æ¯”åœ¨æ•°æ®åº“è¦é«˜å¾ˆå¤šã€‚ ç”±äºæˆ‘ä»¬çš„åº”ç”¨æ˜¯åˆ†å¸ƒå¼çš„ï¼Œæ‰€ä»¥å †å†…ç¼“å­˜æ˜¾ç„¶ä¸åˆé€‚ï¼ŒRedis å°±éå¸¸é€‚åˆã€‚ è¿™æ¬¡ä¸»è¦æ”¹é€ çš„æ˜¯ Service å±‚ï¼š æ¯æ¬¡æŸ¥è¯¢åº“å­˜æ—¶èµ° Redisã€‚ æ‰£åº“å­˜æ—¶æ›´æ–° Redisã€‚ éœ€è¦æå‰å°†åº“å­˜ä¿¡æ¯å†™å…¥ Redisï¼ˆæ‰‹åŠ¨æˆ–è€…ç¨‹åºè‡ªåŠ¨éƒ½å¯ä»¥ï¼‰ã€‚ ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344@Overridepublic int createOptimisticOrderUseRedis(int sid) throws Exception &#123; //æ£€éªŒåº“å­˜ï¼Œä» Redis è·å– Stock stock = checkStockByRedis(sid); //ä¹è§‚é”æ›´æ–°åº“å­˜ ä»¥åŠæ›´æ–° Redis saleStockOptimisticByRedis(stock); //åˆ›å»ºè®¢å• int id = createOrder(stock); return id ;&#125;private Stock checkStockByRedis(int sid) throws Exception &#123; Integer count = Integer.parseInt(redisTemplate.opsForValue().get(RedisKeysConstant.STOCK_COUNT + sid)); Integer sale = Integer.parseInt(redisTemplate.opsForValue().get(RedisKeysConstant.STOCK_SALE + sid)); if (count.equals(sale))&#123; throw new RuntimeException("åº“å­˜ä¸è¶³ Redis currentCount=" + sale); &#125; Integer version = Integer.parseInt(redisTemplate.opsForValue().get(RedisKeysConstant.STOCK_VERSION + sid)); Stock stock = new Stock() ; stock.setId(sid); stock.setCount(count); stock.setSale(sale); stock.setVersion(version); return stock;&#125; /** * ä¹è§‚é”æ›´æ–°æ•°æ®åº“ è¿˜è¦æ›´æ–° Redis * @param stock */private void saleStockOptimisticByRedis(Stock stock) &#123; int count = stockService.updateStockByOptimistic(stock); if (count == 0)&#123; throw new RuntimeException("å¹¶å‘æ›´æ–°åº“å­˜å¤±è´¥") ; &#125; //è‡ªå¢ redisTemplate.opsForValue().increment(RedisKeysConstant.STOCK_SALE + stock.getId(),1) ; redisTemplate.opsForValue().increment(RedisKeysConstant.STOCK_VERSION + stock.getId(),1) ;&#125; å‹æµ‹çœ‹çœ‹å®é™…æ•ˆæœ /createOptimisticLimitOrderByRedis/1ï¼š æœ€åå‘ç°æ•°æ®æ²¡é—®é¢˜ï¼Œæ•°æ®åº“çš„è¯·æ±‚ä¸å¹¶å‘ä¹Ÿéƒ½ä¸‹æ¥äº†ã€‚ ä¹è§‚é”æ›´æ–° + åˆ†å¸ƒå¼é™æµ + Redis ç¼“å­˜ + Kafka å¼‚æ­¥æœ€åçš„ä¼˜åŒ–è¿˜æ˜¯æƒ³å¦‚ä½•æ¥å†æ¬¡æé«˜ååé‡ä»¥åŠæ€§èƒ½çš„ã€‚ æˆ‘ä»¬ä¸Šæ–‡æ‰€æœ‰ä¾‹å­å…¶å®éƒ½æ˜¯åŒæ­¥è¯·æ±‚ï¼Œå®Œå…¨å¯ä»¥åˆ©ç”¨åŒæ­¥è½¬å¼‚æ­¥æ¥æé«˜æ€§èƒ½å•Šã€‚ è¿™é‡Œæˆ‘ä»¬å°†å†™è®¢å•ä»¥åŠæ›´æ–°åº“å­˜çš„æ“ä½œè¿›è¡Œå¼‚æ­¥åŒ–ï¼Œåˆ©ç”¨ Kafka æ¥è¿›è¡Œè§£è€¦å’Œé˜Ÿåˆ—çš„ä½œç”¨ã€‚ æ¯å½“ä¸€ä¸ªè¯·æ±‚é€šè¿‡äº†é™æµåˆ°è¾¾äº† Service å±‚é€šè¿‡äº†åº“å­˜æ ¡éªŒä¹‹åå°±å°†è®¢å•ä¿¡æ¯å‘ç»™ Kafka ï¼Œè¿™æ ·ä¸€ä¸ªè¯·æ±‚å°±å¯ä»¥ç›´æ¥è¿”å›äº†ã€‚ æ¶ˆè´¹ç¨‹åºå†å¯¹æ•°æ®è¿›è¡Œå…¥åº“è½åœ°ã€‚ å› ä¸ºå¼‚æ­¥äº†ï¼Œæ‰€ä»¥æœ€ç»ˆéœ€è¦é‡‡å–å›è°ƒæˆ–è€…æ˜¯å…¶ä»–æé†’çš„æ–¹å¼æé†’ç”¨æˆ·è´­ä¹°å®Œæˆã€‚ è¿™é‡Œä»£ç è¾ƒå¤šå°±ä¸è´´äº†ï¼Œæ¶ˆè´¹ç¨‹åºå…¶å®å°±æ˜¯æŠŠä¹‹å‰çš„ Service å±‚çš„é€»è¾‘é‡å†™äº†ä¸€éï¼Œä¸è¿‡é‡‡ç”¨çš„æ˜¯ SpringBootã€‚ æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥çœ‹ä¸‹ã€‚ https://github.com/crossoverJie/SSM/tree/master/SSM-SECONDS-KILL/SSM-SECONDS-KILL-ORDER-CONSUMER æ€»ç»“å…¶å®ç»è¿‡ä¸Šé¢çš„ä¸€é¡¿ä¼˜åŒ–æ€»ç»“èµ·æ¥æ— éå°±æ˜¯ä»¥ä¸‹å‡ ç‚¹ï¼š å°½é‡å°†è¯·æ±‚æ‹¦æˆªåœ¨ä¸Šæ¸¸ã€‚ è¿˜å¯ä»¥æ ¹æ® UID è¿›è¡Œé™æµã€‚ æœ€å¤§ç¨‹åº¦çš„å‡å°‘è¯·æ±‚è½åˆ° DBã€‚ å¤šåˆ©ç”¨ç¼“å­˜ã€‚ åŒæ­¥æ“ä½œå¼‚æ­¥åŒ–ã€‚ fail fastï¼Œå°½æ—©å¤±è´¥ï¼Œä¿æŠ¤åº”ç”¨ã€‚ ç å­—ä¸æ˜“ï¼Œè¿™åº”è¯¥æ˜¯æˆ‘å†™è¿‡å­—æ•°æœ€å¤šçš„äº†ï¼Œæƒ³æƒ³å½“å¹´é«˜ä¸­ 800 å­—çš„ä½œæ–‡éƒ½æ†‹ä¸å‡ºæ¥ğŸ˜‚ï¼Œå¯æƒ³è€ŒçŸ¥æ˜¯æœ‰å¤šéš¾å¾—äº†ã€‚ ä»¥ä¸Šå†…å®¹æ¬¢è¿è®¨è®ºã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>SSM</category>
        <category>Distributed Tools</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Kafka</tag>
        <tag>Redis</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[sbc(ä¸ƒ)åˆ†å¸ƒå¼é™æµ]]></title>
    <url>%2F2018%2F04%2F28%2Fsbc%2Fsbc7-Distributed-Limit%2F</url>
    <content type="text"><![CDATA[å‰è¨€æœ¬æ–‡æ¥ç€ä¸Šæ–‡åº”ç”¨é™æµè¿›è¡Œè®¨è®ºã€‚ ä¹‹å‰è°ˆåˆ°çš„é™æµæ–¹æ¡ˆåªèƒ½é’ˆå¯¹äºå•ä¸ª JVM æœ‰æ•ˆï¼Œä¹Ÿå°±æ˜¯å•æœºåº”ç”¨ã€‚è€Œå¯¹äºç°åœ¨æ™®éçš„åˆ†å¸ƒå¼åº”ç”¨ä¹Ÿå¾—æœ‰ä¸€ä¸ªåˆ†å¸ƒå¼é™æµçš„æ–¹æ¡ˆã€‚ åŸºäºæ­¤å°è¯•å†™äº†è¿™ä¸ªç»„ä»¶ï¼š https://github.com/crossoverJie/distributed-redis-tool DEMOä»¥ä¸‹é‡‡ç”¨çš„æ˜¯ https://github.com/crossoverJie/springboot-cloud æ¥åšæ¼”ç¤ºã€‚ åœ¨ Order åº”ç”¨æä¾›çš„æ¥å£ä¸­é‡‡å–äº†é™æµã€‚é¦–å…ˆæ˜¯é…ç½®äº†é™æµå·¥å…·çš„ Bean: 12345678910111213141516171819202122@Configurationpublic class RedisLimitConfig &#123; @Value("$&#123;redis.limit&#125;") private int limit; @Autowired private JedisConnectionFactory jedisConnectionFactory; @Bean public RedisLimit build() &#123; RedisClusterConnection clusterConnection = jedisConnectionFactory.getClusterConnection(); JedisCluster jedisCluster = (JedisCluster) clusterConnection.getNativeConnection(); RedisLimit redisLimit = new RedisLimit.Builder&lt;&gt;(jedisCluster) .limit(limit) .build(); return redisLimit; &#125;&#125; æ¥ç€åœ¨ Controller ä½¿ç”¨ç»„ä»¶ï¼š 123456789101112131415161718192021222324252627@Autowiredprivate RedisLimit redisLimit ;@Override@CheckReqNopublic BaseResponse&lt;OrderNoResVO&gt; getOrderNo(@RequestBody OrderNoReqVO orderNoReq) &#123; BaseResponse&lt;OrderNoResVO&gt; res = new BaseResponse(); //é™æµ boolean limit = redisLimit.limit(); if (!limit)&#123; res.setCode(StatusEnum.REQUEST_LIMIT.getCode()); res.setMessage(StatusEnum.REQUEST_LIMIT.getMessage()); return res ; &#125; res.setReqNo(orderNoReq.getReqNo()); if (null == orderNoReq.getAppId())&#123; throw new SBCException(StatusEnum.FAIL); &#125; OrderNoResVO orderNoRes = new OrderNoResVO() ; orderNoRes.setOrderId(DateUtil.getLongTime()); res.setCode(StatusEnum.SUCCESS.getCode()); res.setMessage(StatusEnum.SUCCESS.getMessage()); res.setDataBody(orderNoRes); return res ;&#125; ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œä¹Ÿæä¾›äº†æ³¨è§£: 1234567@Override@ControllerLimitpublic BaseResponse&lt;OrderNoResVO&gt; getOrderNoLimit(@RequestBody OrderNoReqVO orderNoReq) &#123; BaseResponse&lt;OrderNoResVO&gt; res = new BaseResponse(); // ä¸šåŠ¡é€»è¾‘ return res ;&#125; è¯¥æ³¨è§£æ‹¦æˆªäº† http è¯·æ±‚ï¼Œä¼šå†è¯·æ±‚è¾¾åˆ°é˜ˆå€¼æ—¶ç›´æ¥è¿”å›ã€‚ æ™®é€šæ–¹æ³•ä¹Ÿå¯ä½¿ç”¨: 12@CommonLimitpublic void doSomething()&#123;&#125; ä¼šåœ¨è°ƒç”¨è¾¾åˆ°é˜ˆå€¼æ—¶æŠ›å‡ºå¼‚å¸¸ã€‚ ä¸ºäº†æ¨¡æ‹Ÿå¹¶å‘ï¼Œåœ¨ User åº”ç”¨ä¸­å¼€å¯äº† 10 ä¸ªçº¿ç¨‹è°ƒç”¨ Order(é™æµæ¬¡æ•°ä¸º5) æ¥å£(ä¹Ÿå¯ä½¿ç”¨ä¸“ä¸šçš„å¹¶å‘æµ‹è¯•å·¥å…· JMeter ç­‰)ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041@Overridepublic BaseResponse&lt;UserResVO&gt; getUserByFeign(@RequestBody UserReqVO userReq) &#123; //è°ƒç”¨è¿œç¨‹æœåŠ¡ OrderNoReqVO vo = new OrderNoReqVO(); vo.setAppId(1L); vo.setReqNo(userReq.getReqNo()); for (int i = 0; i &lt; 10; i++) &#123; executorService.execute(new Worker(vo, orderServiceClient)); &#125; UserRes userRes = new UserRes(); userRes.setUserId(123); userRes.setUserName("å¼ ä¸‰"); userRes.setReqNo(userReq.getReqNo()); userRes.setCode(StatusEnum.SUCCESS.getCode()); userRes.setMessage("æˆåŠŸ"); return userRes;&#125;private static class Worker implements Runnable &#123; private OrderNoReqVO vo; private OrderServiceClient orderServiceClient; public Worker(OrderNoReqVO vo, OrderServiceClient orderServiceClient) &#123; this.vo = vo; this.orderServiceClient = orderServiceClient; &#125; @Override public void run() &#123; BaseResponse&lt;OrderNoResVO&gt; orderNo = orderServiceClient.getOrderNoCommonLimit(vo); logger.info("è¿œç¨‹è¿”å›:" + JSON.toJSONString(orderNo)); &#125;&#125; ä¸ºäº†éªŒè¯åˆ†å¸ƒå¼æ•ˆæœå¯åŠ¨äº†ä¸¤ä¸ª Order åº”ç”¨ã€‚ æ•ˆæœå¦‚ä¸‹ï¼š å®ç°åŸç†å®ç°åŸç†å…¶å®å¾ˆç®€å•ã€‚æ—¢ç„¶è¦è¾¾åˆ°åˆ†å¸ƒå¼å…¨å±€é™æµçš„æ•ˆæœï¼Œé‚£è‡ªç„¶éœ€è¦ä¸€ä¸ªç¬¬ä¸‰æ–¹ç»„ä»¶æ¥è®°å½•è¯·æ±‚çš„æ¬¡æ•°ã€‚ å…¶ä¸­ Redis å°±éå¸¸é€‚åˆè¿™æ ·çš„åœºæ™¯ã€‚ æ¯æ¬¡è¯·æ±‚æ—¶å°†å½“å‰æ—¶é—´(ç²¾ç¡®åˆ°ç§’)ä½œä¸º Key å†™å…¥åˆ° Redis ä¸­ï¼Œè¶…æ—¶æ—¶é—´è®¾ç½®ä¸º 2 ç§’ï¼ŒRedis å°†è¯¥ Key çš„å€¼è¿›è¡Œè‡ªå¢ã€‚ å½“è¾¾åˆ°é˜ˆå€¼æ—¶è¿”å›é”™è¯¯ã€‚ å†™å…¥ Redis çš„æ“ä½œç”¨ Lua è„šæœ¬æ¥å®Œæˆï¼Œåˆ©ç”¨ Redis çš„å•çº¿ç¨‹æœºåˆ¶å¯ä»¥ä¿è¯æ¯ä¸ª Redis è¯·æ±‚çš„åŸå­æ€§ã€‚ Lua è„šæœ¬å¦‚ä¸‹: 123456789101112131415161718--lua ä¸‹æ ‡ä» 1 å¼€å§‹-- é™æµ keylocal key = KEYS[1]-- é™æµå¤§å°local limit = tonumber(ARGV[1])-- è·å–å½“å‰æµé‡å¤§å°local curentLimit = tonumber(redis.call('get', key) or "0")if curentLimit + 1 &gt; limit then -- è¾¾åˆ°é™æµå¤§å° è¿”å› return 0;else -- æ²¡æœ‰è¾¾åˆ°é˜ˆå€¼ value + 1 redis.call("INCRBY", key, 1) redis.call("EXPIRE", key, 2) return curentLimit + 1end Java ä¸­çš„è°ƒç”¨é€»è¾‘: 123456789101112131415161718public boolean limit() &#123; String key = String.valueOf(System.currentTimeMillis() / 1000); Object result = null; if (jedis instanceof Jedis) &#123; result = ((Jedis) this.jedis).eval(script, Collections.singletonList(key), Collections.singletonList(String.valueOf(limit))); &#125; else if (jedis instanceof JedisCluster) &#123; result = ((JedisCluster) this.jedis).eval(script, Collections.singletonList(key), Collections.singletonList(String.valueOf(limit))); &#125; else &#123; //throw new RuntimeException("instance is error") ; return false; &#125; if (FAIL_CODE != (Long) result) &#123; return true; &#125; else &#123; return false; &#125;&#125; æ‰€ä»¥åªéœ€è¦åœ¨éœ€è¦é™æµçš„åœ°æ–¹è°ƒç”¨è¯¥æ–¹æ³•å¯¹è¿”å›å€¼è¿›è¡Œåˆ¤æ–­å³å¯è¾¾åˆ°é™æµçš„ç›®çš„ã€‚ å½“ç„¶è¿™åªæ˜¯åˆ©ç”¨ Redis åšäº†ä¸€ä¸ªç²—æš´çš„è®¡æ•°å™¨ï¼Œå¦‚æœæƒ³å®ç°ç±»ä¼¼äºä¸Šæ–‡ä¸­çš„ä»¤ç‰Œæ¡¶ç®—æ³•å¯ä»¥åŸºäº Lua è‡ªè¡Œå®ç°ã€‚ Builder æ„å»ºå™¨åœ¨è®¾è®¡è¿™ä¸ªç»„ä»¶æ—¶æƒ³å°½é‡çš„æä¾›ç»™ä½¿ç”¨è€…æ¸…æ™°ã€å¯è¯»æ€§ã€ä¸æ˜“å‡ºé”™çš„ APIã€‚ æ¯”å¦‚ç¬¬ä¸€æ­¥ï¼Œå¦‚ä½•æ„å»ºä¸€ä¸ªé™æµå¯¹è±¡ã€‚ æœ€å¸¸ç”¨çš„æ–¹å¼è‡ªç„¶å°±æ˜¯æ„é€ å‡½æ•°ï¼Œå¦‚æœæœ‰å¤šä¸ªåŸŸåˆ™å¯ä»¥é‡‡ç”¨é‡å æ„é€ å™¨çš„æ–¹å¼: 123public A()&#123;&#125;public A(int a)&#123;&#125;public A(int a,int b)&#123;&#125; ç¼ºç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼šå¦‚æœå‚æ•°è¿‡å¤šä¼šå¯¼è‡´éš¾ä»¥é˜…è¯»ï¼Œç”šè‡³å¦‚æœå‚æ•°ç±»å‹ä¸€è‡´çš„æƒ…å†µä¸‹å®¢æˆ·ç«¯é¢ å€’äº†é¡ºåºï¼Œä½†ä¸ä¼šå¼•èµ·è­¦å‘Šä»è€Œå‡ºç°éš¾ä»¥é¢„æµ‹çš„ç»“æœã€‚ ç¬¬äºŒç§æ–¹æ¡ˆå¯ä»¥é‡‡ç”¨ JavaBean æ¨¡å¼ï¼Œåˆ©ç”¨ setter æ–¹æ³•è¿›è¡Œæ„å»º: 123A a = new A();a.setA(a);a.setB(b); è¿™ç§æ–¹å¼æ¸…æ™°æ˜“è¯»ï¼Œä½†å´å®¹æ˜“è®©å¯¹è±¡å¤„äºä¸ä¸€è‡´çš„çŠ¶æ€ï¼Œä½¿å¯¹è±¡å¤„äºçº¿ç¨‹ä¸å®‰å…¨çš„çŠ¶æ€ã€‚ æ‰€ä»¥è¿™é‡Œé‡‡ç”¨äº†ç¬¬ä¸‰ç§åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œæ„å»ºå™¨ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576public class RedisLimit &#123; private JedisCommands jedis; private int limit = 200; private static final int FAIL_CODE = 0; /** * lua script */ private String script; private RedisLimit(Builder builder) &#123; this.limit = builder.limit ; this.jedis = builder.jedis ; buildScript(); &#125; /** * limit traffic * @return if true */ public boolean limit() &#123; String key = String.valueOf(System.currentTimeMillis() / 1000); Object result = null; if (jedis instanceof Jedis) &#123; result = ((Jedis) this.jedis).eval(script, Collections.singletonList(key), Collections.singletonList(String.valueOf(limit))); &#125; else if (jedis instanceof JedisCluster) &#123; result = ((JedisCluster) this.jedis).eval(script, Collections.singletonList(key), Collections.singletonList(String.valueOf(limit))); &#125; else &#123; //throw new RuntimeException("instance is error") ; return false; &#125; if (FAIL_CODE != (Long) result) &#123; return true; &#125; else &#123; return false; &#125; &#125; /** * read lua script */ private void buildScript() &#123; script = ScriptUtil.getScript("limit.lua"); &#125; /** * the builder * @param &lt;T&gt; */ public static class Builder&lt;T extends JedisCommands&gt;&#123; private T jedis = null ; private int limit = 200; public Builder(T jedis)&#123; this.jedis = jedis ; &#125; public Builder limit(int limit)&#123; this.limit = limit ; return this; &#125; public RedisLimit build()&#123; return new RedisLimit(this) ; &#125; &#125;&#125; è¿™æ ·å®¢æˆ·ç«¯åœ¨ä½¿ç”¨æ—¶: 123RedisLimit redisLimit = new RedisLimit.Builder&lt;&gt;(jedisCluster) .limit(limit) .build(); æ›´åŠ çš„ç®€å•ç›´æ¥ï¼Œå¹¶ä¸”é¿å…äº†å°†åˆ›å»ºè¿‡ç¨‹åˆ†æˆäº†å¤šä¸ªå­æ­¥éª¤ã€‚ è¿™åœ¨æœ‰å¤šä¸ªæ„é€ å‚æ•°ï¼Œä½†åˆä¸æ˜¯å¿…é€‰å­—æ®µæ—¶å¾ˆæœ‰ä½œç”¨ã€‚ å› æ­¤é¡ºä¾¿å°†åˆ†å¸ƒå¼é”çš„æ„å»ºå™¨æ–¹å¼ä¹Ÿä¸€å¹¶æ›´æ–°äº†ï¼š https://github.com/crossoverJie/distributed-redis-tool#features æ›´å¤šå†…å®¹å¯ä»¥å‚è€ƒ Effective Java APIä»ä¸Šæ–‡å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨è¿‡ç¨‹å°±æ˜¯è°ƒç”¨ limit æ–¹æ³•ã€‚ 12345//é™æµ boolean limit = redisLimit.limit(); if (!limit)&#123; //å…·ä½“é™æµé€»è¾‘ &#125; ä¸ºäº†å‡å°‘ä¾µå…¥æ€§ï¼Œä¹Ÿä¸ºäº†ç®€åŒ–å®¢æˆ·ç«¯æä¾›äº†ä¸¤ç§æ³¨è§£æ–¹å¼ã€‚ @ControllerLimitè¯¥æ³¨è§£å¯ä»¥ä½œç”¨äº @RequestMapping ä¿®é¥°çš„æ¥å£ä¸­ï¼Œå¹¶ä¼šåœ¨é™æµåæä¾›é™æµå“åº”ã€‚ å®ç°å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849@Componentpublic class WebIntercept extends WebMvcConfigurerAdapter &#123; private static Logger logger = LoggerFactory.getLogger(WebIntercept.class); @Autowired private RedisLimit redisLimit; @Override public void addInterceptors(InterceptorRegistry registry) &#123; registry.addInterceptor(new CustomInterceptor()) .addPathPatterns("/**"); &#125; private class CustomInterceptor extends HandlerInterceptorAdapter &#123; @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; if (redisLimit == null) &#123; throw new NullPointerException("redisLimit is null"); &#125; if (handler instanceof HandlerMethod) &#123; HandlerMethod method = (HandlerMethod) handler; ControllerLimit annotation = method.getMethodAnnotation(ControllerLimit.class); if (annotation == null) &#123; //skip return true; &#125; boolean limit = redisLimit.limit(); if (!limit) &#123; logger.warn("request has bean limit"); response.sendError(500, "request limit"); return false; &#125; &#125; return true; &#125; &#125;&#125; å…¶å®å°±æ˜¯å®ç°äº† SpringMVC ä¸­çš„æ‹¦æˆªå™¨ï¼Œå¹¶åœ¨æ‹¦æˆªè¿‡ç¨‹ä¸­åˆ¤æ–­æ˜¯å¦æœ‰ä½¿ç”¨æ³¨è§£ï¼Œä»è€Œè°ƒç”¨é™æµé€»è¾‘ã€‚ å‰ææ˜¯åº”ç”¨éœ€è¦æ‰«æåˆ°è¯¥ç±»ï¼Œè®© Spring è¿›è¡Œç®¡ç†ã€‚ 1@ComponentScan(value = "com.crossoverjie.distributed.intercept") @CommonLimitå½“ç„¶ä¹Ÿå¯ä»¥åœ¨æ™®é€šæ–¹æ³•ä¸­ä½¿ç”¨ã€‚å®ç°åŸç†åˆ™æ˜¯ Spring AOP (SpringMVC çš„æ‹¦æˆªå™¨æœ¬è´¨ä¹Ÿæ˜¯ AOP)ã€‚ 12345678910111213141516171819202122232425262728@Aspect@Component@EnableAspectJAutoProxy(proxyTargetClass = true)public class CommonAspect &#123; private static Logger logger = LoggerFactory.getLogger(CommonAspect.class); @Autowired private RedisLimit redisLimit ; @Pointcut("@annotation(com.crossoverjie.distributed.annotation.CommonLimit)") private void check()&#123;&#125; @Before("check()") public void before(JoinPoint joinPoint) throws Exception &#123; if (redisLimit == null) &#123; throw new NullPointerException("redisLimit is null"); &#125; boolean limit = redisLimit.limit(); if (!limit) &#123; logger.warn("request has bean limit"); throw new RuntimeException("request has bean limit") ; &#125; &#125;&#125; å¾ˆç®€å•ï¼Œä¹Ÿæ˜¯åœ¨æ‹¦æˆªè¿‡ç¨‹ä¸­è°ƒç”¨é™æµã€‚ å½“ç„¶ä½¿ç”¨æ—¶ä¹Ÿå¾—æ‰«æåˆ°è¯¥åŒ…: 1@ComponentScan(value = "com.crossoverjie.distributed.intercept") æ€»ç»“é™æµåœ¨ä¸€ä¸ªé«˜å¹¶å‘å¤§æµé‡çš„ç³»ç»Ÿä¸­æ˜¯ä¿æŠ¤åº”ç”¨çš„ä¸€ä¸ªåˆ©å™¨ï¼Œæˆç†Ÿçš„æ–¹æ¡ˆä¹Ÿå¾ˆå¤šï¼Œå¸Œæœ›å¯¹åˆšäº†è§£è¿™ä¸€å—çš„æœ‹å‹æä¾›ä¸€äº›æ€è·¯ã€‚ ä»¥ä¸Šæ‰€æœ‰çš„æºç ï¼š https://github.com/crossoverJie/distributed-redis-tool https://github.com/crossoverJie/springboot-cloud æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ç‚¹ä¸ª Star æˆ–æ˜¯æäº¤ PRã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>sbc</category>
        <category>Distributed Tools</category>
      </categories>
      <tags>
        <tag>Distributed Limited</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€è¯‘ã€‘å¯¹äºåˆå­¦è€…ä»€ä¹ˆæ˜¯æœ€å¥½çš„ç¼–ç¨‹è¯­è¨€ï¼Ÿ]]></title>
    <url>%2F2018%2F04%2F12%2Ftranslation%2Ftranslation-What%20Is%20The%20Best%20Programming%20Language%20to%20Start%2F</url>
    <content type="text"><![CDATA[åŸæ–‡é“¾æ¥Pythonï¼ŸJavaï¼ŸRubyï¼ŸJavaScriptï¼Ÿæœ‰éå¸¸å¤šçš„é€‰æ‹©ã€‚é€‰æ‹©ä¸€ç§ç¼–ç¨‹è¯­è¨€å¼€å§‹ä½ çš„ç¼–ç ä¹‹æ—…ä¸åº”è¯¥æ˜¯ä¸€ä»¶è‰°å·¨çš„ä»»åŠ¡ã€‚ äº‹å®ä¸Šï¼šä½ å°†è¦å­¦ä¹ çš„è¯­è¨€å¹¶ä¸æ˜¯ç‰¹åˆ«é‡è¦ï¼Œæ›´é‡è¦çš„æ˜¯å­¦ä¹ ç¼–ç¨‹çš„ç†å¿µã€‚å¯¹äºä»»ä½•ç¼–ç¨‹è¯­è¨€æ¥è¯´çŸ¥è¯†çš„å¯ä¼ é€’æ€§éƒ½æ˜¯è‡³å…³é‡è¦çš„ã€‚ æˆ‘å­¦ä¹ çš„ç¬¬ä¸€é—¨è¯­è¨€æ˜¯ Javaï¼Œå­¦ä¹ äº†å¾ªç¯ï¼Œwhile å¾ªç¯ï¼Œæ¡ä»¶ï¼Œå‡½æ•°ï¼Œé¢å‘å¯¹è±¡ç¼–ç¨‹å’Œè®¸å¤šç¼–ç¨‹ç†å¿µã€‚ ç„¶è€Œï¼Œé€‰æ‹©ä¸€é—¨èƒ½åœ¨ç¼–ç¨‹é¢†åŸŸè½»æ¾æ‰¾åˆ°å·¥ä½œçš„è¯­è¨€æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œæˆ‘è¿™é‡Œæœ‰ä¸€ä»½åˆ—è¡¨æ¨èç»™ä½ ï¼š PythonPython åœ¨ç¾å›½å¤§å­¦é‡Œæ˜¯æœ€å—æ¬¢è¿çš„å…¥é—¨å‹è¯­è¨€ã€‚ å°±åƒ JavaScript ä¸€æ ·ï¼ŒPython ä¹Ÿéå¸¸çµæ´»ï¼Œç°åœ¨è¢«ç”¨äºæ„å»ºç”Ÿç‰©ä¿¡æ¯å­¦çš„ web åº”ç”¨ã€‚æˆ‘å¼ºçƒˆæ¨èä½ å­¦ä¹  Pythonï¼Œå®ƒæ˜¯å¾ˆæ£’çš„å…¥é—¨é€‰æ‹©ã€‚ JavaJava æ˜¯ä¼ä¸šç¯å¢ƒä¸­ä½¿ç”¨æœ€å¤šçš„è¯­è¨€ï¼Œæ ¹æ® TIOBE ç»Ÿè®¡ Java é•¿å¹´å æ®ç¼–ç¨‹è¯­è¨€æ¦œé¦–ã€‚åŒæ—¶ Java æ˜¯å¼ºç±»å‹åœ°é™æ€è¯­è¨€ï¼Œå¯ä»¥æ›´å®¹æ˜“åœ°å»æè¿°ä¸€äº›ç¼–ç¨‹ç†å¿µã€‚ Java ä½œä¸ºæœ€å¸¸ä½¿ç”¨çš„è¯­è¨€ï¼Œä½ å¯ä»¥å¾ˆè½»æ¾åœ°åœ¨è¿™æ®µç¼–ç¨‹ä¹‹æ—…ä¸­æ‰¾åˆ° Java çš„ç›¸å…³è¯¾ç¨‹å’ŒæŒ‡å—æ¥è·å¾—å¸®åŠ©ã€‚ä½ è¿˜å¯ä»¥ä½¿ç”¨ Java æ„å»ºæœåŠ¡ç«¯åº”ç”¨ã€Android APP ç­‰åº”ç”¨ç¨‹åºã€‚ RubyRuby æ˜¯æˆ‘æœ€å–œæ¬¢çš„ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒç¼–å†™ç®€å•ï¼Œå®¹æ˜“ç†è§£å¹¶ä¸”ä½¿ç”¨é¡ºæ‰‹ã€‚ å°±åƒ JavaScript ä¸€æ ·ï¼Œå®ƒå­¦èµ·æ¥ç®€å•ä½†æ˜¯ä¸æ˜“æŒæ¡ã€‚Ruby åœ¨å¾ˆå¤šå…¬å¸ä¸­è¢«å¹¿æ³›åº”ç”¨ï¼Œæ¯”å¦‚ Airbnb, EBANX, Shopify, Twitter, GitHub ç­‰ç­‰ã€‚å®ƒè¿˜æœ‰ä¸€ä¸ªè¶…èµçš„ 7*24 å°æ—¶çš„åœ¨çº¿ç¤¾åŒºéšæ—¶æä¾›å¸®åŠ©ã€‚Ruby ä»¥ Ruby on Rails æ¡†æ¶è‘—ç§°ï¼Œå®ƒå¯ä»¥å¸®ä½ å¾ˆè½»æ¾çš„æ„å»ºæ•´ä¸ª web åº”ç”¨ã€‚ JavaScriptJavaScript æ˜¯æˆ‘ç”¨è¿‡çš„æœ€çµæ´»çš„è¯­è¨€ä¹‹ä¸€ã€‚ ä½ èƒ½ç”¨å®ƒæ„å»ºæ§åˆ¶å°ç¨‹åºï¼Œæ¡Œé¢è½¯ä»¶ï¼Œæ‰‹æœº APPï¼Œå‰ç«¯å¼€å‘ï¼Œåç«¯å¼€å‘ç­‰ç­‰ã€‚å®ƒæ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„ç¼–ç¨‹è¯­è¨€ï¼Œç®€å•æ˜“å­¦ä½†éš¾ä»¥æŒæ¡ã€‚ æˆ‘å»ºè®®ä½ å­¦ä¹ å¹¶æŒæ¡ JavaScript ï¼Œä½†ä¸æ˜¯ä½œä¸ºç¬¬ä¸€é—¨è¯­è¨€ã€‚ å¯¹äºåˆå­¦è€…æ¥è¯´ JavaScript å¾ˆéš¾è°ƒè¯•å¹¶ä¸”ä¸å®¹æ˜“å­¦ä¹ ç¼–ç¨‹ç†å¿µæ¯”å¦‚å¼‚æ­¥ï¼ŒåŸå‹ï¼Œé¢å‘å¯¹è±¡ç­‰ç­‰ã€‚ ä¸è¦çº ç»“è¯­è¨€ä½ éœ€è¦é€šè¿‡é€‰æ‹©ä¸€é—¨è¯­è¨€æ¥å­¦ä¹ ç¼–ç¨‹ç†å¿µï¼Œå½“ä½ å­¦å®Œä¹‹åä½ å°†èŠ±è´¹è¾ƒå°çš„å­¦ä¹ æ›²çº¿æ¥å­¦ä¹ ä»»ä½•å…¶ä»–çš„è¯­è¨€ã€‚ å¦‚æœä½ æƒ³è¦å­¦ä¹ å¦‚ä½•å­¦ä¹ ä¸€é—¨æ–°è¯­è¨€çš„è¯ï¼Œå¯ä»¥é˜…è¯»æˆ‘çš„æ–‡ç«  â€œHow to Learn a New Programming Language or Frameworkâ€ï¼Œå°†ä¼šéå¸¸æœ‰ç”¨ã€‚]]></content>
      <categories>
        <category>ç¿»è¯‘</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åŠ¨æ‰‹å®ç°ä¸€ä¸ª LRU cache]]></title>
    <url>%2F2018%2F04%2F07%2Falgorithm%2FLRU-cache%2F</url>
    <content type="text"><![CDATA[å‰è¨€LRU æ˜¯ Least Recently Used çš„ç®€å†™ï¼Œå­—é¢æ„æ€åˆ™æ˜¯æœ€è¿‘æœ€å°‘ä½¿ç”¨ã€‚ é€šå¸¸ç”¨äºç¼“å­˜çš„æ·˜æ±°ç­–ç•¥å®ç°ï¼Œç”±äºç¼“å­˜çš„å†…å­˜éå¸¸å®è´µï¼Œæ‰€ä»¥éœ€è¦æ ¹æ®æŸç§è§„åˆ™æ¥å‰”é™¤æ•°æ®ä¿è¯å†…å­˜ä¸è¢«æ’‘æ»¡ã€‚ å¦‚å¸¸ç”¨çš„ Redis å°±æœ‰ä»¥ä¸‹å‡ ç§ç­–ç•¥ï¼š ç­–ç•¥ æè¿° volatile-lru ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±° volatile-ttl ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±° volatile-random ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±° allkeys-lru ä»æ‰€æœ‰æ•°æ®é›†ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±° allkeys-random ä»æ‰€æœ‰æ•°æ®é›†ä¸­ä»»æ„é€‰æ‹©æ•°æ®è¿›è¡Œæ·˜æ±° no-envicition ç¦æ­¢é©±é€æ•°æ® æ‘˜æŠ„è‡ª:https://github.com/CyC2018/Interview-Notebook/blob/master/notes/Redis.md#%E5%8D%81%E4%B8%89%E6%95%B0%E6%8D%AE%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5 å®ç°ä¸€ä¹‹å‰ä¹Ÿæœ‰æ¥è§¦è¿‡ä¸€é“é¢è¯•é¢˜ï¼Œå¤§æ¦‚éœ€æ±‚æ˜¯ï¼š å®ç°ä¸€ä¸ª LRU ç¼“å­˜ï¼Œå½“ç¼“å­˜æ•°æ®è¾¾åˆ° N ä¹‹åéœ€è¦æ·˜æ±°æ‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®ã€‚ N å°æ—¶ä¹‹å†…æ²¡æœ‰è¢«è®¿é—®çš„æ•°æ®ä¹Ÿéœ€è¦æ·˜æ±°æ‰ã€‚ ä»¥ä¸‹æ˜¯æˆ‘çš„å®ç°ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323public class LRUAbstractMap extends java.util.AbstractMap &#123; private final static Logger LOGGER = LoggerFactory.getLogger(LRUAbstractMap.class); /** * æ£€æŸ¥æ˜¯å¦è¶…æœŸçº¿ç¨‹ */ private ExecutorService checkTimePool ; /** * map æœ€å¤§size */ private final static int MAX_SIZE = 1024 ; private final static ArrayBlockingQueue&lt;Node&gt; QUEUE = new ArrayBlockingQueue&lt;&gt;(MAX_SIZE) ; /** * é»˜è®¤å¤§å° */ private final static int DEFAULT_ARRAY_SIZE =1024 ; /** * æ•°ç»„é•¿åº¦ */ private int arraySize ; /** * æ•°ç»„ */ private Object[] arrays ; /** * åˆ¤æ–­æ˜¯å¦åœæ­¢ flag */ private volatile boolean flag = true ; /** * è¶…æ—¶æ—¶é—´ */ private final static Long EXPIRE_TIME = 60 * 60 * 1000L ; /** * æ•´ä¸ª Map çš„å¤§å° */ private volatile AtomicInteger size ; public LRUAbstractMap() &#123; arraySize = DEFAULT_ARRAY_SIZE; arrays = new Object[arraySize] ; //å¼€å¯ä¸€ä¸ªçº¿ç¨‹æ£€æŸ¥æœ€å…ˆæ”¾å…¥é˜Ÿåˆ—çš„å€¼æ˜¯å¦è¶…æœŸ executeCheckTime(); &#125; /** * å¼€å¯ä¸€ä¸ªçº¿ç¨‹æ£€æŸ¥æœ€å…ˆæ”¾å…¥é˜Ÿåˆ—çš„å€¼æ˜¯å¦è¶…æœŸ è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ */ private void executeCheckTime() &#123; ThreadFactory namedThreadFactory = new ThreadFactoryBuilder() .setNameFormat("check-thread-%d") .setDaemon(true) .build(); checkTimePool = new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new ArrayBlockingQueue&lt;&gt;(1),namedThreadFactory,new ThreadPoolExecutor.AbortPolicy()); checkTimePool.execute(new CheckTimeThread()) ; &#125; @Override public Set&lt;Entry&gt; entrySet() &#123; return super.keySet(); &#125; @Override public Object put(Object key, Object value) &#123; int hash = hash(key); int index = hash % arraySize ; Node currentNode = (Node) arrays[index] ; if (currentNode == null)&#123; arrays[index] = new Node(null,null, key, value); //å†™å…¥é˜Ÿåˆ— QUEUE.offer((Node) arrays[index]) ; sizeUp(); &#125;else &#123; Node cNode = currentNode ; Node nNode = cNode ; //å­˜åœ¨å°±è¦†ç›– if (nNode.key == key)&#123; cNode.val = value ; &#125; while (nNode.next != null)&#123; //key å­˜åœ¨ å°±è¦†ç›– ç®€å•åˆ¤æ–­ if (nNode.key == key)&#123; nNode.val = value ; break ; &#125;else &#123; //ä¸å­˜åœ¨å°±æ–°å¢é“¾è¡¨ sizeUp(); Node node = new Node(nNode,null,key,value) ; //å†™å…¥é˜Ÿåˆ— QUEUE.offer(currentNode) ; cNode.next = node ; &#125; nNode = nNode.next ; &#125; &#125; return null ; &#125; @Override public Object get(Object key) &#123; int hash = hash(key) ; int index = hash % arraySize ; Node currentNode = (Node) arrays[index] ; if (currentNode == null)&#123; return null ; &#125; if (currentNode.next == null)&#123; //æ›´æ–°æ—¶é—´ currentNode.setUpdateTime(System.currentTimeMillis()); //æ²¡æœ‰å†²çª return currentNode ; &#125; Node nNode = currentNode ; while (nNode.next != null)&#123; if (nNode.key == key)&#123; //æ›´æ–°æ—¶é—´ currentNode.setUpdateTime(System.currentTimeMillis()); return nNode ; &#125; nNode = nNode.next ; &#125; return super.get(key); &#125; @Override public Object remove(Object key) &#123; int hash = hash(key) ; int index = hash % arraySize ; Node currentNode = (Node) arrays[index] ; if (currentNode == null)&#123; return null ; &#125; if (currentNode.key == key)&#123; sizeDown(); arrays[index] = null ; //ç§»é™¤é˜Ÿåˆ— QUEUE.poll(); return currentNode ; &#125; Node nNode = currentNode ; while (nNode.next != null)&#123; if (nNode.key == key)&#123; sizeDown(); //åœ¨é“¾è¡¨ä¸­æ‰¾åˆ°äº† æŠŠä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„ next æŒ‡å‘å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ nNode.pre.next = nNode.next ; nNode = null ; //ç§»é™¤é˜Ÿåˆ— QUEUE.poll(); return nNode; &#125; nNode = nNode.next ; &#125; return super.remove(key); &#125; /** * å¢åŠ size */ private void sizeUp()&#123; //åœ¨putå€¼æ—¶å€™è®¤ä¸ºé‡Œè¾¹å·²ç»æœ‰æ•°æ®äº† flag = true ; if (size == null)&#123; size = new AtomicInteger() ; &#125; int size = this.size.incrementAndGet(); if (size &gt;= MAX_SIZE) &#123; //æ‰¾åˆ°é˜Ÿåˆ—å¤´çš„æ•°æ® Node node = QUEUE.poll() ; if (node == null)&#123; throw new RuntimeException("data error") ; &#125; //ç§»é™¤è¯¥ key Object key = node.key ; remove(key) ; lruCallback() ; &#125; &#125; /** * æ•°é‡å‡å° */ private void sizeDown()&#123; if (QUEUE.size() == 0)&#123; flag = false ; &#125; this.size.decrementAndGet() ; &#125; @Override public int size() &#123; return size.get() ; &#125; /** * é“¾è¡¨ */ private class Node&#123; private Node next ; private Node pre ; private Object key ; private Object val ; private Long updateTime ; public Node(Node pre,Node next, Object key, Object val) &#123; this.pre = pre ; this.next = next; this.key = key; this.val = val; this.updateTime = System.currentTimeMillis() ; &#125; public void setUpdateTime(Long updateTime) &#123; this.updateTime = updateTime; &#125; public Long getUpdateTime() &#123; return updateTime; &#125; @Override public String toString() &#123; return "Node&#123;" + "key=" + key + ", val=" + val + '&#125;'; &#125; &#125; /** * copy HashMap çš„ hash å®ç° * @param key * @return */ public int hash(Object key) &#123; int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16); &#125; private void lruCallback()&#123; LOGGER.debug("lruCallback"); &#125; private class CheckTimeThread implements Runnable&#123; @Override public void run() &#123; while (flag)&#123; try &#123; Node node = QUEUE.poll(); if (node == null)&#123; continue ; &#125; Long updateTime = node.getUpdateTime() ; if ((updateTime - System.currentTimeMillis()) &gt;= EXPIRE_TIME)&#123; remove(node.key) ; &#125; &#125; catch (Exception e) &#123; LOGGER.error("InterruptedException"); &#125; &#125; &#125; &#125;&#125; æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ç›´æ¥ä»: https://github.com/crossoverJie/Java-Interview/blob/master/src/main/java/com/crossoverjie/actual/LRUAbstractMap.java ä¸‹è½½ä»£ç æœ¬åœ°è¿è¡Œã€‚ ä»£ç çœ‹ç€æ¯”è¾ƒå¤šï¼Œå…¶å®å®ç°çš„æ€è·¯è¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼š é‡‡ç”¨äº†ä¸ HashMap ä¸€æ ·çš„ä¿å­˜æ•°æ®æ–¹å¼ï¼Œåªæ˜¯è‡ªå·±æ‰‹åŠ¨å®ç°äº†ä¸€ä¸ªç®€æ˜“ç‰ˆã€‚ å†…éƒ¨é‡‡ç”¨äº†ä¸€ä¸ªé˜Ÿåˆ—æ¥ä¿å­˜æ¯æ¬¡å†™å…¥çš„æ•°æ®ã€‚ å†™å…¥çš„æ—¶å€™åˆ¤æ–­ç¼“å­˜æ˜¯å¦å¤§äºäº†é˜ˆå€¼ Nï¼Œå¦‚æœæ»¡è¶³åˆ™æ ¹æ®é˜Ÿåˆ—çš„ FIFO ç‰¹æ€§å°†é˜Ÿåˆ—å¤´çš„æ•°æ®åˆ é™¤ã€‚å› ä¸ºé˜Ÿåˆ—å¤´çš„æ•°æ®è‚¯å®šæ˜¯æœ€å…ˆæ”¾è¿›å»çš„ã€‚ å†å¼€å¯äº†ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ç”¨äºåˆ¤æ–­æœ€å…ˆæ”¾è¿›å»çš„æ•°æ®æ˜¯å¦è¶…æœŸï¼ˆå› ä¸ºå°±ç®—è¶…æœŸä¹Ÿæ˜¯æœ€å…ˆæ”¾è¿›å»çš„æ•°æ®æœ€æœ‰å¯èƒ½æ»¡è¶³è¶…æœŸæ¡ä»¶ã€‚ï¼‰ è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹å¯ä»¥æ›´å¥½çš„è¡¨æ˜å…¶ç›®çš„ï¼ˆæœ€åçš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹æœ€ç»ˆæœ‰å¯èƒ½å¯¼è‡´ç¨‹åºä¸èƒ½æ­£å¸¸é€€å‡ºï¼Œå› ä¸ºè¯¥çº¿ç¨‹ä¸€ç›´åœ¨è¿è¡Œï¼Œå®ˆæŠ¤çº¿ç¨‹åˆ™ä¸ä¼šæœ‰è¿™ä¸ªæƒ…å†µã€‚ï¼‰ ä»¥ä¸Šä»£ç å¤§ä½“åŠŸèƒ½æ»¡è¶³äº†ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªè‡´å‘½é—®é¢˜ã€‚ å°±æ˜¯æœ€è¿‘æœ€å°‘ä½¿ç”¨æ²¡æœ‰æ»¡è¶³ï¼Œåˆ é™¤çš„æ•°æ®éƒ½æ˜¯æœ€å…ˆæ”¾å…¥çš„æ•°æ®ã€‚ ä¸è¿‡å…¶ä¸­çš„ put get æµç¨‹ç®—æ˜¯ä¸€ä¸ªç®€æ˜“çš„ HashMap å®ç°ï¼Œå¯ä»¥å¯¹ HashMap åŠ æ·±ä¸€äº›ç†è§£ã€‚ å®ç°äºŒå› æ­¤å¦‚ä½•æ¥å®ç°ä¸€ä¸ªå®Œæ•´çš„ LRU ç¼“å­˜å‘¢ï¼Œè¿™æ¬¡ä¸è€ƒè™‘è¿‡æœŸæ—¶é—´çš„é—®é¢˜ã€‚ å…¶å®ä»ä¸Šä¸€ä¸ªå®ç°ä¹Ÿèƒ½æƒ³åˆ°ä¸€äº›æ€è·¯ï¼š è¦è®°å½•æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œé‚£è‡³å°‘éœ€è¦ä¸€ä¸ªæœ‰åºçš„é›†åˆæ¥ä¿è¯å†™å…¥çš„é¡ºåºã€‚ åœ¨ä½¿ç”¨äº†æ•°æ®ä¹‹åèƒ½å¤Ÿæ›´æ–°å®ƒçš„é¡ºåºã€‚ åŸºäºä»¥ä¸Šä¸¤ç‚¹å¾ˆå®¹æ˜“æƒ³åˆ°ä¸€ä¸ªå¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼šé“¾è¡¨ã€‚ æ¯æ¬¡å†™å…¥æ•°æ®æ—¶å°†æ•°æ®æ”¾å…¥é“¾è¡¨å¤´ç»“ç‚¹ã€‚ ä½¿ç”¨æ•°æ®æ—¶å€™å°†æ•°æ®ç§»åŠ¨åˆ°å¤´ç»“ç‚¹ã€‚ ç¼“å­˜æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ç§»é™¤é“¾è¡¨å°¾éƒ¨æ•°æ®ã€‚ å› æ­¤æœ‰äº†ä»¥ä¸‹å®ç°ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211public class LRUMap&lt;K, V&gt; &#123; private final Map&lt;K, V&gt; cacheMap = new HashMap&lt;&gt;(); /** * æœ€å¤§ç¼“å­˜å¤§å° */ private int cacheSize; /** * èŠ‚ç‚¹å¤§å° */ private int nodeCount; /** * å¤´ç»“ç‚¹ */ private Node&lt;K, V&gt; header; /** * å°¾ç»“ç‚¹ */ private Node&lt;K, V&gt; tailer; public LRUMap(int cacheSize) &#123; this.cacheSize = cacheSize; //å¤´ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ä¸ºç©º header = new Node&lt;&gt;(); header.next = null; //å°¾ç»“ç‚¹çš„ä¸Šä¸€ä¸ªç»“ç‚¹ä¸ºç©º tailer = new Node&lt;&gt;(); tailer.tail = null; //åŒå‘é“¾è¡¨ å¤´ç»“ç‚¹çš„ä¸Šç»“ç‚¹æŒ‡å‘å°¾ç»“ç‚¹ header.tail = tailer; //å°¾ç»“ç‚¹çš„ä¸‹ç»“ç‚¹æŒ‡å‘å¤´ç»“ç‚¹ tailer.next = header; &#125; public void put(K key, V value) &#123; cacheMap.put(key, value); //åŒå‘é“¾è¡¨ä¸­æ·»åŠ ç»“ç‚¹ addNode(key, value); &#125; public V get(K key)&#123; Node&lt;K, V&gt; node = getNode(key); //ç§»åŠ¨åˆ°å¤´ç»“ç‚¹ moveToHead(node) ; return cacheMap.get(key); &#125; private void moveToHead(Node&lt;K,V&gt; node)&#123; //å¦‚æœæ˜¯æœ€åçš„ä¸€ä¸ªèŠ‚ç‚¹ if (node.tail == null)&#123; node.next.tail = null ; tailer = node.next ; nodeCount -- ; &#125; //å¦‚æœæ˜¯æœ¬æ¥å°±æ˜¯å¤´èŠ‚ç‚¹ ä¸ä½œå¤„ç† if (node.next == null)&#123; return ; &#125; //å¦‚æœå¤„äºä¸­é—´èŠ‚ç‚¹ if (node.tail != null &amp;&amp; node.next != null)&#123; //å®ƒçš„ä¸Šä¸€èŠ‚ç‚¹æŒ‡å‘å®ƒçš„ä¸‹ä¸€èŠ‚ç‚¹ ä¹Ÿå°±åˆ é™¤å½“å‰èŠ‚ç‚¹ node.tail.next = node.next ; nodeCount -- ; &#125; //æœ€ååœ¨å¤´éƒ¨å¢åŠ å½“å‰èŠ‚ç‚¹ //æ³¨æ„è¿™é‡Œéœ€è¦é‡æ–° new ä¸€ä¸ªå¯¹è±¡ï¼Œä¸ç„¶åŸæœ¬çš„node è¿˜æœ‰ç€ä¸‹é¢çš„å¼•ç”¨ï¼Œä¼šé€ æˆå†…å­˜æº¢å‡ºã€‚ node = new Node&lt;&gt;(node.getKey(),node.getValue()) ; addHead(node) ; &#125; /** * é“¾è¡¨æŸ¥è¯¢ æ•ˆç‡è¾ƒä½ * @param key * @return */ private Node&lt;K,V&gt; getNode(K key)&#123; Node&lt;K,V&gt; node = tailer ; while (node != null)&#123; if (node.getKey().equals(key))&#123; return node ; &#125; node = node.next ; &#125; return null ; &#125; /** * å†™å…¥å¤´ç»“ç‚¹ * @param key * @param value */ private void addNode(K key, V value) &#123; Node&lt;K, V&gt; node = new Node&lt;&gt;(key, value); //å®¹é‡æ»¡äº†åˆ é™¤æœ€åä¸€ä¸ª if (cacheSize == nodeCount) &#123; //åˆ é™¤å°¾ç»“ç‚¹ delTail(); &#125; //å†™å…¥å¤´ç»“ç‚¹ addHead(node); &#125; /** * æ·»åŠ å¤´ç»“ç‚¹ * * @param node */ private void addHead(Node&lt;K, V&gt; node) &#123; //å†™å…¥å¤´ç»“ç‚¹ header.next = node; node.tail = header; header = node; nodeCount++; //å¦‚æœå†™å…¥çš„æ•°æ®å¤§äº2ä¸ª å°±å°†åˆå§‹åŒ–çš„å¤´å°¾ç»“ç‚¹åˆ é™¤ if (nodeCount == 2) &#123; tailer.next.next.tail = null; tailer = tailer.next.next; &#125; &#125; private void delTail() &#123; //æŠŠå°¾ç»“ç‚¹ä»ç¼“å­˜ä¸­åˆ é™¤ cacheMap.remove(tailer.getKey()); //åˆ é™¤å°¾ç»“ç‚¹ tailer.next.tail = null; tailer = tailer.next; nodeCount--; &#125; private class Node&lt;K, V&gt; &#123; private K key; private V value; Node&lt;K, V&gt; tail; Node&lt;K, V&gt; next; public Node(K key, V value) &#123; this.key = key; this.value = value; &#125; public Node() &#123; &#125; public K getKey() &#123; return key; &#125; public void setKey(K key) &#123; this.key = key; &#125; public V getValue() &#123; return value; &#125; public void setValue(V value) &#123; this.value = value; &#125; &#125; @Override public String toString() &#123; StringBuilder sb = new StringBuilder() ; Node&lt;K,V&gt; node = tailer ; while (node != null)&#123; sb.append(node.getKey()).append(":") .append(node.getValue()) .append("--&gt;") ; node = node.next ; &#125; return sb.toString(); &#125;&#125; æºç ï¼šhttps://github.com/crossoverJie/Java-Interview/blob/master/src/main/java/com/crossoverjie/actual/LRUMap.java å®é™…æ•ˆæœï¼Œå†™å…¥æ—¶ï¼š 1234567891011121314151617181920 @Test public void put() throws Exception &#123; LRUMap&lt;String,Integer&gt; lruMap = new LRUMap(3) ; lruMap.put("1",1) ; lruMap.put("2",2) ; lruMap.put("3",3) ; System.out.println(lruMap.toString()); lruMap.put("4",4) ; System.out.println(lruMap.toString()); lruMap.put("5",5) ; System.out.println(lruMap.toString()); &#125;//è¾“å‡ºï¼š1:1--&gt;2:2--&gt;3:3--&gt;2:2--&gt;3:3--&gt;4:4--&gt;3:3--&gt;4:4--&gt;5:5--&gt; ä½¿ç”¨æ—¶ï¼š 12345678910111213141516171819202122 @Test public void get() throws Exception &#123; LRUMap&lt;String,Integer&gt; lruMap = new LRUMap(3) ; lruMap.put("1",1) ; lruMap.put("2",2) ; lruMap.put("3",3) ; System.out.println(lruMap.toString()); System.out.println("=============="); Integer integer = lruMap.get("1"); System.out.println(integer); System.out.println("=============="); System.out.println(lruMap.toString()); &#125; //è¾“å‡º1:1--&gt;2:2--&gt;3:3--&gt;==============1==============2:2--&gt;3:3--&gt;1:1--&gt; å®ç°æ€è·¯å’Œä¸Šæ–‡æåˆ°çš„ä¸€è‡´ï¼Œè¯´ä¸‹é‡ç‚¹ï¼š æ•°æ®æ˜¯ç›´æ¥åˆ©ç”¨ HashMap æ¥å­˜æ”¾çš„ã€‚ å†…éƒ¨ä½¿ç”¨äº†ä¸€ä¸ªåŒå‘é“¾è¡¨æ¥å­˜æ”¾æ•°æ®ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªå¤´ç»“ç‚¹ headerï¼Œä»¥åŠå°¾ç»“ç‚¹ tailerã€‚ æ¯æ¬¡å†™å…¥å¤´ç»“ç‚¹ï¼Œåˆ é™¤å°¾ç»“ç‚¹æ—¶éƒ½æ˜¯ä¾èµ–äº header tailerï¼Œå¦‚æœçœ‹ç€æ¯”è¾ƒæ‡µå»ºè®®è‡ªå·±å®ç°ä¸€ä¸ªé“¾è¡¨ç†Ÿæ‚‰ä¸‹ï¼Œæˆ–ç»“åˆä¸‹æ–‡çš„å¯¹è±¡å…³ç³»å›¾ä¸€èµ·ç†è§£ã€‚ ä½¿ç”¨æ•°æ®ç§»åŠ¨åˆ°é“¾è¡¨å¤´æ—¶ï¼Œç¬¬ä¸€æ­¥æ˜¯éœ€è¦åœ¨åŒå‘é“¾è¡¨ä¸­æ‰¾åˆ°è¯¥èŠ‚ç‚¹ã€‚è¿™é‡Œå°±ä½“ç°å‡ºé“¾è¡¨çš„é—®é¢˜äº†ã€‚æŸ¥æ‰¾æ•ˆç‡å¾ˆä½ï¼Œæœ€å·®éœ€è¦ O(N)ã€‚ä¹‹åä¾èµ–äºå½“å‰èŠ‚ç‚¹è¿›è¡Œç§»åŠ¨ã€‚ åœ¨å†™å…¥å¤´ç»“ç‚¹æ—¶æœ‰åˆ¤æ–­é“¾è¡¨å¤§å°ç­‰äº 2 æ—¶éœ€è¦åˆ é™¤åˆå§‹åŒ–çš„å¤´å°¾ç»“ç‚¹ã€‚è¿™æ˜¯å› ä¸ºåˆå§‹åŒ–æ—¶å€™ç”Ÿæˆäº†ä¸¤ä¸ªåŒå‘èŠ‚ç‚¹ï¼Œæ²¡æœ‰æ•°æ®åªæ˜¯ä¸ºäº†å½¢æˆä¸€ä¸ªæ•°æ®ç»“æ„ã€‚å½“çœŸå®æ•°æ®è¿›æ¥ä¹‹åéœ€è¦åˆ é™¤ä»¥æ–¹ä¾¿åç»­çš„æ“ä½œï¼ˆè¿™ç‚¹å¯ä»¥ç»§ç»­ä¼˜åŒ–ï¼‰ã€‚ ä»¥ä¸Šçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œéœ€è¦ä½¿ç”¨è€…è‡ªè¡Œæ§åˆ¶ã€‚ ä¸‹é¢æ˜¯å¯¹è±¡å…³ç³»å›¾ï¼š åˆå§‹åŒ–æ—¶ å†™å…¥æ•°æ®æ—¶12LRUMap&lt;String,Integer&gt; lruMap = new LRUMap(3) ;lruMap.put("1",1) ; 1lruMap.put("2",2) ; 1lruMap.put("3",3) ; 1lruMap.put("4",4) ; è·å–æ•°æ®æ—¶æ•°æ®å’Œä¸Šæ–‡ä¸€æ ·ï¼š 1Integer integer = lruMap.get("2"); é€šè¿‡ä»¥ä¸Šå‡ å¼ å›¾åº”è¯¥æ˜¯å¾ˆå¥½ç†è§£æ•°æ®æ˜¯å¦‚ä½•å­˜æ”¾çš„äº†ã€‚ å®ç°ä¸‰å…¶å®å¦‚æœå¯¹ Java çš„é›†åˆæ¯”è¾ƒç†Ÿæ‚‰çš„è¯ï¼Œä¼šå‘ç°ä¸Šæ–‡çš„ç»“æ„å’Œ LinkedHashMap éå¸¸ç±»ä¼¼ã€‚ å¯¹æ­¤ä¸å¤ªç†Ÿæ‚‰çš„æœ‹å‹å¯ä»¥å…ˆäº†è§£ä¸‹ LinkedHashMap åº•å±‚åˆ†æ ã€‚ æ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥å€ŸåŠ©äºå®ƒæ¥å®ç°ï¼š 123456789101112131415161718192021222324252627282930313233343536373839public class LRULinkedMap&lt;K,V&gt; &#123; /** * æœ€å¤§ç¼“å­˜å¤§å° */ private int cacheSize; private LinkedHashMap&lt;K,V&gt; cacheMap ; public LRULinkedMap(int cacheSize) &#123; this.cacheSize = cacheSize; cacheMap = new LinkedHashMap(16,0.75F,true)&#123; @Override protected boolean removeEldestEntry(Map.Entry eldest) &#123; if (cacheSize + 1 == cacheMap.size())&#123; return true ; &#125;else &#123; return false ; &#125; &#125; &#125;; &#125; public void put(K key,V value)&#123; cacheMap.put(key,value) ; &#125; public V get(K key)&#123; return cacheMap.get(key) ; &#125; public Collection&lt;Map.Entry&lt;K, V&gt;&gt; getAll() &#123; return new ArrayList&lt;Map.Entry&lt;K, V&gt;&gt;(cacheMap.entrySet()); &#125;&#125; æºç ï¼šhttps://github.com/crossoverJie/Java-Interview/blob/master/src/main/java/com/crossoverjie/actual/LRULinkedMap.java è¿™æ¬¡å°±æ¯”è¾ƒç®€æ´äº†ï¼Œä¹Ÿå°±å‡ è¡Œä»£ç ï¼ˆå…·ä½“çš„é€»è¾‘ LinkedHashMap å·²ç»å¸®æˆ‘ä»¬å®ç°å¥½äº†ï¼‰ å®é™…æ•ˆæœ: 123456789101112131415161718192021 @Test public void put() throws Exception &#123; LRULinkedMap&lt;String,Integer&gt; map = new LRULinkedMap(3) ; map.put("1",1); map.put("2",2); map.put("3",3); for (Map.Entry&lt;String, Integer&gt; e : map.getAll())&#123; System.out.print(e.getKey() + " : " + e.getValue() + "\t"); &#125; System.out.println(""); map.put("4",4); for (Map.Entry&lt;String, Integer&gt; e : map.getAll())&#123; System.out.print(e.getKey() + " : " + e.getValue() + "\t"); &#125; &#125; //è¾“å‡º1 : 1 2 : 2 3 : 3 2 : 2 3 : 3 4 : 4 ä½¿ç”¨æ—¶ï¼š 123456789101112131415161718192021222324 @Test public void get() throws Exception &#123; LRULinkedMap&lt;String,Integer&gt; map = new LRULinkedMap(4) ; map.put("1",1); map.put("2",2); map.put("3",3); map.put("4",4); for (Map.Entry&lt;String, Integer&gt; e : map.getAll())&#123; System.out.print(e.getKey() + " : " + e.getValue() + "\t"); &#125; System.out.println(""); map.get("1") ; for (Map.Entry&lt;String, Integer&gt; e : map.getAll())&#123; System.out.print(e.getKey() + " : " + e.getValue() + "\t"); &#125; &#125;&#125;//è¾“å‡º1 : 1 2 : 2 3 : 3 4 : 4 2 : 2 3 : 3 4 : 4 1 : 1 LinkedHashMap å†…éƒ¨ä¹Ÿæœ‰ç»´æŠ¤ä¸€ä¸ªåŒå‘é˜Ÿåˆ—ï¼Œåœ¨åˆå§‹åŒ–æ—¶ä¹Ÿä¼šç»™å®šä¸€ä¸ªç¼“å­˜å¤§å°çš„é˜ˆå€¼ã€‚åˆå§‹åŒ–æ—¶è‡ªå®šä¹‰æ˜¯å¦éœ€è¦åˆ é™¤æœ€è¿‘ä¸å¸¸ä½¿ç”¨çš„æ•°æ®ï¼Œå¦‚æœæ˜¯åˆ™ä¼šæŒ‰ç…§å®ç°äºŒä¸­çš„æ–¹å¼ç®¡ç†æ•°æ®ã€‚ å…¶å®ä¸»è¦ä»£ç å°±æ˜¯é‡å†™äº† LinkedHashMap çš„ removeEldestEntry æ–¹æ³•: 123protected boolean removeEldestEntry(Map.Entry&lt;K,V&gt; eldest) &#123; return false;&#125; å®ƒé»˜è®¤æ˜¯è¿”å› falseï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šç®¡æœ‰æ²¡æœ‰è¶…è¿‡é˜ˆå€¼ã€‚ æ‰€ä»¥æˆ‘ä»¬è‡ªå®šä¹‰å¤§äºäº†é˜ˆå€¼æ—¶è¿”å› trueï¼Œè¿™æ · LinkedHashMap å°±ä¼šå¸®æˆ‘ä»¬åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®ã€‚ æ€»ç»“ä»¥ä¸Šå°±æ˜¯å¯¹ LRU ç¼“å­˜çš„å®ç°ï¼Œäº†è§£äº†è¿™äº›è‡³å°‘åœ¨å¹³æ—¶ä½¿ç”¨æ—¶å¯ä»¥çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚ å½“ç„¶ä¸šç•Œä½¿ç”¨è¾ƒå¤šçš„è¿˜æœ‰ guava çš„å®ç°ï¼Œå¹¶ä¸”å®ƒè¿˜æ”¯æŒå¤šç§è¿‡æœŸç­–ç•¥ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>ç®—æ³•</category>
        <category>LRU cache</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åŸºäº Redis çš„åˆ†å¸ƒå¼é”]]></title>
    <url>%2F2018%2F03%2F29%2Fdistributed-lock%2Fdistributed-lock-redis%2F</url>
    <content type="text"><![CDATA[å‰è¨€åˆ†å¸ƒå¼é”åœ¨åˆ†å¸ƒå¼åº”ç”¨ä¸­åº”ç”¨å¹¿æ³›ï¼Œæƒ³è¦ææ‡‚ä¸€ä¸ªæ–°äº‹ç‰©é¦–å…ˆå¾—äº†è§£å®ƒçš„ç”±æ¥ï¼Œè¿™æ ·æ‰èƒ½æ›´åŠ çš„ç†è§£ç”šè‡³å¯ä»¥ä¸¾ä¸€åä¸‰ã€‚ é¦–å…ˆè°ˆåˆ°åˆ†å¸ƒå¼é”è‡ªç„¶ä¹Ÿå°±è”æƒ³åˆ°åˆ†å¸ƒå¼åº”ç”¨ã€‚ åœ¨æˆ‘ä»¬å°†åº”ç”¨æ‹†åˆ†ä¸ºåˆ†å¸ƒå¼åº”ç”¨ä¹‹å‰çš„å•æœºç³»ç»Ÿä¸­ï¼Œå¯¹ä¸€äº›å¹¶å‘åœºæ™¯è¯»å–å…¬å…±èµ„æºæ—¶å¦‚æ‰£åº“å­˜ï¼Œå–è½¦ç¥¨ä¹‹ç±»çš„éœ€æ±‚å¯ä»¥ç®€å•çš„ä½¿ç”¨åŒæ­¥æˆ–è€…æ˜¯åŠ é”å°±å¯ä»¥å®ç°ã€‚ ä½†æ˜¯åº”ç”¨åˆ†å¸ƒå¼äº†ä¹‹åç³»ç»Ÿç”±ä»¥å‰çš„å•è¿›ç¨‹å¤šçº¿ç¨‹çš„ç¨‹åºå˜ä¸ºäº†å¤šè¿›ç¨‹å¤šçº¿ç¨‹ï¼Œè¿™æ—¶ä½¿ç”¨ä»¥ä¸Šçš„è§£å†³æ–¹æ¡ˆæ˜æ˜¾å°±ä¸å¤Ÿäº†ã€‚ å› æ­¤ä¸šç•Œå¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆé€šå¸¸æ˜¯å€ŸåŠ©äºä¸€ä¸ªç¬¬ä¸‰æ–¹ç»„ä»¶å¹¶åˆ©ç”¨å®ƒè‡ªèº«çš„æ’ä»–æ€§æ¥è¾¾åˆ°å¤šè¿›ç¨‹çš„äº’æ–¥ã€‚å¦‚ï¼š åŸºäº DB çš„å”¯ä¸€ç´¢å¼•ã€‚ åŸºäº ZK çš„ä¸´æ—¶æœ‰åºèŠ‚ç‚¹ã€‚ åŸºäº Redis çš„ NX EX å‚æ•°ã€‚ è¿™é‡Œä¸»è¦åŸºäº Redis è¿›è¡Œè®¨è®ºã€‚ å®ç°æ—¢ç„¶æ˜¯é€‰ç”¨äº† Redisï¼Œé‚£ä¹ˆå®ƒå°±å¾—å…·æœ‰æ’ä»–æ€§æ‰è¡Œã€‚åŒæ—¶å®ƒæœ€å¥½ä¹Ÿæœ‰é”çš„ä¸€äº›åŸºæœ¬ç‰¹æ€§ï¼š é«˜æ€§èƒ½(åŠ ã€è§£é”æ—¶é«˜æ€§èƒ½) å¯ä»¥ä½¿ç”¨é˜»å¡é”ä¸éé˜»å¡é”ã€‚ ä¸èƒ½å‡ºç°æ­»é”ã€‚ å¯ç”¨æ€§(ä¸èƒ½å‡ºç°èŠ‚ç‚¹ down æ‰ååŠ é”å¤±è´¥)ã€‚ è¿™é‡Œåˆ©ç”¨ Redis set key æ—¶çš„ä¸€ä¸ª NX å‚æ•°å¯ä»¥ä¿è¯åœ¨è¿™ä¸ª key ä¸å­˜åœ¨çš„æƒ…å†µä¸‹å†™å…¥æˆåŠŸã€‚å¹¶ä¸”å†åŠ ä¸Š EX å‚æ•°å¯ä»¥è®©è¯¥ key åœ¨è¶…æ—¶ä¹‹åè‡ªåŠ¨åˆ é™¤ã€‚ æ‰€ä»¥åˆ©ç”¨ä»¥ä¸Šä¸¤ä¸ªç‰¹æ€§å¯ä»¥ä¿è¯åœ¨åŒä¸€æ—¶åˆ»åªä¼šæœ‰ä¸€ä¸ªè¿›ç¨‹è·å¾—é”ï¼Œå¹¶ä¸”ä¸ä¼šå‡ºç°æ­»é”(æœ€åçš„æƒ…å†µå°±æ˜¯è¶…æ—¶è‡ªåŠ¨åˆ é™¤ key)ã€‚ åŠ é”å®ç°ä»£ç å¦‚ä¸‹ï¼š 12345678910111213private static final String SET_IF_NOT_EXIST = "NX";private static final String SET_WITH_EXPIRE_TIME = "PX";public boolean tryLock(String key, String request) &#123; String result = this.jedis.set(LOCK_PREFIX + key, request, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, 10 * TIME); if (LOCK_MSG.equals(result))&#123; return true ; &#125;else &#123; return false ; &#125;&#125; æ³¨æ„è¿™é‡Œä½¿ç”¨çš„ jedis çš„ 1String set(String key, String value, String nxxx, String expx, long time); apiã€‚ è¯¥å‘½ä»¤å¯ä»¥ä¿è¯ NX EX çš„åŸå­æ€§ã€‚ ä¸€å®šä¸è¦æŠŠä¸¤ä¸ªå‘½ä»¤(NX EX)åˆ†å¼€æ‰§è¡Œï¼Œå¦‚æœåœ¨ NX ä¹‹åç¨‹åºå‡ºç°é—®é¢˜å°±æœ‰å¯èƒ½äº§ç”Ÿæ­»é”ã€‚ é˜»å¡é”åŒæ—¶ä¹Ÿå¯ä»¥å®ç°ä¸€ä¸ªé˜»å¡é”ï¼š 123456789101112131415161718192021222324252627282930//ä¸€ç›´é˜»å¡public void lock(String key, String request) throws InterruptedException &#123; for (;;)&#123; String result = this.jedis.set(LOCK_PREFIX + key, request, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, 10 * TIME); if (LOCK_MSG.equals(result))&#123; break ; &#125; //é˜²æ­¢ä¸€ç›´æ¶ˆè€— CPU Thread.sleep(DEFAULT_SLEEP_TIME) ; &#125;&#125; //è‡ªå®šä¹‰é˜»å¡æ—¶é—´ public boolean lock(String key, String request,int blockTime) throws InterruptedException &#123; while (blockTime &gt;= 0)&#123; String result = this.jedis.set(LOCK_PREFIX + key, request, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, 10 * TIME); if (LOCK_MSG.equals(result))&#123; return true ; &#125; blockTime -= DEFAULT_SLEEP_TIME ; Thread.sleep(DEFAULT_SLEEP_TIME) ; &#125; return false ;&#125; è§£é”è§£é”ä¹Ÿå¾ˆç®€å•ï¼Œå…¶å®å°±æ˜¯æŠŠè¿™ä¸ª key åˆ æ‰å°±ä¸‡äº‹å¤§å‰äº†ï¼Œæ¯”å¦‚ä½¿ç”¨ del key å‘½ä»¤ã€‚ ä½†ç°å®å¾€å¾€æ²¡æœ‰é‚£ä¹ˆ easyã€‚ å¦‚æœè¿›ç¨‹ A è·å–äº†é”è®¾ç½®äº†è¶…æ—¶æ—¶é—´ï¼Œä½†æ˜¯ç”±äºæ‰§è¡Œå‘¨æœŸè¾ƒé•¿å¯¼è‡´åˆ°äº†è¶…æ—¶æ—¶é—´ä¹‹åé”å°±è‡ªåŠ¨é‡Šæ”¾äº†ã€‚è¿™æ—¶è¿›ç¨‹ B è·å–äº†è¯¥é”æ‰§è¡Œå¾ˆå¿«å°±é‡Šæ”¾é”ã€‚è¿™æ ·å°±ä¼šå‡ºç°è¿›ç¨‹ B å°†è¿›ç¨‹ A çš„é”é‡Šæ”¾äº†ã€‚ æ‰€ä»¥æœ€å¥½çš„æ–¹å¼æ˜¯åœ¨æ¯æ¬¡è§£é”æ—¶éƒ½éœ€è¦åˆ¤æ–­é”æ˜¯å¦æ˜¯è‡ªå·±çš„ã€‚ è¿™æ—¶å°±éœ€è¦ç»“åˆåŠ é”æœºåˆ¶ä¸€èµ·å®ç°äº†ã€‚ åŠ é”æ—¶éœ€è¦ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼Œå°†è¯¥å‚æ•°ä½œä¸ºè¿™ä¸ª key çš„ valueï¼Œè¿™æ ·æ¯æ¬¡è§£é”æ—¶åˆ¤æ–­ value æ˜¯å¦ç›¸ç­‰å³å¯ã€‚ æ‰€ä»¥è§£é”ä»£ç å°±ä¸èƒ½æ˜¯ç®€å•çš„ deläº†ã€‚ 1234567891011121314151617181920public boolean unlock(String key,String request)&#123; //lua script String script = "if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end"; Object result = null ; if (jedis instanceof Jedis)&#123; result = ((Jedis)this.jedis).eval(script, Collections.singletonList(LOCK_PREFIX + key), Collections.singletonList(request)); &#125;else if (jedis instanceof JedisCluster)&#123; result = ((JedisCluster)this.jedis).eval(script, Collections.singletonList(LOCK_PREFIX + key), Collections.singletonList(request)); &#125;else &#123; //throw new RuntimeException("instance is error") ; return false ; &#125; if (UNLOCK_MSG.equals(result))&#123; return true ; &#125;else &#123; return false ; &#125;&#125; è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ª lua è„šæœ¬æ¥åˆ¤æ–­ value æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰æ‰æ‰§è¡Œ del å‘½ä»¤ã€‚ ä½¿ç”¨ lua ä¹Ÿå¯ä»¥ä¿è¯è¿™é‡Œä¸¤ä¸ªæ“ä½œçš„åŸå­æ€§ã€‚ å› æ­¤ä¸Šæ–‡æåˆ°çš„å››ä¸ªåŸºæœ¬ç‰¹æ€§ä¹Ÿèƒ½æ»¡è¶³äº†ï¼š ä½¿ç”¨ Redis å¯ä»¥ä¿è¯æ€§èƒ½ã€‚ é˜»å¡é”ä¸éé˜»å¡é”è§ä¸Šæ–‡ã€‚ åˆ©ç”¨è¶…æ—¶æœºåˆ¶è§£å†³äº†æ­»é”ã€‚ Redis æ”¯æŒé›†ç¾¤éƒ¨ç½²æé«˜äº†å¯ç”¨æ€§ã€‚ ä½¿ç”¨æˆ‘è‡ªå·±æœ‰æ’¸äº†ä¸€ä¸ªå®Œæ•´çš„å®ç°ï¼Œå¹¶ä¸”å·²ç»ç”¨äºäº†ç”Ÿäº§ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥å¼€ç®±ä½¿ç”¨: maven ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;top.crossoverjie.opensource&lt;/groupId&gt; &lt;artifactId&gt;distributed-redis-lock&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt;&lt;/dependency&gt; é…ç½® bean : 1234567891011121314@Configurationpublic class RedisLockConfig &#123; @Bean public RedisLock build()&#123; RedisLock redisLock = new RedisLock() ; HostAndPort hostAndPort = new HostAndPort("127.0.0.1",7000) ; JedisCluster jedisCluster = new JedisCluster(hostAndPort) ; // Jedis æˆ– JedisCluster éƒ½å¯ä»¥ redisLock.setJedisCluster(jedisCluster) ; return redisLock ; &#125;&#125; ä½¿ç”¨ï¼š 123456789101112131415161718192021@Autowiredprivate RedisLock redisLock ;public void use() &#123; String key = "key"; String request = UUID.randomUUID().toString(); try &#123; boolean locktest = redisLock.tryLock(key, request); if (!locktest) &#123; System.out.println("locked error"); return; &#125; //do something &#125; finally &#123; redisLock.unlock(key,request) ; &#125;&#125; ä½¿ç”¨å¾ˆç®€å•ã€‚è¿™é‡Œä¸»è¦æ˜¯æƒ³åˆ©ç”¨ Spring æ¥å¸®æˆ‘ä»¬ç®¡ç† RedisLock è¿™ä¸ªå•ä¾‹çš„ beanï¼Œæ‰€ä»¥åœ¨é‡Šæ”¾é”çš„æ—¶å€™éœ€è¦æ‰‹åŠ¨(å› ä¸ºæ•´ä¸ªä¸Šä¸‹æ–‡åªæœ‰ä¸€ä¸ª RedisLock å®ä¾‹)çš„ä¼ å…¥ key ä»¥åŠ request(api çœ‹èµ·æ¥ä¸æ˜¯ç‰¹åˆ«ä¼˜é›…)ã€‚ ä¹Ÿå¯ä»¥åœ¨æ¯æ¬¡ä½¿ç”¨é”çš„æ—¶å€™ new ä¸€ä¸ª RedisLock ä¼ å…¥ key ä»¥åŠ requestï¼Œè¿™æ ·å€’æ˜¯åœ¨è§£é”æ—¶å¾ˆæ–¹ä¾¿ã€‚ä½†æ˜¯éœ€è¦è‡ªè¡Œç®¡ç† RedisLock çš„å®ä¾‹ã€‚å„æœ‰ä¼˜åŠ£å§ã€‚ é¡¹ç›®æºç åœ¨ï¼š https://github.com/crossoverJie/distributed-lock-redis æ¬¢è¿è®¨è®ºã€‚ å•æµ‹åœ¨åšè¿™ä¸ªé¡¹ç›®çš„æ—¶å€™è®©æˆ‘ä¸å¾—ä¸æƒ³æä¸€ä¸‹å•æµ‹ã€‚ å› ä¸ºè¿™ä¸ªåº”ç”¨æ˜¯å¼ºä¾èµ–äºç¬¬ä¸‰æ–¹ç»„ä»¶çš„(Redis)ï¼Œä½†æ˜¯åœ¨å•æµ‹ä¸­æˆ‘ä»¬éœ€è¦æ’é™¤æ‰è¿™ç§ä¾èµ–ã€‚æ¯”å¦‚å…¶ä»–ä¼™ä¼´ fork äº†è¯¥é¡¹ç›®æƒ³åœ¨æœ¬åœ°è·‘ä¸€éå•æµ‹ï¼Œç»“æœè¿è¡Œä¸èµ·æ¥ï¼š æœ‰å¯èƒ½æ˜¯ Redis çš„ ipã€ç«¯å£å’Œå•æµ‹é‡Œçš„ä¸ä¸€è‡´ã€‚ Redis è‡ªèº«å¯èƒ½ä¹Ÿæœ‰é—®é¢˜ã€‚ ä¹Ÿæœ‰å¯èƒ½æ˜¯è¯¥åŒå­¦çš„ç¯å¢ƒä¸­å¹¶æ²¡æœ‰ Redisã€‚ æ‰€ä»¥æœ€å¥½æ˜¯è¦æŠŠè¿™äº›å¤–éƒ¨ä¸ç¨³å®šçš„å› ç´ æ’é™¤æ‰ï¼Œå•æµ‹åªæµ‹æˆ‘ä»¬å†™å¥½çš„ä»£ç ã€‚ äºæ˜¯å°±å¯ä»¥å¼•å…¥å•æµ‹åˆ©å™¨ Mock äº†ã€‚ å®ƒçš„æƒ³æ³•å¾ˆç®€ç­”ï¼Œå°±æ˜¯è¦æŠŠä½ æ‰€ä¾èµ–çš„å¤–éƒ¨èµ„æºç»Ÿç»Ÿå±è”½æ‰ã€‚å¦‚ï¼šæ•°æ®åº“ã€å¤–éƒ¨æ¥å£ã€å¤–éƒ¨æ–‡ä»¶ç­‰ç­‰ã€‚ ä½¿ç”¨æ–¹å¼ä¹ŸæŒºç®€å•ï¼Œå¯ä»¥å‚è€ƒè¯¥é¡¹ç›®çš„å•æµ‹ï¼š 12345678910111213141516@Testpublic void tryLock() throws Exception &#123; String key = "test"; String request = UUID.randomUUID().toString(); Mockito.when(jedisCluster.set(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), Mockito.anyLong())).thenReturn("OK"); boolean locktest = redisLock.tryLock(key, request); System.out.println("locktest=" + locktest); Assert.assertTrue(locktest); //check Mockito.verify(jedisCluster).set(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), Mockito.anyLong());&#125; è¿™é‡Œåªæ˜¯ç®€å•æ¼”ç¤ºä¸‹ï¼Œå¯ä»¥çš„è¯ä¸‹æ¬¡ä»”ç»†åˆ†æåˆ†æã€‚ å®ƒçš„åŸç†å…¶å®ä¹ŸæŒºç®€å•ï¼Œdebug çš„è¯å¯ä»¥å¾ˆç›´æ¥çš„çœ‹å‡ºæ¥ï¼š è¿™é‡Œæˆ‘ä»¬æ‰€ä¾èµ–çš„ JedisCluster å…¶å®æ˜¯ä¸€ä¸ª cglib ä»£ç†å¯¹è±¡ã€‚æ‰€ä»¥ä¹Ÿä¸éš¾æƒ³åˆ°å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ æ¯”å¦‚è¿™é‡Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° JedisCluster çš„ set å‡½æ•°å¹¶éœ€è¦å®ƒçš„è¿”å›å€¼ã€‚ Mock å°±å°†è¯¥å¯¹è±¡ä»£ç†äº†ï¼Œå¹¶åœ¨å®é™…æ‰§è¡Œ set æ–¹æ³•åç»™ä½ è¿”å›äº†ä¸€ä¸ªä½ è‡ªå®šä¹‰çš„å€¼ã€‚ è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥éšå¿ƒæ‰€æ¬²çš„æµ‹è¯•äº†ï¼Œå®Œå…¨æŠŠå¤–éƒ¨ä¾èµ–æ‰€å±è”½äº†ã€‚ æ€»ç»“è‡³æ­¤ä¸€ä¸ªåŸºäº Redis çš„åˆ†å¸ƒå¼é”å®Œæˆï¼Œä½†æ˜¯ä¾ç„¶æœ‰äº›é—®é¢˜ã€‚ å¦‚åœ¨ key è¶…æ—¶ä¹‹åä¸šåŠ¡å¹¶æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ä½†å´è‡ªåŠ¨é‡Šæ”¾é”äº†ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å¹¶å‘é—®é¢˜ã€‚ å°±ç®— Redis æ˜¯é›†ç¾¤éƒ¨ç½²çš„ï¼Œå¦‚æœæ¯ä¸ªèŠ‚ç‚¹éƒ½åªæ˜¯ master æ²¡æœ‰ slaveï¼Œé‚£ä¹ˆ master å®•æœºæ—¶è¯¥èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰ key åœ¨é‚£ä¸€æ—¶åˆ»éƒ½ç›¸å½“äºæ˜¯é‡Šæ”¾é”äº†ï¼Œè¿™æ ·ä¹Ÿä¼šå‡ºç°å¹¶å‘é—®é¢˜ã€‚å°±ç®—æ˜¯æœ‰ slave èŠ‚ç‚¹ï¼Œä½†å¦‚æœåœ¨æ•°æ®åŒæ­¥åˆ° salve ä¹‹å‰ master å®•æœºä¹Ÿæ˜¯ä¼šå‡ºç°ä¸Šé¢çš„é—®é¢˜ã€‚ æ„Ÿå…´è¶£çš„æœ‹å‹è¿˜å¯ä»¥å‚è€ƒ Redisson çš„å®ç°ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>Distributed Tools</category>
      </categories>
      <tags>
        <tag>Distributed Lock</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring Bean ç”Ÿå‘½å‘¨æœŸ]]></title>
    <url>%2F2018%2F03%2F21%2Fspring%2Fspring-bean-lifecycle%2F</url>
    <content type="text"><![CDATA[å‰è¨€Spring Bean çš„ç”Ÿå‘½å‘¨æœŸåœ¨æ•´ä¸ª Spring ä¸­å æœ‰å¾ˆé‡è¦çš„ä½ç½®ï¼ŒæŒæ¡è¿™äº›å¯ä»¥åŠ æ·±å¯¹ Spring çš„ç†è§£ã€‚ é¦–å…ˆçœ‹ä¸‹ç”Ÿå‘½å‘¨æœŸå›¾ï¼š å†è°ˆç”Ÿå‘½å‘¨æœŸä¹‹å‰æœ‰ä¸€ç‚¹éœ€è¦å…ˆæ˜ç¡®ï¼š Spring åªå¸®æˆ‘ä»¬ç®¡ç†å•ä¾‹æ¨¡å¼ Bean çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼Œå¯¹äº prototype çš„ bean ï¼ŒSpring åœ¨åˆ›å»ºå¥½äº¤ç»™ä½¿ç”¨è€…ä¹‹ååˆ™ä¸ä¼šå†ç®¡ç†åç»­çš„ç”Ÿå‘½å‘¨æœŸã€‚ æ³¨è§£æ–¹å¼åœ¨ bean åˆå§‹åŒ–æ—¶ä¼šç»å†å‡ ä¸ªé˜¶æ®µï¼Œé¦–å…ˆå¯ä»¥ä½¿ç”¨æ³¨è§£ @PostConstruct, @PreDestroy æ¥åœ¨ bean çš„åˆ›å»ºå’Œé”€æ¯é˜¶æ®µè¿›è¡Œè°ƒç”¨: 1234567891011121314@Componentpublic class AnnotationBean &#123; private final static Logger LOGGER = LoggerFactory.getLogger(AnnotationBean.class); @PostConstruct public void start()&#123; LOGGER.info("AnnotationBean start"); &#125; @PreDestroy public void destroy()&#123; LOGGER.info("AnnotationBean destroy"); &#125;&#125; InitializingBean, DisposableBean æ¥å£è¿˜å¯ä»¥å®ç° InitializingBean,DisposableBean è¿™ä¸¤ä¸ªæ¥å£ï¼Œä¹Ÿæ˜¯åœ¨åˆå§‹åŒ–ä»¥åŠé”€æ¯é˜¶æ®µè°ƒç”¨ï¼š 12345678910111213@Servicepublic class SpringLifeCycleService implements InitializingBean,DisposableBean&#123; private final static Logger LOGGER = LoggerFactory.getLogger(SpringLifeCycleService.class); @Override public void afterPropertiesSet() throws Exception &#123; LOGGER.info("SpringLifeCycleService start"); &#125; @Override public void destroy() throws Exception &#123; LOGGER.info("SpringLifeCycleService destroy"); &#125;&#125; è‡ªå®šä¹‰åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ–¹æ³•ç”¨äºåœ¨åˆå§‹åŒ–ã€é”€æ¯é˜¶æ®µè°ƒç”¨: 123456789101112131415161718192021222324@Configurationpublic class LifeCycleConfig &#123; @Bean(initMethod = "start", destroyMethod = "destroy") public SpringLifeCycle create()&#123; SpringLifeCycle springLifeCycle = new SpringLifeCycle() ; return springLifeCycle ; &#125;&#125;public class SpringLifeCycle&#123; private final static Logger LOGGER = LoggerFactory.getLogger(SpringLifeCycle.class); public void start()&#123; LOGGER.info("SpringLifeCycle start"); &#125; public void destroy()&#123; LOGGER.info("SpringLifeCycle destroy"); &#125;&#125; ä»¥ä¸Šæ˜¯åœ¨ SpringBoot ä¸­å¯ä»¥è¿™æ ·é…ç½®ï¼Œå¦‚æœæ˜¯åŸå§‹çš„åŸºäº XML ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨: 12&lt;bean class="com.crossoverjie.spring.SpringLifeCycle" init-method="start" destroy-method="destroy"&gt;&lt;/bean&gt; æ¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚ å®ç° *Aware æ¥å£*Aware æ¥å£å¯ä»¥ç”¨äºåœ¨åˆå§‹åŒ– bean æ—¶è·å¾— Spring ä¸­çš„ä¸€äº›å¯¹è±¡ï¼Œå¦‚è·å– Spring ä¸Šä¸‹æ–‡ç­‰ã€‚ 123456789101112@Componentpublic class SpringLifeCycleAware implements ApplicationContextAware &#123; private final static Logger LOGGER = LoggerFactory.getLogger(SpringLifeCycleAware.class); private ApplicationContext applicationContext ; @Override public void setApplicationContext(ApplicationContext applicationContext) throws BeansException &#123; this.applicationContext = applicationContext ; LOGGER.info("SpringLifeCycleAware start"); &#125;&#125; è¿™æ ·åœ¨ springLifeCycleAware è¿™ä¸ª bean åˆå§‹åŒ–ä¼šå°±ä¼šè°ƒç”¨ setApplicationContext æ–¹æ³•ï¼Œå¹¶å¯ä»¥è·å¾— applicationContext å¯¹è±¡ã€‚ BeanPostProcessor å¢å¼ºå¤„ç†å™¨å®ç° BeanPostProcessor æ¥å£ï¼ŒSpring ä¸­æ‰€æœ‰ bean åœ¨åšåˆå§‹åŒ–æ—¶éƒ½ä¼šè°ƒç”¨è¯¥æ¥å£ä¸­çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¯¹ä¸€äº›ç‰¹æ®Šçš„ bean è¿›è¡Œå¤„ç†ï¼š 12345678910111213141516171819202122232425262728293031323334@Componentpublic class SpringLifeCycleProcessor implements BeanPostProcessor &#123; private final static Logger LOGGER = LoggerFactory.getLogger(SpringLifeCycleProcessor.class); /** * é¢„åˆå§‹åŒ– åˆå§‹åŒ–ä¹‹å‰è°ƒç”¨ * @param bean * @param beanName * @return * @throws BeansException */ @Override public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException &#123; if ("annotationBean".equals(beanName))&#123; LOGGER.info("SpringLifeCycleProcessor start beanName=&#123;&#125;",beanName); &#125; return bean; &#125; /** * ååˆå§‹åŒ– bean åˆå§‹åŒ–å®Œæˆè°ƒç”¨ * @param bean * @param beanName * @return * @throws BeansException */ @Override public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException &#123; if ("annotationBean".equals(beanName))&#123; LOGGER.info("SpringLifeCycleProcessor end beanName=&#123;&#125;",beanName); &#125; return bean; &#125;&#125; æ‰§è¡Œä¹‹åè§‚å¯Ÿç»“æœï¼š 123456789101112131415018-03-21 00:40:24.856 [restartedMain] INFO c.c.s.p.SpringLifeCycleProcessor - SpringLifeCycleProcessor start beanName=annotationBean2018-03-21 00:40:24.860 [restartedMain] INFO c.c.spring.annotation.AnnotationBean - AnnotationBean start2018-03-21 00:40:24.861 [restartedMain] INFO c.c.s.p.SpringLifeCycleProcessor - SpringLifeCycleProcessor end beanName=annotationBean2018-03-21 00:40:24.864 [restartedMain] INFO c.c.s.aware.SpringLifeCycleAware - SpringLifeCycleAware start2018-03-21 00:40:24.867 [restartedMain] INFO c.c.s.service.SpringLifeCycleService - SpringLifeCycleService start2018-03-21 00:40:24.887 [restartedMain] INFO c.c.spring.SpringLifeCycle - SpringLifeCycle start2018-03-21 00:40:25.062 [restartedMain] INFO o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 357292018-03-21 00:40:25.122 [restartedMain] INFO o.s.j.e.a.AnnotationMBeanExporter - Registering beans for JMX exposure on startup2018-03-21 00:40:25.140 [restartedMain] INFO com.crossoverjie.Application - Started Application in 2.309 seconds (JVM running for 3.681)2018-03-21 00:40:25.143 [restartedMain] INFO com.crossoverjie.Application - start ok!2018-03-21 00:40:25.153 [Thread-8] INFO o.s.c.a.AnnotationConfigApplicationContext - Closing org.springframework.context.annotation.AnnotationConfigApplicationContext@3913adad: startup date [Wed Mar 21 00:40:23 CST 2018]; root of context hierarchy2018-03-21 00:40:25.155 [Thread-8] INFO o.s.j.e.a.AnnotationMBeanExporter - Unregistering JMX-exposed beans on shutdown2018-03-21 00:40:25.156 [Thread-8] INFO c.c.spring.SpringLifeCycle - SpringLifeCycle destroy2018-03-21 00:40:25.156 [Thread-8] INFO c.c.s.service.SpringLifeCycleService - SpringLifeCycleService destroy2018-03-21 00:40:25.156 [Thread-8] INFO c.c.spring.annotation.AnnotationBean - AnnotationBean destroy ç›´åˆ° Spring ä¸Šä¸‹æ–‡é”€æ¯æ—¶åˆ™ä¼šè°ƒç”¨è‡ªå®šä¹‰çš„é”€æ¯æ–¹æ³•ä»¥åŠå®ç°äº† DisposableBean çš„ destroy() æ–¹æ³•ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£çº¿ç¨‹é€šä¿¡]]></title>
    <url>%2F2018%2F03%2F16%2Fjava-senior%2Fthread-communication%2F</url>
    <content type="text"><![CDATA[å‰è¨€å¼€å‘ä¸­ä¸å…ä¼šé‡åˆ°éœ€è¦æ‰€æœ‰å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•é€šçŸ¥ä¸»çº¿ç¨‹å¤„ç†æŸäº›é€»è¾‘çš„åœºæ™¯ã€‚ æˆ–è€…æ˜¯çº¿ç¨‹ A åœ¨æ‰§è¡Œåˆ°æŸä¸ªæ¡ä»¶é€šçŸ¥çº¿ç¨‹ B æ‰§è¡ŒæŸä¸ªæ“ä½œã€‚ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼å®ç°ï¼š ç­‰å¾…é€šçŸ¥æœºåˆ¶ ç­‰å¾…é€šçŸ¥æ¨¡å¼æ˜¯ Java ä¸­æ¯”è¾ƒç»å…¸çš„çº¿ç¨‹é€šä¿¡æ–¹å¼ã€‚ ä¸¤ä¸ªçº¿ç¨‹é€šè¿‡å¯¹åŒä¸€å¯¹è±¡è°ƒç”¨ç­‰å¾… wait() å’Œé€šçŸ¥ notify() æ–¹æ³•æ¥è¿›è¡Œé€šè®¯ã€‚ å¦‚ä¸¤ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°å¥‡å¶æ•°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091public class TwoThreadWaitNotify &#123; private int start = 1; private boolean flag = false; public static void main(String[] args) &#123; TwoThreadWaitNotify twoThread = new TwoThreadWaitNotify(); Thread t1 = new Thread(new OuNum(twoThread)); t1.setName("A"); Thread t2 = new Thread(new JiNum(twoThread)); t2.setName("B"); t1.start(); t2.start(); &#125; /** * å¶æ•°çº¿ç¨‹ */ public static class OuNum implements Runnable &#123; private TwoThreadWaitNotify number; public OuNum(TwoThreadWaitNotify number) &#123; this.number = number; &#125; @Override public void run() &#123; while (number.start &lt;= 100) &#123; synchronized (TwoThreadWaitNotify.class) &#123; System.out.println("å¶æ•°çº¿ç¨‹æŠ¢åˆ°é”äº†"); if (number.flag) &#123; System.out.println(Thread.currentThread().getName() + "+-+å¶æ•°" + number.start); number.start++; number.flag = false; TwoThreadWaitNotify.class.notify(); &#125;else &#123; try &#123; TwoThreadWaitNotify.class.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; &#125; &#125; /** * å¥‡æ•°çº¿ç¨‹ */ public static class JiNum implements Runnable &#123; private TwoThreadWaitNotify number; public JiNum(TwoThreadWaitNotify number) &#123; this.number = number; &#125; @Override public void run() &#123; while (number.start &lt;= 100) &#123; synchronized (TwoThreadWaitNotify.class) &#123; System.out.println("å¥‡æ•°çº¿ç¨‹æŠ¢åˆ°é”äº†"); if (!number.flag) &#123; System.out.println(Thread.currentThread().getName() + "+-+å¥‡æ•°" + number.start); number.start++; number.flag = true; TwoThreadWaitNotify.class.notify(); &#125;else &#123; try &#123; TwoThreadWaitNotify.class.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; &#125; &#125;&#125; è¾“å‡ºç»“æœï¼š 12345678t2+-+å¥‡æ•°93t1+-+å¶æ•°94t2+-+å¥‡æ•°95t1+-+å¶æ•°96t2+-+å¥‡æ•°97t1+-+å¶æ•°98t2+-+å¥‡æ•°99t1+-+å¶æ•°100 è¿™é‡Œçš„çº¿ç¨‹ A å’Œçº¿ç¨‹ B éƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡ TwoThreadWaitNotify.class è·å–é”ï¼ŒA çº¿ç¨‹è°ƒç”¨äº†åŒæ­¥å¯¹è±¡çš„ wait() æ–¹æ³•é‡Šæ”¾äº†é”å¹¶è¿›å…¥ WAITING çŠ¶æ€ã€‚ B çº¿ç¨‹è°ƒç”¨äº† notify() æ–¹æ³•ï¼Œè¿™æ · A çº¿ç¨‹æ”¶åˆ°é€šçŸ¥ä¹‹åå°±å¯ä»¥ä» wait() æ–¹æ³•ä¸­è¿”å›ã€‚ è¿™é‡Œåˆ©ç”¨äº† TwoThreadWaitNotify.class å¯¹è±¡å®Œæˆäº†é€šä¿¡ã€‚ æœ‰ä¸€äº›éœ€è¦æ³¨æ„: wait() ã€nofify() ã€nofityAll() è°ƒç”¨çš„å‰æéƒ½æ˜¯è·å¾—äº†å¯¹è±¡çš„é”(ä¹Ÿå¯ç§°ä¸ºå¯¹è±¡ç›‘è§†å™¨)ã€‚ è°ƒç”¨ wait() æ–¹æ³•åçº¿ç¨‹ä¼šé‡Šæ”¾é”ï¼Œè¿›å…¥ WAITING çŠ¶æ€ï¼Œè¯¥çº¿ç¨‹ä¹Ÿä¼šè¢«ç§»åŠ¨åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚ è°ƒç”¨ notify() æ–¹æ³•ä¼šå°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œçº¿ç¨‹çŠ¶æ€ä¹Ÿä¼šæ›´æ–°ä¸º BLOCKED ä» wait() æ–¹æ³•è¿”å›çš„å‰ææ˜¯è°ƒç”¨ notify() æ–¹æ³•çš„çº¿ç¨‹é‡Šæ”¾é”ï¼Œwait() æ–¹æ³•çš„çº¿ç¨‹è·å¾—é”ã€‚ ç­‰å¾…é€šçŸ¥æœ‰ç€ä¸€ä¸ªç»å…¸èŒƒå¼ï¼š çº¿ç¨‹ A ä½œä¸ºæ¶ˆè´¹è€…ï¼š è·å–å¯¹è±¡çš„é”ã€‚ è¿›å…¥ while(åˆ¤æ–­æ¡ä»¶)ï¼Œå¹¶è°ƒç”¨ wait() æ–¹æ³•ã€‚ å½“æ¡ä»¶æ»¡è¶³è·³å‡ºå¾ªç¯æ‰§è¡Œå…·ä½“å¤„ç†é€»è¾‘ã€‚ çº¿ç¨‹ B ä½œä¸ºç”Ÿäº§è€…: è·å–å¯¹è±¡é”ã€‚ æ›´æ”¹ä¸çº¿ç¨‹ A å…±ç”¨çš„åˆ¤æ–­æ¡ä»¶ã€‚ è°ƒç”¨ notify() æ–¹æ³•ã€‚ ä¼ªä»£ç å¦‚ä¸‹: 1234567891011121314//Thread Asynchronized(Object)&#123; while(æ¡ä»¶)&#123; Object.wait(); &#125; //do something&#125;//Thread Bsynchronized(Object)&#123; æ¡ä»¶=false;//æ”¹å˜æ¡ä»¶ Object.notify();&#125; join() æ–¹æ³•1234567891011121314151617181920212223242526272829303132333435private static void join() throws InterruptedException &#123; Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("running"); try &#123; Thread.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;) ; Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("running2"); try &#123; Thread.sleep(4000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;) ; t1.start(); t2.start(); //ç­‰å¾…çº¿ç¨‹1ç»ˆæ­¢ t1.join(); //ç­‰å¾…çº¿ç¨‹2ç»ˆæ­¢ t2.join(); LOGGER.info("main over");&#125; è¾“å‡ºç»“æœ: 1232018-03-16 20:21:30.967 [Thread-1] INFO c.c.actual.ThreadCommunication - running22018-03-16 20:21:30.967 [Thread-0] INFO c.c.actual.ThreadCommunication - running2018-03-16 20:21:34.972 [main] INFO c.c.actual.ThreadCommunication - main over åœ¨ t1.join() æ—¶ä¼šä¸€ç›´é˜»å¡åˆ° t1 æ‰§è¡Œå®Œæ¯•ï¼Œæ‰€ä»¥æœ€ç»ˆä¸»çº¿ç¨‹ä¼šç­‰å¾… t1 å’Œ t2 çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚ å…¶å®ä»æºç å¯ä»¥çœ‹å‡ºï¼Œjoin() ä¹Ÿæ˜¯åˆ©ç”¨çš„ç­‰å¾…é€šçŸ¥æœºåˆ¶ï¼š æ ¸å¿ƒé€»è¾‘: 123while (isAlive()) &#123; wait(0);&#125; åœ¨ join çº¿ç¨‹å®Œæˆåä¼šè°ƒç”¨ notifyAll() æ–¹æ³•ï¼Œæ˜¯åœ¨ JVM å®ç°ä¸­è°ƒç”¨ï¼Œæ‰€ä»¥è¿™é‡Œçœ‹ä¸å‡ºæ¥ã€‚ volatile å…±äº«å†…å­˜å› ä¸º Java æ˜¯é‡‡ç”¨å…±äº«å†…å­˜çš„æ–¹å¼è¿›è¡Œçº¿ç¨‹é€šä¿¡çš„ï¼Œæ‰€ä»¥å¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹å¼ç”¨ä¸»çº¿ç¨‹å…³é—­ A çº¿ç¨‹: 1234567891011121314151617181920212223242526272829public class Volatile implements Runnable&#123; private static volatile boolean flag = true ; @Override public void run() &#123; while (flag)&#123; System.out.println(Thread.currentThread().getName() + "æ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚"); &#125; System.out.println(Thread.currentThread().getName() +"æ‰§è¡Œå®Œæ¯•"); &#125; public static void main(String[] args) throws InterruptedException &#123; Volatile aVolatile = new Volatile(); new Thread(aVolatile,"thread A").start(); System.out.println("main çº¿ç¨‹æ­£åœ¨è¿è¡Œ") ; TimeUnit.MILLISECONDS.sleep(100) ; aVolatile.stopThread(); &#125; private void stopThread()&#123; flag = false ; &#125;&#125; è¾“å‡ºç»“æœï¼š12345thread Aæ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚thread Aæ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚thread Aæ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚thread Aæ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚thread Aæ‰§è¡Œå®Œæ¯• è¿™é‡Œçš„ flag å­˜æ”¾äºä¸»å†…å­˜ä¸­ï¼Œæ‰€ä»¥ä¸»çº¿ç¨‹å’Œçº¿ç¨‹ A éƒ½å¯ä»¥çœ‹åˆ°ã€‚ flag é‡‡ç”¨ volatile ä¿®é¥°ä¸»è¦æ˜¯ä¸ºäº†å†…å­˜å¯è§æ€§ï¼Œæ›´å¤šå†…å®¹å¯ä»¥æŸ¥çœ‹è¿™é‡Œã€‚ CountDownLatch å¹¶å‘å·¥å…·CountDownLatch å¯ä»¥å®ç° join ç›¸åŒçš„åŠŸèƒ½ï¼Œä½†æ˜¯æ›´åŠ çš„çµæ´»ã€‚ 12345678910111213141516171819202122232425private static void countDownLatch() throws Exception&#123; int thread = 3 ; long start = System.currentTimeMillis(); final CountDownLatch countDown = new CountDownLatch(thread); for (int i= 0 ;i&lt;thread ; i++)&#123; new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("thread run"); try &#123; Thread.sleep(2000); countDown.countDown(); LOGGER.info("thread end"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;).start(); &#125; countDown.await(); long stop = System.currentTimeMillis(); LOGGER.info("main over total time=&#123;&#125;",stop-start);&#125; è¾“å‡ºç»“æœ: 12345672018-03-16 20:19:44.126 [Thread-0] INFO c.c.actual.ThreadCommunication - thread run2018-03-16 20:19:44.126 [Thread-2] INFO c.c.actual.ThreadCommunication - thread run2018-03-16 20:19:44.126 [Thread-1] INFO c.c.actual.ThreadCommunication - thread run2018-03-16 20:19:46.136 [Thread-2] INFO c.c.actual.ThreadCommunication - thread end2018-03-16 20:19:46.136 [Thread-1] INFO c.c.actual.ThreadCommunication - thread end2018-03-16 20:19:46.136 [Thread-0] INFO c.c.actual.ThreadCommunication - thread end2018-03-16 20:19:46.136 [main] INFO c.c.actual.ThreadCommunication - main over total time=2012 CountDownLatch ä¹Ÿæ˜¯åŸºäº AQS(AbstractQueuedSynchronizer) å®ç°çš„ï¼Œæ›´å¤šå®ç°å‚è€ƒ ReentrantLock å®ç°åŸç† åˆå§‹åŒ–ä¸€ä¸ª CountDownLatch æ—¶å‘Šè¯‰å¹¶å‘çš„çº¿ç¨‹ï¼Œç„¶ååœ¨æ¯ä¸ªçº¿ç¨‹å¤„ç†å®Œæ¯•ä¹‹åè°ƒç”¨ countDown() æ–¹æ³•ã€‚ è¯¥æ–¹æ³•ä¼šå°† AQS å†…ç½®çš„ä¸€ä¸ª state çŠ¶æ€ -1 ã€‚ æœ€ç»ˆåœ¨ä¸»çº¿ç¨‹è°ƒç”¨ await() æ–¹æ³•ï¼Œå®ƒä¼šé˜»å¡ç›´åˆ° state == 0 çš„æ—¶å€™è¿”å›ã€‚ CyclicBarrier å¹¶å‘å·¥å…·123456789101112131415161718192021222324252627282930313233343536373839404142434445464748private static void cyclicBarrier() throws Exception &#123; CyclicBarrier cyclicBarrier = new CyclicBarrier(3) ; new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("thread run"); try &#123; cyclicBarrier.await() ; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; LOGGER.info("thread end do something"); &#125; &#125;).start(); new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("thread run"); try &#123; cyclicBarrier.await() ; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; LOGGER.info("thread end do something"); &#125; &#125;).start(); new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("thread run"); try &#123; Thread.sleep(5000); cyclicBarrier.await() ; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; LOGGER.info("thread end do something"); &#125; &#125;).start(); LOGGER.info("main thread");&#125; CyclicBarrier ä¸­æ–‡åå«åšå±éšœæˆ–è€…æ˜¯æ …æ ï¼Œä¹Ÿå¯ä»¥ç”¨äºçº¿ç¨‹é—´é€šä¿¡ã€‚ å®ƒå¯ä»¥ç­‰å¾… N ä¸ªçº¿ç¨‹éƒ½è¾¾åˆ°æŸä¸ªçŠ¶æ€åç»§ç»­è¿è¡Œçš„æ•ˆæœã€‚ é¦–å…ˆåˆå§‹åŒ–çº¿ç¨‹å‚ä¸è€…ã€‚ è°ƒç”¨ await() å°†ä¼šåœ¨æ‰€æœ‰å‚ä¸è€…çº¿ç¨‹éƒ½è°ƒç”¨ä¹‹å‰ç­‰å¾…ã€‚ ç›´åˆ°æ‰€æœ‰å‚ä¸è€…éƒ½è°ƒç”¨äº† await() åï¼Œæ‰€æœ‰çº¿ç¨‹ä» await() è¿”å›ç»§ç»­åç»­é€»è¾‘ã€‚ è¿è¡Œç»“æœ: 12345672018-03-18 22:40:00.731 [Thread-0] INFO c.c.actual.ThreadCommunication - thread run2018-03-18 22:40:00.731 [Thread-1] INFO c.c.actual.ThreadCommunication - thread run2018-03-18 22:40:00.731 [Thread-2] INFO c.c.actual.ThreadCommunication - thread run2018-03-18 22:40:00.731 [main] INFO c.c.actual.ThreadCommunication - main thread2018-03-18 22:40:05.741 [Thread-0] INFO c.c.actual.ThreadCommunication - thread end do something2018-03-18 22:40:05.741 [Thread-1] INFO c.c.actual.ThreadCommunication - thread end do something2018-03-18 22:40:05.741 [Thread-2] INFO c.c.actual.ThreadCommunication - thread end do something å¯ä»¥çœ‹å‡ºç”±äºå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ä¼‘çœ äº†äº”ç§’ï¼Œæ‰€æœ‰å…¶ä½™æ‰€æœ‰çš„çº¿ç¨‹éƒ½å¾—ç­‰å¾…è¿™ä¸ªçº¿ç¨‹è°ƒç”¨ await() ã€‚ è¯¥å·¥å…·å¯ä»¥å®ç° CountDownLatch åŒæ ·çš„åŠŸèƒ½ï¼Œä½†æ˜¯è¦æ›´åŠ çµæ´»ã€‚ç”šè‡³å¯ä»¥è°ƒç”¨ reset() æ–¹æ³•é‡ç½® CyclicBarrier (éœ€è¦è‡ªè¡Œæ•è· BrokenBarrierException å¤„ç†) ç„¶åé‡æ–°æ‰§è¡Œã€‚ çº¿ç¨‹å“åº”ä¸­æ–­12345678910111213141516171819202122232425public class StopThread implements Runnable &#123; @Override public void run() &#123; while ( !Thread.currentThread().isInterrupted()) &#123; // çº¿ç¨‹æ‰§è¡Œå…·ä½“é€»è¾‘ System.out.println(Thread.currentThread().getName() + "è¿è¡Œä¸­ã€‚ã€‚"); &#125; System.out.println(Thread.currentThread().getName() + "é€€å‡ºã€‚ã€‚"); &#125; public static void main(String[] args) throws InterruptedException &#123; Thread thread = new Thread(new StopThread(), "thread A"); thread.start(); System.out.println("main çº¿ç¨‹æ­£åœ¨è¿è¡Œ") ; TimeUnit.MILLISECONDS.sleep(10) ; thread.interrupt(); &#125;&#125; è¾“å‡ºç»“æœ: 123thread Aè¿è¡Œä¸­ã€‚ã€‚thread Aè¿è¡Œä¸­ã€‚ã€‚thread Aé€€å‡ºã€‚ã€‚ å¯ä»¥é‡‡ç”¨ä¸­æ–­çº¿ç¨‹çš„æ–¹å¼æ¥é€šä¿¡ï¼Œè°ƒç”¨äº† thread.interrupt() æ–¹æ³•å…¶å®å°±æ˜¯å°† thread ä¸­çš„ä¸€ä¸ªæ ‡å¿—å±æ€§ç½®ä¸ºäº† trueã€‚ å¹¶ä¸æ˜¯è¯´è°ƒç”¨äº†è¯¥æ–¹æ³•å°±å¯ä»¥ä¸­æ–­çº¿ç¨‹ï¼Œå¦‚æœä¸å¯¹è¿™ä¸ªæ ‡å¿—è¿›è¡Œå“åº”å…¶å®æ˜¯æ²¡æœ‰ä»€ä¹ˆä½œç”¨(è¿™é‡Œå¯¹è¿™ä¸ªæ ‡å¿—è¿›è¡Œäº†åˆ¤æ–­)ã€‚ ä½†æ˜¯å¦‚æœæŠ›å‡ºäº† InterruptedException å¼‚å¸¸ï¼Œè¯¥æ ‡å¿—å°±ä¼šè¢« JVM é‡ç½®ä¸º falseã€‚ çº¿ç¨‹æ±  awaitTermination() æ–¹æ³•å¦‚æœæ˜¯ç”¨çº¿ç¨‹æ± æ¥ç®¡ç†çº¿ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ¥è®©ä¸»çº¿ç¨‹ç­‰å¾…çº¿ç¨‹æ± ä¸­æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•: 1234567891011121314151617181920212223242526272829303132private static void executorService() throws Exception&#123; BlockingQueue&lt;Runnable&gt; queue = new LinkedBlockingQueue&lt;&gt;(10) ; ThreadPoolExecutor poolExecutor = new ThreadPoolExecutor(5,5,1, TimeUnit.MILLISECONDS,queue) ; poolExecutor.execute(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("running"); try &#123; Thread.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;); poolExecutor.execute(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("running2"); try &#123; Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;); poolExecutor.shutdown(); while (!poolExecutor.awaitTermination(1,TimeUnit.SECONDS))&#123; LOGGER.info("çº¿ç¨‹è¿˜åœ¨æ‰§è¡Œã€‚ã€‚ã€‚"); &#125; LOGGER.info("main over");&#125; è¾“å‡ºç»“æœ: 123452018-03-16 20:18:01.273 [pool-1-thread-2] INFO c.c.actual.ThreadCommunication - running22018-03-16 20:18:01.273 [pool-1-thread-1] INFO c.c.actual.ThreadCommunication - running2018-03-16 20:18:02.273 [main] INFO c.c.actual.ThreadCommunication - çº¿ç¨‹è¿˜åœ¨æ‰§è¡Œã€‚ã€‚ã€‚2018-03-16 20:18:03.278 [main] INFO c.c.actual.ThreadCommunication - çº¿ç¨‹è¿˜åœ¨æ‰§è¡Œã€‚ã€‚ã€‚2018-03-16 20:18:04.278 [main] INFO c.c.actual.ThreadCommunication - main over ä½¿ç”¨è¿™ä¸ª awaitTermination() æ–¹æ³•çš„å‰æéœ€è¦å…³é—­çº¿ç¨‹æ± ï¼Œå¦‚è°ƒç”¨äº† shutdown() æ–¹æ³•ã€‚ è°ƒç”¨äº† shutdown() ä¹‹åçº¿ç¨‹æ± ä¼šåœæ­¢æ¥å—æ–°ä»»åŠ¡ï¼Œå¹¶ä¸”ä¼šå¹³æ»‘çš„å…³é—­çº¿ç¨‹æ± ä¸­ç°æœ‰çš„ä»»åŠ¡ã€‚ ç®¡é“é€šä¿¡12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public static void piped() throws IOException &#123; //é¢å‘äºå­—ç¬¦ PipedInputStream é¢å‘äºå­—èŠ‚ PipedWriter writer = new PipedWriter(); PipedReader reader = new PipedReader(); //è¾“å…¥è¾“å‡ºæµå»ºç«‹è¿æ¥ writer.connect(reader); Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("running"); try &#123; for (int i = 0; i &lt; 10; i++) &#123; writer.write(i+""); Thread.sleep(10); &#125; &#125; catch (Exception e) &#123; &#125; finally &#123; try &#123; writer.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;); Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("running2"); int msg = 0; try &#123; while ((msg = reader.read()) != -1) &#123; LOGGER.info("msg=&#123;&#125;", (char) msg); &#125; &#125; catch (Exception e) &#123; &#125; &#125; &#125;); t1.start(); t2.start();&#125; è¾“å‡ºç»“æœ: 1234567891011122018-03-16 19:56:43.014 [Thread-0] INFO c.c.actual.ThreadCommunication - running2018-03-16 19:56:43.014 [Thread-1] INFO c.c.actual.ThreadCommunication - running22018-03-16 19:56:43.130 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=02018-03-16 19:56:43.132 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=12018-03-16 19:56:43.132 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=22018-03-16 19:56:43.133 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=32018-03-16 19:56:43.133 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=42018-03-16 19:56:43.133 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=52018-03-16 19:56:43.133 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=62018-03-16 19:56:43.134 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=72018-03-16 19:56:43.134 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=82018-03-16 19:56:43.134 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=9 Java è™½è¯´æ˜¯åŸºäºå†…å­˜é€šä¿¡çš„ï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨ç®¡é“é€šä¿¡ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¾“å…¥æµå’Œè¾“å‡ºæµéœ€è¦é¦–å…ˆå»ºç«‹è¿æ¥ã€‚è¿™æ ·çº¿ç¨‹ B å°±å¯ä»¥æ”¶åˆ°çº¿ç¨‹ A å‘å‡ºçš„æ¶ˆæ¯äº†ã€‚ å®é™…å¼€å‘ä¸­å¯ä»¥çµæ´»æ ¹æ®éœ€æ±‚é€‰æ‹©æœ€é€‚åˆçš„çº¿ç¨‹é€šä¿¡æ–¹å¼ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Thread</tag>
        <tag>concurrent</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½ åº”è¯¥çŸ¥é“çš„ volatile å…³é”®å­—]]></title>
    <url>%2F2018%2F03%2F09%2Fvolatile%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¸ç®¡æ˜¯åœ¨é¢è¯•è¿˜æ˜¯å®é™…å¼€å‘ä¸­ volatile éƒ½æ˜¯ä¸€ä¸ªåº”è¯¥æŒæ¡çš„æŠ€èƒ½ã€‚ é¦–å…ˆæ¥çœ‹çœ‹ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªå…³é”®å­—ã€‚ å†…å­˜å¯è§æ€§ç”±äº Java å†…å­˜æ¨¡å‹(JMM)è§„å®šï¼Œæ‰€æœ‰çš„å˜é‡éƒ½å­˜æ”¾åœ¨ä¸»å†…å­˜ä¸­ï¼Œè€Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ç€è‡ªå·±çš„å·¥ä½œå†…å­˜(é«˜é€Ÿç¼“å­˜)ã€‚ çº¿ç¨‹åœ¨å·¥ä½œæ—¶ï¼Œéœ€è¦å°†ä¸»å†…å­˜ä¸­çš„æ•°æ®æ‹·è´åˆ°å·¥ä½œå†…å­˜ä¸­ã€‚è¿™æ ·å¯¹æ•°æ®çš„ä»»ä½•æ“ä½œéƒ½æ˜¯åŸºäºå·¥ä½œå†…å­˜(æ•ˆç‡æé«˜)ï¼Œå¹¶ä¸”ä¸èƒ½ç›´æ¥æ“ä½œä¸»å†…å­˜ä»¥åŠå…¶ä»–çº¿ç¨‹å·¥ä½œå†…å­˜ä¸­çš„æ•°æ®ï¼Œä¹‹åå†å°†æ›´æ–°ä¹‹åçš„æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚ è¿™é‡Œæ‰€æåˆ°çš„ä¸»å†…å­˜å¯ä»¥ç®€å•è®¤ä¸ºæ˜¯å †å†…å­˜ï¼Œè€Œå·¥ä½œå†…å­˜åˆ™å¯ä»¥è®¤ä¸ºæ˜¯æ ˆå†…å­˜ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ‰€ä»¥åœ¨å¹¶å‘è¿è¡Œæ—¶å¯èƒ½ä¼šå‡ºç°çº¿ç¨‹ B æ‰€è¯»å–åˆ°çš„æ•°æ®æ˜¯çº¿ç¨‹ A æ›´æ–°ä¹‹å‰çš„æ•°æ®ã€‚ æ˜¾ç„¶è¿™è‚¯å®šæ˜¯ä¼šå‡ºé—®é¢˜çš„ï¼Œå› æ­¤ volatile çš„ä½œç”¨å‡ºç°äº†ï¼š å½“ä¸€ä¸ªå˜é‡è¢« volatile ä¿®é¥°æ—¶ï¼Œä»»ä½•çº¿ç¨‹å¯¹å®ƒçš„å†™æ“ä½œéƒ½ä¼šç«‹å³åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œå¹¶ä¸”ä¼šå¼ºåˆ¶è®©ç¼“å­˜äº†è¯¥å˜é‡çš„çº¿ç¨‹ä¸­çš„æ•°æ®æ¸…ç©ºï¼Œå¿…é¡»ä»ä¸»å†…å­˜é‡æ–°è¯»å–æœ€æ–°æ•°æ®ã€‚ volatile ä¿®é¥°ä¹‹åå¹¶ä¸æ˜¯è®©çº¿ç¨‹ç›´æ¥ä»ä¸»å†…å­˜ä¸­è·å–æ•°æ®ï¼Œä¾ç„¶éœ€è¦å°†å˜é‡æ‹·è´åˆ°å·¥ä½œå†…å­˜ä¸­ã€‚ å†…å­˜å¯è§æ€§çš„åº”ç”¨å½“æˆ‘ä»¬éœ€è¦åœ¨ä¸¤ä¸ªçº¿ç¨‹é—´ä¾æ®ä¸»å†…å­˜é€šä¿¡æ—¶ï¼Œé€šä¿¡çš„é‚£ä¸ªå˜é‡å°±å¿…é¡»çš„ç”¨ volatile æ¥ä¿®é¥°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243public class Volatile implements Runnable&#123; private static volatile boolean flag = true ; @Override public void run() &#123; while (flag)&#123; &#125; System.out.println(Thread.currentThread().getName() +"æ‰§è¡Œå®Œæ¯•"); &#125; public static void main(String[] args) throws InterruptedException &#123; Volatile aVolatile = new Volatile(); new Thread(aVolatile,"thread A").start(); System.out.println("main çº¿ç¨‹æ­£åœ¨è¿è¡Œ") ; Scanner sc = new Scanner(System.in); while(sc.hasNext())&#123; String value = sc.next(); if(value.equals("1"))&#123; new Thread(new Runnable() &#123; @Override public void run() &#123; aVolatile.stopThread(); &#125; &#125;).start(); break ; &#125; &#125; System.out.println("ä¸»çº¿ç¨‹é€€å‡ºäº†ï¼"); &#125; private void stopThread()&#123; flag = false ; &#125;&#125; ä¸»çº¿ç¨‹åœ¨ä¿®æ”¹äº†æ ‡å¿—ä½ä½¿å¾—çº¿ç¨‹ A ç«‹å³åœæ­¢ï¼Œå¦‚æœæ²¡æœ‰ç”¨ volatile ä¿®é¥°ï¼Œå°±æœ‰å¯èƒ½å‡ºç°å»¶è¿Ÿã€‚ ä½†è¿™é‡Œæœ‰ä¸ªè¯¯åŒºï¼Œè¿™æ ·çš„ä½¿ç”¨æ–¹å¼å®¹æ˜“ç»™äººçš„æ„Ÿè§‰æ˜¯ï¼š å¯¹ volatile ä¿®é¥°çš„å˜é‡è¿›è¡Œå¹¶å‘æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ è¿™é‡Œè¦é‡ç‚¹å¼ºè°ƒï¼Œvolatile å¹¶ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ï¼ å¦‚ä¸‹ç¨‹åº: 1234567891011121314151617181920212223242526272829303132public class VolatileInc implements Runnable&#123; private static volatile int count = 0 ; //ä½¿ç”¨ volatile ä¿®é¥°åŸºæœ¬æ•°æ®å†…å­˜ä¸èƒ½ä¿è¯åŸå­æ€§ //private static AtomicInteger count = new AtomicInteger() ; @Override public void run() &#123; for (int i=0;i&lt;10000 ;i++)&#123; count ++ ; //count.incrementAndGet() ; &#125; &#125; public static void main(String[] args) throws InterruptedException &#123; VolatileInc volatileInc = new VolatileInc() ; Thread t1 = new Thread(volatileInc,"t1") ; Thread t2 = new Thread(volatileInc,"t2") ; t1.start(); //t1.join(); t2.start(); //t2.join(); for (int i=0;i&lt;10000 ;i++)&#123; count ++ ; //count.incrementAndGet(); &#125; System.out.println("æœ€ç»ˆCount="+count); &#125;&#125; å½“æˆ‘ä»¬ä¸‰ä¸ªçº¿ç¨‹(t1,t2,main)åŒæ—¶å¯¹ä¸€ä¸ª int è¿›è¡Œç´¯åŠ æ—¶ä¼šå‘ç°æœ€ç»ˆçš„å€¼éƒ½ä¼šå°äº 30000ã€‚ è¿™æ˜¯å› ä¸ºè™½ç„¶ volatile ä¿è¯äº†å†…å­˜å¯è§æ€§ï¼Œæ¯ä¸ªçº¿ç¨‹æ‹¿åˆ°çš„å€¼éƒ½æ˜¯æœ€æ–°å€¼ï¼Œä½† count ++ è¿™ä¸ªæ“ä½œå¹¶ä¸æ˜¯åŸå­çš„ï¼Œè¿™é‡Œé¢æ¶‰åŠåˆ°è·å–å€¼ã€è‡ªå¢ã€èµ‹å€¼çš„æ“ä½œå¹¶ä¸èƒ½åŒæ—¶å®Œæˆã€‚ æ‰€ä»¥æƒ³åˆ°è¾¾åˆ°çº¿ç¨‹å®‰å…¨å¯ä»¥ä½¿è¿™ä¸‰ä¸ªçº¿ç¨‹ä¸²è¡Œæ‰§è¡Œ(å…¶å®å°±æ˜¯å•çº¿ç¨‹ï¼Œæ²¡æœ‰å‘æŒ¥å¤šçº¿ç¨‹çš„ä¼˜åŠ¿)ã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨ synchronize æˆ–è€…æ˜¯é”çš„æ–¹å¼æ¥ä¿è¯åŸå­æ€§ã€‚ è¿˜å¯ä»¥ç”¨ Atomic åŒ…ä¸­ AtomicInteger æ¥æ›¿æ¢ intï¼Œå®ƒåˆ©ç”¨äº† CAS ç®—æ³•æ¥ä¿è¯äº†åŸå­æ€§ã€‚ æŒ‡ä»¤é‡æ’å†…å­˜å¯è§æ€§åªæ˜¯ volatile çš„å…¶ä¸­ä¸€ä¸ªè¯­ä¹‰ï¼Œå®ƒè¿˜å¯ä»¥é˜²æ­¢ JVM è¿›è¡ŒæŒ‡ä»¤é‡æ’ä¼˜åŒ–ã€‚ ä¸¾ä¸€ä¸ªä¼ªä»£ç : 123int a=10 ;//1int b=20 ;//2int c= a+b ;//3 ä¸€æ®µç‰¹åˆ«ç®€å•çš„ä»£ç ï¼Œç†æƒ³æƒ…å†µä¸‹å®ƒçš„æ‰§è¡Œé¡ºåºæ˜¯ï¼š1&gt;2&gt;3ã€‚ä½†æœ‰å¯èƒ½ç»è¿‡ JVM ä¼˜åŒ–ä¹‹åçš„æ‰§è¡Œé¡ºåºå˜ä¸ºäº† 2&gt;1&gt;3ã€‚ å¯ä»¥å‘ç°ä¸ç®¡ JVM æ€ä¹ˆä¼˜åŒ–ï¼Œå‰æéƒ½æ˜¯ä¿è¯å•çº¿ç¨‹ä¸­æœ€ç»ˆç»“æœä¸å˜çš„æƒ…å†µä¸‹è¿›è¡Œçš„ã€‚ å¯èƒ½è¿™é‡Œè¿˜çœ‹ä¸å‡ºæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œé‚£çœ‹ä¸‹ä¸€æ®µä¼ªä»£ç : 12345678910111213141516171819private static Map&lt;String,String&gt; value ;private static volatile boolean flag = fasle ;//ä»¥ä¸‹æ–¹æ³•å‘ç”Ÿåœ¨çº¿ç¨‹ A ä¸­ åˆå§‹åŒ– Mappublic void initMap()&#123; //è€—æ—¶æ“ä½œ value = getMapValue() ;//1 flag = true ;//2&#125;//å‘ç”Ÿåœ¨çº¿ç¨‹ Bä¸­ ç­‰åˆ° Map åˆå§‹åŒ–æˆåŠŸè¿›è¡Œå…¶ä»–æ“ä½œpublic void doSomeThing()&#123; while(!flag)&#123; sleep() ; &#125; //dosomething doSomeThing(value);&#125; è¿™é‡Œå°±èƒ½çœ‹å‡ºé—®é¢˜äº†ï¼Œå½“ flag æ²¡æœ‰è¢« volatile ä¿®é¥°æ—¶ï¼ŒJVM å¯¹ 1 å’Œ 2 è¿›è¡Œé‡æ’ï¼Œå¯¼è‡´ value éƒ½è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–å°±æœ‰å¯èƒ½è¢«çº¿ç¨‹ B ä½¿ç”¨äº†ã€‚ æ‰€ä»¥åŠ ä¸Š volatile ä¹‹åå¯ä»¥é˜²æ­¢è¿™æ ·çš„é‡æ’ä¼˜åŒ–ï¼Œä¿è¯ä¸šåŠ¡çš„æ­£ç¡®æ€§ã€‚ æŒ‡ä»¤é‡æ’çš„çš„åº”ç”¨ä¸€ä¸ªç»å…¸çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯åŒé‡æ‡’åŠ è½½çš„å•ä¾‹æ¨¡å¼äº†: 12345678910111213141516171819public class Singleton &#123; private static volatile Singleton singleton; private Singleton() &#123; &#125; public static Singleton getInstance() &#123; if (singleton == null) &#123; synchronized (Singleton.class) &#123; if (singleton == null) &#123; //é˜²æ­¢æŒ‡ä»¤é‡æ’ singleton = new Singleton(); &#125; &#125; &#125; return singleton; &#125;&#125; è¿™é‡Œçš„ volatile å…³é”®å­—ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢æŒ‡ä»¤é‡æ’ã€‚ å¦‚æœä¸ç”¨ ï¼Œsingleton = new Singleton();ï¼Œè¿™æ®µä»£ç å…¶å®æ˜¯åˆ†ä¸ºä¸‰æ­¥ï¼š åˆ†é…å†…å­˜ç©ºé—´ã€‚(1) åˆå§‹åŒ–å¯¹è±¡ã€‚(2) å°† singleton å¯¹è±¡æŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€ã€‚(3) åŠ ä¸Š volatile æ˜¯ä¸ºäº†è®©ä»¥ä¸Šçš„ä¸‰æ­¥æ“ä½œé¡ºåºæ‰§è¡Œï¼Œåä¹‹æœ‰å¯èƒ½ç¬¬äºŒæ­¥åœ¨ç¬¬ä¸‰æ­¥ä¹‹å‰è¢«æ‰§è¡Œå°±æœ‰å¯èƒ½æŸä¸ªçº¿ç¨‹æ‹¿åˆ°çš„å•ä¾‹å¯¹è±¡æ˜¯è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„ï¼Œä»¥è‡´äºæŠ¥é”™ã€‚ æ€»ç»“volatile åœ¨ Java å¹¶å‘ä¸­ç”¨çš„å¾ˆå¤šï¼Œæ¯”å¦‚åƒ Atomic åŒ…ä¸­çš„ valueã€ä»¥åŠ AbstractQueuedLongSynchronizer ä¸­çš„ state éƒ½æ˜¯è¢«å®šä¹‰ä¸º volatile æ¥ç”¨äºä¿è¯å†…å­˜å¯è§æ€§ã€‚ å°†è¿™å—ç†è§£é€å½»å¯¹æˆ‘ä»¬ç¼–å†™å¹¶å‘ç¨‹åºæ—¶å¯ä»¥æä¾›å¾ˆå¤§å¸®åŠ©ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>volatile</tag>
        <tag>concurrent</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LinkedHashMap åº•å±‚åˆ†æ]]></title>
    <url>%2F2018%2F02%2F06%2FLinkedHashMap%2F</url>
    <content type="text"><![CDATA[ä¼—æ‰€å‘¨çŸ¥ HashMap æ˜¯ä¸€ä¸ªæ— åºçš„ Mapï¼Œå› ä¸ºæ¯æ¬¡æ ¹æ® key çš„ hashcode æ˜ å°„åˆ° Entry æ•°ç»„ä¸Šï¼Œæ‰€ä»¥éå†å‡ºæ¥çš„é¡ºåºå¹¶ä¸æ˜¯å†™å…¥çš„é¡ºåºã€‚ å› æ­¤ JDK æ¨å‡ºä¸€ä¸ªåŸºäº HashMap ä½†å…·æœ‰é¡ºåºçš„ LinkedHashMap æ¥è§£å†³æœ‰æ’åºéœ€æ±‚çš„åœºæ™¯ã€‚ å®ƒçš„åº•å±‚æ˜¯ç»§æ‰¿äº HashMap å®ç°çš„ï¼Œç”±ä¸€ä¸ªåŒå‘é“¾è¡¨æ‰€æ„æˆã€‚ LinkedHashMap çš„æ’åºæ–¹å¼æœ‰ä¸¤ç§ï¼š æ ¹æ®å†™å…¥é¡ºåºæ’åºã€‚ æ ¹æ®è®¿é—®é¡ºåºæ’åºã€‚ å…¶ä¸­æ ¹æ®è®¿é—®é¡ºåºæ’åºæ—¶ï¼Œæ¯æ¬¡ get éƒ½ä¼šå°†è®¿é—®çš„å€¼ç§»åŠ¨åˆ°é“¾è¡¨æœ«å°¾ï¼Œè¿™æ ·é‡å¤æ“ä½œå°±èƒ½çš„åˆ°ä¸€ä¸ªæŒ‰ç…§è®¿é—®é¡ºåºæ’åºçš„é“¾è¡¨ã€‚ æ•°æ®ç»“æ„1234567891011@Testpublic void test()&#123; Map&lt;String, Integer&gt; map = new LinkedHashMap&lt;String, Integer&gt;(); map.put("1",1) ; map.put("2",2) ; map.put("3",3) ; map.put("4",4) ; map.put("5",5) ; System.out.println(map.toString());&#125; è°ƒè¯•å¯ä»¥çœ‹åˆ° map çš„ç»„æˆï¼š æ‰“å¼€æºç å¯ä»¥çœ‹åˆ°ï¼š 123456789101112131415161718192021/** * The head of the doubly linked list. */private transient Entry&lt;K,V&gt; header;/** * The iteration ordering method for this linked hash map: &lt;tt&gt;true&lt;/tt&gt; * for access-order, &lt;tt&gt;false&lt;/tt&gt; for insertion-order. * * @serial */private final boolean accessOrder;private static class Entry&lt;K,V&gt; extends HashMap.Entry&lt;K,V&gt; &#123; // These fields comprise the doubly linked list used for iteration. Entry&lt;K,V&gt; before, after; Entry(int hash, K key, V value, HashMap.Entry&lt;K,V&gt; next) &#123; super(hash, key, value, next); &#125;&#125; å…¶ä¸­ Entry ç»§æ‰¿äº HashMap çš„ Entryï¼Œå¹¶æ–°å¢äº†ä¸Šä¸‹èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä¹Ÿå°±å½¢æˆäº†åŒå‘é“¾è¡¨ã€‚ è¿˜æœ‰ä¸€ä¸ª header çš„æˆå‘˜å˜é‡ï¼Œæ˜¯è¿™ä¸ªåŒå‘é“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚ ä¸Šè¾¹çš„ demo æ€»ç»“æˆä¸€å¼ å›¾å¦‚ä¸‹ï¼š ç¬¬ä¸€ä¸ªç±»ä¼¼äº HashMap çš„ç»“æ„ï¼Œåˆ©ç”¨ Entry ä¸­çš„ next æŒ‡é’ˆè¿›è¡Œå…³è”ã€‚ ä¸‹è¾¹åˆ™æ˜¯ LinkedHashMap å¦‚ä½•è¾¾åˆ°æœ‰åºçš„å…³é”®ã€‚ å°±æ˜¯åˆ©ç”¨äº†å¤´èŠ‚ç‚¹å’Œå…¶ä½™çš„å„ä¸ªèŠ‚ç‚¹ä¹‹é—´é€šè¿‡ Entry ä¸­çš„ after å’Œ before æŒ‡é’ˆè¿›è¡Œå…³è”ã€‚ å…¶ä¸­è¿˜æœ‰ä¸€ä¸ª accessOrder æˆå‘˜å˜é‡ï¼Œé»˜è®¤æ˜¯ falseï¼Œé»˜è®¤æŒ‰ç…§æ’å…¥é¡ºåºæ’åºï¼Œä¸º true æ—¶æŒ‰ç…§è®¿é—®é¡ºåºæ’åºï¼Œä¹Ÿå¯ä»¥è°ƒç”¨: 123456public LinkedHashMap(int initialCapacity, float loadFactor, boolean accessOrder) &#123; super(initialCapacity, loadFactor); this.accessOrder = accessOrder;&#125; è¿™ä¸ªæ„é€ æ–¹æ³•å¯ä»¥æ˜¾ç¤ºçš„ä¼ å…¥ accessOrderã€‚ æ„é€ æ–¹æ³•LinkedHashMap çš„æ„é€ æ–¹æ³•: 1234public LinkedHashMap() &#123; super(); accessOrder = false;&#125; å…¶å®å°±æ˜¯è°ƒç”¨çš„ HashMap çš„æ„é€ æ–¹æ³•: HashMap å®ç°ï¼š 123456789101112131415public HashMap(int initialCapacity, float loadFactor) &#123; if (initialCapacity &lt; 0) throw new IllegalArgumentException("Illegal initial capacity: " + initialCapacity); if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException("Illegal load factor: " + loadFactor); this.loadFactor = loadFactor; threshold = initialCapacity; //HashMap åªæ˜¯å®šä¹‰äº†æ”¹æ–¹æ³•ï¼Œå…·ä½“å®ç°äº¤ç»™äº† LinkedHashMap init();&#125; å¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰ä¸€ä¸ªç©ºçš„ init()ï¼Œå…·ä½“æ˜¯ç”± LinkedHashMap æ¥å®ç°çš„ï¼š 12345@Overridevoid init() &#123; header = new Entry&lt;&gt;(-1, null, null, null); header.before = header.after = header;&#125; å…¶å®ä¹Ÿå°±æ˜¯å¯¹ header è¿›è¡Œäº†åˆå§‹åŒ–ã€‚ put æ–¹æ³•çœ‹ LinkedHashMap çš„ put() æ–¹æ³•ä¹‹å‰å…ˆçœ‹çœ‹ HashMap çš„ put æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142public V put(K key, V value) &#123; if (table == EMPTY_TABLE) &#123; inflateTable(threshold); &#125; if (key == null) return putForNullKey(value); int hash = hash(key); int i = indexFor(hash, table.length); for (Entry&lt;K,V&gt; e = table[i]; e != null; e = e.next) &#123; Object k; if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123; V oldValue = e.value; e.value = value; //ç©ºå®ç°ï¼Œäº¤ç»™ LinkedHashMap è‡ªå·±å®ç° e.recordAccess(this); return oldValue; &#125; &#125; modCount++; // LinkedHashMap å¯¹å…¶é‡å†™ addEntry(hash, key, value, i); return null;&#125;// LinkedHashMap å¯¹å…¶é‡å†™void addEntry(int hash, K key, V value, int bucketIndex) &#123; if ((size &gt;= threshold) &amp;&amp; (null != table[bucketIndex])) &#123; resize(2 * table.length); hash = (null != key) ? hash(key) : 0; bucketIndex = indexFor(hash, table.length); &#125; createEntry(hash, key, value, bucketIndex);&#125;// LinkedHashMap å¯¹å…¶é‡å†™void createEntry(int hash, K key, V value, int bucketIndex) &#123; Entry&lt;K,V&gt; e = table[bucketIndex]; table[bucketIndex] = new Entry&lt;&gt;(hash, key, value, e); size++;&#125; ä¸»ä½“çš„å®ç°éƒ½æ˜¯å€ŸåŠ©äº HashMap æ¥å®Œæˆçš„ï¼Œåªæ˜¯å¯¹å…¶ä¸­çš„ recordAccess(), addEntry(), createEntry() è¿›è¡Œäº†é‡å†™ã€‚ LinkedHashMap çš„å®ç°ï¼š 1234567891011121314151617181920212223242526272829303132333435363738 //å°±æ˜¯åˆ¤æ–­æ˜¯å¦æ˜¯æ ¹æ®è®¿é—®é¡ºåºæ’åºï¼Œå¦‚æœæ˜¯åˆ™éœ€è¦å°†å½“å‰è¿™ä¸ª Entry ç§»åŠ¨åˆ°é“¾è¡¨çš„æœ«å°¾ void recordAccess(HashMap&lt;K,V&gt; m) &#123; LinkedHashMap&lt;K,V&gt; lm = (LinkedHashMap&lt;K,V&gt;)m; if (lm.accessOrder) &#123; lm.modCount++; remove(); addBefore(lm.header); &#125; &#125; //è°ƒç”¨äº† HashMap çš„å®ç°ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ é™¤æœ€å°‘ä½¿ç”¨çš„ Entry(é»˜è®¤ä¸åˆ é™¤) void addEntry(int hash, K key, V value, int bucketIndex) &#123; super.addEntry(hash, key, value, bucketIndex); // Remove eldest entry if instructed Entry&lt;K,V&gt; eldest = header.after; if (removeEldestEntry(eldest)) &#123; removeEntryForKey(eldest.key); &#125;&#125;void createEntry(int hash, K key, V value, int bucketIndex) &#123; HashMap.Entry&lt;K,V&gt; old = table[bucketIndex]; Entry&lt;K,V&gt; e = new Entry&lt;&gt;(hash, key, value, old); //å°±å¤šäº†è¿™ä¸€æ­¥ï¼Œå°†æ–°å¢çš„ Entry åŠ å…¥åˆ° header åŒå‘é“¾è¡¨ä¸­ table[bucketIndex] = e; e.addBefore(header); size++;&#125; //å†™å…¥åˆ°åŒå‘é“¾è¡¨ä¸­ private void addBefore(Entry&lt;K,V&gt; existingEntry) &#123; after = existingEntry; before = existingEntry.before; before.after = this; after.before = this; &#125; get æ–¹æ³•LinkedHashMap çš„ get() æ–¹æ³•ä¹Ÿé‡å†™äº†ï¼š 123456789101112131415161718192021public V get(Object key) &#123; Entry&lt;K,V&gt; e = (Entry&lt;K,V&gt;)getEntry(key); if (e == null) return null; //å¤šäº†ä¸€ä¸ªåˆ¤æ–­æ˜¯å¦æ˜¯æŒ‰ç…§è®¿é—®é¡ºåºæ’åºï¼Œæ˜¯åˆ™å°†å½“å‰çš„ Entry ç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨ã€‚ e.recordAccess(this); return e.value;&#125;void recordAccess(HashMap&lt;K,V&gt; m) &#123; LinkedHashMap&lt;K,V&gt; lm = (LinkedHashMap&lt;K,V&gt;)m; if (lm.accessOrder) &#123; lm.modCount++; //åˆ é™¤ remove(); //æ·»åŠ åˆ°å¤´éƒ¨ addBefore(lm.header); &#125;&#125; clear() æ¸…ç©ºå°±è¦æ¯”è¾ƒç®€å•äº†ï¼š 12345//åªéœ€è¦æŠŠæŒ‡é’ˆéƒ½æŒ‡å‘è‡ªå·±å³å¯ï¼ŒåŸæœ¬é‚£äº› Entry æ²¡æœ‰å¼•ç”¨ä¹‹åå°±ä¼šè¢« JVM è‡ªåŠ¨å›æ”¶ã€‚public void clear() &#123; super.clear(); header.before = header.after = header;&#125; æ€»ç»“æ€»çš„æ¥è¯´ LinkedHashMap å…¶å®å°±æ˜¯å¯¹ HashMap è¿›è¡Œäº†æ‹“å±•ï¼Œä½¿ç”¨äº†åŒå‘é“¾è¡¨æ¥ä¿è¯äº†é¡ºåºæ€§ã€‚ å› ä¸ºæ˜¯ç»§æ‰¿ä¸ HashMap çš„ï¼Œæ‰€ä»¥ä¸€äº› HashMap å­˜åœ¨çš„é—®é¢˜ LinkedHashMap ä¹Ÿä¼šå­˜åœ¨ï¼Œæ¯”å¦‚ä¸æ”¯æŒå¹¶å‘ç­‰ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>LinkedHashMap</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ReentrantLock å®ç°åŸç†]]></title>
    <url>%2F2018%2F01%2F25%2FReentrantLock%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨ synchronize æ¥åšåŒæ­¥å¤„ç†æ—¶ï¼Œé”çš„è·å–å’Œé‡Šæ”¾éƒ½æ˜¯éšå¼çš„ï¼Œå®ç°çš„åŸç†æ˜¯é€šè¿‡ç¼–è¯‘ååŠ ä¸Šä¸åŒçš„æœºå™¨æŒ‡ä»¤æ¥å®ç°ã€‚ è€Œ ReentrantLock å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ç±»ï¼Œå®ƒæ˜¯åŸºäº AQS(AbstractQueuedSynchronizer)æ¥å®ç°çš„ã€‚ æ˜¯ä¸€ä¸ªé‡å…¥é”ï¼šä¸€ä¸ªçº¿ç¨‹è·å¾—äº†é”ä¹‹åä»ç„¶å¯ä»¥åå¤çš„åŠ é”ï¼Œä¸ä¼šå‡ºç°è‡ªå·±é˜»å¡è‡ªå·±çš„æƒ…å†µã€‚ AQS æ˜¯ Java å¹¶å‘åŒ…é‡Œå®ç°é”ã€åŒæ­¥çš„ä¸€ä¸ªé‡è¦çš„åŸºç¡€æ¡†æ¶ã€‚ é”ç±»å‹ReentrantLock åˆ†ä¸ºå…¬å¹³é”å’Œéå…¬å¹³é”ï¼Œå¯ä»¥é€šè¿‡æ„é€ æ–¹æ³•æ¥æŒ‡å®šå…·ä½“ç±»å‹ï¼š 123456789//é»˜è®¤éå…¬å¹³é”public ReentrantLock() &#123; sync = new NonfairSync();&#125;//å…¬å¹³é”public ReentrantLock(boolean fair) &#123; sync = fair ? new FairSync() : new NonfairSync();&#125; é»˜è®¤ä¸€èˆ¬ä½¿ç”¨éå…¬å¹³é”ï¼Œå®ƒçš„æ•ˆç‡å’Œååé‡éƒ½æ¯”å…¬å¹³é”é«˜çš„å¤š(åé¢ä¼šåˆ†æå…·ä½“åŸå› )ã€‚ è·å–é”é€šå¸¸çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹: 1234567891011private ReentrantLock lock = new ReentrantLock();public void run() &#123; lock.lock(); try &#123; //do bussiness &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; lock.unlock(); &#125;&#125; å…¬å¹³é”è·å–é”é¦–å…ˆçœ‹ä¸‹è·å–é”çš„è¿‡ç¨‹ï¼š 123public void lock() &#123; sync.lock();&#125; å¯ä»¥çœ‹åˆ°æ˜¯ä½¿ç”¨ syncçš„æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå…·ä½“æ˜¯ç”±å…¶å­ç±»(FairSync)æ¥å®ç°çš„ï¼Œä»¥ä¸‹æ˜¯å…¬å¹³é”çš„å®ç°: 12345678910 final void lock() &#123; acquire(1); &#125; //AbstractQueuedSynchronizer ä¸­çš„ acquire() public final void acquire(int arg) &#123; if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) selfInterrupt();&#125; ç¬¬ä¸€æ­¥æ˜¯å°è¯•è·å–é”(tryAcquire(arg)),è¿™ä¸ªä¹Ÿæ˜¯ç”±å…¶å­ç±»å®ç°ï¼š 1234567891011121314151617181920 protected final boolean tryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) &#123; if (!hasQueuedPredecessors() &amp;&amp; compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) throw new Error("Maximum lock count exceeded"); setState(nextc); return true; &#125; return false; &#125;&#125; é¦–å…ˆä¼šåˆ¤æ–­ AQS ä¸­çš„ state æ˜¯å¦ç­‰äº 0ï¼Œ0 è¡¨ç¤ºç›®å‰æ²¡æœ‰å…¶ä»–çº¿ç¨‹è·å¾—é”ï¼Œå½“å‰çº¿ç¨‹å°±å¯ä»¥å°è¯•è·å–é”ã€‚ æ³¨æ„:å°è¯•ä¹‹å‰ä¼šåˆ©ç”¨ hasQueuedPredecessors() æ–¹æ³•æ¥åˆ¤æ–­ AQS çš„é˜Ÿåˆ—ä¸­ä¸­æ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹ï¼Œå¦‚æœæœ‰åˆ™ä¸ä¼šå°è¯•è·å–é”(è¿™æ˜¯å…¬å¹³é”ç‰¹æœ‰çš„æƒ…å†µ)ã€‚ å¦‚æœé˜Ÿåˆ—ä¸­æ²¡æœ‰çº¿ç¨‹å°±åˆ©ç”¨ CAS æ¥å°† AQS ä¸­çš„ state ä¿®æ”¹ä¸º1ï¼Œä¹Ÿå°±æ˜¯è·å–é”ï¼Œè·å–æˆåŠŸåˆ™å°†å½“å‰çº¿ç¨‹ç½®ä¸ºè·å¾—é”çš„ç‹¬å çº¿ç¨‹(setExclusiveOwnerThread(current))ã€‚ å¦‚æœ state å¤§äº 0 æ—¶ï¼Œè¯´æ˜é”å·²ç»è¢«è·å–äº†ï¼Œåˆ™éœ€è¦åˆ¤æ–­è·å–é”çš„çº¿ç¨‹æ˜¯å¦ä¸ºå½“å‰çº¿ç¨‹(ReentrantLock æ”¯æŒé‡å…¥)ï¼Œæ˜¯åˆ™éœ€è¦å°† state + 1ï¼Œå¹¶å°†å€¼æ›´æ–°ã€‚ å†™å…¥é˜Ÿåˆ—å¦‚æœ tryAcquire(arg) è·å–é”å¤±è´¥ï¼Œåˆ™éœ€è¦ç”¨ addWaiter(Node.EXCLUSIVE) å°†å½“å‰çº¿ç¨‹å†™å…¥é˜Ÿåˆ—ä¸­ã€‚ å†™å…¥ä¹‹å‰éœ€è¦å°†å½“å‰çº¿ç¨‹åŒ…è£…ä¸ºä¸€ä¸ª Node å¯¹è±¡(addWaiter(Node.EXCLUSIVE))ã€‚ AQS ä¸­çš„é˜Ÿåˆ—æ˜¯ç”± Node èŠ‚ç‚¹ç»„æˆçš„åŒå‘é“¾è¡¨å®ç°çš„ã€‚ åŒ…è£…ä»£ç : 1234567891011121314private Node addWaiter(Node mode) &#123; Node node = new Node(Thread.currentThread(), mode); // Try the fast path of enq; backup to full enq on failure Node pred = tail; if (pred != null) &#123; node.prev = pred; if (compareAndSetTail(pred, node)) &#123; pred.next = node; return node; &#125; &#125; enq(node); return node;&#125; é¦–å…ˆåˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºæ—¶åˆ™å°†å°è£…å¥½çš„ Node åˆ©ç”¨ CAS å†™å…¥é˜Ÿå°¾ï¼Œå¦‚æœå‡ºç°å¹¶å‘å†™å…¥å¤±è´¥å°±éœ€è¦è°ƒç”¨ enq(node); æ¥å†™å…¥äº†ã€‚ 123456789101112131415private Node enq(final Node node) &#123; for (;;) &#123; Node t = tail; if (t == null) &#123; // Must initialize if (compareAndSetHead(new Node())) tail = head; &#125; else &#123; node.prev = t; if (compareAndSetTail(t, node)) &#123; t.next = node; return t; &#125; &#125; &#125;&#125; è¿™ä¸ªå¤„ç†é€»è¾‘å°±ç›¸å½“äºè‡ªæ—‹åŠ ä¸Š CAS ä¿è¯ä¸€å®šèƒ½å†™å…¥é˜Ÿåˆ—ã€‚ æŒ‚èµ·ç­‰å¾…çº¿ç¨‹å†™å…¥é˜Ÿåˆ—ä¹‹åéœ€è¦å°†å½“å‰çº¿ç¨‹æŒ‚èµ·(åˆ©ç”¨acquireQueued(addWaiter(Node.EXCLUSIVE), arg))ï¼š 123456789101112131415161718192021final boolean acquireQueued(final Node node, int arg) &#123; boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; final Node p = node.predecessor(); if (p == head &amp;&amp; tryAcquire(arg)) &#123; setHead(node); p.next = null; // help GC failed = false; return interrupted; &#125; if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; é¦–å…ˆä¼šæ ¹æ® node.predecessor() è·å–åˆ°ä¸Šä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸ºå¤´èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯åˆ™å°è¯•è·å–ä¸€æ¬¡é”ï¼Œè·å–æˆåŠŸå°±ä¸‡äº‹å¤§å‰äº†ã€‚ å¦‚æœä¸æ˜¯å¤´èŠ‚ç‚¹ï¼Œæˆ–è€…è·å–é”å¤±è´¥ï¼Œåˆ™ä¼šæ ¹æ®ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„ waitStatus çŠ¶æ€æ¥å¤„ç†(shouldParkAfterFailedAcquire(p, node))ã€‚ waitStatus ç”¨äºè®°å½•å½“å‰èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œå¦‚èŠ‚ç‚¹å–æ¶ˆã€èŠ‚ç‚¹ç­‰å¾…ç­‰ã€‚ shouldParkAfterFailedAcquire(p, node) è¿”å›å½“å‰çº¿ç¨‹æ˜¯å¦éœ€è¦æŒ‚èµ·ï¼Œå¦‚æœéœ€è¦åˆ™è°ƒç”¨ parkAndCheckInterrupt()ï¼š 1234private final boolean parkAndCheckInterrupt() &#123; LockSupport.park(this); return Thread.interrupted();&#125; ä»–æ˜¯åˆ©ç”¨ LockSupport çš„ part æ–¹æ³•æ¥æŒ‚èµ·å½“å‰çº¿ç¨‹çš„ï¼Œç›´åˆ°è¢«å”¤é†’ã€‚ éå…¬å¹³é”è·å–é”å…¬å¹³é”ä¸éå…¬å¹³é”çš„å·®å¼‚ä¸»è¦åœ¨è·å–é”ï¼š å…¬å¹³é”å°±ç›¸å½“äºä¹°ç¥¨ï¼Œåæ¥çš„äººéœ€è¦æ’åˆ°é˜Ÿå°¾ä¾æ¬¡ä¹°ç¥¨ï¼Œä¸èƒ½æ’é˜Ÿã€‚ è€Œéå…¬å¹³é”åˆ™æ²¡æœ‰è¿™äº›è§„åˆ™ï¼Œæ˜¯æŠ¢å æ¨¡å¼ï¼Œæ¯æ¥ä¸€ä¸ªäººä¸ä¼šå»ç®¡é˜Ÿåˆ—å¦‚ä½•ï¼Œç›´æ¥å°è¯•è·å–é”ã€‚ éå…¬å¹³é”:1234567final void lock() &#123; //ç›´æ¥å°è¯•è·å–é” if (compareAndSetState(0, 1)) setExclusiveOwnerThread(Thread.currentThread()); else acquire(1);&#125; å…¬å¹³é”:123final void lock() &#123; acquire(1);&#125; è¿˜è¦ä¸€ä¸ªé‡è¦çš„åŒºåˆ«æ˜¯åœ¨å°è¯•è·å–é”æ—¶tryAcquire(arg)ï¼Œéå…¬å¹³é”æ˜¯ä¸éœ€è¦åˆ¤æ–­é˜Ÿåˆ—ä¸­æ˜¯å¦è¿˜æœ‰å…¶ä»–çº¿ç¨‹ï¼Œä¹Ÿæ˜¯ç›´æ¥å°è¯•è·å–é”ï¼š 12345678910111213141516171819final boolean nonfairTryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) &#123; //æ²¡æœ‰ !hasQueuedPredecessors() åˆ¤æ–­ if (compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) // overflow throw new Error("Maximum lock count exceeded"); setState(nextc); return true; &#125; return false;&#125; é‡Šæ”¾é”å…¬å¹³é”å’Œéå…¬å¹³é”çš„é‡Šæ”¾æµç¨‹éƒ½æ˜¯ä¸€æ ·çš„ï¼š 12345678910111213141516171819202122232425262728public void unlock() &#123; sync.release(1);&#125;public final boolean release(int arg) &#123; if (tryRelease(arg)) &#123; Node h = head; if (h != null &amp;&amp; h.waitStatus != 0) //å”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹ unparkSuccessor(h); return true; &#125; return false;&#125;//å°è¯•é‡Šæ”¾é”protected final boolean tryRelease(int releases) &#123; int c = getState() - releases; if (Thread.currentThread() != getExclusiveOwnerThread()) throw new IllegalMonitorStateException(); boolean free = false; if (c == 0) &#123; free = true; setExclusiveOwnerThread(null); &#125; setState(c); return free;&#125; é¦–å…ˆä¼šåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºè·å¾—é”çš„çº¿ç¨‹ï¼Œç”±äºæ˜¯é‡å…¥é”æ‰€ä»¥éœ€è¦å°† state å‡åˆ° 0 æ‰è®¤ä¸ºå®Œå…¨é‡Šæ”¾é”ã€‚ é‡Šæ”¾ä¹‹åéœ€è¦è°ƒç”¨ unparkSuccessor(h) æ¥å”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹ã€‚ æ€»ç»“ç”±äºå…¬å¹³é”éœ€è¦å…³å¿ƒé˜Ÿåˆ—çš„æƒ…å†µï¼Œå¾—æŒ‰ç…§é˜Ÿåˆ—é‡Œçš„å…ˆåé¡ºåºæ¥è·å–é”(ä¼šé€ æˆå¤§é‡çš„çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢)ï¼Œè€Œéå…¬å¹³é”åˆ™æ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‚ æ‰€ä»¥ä¹Ÿå°±èƒ½è§£é‡Šéå…¬å¹³é”çš„æ•ˆç‡ä¼šè¢«å…¬å¹³é”æ›´é«˜ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ReentrantLock</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¯¹è±¡çš„åˆ›å»ºä¸å†…å­˜åˆ†é…]]></title>
    <url>%2F2018%2F01%2F18%2FnewObject%2F</url>
    <content type="text"><![CDATA[åˆ›å»ºå¯¹è±¡å½“ JVM æ”¶åˆ°ä¸€ä¸ª new æŒ‡ä»¤æ—¶ï¼Œä¼šæ£€æŸ¥æŒ‡ä»¤ä¸­çš„å‚æ•°åœ¨å¸¸é‡æ± æ˜¯å¦æœ‰è¿™ä¸ªç¬¦å·çš„å¼•ç”¨ï¼Œè¿˜ä¼šæ£€æŸ¥è¯¥ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡äº†ï¼Œå¦‚æœæ²¡æœ‰çš„è¯åˆ™è¦è¿›è¡Œä¸€æ¬¡ç±»åŠ è½½ã€‚ æ¥ç€å°±æ˜¯åˆ†é…å†…å­˜äº†ï¼Œé€šå¸¸æœ‰ä¸¤ç§æ–¹å¼ï¼š æŒ‡é’ˆç¢°æ’ ç©ºé—²åˆ—è¡¨ ä½¿ç”¨æŒ‡é’ˆç¢°æ’çš„å‰ææ˜¯å †å†…å­˜æ˜¯å®Œå…¨å·¥æ•´çš„ï¼Œç”¨è¿‡çš„å†…å­˜å’Œæ²¡ç”¨çš„å†…å­˜å„åœ¨ä¸€è¾¹æ¯æ¬¡åˆ†é…çš„æ—¶å€™åªéœ€è¦å°†æŒ‡é’ˆå‘ç©ºé—²å†…å­˜ä¸€æ–¹ç§»åŠ¨ä¸€æ®µå’Œå†…å­˜å¤§å°ç›¸ç­‰åŒºåŸŸå³å¯ã€‚ å½“å †ä¸­å·²ç»ä½¿ç”¨çš„å†…å­˜å’Œæœªä½¿ç”¨çš„å†…å­˜äº’ç›¸äº¤é”™æ—¶ï¼ŒæŒ‡é’ˆç¢°æ’çš„æ–¹å¼å°±è¡Œä¸é€šäº†ï¼Œè¿™æ—¶å°±éœ€è¦é‡‡ç”¨ç©ºé—²åˆ—è¡¨çš„æ–¹å¼ã€‚è™šæ‹Ÿæœºä¼šç»´æŠ¤ä¸€ä¸ªç©ºé—²çš„åˆ—è¡¨ï¼Œç”¨äºè®°å½•å“ªäº›å†…å­˜æ˜¯å¯ä»¥è¿›è¡Œåˆ†é…çš„ï¼Œåˆ†é…æ—¶ç›´æ¥ä»å¯ç”¨å†…å­˜ä¸­ç›´æ¥åˆ†é…å³å¯ã€‚ å †ä¸­çš„å†…å­˜æ˜¯å¦å·¥æ•´æ˜¯æœ‰åƒåœ¾æ”¶é›†å™¨æ¥å†³å®šçš„ï¼Œå¦‚æœå¸¦æœ‰å‹ç¼©åŠŸèƒ½çš„åƒåœ¾æ”¶é›†å™¨å°±æ˜¯é‡‡ç”¨æŒ‡é’ˆç¢°æ’çš„æ–¹å¼æ¥è¿›è¡Œå†…å­˜åˆ†é…çš„ã€‚ åˆ†é…å†…å­˜æ—¶ä¹Ÿä¼šå‡ºç°å¹¶å‘é—®é¢˜: è¿™æ ·å¯ä»¥åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ä½¿ç”¨ CAS è¿™æ ·çš„ä¹è§‚é”æ¥ä¿è¯ã€‚ ä¹Ÿå¯ä»¥å°†å†…å­˜åˆ†é…å®‰æ’åœ¨æ¯ä¸ªçº¿ç¨‹ç‹¬æœ‰çš„ç©ºé—´è¿›è¡Œï¼Œæ¯ä¸ªçº¿ç¨‹é¦–å…ˆåœ¨å †å†…å­˜ä¸­åˆ†é…ä¸€å°å—å†…å­˜ï¼Œç§°ä¸ºæœ¬åœ°åˆ†é…ç¼“å­˜(TLAB : Thread Local Allocation Buffer)ã€‚ åˆ†é…å†…å­˜æ—¶ï¼Œåªéœ€è¦åœ¨è‡ªå·±çš„åˆ†é…ç¼“å­˜ä¸­åˆ†é…å³å¯ï¼Œç”±äºè¿™ä¸ªå†…å­˜åŒºåŸŸæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°å¹¶å‘é—®é¢˜ã€‚ å¯ä»¥ä½¿ç”¨ -XX:+/-UseTLAB å‚æ•°æ¥è®¾å®š JVM æ˜¯å¦å¼€å¯ TLAB ã€‚ å†…å­˜åˆ†é…ä¹‹åéœ€è¦å¯¹è¯¥å¯¹è±¡è¿›è¡Œè®¾ç½®ï¼Œå¦‚å¯¹è±¡å¤´ã€‚å¯¹è±¡å¤´çš„ä¸€äº›åº”ç”¨å¯ä»¥æŸ¥çœ‹ Synchronize å…³é”®å­—åŸç†ã€‚ å¯¹è±¡è®¿é—®ä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºä¹‹åè‡ªç„¶æ˜¯ä¸ºäº†ä½¿ç”¨ï¼Œåœ¨ Java ä¸­æ˜¯é€šè¿‡æ ˆæ¥å¼•ç”¨å †å†…å­˜ä¸­çš„å¯¹è±¡æ¥è¿›è¡Œæ“ä½œçš„ã€‚ å¯¹äºæˆ‘ä»¬å¸¸ç”¨çš„ HotSpot è™šæ‹Ÿæœºæ¥è¯´ï¼Œè¿™æ ·å¼•ç”¨å…³ç³»æ˜¯é€šè¿‡ç›´æ¥æŒ‡é’ˆæ¥å…³è”çš„ã€‚ å¦‚å›¾: è¿™æ ·çš„å¥½å¤„å°±æ˜¯ï¼šåœ¨ Java é‡Œè¿›è¡Œé¢‘ç¹çš„å¯¹è±¡è®¿é—®å¯ä»¥æå‡è®¿é—®é€Ÿåº¦(ç›¸å¯¹äºä½¿ç”¨å¥æŸ„æ± æ¥è¯´)ã€‚ å†…å­˜åˆ†é…Eden åŒºåˆ†é…ç®€å•çš„æ¥è¯´å¯¹è±¡éƒ½æ˜¯åœ¨å †å†…å­˜ä¸­åˆ†é…çš„ï¼Œå¾€ç»†ä¸€ç‚¹çœ‹åˆ™æ˜¯ä¼˜å…ˆåœ¨ Eden åŒºåˆ†é…ã€‚ è¿™é‡Œå°±æ¶‰åŠåˆ°å †å†…å­˜çš„åˆ’åˆ†äº†ï¼Œä¸ºäº†æ–¹ä¾¿åƒåœ¾å›æ”¶ï¼ŒJVM å°†å¯¹å†…å­˜åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚ è€Œæ–°ç”Ÿä»£ä¸­åˆä¼šåˆ’åˆ†ä¸º Eden åŒºï¼Œfrom Survivorã€to Survivor åŒºã€‚ å…¶ä¸­ Eden å’Œ Survivor åŒºçš„æ¯”ä¾‹é»˜è®¤æ˜¯ 8:1:1ï¼Œå½“ç„¶ä¹Ÿæ”¯æŒå‚æ•°è°ƒæ•´ -XX:SurvivorRatio=8ã€‚ å½“åœ¨ Eden åŒºåˆ†é…å†…å­˜ä¸è¶³æ—¶ï¼Œåˆ™ä¼šå‘ç”Ÿ minorGC ï¼Œç”±äº Java å¯¹è±¡å¤šæ•°æ˜¯æœç”Ÿå¤•ç­çš„ç‰¹æ€§ï¼Œæ‰€ä»¥ minorGC é€šå¸¸ä¼šæ¯”è¾ƒé¢‘ç¹ï¼Œæ•ˆç‡ä¹Ÿæ¯”è¾ƒé«˜ã€‚ å½“å‘ç”Ÿ minorGC æ—¶ï¼ŒJVM ä¼šæ ¹æ®å¤åˆ¶ç®—æ³•å°†å­˜æ´»çš„å¯¹è±¡æ‹·è´åˆ°å¦ä¸€ä¸ªæœªä½¿ç”¨çš„ Survivor åŒºï¼Œå¦‚æœ Survivor åŒºå†…å­˜ä¸è¶³æ—¶ï¼Œåˆ™ä¼šä½¿ç”¨åˆ†é…æ‹…ä¿ç­–ç•¥å°†å¯¹è±¡ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ã€‚ è°ˆåˆ° minorGC æ—¶ï¼Œå°±ä¸å¾—ä¸æåˆ° fullGC(majorGC) ï¼Œè¿™æ˜¯æŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„ GC ï¼Œä¸è®ºæ˜¯æ•ˆç‡è¿˜æ˜¯é€Ÿåº¦éƒ½æ¯” minorGC æ…¢çš„å¤šï¼Œå›æ”¶æ—¶è¿˜ä¼šå‘ç”Ÿ stop the world ä½¿ç¨‹åºå‘ç”Ÿåœé¡¿ï¼Œæ‰€ä»¥åº”å½“å°½é‡é¿å…å‘ç”Ÿ fullGC ã€‚ è€å¹´ä»£åˆ†é…ä¹Ÿæœ‰ä¸€äº›æƒ…å†µä¼šå¯¼è‡´å¯¹è±¡ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ï¼Œæ¯”å¦‚å½“åˆ†é…ä¸€ä¸ªå¤§å¯¹è±¡æ—¶(å¤§çš„æ•°ç»„ï¼Œå¾ˆé•¿çš„å­—ç¬¦ä¸²)ï¼Œç”±äº Eden åŒºæ²¡æœ‰è¶³å¤Ÿå¤§çš„è¿ç»­ç©ºé—´æ¥åˆ†é…æ—¶ï¼Œä¼šå¯¼è‡´æå‰è§¦å‘ä¸€æ¬¡ GCï¼Œæ‰€ä»¥å°½é‡åˆ«é¢‘ç¹çš„åˆ›å»ºå¤§å¯¹è±¡ã€‚ å› æ­¤ JVM ä¼šæ ¹æ®ä¸€ä¸ªé˜ˆå€¼æ¥åˆ¤æ–­å¤§äºè¯¥é˜ˆå€¼å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨æ–°ç”Ÿä»£é¢‘ç¹çš„å‘ç”Ÿ GCã€‚ å¯¹äºä¸€äº›åœ¨æ–°ç”Ÿä»£çš„è€å¯¹è±¡ JVM ä¹Ÿä¼šæ ¹æ®æŸç§æœºåˆ¶ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ã€‚ JVM æ˜¯æ ¹æ®è®°å½•å¯¹è±¡å¹´é¾„çš„æ–¹å¼æ¥åˆ¤æ–­è¯¥å¯¹è±¡æ˜¯å¦åº”è¯¥ç§»åŠ¨åˆ°è€å¹´ä»£ï¼Œæ ¹æ®æ–°ç”Ÿä»£çš„å¤åˆ¶ç®—æ³•ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è¢«ç§»åŠ¨åˆ° Survivor åŒºä¹‹å JVM å°±ç»™è¯¥å¯¹è±¡çš„å¹´é¾„è®°ä¸º1ï¼Œæ¯å½“ç†¬è¿‡ä¸€æ¬¡ minorGC åå¯¹è±¡çš„å¹´é¾„å°± +1 ï¼Œç›´åˆ°è¾¾åˆ°é˜ˆå€¼(é»˜è®¤ä¸º15)å°±ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ã€‚ å¯ä»¥ä½¿ç”¨ -XX:MaxTenuringThreshold=15 æ¥é…ç½®è¿™ä¸ªé˜ˆå€¼ã€‚ æ€»ç»“è™½è¯´è¿™äº›å†…å®¹ç•¥æ˜¾æ¯ç‡¥ï¼Œä½†å½“åº”ç”¨å‘ç”Ÿä¸æ­£å¸¸çš„ GC æ—¶ï¼Œå¯ä»¥æ–¹ä¾¿æ›´å¿«çš„å®šä½é—®é¢˜ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[synchronized å…³é”®å­—åŸç†]]></title>
    <url>%2F2018%2F01%2F14%2FSynchronize%2F</url>
    <content type="text"><![CDATA[ä¼—æ‰€å‘¨çŸ¥ synchronized å…³é”®å­—æ˜¯è§£å†³å¹¶å‘é—®é¢˜å¸¸ç”¨è§£å†³æ–¹æ¡ˆï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§ä½¿ç”¨æ–¹å¼: åŒæ­¥æ™®é€šæ–¹æ³•ï¼Œé”çš„æ˜¯å½“å‰å¯¹è±¡ã€‚ åŒæ­¥é™æ€æ–¹æ³•ï¼Œé”çš„æ˜¯å½“å‰ Class å¯¹è±¡ã€‚ åŒæ­¥å—ï¼Œé”çš„æ˜¯ () ä¸­çš„å¯¹è±¡ã€‚ å®ç°åŸç†ï¼šJVM æ˜¯é€šè¿‡è¿›å…¥ã€é€€å‡ºå¯¹è±¡ç›‘è§†å™¨( Monitor )æ¥å®ç°å¯¹æ–¹æ³•ã€åŒæ­¥å—çš„åŒæ­¥çš„ã€‚ å…·ä½“å®ç°æ˜¯åœ¨ç¼–è¯‘ä¹‹ååœ¨åŒæ­¥æ–¹æ³•è°ƒç”¨å‰åŠ å…¥ä¸€ä¸ª monitor.enter æŒ‡ä»¤ï¼Œåœ¨é€€å‡ºæ–¹æ³•å’Œå¼‚å¸¸å¤„æ’å…¥ monitor.exit çš„æŒ‡ä»¤ã€‚ å…¶æœ¬è´¨å°±æ˜¯å¯¹ä¸€ä¸ªå¯¹è±¡ç›‘è§†å™¨( Monitor )è¿›è¡Œè·å–ï¼Œè€Œè¿™ä¸ªè·å–è¿‡ç¨‹å…·æœ‰æ’ä»–æ€§ä»è€Œè¾¾åˆ°äº†åŒä¸€æ—¶åˆ»åªèƒ½ä¸€ä¸ªçº¿ç¨‹è®¿é—®çš„ç›®çš„ã€‚ è€Œå¯¹äºæ²¡æœ‰è·å–åˆ°é”çš„çº¿ç¨‹å°†ä¼šé˜»å¡åˆ°æ–¹æ³•å…¥å£å¤„ï¼Œç›´åˆ°è·å–é”çš„çº¿ç¨‹ monitor.exit ä¹‹åæ‰èƒ½å°è¯•ç»§ç»­è·å–é”ã€‚ æµç¨‹å›¾å¦‚ä¸‹: é€šè¿‡ä¸€æ®µä»£ç æ¥æ¼”ç¤º: 12345public static void main(String[] args) &#123; synchronized (Synchronize.class)&#123; System.out.println("Synchronize"); &#125;&#125; ä½¿ç”¨ javap -c Synchronize å¯ä»¥æŸ¥çœ‹ç¼–è¯‘ä¹‹åçš„å…·ä½“ä¿¡æ¯ã€‚ 123456789101112131415161718192021222324252627282930public class com.crossoverjie.synchronize.Synchronize &#123; public com.crossoverjie.synchronize.Synchronize(); Code: 0: aload_0 1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 4: return public static void main(java.lang.String[]); Code: 0: ldc #2 // class com/crossoverjie/synchronize/Synchronize 2: dup 3: astore_1 **4: monitorenter** 5: getstatic #3 // Field java/lang/System.out:Ljava/io/PrintStream; 8: ldc #4 // String Synchronize 10: invokevirtual #5 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 13: aload_1 **14: monitorexit** 15: goto 23 18: astore_2 19: aload_1 20: monitorexit 21: aload_2 22: athrow 23: return Exception table: from to target type 5 15 18 any 18 21 18 any&#125; å¯ä»¥çœ‹åˆ°åœ¨åŒæ­¥å—çš„å…¥å£å’Œå‡ºå£åˆ†åˆ«æœ‰ monitorenter,monitorexitæŒ‡ä»¤ã€‚ é”ä¼˜åŒ–synchronized å¾ˆå¤šéƒ½ç§°ä¹‹ä¸ºé‡é‡é”ï¼ŒJDK1.6 ä¸­å¯¹ synchronized è¿›è¡Œäº†å„ç§ä¼˜åŒ–ï¼Œä¸ºäº†èƒ½å‡å°‘è·å–å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ¶ˆè€—å¼•å…¥äº†åå‘é”å’Œè½»é‡é”ã€‚ è½»é‡é”å½“ä»£ç è¿›å…¥åŒæ­¥å—æ—¶ï¼Œå¦‚æœåŒæ­¥å¯¹è±¡ä¸ºæ— é”çŠ¶æ€æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šåœ¨æ ˆå¸§ä¸­åˆ›å»ºä¸€ä¸ªé”è®°å½•(Lock Record)åŒºåŸŸï¼ŒåŒæ—¶å°†é”å¯¹è±¡çš„å¯¹è±¡å¤´ä¸­ Mark Word æ‹·è´åˆ°é”è®°å½•ä¸­ï¼Œå†å°è¯•ä½¿ç”¨ CAS å°† Mark Word æ›´æ–°ä¸ºæŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆã€‚ å¦‚æœæ›´æ–°æˆåŠŸï¼Œå½“å‰çº¿ç¨‹å°±è·å¾—äº†é”ã€‚ å¦‚æœæ›´æ–°å¤±è´¥ JVM ä¼šå…ˆæ£€æŸ¥é”å¯¹è±¡çš„ Mark Word æ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„é”è®°å½•ã€‚ å¦‚æœæ˜¯åˆ™è¯´æ˜å½“å‰çº¿ç¨‹æ‹¥æœ‰é”å¯¹è±¡çš„é”ï¼Œå¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å—ã€‚ ä¸æ˜¯åˆ™è¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹æŠ¢å äº†é”ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶ç«äº‰ä¸€æŠŠé”ï¼Œè½»é‡é”å°±ä¼šè†¨èƒ€ä¸ºé‡é‡é”ã€‚ è§£é”è½»é‡é”çš„è§£é”è¿‡ç¨‹ä¹Ÿæ˜¯åˆ©ç”¨ CAS æ¥å®ç°çš„ï¼Œä¼šå°è¯•é”è®°å½•æ›¿æ¢å›é”å¯¹è±¡çš„ Mark Word ã€‚å¦‚æœæ›¿æ¢æˆåŠŸåˆ™è¯´æ˜æ•´ä¸ªåŒæ­¥æ“ä½œå®Œæˆï¼Œå¤±è´¥åˆ™è¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹å°è¯•è·å–é”ï¼Œè¿™æ—¶å°±ä¼šå”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹(æ­¤æ—¶å·²ç»è†¨èƒ€ä¸ºé‡é‡é”) è½»é‡é”èƒ½æå‡æ€§èƒ½çš„åŸå› ï¼š è®¤ä¸ºå¤§å¤šæ•°é”åœ¨æ•´ä¸ªåŒæ­¥å‘¨æœŸéƒ½ä¸å­˜åœ¨ç«äº‰ï¼Œæ‰€ä»¥ä½¿ç”¨ CAS æ¯”ä½¿ç”¨äº’æ–¥å¼€é”€æ›´å°‘ã€‚ä½†å¦‚æœé”ç«äº‰æ¿€çƒˆï¼Œè½»é‡é”å°±ä¸ä½†æœ‰äº’æ–¥çš„å¼€é”€ï¼Œè¿˜æœ‰ CAS çš„å¼€é”€ï¼Œç”šè‡³æ¯”é‡é‡é”æ›´æ…¢ã€‚ åå‘é”ä¸ºäº†è¿›ä¸€æ­¥çš„é™ä½è·å–é”çš„ä»£ä»·ï¼ŒJDK1.6 ä¹‹åè¿˜å¼•å…¥äº†åå‘é”ã€‚ åå‘é”çš„ç‰¹å¾æ˜¯:é”ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œå¹¶ä¸”åº”ç”±ä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å¾—é”ã€‚ å½“çº¿ç¨‹è®¿é—®åŒæ­¥å—æ—¶ï¼Œä¼šä½¿ç”¨ CAS å°†çº¿ç¨‹ ID æ›´æ–°åˆ°é”å¯¹è±¡çš„ Mark Word ä¸­ï¼Œå¦‚æœæ›´æ–°æˆåŠŸåˆ™è·å¾—åå‘é”ï¼Œå¹¶ä¸”ä¹‹åæ¯æ¬¡è¿›å…¥è¿™ä¸ªå¯¹è±¡é”ç›¸å…³çš„åŒæ­¥å—æ—¶éƒ½ä¸éœ€è¦å†æ¬¡è·å–é”äº†ã€‚ é‡Šæ”¾é”å½“æœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹è·å–è¿™ä¸ªé”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹å°±ä¼šé‡Šæ”¾é”ï¼Œé‡Šæ”¾æ—¶ä¼šç­‰å¾…å…¨å±€å®‰å…¨ç‚¹(è¿™ä¸€æ—¶åˆ»æ²¡æœ‰å­—èŠ‚ç è¿è¡Œ)ï¼Œæ¥ç€ä¼šæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œæ ¹æ®é”å¯¹è±¡ç›®å‰æ˜¯å¦è¢«é”æ¥åˆ¤å®šå°†å¯¹è±¡å¤´ä¸­çš„ Mark Word è®¾ç½®ä¸ºæ— é”æˆ–è€…æ˜¯è½»é‡é”çŠ¶æ€ã€‚ åå‘é”å¯ä»¥æé«˜å¸¦æœ‰åŒæ­¥å´æ²¡æœ‰ç«äº‰çš„ç¨‹åºæ€§èƒ½ï¼Œä½†å¦‚æœç¨‹åºä¸­å¤§å¤šæ•°é”éƒ½å­˜åœ¨ç«äº‰æ—¶ï¼Œé‚£åå‘é”å°±èµ·ä¸åˆ°å¤ªå¤§ä½œç”¨ã€‚å¯ä»¥ä½¿ç”¨ -XX:-userBiasedLocking=false æ¥å…³é—­åå‘é”ï¼Œå¹¶é»˜è®¤è¿›å…¥è½»é‡é”ã€‚ å…¶ä»–ä¼˜åŒ–é€‚åº”æ€§è‡ªæ—‹åœ¨ä½¿ç”¨ CAS æ—¶ï¼Œå¦‚æœæ“ä½œå¤±è´¥ï¼ŒCAS ä¼šè‡ªæ—‹å†æ¬¡å°è¯•ã€‚ç”±äºè‡ªæ—‹æ˜¯éœ€è¦æ¶ˆè€— CPU èµ„æºçš„ï¼Œæ‰€ä»¥å¦‚æœé•¿æœŸè‡ªæ—‹å°±ç™½ç™½æµªè´¹äº† CPUã€‚JDK1.6åŠ å…¥äº†é€‚åº”æ€§è‡ªæ—‹: å¦‚æœæŸä¸ªé”è‡ªæ—‹å¾ˆå°‘æˆåŠŸè·å¾—ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡å°±ä¼šå‡å°‘è‡ªæ—‹ã€‚ æ€»ç»“synchronized ç°åœ¨å·²ç»ä¸åƒä»¥å‰é‚£ä¹ˆé‡äº†ï¼Œæ‹¿ 1.8 ä¸­çš„ ConcurrentHashMap å°±å¯ä»¥çœ‹å‡ºï¼Œé‡Œé¢å¤§é‡çš„ä½¿ç”¨äº† synchronized æ¥è¿›è¡ŒåŒæ­¥ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>Java è¿›é˜¶</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>synchronize</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€è‡´æ€§ Hash ç®—æ³•åˆ†æ]]></title>
    <url>%2F2018%2F01%2F08%2FConsistent-Hash%2F</url>
    <content type="text"><![CDATA[å½“æˆ‘ä»¬åœ¨åšæ•°æ®åº“åˆ†åº“åˆ†è¡¨æˆ–è€…æ˜¯åˆ†å¸ƒå¼ç¼“å­˜æ—¶ï¼Œä¸å¯é¿å…çš„éƒ½ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜: å¦‚ä½•å°†æ•°æ®å‡åŒ€çš„åˆ†æ•£åˆ°å„ä¸ªèŠ‚ç‚¹ä¸­ï¼Œå¹¶ä¸”å°½é‡çš„åœ¨åŠ å‡èŠ‚ç‚¹æ—¶èƒ½ä½¿å—å½±å“çš„æ•°æ®æœ€å°‘ã€‚ Hash å–æ¨¡éšæœºæ”¾ç½®å°±ä¸è¯´äº†ï¼Œä¼šå¸¦æ¥å¾ˆå¤šé—®é¢˜ã€‚é€šå¸¸æœ€å®¹æ˜“æƒ³åˆ°çš„æ–¹æ¡ˆå°±æ˜¯ hash å–æ¨¡äº†ã€‚ å¯ä»¥å°†ä¼ å…¥çš„ Key æŒ‰ç…§ index = hash(key) % N è¿™æ ·æ¥è®¡ç®—å‡ºéœ€è¦å­˜æ”¾çš„èŠ‚ç‚¹ã€‚å…¶ä¸­ hash å‡½æ•°æ˜¯ä¸€ä¸ªå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ­£æ•´æ•°çš„å“ˆå¸Œæ˜ å°„æ–¹æ³•ï¼ŒN å°±æ˜¯èŠ‚ç‚¹çš„æ•°é‡ã€‚ è¿™æ ·å¯ä»¥æ»¡è¶³æ•°æ®çš„å‡åŒ€åˆ†é…ï¼Œä½†æ˜¯è¿™ä¸ªç®—æ³•çš„å®¹é”™æ€§å’Œæ‰©å±•æ€§éƒ½è¾ƒå·®ã€‚ æ¯”å¦‚å¢åŠ æˆ–åˆ é™¤äº†ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œæ‰€æœ‰çš„ Key éƒ½éœ€è¦é‡æ–°è®¡ç®—ï¼Œæ˜¾ç„¶è¿™æ ·æˆæœ¬è¾ƒé«˜ï¼Œä¸ºæ­¤éœ€è¦ä¸€ä¸ªç®—æ³•æ»¡è¶³åˆ†å¸ƒå‡åŒ€åŒæ—¶ä¹Ÿè¦æœ‰è‰¯å¥½çš„å®¹é”™æ€§å’Œæ‹“å±•æ€§ã€‚ ä¸€è‡´ Hash ç®—æ³•ä¸€è‡´ Hash ç®—æ³•æ˜¯å°†æ‰€æœ‰çš„å“ˆå¸Œå€¼æ„æˆäº†ä¸€ä¸ªç¯ï¼Œå…¶èŒƒå›´åœ¨ 0 ~ 2^32-1ã€‚å¦‚ä¸‹å›¾ï¼š ä¹‹åå°†å„ä¸ªèŠ‚ç‚¹æ•£åˆ—åˆ°è¿™ä¸ªç¯ä¸Šï¼Œå¯ä»¥ç”¨èŠ‚ç‚¹çš„ IPã€hostname è¿™æ ·çš„å”¯ä¸€æ€§å­—æ®µä½œä¸º Key è¿›è¡Œ hash(key)ï¼Œæ•£åˆ—ä¹‹åå¦‚ä¸‹ï¼š ä¹‹åéœ€è¦å°†æ•°æ®å®šä½åˆ°å¯¹åº”çš„èŠ‚ç‚¹ä¸Šï¼Œä½¿ç”¨åŒæ ·çš„ hash å‡½æ•° å°† Key ä¹Ÿæ˜ å°„åˆ°è¿™ä¸ªç¯ä¸Šã€‚ è¿™æ ·æŒ‰ç…§é¡ºæ—¶é’ˆæ–¹å‘å°±å¯ä»¥æŠŠ k1 å®šä½åˆ° N1èŠ‚ç‚¹ï¼Œk2 å®šä½åˆ° N3èŠ‚ç‚¹ï¼Œk3 å®šä½åˆ° N2èŠ‚ç‚¹ã€‚ å®¹é”™æ€§è¿™æ—¶å‡è®¾ N1 å®•æœºäº†ï¼š ä¾ç„¶æ ¹æ®é¡ºæ—¶é’ˆæ–¹å‘ï¼Œk2 å’Œ k3 ä¿æŒä¸å˜ï¼Œåªæœ‰ k1 è¢«é‡æ–°æ˜ å°„åˆ°äº† N3ã€‚è¿™æ ·å°±å¾ˆå¥½çš„ä¿è¯äº†å®¹é”™æ€§ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹å®•æœºæ—¶åªä¼šå½±å“åˆ°å°‘å°‘éƒ¨åˆ†çš„æ•°æ®ã€‚ æ‹“å±•æ€§å½“æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹æ—¶: åœ¨ N2 å’Œ N3 ä¹‹é—´æ–°å¢äº†ä¸€ä¸ªèŠ‚ç‚¹ N4 ï¼Œè¿™æ—¶ä¼šå‘ç°å—å°è±¡çš„æ•°æ®åªæœ‰ k3ï¼Œå…¶ä½™æ•°æ®ä¹Ÿæ˜¯ä¿æŒä¸å˜ï¼Œæ‰€ä»¥è¿™æ ·ä¹Ÿå¾ˆå¥½çš„ä¿è¯äº†æ‹“å±•æ€§ã€‚ è™šæ‹ŸèŠ‚ç‚¹åˆ°ç›®å‰ä¸ºæ­¢è¯¥ç®—æ³•ä¾ç„¶ä¹Ÿæœ‰ç‚¹é—®é¢˜: å½“èŠ‚ç‚¹è¾ƒå°‘æ—¶ä¼šå‡ºç°æ•°æ®åˆ†å¸ƒä¸å‡åŒ€çš„æƒ…å†µï¼š è¿™æ ·ä¼šå¯¼è‡´å¤§éƒ¨åˆ†æ•°æ®éƒ½åœ¨ N1 èŠ‚ç‚¹ï¼Œåªæœ‰å°‘é‡çš„æ•°æ®åœ¨ N2 èŠ‚ç‚¹ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€è‡´å“ˆå¸Œç®—æ³•å¼•å…¥äº†è™šæ‹ŸèŠ‚ç‚¹ã€‚å°†æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½è¿›è¡Œå¤šæ¬¡ hashï¼Œç”Ÿæˆå¤šä¸ªèŠ‚ç‚¹æ”¾ç½®åœ¨ç¯ä¸Šç§°ä¸ºè™šæ‹ŸèŠ‚ç‚¹: è®¡ç®—æ—¶å¯ä»¥åœ¨ IP ååŠ ä¸Šç¼–å·æ¥ç”Ÿæˆå“ˆå¸Œå€¼ã€‚ è¿™æ ·åªéœ€è¦åœ¨åŸæœ‰çš„åŸºç¡€ä¸Šå¤šä¸€æ­¥ç”±è™šæ‹ŸèŠ‚ç‚¹æ˜ å°„åˆ°å®é™…èŠ‚ç‚¹çš„æ­¥éª¤å³å¯è®©å°‘é‡èŠ‚ç‚¹ä¹Ÿèƒ½æ»¡è¶³å‡åŒ€æ€§ã€‚ å·å¤–æœ€è¿‘åœ¨æ€»ç»“ä¸€äº› Java ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸€èµ·ç»´æŠ¤ã€‚ åœ°å€: https://github.com/crossoverJie/Java-Interview]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[sbc(å…­) Zuul GateWay ç½‘å…³åº”ç”¨]]></title>
    <url>%2F2017%2F11%2F28%2Fsbc6%2F</url>
    <content type="text"><![CDATA[å‰è¨€çœ‹è¿‡ä¹‹å‰SBCç³»åˆ—çš„å°ä¼™ä¼´åº”è¯¥éƒ½å¯ä»¥æ­å»ºä¸€ä¸ªé«˜å¯ç”¨ã€åˆ†å¸ƒå¼çš„å¾®æœåŠ¡äº†ã€‚ ç›®å‰çš„ç»“æ„å›¾åº”è¯¥å¦‚ä¸‹æ‰€ç¤º: å„ä¸ªå¾®æœåŠ¡ä¹‹é—´éƒ½ä¸å­˜åœ¨å•ç‚¹ï¼Œå¹¶ä¸”éƒ½æ³¨å†Œäº Eureka ï¼ŒåŸºäºæ­¤è¿›è¡ŒæœåŠ¡çš„æ³¨å†Œäºå‘ç°ï¼Œå†é€šè¿‡ Ribbon è¿›è¡ŒæœåŠ¡è°ƒç”¨ï¼Œå¹¶å…·æœ‰å®¢æˆ·ç«¯è´Ÿè½½åŠŸèƒ½ã€‚ ä¸€åˆ‡çœ‹èµ·æ¥éƒ½æ¯”è¾ƒç¾å¥½ï¼Œä½†è¿™é‡Œå´å¿˜äº†ä¸€ä¸ªé‡è¦çš„ç»†èŠ‚ï¼š å½“æˆ‘ä»¬éœ€è¦å¯¹å¤–æä¾›æœåŠ¡æ—¶æ€ä¹ˆå¤„ç†ï¼Ÿ è¿™å½“ç„¶ä¹Ÿèƒ½å®ç°ï¼Œæ— éå°±æ˜¯å°†æˆ‘ä»¬å…·ä½“çš„å¾®æœåŠ¡åœ°å€åŠ ç«¯å£æš´éœ²å‡ºå»å³å¯ã€‚ é‚£åˆå¦‚ä½•æ¥å®ç°è´Ÿè½½å‘¢ï¼Ÿ ç®€å•ï¼å¯ä»¥é€šè¿‡ Nginx F5 ä¹‹ç±»çš„å·¥å…·è¿›è¡Œè´Ÿè½½ã€‚ ä½†æ˜¯å¦‚æœç³»ç»Ÿåºå¤§ï¼ŒæœåŠ¡æ‹†åˆ†çš„è¶³å¤Ÿå¤šé‚£åˆæœ‰è°æ¥ç»´æŠ¤è¿™äº›è·¯ç”±å…³ç³»å‘¢ï¼Ÿ å½“ç„¶è¿™æ˜¯è¿ç»´çš„æ´»ï¼Œä¸è¿‡è¿™æ—¶å€™è¿ç»´å¯èƒ½å°±è¦å‘é£™äº†ï¼ å¹¶ä¸”è¿˜æœ‰ä¸€ç³»åˆ—çš„é—®é¢˜: æœåŠ¡è°ƒç”¨ä¹‹é—´çš„ä¸€äº›é‰´æƒã€ç­¾åæ ¡éªŒæ€ä¹ˆåšï¼Ÿ ç”±äºæœåŠ¡ç«¯åœ°å€è¾ƒå¤šï¼Œå®¢æˆ·ç«¯è¯·æ±‚éš¾ä»¥ç»´æŠ¤ã€‚ é’ˆå¯¹äºè¿™ä¸€äº›é—®é¢˜ SpringCloud å…¨å®¶æ¡¶è‡ªç„¶ä¹Ÿæœ‰å¯¹åº”çš„è§£å†³æ–¹æ¡ˆ: Zuulã€‚å½“æˆ‘ä»¬ç³»ç»Ÿæ•´åˆ Zuul ç½‘å…³ä¹‹åæ¶æ„å›¾åº”è¯¥å¦‚ä¸‹æ‰€ç¤º: æˆ‘ä»¬åœ¨æ‰€æœ‰çš„è¯·æ±‚è¿›æ¥ä¹‹å‰æŠ½å‡ºä¸€å±‚ç½‘å…³åº”ç”¨ï¼Œå°†æœåŠ¡æä¾›çš„æ‰€æœ‰ç»†èŠ‚éƒ½è¿›è¡Œäº†åŒ…è£…ï¼Œè¿™æ ·æ‰€æœ‰çš„å®¢æˆ·ç«¯éƒ½æ˜¯å’Œç½‘å…³è¿›è¡Œäº¤äº’ï¼Œç®€åŒ–äº†å®¢æˆ·ç«¯å¼€å‘ã€‚ åŒæ—¶å…·æœ‰å¦‚ä¸‹åŠŸèƒ½: Zuul æ³¨å†Œäº Eureka å¹¶é›†æˆäº† Ribbon æ‰€ä»¥è‡ªç„¶ä¹Ÿæ˜¯å¯ä»¥ä»æ³¨å†Œä¸­å¿ƒè·å–åˆ°æœåŠ¡åˆ—è¡¨è¿›è¡Œå®¢æˆ·ç«¯è´Ÿè½½ã€‚ åŠŸèƒ½ä¸°å¯Œçš„è·¯ç”±åŠŸèƒ½ï¼Œè§£æ”¾è¿ç»´ã€‚ å…·æœ‰è¿‡æ»¤å™¨ï¼Œæ‰€ä»¥é‰´æƒã€éªŒç­¾éƒ½å¯ä»¥é›†æˆã€‚ åŸºäºæ­¤æˆ‘ä»¬æ¥çœ‹çœ‹ä¹‹å‰çš„æ¶æ„ä¸­å¦‚ä½•é›†æˆ Zuul ã€‚ é›†æˆ Zuulä¸ºæ­¤æˆ‘æ–°å»ºäº†ä¸€ä¸ªé¡¹ç›® sbc-gateway-zuul å°±æ˜¯ä¸€ä¸ªåŸºç¡€çš„ SpringBoot ç»“æ„ã€‚å…¶ä¸­åŠ å…¥äº† Zuul çš„ä¾èµ–ï¼š 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zuul&lt;/artifactId&gt;&lt;/dependency&gt; ç”±äºéœ€è¦å°†ç½‘å…³ä¹Ÿæ³¨å†Œåˆ° Eureka ä¸­ï¼Œæ‰€ä»¥è‡ªç„¶ä¹Ÿéœ€è¦: 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;&lt;/dependency&gt; ç´§æ¥ç€é…ç½®ä¸€äº›é¡¹ç›®åŸºæœ¬ä¿¡æ¯: 12345678# é¡¹ç›®é…ç½®spring.application.name=sbc-gateway-zuulserver.context-path=/server.port=8383# eurekaåœ°å€eureka.client.serviceUrl.defaultZone=http://node1:8888/eureka/eureka.instance.prefer-ip-address=true åœ¨å¯åŠ¨ç±»ä¸­åŠ å…¥å¼€å¯ Zuul çš„æ³¨è§£ï¼Œä¸€ä¸ªç½‘å…³åº”ç”¨å°±ç®—æ˜¯æ­å¥½äº†ã€‚ 123456@SpringBootApplication//å¼€å¯zuulä»£ç†@EnableZuulProxypublic class SbcGateWayZuulApplication &#123;&#125; å¯åŠ¨ Eureka å’Œç½‘å…³çœ‹åˆ°å·²ç»æ³¨å†ŒæˆåŠŸé‚£å°±å¤§åŠŸå‘Šæˆäº†: è·¯ç”±è·¯ç”±æ˜¯ç½‘å…³çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œå¯ä»¥ä½¿ç³»ç»Ÿæœ‰ä¸€ä¸ªç»Ÿä¸€çš„å¯¹å¤–æ¥å£ï¼Œä¸‹é¢æ¥çœ‹çœ‹å…·ä½“çš„åº”ç”¨ã€‚ ä¼ ç»Ÿè·¯ç”±ä¼ ç»Ÿè·¯ç”±éå¸¸ç®€å•ï¼Œå’Œ Nginx ç±»ä¼¼ï¼Œç”±å¼€å‘ã€è¿ç»´äººå‘˜æ¥ç»´æŠ¤è¯·æ±‚åœ°å€å’Œå¯¹åº”æœåŠ¡çš„æ˜ å°„å…³ç³»ï¼Œç±»ä¼¼äº: 12zuul.routes.user-service.path=/user-service/**zuul.routes.user-sercice.url=http://localhost:8080/ è¿™æ ·å½“æˆ‘ä»¬è®¿é—® http://localhost:8383/user-service/getUserInfo/1 ç½‘å…³å°±ä¼šè‡ªåŠ¨ç»™æˆ‘ä»¬è·¯ç”±åˆ° http://localhost:8080/getUserInfo/1 ä¸Šã€‚ å¯è§åªè¦æˆ‘ä»¬ç»´æŠ¤å¥½è¿™ä¸ªæ˜ å°„å…³ç³»å³å¯è‡ªç”±çš„é…ç½®è·¯ç”±ä¿¡æ¯(user-sercice å¯è‡ªå®šä¹‰)ï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾è¿™ç§æ–¹å¼ä¸ç®¡æ˜¯å¯¹è¿ç»´è¿˜æ˜¯å¼€å‘éƒ½ä¸å‹å¥½ã€‚ç”±äºå®é™…è¿™ç§æ–¹å¼ç”¨çš„ä¸å¤šå°±å†è¿‡å¤šå±•å¼€ã€‚ æœåŠ¡è·¯ç”±å¯¹æ­¤ Zuul æä¾›äº†ä¸€ç§åŸºäºæœåŠ¡çš„è·¯ç”±æ–¹å¼ã€‚æˆ‘ä»¬åªéœ€è¦ç»´æŠ¤è¯·æ±‚åœ°å€ä¸æœåŠ¡ ID ä¹‹é—´çš„æ˜ å°„å…³ç³»å³å¯ï¼Œå¹¶ä¸”ç”±äºé›†æˆäº† Ribbon , Zuul è¿˜å¯ä»¥åœ¨è·¯ç”±çš„æ—¶å€™é€šè¿‡ Eureka å®ç°è´Ÿè½½è°ƒç”¨ã€‚ å…·ä½“é…ç½®ï¼š 12zuul.routes.sbc-user.path=/api/user/**zuul.routes.sbc-user.serviceId=sbc-user è¿™æ ·å½“è¾“å…¥ http://localhost:8383/api/user/getUserInfo/1 æ—¶å°±ä¼šè·¯ç”±åˆ°æ³¨å†Œåˆ° Eureka ä¸­æœåŠ¡ ID ä¸º sbc-user çš„æœåŠ¡èŠ‚ç‚¹ï¼Œå¦‚æœæœ‰å¤šèŠ‚ç‚¹å°±ä¼šæŒ‰ç…§ Ribbon çš„è´Ÿè½½ç®—æ³•è·¯ç”±åˆ°å…¶ä¸­ä¸€å°ä¸Šã€‚ ä»¥ä¸Šé…ç½®è¿˜å¯ä»¥ç®€å†™ä¸º: 12# æœåŠ¡è·¯ç”± ç®€åŒ–é…ç½®zuul.routes.sbc-user=/api/user/** è¿™æ ·è®©æˆ‘ä»¬è®¿é—® http://127.0.0.1:8383/api/user/userService/getUserByHystrix æ—¶å€™å°±ä¼šæ ¹æ®è´Ÿè½½ç®—æ³•å¸®æˆ‘ä»¬è·¯ç”±åˆ° sbc-user åº”ç”¨ä¸Šï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º: å¯åŠ¨äº†ä¸¤ä¸ª sbc-user æœåŠ¡ã€‚ è¯·æ±‚ç»“æœ: ä¸€æ¬¡è·¯ç”±å°±ç®—å®Œæˆäº†ã€‚ åœ¨ä¸Šé¢çš„é…ç½®ä¸­æœ‰çœ‹åˆ° /api/user/** è¿™æ ·çš„é€šé…ç¬¦é…ç½®ï¼Œå…·ä½“æœ‰ä»¥ä¸‹ä¸‰ç§é…ç½®éœ€è¦äº†è§£: ? åªèƒ½åŒ¹é…ä»»æ„çš„å•ä¸ªå­—ç¬¦ï¼Œå¦‚ /api/user/? å°±åªèƒ½åŒ¹é… /api/user/x /api/user/y /api/user/z è¿™æ ·çš„è·¯å¾„ã€‚ * åªèƒ½åŒ¹é…ä»»æ„å­—ç¬¦ï¼Œå¦‚ /api/user/* å°±åªèƒ½åŒ¹é… /api/user/x /api/user/xy /api/user/xyzã€‚ ** å¯ä»¥åŒ¹é…ä»»æ„å­—ç¬¦ã€ä»»æ„å±‚çº§ã€‚ç»“åˆäº†ä»¥ä¸Šä¸¤ç§é€šé…ç¬¦çš„ç‰¹ç‚¹ï¼Œå¦‚ /api/user/** åˆ™å¯ä»¥åŒ¹é… /api/user/x /api/user/x/y /api/user/x/y/zzzè¿™æ ·çš„è·¯å¾„ï¼Œæœ€ç®€å•ç²—æš´ï¼ è°ˆåˆ°é€šé…ç¬¦åŒ¹é…å°±ä¸å¾—ä¸æåˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä¸Šé¢çš„ sbc-user æœåŠ¡ç”±äºåæœŸè¿­ä»£æ›´æ–°ï¼Œå°† sbc-user ä¸­çš„ä¸€éƒ¨åˆ†é€»è¾‘æŠ½æˆäº†å¦ä¸€ä¸ªæœåŠ¡ sbc-user-proã€‚æ–°åº”ç”¨çš„è·¯ç”±è§„åˆ™æ˜¯ /api/user/pro/**,å¦‚æœæˆ‘ä»¬æŒ‰ç…§: 12zuul.routes.sbc-user=/api/user/**zuul.routes.sbc-user-pro=/api/user/pro/** è¿›è¡Œé…ç½®çš„è¯ï¼Œæˆ‘ä»¬æƒ³é€šè¿‡ /api/user/pro/ æ¥è®¿é—® sbc-user-pro åº”ç”¨ï¼Œå´ç”±äºæ»¡è¶³ç¬¬ä¸€ä¸ªè·¯ç”±è§„åˆ™ï¼Œæ‰€ä»¥ä¼šè¢« Zuul è·¯ç”±åˆ° sbc-user è¿™ä¸ªåº”ç”¨ä¸Šï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¯¹çš„ã€‚è¯¥æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ ç¿»çœ‹è·¯ç”±æºç  org.springframework.cloud.netflix.zuul.filters.SimpleRouteLocator ä¸­çš„ locateRoutes() æ–¹æ³•: 1234567891011/** * Compute a map of path pattern to route. The default is just a static map from the * &#123;@link ZuulProperties&#125;, but subclasses can add dynamic calculations. */protected Map&lt;String, ZuulRoute&gt; locateRoutes() &#123; LinkedHashMap&lt;String, ZuulRoute&gt; routesMap = new LinkedHashMap&lt;String, ZuulRoute&gt;(); for (ZuulRoute route : this.properties.getRoutes().values()) &#123; routesMap.put(route.getPath(), route); &#125; return routesMap;&#125; å‘ç°è·¯ç”±è§„åˆ™æ˜¯éå†é…ç½®æ–‡ä»¶å¹¶æ”¾å…¥ LinkedHashMap ä¸­ï¼Œç”±äº LinkedHashMap æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥ä¸ºäº†è¾¾åˆ°ä¸Šæ–‡çš„æ•ˆæœï¼Œé…ç½®æ–‡ä»¶çš„åŠ è½½é¡ºåºéå¸¸é‡è¦ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦å°†ä¼˜å…ˆåŒ¹é…çš„è·¯ç”±è§„åˆ™æ”¾å‰å³å¯è§£å†³ã€‚ è¿‡æ»¤å™¨è¿‡æ»¤å™¨å¯ä»¥è¯´æ˜¯æ•´ä¸ª Zuul æœ€æ ¸å¿ƒçš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä¸Šæ–‡æåˆ°è·¯ç”±åŠŸèƒ½ä¹Ÿæ˜¯ç”±è¿‡æ»¤å™¨æ¥å®ç°çš„ã€‚ æ‘˜æŠ„å®˜æ–¹çš„è§£é‡Š: Zuul çš„æ ¸å¿ƒå°±æ˜¯ä¸€ç³»åˆ—çš„è¿‡æ»¤å™¨ï¼Œä»–èƒ½å¤Ÿåœ¨æ•´ä¸ª HTTP è¯·æ±‚ã€å“åº”è¿‡ç¨‹ä¸­æ‰§è¡Œå„æ ·çš„æ“ä½œã€‚ å…¶å®æ€»ç»“ä¸‹æ¥å°±æ˜¯å››ä¸ªç‰¹å¾: è¿‡æ»¤ç±»å‹ è¿‡æ»¤é¡ºåº æ‰§è¡Œæ¡ä»¶ å…·ä½“å®ç° å…¶å®å°±æ˜¯ ZuulFilter æ¥å£ä¸­æ‰€å®šä¹‰çš„å››ä¸ªæ¥å£: 1234567String filterType();int filterOrder();boolean shouldFilter();Object run(); å®˜æ–¹æµç¨‹å›¾(ç”Ÿå‘½å‘¨æœŸ): ç®€å•ç†è§£ä¸‹å°±æ˜¯: å½“ä¸€ä¸ªè¯·æ±‚è¿›æ¥æ—¶ï¼Œé¦–å…ˆæ˜¯è¿›å…¥ pre è¿‡æ»¤å™¨ï¼Œå¯ä»¥åšä¸€äº›é‰´æƒï¼Œè®°å½•è°ƒè¯•æ—¥å¿—ç­‰æ“ä½œã€‚ä¹‹åè¿›å…¥ routing è¿‡æ»¤å™¨è¿›è¡Œè·¯ç”±è½¬å‘ï¼Œè½¬å‘å¯ä»¥ä½¿ç”¨ Apache HttpClient æˆ–è€…æ˜¯ Ribbon ã€‚post è¿‡æ»¤å™¨å‘¢åˆ™æ˜¯å¤„ç†æœåŠ¡å“åº”ä¹‹åçš„æ•°æ®ï¼Œå¯ä»¥è¿›è¡Œä¸€äº›åŒ…è£…æ¥è¿”å›å®¢æˆ·ç«¯ã€‚ error åˆ™æ˜¯åœ¨æœ‰å¼‚å¸¸å‘ç”Ÿæ—¶æ‰ä¼šè°ƒç”¨ï¼Œç›¸å½“äºæ˜¯å…¨å±€å¼‚å¸¸æ‹¦æˆªå™¨ã€‚ è‡ªå®šä¹‰è¿‡æ»¤å™¨æ¥ä¸‹æ¥å®ç°ä¸€ä¸ªæ–‡åˆæ‰€æåˆ°çš„é‰´æƒæ“ä½œ: æ–°å»ºä¸€ä¸ª RequestFilter ç±»ç»§æ‰¿ä¸ ZuulFilter æ¥å£ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546/** * Function: è¯·æ±‚æ‹¦æˆª * * @author crossoverJie * Date: 2017/11/20 00:33 * @since JDK 1.8 */public class RequestFilter extends ZuulFilter &#123; private Logger logger = LoggerFactory.getLogger(RequestFilter.class) ; /** * è¯·æ±‚è·¯ç”±ä¹‹å‰è¢«æ‹¦æˆª å®ç° pre æ‹¦æˆªå™¨ * @return */ @Override public String filterType() &#123; return "pre"; &#125; @Override public int filterOrder() &#123; return 0; &#125; @Override public boolean shouldFilter() &#123; return true; &#125; @Override public Object run() &#123; RequestContext currentContext = RequestContext.getCurrentContext(); HttpServletRequest request = currentContext.getRequest(); String token = request.getParameter("token"); if (StringUtil.isEmpty(token))&#123; logger.warn("need token"); //è¿‡æ»¤è¯·æ±‚ currentContext.setSendZuulResponse(false); currentContext.setResponseStatusCode(400); return null ; &#125; logger.info("token =&#123;&#125;",token) ; return null; &#125;&#125; éå¸¸ easyï¼Œå°±ç®€å•æ ¡éªŒä¸‹è¯·æ±‚ä¸­æ˜¯å¦åŒ…å« tokenï¼Œä¸åŒ…å«å°±è¿”å› 401 codeã€‚ ä¸ä½†å¦‚æ­¤ï¼Œè¿˜éœ€è¦å°†è¯¥ç±»åŠ å…¥åˆ° Spring è¿›è¡Œç®¡ç†: æ–°å»ºäº† FilterConf ç±»: 123456789@Configuration@Componentpublic class FilterConf &#123; @Bean public RequestFilter filter()&#123; return new RequestFilter() ; &#125;&#125; è¿™æ ·é‡å¯ä¹‹åå°±å¯ä»¥çœ‹åˆ°æ•ˆæœäº†: ä¸ä¼  token æ—¶ï¼š ä¼ å…¥ token æ—¶ï¼š å¯è§ä¸€äº›é‰´æƒæ“ä½œæ˜¯å¯ä»¥æ”¾åˆ°è¿™é‡Œæ¥è¿›è¡Œç»Ÿä¸€å¤„ç†çš„ã€‚ å…¶ä½™å‡ ä¸ªè¿‡æ»¤å™¨ä¹Ÿæ˜¯å¤§åŒå°å¼‚ï¼Œå¯ä»¥æ ¹æ®å®é™…åœºæ™¯æ¥è‡ªå®šä¹‰ã€‚ Zuul é«˜å¯ç”¨Zuul ç°åœ¨æ—¢ç„¶ä½œä¸ºäº†å¯¹å¤–çš„ç¬¬ä¸€å…¥å£ï¼Œé‚£è‚¯å®šä¸èƒ½æ˜¯å•èŠ‚ç‚¹ï¼Œå¯¹äº Zuul çš„é«˜å¯ç”¨æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼å®ç°ã€‚ Eureka é«˜å¯ç”¨ç¬¬ä¸€ç§æœ€å®¹æ˜“æƒ³åˆ°å’Œå®ç°:æˆ‘ä»¬å¯ä»¥éƒ¨ç½²å¤šä¸ª Zuul èŠ‚ç‚¹ï¼Œå¹¶ä¸”éƒ½æ³¨å†Œäº Eureka ï¼Œå¦‚ä¸‹å›¾ï¼š è¿™æ ·è™½ç„¶ç®€å•æ˜“ç»´æŠ¤ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªä¸¥é‡çš„ç¼ºç‚¹ï¼šé‚£å°±æ˜¯å®¢æˆ·ç«¯ä¹Ÿå¾—æ³¨å†Œåˆ° Eureka ä¸Šæ‰èƒ½å¯¹ Zuul çš„è°ƒç”¨åšåˆ°è´Ÿè½½ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸ç°å®çš„ã€‚ æ‰€ä»¥ä¸‹é¢è¿™ç§åšæ³•æ›´ä¸ºå¸¸è§ã€‚ åŸºäº Nginx é«˜å¯ç”¨åœ¨è°ƒç”¨ Zuul ä¹‹å‰ä½¿ç”¨ Nginx ä¹‹ç±»çš„è´Ÿè½½å‡è¡¡å·¥å…·è¿›è¡Œè´Ÿè½½ï¼Œè¿™æ · Zuul æ—¢èƒ½æ³¨å†Œåˆ° Eureka ï¼Œå®¢æˆ·ç«¯ä¹Ÿèƒ½å®ç°å¯¹ Zuul çš„è´Ÿè½½ï¼Œå¦‚ä¸‹å›¾ï¼š æ€»ç»“è¿™æ ·åœ¨åŸæœ‰çš„å¾®æœåŠ¡æ¶æ„çš„åŸºç¡€ä¸ŠåŠ ä¸Šç½‘å…³ä¹‹åå¦æ•´ä¸ªç³»ç»Ÿæ›´åŠ å®Œå–„äº†ï¼Œä»ç½‘å…³çš„è®¾è®¡æ¥çœ‹ï¼šå¤§å¤šæ•°ç³»ç»Ÿæ¶æ„éƒ½æœ‰åˆ†å±‚çš„æ¦‚å¿µï¼Œä¸èƒ½è§£å†³é—®é¢˜é‚£å°±å¤šåˆ†å‡ å±‚ğŸ¤“ã€‚ é¡¹ç›®ï¼šhttps://github.com/crossoverJie/springboot-cloud åšå®¢ï¼šhttp://crossoverjie.topã€‚]]></content>
      <categories>
        <category>sbc</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>SpringCloud</tag>
        <tag>Zuul</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€è¯‘ã€‘ä½ å¯ä»¥ç”¨GitHubåšçš„12ä»¶ Cool äº‹æƒ…]]></title>
    <url>%2F2017%2F11%2F05%2Ftranslation1-12%20cool%20things%20you%20can%20do%20with%20GitHub%2F</url>
    <content type="text"><![CDATA[åŸæ–‡é“¾æ¥1 åœ¨ GitHub.com ç¼–è¾‘ä»£ç æˆ‘å°†ä»æˆ‘è®¤ä¸ºå¤§å®¶éƒ½çŸ¥é“çš„ä¸€ä»¶äº‹æƒ…å¼€å§‹(å°½ç®¡æˆ‘æ˜¯ç›´åˆ°ä¸€å‘¨å‰æ‰çŸ¥é“)ã€‚ å½“ä½ åœ¨ GitHub æŸ¥çœ‹æ–‡ä»¶æ—¶(ä»»ä½•æ–‡æœ¬æ–‡ä»¶ï¼Œä»»ä½•ä»“åº“ä¸­)ï¼Œå³ä¸Šè§’ä¼šæœ‰ä¸€ä¸ªå°é“…ç¬”å›¾æ ‡ï¼Œç‚¹å‡»å®ƒå°±å¯ä»¥ç¼–è¾‘æ–‡ä»¶äº†ã€‚å®Œæˆä¹‹åç‚¹å‡» Propose file change æŒ‰é’® GitHub å°†ä¼šè‡ªåŠ¨å¸®ä½  fork è¯¥é¡¹ç›®å¹¶ä¸”åˆ›å»ºä¸€ä¸ª pull request ã€‚ å¾ˆå‰å®³å§ï¼ä»–è‡ªåŠ¨å¸®ä½  fork äº†è¯¥ repoã€‚ ä¸å†éœ€è¦ fork , pull ,æœ¬åœ°ç¼–è¾‘å† push ä»¥åŠåˆ›å»ºä¸€ä¸ª PR è¿™æ ·çš„æµç¨‹äº†ã€‚ è¿™éå¸¸é€‚åˆä¿®å¤ç¼–å†™ä»£ç ä¸­å‡ºç°çš„æ‹¼å†™é”™è¯¯å’Œä¿®æ­£ä¸€ä¸ªä¸å¤ªç†æƒ³çš„æƒ³æ³•ã€‚ 2 ç²˜è´´å›¾ç‰‡ä½ ä¸ä»…ä»…å—é™äºè¾“å…¥æ–‡æœ¬å’Œæè¿°é—®é¢˜ï¼Œä½ çŸ¥é“ä½ å¯ä»¥ç›´æ¥ä»ç²˜è´´æ¿ä¸­ç²˜è´´å›¾ç‰‡å—ï¼Ÿå½“ä½ ç²˜è´´æ—¶ï¼Œä½ ä¼šçœ‹åˆ°å›¾ç‰‡å·²ç»è¢«ä¸Šä¼ äº†(æ¯«æ— ç–‘é—®è¢«ä¸Šä¼ åˆ°äº‘ç«¯)ä¹‹åä¼šå˜æˆ Markdown è¯­æ³•æ¥æ˜¾ç¤ºå›¾ç‰‡ã€‚ 3 æ ¼å¼åŒ–ä»£ç å¦‚æœä½ æƒ³å†™ä¸€æ®µä»£ç ï¼Œä½ å¯ä»¥ä¸‰ä¸ªåå¼•å·å¼€å§‹ â€”â€” å°±åƒä½ åœ¨ç ”ç©¶MarkDownæ—¶æ‰€å­¦åˆ°çš„ â€”â€” ä¹‹å GitHub ä¼šè¯•ç€çŒœæµ‹ä½ å†™çš„è¯­è¨€ã€‚ ä½†å¦‚æœä½ å†™äº†ä¸€äº›ç±»ä¼¼äº Vue, Typescript, JSX è¿™æ ·çš„è¯­è¨€ï¼Œä½ å¯ä»¥æ˜ç¡®æŒ‡å®šå¾—åˆ°æ­£ç¡®çš„é«˜äº®ã€‚ æ³¨æ„ç¬¬ä¸€è¡Œä¸­çš„1```jsx è¿™æ„å‘³ç€ä»£ç æ®µå°†ä¼šå‘ˆç°å‡º: (è¿™ä¸ªæ‰©å±•äº gists ã€‚é¡ºä¾¿è¯´ä¸€å¥ï¼Œå¦‚æœä½ ä½¿ç”¨ .jsx åç¼€ï¼Œå°±ä¼šå¾—åˆ°JSXçš„è¯­æ³•é«˜äº®) è¿™æ˜¯ä¸€ä¸ªæ‰€æœ‰å—æ”¯æŒçš„è¯­æ³•åˆ—è¡¨ã€‚ 4 åœ¨ PR ä¸­ç”¨å…³é”®è¯å…³é—­ Issueså‡è®¾ä½ åˆ›å»ºäº†ä¸€ä¸ªç”¨äºä¿®å¤ Issues #234 çš„ PR ,ä½ å¯ä»¥åœ¨ä½  PR çš„æè¿°ä¸­å¡«å†™ fixes #234 (æˆ–æ˜¯åœ¨ä½  PR ä»»æ„è¯„è®ºä¸­å¡«å†™éƒ½æ˜¯å¯ä»¥çš„)ã€‚ä¹‹ååˆå¹¶è¿™ä¸ª PR æ—¶å°†ä¼šè‡ªåŠ¨å…³é—­å¡«å†™çš„ Issuesã€‚æ€ä¹ˆæ ·,å¾ˆ cool å§ã€‚ äº†è§£æ˜¯æ›´å¤šç›¸å…³çš„å†…å®¹ã€‚ 5 é“¾æ¥åˆ°è¯„è®ºä½ æ˜¯å¦æœ‰è¿‡æƒ³è¦é“¾æ¥åˆ°ç‰¹æ®Š comment çš„æƒ³æ³•ä½†å´æ— æ³•å®ç°ï¼Ÿé‚£æ˜¯å› ä¸ºä½ ä¸çŸ¥é“æ€ä¹ˆåšã€‚æœ‹å‹é‚£éƒ½æ˜¯è¿‡å»å¼äº†ï¼Œç°åœ¨æˆ‘å°±å‘Šè¯‰ä½ ï¼Œç‚¹å‡»ç”¨æˆ·åæ—è¾¹çš„æ—¥æœŸ/æ—¶é—´å³å¯é“¾æ¥åˆ°è¯¥ comment ã€‚ 6 é“¾æ¥åˆ°ä»£ç æˆ‘çŸ¥é“ä½ æƒ³é“¾æ¥åˆ°å…·ä½“çš„ä»£ç è¡Œä¸Šã€‚ å°è¯•:æŸ¥çœ‹æ–‡ä»¶æ—¶ï¼Œç‚¹å‡»ä»£ç æ—è¾¹çš„è¡Œå·ã€‚ çœ‹åˆ°äº†å§ï¼Œæµè§ˆå™¨çš„ URL å·²ç»è¢«æ›´æ–°ä¸ºè¡Œå·äº†ã€‚å¦‚æœä½ æŒ‰ä½ shift,åŒæ—¶ç‚¹å‡»å…¶ä»–è¡Œå·ï¼ŒURL å†æ¬¡è¢«æ›´æ–°ï¼Œå¹¶ä¸”ä½ ä¹Ÿé«˜äº®æ˜¾ç¤ºé¡µé¢ä¸­çš„ä¸€æ®µä»£ç ã€‚ åˆ†äº«è¿™ä¸ª URL ï¼Œè®¿é—®æ—¶å°†ä¼šé“¾æ¥åˆ°è¯¥æ–‡ä»¶å·²ç»é€‰ä¸­çš„é‚£äº›ä»£ç æ®µã€‚ ä½†ç­‰ä¸€ä¸‹ï¼Œé‚£æŒ‡å‘çš„æ˜¯å½“å‰çš„åˆ†æ”¯ï¼Œå¦‚æœæ–‡ä»¶å‘ç”Ÿäº†æ”¹å˜å‘¢ï¼Ÿä¹Ÿè®¸ä¸€ä¸ªåœ¨å½“å‰çŠ¶æ€è¿æ¥åˆ°æ–‡ä»¶çš„æ°¸ä¹…è¿æ¥æ­£æ˜¯ä½ æƒ³è¦çš„ã€‚ æˆ‘å¾ˆæ‡’ï¼Œæ‰€ä»¥ç”¨ä¸€å¼ æˆªå›¾å±•ç¤ºä»¥ä¸Šçš„æ‰€æœ‰æ“ä½œã€‚ è°ˆåˆ°ç½‘å€ã€‚ã€‚ã€‚ 7 åƒå‘½ä»¤è¡Œä¸€æ ·ä½¿ç”¨ GitHub é“¾æ¥ä½¿ç”¨ GitHub è‡ªå¸¦çš„ UI æµè§ˆä¹Ÿè¿˜ä¸é”™ï¼Œä½†æœ‰æ—¶ç›´æ¥åœ¨ URL ä¸­è¾“å…¥æ˜¯æœ€å¿«çš„æ–¹æ³•ã€‚æ¯”å¦‚ï¼Œæˆ‘æƒ³è·³è½¬åˆ°æˆ‘æ­£åœ¨ç¼–è¾‘çš„åˆ†æ”¯å¹¶å’Œ master è¿›è¡Œå¯¹æ¯”ï¼Œå°±å¯ä»¥åœ¨é¡¹ç›®åç§°åé¢æ¥ä¸Š /compare/branch-name ã€‚ ä¸é€‰ä¸­åˆ†æ”¯çš„å¯¹æ¯”é¡µå°†ä¼šæ˜¾ç¤ºå‡ºæ¥: ä»¥ä¸Šå°±æ˜¯å’Œ master åˆ†æ”¯çš„å·®å¼‚ï¼Œå¦‚æœæƒ³è¦åˆå¹¶åˆ†æ”¯çš„è¯ï¼Œåªéœ€è¦è¾“å…¥ /compare/integration-branch...my-branch å³å¯ã€‚ ä½ è¿˜å¯ä»¥åˆ©ç”¨å¿«æ·é”®è¾¾åˆ°åŒæ ·çš„æ•ˆæœï¼Œä½¿ç”¨ ctrl + L æˆ–è€… cmd + L å¯ä»¥å°†å…‰æ ‡ç§»åŠ¨åˆ° URL ä¸Š(è‡³å°‘åœ¨ Chrome ä¸­å¯ä»¥)ã€‚ åŠ ä¸Šæµè§ˆå™¨çš„è‡ªåŠ¨è¡¥å…¨ â€”â€” ä½ å°±å¯ä»¥åœ¨ä¸¤ä¸ªåˆ†æ”¯ä¹‹é—´è½»æ¾åˆ‡æ¢äº†ã€‚ 8 åœ¨Issuesåˆ›å»ºåˆ—è¡¨ä½ æƒ³åœ¨ä½ çš„ issue ä¸­çœ‹åˆ°å¤é€‰æ¡†åˆ—è¡¨å—? ä½ æƒ³åœ¨æŸ¥çœ‹ issue åˆ—è¡¨æ˜¯å®ƒä»¬ä»¥å¥½çœ‹çš„ 2 of 5 è¿›åº¦æ¡å‘ˆç°å—ï¼Ÿ å¤ªå¥½äº†ï¼ä½ å¯ä»¥ç”¨ä»¥ä¸‹è¯­æ³•æ¥åˆ›å»ºä¸€ä¸ªäº¤äº’æ€§çš„å¤é€‰æ¡†: 12345- [ ] Screen width (integer)- [x] Service worker support- [x] Fetch support- [ ] CSS flexbox support- [ ] Custom elements æ˜¯ç”±ä¸€ä¸ªç©ºæ ¼ã€ä¸­æ¨ªçº¿ã€ç©ºæ ¼ã€å·¦æ‹¬å·ã€ç©ºæ ¼(æˆ–è€…æ˜¯ X )ã€å³æ‹¬å·ã€ç©ºæ ¼ä»¥åŠä¸€äº›æ–‡æœ¬ç»„æˆã€‚ ä½ ç”šè‡³å¯ä»¥çœŸæ­£çš„ é€‰ä¸­/å–æ¶ˆ è¿™äº›å¤é€‰æ¡†ï¼åŸºäºæŸäº›åŸå› ï¼Œå¯¹äºæˆ‘æ¥è¯´ä½ çœ‹èµ·æ¥åƒæ˜¯æŠ€æœ¯é­”åŠ›ã€‚æ˜¯çœŸçš„èƒ½å¤Ÿé€‰ä¸­è¿™äº›å¤é€‰æ¡†ï¼ç”šè‡³å®ƒè¿˜æ›´æ–°äº†åº•å±‚æºç ã€‚ psï¼šä»¥ä¸‹åŒ…æ‹¬ç¬¬ä¹ç‚¹ åŸºäºGitHubçš„é¡¹ç›®é¢æ¿ ç”±äºç”¨çš„ä¸å¤šå°±æ²¡æœ‰ç¿»è¯‘ã€‚ 10 GitHub wikiä½œä¸ºä¸€ä¸ªåƒç»´åŸºç™¾ç§‘é‚£æ ·çš„éç»“æ„åŒ–çš„é¡µé¢é›†åˆï¼Œ GitHub Wikiçš„ä¾›ç»™(æˆ‘æŠŠå®ƒç§°ä¹‹ä¸º Gwiki ) æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„åŠŸèƒ½ã€‚ å¯¹äºç»“æ„åŒ–çš„é¡µé¢æ¥è¯´ â€”â€” ä¾‹å¦‚ä½ çš„æ–‡æ¡£ï¼šä¸èƒ½è¯´è¿™ä¸ªé¡µé¢æ˜¯å…¶ä»–é¡µé¢çš„å­é¡µé¢ï¼Œæˆ–åˆ™æ˜¯æœ‰ â€œä¸‹ä¸€èŠ‚â€ï¼Œâ€œä¸Šä¸€èŠ‚â€ è¿™æ ·çš„ä¾¿æ·æŒ‰é’®ã€‚å¹¶ä¸” Hansel å’Œ Gretel ä¹Ÿæ²¡æœ‰ï¼Œå› ä¸ºç»“æ„åŒ–é¡µé¢å¹¶æ²¡æœ‰ breadcrumbs è¿™æ ·çš„è®¾è®¡ã€‚ æˆ‘ä»¬ç»§ç»­ï¼Œè®© Gwiki åŠ¨èµ·æ¥ï¼Œæˆ‘ä» NodeJS çš„æ–‡æ¡£ä¸­å¤åˆ¶äº†å‡ é¡µæ¥ä½œä¸º wiki é¡µé¢ã€‚ç„¶ååˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰ä¾§è¾¹æ ï¼Œå¸®åŠ©æˆ‘æ›´å¥½åœ°æ¨¡æ‹Ÿä¸€äº›å®é™…çš„ç›®å½•ç»“æ„ã€‚å°½ç®¡å®ƒä¸ä¼šçªå‡ºæ˜¾ç¤ºä½ å½“å‰çš„é¡µé¢ä½ç½®ï¼Œä½†ä¾§è¾¹æ ä¼šä¸€ç›´å­˜åœ¨ã€‚ è¿™äº›é“¾æ¥éœ€è¦ä½ æ‰‹åŠ¨ç»´æŠ¤ï¼Œä½†æ€»çš„æ¥è¯´ï¼Œæˆ‘è®¤ä¸ºå®ƒå¯ä»¥åšå¾—å¾ˆå¥½ã€‚ å¦‚æœéœ€è¦çš„è¯å¯ä»¥çœ‹çœ‹ã€‚ è™½ç„¶å®ƒä¸ GitBook ( Redux æ–‡æ¡£æ‰€ä½¿ç”¨çš„)æˆ–è€…æ˜¯å®šåˆ¶ç½‘ç«™ç›¸æ¯”ä»æœ‰å·®è·ã€‚ä½†åœ¨ä½ çš„ repo ä¸­å®ƒæœ‰ 80% å®Œå…¨å€¼å¾—ä¿¡èµ–çš„ã€‚ æˆ‘çš„å»ºè®®æ˜¯: å¦‚æœä½ å·²ç»æœ‰å¤šä¸ª README.md æ–‡ä»¶ï¼Œå¹¶ä¸”æƒ³è¦ä¸€äº›å…³äºç”¨æˆ·æŒ‡å—æˆ–æ›´è¯¦ç»†çš„æ–‡æ¡£çš„ä¸åŒçš„é¡µé¢ï¼Œé‚£ä¹ˆä½ åº”è¯¥é€‰æ‹© Gwikiã€‚ å¦‚æœç¼ºä¹ç»“æ„åŒ–/å¯¼èˆªå¼€å§‹è®©ä½ ä¸çˆ½çš„è¯ï¼Œé‚£å°±è¯•è¯•å…¶ä»–çš„å§ã€‚ 11 GitHub Pagesä½ å¯èƒ½å·²ç»çŸ¥é“ä½¿ç”¨ GitHub Pages æ¥æ‰˜ç®¡ä¸€ä¸ªé™æ€ç½‘ç«™ã€‚å¦‚æœä½ ä¸çŸ¥é“ï¼Œç°åœ¨å°±æ¥å­¦ä¹ ï¼Œè¿™ä¸€èŠ‚æ˜¯ä¸“é—¨ç”¨äºè®¨è®ºä½¿ç”¨ Jekyll æ¥æ„å»ºä¸€ä¸ªç«™ç‚¹çš„ã€‚ æœ€ç®€å•çš„å°±æ˜¯ï¼š GitHub Pages + Jekyllä¼šé€šè¿‡ä¸€ä¸ªæ¼‚äº®çš„ä¸»é¢˜æ¥æ¸²æŸ“ä½ çš„ README.md æ–‡ä»¶ã€‚ä¾‹å¦‚:é€šè¿‡ about-github æ¥æŸ¥çœ‹çš„æˆ‘çš„ README é¡µé¢ã€‚ å¦‚æœæˆ‘åœ¨ GitHub ä¸­ç‚¹å‡»äº† settingsé€‰é¡¹ï¼Œåˆ‡æ¢åˆ° Github Pages è®¾ç½®ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ª Jekyll themeã€‚ã€‚ã€‚ æˆ‘å°±å¯ä»¥å¾—åˆ° Jekyll-themed é¡µé¢ã€‚ ä»è¿™ç‚¹ä¸Šæˆ‘å¯ä»¥ä¸»è¦ä¾æ®æ˜“ç¼–è¾‘çš„ Markdown æ–‡ä»¶æ¥æ„å»ºä¸€ä¸ªå®Œæ•´çš„é™æ€ç«™ç‚¹ã€‚æœ¬è´¨ä¸Šæ˜¯æŠŠ GitHub å˜æˆäº† CMSã€‚ è™½ç„¶æˆ‘æ²¡æœ‰å®é™…ä½¿ç”¨è¿‡ï¼Œä½†æ˜¯ React Bootstrap çš„ç½‘ç«™éƒ½æ˜¯ä½¿ç”¨å®ƒæ¥æ„å»ºçš„ã€‚æ‰€ä»¥å®ƒä¸ä¼šç³Ÿç³•ã€‚ æ³¨æ„:å®ƒè¦æ±‚ Ruby è¿è¡Œæœ¬åœ°ç¯å¢ƒ( Windows è‡ªè¡Œå®‰è£…ï¼Œ macOS è‡ªå¸¦)ã€‚ 12 æŠŠ GitHub å½“åš CRM ä½¿ç”¨å‡è®¾ä½ æœ‰ä¸€ä¸ªå­˜æœ‰ä¸€äº›æ–‡æœ¬å†…å®¹çš„ç½‘ç«™ï¼Œä½ ä¸æƒ³å°†æ–‡æœ¬å†…å®¹å­˜å‚¨äºçœŸæ­£çš„ HTML æºç ä¸­ã€‚ ç›¸åçš„ï¼Œä½ æƒ³è¦å°†è¿™äº›æ–‡æœ¬å—å­˜å‚¨äºéå¼€å‘äººå‘˜èƒ½è½»æ¾çš„è¿›è¡Œç¼–è¾‘çš„åœ°æ–¹ã€‚å¯èƒ½æ˜¯ä¸€ä¸ªç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œç”šè‡³æ˜¯ä¸€ä¸ªå®¡æ ¸æµç¨‹ã€‚ æˆ‘çš„å»ºè®®æ˜¯:ä½¿ç”¨ GitHub å‚åº“ä¸­çš„ Markdown æ–‡ä»¶æ¥å­˜å‚¨è¿™äº›æ–‡æœ¬å†…å®¹ï¼Œç„¶åä½¿ç”¨å‰ç«¯ç»„ä»¶æ¥æ‹‰å–è¿™äº›æ–‡æœ¬å—å¹¶å±•ç¤ºåœ¨é¡µé¢ä¸Šã€‚ æˆ‘æ˜¯æ React çš„ï¼Œæ‰€ä»¥è¿™æœ‰ä¸€ä¸ª è§£æ Markdown çš„ç»„ä»¶ä¾‹å­ï¼Œç»™å®šä¸€äº› Markdown æ–‡ä»¶è·¯å¾„ï¼Œå®ƒå°†ä¼šè‡ªåŠ¨æ‹‰å–å¹¶ä½œä¸º HTML æ˜¾ç¤ºå‡ºæ¥ã€‚ 1234567891011121314151617181920212223242526class Markdown extends React.Component &#123; constructor(props) &#123; super(props); // replace with your URL, obviously this.baseUrl = &apos;https://raw.githubusercontent.com/davidgilbertson/about-github/master/text-snippets&apos;; this.state = &#123; markdown: &apos;&apos;, &#125;; &#125; componentDidMount() &#123; fetch(`$&#123;this.baseUrl&#125;/$&#123;this.props.url&#125;`) .then(response =&gt; response.text()) .then((markdown) =&gt; &#123; this.setState(&#123;markdown&#125;); &#125;); &#125; render() &#123; return ( &lt;div dangerouslySetInnerHTML=&#123;&#123;__html: marked(this.state.markdown)&#125;&#125; /&gt; ); &#125;&#125; å¥–åŠ±ç¯èŠ‚ â€”â€” GitHub å·¥å…·æˆ‘å·²ç»ä½¿ç”¨äº† Octotree Chrome extension æœ‰æ®µæ—¶é—´äº†ï¼Œç°åœ¨æˆ‘å‘å¤§å®¶æ¨èå®ƒï¼æ— è®ºä½ æ˜¯åœ¨æŸ¥çœ‹å“ªä¸ª repo å®ƒéƒ½ä¼šåœ¨å·¦ä¾§ç»™ä½ ä¸€ä¸ªæ ‘çŠ¶é¢æ¿ã€‚ é€šè¿‡è¿™ä¸ªè§†é¢‘æˆ‘äº†è§£åˆ°äº† octoboxï¼Œå®ƒæ˜¯ç”¨äºç®¡ç†ä½ çš„ GitHub Issues æ”¶ä»¶ç®±ï¼Œçœ‹èµ·æ¥ç›¸å½“ä¸é”™ï¼ä»¥ä¸Šå°±æ˜¯æˆ‘é’ˆå¯¹äºoctoboxçš„å…¨éƒ¨æƒ³æ³•ã€‚ å…¶ä»–å°±æ˜¯è¿™æ ·äº†ï¼æˆ‘å¸Œæœ›è¿™é‡Œè‡³å°‘æœ‰ä¸‰ä»¶äº‹æ˜¯ä½ è¿˜ä¸çŸ¥é“çš„ã€‚ æœ€å: hava a nice dayï¼]]></content>
      <categories>
        <category>ç¿»è¯‘</category>
      </categories>
      <tags>
        <tag>GitHub</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(åä¸ƒ) MQåº”ç”¨]]></title>
    <url>%2F2017%2F10%2F20%2FSSM17%2F</url>
    <content type="text"><![CDATA[å‰è¨€å†™è¿™ç¯‡æ–‡ç« çš„èµ·å› æ˜¯ç”±äºä¹‹å‰çš„ä¸€ç¯‡å…³äºKafkaå¼‚å¸¸æ¶ˆè´¹ï¼Œå½“æ—¶ä¸ºäº†è§£å†³é—®é¢˜ä¸å¾—ä¸ä½¿ç”¨ä¸´æ—¶çš„æ–¹æ¡ˆã€‚ æ€»ç»“èµ·æ¥å½’æ ¹ç»“åº•è¿˜æ˜¯å¯¹Kafkaä¸ç†Ÿæ‚‰å¯¼è‡´çš„ï¼ŒåŠ ä¸Šå¹³æ—¶å·¥ä½œçš„éœ€è¦ï¼Œä¹‹åå°±èŠ±äº›æ—¶é—´çœ‹äº†Kafkaç›¸å…³çš„èµ„æ–™ã€‚ ä½•æ—¶ä½¿ç”¨MQè°ˆåˆ°Kafkaå°±ä¸å¾—ä¸æåˆ°MQï¼Œæ˜¯å±äºæ¶ˆæ¯é˜Ÿåˆ—çš„ä¸€ç§ã€‚ä½œä¸ºä¸€ç§åŸºç¡€ä¸­é—´ä»¶åœ¨äº’è”ç½‘é¡¹ç›®ä¸­æœ‰ç€å¤§é‡çš„ä½¿ç”¨ã€‚ ä¸€ç§æŠ€æœ¯çš„äº§ç”Ÿè‡ªç„¶æ˜¯ä¸ºäº†è§£å†³æŸç§éœ€æ±‚ï¼Œé€šå¸¸æ¥è¯´æ˜¯ä»¥ä¸‹åœºæ™¯ï¼š éœ€è¦è·¨è¿›ç¨‹é€šä¿¡ï¼šBç³»ç»Ÿéœ€è¦Aç³»ç»Ÿçš„è¾“å‡ºä½œä¸ºè¾“å…¥å‚æ•°ã€‚ å½“Aç³»ç»Ÿçš„è¾“å‡ºèƒ½åŠ›è¿œè¿œå¤§äºBç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ã€‚ é’ˆå¯¹äºç¬¬ä¸€ç§æƒ…å†µæœ‰ä¸¤ç§æ–¹æ¡ˆ: ä½¿ç”¨RPCè¿œç¨‹è°ƒç”¨,Aç›´æ¥è°ƒç”¨Bã€‚ ä½¿ç”¨MQ,Aå‘å¸ƒæ¶ˆæ¯åˆ°MQ,Bè®¢é˜…è¯¥æ¶ˆæ¯ã€‚ å½“æˆ‘ä»¬çš„éœ€æ±‚æ˜¯:Aè°ƒç”¨Bå®æ—¶å“åº”ï¼Œå¹¶ä¸”å®æ—¶å…³å¿ƒå“åº”ç»“æœåˆ™ä½¿ç”¨RPCï¼Œè¿™ç§æƒ…å†µå°±å¾—ä½¿ç”¨åŒæ­¥è°ƒç”¨ã€‚ åä¹‹å½“æˆ‘ä»¬å¹¶ä¸å…³å¿ƒè°ƒç”¨ä¹‹åçš„æ‰§è¡Œç»“æœï¼Œå¹¶ä¸”æœ‰å¯èƒ½è¢«è°ƒç”¨æ–¹çš„æ‰§è¡Œéå¸¸è€—æ—¶ï¼Œè¿™ç§æƒ…å†µå°±éå¸¸é€‚åˆç”¨MQæ¥è¾¾åˆ°å¼‚æ­¥è°ƒç”¨ç›®çš„ã€‚ æ¯”å¦‚å¸¸è§çš„ç™»å½•åœºæ™¯å°±åªèƒ½ç”¨åŒæ­¥è°ƒç”¨çš„æ–¹å¼ï¼Œå› ä¸ºè¿™ä¸ªè¿‡ç¨‹éœ€è¦å®æ—¶çš„å“åº”ç»“æœï¼Œæ€»ä¸èƒ½åœ¨ç”¨æˆ·ç‚¹äº†ç™»å½•ä¹‹åæ’é™¤ç½‘ç»œåŸå› ä¹‹å¤–å†é¢å¤–çš„ç­‰å‡ ç§’å§ã€‚ ä½†ç±»ä¼¼äºç”¨æˆ·ç™»å½•éœ€è¦å¥–åŠ±ç§¯åˆ†çš„æƒ…å†µåˆ™ä½¿ç”¨MQä¼šæ›´å¥½ï¼Œå› ä¸ºç™»å½•å¹¶ä¸å…³ç³»ç§¯åˆ†çš„æƒ…å†µï¼Œåªéœ€è¦å‘ä¸ªæ¶ˆæ¯åˆ°MQ,å¤„ç†ç§¯åˆ†çš„æœåŠ¡è®¢é˜…å¤„ç†å³å¯ï¼Œè¿™æ ·è¿˜å¯ä»¥è§£å†³ç§¯åˆ†ç³»ç»Ÿæ•…éšœå¸¦æ¥çš„é›ªå´©æ•ˆåº”ã€‚ MQè¿˜æœ‰ä¸€ä¸ªåŸºç¡€åŠŸèƒ½åˆ™æ˜¯é™æµå‰Šå³°ï¼Œè¿™å¯¹äºå¤§æµé‡çš„åœºæ™¯å¦‚æœå°†è¯·æ±‚ç›´æ¥è°ƒç”¨åˆ°Bç³»ç»Ÿåˆ™éå¸¸æœ‰å¯èƒ½ä½¿Bç³»ç»Ÿå‡ºç°ä¸å¯ç”¨çš„æƒ…å†µã€‚è¿™ç§åœºæ™¯å°±éå¸¸é€‚åˆå°†è¯·æ±‚æ”¾å…¥MQï¼Œä¸ä½†å¯ä»¥åˆ©ç”¨MQå‰Šå³°è¿˜å°½å¯èƒ½çš„ä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨ã€‚ Kafkaç®€ä»‹æœ¬æ¬¡é‡ç‚¹è®¨è®ºä¸‹Kafkaã€‚ç®€å•æ¥è¯´Kafkaæ˜¯ä¸€ä¸ªæ”¯æŒæ°´å¹³æ‰©å±•ï¼Œé«˜ååç‡çš„åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿã€‚ Kafkaçš„å¸¸ç”¨çŸ¥è¯†: Topic:ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„äº¤äº’éƒ½æ˜¯å›´ç»•ç€ä¸€ä¸ªTopicè¿›è¡Œçš„ï¼Œé€šå¸¸æ¥è¯´æ˜¯ç”±ä¸šåŠ¡æ¥è¿›è¡ŒåŒºåˆ†ï¼Œç”±ç”Ÿäº§æ¶ˆè´¹è€…åå•†ä¹‹åè¿›è¡Œåˆ›å»ºã€‚ Partition(åˆ†åŒº):æ˜¯Topicä¸‹çš„ç»„æˆï¼Œé€šå¸¸ä¸€ä¸ªTopicä¸‹æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†åŒºï¼Œæ¶ˆæ¯ç”Ÿäº§ä¹‹åä¼šæŒ‰ç…§ä¸€å®šçš„ç®—æ³•è´Ÿè½½åˆ°æ¯ä¸ªåˆ†åŒºï¼Œæ‰€ä»¥åˆ†åŒºä¹Ÿæ˜¯Kafkaæ€§èƒ½çš„å…³é”®ã€‚å½“å‘ç°æ€§èƒ½ä¸é«˜æ—¶ä¾¿å¯è€ƒè™‘æ–°å¢åˆ†åŒºã€‚ ç»“æ„å›¾å¦‚ä¸‹: åˆ›å»ºTopicKafkaçš„å®‰è£…å®˜ç½‘æœ‰éå¸¸è¯¦ç»†çš„è®²è§£ã€‚è¿™é‡Œè°ˆä¸€ä¸‹åœ¨æ—¥å¸¸å¼€å‘ä¸­å¸¸è§çš„ä¸€äº›æ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºTopicï¼š 1sh bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 3 --topic `test` åˆ›å»ºäº†ä¸‰ä¸ªåˆ†åŒºçš„testä¸»é¢˜ã€‚ ä½¿ç”¨ 1sh bin/kafka-topics.sh --list --zookeeper localhost:2181 å¯ä»¥åˆ—å‡ºæ‰€æœ‰çš„Topicã€‚ Kafkaç”Ÿäº§è€…ä½¿ç”¨kafkaå®˜æ–¹æ‰€æä¾›çš„Java APIæ¥è¿›è¡Œæ¶ˆæ¯ç”Ÿäº§ï¼Œå®é™…ä½¿ç”¨ä¸­ç¼–ç å®ç°æ›´ä¸ºå¸¸ç”¨: 12345678910111213141516171819202122232425262728293031323334353637383940/** Kafkaç”Ÿäº§è€… * @author crossoverJie */public class Producer &#123; private static final Logger LOGGER = LoggerFactory.getLogger(Producer.class); /** * æ¶ˆè´¹é…ç½®æ–‡ä»¶ */ private static String consumerProPath; public static void main(String[] args) throws IOException &#123; // set up the producer consumerProPath = System.getProperty("product_path"); KafkaProducer&lt;String, String&gt; producer = null; try &#123; FileInputStream inputStream = new FileInputStream(new File(consumerProPath)); Properties properties = new Properties(); properties.load(inputStream); producer = new KafkaProducer&lt;String, String&gt;(properties); &#125; catch (IOException e) &#123; LOGGER.error("load config error", e); &#125; try &#123; // send lots of messages for (int i=0 ;i&lt;100 ; i++)&#123; producer.send(new ProducerRecord&lt;String, String&gt;( "topic_optimization", i+"", i+"")); &#125; &#125; catch (Throwable throwable) &#123; System.out.printf("%s", throwable.getStackTrace()); &#125; finally &#123; producer.close(); &#125; &#125;&#125; å†é…åˆä»¥ä¸‹å¯åŠ¨å‚æ•°å³å¯å‘é€æ¶ˆæ¯:1-Dproduct_path=/xxx/producer.properties ä»¥åŠç”Ÿäº§è€…çš„é…ç½®æ–‡ä»¶:12345678910#é›†ç¾¤åœ°å€ï¼Œå¯ä»¥å¤šä¸ªbootstrap.servers=10.19.13.51:9094acks=allretries=0batch.size=16384auto.commit.interval.ms=1000linger.ms=0key.serializer=org.apache.kafka.common.serialization.StringSerializervalue.serializer=org.apache.kafka.common.serialization.StringSerializerblock.on.buffer.full=true å…·ä½“çš„é…ç½®è¯´æ˜è¯¦è§æ­¤å¤„:https://kafka.apache.org/0100/documentation.html#theproducer æµç¨‹éå¸¸ç®€å•ï¼Œå…¶å®å°±æ˜¯ä¸€äº›APIçš„è°ƒç”¨ã€‚ æ¶ˆæ¯å‘å®Œä¹‹åå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹é˜Ÿåˆ—å†…çš„æƒ…å†µ:1sh kafka-consumer-groups.sh --bootstrap-server localhost:9094 --describe --group group1 å…¶ä¸­çš„lagä¾¿æ˜¯é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯æ•°é‡ã€‚ Kafkaæ¶ˆè´¹è€…æœ‰äº†ç”Ÿäº§è€…è‡ªç„¶ä¹Ÿå°‘ä¸äº†æ¶ˆè´¹è€…ï¼Œè¿™é‡Œé¦–å…ˆé’ˆå¯¹å•çº¿ç¨‹æ¶ˆè´¹: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106/** * Function:kafkaå®˜æ–¹æ¶ˆè´¹ * * @author crossoverJie * Date: 2017/10/19 01:11 * @since JDK 1.8 */public class KafkaOfficialConsumer &#123; private static final Logger LOGGER = LoggerFactory.getLogger(KafkaOfficialConsumer.class); /** * æ—¥å¿—æ–‡ä»¶åœ°å€ */ private static String logPath; /** * ä¸»é¢˜åç§° */ private static String topic; /** * æ¶ˆè´¹é…ç½®æ–‡ä»¶ */ private static String consumerProPath ; /** * åˆå§‹åŒ–å‚æ•°æ ¡éªŒ * @return */ private static boolean initCheck() &#123; topic = System.getProperty("topic") ; logPath = System.getProperty("log_path") ; consumerProPath = System.getProperty("consumer_pro_path") ; if (StringUtil.isEmpty(topic) || logPath.isEmpty()) &#123; LOGGER.error("system property topic ,consumer_pro_path, log_path is required !"); return true; &#125; return false; &#125; /** * åˆå§‹åŒ–kafkaé…ç½® * @return */ private static KafkaConsumer&lt;String, String&gt; initKafkaConsumer() &#123; KafkaConsumer&lt;String, String&gt; consumer = null; try &#123; FileInputStream inputStream = new FileInputStream(new File(consumerProPath)) ; Properties properties = new Properties(); properties.load(inputStream); consumer = new KafkaConsumer&lt;String, String&gt;(properties); consumer.subscribe(Arrays.asList(topic)); &#125; catch (IOException e) &#123; LOGGER.error("åŠ è½½consumer.propsæ–‡ä»¶å‡ºé”™", e); &#125; return consumer; &#125; public static void main(String[] args) &#123; if (initCheck())&#123; return; &#125; int totalCount = 0 ; long totalMin = 0L ; int count = 0; KafkaConsumer&lt;String, String&gt; consumer = initKafkaConsumer(); long startTime = System.currentTimeMillis() ; //æ¶ˆè´¹æ¶ˆæ¯ while (true) &#123; ConsumerRecords&lt;String, String&gt; records = consumer.poll(200); if (records.count() &lt;= 0)&#123; continue ; &#125; LOGGER.debug("æœ¬æ¬¡è·å–:"+records.count()); count += records.count() ; long endTime = System.currentTimeMillis() ; LOGGER.debug("count=" +count) ; if (count &gt;= 10000 )&#123; totalCount += count ; LOGGER.info("this consumer &#123;&#125; recordï¼Œuse &#123;&#125; milliseconds",count,endTime-startTime); totalMin += (endTime-startTime) ; startTime = System.currentTimeMillis() ; count = 0 ; &#125; LOGGER.debug("end totalCount=&#123;&#125;,min=&#123;&#125;",totalCount,totalMin); /*for (ConsumerRecord&lt;String, String&gt; record : records) &#123; record.value() ; JsonNode msg = null; try &#123; msg = mapper.readTree(record.value()); &#125; catch (IOException e) &#123; LOGGER.error("æ¶ˆè´¹æ¶ˆæ¯å‡ºé”™", e); &#125; LOGGER.info("kafka receive = "+msg.toString()); &#125;*/ &#125; &#125;&#125; é…åˆä»¥ä¸‹å¯åŠ¨å‚æ•°:1-Dlog_path=/log/consumer.log -Dtopic=test -Dconsumer_pro_path=consumer.properties å…¶ä¸­é‡‡ç”¨äº†è½®è¯¢çš„æ–¹å¼è·å–æ¶ˆæ¯ï¼Œå¹¶ä¸”è®°å½•äº†æ¶ˆè´¹è¿‡ç¨‹ä¸­çš„æ•°æ®ã€‚ æ¶ˆè´¹è€…é‡‡ç”¨çš„é…ç½®:1234567891011121314151617bootstrap.servers=192.168.1.2:9094group.id=group1# è‡ªåŠ¨æäº¤enable.auto.commit=truekey.deserializer=org.apache.kafka.common.serialization.StringDeserializervalue.deserializer=org.apache.kafka.common.serialization.StringDeserializer# fast session timeout makes it more fun to play with failoversession.timeout.ms=10000# These buffer sizes seem to be needed to avoid consumer switching to# a mode where it processes one bufferful every 5 seconds with multiple# timeouts along the way. No idea why this happens.fetch.min.bytes=50000receive.buffer.bytes=262144max.partition.fetch.bytes=2097152 ä¸ºäº†ç®€ä¾¿æˆ‘é‡‡ç”¨çš„æ˜¯è‡ªåŠ¨æäº¤offsetã€‚ æ¶ˆæ¯å­˜æ”¾æœºåˆ¶è°ˆåˆ°offsetå°±å¿…é¡»å¾—è°ˆè°ˆKafkaçš„æ¶ˆæ¯å­˜æ”¾æœºåˆ¶. Kafkaçš„æ¶ˆæ¯ä¸ä¼šå› ä¸ºæ¶ˆè´¹äº†å°±ä¼šç«‹å³åˆ é™¤ï¼Œæ‰€æœ‰çš„æ¶ˆæ¯éƒ½ä¼šæŒä¹…åŒ–åˆ°æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶é…ç½®æœ‰è¿‡æœŸæ—¶é—´ï¼Œåˆ°äº†æ—¶é—´ä¼šè‡ªåŠ¨åˆ é™¤è¿‡æœŸæ•°æ®ï¼Œå¹¶ä¸”ä¸ä¼šç®¡å…¶ä¸­çš„æ•°æ®æ˜¯å¦è¢«æ¶ˆè´¹è¿‡ã€‚ ç”±äºè¿™æ ·çš„æœºåˆ¶å°±å¿…é¡»çš„æœ‰ä¸€ä¸ªæ ‡å¿—æ¥è¡¨æ˜å“ªäº›æ•°æ®å·²ç»è¢«æ¶ˆè´¹è¿‡äº†ï¼Œoffset(åç§»é‡)å°±æ˜¯è¿™æ ·çš„ä½œç”¨ï¼Œå®ƒç±»ä¼¼äºæŒ‡é’ˆæŒ‡å‘æŸä¸ªæ•°æ®ï¼Œå½“æ¶ˆè´¹ä¹‹åoffsetå°±ä¼šçº¿æ€§çš„å‘å‰ç§»åŠ¨ï¼Œè¿™æ ·ä¸€æ¥çš„è¯æ¶ˆæ¯æ˜¯å¯ä»¥è¢«ä»»æ„æ¶ˆè´¹çš„ï¼Œåªè¦æˆ‘ä»¬ä¿®æ”¹offsetçš„å€¼å³å¯ã€‚ æ¶ˆè´¹è¿‡ç¨‹ä¸­è¿˜æœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„æ˜¯: åŒä¸€ä¸ªconsumer group(group.idç›¸ç­‰)ä¸‹åªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹ï¼Œè¿™ä¸ªåˆšå¼€å§‹ç¡®å®ä¼šè®©å¾ˆå¤šäººè¸©å‘ã€‚ å¤šçº¿ç¨‹æ¶ˆè´¹é’ˆå¯¹äºå•çº¿ç¨‹æ¶ˆè´¹å®ç°èµ·æ¥è‡ªç„¶æ˜¯æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æ•ˆç‡ä¹Ÿæ˜¯è¦å¤§æ‰“æŠ˜æ‰£çš„ã€‚ ä¸ºæ­¤æˆ‘åšäº†ä¸€ä¸ªæµ‹è¯•ï¼Œä½¿ç”¨ä¹‹å‰çš„å•çº¿ç¨‹æ¶ˆè´¹120009æ¡æ•°æ®çš„ç»“æœå¦‚ä¸‹: æ€»å…±èŠ±äº†12450æ¯«ç§’ã€‚ é‚£ä¹ˆæ¢æˆå¤šçº¿ç¨‹æ¶ˆè´¹æ€ä¹ˆå®ç°å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨partitionçš„åˆ†åŒºç‰¹æ€§æ¥æé«˜æ¶ˆè´¹èƒ½åŠ›ï¼Œå•çº¿ç¨‹çš„æ—¶å€™ç­‰äºæ˜¯ä¸€ä¸ªçº¿ç¨‹è¦æŠŠæ‰€æœ‰åˆ†åŒºé‡Œçš„æ•°æ®éƒ½æ¶ˆè´¹ä¸€éï¼Œå¦‚æœæ¢æˆå¤šçº¿ç¨‹å°±å¯ä»¥è®©ä¸€ä¸ªçº¿ç¨‹åªæ¶ˆè´¹ä¸€ä¸ªåˆ†åŒº,è¿™æ ·æ•ˆç‡è‡ªç„¶å°±æé«˜äº†ï¼Œæ‰€ä»¥çº¿ç¨‹æ•°coreSize&lt;=partitionã€‚ é¦–å…ˆæ¥çœ‹ä¸‹å…¥å£: 1234567891011121314151617public class ConsumerThreadMain &#123; private static String brokerList = &quot;localhost:9094&quot;; private static String groupId = &quot;group1&quot;; private static String topic = &quot;test&quot;; /** * çº¿ç¨‹æ•°é‡ */ private static int threadNum = 3; public static void main(String[] args) &#123; ConsumerGroup consumerGroup = new ConsumerGroup(threadNum, groupId, topic, brokerList); consumerGroup.execute(); &#125;&#125; å…¶ä¸­çš„ConsumerGroupç±»:12345678910111213141516171819202122232425262728293031323334353637383940public class ConsumerGroup &#123; private static Logger LOGGER = LoggerFactory.getLogger(ConsumerGroup.class); /** * çº¿ç¨‹æ±  */ private ExecutorService threadPool; private List&lt;ConsumerCallable&gt; consumers ; public ConsumerGroup(int threadNum, String groupId, String topic, String brokerList) &#123; ThreadFactory namedThreadFactory = new ThreadFactoryBuilder() .setNameFormat(&quot;consumer-pool-%d&quot;).build(); threadPool = new ThreadPoolExecutor(threadNum, threadNum, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;(1024), namedThreadFactory, new ThreadPoolExecutor.AbortPolicy()); consumers = new ArrayList&lt;ConsumerCallable&gt;(threadNum); for (int i = 0; i &lt; threadNum; i++) &#123; ConsumerCallable consumerThread = new ConsumerCallable(brokerList, groupId, topic); consumers.add(consumerThread); &#125; &#125; /** * æ‰§è¡Œä»»åŠ¡ */ public void execute() &#123; long startTime = System.currentTimeMillis() ; for (ConsumerCallable runnable : consumers) &#123; Future&lt;ConsumerFuture&gt; future = threadPool.submit(runnable) ; &#125; if (threadPool.isShutdown())&#123; long endTime = System.currentTimeMillis() ; LOGGER.info(&quot;main thread use &#123;&#125; Millis&quot; ,endTime -startTime) ; &#125; threadPool.shutdown(); &#125;&#125; æœ€åçœŸæ­£çš„æ‰§è¡Œé€»è¾‘ConsumerCallable:1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980public class ConsumerCallable implements Callable&lt;ConsumerFuture&gt; &#123; private static Logger LOGGER = LoggerFactory.getLogger(ConsumerCallable.class); private AtomicInteger totalCount = new AtomicInteger() ; private AtomicLong totalTime = new AtomicLong() ; private AtomicInteger count = new AtomicInteger() ; /** * æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤KafkaConsumerå®ä¾‹ */ private final KafkaConsumer&lt;String, String&gt; consumer; public ConsumerCallable(String brokerList, String groupId, String topic) &#123; Properties props = new Properties(); props.put(&quot;bootstrap.servers&quot;, brokerList); props.put(&quot;group.id&quot;, groupId); //è‡ªåŠ¨æäº¤ä½ç§» props.put(&quot;enable.auto.commit&quot;, &quot;true&quot;); props.put(&quot;auto.commit.interval.ms&quot;, &quot;1000&quot;); props.put(&quot;session.timeout.ms&quot;, &quot;30000&quot;); props.put(&quot;key.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;); props.put(&quot;value.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;); this.consumer = new KafkaConsumer&lt;&gt;(props); consumer.subscribe(Arrays.asList(topic)); &#125; /** * Computes a result, or throws an exception if unable to do so. * * @return computed result * @throws Exception if unable to compute a result */ @Override public ConsumerFuture call() throws Exception &#123; boolean flag = true; int failPollTimes = 0 ; long startTime = System.currentTimeMillis() ; while (flag) &#123; // ä½¿ç”¨200msä½œä¸ºè·å–è¶…æ—¶æ—¶é—´ ConsumerRecords&lt;String, String&gt; records = consumer.poll(200); if (records.count() &lt;= 0)&#123; failPollTimes ++ ; if (failPollTimes &gt;= 20)&#123; LOGGER.debug(&quot;è¾¾åˆ°&#123;&#125;æ¬¡æ•°ï¼Œé€€å‡º &quot;,failPollTimes); flag = false ; &#125; continue ; &#125; //è·å–åˆ°ä¹‹ååˆ™æ¸…é›¶ failPollTimes = 0 ; LOGGER.debug(&quot;æœ¬æ¬¡è·å–:&quot;+records.count()); count.addAndGet(records.count()) ; totalCount.addAndGet(count.get()) ; long endTime = System.currentTimeMillis() ; if (count.get() &gt;= 10000 )&#123; LOGGER.info(&quot;this consumer &#123;&#125; recordï¼Œuse &#123;&#125; milliseconds&quot;,count,endTime-startTime); totalTime.addAndGet(endTime-startTime) ; startTime = System.currentTimeMillis() ; count = new AtomicInteger(); &#125; LOGGER.debug(&quot;end totalCount=&#123;&#125;,min=&#123;&#125;&quot;,totalCount,totalTime); /*for (ConsumerRecord&lt;String, String&gt; record : records) &#123; // ç®€å•åœ°æ‰“å°æ¶ˆæ¯ LOGGER.debug(record.value() + &quot; consumed &quot; + record.partition() + &quot; message with offset: &quot; + record.offset()); &#125;*/ &#125; ConsumerFuture consumerFuture = new ConsumerFuture(totalCount.get(),totalTime.get()) ; return consumerFuture ; &#125;&#125; ç†ä¸€ä¸‹é€»è¾‘: å…¶å®å°±æ˜¯åˆå§‹åŒ–å‡ºä¸‰ä¸ªæ¶ˆè´¹è€…å®ä¾‹ï¼Œç”¨äºä¸‰ä¸ªçº¿ç¨‹æ¶ˆè´¹ã€‚å…¶ä¸­åŠ å…¥äº†ä¸€äº›ç»Ÿè®¡ï¼Œæœ€åä¹Ÿæ˜¯æ¶ˆè´¹120009æ¡æ•°æ®ç»“æœå¦‚ä¸‹ã€‚ ç”±äºæ˜¯å¹¶è¡Œè¿è¡Œï¼Œå¯è§æ¶ˆè´¹120009æ¡æ•°æ®å¯ä»¥æé«˜2ç§’å·¦å³ï¼Œå½“æ•°æ®ä»¥æ›´é«˜çš„æ•°é‡çº§æå‡åæ•ˆæœä¼šæ›´åŠ æ˜æ˜¾ã€‚ ä½†è¿™ä¹Ÿæœ‰ä¸€äº›å¼Šç«¯: çµæ´»åº¦ä¸é«˜ï¼Œå½“åˆ†åŒºæ•°é‡å˜æ›´ä¹‹åä¸èƒ½è‡ªé€‚åº”è°ƒæ•´ã€‚ æ¶ˆè´¹é€»è¾‘å’Œå¤„ç†é€»è¾‘åœ¨åŒä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æœå¤„ç†é€»è¾‘è¾ƒä¸ºå¤æ‚ä¼šå½±å“æ•ˆç‡ï¼Œè€¦åˆä¹Ÿè¾ƒé«˜ã€‚å½“ç„¶è¿™ä¸ªå¤„ç†é€»è¾‘å¯ä»¥å†é€šè¿‡ä¸€ä¸ªå†…éƒ¨é˜Ÿåˆ—å‘å‡ºå»ç”±å¦å¤–çš„ç¨‹åºæ¥å¤„ç†ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ æ€»ç»“Kafkaçš„çŸ¥è¯†ç‚¹è¿˜æ˜¯è¾ƒå¤šï¼ŒKafkaçš„ä½¿ç”¨ä¹Ÿè¿œä¸è¿™äº›ã€‚ä¹‹åä¼šç»§ç»­åˆ†äº«ä¸€äº›å…³äºKafkaç›‘æ§ç­‰ç›¸å…³å†…å®¹ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢ï¼šhttp://crossoverjie.topã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Kafka</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[sbc(äº”)Hystrix-æœåŠ¡å®¹é”™ä¸ä¿æŠ¤]]></title>
    <url>%2F2017%2F09%2F20%2Fsbc5%2F</url>
    <content type="text"><![CDATA[å‰è¨€çœ‹è¿‡ åº”ç”¨é™æµçš„æœ‹å‹åº”è¯¥çŸ¥é“ï¼Œé™æµçš„æ ¹æœ¬ç›®çš„å°±æ˜¯ä¸ºäº†ä¿éšœæœåŠ¡çš„é«˜å¯ç”¨ã€‚ æœ¬æ¬¡å†å€ŸåŠ©SpringCloudä¸­çš„é›†æˆçš„Hystrixç»„ä»¶æ¥è°ˆè°ˆæœåŠ¡å®¹é”™ã€‚ å…¶å®äº§ç”ŸæŸé¡¹éœ€æ±‚çš„åŸå› éƒ½æ˜¯ä¸ºäº†è§£å†³æŸä¸ªéœ€æ±‚ã€‚å½“æˆ‘ä»¬å°†åº”ç”¨è¿›è¡Œåˆ†å¸ƒå¼æ¨¡å—éƒ¨ç½²ä¹‹å,å„ä¸ªæ¨¡å—ä¹‹é—´é€šè¿‡è¿œç¨‹è°ƒç”¨çš„æ–¹å¼è¿›è¡Œäº¤äº’(RPC)ã€‚æ‹¿æˆ‘ä»¬å¹³æ—¶æœ€å¸¸è§çš„ä¸‹å•ä¹°å•†å“æ¥è¯´ï¼Œç‚¹å‡»ä¸‹å•æŒ‰é’®çš„ä¸€ç¬é—´å¯èƒ½ä¼šå‘å‘é€çš„è¯·æ±‚åŒ…å«ï¼š è¯·æ±‚è®¢å•ç³»ç»Ÿåˆ›å»ºè®¢å•ã€‚ è¯·æ±‚åº“å­˜ç³»ç»Ÿæ‰£é™¤åº“å­˜ã€‚ è¯·æ±‚ç”¨æˆ·ç³»ç»Ÿæ›´æ–°ç”¨æˆ·äº¤æ˜“è®°å½•ã€‚ è¿™å…¶ä¸­çš„æ¯ä¸€æ­¥éƒ½æœ‰å¯èƒ½å› ä¸ºç½‘ç»œã€èµ„æºã€æœåŠ¡å™¨ç­‰åŸå› é€ æˆå»¶è¿Ÿå“åº”ç”šè‡³æ˜¯è°ƒç”¨å¤±è´¥ã€‚å½“åé¢çš„è¯·æ±‚æºæºä¸æ–­çš„è¿‡æ¥æ—¶å»¶è¿Ÿçš„èµ„æºä¹Ÿæ²¡æœ‰çš„åˆ°é‡Šæ”¾ï¼Œè¿™æ ·çš„å †ç§¯å¾ˆæœ‰å¯èƒ½æŠŠå…¶ä¸­ä¸€ä¸ªæ¨¡å—æ‹–å®ï¼Œå…¶ä¸­çš„ä¾èµ–å…³ç³»åˆæœ‰å¯èƒ½æŠŠæ•´ä¸ªè°ƒç”¨é“¾ä¸­çš„åº”ç”¨Overæœ€åå¯¼è‡´æ•´ä¸ªç³»ç»Ÿä¸å¯èƒ½ã€‚è¿™æ ·å°±ä¼šäº§ç”Ÿä¸€ç§ç°è±¡:é›ªå´©æ•ˆåº”ã€‚ ä¹‹å‰è®²åˆ°çš„é™æµä¹Ÿèƒ½èµ·åˆ°ä¸€å®šçš„ä¿æŠ¤ä½œç”¨ï¼Œä½†è¿˜è¿œè¿œä¸å¤Ÿã€‚æˆ‘ä»¬éœ€è¦ä»å„ä¸ªæ–¹é¢æ¥ä¿éšœæœåŠ¡çš„é«˜å¯ç”¨ã€‚ æ¯”å¦‚ï¼š è¶…æ—¶é‡è¯•ã€‚ æ–­è·¯å™¨æ¨¡å¼ã€‚ æœåŠ¡é™çº§ã€‚ç­‰å„ä¸ªæ–¹é¢æ¥ä¿éšœã€‚ ä½¿ç”¨HystrixSpringCloudä¸­å·²ç»ä¸ºæˆ‘ä»¬é›†æˆäº†Netflixå¼€æºçš„Hystrixæ¡†æ¶ï¼Œä½¿ç”¨è¯¥æ¡†æ¶å¯ä»¥å¾ˆå¥½çš„å¸®æˆ‘ä»¬åšåˆ°æœåŠ¡å®¹é”™ã€‚ Hystrixç®€ä»‹ä¸‹é¢æ˜¯ä¸€å¼ å®˜æ–¹çš„æµç¨‹å›¾: ç®€å•ä»‹ç»ä¸‹: åœ¨è¿œç¨‹è°ƒç”¨æ—¶ï¼Œå°†è¯·æ±‚å°è£…åˆ°HystrixCommandè¿›è¡ŒåŒæ­¥æˆ–æ˜¯å¼‚æ­¥è°ƒç”¨ï¼Œåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­åˆ¤æ–­ç†”æ–­å™¨æ˜¯å¦æ‰“å¼€ã€çº¿ç¨‹æ± æˆ–æ˜¯ä¿¡å·é‡æ˜¯å¦é¥±å’Œã€æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœæ˜¯çš„è¯å°±ä¼šè¿›å…¥å›é€€é€»è¾‘ã€‚å¹¶ä¸”æ•´ä¸ªè¿‡ç¨‹ä¸­éƒ½ä¼šæ”¶é›†è¿è¡ŒçŠ¶æ€æ¥æ§åˆ¶æ–­è·¯å™¨çš„çŠ¶æ€ã€‚ ä¸ä½†å¦‚æ­¤è¯¥æ¡†æ¶è¿˜æ‹¥æœ‰è‡ªæˆ‘æ¢å¤åŠŸèƒ½ï¼Œå½“æ–­è·¯å™¨æ‰“å¼€åï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šè¿›å…¥å›é€€é€»è¾‘ã€‚å½“æˆ‘ä»¬çš„åº”ç”¨æ¢å¤æ­£å¸¸åä¹Ÿä¸èƒ½å†è¿›å…¥å›é€€é€»è¾‘å§ã€‚ æ‰€ä»¥hystrixä¼šåœ¨æ–­è·¯å™¨æ‰“å¼€åçš„ä¸€å®šæ—¶é—´å°†è¯·æ±‚å‘é€åˆ°æœåŠ¡æä¾›è€…ï¼Œå¦‚æœæ­£å¸¸å“åº”å°±å…³é—­æ–­è·¯å™¨ï¼Œåä¹‹åˆ™ç»§ç»­æ‰“å¼€ï¼Œè¿™æ ·å°±èƒ½å¾ˆçµæ´»çš„è‡ªæˆ‘ä¿®å¤äº†ã€‚ Feignæ•´åˆHystrixåœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­å·²ç»ä½¿ç”¨Feignæ¥è¿›è¡Œå£°æ˜å¼è°ƒç”¨äº†ï¼Œå¹¶ä¸”åœ¨å®é™…å¼€å‘ä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæ‰€ä»¥è¿™æ¬¡æˆ‘ä»¬å°±ç›´æ¥ç”¨Feignæ¥æ•´åˆHystrixã€‚ ä½¿ç”¨äº†é¡¹ç›®åŸæœ‰çš„sbc-user,sbc-orderæ¥è¿›è¡Œæ¼”ç¤ºï¼Œè°ƒç”¨å…³ç³»å¦‚ä¸‹å›¾: Useråº”ç”¨é€šè¿‡Orderæä¾›å‡ºæ¥çš„order-clientä¾èµ–è°ƒç”¨äº†Orderä¸­çš„åˆ›å»ºè®¢å•æœåŠ¡ã€‚ å…¶ä¸­ä¸»è¦ä¿®æ”¹çš„å°±æ˜¯order-clientï¼Œåœ¨ä¹‹å‰çš„OrderServiceClientæ¥å£ä¸­å¢åŠ äº†ä»¥ä¸‹æ³¨è§£: 12345678910111213@RequestMapping(value="/orderService")@FeignClient(name="sbc-order", // fallbackFactory = OrderServiceFallbackFactory.class, // FIXME: 2017/9/4 å¦‚æœé…ç½®äº†fallback é‚£ä¹ˆfallbackFactoryå°†ä¼šæ— æ•ˆ fallback = OrderServiceFallBack.class, configuration = OrderConfig.class)@RibbonClientpublic interface OrderServiceClient extends OrderService&#123; @ApiOperation("è·å–è®¢å•å·") @RequestMapping(value = "/getOrderNo", method = RequestMethod.POST) BaseResponse&lt;OrderNoResVO&gt; getOrderNo(@RequestBody OrderNoReqVO orderNoReq) ;&#125; ç”±äºFeignå·²ç»é»˜è®¤æ•´åˆäº†Hystrixæ‰€ä»¥ä¸éœ€è¦å†é¢å¤–åŠ å…¥ä¾èµ–ã€‚ æœåŠ¡é™çº§å¯¹åº”çš„@FeignClientä¸­çš„fallbackå±æ€§åˆ™æ˜¯æœåŠ¡å®¹é”™ä¸­å¾ˆå…³é”®çš„æœåŠ¡é™çº§çš„å…·ä½“å®ç°ï¼Œæ¥çœ‹çœ‹OrderServiceFallBackç±»: 123456789101112public class OrderServiceFallBack implements OrderServiceClient &#123; @Override public BaseResponse&lt;OrderNoResVO&gt; getOrderNo(@RequestBody OrderNoReqVO orderNoReq) &#123; BaseResponse&lt;OrderNoResVO&gt; baseResponse = new BaseResponse&lt;&gt;() ; OrderNoResVO vo = new OrderNoResVO() ; vo.setOrderId(123456L); baseResponse.setDataBody(vo); baseResponse.setMessage(StatusEnum.FALLBACK.getMessage()); baseResponse.setCode(StatusEnum.FALLBACK.getCode()); return baseResponse; &#125;&#125; è¯¥ç±»å®ç°äº†OrderServiceClientæ¥å£ï¼Œå¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºå…¶ä¸­çš„getOrderNo()æ–¹æ³•å°±æ˜¯æœåŠ¡é™çº§æ—¶æ‰€è§¦å‘çš„é€»è¾‘ã€‚ å…‰æœ‰å®ç°è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬éœ€è¦å°†æ”¹ç±»åŠ å…¥åˆ°Springä¸­ç®¡ç†èµ·æ¥ã€‚è¿™æ ·ä¸Šæ–‡ä¸­@FeignClientçš„configurationå±æ€§å°±èµ·åˆ°ä½œç”¨äº†ï¼Œæ¥çœ‹çœ‹å¯¹åº”çš„OrderConfigçš„ä»£ç : 123456789101112@Configurationpublic class OrderConfig &#123; @Bean public OrderServiceFallBack fallBack()&#123; return new OrderServiceFallBack(); &#125; @Bean public OrderServiceFallbackFactory factory()&#123; return new OrderServiceFallbackFactory(); &#125;&#125; å…¶ä¸­new OrderServiceFallBack()å¹¶ç”¨äº†@Beanæ³¨è§£ï¼Œç­‰åŒäº: 12&lt;bean id=&quot;orderServiceFallBack&quot; class=&quot;com.crossoverJie.order.feign.config.OrderServiceFallBack&quot;&gt;&lt;/bean&gt; è¿™æ ·æ¯å½“è¯·æ±‚å¤±è´¥å°±ä¼šæ‰§è¡Œå›é€€é€»è¾‘ï¼Œå¦‚ä¸‹å›¾: å€¼å¾—æ³¨æ„çš„æ˜¯å³ä¾¿æ˜¯æ‰§è¡Œäº†å›é€€é€»è¾‘æ–­è·¯å™¨ä¹Ÿä¸ä¸€å®šæ‰“å¼€äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åº”ç”¨çš„healthç«¯ç‚¹æ¥æŸ¥çœ‹Hystrixçš„çŠ¶æ€ã€‚ ps:æƒ³è¦æŸ¥çœ‹è¯¥ç«¯ç‚¹éœ€è¦åŠ å…¥ä»¥ä¸‹ä¾èµ–: 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; å°±æ‹¿åˆšæ‰çš„ä¾‹å­æ¥è¯´ï¼Œå…ˆå…³é—­Orderåº”ç”¨ï¼Œåœ¨Swaggerè®¿é—®ä¸‹é¢è¿™ä¸ªæ¥å£ï¼Œè‚¯å®šæ˜¯ä¼šè¿›å…¥å›é€€é€»è¾‘: 12345678910@RestController@Api("ç”¨æˆ·æœåŠ¡API")@RequestMapping(value = "/userService")@Validatedpublic interface UserService &#123; @ApiOperation("hystrixå®¹é”™è°ƒç”¨") @RequestMapping(value = "/getUserByHystrix", method = RequestMethod.POST) BaseResponse&lt;OrderNoResVO&gt; getUserByHystrix(@RequestBody UserReqVO userReqVO) ;&#125; æŸ¥çœ‹healthç«¯ç‚¹: å‘ç°Hystrixçš„çŠ¶æ€ä¾ç„¶æ˜¯UPçŠ¶æ€ï¼Œè¡¨æ˜å½“å‰æ–­è·¯å™¨å¹¶æ²¡æœ‰æ‰“å¼€ã€‚ åå¤è°ƒç”¨å¤šæ¬¡æ¥å£ä¹‹åå†æ¬¡æŸ¥çœ‹healthç«¯ç‚¹: å‘ç°è¿™ä¸ªæ—¶å€™æ–­è·¯å™¨å·²ç»æ‰“å¼€äº†ã€‚ è¿™æ˜¯å› ä¸ºæ–­è·¯å™¨åªæœ‰åœ¨è¾¾åˆ°äº†ä¸€å®šçš„å¤±è´¥é˜ˆå€¼ä¹‹åæ‰ä¼šæ‰“å¼€ã€‚ è¾“å‡ºå¼‚å¸¸è¿›å…¥å›é€€é€»è¾‘ä¹‹åè¿˜ä¸ç®—å®Œï¼Œå¤§éƒ¨åˆ†åœºæ™¯æˆ‘ä»¬éƒ½éœ€è¦è®°å½•ä¸ºä»€ä¹ˆå›é€€ï¼Œä¹Ÿå°±æ˜¯å…·ä½“çš„å¼‚å¸¸ã€‚è¿™äº›ä¿¡æ¯å¯¹æˆ‘ä»¬åç»­çš„ç³»ç»Ÿç›‘æ§ï¼Œåº”ç”¨è°ƒä¼˜ä¹Ÿæœ‰å¾ˆå¤§å¸®åŠ©ã€‚ å®ç°èµ·æ¥ä¹Ÿå¾ˆç®€å•:ä¸Šæ–‡ä¸­åœ¨@FeignClientæ³¨è§£ä¸­åŠ å…¥çš„fallbackFactory = OrderServiceFallbackFactory.classå±æ€§åˆ™æ˜¯ç”¨äºå¤„ç†å›é€€é€»è¾‘ä»¥åŠåŒ…å«å¼‚å¸¸ä¿¡æ¯ï¼š 123456789101112131415161718192021222324252627282930/** * Function:æŸ¥çœ‹fallbackåŸå›  * * @author crossoverJie * Date: 2017/9/4 00:45 * @since JDK 1.8 */public class OrderServiceFallbackFactory implements FallbackFactory&lt;OrderServiceClient&gt;&#123; private final static Logger LOGGER = LoggerFactory.getLogger(OrderServiceFallbackFactory.class); @Override public OrderServiceClient create(Throwable throwable) &#123; return new OrderServiceClient() &#123; @Override public BaseResponse&lt;OrderNoResVO&gt; getOrderNo(@RequestBody OrderNoReqVO orderNoReq) &#123; LOGGER.error("fallback:" + throwable); BaseResponse&lt;OrderNoResVO&gt; baseResponse = new BaseResponse&lt;&gt;() ; OrderNoResVO vo = new OrderNoResVO() ; vo.setOrderId(123456L); baseResponse.setDataBody(vo); baseResponse.setMessage(StatusEnum.FALLBACK.getMessage()); baseResponse.setCode(StatusEnum.FALLBACK.getCode()); return baseResponse; &#125; &#125;; &#125;&#125; ä»£ç å¾ˆç®€å•ï¼Œå®ç°äº†FallbackFactoryæ¥å£ä¸­çš„create()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å…¥å‚å°±æ˜¯å¼‚å¸¸ä¿¡æ¯ï¼Œå¯ä»¥æŒ‰ç…§æˆ‘ä»¬çš„éœ€è¦è‡ªè¡Œå¤„ç†ï¼Œåé¢åˆ™æ˜¯å’Œä¹‹å‰ä¸€æ ·çš„å›é€€å¤„ç†ã€‚ 2017-09-21 13:22:30.307 ERROR 27838 --- [rix-sbc-order-1] c.c.o.f.f.OrderServiceFallbackFactory : fallback:java.lang.RuntimeException: com.netflix.client.ClientException: Load balancer does not have available server for client: sbc-orderã€‚ Note: fallbackFactoryå’Œfallbackå±æ€§ä¸å¯å…±ç”¨ã€‚ Hystrixç›‘æ§Hystrixè¿˜è‡ªå¸¦äº†ä¸€å¥—ç›‘æ§ç»„ä»¶ï¼Œåªè¦ä¾èµ–äº†spring-boot-starter-actuatorå³å¯é€šè¿‡/hystrix.streamç«¯ç‚¹æ¥è·å¾—ç›‘æ§ä¿¡æ¯ã€‚ å†°å†·çš„æ•°æ®è‚¯å®šæ²¡æœ‰å®æ—¶çš„å›¾è¡¨æ¥çš„ç›´è§‚ï¼Œæ‰€ä»¥Hystrixä¹Ÿè‡ªå¸¦Dashboardã€‚ Hystrixä¸Turbineèšåˆç›‘æ§ä¸ºæ­¤æˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ªåº”ç”¨sbc-hystrix-turbineæ¥æ˜¾ç¤ºhystrix-dashboardã€‚ç›®å½•ç»“æ„å’Œæ™®é€šçš„springbootåº”ç”¨æ²¡æœ‰å·®å¼‚ï¼Œçœ‹çœ‹ä¸»ç±»: 1234567891011//å¼€å¯EnableTurbine@EnableTurbine@SpringBootApplication@EnableHystrixDashboardpublic class SbcHystrixTurbineApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SbcHystrixTurbineApplication.class, args); &#125;&#125; å…¶ä¸­ä½¿ç”¨@EnableHystrixDashboardå¼€å¯Dashboard @EnableTurbineå¼€å¯Turbineæ”¯æŒã€‚ ä»¥ä¸Šè¿™äº›æ³¨è§£éœ€è¦ä»¥ä¸‹è¿™äº›ä¾èµ–:12345678910111213141516&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-turbine&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-netflix-turbine&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-hystrix-dashboard&lt;/artifactId&gt;&lt;/dependency&gt; å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬çš„åº”ç”¨éƒ½æ˜¯å¤šèŠ‚ç‚¹éƒ¨ç½²ä»¥è¾¾åˆ°é«˜å¯ç”¨çš„ç›®çš„ï¼Œå•ä¸ªç›‘æ§æ˜¾ç„¶ä¸ç°å®ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨Turbineæ¥è¿›è¡Œèšåˆç›‘æ§ã€‚ å…³é”®çš„application.propertiesé…ç½®æ–‡ä»¶: 123456789101112# é¡¹ç›®é…ç½®spring.application.name=sbc-hystrix-trubineserver.context-path=/server.port=8282# eurekaåœ°å€eureka.client.serviceUrl.defaultZone=http://node1:8888/eureka/eureka.instance.prefer-ip-address=true# éœ€è¦åŠ å…¥çš„å®ä¾‹turbine.appConfig=sbc-user,sbc-orderturbine.cluster-name-expression=&quot;default&quot; å…¶ä¸­turbine.appConfigé…ç½®æˆ‘ä»¬éœ€è¦ç›‘æ§çš„åº”ç”¨ï¼Œè¿™æ ·å½“å¤šèŠ‚ç‚¹éƒ¨ç½²çš„æ—¶å€™å°±éå¸¸æ–¹ä¾¿äº†(åŒä¸€ä¸ªåº”ç”¨çš„å¤šä¸ªèŠ‚ç‚¹spring.application.nameå€¼æ˜¯ç›¸åŒçš„)ã€‚ å°†è¯¥åº”ç”¨å¯åŠ¨è®¿é—®http://ip:port/hystrix.streamï¼š ç”±äºæˆ‘ä»¬çš„turbineå’ŒDashboardæ˜¯ä¸€ä¸ªåº”ç”¨æ‰€ä»¥è¾“å…¥http://localhost:8282/turbine.streamå³å¯ã€‚ è¯¦ç»†æŒ‡æ ‡å¦‚å®˜æ–¹æè¿°: é€šè¿‡è¯¥é¢æ¿æˆ‘ä»¬å°±å¯ä»¥åŠæ—¶çš„äº†è§£åˆ°åº”ç”¨å½“å‰çš„å„ä¸ªçŠ¶æ€ï¼Œå¦‚æœå†åŠ ä¸Šä¸€äº›æŠ¥è­¦æªæ–½å°±èƒ½å¸®æˆ‘ä»¬åŠæ—¶çš„å“åº”ç”Ÿäº§é—®é¢˜ã€‚ æ€»ç»“æœåŠ¡å®¹é”™çš„æ•´ä¸ªè¿˜æ˜¯æ¯”è¾ƒå¤§çš„,åšä¸»ä¹Ÿæ˜¯æ‘¸ç€çŸ³å¤´è¿‡æ²³ï¼Œå…³äºæœ¬æ¬¡çš„Hystrixåªæ˜¯ä¸€ä¸ªå…¥é—¨ç‰ˆï¼Œåé¢ä¼šæŒç»­åˆ†æå®ƒçš„çº¿ç¨‹éš”ç¦»ã€ä¿¡å·é‡éš”ç¦»ç­‰åŸç†ã€‚ é¡¹ç›®ï¼šhttps://github.com/crossoverJie/springboot-cloud åšå®¢ï¼šhttp://crossoverjie.topã€‚]]></content>
      <categories>
        <category>sbc</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>SpringCloud</tag>
        <tag>Hystrix</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(åå…­) æ›²çº¿æ•‘å›½-Kafkaæ¶ˆè´¹å¼‚å¸¸]]></title>
    <url>%2F2017%2F09%2F05%2FSSM16%2F</url>
    <content type="text"><![CDATA[å‰è¨€æœ€è¿‘çº¿ä¸Šé‡åˆ°ä¸€ä¸ªé—®é¢˜:åœ¨æ¶ˆè´¹kafkaæ¶ˆæ¯çš„æ—¶å€™å¦‚æœé•¿æ—¶é—´(å¤§æ¦‚åŠå¤©åˆ°ä¸€å¤©çš„æ—¶é—´)é˜Ÿåˆ—é‡Œæ²¡æœ‰æ¶ˆæ¯å°±å¯èƒ½å†ä¹Ÿæ¶ˆè´¹ä¸äº†ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜æˆ‘ä»¬åå¤è°ƒè¯•å¤šæ¬¡ã€‚çº¿ä¸‹æ¨¡æ‹Ÿï¼Œè°ƒæ•´ä»£ç ï¼Œä½†è²Œä¼¼è¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°åŸå› ã€‚ä½†æ˜¯åªè¦é‡å¯æ¶ˆè´¹è¿›ç¨‹å°±åˆå¯ä»¥ç»§ç»­æ¶ˆè´¹ã€‚ è§£å†³æ–¹æ¡ˆç”±äºçº¿ä¸Šä¸šåŠ¡éå¸¸ä¾èµ–kafkaçš„æ¶ˆè´¹ï¼Œä½†ä¸€æ—¶åŠä¼šä¹Ÿæ²¡æœ‰æ‰¾åˆ°åŸå› ï¼Œæ‰€ä»¥æœ€ååªèƒ½æƒ³ä¸€ä¸ªä¸´æ—¶çš„æ›¿æ¢æ–¹æ¡ˆï¼š åŸºäºé‡å¯å°±å¯ä»¥æ¶ˆè´¹è¿™ä¸ªç‰¹ç‚¹ï¼Œæˆ‘ä»¬åœ¨æ¯æ¬¡æ¶ˆè´¹çš„æ—¶å€™éƒ½è®°ä¸‹å½“å‰çš„æ—¶é—´ç‚¹ï¼Œå½“è¿™ä¸ªæ—¶é—´ç‚¹åœ¨ååˆ†é’Ÿä¹‹å†…éƒ½æ²¡æœ‰æ›´æ–°æˆ‘ä»¬å°±è®¤ä¸ºå½“å‰é˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯äº†ï¼Œå°±éœ€è¦é‡å¯ä¸‹æ¶ˆè´¹è¿›ç¨‹ã€‚ æ—¢ç„¶æ˜¯éœ€è¦é‡å¯ï¼Œç”±äºç›®å‰è¿˜æ²¡æœ‰ä¸Šåˆ†å¸ƒå¼è°ƒåº¦ä¸­å¿ƒæ‰€ä»¥éœ€è¦crontabæ¥é…åˆè°ƒåº¦ï¼šæ¯éš”ä¸€åˆ†é’Ÿä¼šè°ƒç”¨ä¸€ä¸ªshellè„šæœ¬ï¼Œè¯¥è„šæœ¬ä¼šåˆ¤æ–­å½“å‰è¿›ç¨‹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™ä»€ä¹ˆéƒ½ä¸ä½œï¼Œä¸å­˜åœ¨åˆ™å¯åŠ¨æ¶ˆè´¹è¿›ç¨‹ã€‚ å…·ä½“å®ç°æ¶ˆè´¹ç¨‹åº:123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106/** * kafkaæ¶ˆè´¹ * * @author crossoverJie * @date 2017å¹´6æœˆ19æ—¥ ä¸‹åˆ3:15:16 */public class KafkaMsgConsumer &#123; private static final Logger LOGGER = LoggerFactory.getLogger(KafkaMsgConsumer.class); private static final int CORE_POOL_SIZE = 4; private static final int MAXIMUM_POOL_SIZE = 4; private static final int BLOCKING_QUEUE_CAPACITY = 4000; private static final String KAFKA_CONFIG = "kafkaConfig"; private static final ExecutorService fixedThreadPool = new ThreadPoolExecutor(CORE_POOL_SIZE, MAXIMUM_POOL_SIZE, 0L, TimeUnit.MILLISECONDS, new ArrayBlockingQueue&lt;Runnable&gt;(BLOCKING_QUEUE_CAPACITY)); //æœ€åæ›´æ–°æ—¶é—´ private static AtomicLong LAST_MESSAGE_TIME = new AtomicLong(DateUtil.getLongTime()); private static MsgIterator iter = null; private static String topic;//ä¸»é¢˜åç§° static &#123; Properties properties = new Properties(); String path = System.getProperty(KAFKA_CONFIG); checkArguments(!StringUtils.isBlank(path), "å¯åŠ¨å‚æ•°ä¸­æ²¡æœ‰é…ç½®kafka_easyframe_msgå‚æ•°æ¥æŒ‡å®škafkaå¯åŠ¨å‚æ•°ï¼Œè¯·ä½¿ç”¨-DkafkaConfig=/path/fileName/easyframe-msg.properties"); try &#123; properties.load(new FileInputStream(new File(path))); &#125; catch (IOException e) &#123; LOGGER.error("IOException" ,e); &#125; EasyMsgConfig.setProperties(properties); &#125; private static void iteratorTopic() &#123; if (iter == null) &#123; iter = MsgUtil.consume(topic); &#125; long i = 0L; while (iter.hasNext()) &#123; i++; if (i % 10000 == 0) &#123; LOGGER.info("consume i:" + i); &#125; try &#123; String message = iter.next(); if (StringUtils.isEmpty(message)) &#123; continue; &#125; LAST_MESSAGE_TIME = new AtomicLong(DateUtil.getLongTime()); //å¤„ç†æ¶ˆæ¯ LOGGER.debug("msg = " + JSON.toJSONString(message)); &#125; catch (Exception e) &#123; LOGGER.error("KafkaMsgConsumer err:", e); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e1) &#123; LOGGER.error("Thread InterruptedException", e1); &#125; break; &#125; &#125; &#125; public static void main(String[] args) &#123; topic = System.getProperty("topic"); checkArguments(!StringUtils.isBlank(topic), "system property topic or log_path is must!"); while (true) &#123; try &#123; iteratorTopic(); &#125; catch (Exception e) &#123; MsgUtil.shutdownConsummer(); iter = null; LOGGER.error("KafkaMsgConsumer err:", e); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e1) &#123; LOGGER.error("Thread InterruptedException", e1); &#125; &#125; finally &#123; //æ­¤å¤„å…³é—­ä¹‹åï¼Œç”±crontabæ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼ŒæŒ‚æ‰çš„è¯ä¼šé‡æ–°æ‹‰èµ·æ¥ if (DateUtil.getLongTime() - LAST_MESSAGE_TIME.get() &gt; 10 * 60) &#123; //10åˆ†é’Ÿ fixedThreadPool.shutdown(); LOGGER.info("çº¿ç¨‹æ± æ˜¯å¦å…³é—­ï¼š" + fixedThreadPool.isShutdown()); try &#123; //å½“å‰çº¿ç¨‹é˜»å¡10msåï¼Œå»æ£€æµ‹çº¿ç¨‹æ± æ˜¯å¦ç»ˆæ­¢ï¼Œç»ˆæ­¢åˆ™è¿”å›true while (!fixedThreadPool.awaitTermination(10, TimeUnit.MILLISECONDS)) &#123; LOGGER.info("æ£€æµ‹çº¿ç¨‹æ± æ˜¯å¦ç»ˆæ­¢ï¼š" + fixedThreadPool.isTerminated()); &#125; &#125; catch (InterruptedException e) &#123; LOGGER.error("ç­‰å¾…çº¿ç¨‹æ± å…³é—­é”™è¯¯", e); &#125; LOGGER.info("çº¿ç¨‹æ± æ˜¯å¦ç»ˆæ­¢ï¼š" + fixedThreadPool.isTerminated()); LOGGER.info("in 10 min dont have data break"); break; &#125; &#125; &#125; LOGGER.info("app shutdown"); System.exit(0); &#125;&#125; åœ¨çº¿ä»£ç  éœ€è¦é…åˆä»¥ä¸‹è¿™ä¸ªshellè„šæœ¬è¿è¡Œ: 1234567891011121314151617181920#!/bin/sh#crontab# * * * * * sh /data/schedule/kafka/run-kafka-consumer.sh &gt;&gt;/data/schedule/kafka/run-sms-log.log# å¦‚æœè¿›ç¨‹å­˜åœ¨å°±ä¸å¯åŠ¨a1=`ps -ef|grep &apos;KafkaMsgConsumer&apos;|grep -v grep|wc -l`if [ $a1 -gt 0 ];then echo &quot;======= `date +&apos;%Y-%m-%d %H:%M:%S&apos;` KafkaMsgConsumer is EXIT...======= &quot; exitfiLANG=&quot;zh_CN.UTF-8&quot;nohup /opt/java/jdk1.7.0_80/bin/java -d64 -Djava.security.egd=file:/dev/./urandom-Djava.ext.dirs=/opt/tomcat/webapps/ROOT/WEB-INF/lib-Dtopic=TOPIC_A-Dlogback.configurationFile=/data/schedule/kafka/logback.xml-DkafkaConfig=/opt/tomcat/iopconf/easyframe-msg.properties-classpath /opt/tomcat/webapps/ROOT/WEB-INF/classes com.crossoverJie.kafka.SMSMsgConsumer &gt;&gt; /data/schedule/kafka/smslog/kafka.log 2&gt;&amp;1 &amp;echo &quot;`date +&apos;%Y-%m-%d %H:%M:%S&apos;` KafkaMsgConsumer running....&quot; åœ¨çº¿ä»£ç  å†é…åˆcrontabçš„è°ƒåº¦:1* * * * * sh /data/schedule/kafka/run-kafka-consumer.sh &gt;&gt;/data/schedule/kafka/run-sms-log.log å³å¯ã€‚ æ€»ç»“è™½è¯´å¤„ç†èµ·æ¥å¾ˆç®€å•ï¼Œä½†ä¾ç„¶æ˜¯æ²»æ ‡ä¸æ²»æœ¬ï¼Œä¾èµ–çš„ä¸œè¥¿æ¯”è¾ƒå¤š(shellè„šæœ¬ï¼Œè°ƒåº¦)ã€‚æ‰€ä»¥ä¹Ÿé—®é—®å„ä½æœ‰æ²¡æœ‰ä»€ä¹ˆæ€è·¯ï¼š æ¶ˆè´¹ç¨‹åºç”¨çš„:https://github.com/linzhaoming/easyframe-msg ç”Ÿäº§é…ç½®: ä¸‰å°kafkaã€ZKç»„æˆçš„é›†ç¾¤ã€‚ å…¶ä¸­ä¹Ÿæœ‰å…¶ä»–å›¢é˜Ÿçš„æ¶ˆè´¹ç¨‹åºåœ¨æ­£å¸¸è¿è¡Œï¼Œåº”è¯¥å’Œkafkaçš„é…ç½®æ²¡æœ‰å…³ç³»ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢ï¼šhttp://crossoverjie.topã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Kafka</tag>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[sbc(å››)åº”ç”¨é™æµ]]></title>
    <url>%2F2017%2F08%2F11%2Fsbc4%2F</url>
    <content type="text"><![CDATA[å‰è¨€ åœ¨ä¸€ä¸ªé«˜å¹¶å‘ç³»ç»Ÿä¸­å¯¹æµé‡çš„æŠŠæ§æ˜¯éå¸¸é‡è¦çš„ï¼Œå½“å·¨å¤§çš„æµé‡ç›´æ¥è¯·æ±‚åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Šæ²¡å¤šä¹…å°±å¯èƒ½é€ æˆæ¥å£ä¸å¯ç”¨ï¼Œä¸å¤„ç†çš„è¯ç”šè‡³ä¼šé€ æˆæ•´ä¸ªåº”ç”¨ä¸å¯ç”¨ã€‚ æ¯”å¦‚æœ€è¿‘å°±æœ‰ä¸ªè¿™æ ·çš„éœ€æ±‚ï¼Œæˆ‘ä½œä¸ºå®¢æˆ·ç«¯è¦å‘kafkaç”Ÿäº§æ•°æ®ï¼Œè€Œkafkaçš„æ¶ˆè´¹è€…åˆ™å†æºæºä¸æ–­çš„æ¶ˆè´¹æ•°æ®ï¼Œå¹¶å°†æ¶ˆè´¹çš„æ•°æ®å…¨éƒ¨è¯·æ±‚åˆ°webæœåŠ¡å™¨ï¼Œè™½è¯´åšäº†è´Ÿè½½(æœ‰4å°webæœåŠ¡å™¨)ä½†ä¸šåŠ¡æ•°æ®çš„é‡ä¹Ÿæ˜¯å·¨å¤§çš„ï¼Œæ¯ç§’é’Ÿå¯èƒ½æœ‰ä¸Šä¸‡æ¡æ•°æ®äº§ç”Ÿã€‚å¦‚æœç”Ÿäº§è€…ç›´æ¥ç”Ÿäº§æ•°æ®çš„è¯ææœ‰å¯èƒ½æŠŠwebæœåŠ¡å™¨æ‹–å®ã€‚ å¯¹æ­¤å°±å¿…é¡»è¦åšé™æµå¤„ç†ï¼Œæ¯ç§’é’Ÿç”Ÿäº§ä¸€å®šé™é¢çš„æ•°æ®åˆ°kafkaï¼Œè¿™æ ·å°±èƒ½æå¤§ç¨‹åº¦çš„ä¿è¯webçš„æ­£å¸¸è¿è½¬ã€‚ å…¶å®ä¸ç®¡å¤„ç†ä½•ç§åœºæ™¯ï¼Œæœ¬è´¨éƒ½æ˜¯é™ä½æµé‡ä¿è¯åº”ç”¨çš„é«˜å¯ç”¨ã€‚ å¸¸è§ç®—æ³•å¯¹äºé™æµå¸¸è§æœ‰ä¸¤ç§ç®—æ³•: æ¼æ¡¶ç®—æ³• ä»¤ç‰Œæ¡¶ç®—æ³• æ¼æ¡¶ç®—æ³•æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å°†æµé‡æ”¾å…¥æ¡¶ä¸­ï¼Œæ¼æ¡¶åŒæ—¶ä¹ŸæŒ‰ç…§ä¸€å®šçš„é€Ÿç‡æµå‡ºï¼Œå¦‚æœæµé‡è¿‡å¿«çš„è¯å°±ä¼šæº¢å‡º(æ¼æ¡¶å¹¶ä¸ä¼šæé«˜æµå‡ºé€Ÿç‡)ã€‚æº¢å‡ºçš„æµé‡åˆ™ç›´æ¥ä¸¢å¼ƒã€‚ å¦‚ä¸‹å›¾æ‰€ç¤º: è¿™ç§åšæ³•ç®€å•ç²—æš´ã€‚ æ¼æ¡¶ç®—æ³•è™½è¯´ç®€å•ï¼Œä½†å´ä¸èƒ½åº”å¯¹å®é™…åœºæ™¯ï¼Œæ¯”å¦‚çªç„¶æš´å¢çš„æµé‡ã€‚ è¿™æ—¶å°±éœ€è¦ç”¨åˆ°ä»¤ç‰Œæ¡¶ç®—æ³•: ä»¤ç‰Œæ¡¶ä¼šä»¥ä¸€ä¸ªæ’å®šçš„é€Ÿç‡å‘å›ºå®šå®¹é‡å¤§å°æ¡¶ä¸­æ”¾å…¥ä»¤ç‰Œï¼Œå½“æœ‰æµé‡æ¥æ—¶åˆ™å–èµ°ä¸€ä¸ªæˆ–å¤šä¸ªä»¤ç‰Œã€‚å½“æ¡¶ä¸­æ²¡æœ‰ä»¤ç‰Œåˆ™å°†å½“å‰è¯·æ±‚ä¸¢å¼ƒæˆ–é˜»å¡ã€‚ ç›¸æ¯”ä¹‹ä¸‹ä»¤ç‰Œæ¡¶å¯ä»¥åº”å¯¹ä¸€å®šçš„çªå‘æµé‡. RateLimiterå®ç°å¯¹äºä»¤ç‰Œæ¡¶çš„ä»£ç å®ç°ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨GuavaåŒ…ä¸­çš„RateLimiterã€‚ 12345678910111213141516171819202122232425@Overridepublic BaseResponse&lt;UserResVO&gt; getUserByFeignBatch(@RequestBody UserReqVO userReqVO) &#123; //è°ƒç”¨è¿œç¨‹æœåŠ¡ OrderNoReqVO vo = new OrderNoReqVO() ; vo.setReqNo(userReqVO.getReqNo()); RateLimiter limiter = RateLimiter.create(2.0) ; //æ‰¹é‡è°ƒç”¨ for (int i = 0 ;i&lt; 10 ; i++)&#123; double acquire = limiter.acquire(); logger.debug("è·å–ä»¤ç‰ŒæˆåŠŸ!,æ¶ˆè€—=" + acquire); BaseResponse&lt;OrderNoResVO&gt; orderNo = orderServiceClient.getOrderNo(vo); logger.debug("è¿œç¨‹è¿”å›:"+JSON.toJSONString(orderNo)); &#125; UserRes userRes = new UserRes() ; userRes.setUserId(123); userRes.setUserName("å¼ ä¸‰"); userRes.setReqNo(userReqVO.getReqNo()); userRes.setCode(StatusEnum.SUCCESS.getCode()); userRes.setMessage("æˆåŠŸ"); return userRes ;&#125; è¯¦è§æ­¤ã€‚ è°ƒç”¨ç»“æœå¦‚ä¸‹: ä»£ç å¯ä»¥çœ‹å‡ºä»¥æ¯ç§’å‘æ¡¶ä¸­æ”¾å…¥ä¸¤ä¸ªä»¤ç‰Œï¼Œè¯·æ±‚ä¸€æ¬¡æ¶ˆè€—ä¸€ä¸ªä»¤ç‰Œã€‚æ‰€ä»¥æ¯ç§’é’Ÿåªèƒ½å‘é€ä¸¤ä¸ªè¯·æ±‚ã€‚æŒ‰ç…§å›¾ä¸­çš„æ—¶é—´æ¥çœ‹ä¹Ÿç¡®å®å¦‚æ­¤(è¿”å›å€¼æ˜¯è·å–æ­¤ä»¤ç‰Œæ‰€æ¶ˆè€—çš„æ—¶é—´ï¼Œå·®ä¸å¤šä¹Ÿæ˜¯æ¯500msä¸€ä¸ª)ã€‚ ä½¿ç”¨RateLimiteræœ‰å‡ ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹: å…è®¸å…ˆæ¶ˆè´¹ï¼Œåä»˜æ¬¾ï¼Œæ„æ€å°±æ˜¯å®ƒå¯ä»¥æ¥ä¸€ä¸ªè¯·æ±‚çš„æ—¶å€™ä¸€æ¬¡æ€§å–èµ°å‡ ä¸ªæˆ–è€…æ˜¯å‰©ä¸‹æ‰€æœ‰çš„ä»¤ç‰Œç”šè‡³å¤šå–ï¼Œä½†æ˜¯åé¢çš„è¯·æ±‚å°±å¾—ä¸ºä¸Šä¸€æ¬¡è¯·æ±‚ä¹°å•ï¼Œå®ƒéœ€è¦ç­‰å¾…æ¡¶ä¸­çš„ä»¤ç‰Œè¡¥é½ä¹‹åæ‰èƒ½ç»§ç»­è·å–ä»¤ç‰Œã€‚ æ€»ç»“é’ˆå¯¹äºå•ä¸ªåº”ç”¨çš„é™æµ RateLimiter å¤Ÿç”¨äº†ï¼Œå¦‚æœæ˜¯åˆ†å¸ƒå¼ç¯å¢ƒå¯ä»¥å€ŸåŠ© Redis æ¥å®Œæˆã€‚ æœ€è¿‘ä¹Ÿæ€¼äº†ä¸€ä¸ªï¼Œå¯ä»¥å‚è€ƒã€‚ é¡¹ç›®ï¼šhttps://github.com/crossoverJie/springboot-cloud åšå®¢ï¼šhttp://crossoverjie.topã€‚]]></content>
      <categories>
        <category>sbc</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>SpringCloud</tag>
        <tag>RateLimiter</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[sbc(ä¸‰)è‡ªå®šä¹‰Starter-SpringBooté‡æ„å»é‡æ’ä»¶]]></title>
    <url>%2F2017%2F08%2F01%2Fsbc3%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¹‹å‰çœ‹è¿‡SSM(åå››) åŸºäºannotationçš„httpé˜²é‡æ’ä»¶çš„æœ‹å‹åº”è¯¥è®°å¾—æˆ‘åæ–‡è¯´è¿‡ä¹‹åè¦ç”¨SpringBootæ¥è¿›è¡Œé‡æ„ã€‚ è¿™æ¬¡é‡‡ç”¨è‡ªå®šä¹‰çš„starterçš„æ–¹å¼æ¥è¿›è¡Œé‡æ„ã€‚ å…³äºstarter(èµ·æ­¥ä¾èµ–)å…¶å®åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨SpringBootçš„æ—¶å€™å°±å·²ç»ç”¨åˆ°äº†ï¼Œæ¯”å¦‚å…¶ä¸­çš„: 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt; æˆ‘ä»¬åªéœ€è¦å¼•å…¥è¿™ä¸€ä¸ªä¾èµ–SpringBootå°±ä¼šæŠŠç›¸å…³çš„ä¾èµ–éƒ½åŠ å…¥è¿›æ¥ï¼Œè‡ªå·±ä¹Ÿä¸éœ€è¦å†å»æ‹…å¿ƒå„ä¸ªç‰ˆæœ¬ä¹‹é—´çš„å…¼å®¹é—®é¢˜(å…·ä½“ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬ç”±ä½¿ç”¨çš„spring-boot-starter-parentç‰ˆæœ¬å†³å®š)ï¼Œè¿™äº›SpringBootéƒ½å·²ç»å¸®æˆ‘ä»¬åšå¥½äº†ã€‚ Springè‡ªåŠ¨åŒ–é…ç½®å…ˆåŠ å…¥éœ€è¦çš„ä¸€äº›ä¾èµ–: 123456789101112131415161718192021222324252627282930&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!--aopç›¸å…³--&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!--redisç›¸å…³--&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-redis&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!--é…ç½®ç›¸å…³--&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt;&lt;!--é€šç”¨ä¾èµ–--&gt;&lt;dependency&gt; &lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;sbc-common&lt;/artifactId&gt; &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt; åˆ›å»ºäº†CheckReqConfé…ç½®ç±»ç”¨äºåœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨é…ç½®ã€‚å½“ç„¶å‰æè¿˜å¾—åœ¨resourcesç›®å½•ä¸‹åˆ›å»ºMETA-INF/spring.factoriesé…ç½®æ–‡ä»¶ç”¨äºæŒ‡å‘å½“å‰ç±»ï¼Œæ‰èƒ½åœ¨åº”ç”¨å¯åŠ¨æ—¶è¿›è¡Œè‡ªåŠ¨é…ç½®ã€‚ spring.factories: 12org.springframework.boot.autoconfigure.EnableAutoConfiguration=\com.crossoverJie.request.check.conf.CheckReqConf ä½¿ç”¨æ¡ä»¶åŒ–é…ç½®è¯•ç€è€ƒè™‘ä¸‹å¦‚ä¸‹æƒ…å†µ: å› ä¸ºè¯¥æ’ä»¶æ˜¯ä½¿ç”¨redisæ¥å­˜å‚¨è¯·æ±‚ä¿¡æ¯çš„ï¼Œå¤–éƒ¨å°±ä¾èµ–äº†redisã€‚å¦‚æœä½¿ç”¨äº†è¯¥æ’ä»¶çš„åº”ç”¨æ²¡æœ‰é…ç½®æˆ–è€…å¿˜äº†é…ç½®redisçš„ä¸€äº›ç›¸å…³è¿æ¥ï¼Œé‚£ä¹ˆåœ¨åº”ç”¨ä½¿ç”¨è¿‡ç¨‹ä¸­è‚¯å®šä¼šå‡ºç°å†™å…¥rediså¼‚å¸¸ã€‚ å¦‚æœå¼‚å¸¸æ²¡æœ‰æ§åˆ¶å¥½çš„è¯è¿˜æœ‰å¯èƒ½å½±å“é¡¹ç›®çš„æ­£å¸¸è¿è¡Œã€‚ é‚£ä¹ˆæ€ä¹ˆè§£å†³è¿™ä¸ªæƒ…å†µå‘¢ï¼Œå¯ä»¥ä½¿ç”¨Spring4.0æ–°å¢çš„æ¡ä»¶åŒ–é…ç½®æ¥è§£å†³ã€‚ è§£å†³æ€è·¯æ˜¯:å¯ä»¥ç®€å•çš„é€šè¿‡åˆ¤æ–­åº”ç”¨ä¸­æ˜¯å¦é…ç½®æœ‰spring.redis.hostredisè¿æ¥ï¼Œå¦‚æœæ²¡æœ‰æˆ‘ä»¬çš„è¿™ä¸ªé…ç½®å°±ä¼šè¢«å¿½ç•¥æ‰ã€‚ å®ç°ä»£ç : 1234567891011import org.springframework.context.annotation.ComponentScan;import org.springframework.context.annotation.Conditional;import org.springframework.context.annotation.Configuration;@Configuration@ComponentScan("com.crossoverJie.request.check.interceptor,com.crossoverJie.request.check.properties")//æ˜¯å¦æœ‰redisé…ç½®çš„æ ¡éªŒï¼Œå¦‚æœæ²¡æœ‰é…ç½®åˆ™ä¸ä¼šåŠ è½½æ”¹é…ç½®ï¼Œä¹Ÿå°±æ˜¯å½“å‰æ’ä»¶å¹¶ä¸ä¼šç”Ÿæ•ˆ@Conditional(CheckReqCondition.class)public class CheckReqConf &#123;&#125; å…·ä½“æ ¡éªŒçš„ä»£ç CheckReqCondition: 12345678910111213141516171819public class CheckReqCondition implements Condition &#123; private static Logger logger = LoggerFactory.getLogger(CheckReqCondition.class); @Override public boolean matches(ConditionContext context, AnnotatedTypeMetadata annotatedTypeMetadata) &#123; //å¦‚æœæ²¡æœ‰åŠ å…¥redisé…ç½®çš„å°±è¿”å›false String property = context.getEnvironment().getProperty("spring.redis.host"); if (StringUtils.isEmpty(property))&#123; logger.warn("Need to configure redis!"); return false ; &#125;else &#123; return true; &#125; &#125;&#125; åªéœ€è¦å®ç°org.springframework.context.annotation.Conditionå¹¶é‡å†™matches()æ–¹æ³•,å³å¯å®ç°ä¸ªäººé€»è¾‘ã€‚ å¯ä»¥åœ¨ä½¿ç”¨äº†è¯¥ä¾èµ–çš„é…ç½®æ–‡ä»¶ä¸­é…ç½®æˆ–è€…æ˜¯ä¸é…ç½®spring.redis.hostè¿™ä¸ªé…ç½®,æ¥çœ‹æˆ‘ä»¬çš„åˆ‡é¢ç±»(ReqNoDrcAspect)ä¸­53è¡Œçš„æ—¥å¿—æ˜¯å¦æœ‰æ‰“å°æ¥åˆ¤æ–­æ˜¯å¦ç”Ÿæ•ˆã€‚ è¿™æ ·åªæœ‰åœ¨å­˜åœ¨è¯¥keyçš„æƒ…å†µä¸‹æ‰ä¼šåº”ç”¨è¿™ä¸ªé…ç½®ã€‚ å½“ç„¶æœ€å¥½çš„åšæ³•æ˜¯ç›´æ¥å°è¯•è¯»ã€å†™redis,çœ‹æ˜¯å¦è¿æ¥ç•…é€šæ¥è¿›è¡Œåˆ¤æ–­ã€‚ AOPåˆ‡é¢æœ€æ ¸å¿ƒçš„å…¶å®å°±æ˜¯è¿™ä¸ªåˆ‡é¢ç±»ï¼Œé‡Œè¾¹ä¸»è¦é€»è¾‘å’Œä¹‹å‰æ˜¯ä¸€æ¨¡ä¸€æ ·çš„å°±ä¸åœ¨å¤šè¯´,åªæ˜¯è¿™é‡Œåº”ç”¨åˆ°äº†è‡ªå®šä¹‰é…ç½®ã€‚ åˆ‡é¢ç±»ReqNoDrcAspect: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172//åˆ‡é¢æ³¨è§£@Aspect//æ‰«æ@Component//å¼€å¯cglibä»£ç†@EnableAspectJAutoProxy(proxyTargetClass = true)public class ReqNoDrcAspect &#123; private static Logger logger = LoggerFactory.getLogger(ReqNoDrcAspect.class); @Autowired private CheckReqProperties properties ; private String prefixReq ; private long day ; @Autowired private RedisTemplate&lt;String, String&gt; redisTemplate; @PostConstruct public void init() throws Exception &#123; prefixReq = properties.getRedisKey() == null ? "reqNo" : properties.getRedisKey() ; day = properties.getRedisTimeout() == null ? 1L : properties.getRedisTimeout() ; logger.info("sbc-request-check init......"); logger.info(String.format("redis prefix is [%s],timeout is [%s]", prefixReq, day)); &#125; /** * åˆ‡é¢è¯¥æ³¨è§£ */ @Pointcut("@annotation(com.crossoverJie.request.check.anotation.CheckReqNo)") public void checkRepeat()&#123; &#125; @Before("checkRepeat()") public void before(JoinPoint joinPoint) throws Exception &#123; BaseRequest request = getBaseRequest(joinPoint); if(request != null)&#123; final String reqNo = request.getReqNo(); if(StringUtil.isEmpty(reqNo))&#123; throw new SBCException(StatusEnum.REPEAT_REQUEST); &#125;else&#123; try &#123; String tempReqNo = redisTemplate.opsForValue().get(prefixReq +reqNo); logger.debug("tempReqNo=" + tempReqNo); if((StringUtil.isEmpty(tempReqNo)))&#123; redisTemplate.opsForValue().set(prefixReq + reqNo, reqNo, day, TimeUnit.DAYS); &#125;else&#123; throw new SBCException("è¯·æ±‚å·é‡å¤,"+ prefixReq +"=" + reqNo); &#125; &#125; catch (RedisConnectionFailureException e)&#123; logger.error("redisæ“ä½œå¼‚å¸¸",e); throw new SBCException("need redisService") ; &#125; &#125; &#125; &#125; public static BaseRequest getBaseRequest(JoinPoint joinPoint) throws Exception &#123; BaseRequest returnRequest = null; Object[] arguments = joinPoint.getArgs(); if(arguments != null &amp;&amp; arguments.length &gt; 0)&#123; returnRequest = (BaseRequest) arguments[0]; &#125; return returnRequest; &#125;&#125; è¿™é‡Œæˆ‘ä»¬çš„å†™å…¥rediskeyçš„å‰ç¼€å’Œè¿‡æœŸæ—¶é—´æ”¹ä¸ºä»CheckReqPropertiesç±»ä¸­è¯»å–: 12345678910111213141516171819202122232425262728293031@Component//å®šä¹‰é…ç½®å‰ç¼€@ConfigurationProperties(prefix = "sbc.request.check")public class CheckReqProperties &#123; private String redisKey ;//å†™å…¥redisä¸­çš„å‰ç¼€ private Long redisTimeout ;//redisçš„è¿‡æœŸæ—¶é—´ é»˜è®¤æ˜¯å¤© public String getRedisKey() &#123; return redisKey; &#125; public void setRedisKey(String redisKey) &#123; this.redisKey = redisKey; &#125; public Long getRedisTimeout() &#123; return redisTimeout; &#125; public void setRedisTimeout(Long redisTimeout) &#123; this.redisTimeout = redisTimeout; &#125; @Override public String toString() &#123; return "CheckReqProperties&#123;" + "redisKey='" + redisKey + '\'' + ", redisTimeout=" + redisTimeout + '&#125;'; &#125;&#125; è¿™æ ·å¦‚æœæ˜¯éœ€è¦å¾ˆå¤šé…ç½®çš„æƒ…å†µä¸‹å°±å¯ä»¥å°†å†…å®¹å°è£…åˆ°è¯¥å¯¹è±¡ä¸­ï¼Œæ–¹ä¾¿ç»´æŠ¤å’Œè¯»å–ã€‚ ä½¿ç”¨çš„æ—¶å€™åªéœ€è¦åœ¨è‡ªå·±åº”ç”¨çš„application.propertiesä¸­åŠ å…¥ 123# å»é‡é…ç½®sbc.request.check.redis-key = reqsbc.request.check.redis-timeout= 2 åº”ç”¨æ’ä»¶ä½¿ç”¨æ–¹æ³•ä¹Ÿå’Œä¹‹å‰å·®ä¸å¤š(åœ¨sbc-orderåº”ç”¨)ï¼š åŠ å…¥ä¾èµ–ï¼š 123456&lt;!--é˜²é‡æ’ä»¶--&gt;&lt;dependency&gt; &lt;groupId&gt;com.crossoverJie.request.check&lt;/groupId&gt; &lt;artifactId&gt;request-check&lt;/artifactId&gt; &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt; åœ¨æ¥å£ä¸ŠåŠ ä¸Šæ³¨è§£: 12345678910111213141516171819202122@RestController@Api(value = "orderApi", description = "è®¢å•API", tags = &#123;"è®¢å•æœåŠ¡"&#125;)public class OrderController implements OrderService&#123; private final static Logger logger = LoggerFactory.getLogger(OrderController.class); @Override @CheckReqNo public BaseResponse&lt;OrderNoResVO&gt; getOrderNo(@RequestBody OrderNoReqVO orderNoReq) &#123; BaseResponse&lt;OrderNoResVO&gt; res = new BaseResponse(); res.setReqNo(orderNoReq.getReqNo()); if (null == orderNoReq.getAppId())&#123; throw new SBCException(StatusEnum.FAIL); &#125; OrderNoResVO orderNoRes = new OrderNoResVO() ; orderNoRes.setOrderId(DateUtil.getLongTime()); res.setCode(StatusEnum.SUCCESS.getCode()); res.setMessage(StatusEnum.SUCCESS.getMessage()); res.setDataBody(orderNoRes); return res ; &#125;&#125; ä½¿ç”¨æ•ˆæœå¦‚ä¸‹: æ€»ç»“æ³¨æ„ä¸€ç‚¹æ˜¯spring.factoriesçš„è·¯å¾„ä¸è¦æé”™äº†,ä¹‹å‰å°±æ˜¯å› ä¸ºè·¯å¾„å†™é”™äº†ï¼Œå¯¼è‡´è‡ªåŠ¨é…ç½®æ²¡æœ‰åŠ è½½ï¼ŒAOPä¹Ÿå°±æ²¡æœ‰ç”Ÿæ•ˆï¼Œæ’æŸ¥äº†å¥½ä¹…ã€‚ã€‚ é¡¹ç›®ï¼šhttps://github.com/crossoverJie/springboot-cloud åšå®¢ï¼šhttp://crossoverjie.topã€‚]]></content>
      <categories>
        <category>sbc</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>é‡æ„</tag>
        <tag>AOP</tag>
        <tag>SpringBoot</tag>
        <tag>SpringCloud</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[sbc(äºŒ)é«˜å¯ç”¨Eureka+å£°æ˜å¼æœåŠ¡è°ƒç”¨]]></title>
    <url>%2F2017%2F07%2F19%2Fsbc2%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ä¸Šä¸€ç¯‡ç®€å•å…¥é—¨äº†SpringBoot+SpringCloud æ„å»ºå¾®æœåŠ¡ã€‚ä½†åªèƒ½ç®—æ˜¯ä¸€ä¸ªdemoçº§åˆ«çš„åº”ç”¨ã€‚è¿™æ¬¡ä¼šæŒ‰ç…§å®é™…ç”Ÿäº§è¦æ±‚æ¥æ­å»ºè¿™å¥—æœåŠ¡ã€‚ Swaggeråº”ç”¨ä¸Šæ¬¡æåˆ°æˆ‘ä»¬è°ƒç”¨è‡ªå·±çš„httpæ¥å£çš„æ—¶å€™é‡‡ç”¨çš„æ˜¯PostManæ¥æ¨¡æ‹Ÿè¯·æ±‚ï¼Œè¿™ä¸ªåœ¨å¹³æ—¶è°ƒè¯•æ—¶è‡ªç„¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†å½“æˆ‘ä»¬éœ€è¦å’Œå‰ç«¯è”è°ƒå¼€å‘çš„æ—¶å€™æ•ˆç‡å°±æ¯”è¾ƒä½äº†ã€‚ é€šå¸¸æ¥è¯´ç°åœ¨å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸€èˆ¬éƒ½æ˜¯åç«¯æ¥å£å…ˆè¡Œã€‚ åç«¯å¤§å¤§ä»¬å…ˆæŠŠæ¥å£å®šä¹‰å¥½(å…¥å‚å’Œå‡ºå‚),å‰ç«¯å¤§å¤§ä»¬æ¥ç¡®å®šæ˜¯å¦æ»¡è¶³è¦æ±‚ï¼Œå¯ä»¥äº†ä¹‹ååç«¯æ‰å¼€å§‹ç€æ‰‹å†™å®ç°ï¼Œè¿™æ ·æ•´ä½“æ•ˆç‡è¦é«˜ä¸Šè®¸å¤šã€‚ ä½†ä¹Ÿä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜:åœ¨æ¥å£å®šä¹‰é˜¶æ®µé¢‘ç¹å˜æ›´æ¥å£å®šä¹‰è€Œæ²¡æœ‰ä¸€ä¸ªæ–‡æ¡£æˆ–ç±»ä¼¼çš„ä¸œè¥¿æ¥è®°å½•ï¼Œé‚£ä¹ˆåŒæ–¹çš„æ²Ÿé€šåŠ ä¸Šå‰ç«¯çš„è°ƒè¯•éƒ½æ˜¯æ¯”è¾ƒå›°éš¾çš„ã€‚ åŸºäºè¿™ä¸ªéœ€æ±‚ç½‘ä¸Šæœ‰å„ç§è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚é˜¿é‡Œçš„rapå°±æ˜¯ä¸€ä¸ªä¸é”™çš„ä¾‹å­ã€‚ ä½†æ˜¯springCouldä¸ºæˆ‘ä»¬åœ¨æä¾›äº†ä¸€ç§åœ¨å¼€å‘springCloudé¡¹ç›®ä¸‹æ›´æ–¹ä¾¿çš„å·¥å…·swaggerã€‚ å®é™…æ•ˆæœå¦‚ä¸‹: é…ç½®swaggerä»¥sbc-orderä¸ºä¾‹æˆ‘å°†é¡¹ç›®åˆ†ä¸ºäº†ä¸‰ä¸ªæ¨¡å—: 123456789â”œâ”€â”€ order // OrderæœåŠ¡å®ç° â”‚ â”œâ”€â”€ src/mainâ”œâ”€â”€ order-api // å¯¹å†…APIâ”‚ â”œâ”€â”€ src/mainâ”œâ”€â”€ order-client // å¯¹å¤–çš„clientAPIâ”‚ â”œâ”€â”€ src/mainâ”œâ”€â”€ .gitignore â”œâ”€â”€ LICENSE â”œâ”€â”€ README.md å› ä¸ºå®ç°éƒ½å†™åœ¨orderæ¨¡å—ä¸­ï¼Œæ‰€ä»¥åªéœ€è¦åœ¨è¯¥æ¨¡å—ä¸­é…ç½®å³å¯ã€‚ é¦–å…ˆéœ€è¦åŠ å…¥ä¾èµ–ï¼Œç”±äºæˆ‘åœ¨orderæ¨¡å—ä¸­ä¾èµ–äº†: 12345&lt;dependency&gt; &lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;order-api&lt;/artifactId&gt; &lt;version&gt;$&#123;target.version&#125;&lt;/version&gt;&lt;/dependency&gt; order-apiåˆä¾èµ–äº†ï¼š 12345678910&lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt; &lt;scope&gt;compile&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt; &lt;scope&gt;compile&lt;/scope&gt;&lt;/dependency&gt; æ¥ç€éœ€è¦é…ç½®ä¸€ä¸ªSwaggerConfig 12345678910111213141516171819202122232425262728@Configuration@EnableSwagger2/** æ˜¯å¦æ‰“å¼€swagger **/@ConditionalOnExpression(&quot;&apos;$&#123;swagger.enable&#125;&apos; == &apos;true&apos;&quot;)public class SwaggerConfig &#123; @Bean public Docket createRestApi() &#123; return new Docket(DocumentationType.SWAGGER_2) .apiInfo(apiInfo()) .select() .apis(RequestHandlerSelectors.basePackage(&quot;com.crossoverJie.sbcorder.controller&quot;)) .paths(PathSelectors.any()) .build(); &#125; private ApiInfo apiInfo() &#123; return new ApiInfoBuilder() .title(&quot;sbc order api&quot;) .description(&quot;sbc order api&quot;) .termsOfServiceUrl(&quot;http://crossoverJie.top&quot;) .contact(&quot;crossoverJie&quot;) .version(&quot;1.0.0&quot;) .build(); &#125; &#125; å…¶å®å°±æ˜¯é…ç½®swaggerçš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ã€‚ä¹‹åå¯åŠ¨é¡¹ç›®ï¼Œåœ¨åœ°å€æ è¾“å…¥http://ip:port/swagger-ui.html#/å³å¯è¿›å…¥ã€‚å¯ä»¥çœ‹åˆ°å¦‚ä¸Šå›¾æ‰€ç¤ºçš„æ¥å£åˆ—è¡¨,ç‚¹å‡»å¦‚ä¸‹å›¾æ‰€ç¤ºçš„å‚æ•°ä¾‹å­å³å¯è¿›è¡Œæ¥å£è°ƒç”¨ã€‚ è‡ªå®šä¹‰å¼€å…³Swagger swaggerçš„ä¾¿åˆ©èƒ½ç»™æˆ‘ä»¬å¸¦æ¥å¾ˆå¤šå¥½å¤„ï¼Œä½†ç¨æœ‰ä¸æ…ä¹Ÿå¯èƒ½å‡ºç°é—®é¢˜ã€‚ æ¯”å¦‚å¦‚æœåœ¨ç”Ÿäº§ç¯å¢ƒè¿˜èƒ½é€šè¿‡IPè®¿é—®swaggerçš„è¯é‚£åæœå¯æ˜¯ä¸å ªè®¾æƒ³çš„ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦çµæ´»æ§åˆ¶swaggerçš„å¼€å…³ã€‚ è¿™ç‚¹å¯ä»¥åˆ©ç”¨springçš„æ¡ä»¶åŒ–é…ç½®(æ¡ä»¶åŒ–é…ç½®å¯ä»¥é…ç½®å­˜åœ¨äºåº”ç”¨ä¸­,ä¸€æ—¦æ»¡è¶³ä¸€äº›ç‰¹å®šçš„æ¡ä»¶æ—¶å°±å–æ¶ˆè¿™äº›é…ç½®)æ¥å®ç°è¿™ä¸€åŠŸèƒ½: 1@ConditionalOnExpression("'$&#123;swagger.enable&#125;' == 'true'") è¯¥æ³¨è§£çš„æ„æ€æ˜¯ç»™å®šçš„SpELè¡¨è¾¾å¼è®¡ç®—ç»“æœä¸ºtrueæ—¶æ‰ä¼šåˆ›å»ºswaggerçš„beanã€‚ swagger.enableè¿™ä¸ªé…ç½®åˆ™æ˜¯é…ç½®åœ¨application.propertiesä¸­: 12# æ˜¯å¦æ‰“å¼€swaggerswagger.enable = true è¿™æ ·å½“æˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒæ—¶åªéœ€è¦å°†è¯¥é…ç½®æ”¹ä¸ºfalseå³å¯ã€‚ ps:æ›´å¤šspringæ¡ä»¶åŒ–é…ç½®: 123456789101112@ConditionalOnBean //é…ç½®äº†æŸä¸ªç‰¹å®šBean@ConditionalOnMissingBean //æ²¡æœ‰é…ç½®ç‰¹å®šçš„Bean@ConditionalOnClass //Classpathé‡Œæœ‰æŒ‡å®šçš„ç±»@ConditionalOnMissingClass //Classpathé‡Œç¼ºå°‘æŒ‡å®šçš„ç±»@ConditionalOnExpression //ç»™å®šçš„Spring Expression Language(SpEL)è¡¨è¾¾å¼è®¡ç®—ç»“æœä¸ºtrue@ConditionalOnJava //Javaçš„ç‰ˆæœ¬åŒ¹é…ç‰¹å®šå€¼æˆ–è€…ä¸€ä¸ªèŒƒå›´å€¼@ConditionalOnJndi //å‚æ•°ä¸­ç»™å®šçš„JNDIä½ç½®å¿…é¡»å­˜åœ¨ä¸€ä¸ªï¼Œå¦‚æœæ²¡æœ‰ç»™å‚æ•°ï¼Œåˆ™è¦æœ‰JNDI InitialContext@ConditionalOnProperty //æŒ‡å®šçš„é…ç½®å±æ€§è¦æœ‰ä¸€ä¸ªæ˜ç¡®çš„å€¼@ConditionalOnResource //Classpathé‡Œæœ‰æŒ‡å®šçš„èµ„æº@ConditionalOnWebApplication //è¿™æ˜¯ä¸€ä¸ªWebåº”ç”¨ç¨‹åº@ConditionalOnNotWebApplication //è¿™ä¸æ˜¯ä¸€ä¸ªWebåº”ç”¨ç¨‹åº(å‚è€ƒSpringBootå®æˆ˜) é«˜å¯ç”¨Eurekaåœ¨ä¸Šä¸€ç¯‡ä¸­æ˜¯ç”¨Eurekaæ¥åšäº†æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œæ‰€æœ‰çš„ç”Ÿäº§è€…éƒ½å¾€å®ƒæ³¨å†ŒæœåŠ¡ï¼Œæ¶ˆè´¹è€…åˆé€šè¿‡å®ƒæ¥è·å–æœåŠ¡ã€‚ ä½†æ˜¯ä¹‹å‰è®²åˆ°çš„éƒ½æ˜¯å•èŠ‚ç‚¹ï¼Œè¿™åœ¨ç”Ÿäº§ç¯å¢ƒé£é™©å·¨å¤§ï¼Œæˆ‘ä»¬å¿…é¡»åšåˆ°æ³¨å†Œä¸­å¿ƒçš„é«˜å¯ç”¨ï¼Œæ­å»ºEurekaé›†ç¾¤ã€‚ è¿™é‡Œç®€å•èµ·è§å°±æ­å»ºä¸¤ä¸ªEureka,æ€è·¯åˆ™æ˜¯è¿™ä¸¤ä¸ªEurekaéƒ½æŠŠè‡ªå·±å½“æˆåº”ç”¨å‘å¯¹æ–¹æ³¨å†Œï¼Œè¿™æ ·å°±å¯ä»¥æ„æˆä¸€ä¸ªé«˜å¯ç”¨çš„æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚ åœ¨å®é™…ç”Ÿäº§ç¯èŠ‚ä¸­ä¼šæ˜¯æ¯ä¸ªæ³¨å†Œä¸­å¿ƒä¸€å°æœåŠ¡å™¨ï¼Œä¸ºäº†æ¼”ç¤ºèµ·è§ï¼Œæˆ‘å°±åœ¨æœ¬åœ°å¯åŠ¨ä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œä½†æ˜¯ç«¯å£ä¸ä¸€æ ·ã€‚ é¦–å…ˆéœ€è¦åœ¨æœ¬åœ°é…ç½®ä¸€ä¸ªhost: 1127.0.0.1 node1 node2 è¿™æ ·ä¸è®ºæ˜¯è®¿é—®node1è¿˜æ˜¯node2éƒ½å¯ä»¥åœ¨æœ¬æœºè°ƒç”¨çš„åˆ°(å½“ç„¶ä¸é…ç½®hostä¹Ÿå¯ä»¥ï¼Œåªæ˜¯éœ€è¦é€šè¿‡IPæ¥è®¿é—®ï¼Œè¿™æ ·çœ‹èµ·æ¥ä¸æ˜¯é‚£ä¹ˆæ˜æ˜¾)ã€‚ å¹¶ç»™sbc-serviceæ–°å¢äº†ä¸¤ä¸ªé…ç½®æ–‡ä»¶: application-node1.properties: 12345678910spring.application.name=sbc-serviceserver.port=8888eureka.instance.hostname=node1## ä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±#eureka.client.register-with-eureka=false### ä¸éœ€è¦æ£€ç´¢æœåŠ¡#eureka.client.fetch-registry=falseeureka.client.serviceUrl.defaultZone=http://node2:9999/eureka/ application-node2.properties: 12345678910spring.application.name=sbc-serviceserver.port=9999eureka.instance.hostname=node2## ä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±#eureka.client.register-with-eureka=false### ä¸éœ€è¦æ£€ç´¢æœåŠ¡#eureka.client.fetch-registry=falseeureka.client.serviceUrl.defaultZone=http://node1:8888/eureka/ å…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯: 12eureka.client.serviceUrl.defaultZone=http://node2:9999/eureka/eureka.client.serviceUrl.defaultZone=http://node1:8888/eureka/ ä¸¤ä¸ªåº”ç”¨äº’ç›¸æ³¨å†Œã€‚ å¯åŠ¨çš„æ—¶å€™æˆ‘ä»¬æŒ‰ç…§:java -jar sbc-service-1.0.0-SNAPSHOT.jar --spring.profiles.active=node1å¯åŠ¨ï¼Œå°±ä¼šæŒ‰ç…§ä¼ å…¥çš„node1æˆ–è€…æ˜¯node2å»è¯»å–application-node1.properties,application-node2.propertiesè¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶(é…ç½®æ–‡ä»¶å¿…é¡»æŒ‰ç…§application-{name}.propertiesçš„æ–¹å¼å‘½å)ã€‚ åˆ†åˆ«å¯åŠ¨ä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒå¯ä»¥çœ‹åˆ°ä»¥ä¸‹: å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒä»¥åŠäº’ç›¸æ³¨å†Œäº†ã€‚åœ¨æœåŠ¡æ³¨å†Œçš„æ—¶å€™åªéœ€è¦å°†ä¸¤ä¸ªåœ°å€éƒ½åŠ ä¸Šå³å¯:eureka.client.serviceUrl.defaultZone=http://node1:8888/eureka/,http://node2:9999/eureka/ åœ¨æœåŠ¡è°ƒç”¨çš„æ—¶å€™å¯ä»¥å°è¯•å…³é—­å…¶ä¸­ä¸€ä¸ªï¼Œæ­£å¸¸æƒ…å†µä¸‹ä¾ç„¶æ˜¯å¯ä»¥è°ƒç”¨åˆ°æœåŠ¡çš„ã€‚ Feignå£°æ˜å¼è°ƒç”¨æ¥ä¸‹æ¥è°ˆè°ˆæœåŠ¡è°ƒç”¨ï¼Œä¸Šæ¬¡æåˆ°å¯ä»¥ç”¨ribbonæ¥è¿›è¡ŒæœåŠ¡è°ƒç”¨ï¼Œä½†æ˜¯æ˜æ˜¾å¾ˆä¸æ–¹ä¾¿ï¼Œä¸å¦‚åƒä¹‹å‰rpcè°ƒç”¨é‚£æ ·ç®€å•ç›´æ¥ã€‚ ä¸ºæ­¤è¿™æ¬¡ä½¿ç”¨Feignæ¥è¿›è¡Œå£°æ˜å¼è°ƒç”¨ï¼Œå°±åƒè°ƒç”¨ä¸€ä¸ªæ™®é€šæ–¹æ³•é‚£æ ·ç®€å•ã€‚ order-clientç‰‡å¤´è¯´åˆ°æˆ‘å°†åº”ç”¨åˆ†æˆäº†ä¸‰ä¸ªæ¨¡å—orderã€order-apiã€order-clientï¼Œå…¶ä¸­çš„clientæ¨¡å—å°±æ˜¯å…³é”®ã€‚ æ¥çœ‹çœ‹å…¶ä¸­çš„å†…å®¹,åªæœ‰ä¸€ä¸ªæ¥å£: 12345678910@RequestMapping(value="/orderService")@FeignClient(name="sbc-order")@RibbonClientpublic interface OrderServiceClient extends OrderService&#123; @ApiOperation("è·å–è®¢å•å·") @RequestMapping(value = "/getOrderNo", method = RequestMethod.POST) BaseResponse&lt;OrderNoResVO&gt; getOrderNo(@RequestBody OrderNoReqVO orderNoReq) ;&#125; @FeignClientè¿™ä¸ªæ³¨è§£è¦æ³¨æ„ä¸‹ï¼Œå…¶ä¸­çš„nameçš„æ˜¯è‡ªå·±åº”ç”¨çš„åº”ç”¨åç§°ï¼Œåœ¨application.propertiesä¸­çš„spring.application.nameé…ç½®ã€‚ å…¶ä¸­ç»§æ‰¿äº†ä¸€ä¸ªOrderServiceåœ¨order-apiæ¨¡å—ä¸­ï¼Œæ¥çœ‹çœ‹order-apiä¸­çš„å†…å®¹ã€‚ order-apiå…¶ä¸­ä¹Ÿåªæœ‰ä¸€ä¸ªæ¥å£: 12345678910@RestController@Api("è®¢å•æœåŠ¡API")@RequestMapping(value = "/orderService")@Validatedpublic interface OrderService &#123; @ApiOperation("è·å–è®¢å•å·") @RequestMapping(value = "/getOrderNo", method = RequestMethod.POST) BaseResponse&lt;OrderNoResVO&gt; getOrderNo(@RequestBody OrderNoReqVO orderNoReq) ;&#125; è¿™ä¸ªæ¥å£æœ‰ä¸¤ä¸ªç›®çš„ã€‚ ç»™çœŸæ­£çš„controlleræ¥è¿›è¡Œå®ç°ã€‚ ç»™clientæ¥å£è¿›è¡Œç»§æ‰¿ã€‚ ç±»å…³ç³»å¦‚ä¸‹: æ³¨è§£è¿™äº›éƒ½æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œä¸€çœ‹å°±æ‡‚ã€‚ orderorderåˆ™æ˜¯å…·ä½“æ¥å£å®ç°çš„æ¨¡å—ï¼Œå°±å’Œå¹³æ—¶å†™controllerä¸€æ ·ã€‚æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨clientè¿›è¡Œå£°æ˜å¼è°ƒç”¨: è¿™æ¬¡çœ‹çœ‹sbc-userè¿™ä¸ªé¡¹ç›®ï¼Œåœ¨é‡Œè¾¹è°ƒç”¨äº†sbc-orderçš„æœåŠ¡ã€‚å…¶ä¸­çš„useræ¨¡å—ä¾èµ–äº†order-client: 1234&lt;dependency&gt; &lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;order-client&lt;/artifactId&gt;&lt;/dependency&gt; å…·ä½“è°ƒç”¨: 12345678910111213141516171819202122@Autowiredprivate OrderServiceClient orderServiceClient ;@Overridepublic BaseResponse&lt;UserResVO&gt; getUserByFeign(@RequestBody UserReqVO userReq) &#123; //è°ƒç”¨è¿œç¨‹æœåŠ¡ OrderNoReqVO vo = new OrderNoReqVO() ; vo.setReqNo(userReq.getReqNo()); BaseResponse&lt;OrderNoResVO&gt; orderNo = orderServiceClient.getOrderNo(vo); logger.info("è¿œç¨‹è¿”å›:"+JSON.toJSONString(orderNo)); UserRes userRes = new UserRes() ; userRes.setUserId(123); userRes.setUserName("å¼ ä¸‰"); userRes.setReqNo(userReq.getReqNo()); userRes.setCode(StatusEnum.SUCCESS.getCode()); userRes.setMessage("æˆåŠŸ"); return userRes ;&#125; å¯ä»¥çœ‹åˆ°åªéœ€è¦å°†order-clientåŒ…ä¸­çš„OrderæœåŠ¡æ³¨å…¥è¿›æ¥å³å¯ã€‚ åœ¨sbc-clientçš„swaggerä¸­è¿›è¡Œè°ƒç”¨: ç”±äºæˆ‘å¹¶æ²¡ä¼ appIdæ‰€ä»¥orderæœåŠ¡è¿”å›çš„é”™è¯¯ã€‚ æ€»ç»“ å½“ä¸€ä¸ªåº”ç”¨éœ€è¦å¯¹å¤–æš´éœ²æ¥å£æ—¶ç€éœ€è¦æŒ‰ç…§ä»¥ä¸Šæ–¹å¼æä¾›ä¸€ä¸ªclientåŒ…æ›´æ¶ˆè´¹è€…ä½¿ç”¨ã€‚ å…¶å®åº”ç”¨æœ¬èº«ä¹Ÿæ˜¯éœ€è¦åšé«˜å¯ç”¨çš„ï¼Œå’ŒEurekaé«˜å¯ç”¨ä¸€æ ·ï¼Œå†ä¸åŒçš„æœåŠ¡å™¨ä¸Šå†å¯ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å¹¶æ³¨å†Œåˆ°Eurekaé›†ç¾¤ä¸­å³å¯ã€‚ åç»­è¿˜ä¼šç»§ç»­è°ˆåˆ°zuulç½‘å…³ï¼Œå®¹é”™ï¼Œæ–­è·¯å™¨ç­‰å†…å®¹ï¼Œæ¬¢è¿æ‹ç –è®¨è®ºã€‚ é¡¹ç›®ï¼šhttps://github.com/crossoverJie/springboot-cloud åšå®¢ï¼šhttp://crossoverjie.topã€‚]]></content>
      <categories>
        <category>sbc</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>SpringCloud</tag>
        <tag>swagger</tag>
        <tag>Eureka</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(åäº”) ä¹è§‚é”ä¸æ‚²è§‚é”çš„å®é™…åº”ç”¨]]></title>
    <url>%2F2017%2F07%2F09%2FSSM15%2F</url>
    <content type="text"><![CDATA[å‰è¨€éšç€äº’è”ç½‘çš„å…´èµ·ï¼Œç°åœ¨ä¸‰é«˜(é«˜å¯ç”¨ã€é«˜æ€§èƒ½ã€é«˜å¹¶å‘)é¡¹ç›®æ˜¯è¶Šæ¥è¶Šæµè¡Œã€‚ æœ¬æ¬¡æ¥è°ˆè°ˆé«˜å¹¶å‘ã€‚é¦–å…ˆå‡è®¾ä¸€ä¸ªä¸šåŠ¡åœºæ™¯ï¼šæ•°æ®åº“ä¸­æœ‰ä¸€æ¡æ•°æ®ï¼Œéœ€è¦è·å–åˆ°å½“å‰çš„å€¼ï¼Œåœ¨å½“å‰å€¼çš„åŸºç¡€ä¸Š+10ï¼Œç„¶åå†æ›´æ–°å›å»ã€‚å¦‚æœæ­¤æ—¶æœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å¹¶å‘å¤„ç†ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹æ‹¿åˆ°æ•°æ®æ˜¯10ï¼Œ+10=20æ›´æ–°å›å»ã€‚ç¬¬äºŒä¸ªçº¿ç¨‹åŸæœ¬æ˜¯è¦åœ¨ç¬¬ä¸€ä¸ªçº¿ç¨‹çš„åŸºç¡€ä¸Šå†+20=40,ç»“æœç”±äºå¹¶å‘è®¿é—®å–åˆ°æ›´æ–°å‰çš„æ•°æ®ä¸º10ï¼Œ+20=30ã€‚ è¿™å°±æ˜¯å…¸å‹çš„å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¯¼è‡´æ•°æ®ä¸æ­£ç¡®ã€‚æ¥çœ‹ä»¥ä¸‹çš„ä¾‹å­ï¼š å¹¶å‘æ‰€å¸¦æ¥çš„é—®é¢˜å’Œä¸Šæ–‡æåˆ°çš„ç±»ä¼¼ï¼Œè¿™é‡Œæœ‰ä¸€å¼ priceè¡¨ï¼Œè¡¨ç»“æ„å¦‚ä¸‹ï¼š 1234567CREATE TABLE `price` ( `id` int(11) NOT NULL AUTO_INCREMENT COMMENT &apos;ä¸»é”®&apos;, `total` decimal(12,2) DEFAULT &apos;0.00&apos; COMMENT &apos;æ€»å€¼&apos;, `front` decimal(12,2) DEFAULT &apos;0.00&apos; COMMENT &apos;æ¶ˆè´¹å‰&apos;, `end` decimal(12,2) DEFAULT &apos;0.00&apos; COMMENT &apos;æ¶ˆè´¹å&apos;, PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=1268 DEFAULT CHARSET=utf8 æˆ‘è¿™é‡Œå†™äº†ä¸€ä¸ªå•æµ‹ï¼šå°±ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œå¾ªç¯100æ¬¡ï¼Œæ¯æ¬¡æŠŠfrontçš„å€¼å‡å»10ï¼Œå†å†™å…¥ä¸€æ¬¡æµæ°´è®°å½•ï¼Œæ­£å¸¸æƒ…å†µæ˜¯å†™å…¥çš„æ¯æ¡è®°å½•éƒ½ä¼šæ¯æ¬¡å‡å»10ã€‚ 12345678910111213141516171819/** * å•çº¿ç¨‹æ¶ˆè´¹ */@Testpublic void singleCounsumerTest1()&#123; for (int i=0 ;i&lt;100 ;i++)&#123; Price price = priceMapper.selectByPrimaryKey(1); int ron = 10 ; price.setFront(price.getFront().subtract(new BigDecimal(ron))); price.setEnd(price.getEnd().add(new BigDecimal(ron))); price.setTotal(price.getFront().add(price.getEnd())); priceMapper.updateByPrimaryKey(price) ; price.setId(null); priceMapper.insertSelective(price) ; &#125;&#125; æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ç¡®å®æ˜¯æ¯æ¬¡éƒ½é€’å‡10ã€‚ ä½†æ˜¯å¦‚æœæ˜¯å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ä¼šæ˜¯å¦‚ä½•å‘¢ï¼š æˆ‘è¿™é‡Œæ–°å»ºäº†ä¸€ä¸ªPriceController 1234567891011121314151617181920212223242526272829303132333435363738394041424344 /** * çº¿ç¨‹æ±  æ— é” * @param redisContentReq * @return */@RequestMapping(value = "/threadPrice",method = RequestMethod.POST)@ResponseBodypublic BaseResponse&lt;NULLBody&gt; threadPrice(@RequestBody RedisContentReq redisContentReq)&#123; BaseResponse&lt;NULLBody&gt; response = new BaseResponse&lt;NULLBody&gt;() ; try &#123; for (int i=0 ;i&lt;10 ;i++)&#123; Thread t = new Thread(new Runnable() &#123; @Override public void run() &#123; Price price = priceMapper.selectByPrimaryKey(1); int ron = 10 ; price.setFront(price.getFront().subtract(new BigDecimal(ron))); price.setEnd(price.getEnd().add(new BigDecimal(ron))); priceMapper.updateByPrimaryKey(price) ; price.setId(null); priceMapper.insertSelective(price) ; &#125; &#125;); config.submit(t); &#125; response.setReqNo(redisContentReq.getReqNo()); response.setCode(StatusEnum.SUCCESS.getCode()); response.setMessage(StatusEnum.SUCCESS.getMessage()); &#125;catch (Exception e)&#123; logger.error("system error",e); response.setReqNo(response.getReqNo()); response.setCode(StatusEnum.FAIL.getCode()); response.setMessage(StatusEnum.FAIL.getMessage()); &#125; return response ;&#125; å…¶ä¸­ä¸ºäº†èŠ‚çœèµ„æºä½¿ç”¨äº†ä¸€ä¸ªçº¿ç¨‹æ± : 1234567891011121314151617@Componentpublic class ThreadPoolConfig &#123; private static final int MAX_SIZE = 10 ; private static final int CORE_SIZE = 5; private static final int SECOND = 1000; private ThreadPoolExecutor executor ; public ThreadPoolConfig()&#123; executor = new ThreadPoolExecutor(CORE_SIZE,MAX_SIZE,SECOND, TimeUnit.MICROSECONDS,new LinkedBlockingQueue&lt;Runnable&gt;()) ; &#125; public void submit(Thread thread)&#123; executor.submit(thread) ; &#125;&#125; å…³äºçº¿ç¨‹æ± çš„ä½¿ç”¨ä»Šåä¼šä»”ç»†æ¢è®¨ã€‚è¿™é‡Œå°±ç®€å•ç†è§£ä¸ºæœ‰10ä¸ªçº¿ç¨‹å¹¶å‘å»å¤„ç†ä¸Šé¢å•çº¿ç¨‹çš„é€»è¾‘ï¼Œæ¥çœ‹çœ‹ç»“æœæ€ä¹ˆæ ·ï¼š ä¼šçœ‹åˆ°æ˜æ˜¾çš„æ•°æ®é”™è¯¯ï¼Œå¯¼è‡´é”™è¯¯çš„åŸå› è‡ªç„¶å°±æ˜¯æœ‰çº¿ç¨‹è¯»å–åˆ°äº†ä¸­é—´çŠ¶æ€è¿›è¡Œäº†é”™è¯¯çš„æ›´æ–°ã€‚ è¿›è€Œæœ‰äº†ä»¥ä¸‹ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼šæ‚²è§‚é”å’Œä¹è§‚é”ã€‚ æ‚²è§‚é”ç®€å•ç†è§£ä¸‹æ‚²è§‚é”ï¼šå½“ä¸€ä¸ªäº‹åŠ¡é”å®šäº†ä¸€äº›æ•°æ®ä¹‹åï¼Œåªæœ‰å½“å½“å‰é”æäº¤äº†äº‹åŠ¡ï¼Œé‡Šæ”¾äº†é”ï¼Œå…¶ä»–äº‹åŠ¡æ‰èƒ½è·å¾—é”å¹¶æ‰§è¡Œæ“ä½œã€‚ ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼šé¦–å…ˆè¦å…³é—­MySQLçš„è‡ªåŠ¨æäº¤ï¼šset autocommit = 0; 123456bigen --å¼€å¯äº‹åŠ¡select id, total, front, end from price where id=1 for update insert into price values(?,?,?,?,?)commit --æäº¤äº‹åŠ¡ è¿™é‡Œä½¿ç”¨select for updateçš„æ–¹å¼åˆ©ç”¨æ•°æ®åº“å¼€å¯äº†æ‚²è§‚é”ï¼Œé”å®šäº†id=1çš„è¿™æ¡æ•°æ®(æ³¨æ„:è¿™é‡Œé™¤éæ˜¯ä½¿ç”¨äº†ç´¢å¼•ä¼šå¯ç”¨è¡Œçº§é”ï¼Œä¸ç„¶æ˜¯ä¼šä½¿ç”¨è¡¨é”ï¼Œå°†æ•´å¼ è¡¨éƒ½é”ä½ã€‚)ã€‚ä¹‹åä½¿ç”¨commitæäº¤äº‹åŠ¡å¹¶é‡Šæ”¾é”ï¼Œè¿™æ ·ä¸‹ä¸€ä¸ªçº¿ç¨‹è¿‡æ¥æ‹¿åˆ°çš„å°±æ˜¯æ­£ç¡®çš„æ•°æ®ã€‚ æ‚²è§‚é”ä¸€èˆ¬æ˜¯ç”¨äºå¹¶å‘ä¸æ˜¯å¾ˆé«˜ï¼Œå¹¶ä¸”ä¸å…è®¸è„è¯»ç­‰æƒ…å†µã€‚ä½†æ˜¯å¯¹æ•°æ®åº“èµ„æºæ¶ˆè€—è¾ƒå¤§ã€‚ ä¹è§‚é”é‚£ä¹ˆæœ‰æ²¡æœ‰æ€§èƒ½å¥½ï¼Œæ”¯æŒçš„å¹¶å‘ä¹Ÿæ›´å¤šçš„æ–¹å¼å‘¢ï¼Ÿ é‚£å°±æ˜¯ä¹è§‚é”ã€‚ ä¹è§‚é”æ˜¯é¦–å…ˆå‡è®¾æ•°æ®å†²çªå¾ˆå°‘ï¼Œåªæœ‰åœ¨æ•°æ®æäº¤ä¿®æ”¹çš„æ—¶å€™æ‰è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœå†²çªäº†åˆ™ä¸ä¼šè¿›è¡Œæ›´æ–°ã€‚ é€šå¸¸çš„å®ç°æ–¹å¼å¢åŠ ä¸€ä¸ªversionå­—æ®µï¼Œä¸ºæ¯ä¸€æ¡æ•°æ®åŠ ä¸Šç‰ˆæœ¬ã€‚æ¯æ¬¡æ›´æ–°çš„æ—¶å€™version+1ï¼Œå¹¶ä¸”æ›´æ–°æ—¶å€™å¸¦ä¸Šç‰ˆæœ¬å·ã€‚å®ç°æ–¹å¼å¦‚ä¸‹ï¼š æ–°å»ºäº†ä¸€å¼ price_versionè¡¨ï¼š 12345678CREATE TABLE `price_version` ( `id` int(11) NOT NULL AUTO_INCREMENT COMMENT &apos;ä¸»é”®&apos;, `total` decimal(12,2) DEFAULT &apos;0.00&apos; COMMENT &apos;æ€»å€¼&apos;, `front` decimal(12,2) DEFAULT &apos;0.00&apos; COMMENT &apos;æ¶ˆè´¹å‰&apos;, `end` decimal(12,2) DEFAULT &apos;0.00&apos; COMMENT &apos;æ¶ˆè´¹å&apos;, `version` int(11) DEFAULT &apos;0&apos; COMMENT &apos;å¹¶å‘ç‰ˆæœ¬æ§åˆ¶&apos;, PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=1268 DEFAULT CHARSET=utf8 æ›´æ–°æ•°æ®çš„SQLï¼š 1234567&lt;update id="updateByVersion" parameterType="com.crossoverJie.pojo.PriceVersion"&gt; UPDATE price_version SET front = #&#123;front,jdbcType=DECIMAL&#125;, version= version + 1 WHERE id = #&#123;id,jdbcType=INTEGER&#125; AND version = #&#123;version,jdbcType=INTEGER&#125; &lt;/update&gt; è°ƒç”¨æ–¹å¼ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647/** * çº¿ç¨‹æ± ï¼Œä¹è§‚é” * @param redisContentReq * @return */@RequestMapping(value = "/threadPriceVersion",method = RequestMethod.POST)@ResponseBodypublic BaseResponse&lt;NULLBody&gt; threadPriceVersion(@RequestBody RedisContentReq redisContentReq)&#123; BaseResponse&lt;NULLBody&gt; response = new BaseResponse&lt;NULLBody&gt;() ; try &#123; for (int i=0 ;i&lt;3 ;i++)&#123; Thread t = new Thread(new Runnable() &#123; @Override public void run() &#123; PriceVersion priceVersion = priceVersionMapper.selectByPrimaryKey(1); int ron = new Random().nextInt(20); logger.info("æœ¬æ¬¡æ¶ˆè´¹="+ron); priceVersion.setFront(new BigDecimal(ron)); int count = priceVersionMapper.updateByVersion(priceVersion); if (count == 0)&#123; logger.error("æ›´æ–°å¤±è´¥"); &#125;else &#123; logger.info("æ›´æ–°æˆåŠŸ"); &#125; &#125; &#125;); config.submit(t); &#125; response.setReqNo(redisContentReq.getReqNo()); response.setCode(StatusEnum.SUCCESS.getCode()); response.setMessage(StatusEnum.SUCCESS.getMessage()); &#125;catch (Exception e)&#123; logger.error("system error",e); response.setReqNo(response.getReqNo()); response.setCode(StatusEnum.FAIL.getCode()); response.setMessage(StatusEnum.FAIL.getMessage()); &#125; return response ;&#125; å¤„ç†é€»è¾‘ï¼šå¼€äº†ä¸‰ä¸ªçº¿ç¨‹ç”Ÿæˆäº†20ä»¥å†…çš„éšæœºæ•°æ›´æ–°åˆ°frontå­—æ®µã€‚ å½“è°ƒç”¨è¯¥æ¥å£æ—¶æ—¥å¿—å¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°çº¿ç¨‹1ã€4ã€5åˆ†åˆ«ç”Ÿæˆäº†15ï¼Œ2ï¼Œ11ä¸‰ä¸ªéšæœºæ•°ã€‚æœ€åçº¿ç¨‹4ã€5éƒ½æ›´æ–°å¤±è´¥äº†ï¼Œåªæœ‰çº¿ç¨‹1æ›´æ–°æˆåŠŸäº†ã€‚ æŸ¥çœ‹æ•°æ®åº“ï¼š å‘ç°ä¹Ÿç¡®å®æ˜¯æ›´æ–°çš„15ã€‚ ä¹è§‚é”åœ¨å®é™…åº”ç”¨ç›¸å¯¹è¾ƒå¤šï¼Œå®ƒå¯ä»¥æä¾›æ›´å¥½çš„å¹¶å‘è®¿é—®ï¼Œå¹¶ä¸”æ•°æ®åº“å¼€é”€è¾ƒå°‘ï¼Œä½†æ˜¯æœ‰å¯èƒ½å­˜åœ¨è„è¯»çš„æƒ…å†µã€‚ æ€»ç»“ä»¥ä¸Šä¸¤ç§å„æœ‰ä¼˜åŠ£ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯æ¥åˆ¤æ–­å…·ä½“ä½¿ç”¨å“ªç§æ–¹å¼æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢ï¼šhttp://crossoverjie.topã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>lock</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[sbc(ä¸€)SpringBoot+SpringCloudåˆæ¢]]></title>
    <url>%2F2017%2F06%2F15%2Fsbc1%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æœ‰çœ‹è¿‡æˆ‘ä¹‹å‰çš„SSMç³»åˆ—çš„æœ‹å‹åº”è¯¥æœ‰ä¸€ç‚¹å°è±¡æ˜¯éå¸¸æ·±åˆ»çš„ã€‚ é‚£å°±æ˜¯éœ€è¦é…ç½®çš„é…ç½®æ–‡ä»¶éå¸¸å¤šï¼Œä»€ä¹ˆSpringã€mybatisã€redisã€mqä¹‹ç±»çš„é…ç½®æ–‡ä»¶éå¸¸å¤šï¼Œå¹¶ä¸”è¿˜å­˜åœ¨å„ç§ç‰ˆæœ¬ï¼Œç”šè‡³æœ‰äº›ç‰ˆæœ¬è¿˜äº’ä¸å…¼å®¹ã€‚å…¶ä¸­æœ‰å¾ˆå¤šå¯èƒ½å°±æ˜¯åˆšå¼€å§‹æ•´åˆçš„æ—¶å€™éœ€è¦é…ç½®ï¼Œä¹‹åå‹æ ¹å°±ä¸ä¼šå†åŠ¨äº†ã€‚ é‰´äºæ­¤ï¼ŒSpringåˆæ¨å‡ºäº†åˆä¸€ç¥å™¨SpringBoot. å®ƒå¯ä»¥è®©æˆ‘ä»¬æ›´åŠ å¿«é€Ÿçš„å¼€å‘Springåº”ç”¨ï¼Œç”šè‡³åšåˆ°äº†å¼€ç®±å³ç”¨ã€‚ç”±äºåœ¨å®é™…å¼€å‘ä¸­æˆ‘ä»¬ä½¿ç”¨SpringBoot+SpringCloudè¿›è¡Œäº†ä¸€æ®µæ—¶é—´çš„æŒç»­äº¤ä»˜ï¼Œå¹¶åœ¨ç”Ÿäº§ç¯å¢ƒå¾—åˆ°äº†éªŒè¯ï¼Œå…¶ä¸­ä¹Ÿæœ‰ä¸å°‘è¸©å‘çš„åœ°æ–¹ï¼Œå€Ÿæ­¤æœºä¼šå’Œå¤§å®¶åˆ†äº«äº¤æµä¸€ä¸‹ã€‚ æœ¬ç¯‡æˆ‘ä»¬é¦–å…ˆä¼šç”¨åˆ©ç”¨SpringBootæ„å»ºå‡ºä¸€ä¸ªç®€å•çš„REST API.æ¥ç€ä¼šåˆ›å»ºå¦ä¸€ä¸ªSpringBooté¡¹ç›®ï¼ŒåŸºäºSpringCloudéƒ¨ç½²ï¼Œå¹¶åœ¨ä¸¤ä¸ªåº”ç”¨ä¹‹é—´è¿›è¡Œè°ƒç”¨ã€‚ ä½¿ç”¨SpringBootæ„å»ºREST APIæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Springå®˜æ–¹æä¾›çš„åˆå§‹åŒ–å·¥å…·å¸®æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªåŸºç¡€é¡¹ç›®ï¼šhttp://start.spring.io/,å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¡«å…¥ç›¸åº”ä¿¡æ¯å³å¯ã€‚ç”±äºåªæ˜¯è¦å®ç°REST APIæ‰€ä»¥è¿™é‡Œåªéœ€è¦å¼•ç”¨webä¾èµ–å³å¯ã€‚ å°†ç”Ÿæˆå¥½çš„é¡¹ç›®å¯¼å…¥IDE(æˆ‘ä½¿ç”¨çš„æ˜¯idea)ä¸­,ç›®å½•ç»“æ„å¦‚ä¸‹; å…¶ä¸­çš„SbcUserApplicationæ˜¯æ•´ä¸ªåº”ç”¨çš„å…¥å£ã€‚ resource/application.propertiesè¿™é‡Œæ˜¯å­˜æ”¾æ•´ä¸ªåº”ç”¨çš„é…ç½®æ–‡ä»¶ã€‚ å…¶ä¸­çš„staticå’Œtemplatesæ˜¯å­˜æ”¾é™æ€èµ„æºä»¥åŠå‰ç«¯æ¨¡æ¿çš„åœ°æ–¹ï¼Œç”±äºæˆ‘ä»¬é‡‡ç”¨äº†å‰åç«¯åˆ†ç¦»ï¼Œæ‰€ä»¥è¿™äº›ç›®å½•åŸºæœ¬ä¸Šç”¨ä¸ä¸Šäº†ã€‚ é€šè¿‡è¿è¡ŒSbcUserApplicationç±»çš„mainæ–¹æ³•å¯ä»¥å¯åŠ¨SpringBooté¡¹ç›®ã€‚ æ¥ç€åœ¨PostManä¸­è¿›è¡Œè°ƒç”¨ï¼Œçœ‹åˆ°ä»¥ä¸‹ç»“æœè¡¨æ˜å¯åŠ¨æˆåŠŸäº†ï¼š è¿™æ ·ä¸€çœ‹æ˜¯ä¸æ˜¯è¦æ¯”ä¹‹å‰ç”¨Spring+SpringMVCæ¥æ•´åˆè¦æ–¹ä¾¿å¿«æ·å¾ˆå¤šã€‚ åˆ›å»ºå¦ä¸€ä¸ªSpringBooté¡¹ç›®å½“æˆ‘ä»¬çš„é¡¹ç›®é‡‡ç”¨å¾®æœåŠ¡æ„å»ºä¹‹åè‡ªç„¶å°±ä¼šè¢«æ‹†åˆ†æˆNå¤šä¸ªç‹¬ç«‹çš„åº”ç”¨ã€‚æ¯”å¦‚ä¸Šæ–‡ä¸­çš„sbc-userç”¨äºç”¨æˆ·ç®¡ç†ã€‚è¿™é‡Œå†åˆ›å»ºä¸€ä¸ªsbc-orderç”¨æˆ·ç”Ÿæˆè®¢å•ã€‚ ä¸ºäº†æ–¹ä¾¿ä¹‹åçš„ä»£ç å¤ç”¨ï¼Œæˆ‘å°†commonåŒ…ä¸­çš„ä¸€äº›æšä¸¾å€¼ã€å·¥å…·ç±»å•ç‹¬æåˆ°sbc-commonåº”ç”¨ä¸­äº†ï¼Œè¿™æ ·æœ‰å…¶ä»–åº”ç”¨è¦ä½¿ç”¨è¿™äº›åŸºç¡€ç±»ç›´æ¥å¼•å…¥è¿™ä¸ªä¾èµ–å³å¯ã€‚ 12345&lt;dependency&gt; &lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;sbc-common&lt;/artifactId&gt; &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt; åˆ›å»ºæ­¥éª¤å’Œä¸Šæ–‡å·®ä¸å¤šï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªorder/getOrderNoçš„æœåŠ¡ï¼Œè°ƒç”¨ç»“æœå¦‚ä¸‹ï¼š ä¹‹åä¼šåˆ©ç”¨SpringCloudæ¥å°†ä¸¤ä¸ªæœåŠ¡å…³è”èµ·æ¥ï¼Œå¹¶å¯ä»¥äº’ç›¸è°ƒç”¨ã€‚ ä½¿ç”¨SpringCloudè¿›è¡Œåˆ†å¸ƒå¼è°ƒç”¨æ­å»ºeurekaæ³¨å†Œä¸­å¿ƒæ—¢ç„¶æ˜¯è¦æ­å»ºå¾®æœåŠ¡é‚£è‡ªç„¶å°‘ä¸äº†æ³¨å†Œä¸­å¿ƒäº†ï¼Œä¹‹å‰è®²çš„dubboé‡‡ç”¨çš„æ˜¯zookeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼ŒSpringCloudåˆ™é‡‡ç”¨çš„æ˜¯Netflix Eurekaæ¥åšæœåŠ¡çš„æ³¨å†Œä¸å‘ç°ã€‚ æ–°å»ºä¸€ä¸ªé¡¹ç›®sbc-service,ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š æ ¸å¿ƒçš„pom.xml 123456789101112131415161718192021222324&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-eureka-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt; &lt;artifactId&gt;logback-classic&lt;/artifactId&gt; &lt;version&gt;1.2.1&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt;&lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;Brixton.RELEASE&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/dependencyManagement&gt; éå¸¸easyï¼Œåªéœ€è¦å¼•å…¥eurekaçš„ä¾èµ–å³å¯ã€‚ç„¶ååœ¨å…¥å£ç±»åŠ å…¥ä¸€ä¸ªæ³¨è§£@EnableEurekaServerï¼Œå³å¯å°†è¯¥é¡¹ç›®ä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼š 12345678910111213141516171819package com.crossoverJie.service;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;@EnableEurekaServer@SpringBootApplicationpublic class EurekaApplication &#123; private final static Logger logger = LoggerFactory.getLogger(EurekaApplication.class); public static void main(String[] args) &#123; SpringApplication.run(EurekaApplication.class, args); logger.info("SpringBoot Start Success"); &#125;&#125; æ¥ç€ä¿®æ”¹é…ç½®æ–‡ä»¶application.properties: 123456789server.port=8888# ä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±eureka.client.register-with-eureka=false# ä¸éœ€è¦æ£€ç´¢æœåŠ¡eureka.client.fetch-registry=falseeureka.client.serviceUrl.defaultZone=http://localhost:$&#123;server.port&#125;/eureka/ é…ç½®ä¸€ä¸‹ç«¯å£ä»¥åŠæ³¨å†Œä¸­å¿ƒçš„åœ°å€å³å¯ã€‚ç„¶åæŒ‰ç…§æ­£å¸¸å¯åŠ¨springBooté¡¹ç›®ä¸€æ ·å¯åŠ¨å³å¯ã€‚ åœ¨åœ°å€æ è¾“å…¥http://localhost:8888çœ‹åˆ°ä¸€ä¸‹ç•Œé¢ï¼š å½“ç„¶ç°åœ¨åœ¨æ³¨å†Œä¸­å¿ƒè¿˜çœ‹ä¸åˆ°ä»»ä½•ä¸€ä¸ªåº”ç”¨ï¼Œä¸‹é¢éœ€è¦å°†ä¸Šæ–‡çš„sbc-user,sbc-orderæ³¨å†Œè¿›æ¥ã€‚ å‘æ³¨å†Œä¸­å¿ƒæ³¨å†ŒæœåŠ¡æä¾›è€…åªéœ€è¦åœ¨application.propertiesé…ç½®æ–‡ä»¶ä¸­åŠ ä¸Šæ³¨å†Œä¸­å¿ƒçš„é…ç½®ï¼š 1eureka.client.serviceUrl.defaultZone=http://localhost:8888/eureka/ å¹¶åœ¨sbc-orderçš„ä¸»ç±»ä¸­åŠ å…¥@EnableDiscoveryClientæ³¨è§£å³å¯å®Œæˆæ³¨å†ŒæœåŠ¡ã€‚ å¯åŠ¨æ³¨å†Œä¸­å¿ƒä»¥åŠåº”ç”¨ï¼Œåœ¨æ³¨å†Œä¸­å¿ƒçœ‹åˆ°ä¸€ä¸‹ç•Œé¢åˆ™æˆåŠŸæ³¨å†Œ: æ¶ˆè´¹æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡æœåŠ¡æ˜¯æ³¨å†Œä¸Šå»äº†ï¼Œè‡ªç„¶æ˜¯éœ€è¦æ¶ˆè´¹äº†ï¼Œè¿™é‡Œå°±ç®€å•æ¨¡æ‹Ÿäº†åœ¨è°ƒç”¨http://localhost:8080/user/getUserè¿™ä¸ªæ¥å£çš„æ—¶å€™getUseræ¥å£ä¼šå»è°ƒç”¨orderçš„getOrderæœåŠ¡ã€‚ è¿™é‡Œä¼šç”¨åˆ°å¦ä¸€ä¸ªä¾èµ–: 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-ribbon&lt;/artifactId&gt;&lt;/dependency&gt; ä»–å¯ä»¥å¸®æˆ‘ä»¬åšåˆ°å®¢æˆ·ç«¯è´Ÿè½½ï¼Œå…·ä½“ä½¿ç”¨å¦‚ä¸‹ï¼š åŠ å…¥ribbonä¾èµ–ã€‚ åœ¨ä¸»ç±»ä¸­å¼€å¯@LoadBalancedå®¢æˆ·ç«¯è´Ÿè½½ã€‚ åˆ›å»ºrestTemplateç±»çš„å®ä¾‹ 12345@Bean @LoadBalanced public RestTemplate restTemplate() &#123; return new RestTemplate(); &#125; ä½¿ç”¨restTemplateè°ƒç”¨è¿œç¨‹æœåŠ¡: 123456789101112131415161718192021222324@Autowired private RestTemplate restTemplate; @RequestMapping(value = "/getUser",method = RequestMethod.POST) public UserRes getUser(@RequestBody UserReq userReq)&#123; OrderNoReq req = new OrderNoReq() ; req.setReqNo("1213"); //è°ƒç”¨è¿œç¨‹æœåŠ¡ ResponseEntity&lt;Object&gt; res = restTemplate.postForEntity("http://sbc-order/order/getOrderNo", req, Object.class); logger.info("res="+JSON.toJSONString(res)); logger.debug("å…¥å‚="+ JSON.toJSONString(userReq)); UserRes userRes = new UserRes() ; userRes.setUserId(123); userRes.setUserName("å¼ ä¸‰"); userRes.setReqNo(userReq.getReqNo()); userRes.setCode(StatusEnum.SUCCESS.getCode()); userRes.setMessage("æˆåŠŸ"); return userRes ; &#125; ç”±äºæˆ‘çš„è¿œç¨‹æ¥å£æ˜¯post,æ‰€ä»¥ä½¿ç”¨äº†postForEntity()æ–¹æ³•ï¼Œå¦‚æœæ˜¯getå°±æ¢æˆgetForEntity()å³å¯ã€‚ æ³¨æ„è¿™é‡Œæ˜¯ä½¿ç”¨åº”ç”¨åsbc-order(é…ç½®äºsbc-orderçš„application.propertiesä¸­)æ¥è¿›è¡Œè°ƒç”¨çš„ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªIPåœ°å€ã€‚ å¯åŠ¨æ³¨å†Œä¸­å¿ƒã€ä¸¤ä¸ªåº”ç”¨ã€‚ç”¨PostManè°ƒç”¨getUseræ¥å£æ—¶æ§åˆ¶å°æ‰“å°: 12017-06-27 00:18:04.534 INFO 63252 --- [nio-8080-exec-3] c.c.sbcuser.controller.UserController : res=&#123;&quot;body&quot;:&#123;&quot;code&quot;:&quot;4000&quot;,&quot;message&quot;:&quot;appIDä¸èƒ½ä¸ºç©º&quot;,&quot;reqNo&quot;:&quot;1213&quot;&#125;,&quot;headers&quot;:&#123;&quot;X-Application-Context&quot;:[&quot;sbc-order:8181&quot;],&quot;Content-Type&quot;:[&quot;application/xml;charset=UTF-8&quot;],&quot;Transfer-Encoding&quot;:[&quot;chunked&quot;],&quot;Date&quot;:[&quot;Mon, 26 Jun 2017 16:18:04 GMT&quot;]&#125;,&quot;statusCode&quot;:&quot;OK&quot;,&quot;statusCodeValue&quot;:200&#125; ç”±äºå¹¶æ²¡æœ‰ä¼ é€’appIdæ‰€ä»¥orderæœåŠ¡è¿”å›äº†ä¸€ä¸ªé”™è¯¯ï¼Œä¹Ÿæ­£è¯´æ˜æ˜¯è¿œç¨‹è°ƒç”¨åˆ°äº†è¯¥æœåŠ¡ã€‚ æ€»ç»“ ps:è¿™é‡Œåªæ˜¯ç®€å•ä½¿ç”¨äº†ribbonæ¥è¿›è¡ŒæœåŠ¡è°ƒç”¨ï¼Œä½†åœ¨å®é™…çš„å¼€å‘ä¸­è¿˜æ˜¯æ¯”è¾ƒå°‘çš„ä½¿ç”¨è¿™ç§æ–¹å¼æ¥è°ƒç”¨è¿œç¨‹æœåŠ¡ï¼Œè€Œæ˜¯ä½¿ç”¨Feignè¿›è¡Œå£°æ˜å¼è°ƒç”¨ï¼Œå¯ä»¥ç®€åŒ–å®¢æˆ·ç«¯ä»£ç ï¼Œå…·ä½“ä½¿ç”¨æ–¹å¼è¯·æŒç»­å…³æ³¨ã€‚ æœ¬æ¬¡ç®—æ˜¯springBoot+springCloudçš„å…¥é—¨ï¼Œè¿˜æœ‰å¾ˆå¤šä¸œè¥¿æ²¡æœ‰è®²åˆ°ï¼Œä¹‹åæˆ‘å°†ä¼šæ ¹æ®å®é™…ä½¿ç”¨çš„ä¸€äº›ç»éªŒç»§ç»­åˆ†äº«SpringCloudè¿™ä¸ªæ–°å…´æ¡†æ¶ã€‚ é¡¹ç›®ï¼šhttps://github.com/crossoverJie/springboot-cloud åšå®¢ï¼šhttp://crossoverjie.topã€‚]]></content>
      <categories>
        <category>sbc</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>SpringCloud</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(åå››) åŸºäºannotationçš„httpé˜²é‡æ’ä»¶]]></title>
    <url>%2F2017%2F05%2F24%2FSSM14%2F</url>
    <content type="text"><![CDATA[å‰è¨€é’ˆå¯¹äºæˆ‘ä»¬ç°åœ¨å¸¸ç”¨çš„RESTful APIé€šå¸¸æˆ‘ä»¬éœ€è¦å¯¹è¯·æ±‚è¿›è¡Œå”¯ä¸€æ ‡è¯†ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡éƒ½è¦å¸¦ä¸Šä¸€ä¸ªè¯·æ±‚å·,å¦‚reqNOã€‚ å¯¹äºå…¥åº“è¿™ç§æ“ä½œæ•°æ®åº“çš„è¯·æ±‚æˆ‘ä»¬ä¸€èˆ¬è¦ä¿è¯ä»–çš„å”¯ä¸€æ€§ï¼Œä¸€ä¸ªè¯·æ±‚å·é€šå¸¸åªèƒ½ç”¨ä¸€æ¬¡ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬å¯¹è¿™ç§è¯·æ±‚åŠ ä¸Šæ ¡éªŒæœºåˆ¶ã€‚ è¯¥éœ€æ±‚çš„å®ç°æ€è·¯æ˜¯é€šè¿‡è‡ªå®šä¹‰annotationï¼Œåªç»™éœ€è¦è¿›è¡Œæ ¡éªŒçš„æ¥å£åŠ ä¸Šæ³¨è§£ã€‚ç„¶åé€šè¿‡åˆ‡é¢ä½¿ç”¨äº†æ³¨è§£çš„æ¥å£å°†æ¯æ¬¡è¯·æ±‚å·å­˜è¿›Redisï¼Œæ¯æ¬¡éƒ½è¿›è¡Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿™ä¸ªè¯·æ±‚å·å³å¯ã€‚ æ¥çœ‹ä¸‹åŠ ä¸Šæœ¬æ¬¡æ’ä»¶çš„å®é™…æ•ˆæœï¼š è‡ªå®šä¹‰æ³¨è§£é¦–å…ˆæˆ‘ä»¬è¦è‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼š 1234567@Target(ElementType.METHOD)@Retention(RetentionPolicy.RUNTIME)@Documentedpublic @interface CheckReqNo &#123; String desc() default "";&#125; (ps:è¿™é‡Œå¹¶ä¸è¿‡å¤šçš„è®²è§£æ³¨è§£ç›¸å…³çš„çŸ¥è¯†)ã€‚ é¦–å…ˆä½¿ç”¨@interfaceæ¥å£°æ˜ä¸€ä¸ªæ³¨è§£ã€‚æ¥ç€åˆ©ç”¨Javaä¸ºæˆ‘ä»¬æä¾›çš„ä¸‰ä¸ªå…ƒæ³¨è§£æ¥å®šä¹‰CheckReqNoæ³¨è§£ã€‚ å…¶ä¸­@Targetè¡¨æ˜è¿™ä¸ªæ³¨è§£è¢«ç”¨äºä»€ä¹ˆåœ°æ–¹ï¼Œä½¿ç”¨ElementType.METHODè¡¨æ˜è¢«åº”ç”¨åˆ°æ–¹æ³•ä¸Šï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–å€¼å¯ä»¥æŸ¥çœ‹java.lang.annotation.ElementTypeè¿™ä¸ªæšä¸¾ç±»å‹ã€‚ @Retentionæ³¨è§£è¡¨æ˜æˆ‘ä»¬çš„æ³¨è§£åœ¨ä»€ä¹ˆèŒƒå›´å†…æœ‰æ•ˆï¼Œè¿™é‡Œé…ç½®çš„RetentionPolicy.RUNTIMEè¡¨æ˜åœ¨è¿è¡Œæ—¶å¯ä»¥é€šè¿‡åå°„æ¥è·å–ã€‚ @Documentedçœ‹å­—é¢æ„æ€åº”è¯¥ä¹Ÿèƒ½çŒœåˆ°æ˜¯ç”¨äºç”ŸæˆJavaDocæ–‡æ¡£çš„ã€‚ å…¶ä¸­å®šä¹‰äº†ä¸€ä¸ªdesc()çš„æ–¹æ³•å…¶å®å¹¶æ²¡æœ‰ç”¨åˆ°ï¼Œä½†å¦‚æœéœ€è¦åœ¨ä½¿ç”¨æ³¨è§£çš„æ—¶å€™éœ€è¦è‡ªå®šä¹‰ä¸€äº›filed(åŸŸ)çš„éœ€æ±‚å¯ä»¥æŒ‰ç…§è¿™æ ·çš„æ–¹å¼å†™åˆ°è¿™é‡Œï¼Œé€šè¿‡åå°„éƒ½å¯ä»¥è·å–åˆ°å…·ä½“çš„å€¼ã€‚å¦‚ï¼š@CheckReqNo(desc = &quot;abc&quot;)å°±å¯ä»¥è·å–åˆ°&quot;abc&quot;çš„å€¼ã€‚ åˆ‡é¢æ³¨è§£æŒ‰ç…§ä¹‹å‰çš„æƒ³æ³•æ˜¯åœ¨å¯¹æ‰€æœ‰ä½¿ç”¨äº†è¯¥æ³¨è§£çš„æ–¹æ³•è¿›è¡Œåˆ‡é¢ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364@Aspect@Componentpublic class ReqNoDrcAspect &#123; private static Logger logger = LoggerFactory.getLogger(ReqNoDrcAspect.class); @Value("$&#123;redis.prefixReq:reqNo&#125;") private String prefixReq ; @Value("$&#123;redis.day:1&#125;") private long day ; @Autowired private RedisTemplate&lt;String, String&gt; redisTemplate; @PostConstruct public void init() throws Exception &#123; logger.info("SSM-REQUEST-CHECK init......"); &#125; @Pointcut("@annotation(com.crossoverJie.request.anotation.CheckReqNo)") public void checkRepeat()&#123; &#125; @Before("checkRepeat()") public void before(JoinPoint joinPoint) throws Exception &#123; BaseRequest request; request = getBaseRequest(joinPoint); if(request != null)&#123; final String reqNo = request.getReqNo(); if(StringUtil.isEmpty(reqNo))&#123; throw new RuntimeException("reqNoä¸èƒ½ä¸ºç©º"); &#125;else&#123; try &#123; String tempReqNo = redisTemplate.opsForValue().get(prefixReq +reqNo); logger.debug("tempReqNo="+tempReqNo); if((StringUtil.isEmpty(tempReqNo)))&#123; redisTemplate.opsForValue().set(prefixReq + reqNo, reqNo, day, TimeUnit.DAYS); &#125;else&#123; throw new RuntimeException("è¯·æ±‚å·é‡å¤,reqNo="+reqNo); &#125; &#125; catch (RedisConnectionFailureException e)&#123; logger.error("redisæ“ä½œå¼‚å¸¸",e); throw new RuntimeException("need redisService") ; &#125; &#125; &#125; &#125; public static BaseRequest getBaseRequest(JoinPoint joinPoint) throws Exception &#123; BaseRequest returnRequest = null; Object[] arguments = joinPoint.getArgs(); if(arguments != null &amp;&amp; arguments.length &gt; 0)&#123; returnRequest = (BaseRequest) arguments[0]; &#125; return returnRequest; &#125;&#125; ä½¿ç”¨@Aspectæ¥å®šä¹‰äº†ä¸€ä¸ªåˆ‡é¢ã€‚å…¶ä¸­prefixReq,dayåŸŸå¯ä»¥è‡ªå®šä¹‰ç¼“å­˜è¯·æ±‚å·æ—¶çš„keyå‰ç¼€ä»¥åŠç¼“å­˜çš„æ—¶é—´ã€‚ æœ€å…³é”®çš„ä¸€ç‚¹æ˜¯ç”¨@Pointcut(&quot;@annotation(com.crossoverJie.request.anotation.CheckReqNo)&quot;)å®šä¹‰äº†ä¸€ä¸ªåˆ‡å…¥ç‚¹ï¼Œè¿™æ ·æ‰€æœ‰ä½¿ç”¨@CheckReqNoçš„æ³¨è§£éƒ½ä¼šè¢«æ‹¦æˆªã€‚ æ¥ä¸‹æ¥çš„é€»è¾‘å°±æ¯”è¾ƒç®€å•äº†ï¼Œåœ¨æ¯æ¬¡è¯·æ±‚ä¹‹å‰è¿›è¡Œæ‹¦æˆªã€‚ å…ˆå»Redisä¸­æŸ¥çœ‹è¿™ä¸ªè¯·æ±‚å·(ps:åå°„è·å–)æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™é€šè¿‡å¹¶å°†æœ¬æ¬¡çš„è¯·æ±‚å·ç¼“å­˜èµ·æ¥ã€‚å¦‚æœå­˜åœ¨åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ ä½¿ç”¨æ³¨è§£å¯ä»¥åœ¨jdbc.propertiesé…ç½®æ–‡ä»¶ä¸­è‡ªå®šä¹‰å‰ç¼€å’Œç¼“å­˜æ—¶é—´ 1234#rediså‰ç¼€redis.prefixReq=reqNo#redisç¼“å­˜æ—¶é—´ é»˜è®¤å•ä½ä¸ºå¤©redis.day=1 ä¸å®šä¹‰ä¹Ÿå¯ä»¥ï¼Œä¼šä½¿ç”¨é»˜è®¤å€¼ã€‚ ç”±äºè¯¥æ³¨è§£æ˜¯éœ€è¦åŠ åˆ°controllerå±‚,å› æ­¤æˆ‘ä»¬å¾—ä½¿ç”¨CGLIBä»£ç†ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå‘ï¼Œéœ€è¦å°†å¼€å¯CGLIBçš„é…ç½®é…ç½®åˆ°æˆ‘ä»¬web.xmlä¸­çš„ 1234567891011&lt;!-- Spring MVC servlet --&gt; &lt;servlet&gt; &lt;servlet-name&gt;SpringMVC&lt;/servlet-name&gt; &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt; &lt;init-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:spring-mvc.xml&lt;/param-value&gt; &lt;/init-param&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt; &lt;async-supported&gt;true&lt;/async-supported&gt; &lt;/servlet&gt; è¿™é‡Œæ‰€å®šä¹‰çš„spring-mvc.xmlæ–‡ä»¶ä¸­ï¼Œä¸ç„¶springMVCæ‰€åœ¨çš„å­å®¹å™¨æ˜¯æ— æ³•è¢«çˆ¶å®¹å™¨æ‰€åŠ è½½çš„ã€‚ ä½¿ç”¨å®ä¾‹ï¼š 1234567891011121314151617181920212223@CheckReqNo@RequestMapping(value = "/createRedisContent",method = RequestMethod.POST)@ResponseBodypublic BaseResponse&lt;NULLBody&gt; createRedisContent(@RequestBody RedisContentReq redisContentReq)&#123; BaseResponse&lt;NULLBody&gt; response = new BaseResponse&lt;NULLBody&gt;() ; Rediscontent rediscontent = new Rediscontent() ; try &#123; CommonUtil.setLogValueModelToModel(redisContentReq,rediscontent); rediscontentMapper.insertSelective(rediscontent) ; response.setReqNo(redisContentReq.getReqNo()); response.setCode(StatusEnum.SUCCESS.getCode()); response.setMessage(StatusEnum.SUCCESS.getMessage()); &#125;catch (Exception e)&#123; logger.error("system error",e); response.setReqNo(response.getReqNo()); response.setCode(StatusEnum.FAIL.getCode()); response.setMessage(StatusEnum.FAIL.getMessage()); &#125; return response ;&#125; ç»Ÿä¸€å¼‚å¸¸controller1234567891011121314151617181920212223242526272829/** * * ClassName: ErrorController &lt;br/&gt; * Function: é”™è¯¯å¼‚å¸¸ç»Ÿä¸€å¤„ç†. &lt;br/&gt; * @author crossoverJie * @version * @since JDK 1.7 */@ControllerAdvicepublic class ErrorController &#123; private Logger logger = LoggerFactory.getLogger(this.getClass()); @ExceptionHandler(Exception.class) @ResponseStatus(HttpStatus.OK) @ResponseBody public Object processUnauthenticatedException(NativeWebRequest request, Exception e) &#123; logger.error("è¯·æ±‚å‡ºç°å¼‚å¸¸:", e); BaseResponse&lt;NULLBody&gt; response = new BaseResponse&lt;NULLBody&gt;(); response.setCode(StatusEnum.FAIL.getCode()); if (e instanceof RuntimeException)&#123; response.setMessage(e.getMessage()); &#125; else &#123; response.setMessage(StatusEnum.FAIL.getMessage()); &#125; return response ; &#125;&#125; è¿™æ ·å½“controllerå±‚å‡ºç°å¼‚å¸¸ä¹‹åéƒ½ä¼šè¿›å…¥è¿™é‡Œè¿›è¡Œç»Ÿä¸€çš„è¿”å›ã€‚ æ€»ç»“è‡³æ­¤æ•´ä¸ªæ’ä»¶çš„æµç¨‹å·²ç»å…¨éƒ¨OKï¼Œä»ä¸­å¯ä»¥çœ‹å‡ºSpring AOPåœ¨å®é™…å¼€å‘ä¸­çš„å„ç§å¥½å¤„ã€‚ä¹‹å‰çš„å‡ ç¯‡æ–‡ç« ä¹Ÿæœ‰åº”ç”¨åˆ°ï¼š åœ¨JavaWebåº”ç”¨ä¸­ä½¿ç”¨Redis åŠ¨æ€åˆ‡æ¢æ•°æ®æº ä¸çŸ¥ä¸è§‰è¿™ä¸ªå°ç™½å…¥é—¨çš„SSMç³»åˆ—å·²ç»æ›´æ–°äº†14ç¯‡äº†ï¼Œåœ¨GitHubä¹Ÿæœ‰äº†500å¤šé¢—æ˜Ÿäº†ï¼ŒæœŸé—´ä¹Ÿå’Œä¸å°‘æœ‹å‹æœ‰è¿‡äº¤æµã€æ¢è®¨ï¼Œæ„Ÿè°¢å¤§å®¶çš„æ”¯æŒã€‚ æ¥ä¸‹æ¥å¯èƒ½ä¸å¤ªä¼šæ›´æ–°è¿™ä¸ªç³»åˆ—äº†ï¼Œç”±äºåšä¸»ç°åœ¨æ‰€åœ¨çš„é¡¹ç›®ç»„é‡‡ç”¨çš„æ˜¯ç›®å‰æ¯”è¾ƒæµè¡Œçš„SpringBoot+SpringCloudå’ŒDockerçš„æ–¹å¼æ¥è¿›è¡Œæ¶æ„çš„ï¼Œæ‰€ä»¥ä¹‹åçš„é‡å¿ƒè‚¯å®šä¼šç§»åˆ°è¿™æ–¹é¢ï¼Œç”¨è¿‡SpringBootä¹‹åç›¸ä¿¡å¤§å®¶è‚¯å®šä¹Ÿå›ä¸å»äº†ã€‚ æ‰€ä»¥ä¹‹åæˆ‘ä¼šç»§ç»­æ›´æ–°SpringBoot+SpringCloudç›¸å…³çš„æ–‡ç« ï¼Œæ¬¢è¿æŒç»­å…³æ³¨ï¼ŒæŒç»­æ‹ç –(ps:è¿™ä¸ªæ’ä»¶ä¹Ÿä¼šç”¨springBooté‡å†™ä¸€é) æ’ä»¶åœ°å€ï¼šhttps://github.com/crossoverJie/SSM-REQUEST-CHECK.git é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>HTTP</tag>
        <tag>annotation</tag>
        <tag>AOP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(åä¸‰) å°†dubboæš´éœ²å‡ºHTTPæœåŠ¡]]></title>
    <url>%2F2017%2F05%2F07%2FSSM13%2F</url>
    <content type="text"><![CDATA[å‰è¨€é€šå¸¸æ¥è¯´ä¸€ä¸ªdubboæœåŠ¡éƒ½æ˜¯å¯¹å†…ç»™å†…éƒ¨è°ƒç”¨çš„ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½ä¸€ä¸ªæœåŠ¡å°±æ˜¯éœ€è¦æä¾›ç»™å¤–éƒ¨ä½¿ç”¨ï¼Œå¹¶ä¸”è¿˜ä¸èƒ½æœ‰ä½¿ç”¨è¯­è¨€çš„å±€é™æ€§ã€‚ æ¯”è¾ƒæ ‡å‡†çš„åšæ³•æ˜¯å¯¹å¤–çš„æœåŠ¡æˆ‘ä»¬ç»Ÿä¸€æä¾›ä¸€ä¸ªopenAPIï¼Œè¿™æ ·çš„è°ƒç”¨æ–¹éœ€è¦æŒ‰ç…§æ ‡å‡†æä¾›ç›¸åº”çš„appIDä»¥åŠå¯†é’¥æ¥è¿›è¡ŒéªŒç­¾æ‰èƒ½ä½¿ç”¨ã€‚è¿™æ ·å›ºç„¶æ˜¯æ¯”è¾ƒè§„èŒƒå’Œå®‰å…¨ï¼Œä½†å¤æ‚åº¦ä¹Ÿä¸äºšäºå¼€å‘ä¸€ä¸ªå•ç‹¬çš„ç³»ç»Ÿäº†ã€‚ è¿™é‡Œæ‰€è®²åˆ°çš„æ²¡æœ‰é‚£ä¹ˆå¤æ‚ï¼Œå°±åªæ˜¯æŠŠä¸€ä¸ªä¸éœ€è¦å„ç§æƒé™æ£€éªŒçš„dubboæœåŠ¡å¯¹å¤–æä¾›ä¸ºHTTPæœåŠ¡ã€‚ è°ƒç”¨ç¤ºä¾‹: å‡†å¤‡å·¥ä½œä»¥ä¸‹æ˜¯æœ¬æ–‡æ‰€æ¶‰åŠåˆ°çš„ä¸€äº›çŸ¥è¯†ç‚¹ï¼š Springç›¸å…³çŸ¥è¯†ã€‚ Javaåå°„ç›¸å…³çŸ¥è¯†ã€‚ SpringMVCç›¸å…³çŸ¥è¯†ã€‚ å…¶å®æ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ©ç”¨SpringMVCæä¾›ä¸€ä¸ªHTTPæ¥å£ã€‚åœ¨è¯¥æ¥å£ä¸­é€šè¿‡å…¥å‚è¿›è¡Œåå°„æ‰¾åˆ°å…·ä½“çš„dubboæœåŠ¡å®ç°è¿›è¡Œè°ƒç”¨ã€‚ HttpProviderConfé…ç½®ç±»é¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ªHttpProviderConfç±»ç”¨äºä¿å­˜å£°æ˜éœ€è¦å¯¹å¤–æä¾›æœåŠ¡çš„åŒ…åï¼Œæ¯•ç«Ÿæˆ‘ä»¬åå°„æ—¶éœ€è¦ç”¨åˆ°ä¸€ä¸ªç±»çš„å…¨é™å®šåï¼š 12345678public class HttpProviderConf &#123; /** * æä¾›httpè®¿é—®çš„åŒ… */ private List&lt;String&gt; usePackage ; //çœç•¥getter setteræ–¹æ³•&#125; å°±åªæœ‰ä¸€ä¸ªusePackageæˆå‘˜å˜é‡ï¼Œç”¨äºå­˜æ”¾éœ€è¦åŒ…åã€‚è‡³äºç”¨Listçš„åŸå› æ˜¯å…è®¸æœ‰å¤šä¸ªã€‚ è¯·æ±‚å“åº”å…¥å‚ã€å‡ºå‚HttpRequestå…¥å‚123456public class HttpRequest &#123; private String param ;//å…¥å‚ private String service ;//è¯·æ±‚service private String method ;//è¯·æ±‚æ–¹æ³• //çœç•¥getter setteræ–¹æ³•&#125; å…¶ä¸­paramæ˜¯ç”¨äºå­˜æ”¾çœŸæ­£è°ƒç”¨dubboæœåŠ¡æ—¶çš„å…¥å‚ï¼Œä¼ å…¥jsonåœ¨è°ƒç”¨çš„æ—¶å€™è§£ææˆå…·ä½“çš„å‚æ•°å¯¹è±¡ã€‚ serviceå­˜æ”¾dubboæœåŠ¡å£°æ˜çš„interface APIçš„åŒ…åã€‚ methodåˆ™æ˜¯çœŸæ­£è°ƒç”¨çš„æ–¹æ³•åç§°ã€‚ HttpResponse å“åº”1234567891011public class HttpResponse implements Serializable&#123; private static final long serialVersionUID = -552828440320737814L; private boolean success;//æˆåŠŸæ ‡å¿— private String code;//ä¿¡æ¯ç  private String description;//æè¿° //çœç•¥getter setteræ–¹æ³•&#125; è¿™é‡Œåªæ˜¯å°è£…äº†å¸¸ç”¨çš„HTTPæœåŠ¡çš„å“åº”æ•°æ®ã€‚ æš´éœ²æœåŠ¡controlleræœ€é‡è¦çš„åˆ™æ˜¯controlleré‡Œçš„å®ç°ä»£ç äº†ã€‚ å…ˆè´´ä»£ç ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155@Controller@RequestMapping("/dubboAPI")public class DubboController implements ApplicationContextAware&#123; private final static Logger logger = LoggerFactory.getLogger(DubboController.class); @Autowired private HttpProviderConf httpProviderConf; //ç¼“å­˜ä½œç”¨çš„map private final Map&lt;String, Class&lt;?&gt;&gt; cacheMap = new HashMap&lt;String, Class&lt;?&gt;&gt;(); protected ApplicationContext applicationContext; @ResponseBody @RequestMapping(value = "/&#123;service&#125;/&#123;method&#125;",method = RequestMethod.POST) public String api(HttpRequest httpRequest, HttpServletRequest request, @PathVariable String service, @PathVariable String method) &#123; logger.debug("ip:&#123;&#125;-httpRequest:&#123;&#125;",getIP(request), JSON.toJSONString(httpRequest)); String invoke = invoke(httpRequest, service, method); logger.debug("callback :"+invoke) ; return invoke ; &#125; private String invoke(HttpRequest httpRequest,String service,String method)&#123; httpRequest.setService(service); httpRequest.setMethod(method); HttpResponse response = new HttpResponse() ; logger.debug("input param:"+JSON.toJSONString(httpRequest)); if (!CollectionUtils.isEmpty(httpProviderConf.getUsePackage()))&#123; boolean isPac = false ; for (String pac : httpProviderConf.getUsePackage()) &#123; if (service.startsWith(pac))&#123; isPac = true ; break ; &#125; &#125; if (!isPac)&#123; //è°ƒç”¨çš„æ˜¯æœªç»é…ç½®çš„åŒ… logger.error("service is not correct,service="+service); response.setCode("2"); response.setSuccess(false); response.setDescription("service is not correct,service="+service); &#125; &#125; try &#123; Class&lt;?&gt; serviceCla = cacheMap.get(service); if (serviceCla == null)&#123; serviceCla = Class.forName(service) ; logger.debug("serviceCla:"+JSON.toJSONString(serviceCla)); //è®¾ç½®ç¼“å­˜ cacheMap.put(service,serviceCla) ; &#125; Method[] methods = serviceCla.getMethods(); Method targetMethod = null ; for (Method m : methods) &#123; if (m.getName().equals(method))&#123; targetMethod = m ; break ; &#125; &#125; if (method == null)&#123; logger.error("method is not correct,method="+method); response.setCode("2"); response.setSuccess(false); response.setDescription("method is not correct,method="+method); &#125; Object bean = this.applicationContext.getBean(serviceCla); Object result = null ; Class&lt;?&gt;[] parameterTypes = targetMethod.getParameterTypes(); if (parameterTypes.length == 0)&#123; //æ²¡æœ‰å‚æ•° result = targetMethod.invoke(bean); &#125;else if (parameterTypes.length == 1)&#123; Object json = JSON.parseObject(httpRequest.getParam(), parameterTypes[0]); result = targetMethod.invoke(bean,json) ; &#125;else &#123; logger.error("Can only have one parameter"); response.setSuccess(false); response.setCode("2"); response.setDescription("Can only have one parameter"); &#125; return JSON.toJSONString(result) ; &#125;catch (ClassNotFoundException e)&#123; logger.error("class not found",e); response.setSuccess(false); response.setCode("2"); response.setDescription("class not found"); &#125; catch (InvocationTargetException e) &#123; logger.error("InvocationTargetException",e); response.setSuccess(false); response.setCode("2"); response.setDescription("InvocationTargetException"); &#125; catch (IllegalAccessException e) &#123; logger.error("IllegalAccessException",e); response.setSuccess(false); response.setCode("2"); response.setDescription("IllegalAccessException"); &#125; return JSON.toJSONString(response) ; &#125; /** * è·å–IP * @param request * @return */ private String getIP(HttpServletRequest request) &#123; if (request == null) return null; String s = request.getHeader("X-Forwarded-For"); if (s == null || s.length() == 0 || "unknown".equalsIgnoreCase(s)) &#123; s = request.getHeader("Proxy-Client-IP"); &#125; if (s == null || s.length() == 0 || "unknown".equalsIgnoreCase(s)) &#123; s = request.getHeader("WL-Proxy-Client-IP"); &#125; if (s == null || s.length() == 0 || "unknown".equalsIgnoreCase(s)) &#123; s = request.getHeader("HTTP_CLIENT_IP"); &#125; if (s == null || s.length() == 0 || "unknown".equalsIgnoreCase(s)) &#123; s = request.getHeader("HTTP_X_FORWARDED_FOR"); &#125; if (s == null || s.length() == 0 || "unknown".equalsIgnoreCase(s)) &#123; s = request.getRemoteAddr(); &#125; if ("127.0.0.1".equals(s) || "0:0:0:0:0:0:0:1".equals(s)) try &#123; s = InetAddress.getLocalHost().getHostAddress(); &#125; catch (UnknownHostException unknownhostexception) &#123; return ""; &#125; return s; &#125; public void setApplicationContext(ApplicationContext applicationContext) throws BeansException &#123; this.applicationContext = applicationContext; &#125; å…ˆä¸€æ­¥ä¸€æ­¥çš„çœ‹ï¼š é¦–å…ˆæ˜¯å®šä¹‰äº†ä¸€ä¸ªDubboController,å¹¶ä½¿ç”¨äº†SpringMVCçš„æ³¨è§£å¯¹å¤–æš´éœ²HTTPæœåŠ¡ã€‚ å®ç°äº†org.springframework.context.ApplicationContextAwareç±»ï¼Œå®ç°äº†setApplicationContext()æ–¹æ³•ç”¨äºåˆå§‹åŒ–Springä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œåœ¨ä¹‹åå¯ä»¥è·å–åˆ°å®¹å™¨é‡Œçš„ç›¸åº”å¯¹è±¡ã€‚ æ ¸å¿ƒçš„invoke()æ–¹æ³•ã€‚ è°ƒç”¨æ—¶ï¼šhttp://127.0.0.1:8080/SSM-SERVICE/dubboAPI/com.crossoverJie.api.UserInfoApi/getUserInfoã€‚ å…·ä½“å¦‚ä¸Šæ–‡çš„è°ƒç”¨å®ä¾‹ã€‚å…ˆå°†com.crossoverJie.api.UserInfoApiã€getUserInfoèµ‹å€¼åˆ°httpRequestå…¥å‚ä¸­ã€‚ åˆ¤æ–­ä¼ å…¥çš„åŒ…æ˜¯å¦æ˜¯å¯¹å¤–æä¾›çš„ã€‚å¦‚ä¸‹é…ç½®ï¼š1234567891011&lt;!--dubboæœåŠ¡æš´éœ²ä¸ºhttpæœåŠ¡--&gt;&lt;bean class="com.crossoverJie.dubbo.http.conf.HttpProviderConf"&gt; &lt;property name="usePackage"&gt; &lt;list&gt; &lt;!--éœ€è¦æš´éœ²æœåŠ¡çš„æ¥å£åŒ…åï¼Œå¯å¤šä¸ª--&gt; &lt;value&gt;com.crossoverJie.api&lt;/value&gt; &lt;/list&gt; &lt;/property&gt;&lt;/bean&gt;&lt;!--æ‰«ææš´éœ²åŒ…--&gt;&lt;context:component-scan base-package="com.crossoverJie.dubbo.http"/&gt; å…¶ä¸­çš„com.crossoverJie.apiå°±æ˜¯è‡ªå·±éœ€è¦æš´éœ²çš„åŒ…åï¼Œå¯ä»¥å¤šä¸ªã€‚ æ¥ç€åœ¨ç¼“å­˜mapä¸­å–å‡ºåå°„è·å–åˆ°çš„æ¥å£ç±»ç±»å‹ï¼Œå¦‚æœè·å–ä¸åˆ°åˆ™é€šè¿‡åå°„è·å–ï¼Œå¹¶å°†å€¼è®¾ç½®åˆ°ç¼“å­˜mapä¸­ï¼Œè¿™æ ·ä¸ç”¨æ¯æ¬¡éƒ½åå°„è·å–ï¼Œå¯ä»¥èŠ‚çœç³»ç»Ÿå¼€é”€(åå°„å¾ˆè€—ç³»ç»Ÿèµ„æº)ã€‚ æ¥ç€ä¹Ÿæ˜¯åˆ¤æ–­è¯¥æ¥å£ä¸­æ˜¯å¦æœ‰ä¼ å…¥çš„getUserInfoæ–¹æ³•ã€‚ å–å‡ºè¯¥æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ï¼Œå¦‚æœæ²¡æœ‰å‚æ•°åˆ™ç›´æ¥è°ƒç”¨ã€‚ å¦‚æœæœ‰å‚æ•°ï¼Œåˆ¤æ–­ä¸ªæ•°ã€‚è¿™é‡Œæœ€å¤šåªè¿è¡Œä¸€ä¸ªå‚æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨çœŸæ­£çš„dubboè°ƒç”¨çš„æ—¶å€™åªèƒ½ä¼ é€’ä¸€ä¸ªBOç±»å‹ï¼Œå…·ä½“çš„å‚æ•°åˆ—è¡¨å¯ä»¥å†™åˆ°BOä¸­ã€‚å› ä¸ºå¦‚æœæœ‰å¤šä¸ªåœ¨è¿›è¡Œjsonè§£æçš„æ—¶å€™æ˜¯æ— æ³•èµ‹å€¼åˆ°ä¸¤ä¸ªå‚æ•°å¯¹è±¡ä¸­å»çš„ã€‚ ä¹‹åè¿›è¡Œè°ƒç”¨ï¼Œå°†è°ƒç”¨è¿”å›çš„æ•°æ®è¿›è¡Œè¿”å›å³å¯ã€‚ æ€»ç»“é€šå¸¸æ¥è¯´è¿™æ ·æä¾›çš„HTTPæ¥å£å†å®é™…ä¸­ç”¨çš„ä¸å¤šï¼Œä½†æ˜¯å¾ˆæ–¹ä¾¿è°ƒè¯•ã€‚ æ¯”å¦‚å†™äº†ä¸€ä¸ªdubboçš„æŸ¥è¯¢æ¥å£ï¼Œåœ¨æµ‹è¯•ç¯å¢ƒæˆ–è€…æ˜¯é¢„å‘å¸ƒç¯å¢ƒä¸­å°±å¯ä»¥ç›´æ¥é€šè¿‡HTTPè¯·æ±‚çš„æ–¹å¼è¿›è¡Œç®€å•çš„æµ‹è¯•ï¼Œæˆ–è€…å°±æ˜¯æŸ¥è¯¢æ•°æ®ã€‚æ¯”åœ¨Javaä¸­å†™å•æµ‹æ¥æµ‹è¯•æˆ–æŸ¥è¯¢å¿«çš„å¾ˆå¤šã€‚ å®‰è£…1git clone https://github.com/crossoverJie/SSM-DUBBO-HTTP.git 1cd SSM-DUBBO-HTTP 1mvn clean 1mvn install ä½¿ç”¨12345&lt;dependency&gt; &lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;SSM-HTTP-PROVIDER&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt;&lt;/dependency&gt; springé…ç½®1234567891011&lt;!--dubboæœåŠ¡æš´éœ²ä¸ºhttpæœåŠ¡--&gt;&lt;bean class="com.crossoverJie.dubbo.http.conf.HttpProviderConf"&gt; &lt;property name="usePackage"&gt; &lt;list&gt; &lt;!--éœ€è¦æš´éœ²æœåŠ¡çš„æ¥å£åŒ…åï¼Œå¯å¤šä¸ª--&gt; &lt;value&gt;com.crossoverJie.api&lt;/value&gt; &lt;/list&gt; &lt;/property&gt;&lt;/bean&gt;&lt;!--æ‰«ææš´éœ²åŒ…--&gt;&lt;context:component-scan base-package="com.crossoverJie.dubbo.http"/&gt; æ’ä»¶åœ°å€ï¼šhttps://github.com/crossoverJie/SSM-DUBBO-HTTP é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚ GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>dubbo</tag>
        <tag>HTTP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç§‘æ™®-ä¸ºè‡ªå·±çš„åšå®¢å…è´¹åŠ ä¸Šå°ç»¿é”]]></title>
    <url>%2F2017%2F05%2F07%2Fhttps%2F</url>
    <content type="text"><![CDATA[åœ¨å¦‚ä»Šçš„HTTPSå¤§å½“å…¶é“çš„æƒ…å†µä¸‹è‡ªå·±çš„åšå®¢è¦æ˜¯è¿˜æ²¡æœ‰ç”¨ä¸Šã€‚ä½œä¸ºäº’è”ç½‘çš„èºä¸é’‰(ç å†œ)å²‚ä¸æ˜¯å¾ˆæ²¡é¢å­ã€‚ ä½¿ç”¨CLOUDFLAREè¿™é‡Œä½¿ç”¨CLOUDFLAREæ¥æä¾›HTTPSæœåŠ¡ã€‚ åœ¨å…¶å®˜ç½‘è¿›è¡Œæ³¨å†Œï¼ŒæŒ‰ç…§æç¤ºæ·»åŠ å¥½è‡ªå·±çš„åŸŸåå³å¯ã€‚ ä¹‹åéœ€è¦åœ¨è‡ªå·±åŸŸåçš„æä¾›å•†å¤„ä¿®æ”¹DNSæœåŠ¡å™¨ï¼Œæˆ‘æ˜¯åœ¨ä¸‡ç½‘è´­ä¹°çš„ä¿®æ”¹åå¦‚ä¸‹å›¾ï¼šå…¶ä¸­çš„DNSæœåŠ¡å™¨åœ°å€ç”±CLOUDFLAREæ˜¯æä¾›çš„ã€‚ä¿®æ”¹å®Œæˆä¹‹åé€šå¸¸éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´æ‰èƒ½ç”Ÿæ•ˆã€‚ æ¥ç€åœ¨CLOUDFLAREé…ç½®DNSè§£æï¼šç‚¹å‡»CLOUDFLAREé¡¶éƒ¨çš„DNSè¿›è¡Œå¦‚æˆ‘ä¸Šå›¾ä¸­çš„é…ç½®ï¼Œå’Œä¹‹å‰çš„é…ç½®æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ ç­‰å¾…ä¸€æ®µæ—¶é—´ä¹‹åå‘ç°ä½¿ç”¨HTTP,HTTPSéƒ½èƒ½è®¿é—®ï¼Œä½†æ˜¯æœ€å¥½è¿˜æ˜¯èƒ½åœ¨è®¿é—®HTTPçš„æ—¶å€™èƒ½å¼ºåˆ¶è·³è½¬åˆ°HTTPS. åœ¨CLOUDFLAREèœå•æ ç‚¹å‡»page-rulesä¹‹åæ–°å»ºä¸€ä¸ªpage ruleï¼šè¿™æ ·æ•´ä¸ªç½‘ç«™çš„è¯·æ±‚éƒ½ä¼šå¼ºåˆ¶åˆ°è¯·æ±‚åˆ°HTTPS. ä¸»é¢˜é…ç½®ç”±äºæˆ‘æ‰ç”¨çš„æ˜¯Hexoä¸­çš„Nextä¸»é¢˜ï¼Œå…¶ä¸­é…ç½®äº†CNZZç«™é•¿ç»Ÿè®¡ã€‚å…¶ä¸­é…ç½®çš„CNZZç»Ÿè®¡JSæ˜¯æ‰ç”¨çš„HTTPã€‚å¯¼è‡´åœ¨é¦–é¡µçš„æ—¶å€™chromeä¸€ç›´æç¤ºæ„Ÿå¹å·ã€‚ä¿®æ”¹ç«™ç‚¹themes/next/layout/_scripts/third-party/analyticsç›®å½•ä¸‹çš„cnzz-analytics.swigæ–‡ä»¶1234567&#123;% if theme.cnzz_siteid %&#125; &lt;div style=&quot;display: none;&quot;&gt; &lt;script src=&quot;https://s6.cnzz.com/stat.php?id=&#123;&#123; theme.cnzz_siteid &#125;&#125;&amp;web_id=&#123;&#123; theme.cnzz_siteid &#125;&#125;&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt; &lt;/div&gt;&#123;% endif %&#125; ä¹‹åå†è¿›è¡Œæ„å»ºçš„æ—¶å€™å°±ä¼šä½¿ç”¨HTTPS. å€¼å¾—æ³¨æ„ä¸€ç‚¹çš„æ˜¯ä¹‹åæ–‡ç« ä¸­æ‰€ä½¿ç”¨çš„å›¾ç‰‡éƒ½è¦ç”¨HTTPSçš„åœ°å€äº†ï¼Œä¸ç„¶chromeä¼šæç¤ºæ„Ÿå¹å·ã€‚ ä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚ GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>ç§‘æ™®</category>
      </categories>
      <tags>
        <tag>HTTP</tag>
        <tag>HTTPS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(åäºŒ) dubboæ—¥å¿—æ’ä»¶]]></title>
    <url>%2F2017%2F04%2F25%2FSSM12%2F</url>
    <content type="text"><![CDATA[å‰è¨€åœ¨ä¹‹å‰dubboåˆ†å¸ƒå¼æ¡†æ¶ä¸­è®²åˆ°äº†å¦‚ä½•åˆ©ç”¨dubboæ¥æ­å»ºä¸€ä¸ªå¾®æœåŠ¡é¡¹ç›®ã€‚å…¶ä¸­è¿˜æœ‰ä¸€äº›å€¼å¾—ä¼˜åŒ–æé«˜å¼€å‘æ•ˆç‡çš„åœ°æ–¹ï¼Œæ¯”å¦‚æ—¥å¿—ï¼š å½“æˆ‘ä»¬ä¸€ä¸ªé¡¹ç›®æ‹†åˆ†ä¸ºNå¤šä¸ªå¾®æœåŠ¡ä¹‹åï¼Œå½“å…¶ä¸­ä¸€ä¸ªè°ƒç”¨å¦ä¸€ä¸ªæœåŠ¡å‡ºç°äº†é—®é¢˜ï¼Œé¦–å…ˆç¬¬ä¸€æ­¥è‡ªç„¶æ˜¯æŸ¥çœ‹æ—¥å¿—ã€‚ å‡ºç°é—®é¢˜çš„æœ‰å¾ˆå¤šæƒ…å†µï¼Œå¦‚æä¾›æ–¹è‡ªèº«ä»£ç çš„é—®é¢˜ï¼Œè°ƒç”¨æ–¹çš„å§¿åŠ¿ä¸å¯¹ç­‰ã€‚ è‡ªèº«çš„é—®é¢˜è¿™ä¸ªç®¡ä¸äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å¯¹æ¯ä¸€ä¸ªå…¥å‚ã€è¿”å›éƒ½åŠ ä¸Šæ—¥å¿—ï¼Œè¿™æ ·é¦–å…ˆå°±å¯ä»¥åˆ¤æ–­è°ƒç”¨æ–¹æ˜¯å¦å§¿åŠ¿ä¸å¯¹äº†ã€‚ ä¸ºäº†è§„èŒƒæ—¥å¿—å·²ç»åç»­çš„å¯æ‰©å±•ï¼Œæˆ‘ä»¬å¯ä»¥å•ç‹¬æä¾›ä¸€ä¸ªæ’ä»¶ç»™æ¯ä¸ªé¡¹ç›®ä½¿ç”¨å³å¯ã€‚ æ•ˆæœå¦‚ä¸‹ï¼š 123456789101112132017-04-25 15:15:38,968 DEBUG [com.alibaba.dubbo.remoting.transport.DecodeHandler] - [DUBBO] Decode decodeable message com.alibaba.dubbo.rpc.protocol.dubbo.DecodeableRpcInvocation, dubbo version: 2.5.3, current host: 127.0.0.12017-04-25 15:15:39,484 DEBUG [com.crossoverJie.dubbo.filter.DubboTraceFilter] - dubboè¯·æ±‚æ•°æ®:&#123;&quot;args&quot;:[1],&quot;interfaceName&quot;:&quot;com.crossoverJie.api.UserInfoApi&quot;,&quot;methodName&quot;:&quot;getUserInfo&quot;&#125;2017-04-25 15:15:39,484 INFO [com.crossoverJie.api.impl.UserInfoApiImpl] - ç”¨æˆ·æŸ¥è¯¢Id=12017-04-25 15:15:39,505 DEBUG [org.mybatis.spring.SqlSessionUtils] - Creating a new SqlSession2017-04-25 15:15:39,525 DEBUG [org.mybatis.spring.SqlSessionUtils] - SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@6f56b29] was not registered for synchronization because synchronization is not active2017-04-25 15:15:39,549 DEBUG [org.mybatis.spring.transaction.SpringManagedTransaction] - JDBC Connection [com.alibaba.druid.proxy.jdbc.ConnectionProxyImpl@778b3121] will not be managed by Spring2017-04-25 15:15:39,555 DEBUG [com.crossoverJie.api.dubbo.dao.T_userDao.selectByPrimaryKey] - ==&gt; Preparing: select id, username, password,roleId from t_user where id = ? 2017-04-25 15:15:39,591 DEBUG [com.crossoverJie.api.dubbo.dao.T_userDao.selectByPrimaryKey] - ==&gt; Parameters: 1(Integer)2017-04-25 15:15:39,616 DEBUG [com.crossoverJie.api.dubbo.dao.T_userDao.selectByPrimaryKey] - &lt;== Total: 12017-04-25 15:15:39,616 DEBUG [com.alibaba.druid.pool.PreparedStatementPool] - &#123;conn-10003, pstmt-20000&#125; enter cache2017-04-25 15:15:39,617 DEBUG [org.mybatis.spring.SqlSessionUtils] - Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@6f56b29]2017-04-25 15:15:45,473 INFO [com.crossoverJie.dubbo.filter.DubboTraceFilter] - dubboæ‰§è¡ŒæˆåŠŸ2017-04-25 15:15:45,476 DEBUG [com.crossoverJie.dubbo.filter.DubboTraceFilter] - dubboè¿”å›æ•°æ®&#123;&quot;args&quot;:[&#123;&quot;id&quot;:1,&quot;password&quot;:&quot;123456&quot;,&quot;roleId&quot;:1,&quot;userName&quot;:&quot;crossoverJie&quot;&#125;],&quot;interfaceName&quot;:&quot;com.crossoverJie.api.UserInfoApi&quot;,&quot;methodName&quot;:&quot;getUserInfo&quot;&#125; dubbo filteræ‹“å±•å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡1234567891011## å®šä¹‰å®ä½“é¦–å…ˆå®šä¹‰ä¸€ä¸ªå®ä½“ç±»ç”¨äºä¿å­˜è°ƒç”¨è¿‡ç¨‹ä¸­çš„ä¸€äº›æ•°æ®ï¼š```javapublic class FilterDesc &#123; private String interfaceName ;//æ¥å£å private String methodName ;//æ–¹æ³•å private Object[] args ;//å‚æ•° //çœç•¥getter setter&#125; DubboTraceFilterå…·ä½“æ‹¦æˆªé€»è¾‘1234567891011121314151617181920212223242526272829303132333435363738@Activate(group = Constants.PROVIDER, order = -999)public class DubboTraceFilter implements Filter&#123; private static final Logger logger = LoggerFactory.getLogger(DubboTraceFilter.class); public Result invoke(Invoker&lt;?&gt; invoker, Invocation invocation) throws RpcException &#123; try &#123; FilterDesc filterReq = new FilterDesc() ; filterReq.setInterfaceName(invocation.getInvoker().getInterface().getName()); filterReq.setMethodName(invocation.getMethodName()) ; filterReq.setArgs(invocation.getArguments()); logger.debug("dubboè¯·æ±‚æ•°æ®:"+JSON.toJSONString(filterReq)); Result result = invoker.invoke(invocation); if (result.hasException() &amp;&amp; invoker.getInterface() != GenericService.class)&#123; logger.error("dubboæ‰§è¡Œå¼‚å¸¸",result.getException()); &#125;else &#123; logger.info("dubboæ‰§è¡ŒæˆåŠŸ"); FilterDesc filterRsp = new FilterDesc() ; filterRsp.setMethodName(invocation.getMethodName()); filterRsp.setInterfaceName(invocation.getInvoker().getInterface().getName()); filterRsp.setArgs(new Object[]&#123;result.getValue()&#125;); logger.debug("dubboè¿”å›æ•°æ®"+JSON.toJSONString(filterRsp)); &#125; return result ; &#125;catch (RuntimeException e)&#123; logger.error("dubboæœªçŸ¥å¼‚å¸¸" + RpcContext.getContext().getRemoteHost() + ". service: " + invoker.getInterface().getName() + ", method: " + invocation.getMethodName() + ", exception: " + e.getClass().getName() + ": " + e.getMessage(), e); throw e ; &#125; &#125;&#125; é€»è¾‘éå¸¸ç®€å•ï¼Œåªæ˜¯å¯¹è°ƒç”¨è¿‡ç¨‹ã€å¼‚å¸¸ã€æˆåŠŸä¹‹åæ‰“å°ç›¸åº”çš„æ—¥å¿—è€Œå·²ã€‚ ä½†æ˜¯æœ‰ä¸ªåœ°æ–¹è¦æ³¨æ„ä¸€ä¸‹ï¼šéœ€è¦åœ¨resourceç›®å½•ä¸‹åŠ ä¸ŠMETA-INF.dubbo/com.alibaba.dubbo.rpc.Filteræ–‡ä»¶ã€‚1dubboTraceFilter=com.crossoverJie.dubbo.filter.DubboTraceFilter ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š12345678910src |-main |-java |-com |-xxx |-XxxFilter.java (å®ç°Filteræ¥å£) |-resources |-META-INF |-dubbo |-com.alibaba.dubbo.rpc.Filter (çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼šxxx=com.xxx.XxxFilter) æ€»ç»“è¯¥é¡¹ç›®å·²ç»æ‰˜ç®¡åˆ°GitHubï¼šhttps://github.com/crossoverJie/SSM-DUBBO-FILTER ä½¿ç”¨æ–¹æ³•å®‰è£…1cd /SSM-DUBBO-FILTER 1mvn clean 1mvn install ä½¿ç”¨åœ¨æœåŠ¡æä¾›çš„é¡¹ç›®ä¸­åŠ ä¸Šä¾èµ–ï¼Œè¿™æ ·æ¯æ¬¡è°ƒç”¨éƒ½ä¼šæ‰“ä¸Šæ—¥å¿—ã€‚12345&lt;dependency&gt; &lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;SSM-TRACE-FILTER&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt;&lt;/dependency&gt; åœ¨æ‹¦æˆªå™¨ä¸­æœ€å¥½ä¸è¦åŠ ä¸Šä¸€äº›è€—æ—¶ä»»åŠ¡ï¼Œéœ€è¦è€ƒè™‘åˆ°æ€§èƒ½é—®é¢˜ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚ GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>dubbo</tag>
        <tag>æ—¥å¿—</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(åä¸€) åŸºäºdubboçš„åˆ†å¸ƒå¼æ¶æ„]]></title>
    <url>%2F2017%2F04%2F07%2FSSM11%2F</url>
    <content type="text"><![CDATA[å‰è¨€ç°åœ¨è¶Šæ¥è¶Šå¤šçš„äº’è”ç½‘å…¬å¸è¿˜æ˜¯å°†è‡ªå·±å…¬å¸çš„é¡¹ç›®è¿›è¡ŒæœåŠ¡åŒ–ï¼Œè¿™ç¡®å®æ˜¯ä»Šåé¡¹ç›®å¼€å‘çš„ä¸€ä¸ªè¶‹åŠ¿ï¼Œå°±è¿™ä¸ªç‚¹å†å‡­å€Ÿä¹‹å‰çš„SSMé¡¹ç›®æ¥è®©ç¬¬ä¸€æ¬¡æ¥è§¦çš„åŒå­¦èƒ½å¿«é€Ÿä¸Šæ‰‹ã€‚ æµ…è°ˆåˆ†å¸ƒå¼æ¶æ„åˆ†å¸ƒå¼æ¶æ„å•çœ‹è¿™ä¸ªåå­—ç»™äººçš„æ„Ÿè§‰å°±æ˜¯é«˜é€¼æ ¼ï¼Œä½†å…¶å®ä»å†å²çš„è§’åº¦æ¥åˆ†æä¸€ä¸‹å°±æ¯”è¾ƒæ˜äº†äº†ã€‚ æˆ‘ä»¬æ‹¿ä¸€ä¸ªç”µå•†ç³»ç»Ÿæ¥è¯´ï¼š å•ç³»ç»Ÿå¯¹äºä¸€ä¸ªåˆšèµ·æ­¥çš„åˆ›ä¸šå…¬å¸é¡¹ç›®è‚¯å®šæ˜¯è¿½æ±‚è¶Šå¿«å®ŒæˆåŠŸèƒ½è¶Šå¥½ï¼Œå¹¶ä¸”ç”¨æˆ·é‡ä¹Ÿä¸å¤§ã€‚ è¿™æ—¶å€™æ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘éƒ½æ˜¯åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­å°±å¯ä»¥æ»¡è¶³ã€‚ å‚ç›´æ‹†åˆ†-å¤šåº”ç”¨å½“ä¸šåŠ¡é‡å’Œç”¨æˆ·é‡å‘å±•åˆ°ä¸€å®šåœ°æ­¥çš„æ—¶å€™ï¼Œè¿™æ—¶ä¸€èˆ¬ä¼šå°†åº”ç”¨åŒæ—¶éƒ¨ç½²åˆ°å‡ å°æœåŠ¡å™¨ä¸Šï¼Œåœ¨ç”¨æˆ·è®¿é—®çš„æ—¶å€™ä½¿ç”¨Nginxè¿›è¡Œåå‘ä»£ç†å’Œç®€å•çš„è´Ÿè½½å‡è¡¡ã€‚ SOAæœåŠ¡åŒ–å½“æ•´ä¸ªç³»ç»Ÿä»¥åŠå‘å±•çš„è¶³å¤Ÿå¤§çš„æ—¶å€™ï¼Œæ¯”å¦‚ä¸€ä¸ªç”µå•†ç³»ç»Ÿä¸­å­˜åœ¨æœ‰ï¼š ç”¨æˆ·ç³»ç»Ÿ è®¢å•ç³»ç»Ÿ æ”¯ä»˜ç³»ç»Ÿ ç‰©æµç³»ç»Ÿ ç­‰ç³»ç»Ÿã€‚å¦‚æœæ¯æ¬¡ä¿®æ”¹äº†å…¶ä¸­ä¸€ä¸ªç³»ç»Ÿå°±è¦é‡æ–°å‘å¸ƒä¸Šçº¿çš„è¯é‚£ä¹ˆè€¦åˆå°±å¤ªä¸¥é‡äº†ã€‚ æ‰€ä»¥éœ€è¦å°†æ•´ä¸ªé¡¹ç›®æ‹†åˆ†æˆè‹¥å¹²ä¸ªç‹¬ç«‹çš„åº”ç”¨ï¼Œå¯ä»¥è¿›è¡Œç‹¬ç«‹çš„å¼€å‘ä¸Šçº¿å®ç°å¿«é€Ÿè¿­ä»£ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºæ¯ä¸ªåº”ç”¨ä¹‹é—´ç›¸äº’ç‹¬ç«‹,æ¯ä¸ªåº”ç”¨å¯ä»¥æ¶ˆè´¹å…¶ä»–åº”ç”¨æš´éœ²å‡ºæ¥çš„æœåŠ¡ï¼ŒåŒæ—¶ä¹Ÿå¯¹å¤–æä¾›æœåŠ¡ã€‚ ä»æ¶æ„çš„å±‚é¢ç®€å•çš„ç†è§£äº†ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹å¦‚ä½•ç¼–ç å®ç°ã€‚ åŸºäºdubboçš„å®ç°dubboåº”è¯¥ç®—æ˜¯å›½å†…ä½¿ç”¨æœ€å¤šçš„åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ï¼ŒåŸºäºæ­¤æ¥å®ç°å¯¹æ–°å…¥é—¨çš„åŒå­¦åº”è¯¥å¾ˆæœ‰å¸®åŠ©ã€‚ å…¶ä¸­æœ‰æ¶‰åŠåˆ°å®‰è£…dubboæœåŠ¡çš„æ³¨å†Œä¸­å¿ƒzookeeperç­‰ç›¸å…³çŸ¥è¯†ç‚¹å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œè¿™é‡Œå°±ä¸å•ç‹¬è®²äº†ã€‚ å¯¹å¤–æä¾›æœåŠ¡é¦–å…ˆç¬¬ä¸€æ­¥éœ€è¦åœ¨SSM-APIæ¨¡å—ä¸­å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œè¿™é‡Œå°±æäº†ä¸€ä¸ªç”¨æˆ·æŸ¥è¯¢çš„æ¥å£12345678910111213141516/** * Function:ç”¨æˆ·API * @author chenjiec * Date: 2017/4/4 ä¸‹åˆ9:46 * @since JDK 1.7 */public interface UserInfoApi &#123; /** * è·å–ç”¨æˆ·ä¿¡æ¯ * @param userId * @return * @throws Exception */ public UserInfoRsp getUserInfo(int userId) throws Exception;&#125; æ¥ç€åœ¨SSM-SERVICEæ¨¡å—ä¸­è¿›è¡Œå®ç°ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748import com.alibaba.dubbo.config.annotation.Service;/** * Function: * @author chenjiec * Date: 2017/4/4 ä¸‹åˆ9:51 * @since JDK 1.7 */@Servicepublic class UserInfoApiImpl implements UserInfoApi &#123; private static Logger logger = LoggerFactory.getLogger(UserInfoApiImpl.class); @Autowired private T_userService t_userService ; /** * è·å–ç”¨æˆ·ä¿¡æ¯ * * @param userId * @return * @throws Exception */ @Override public UserInfoRsp getUserInfo(int userId) throws Exception &#123; logger.info("ç”¨æˆ·æŸ¥è¯¢Id="+userId); //è¿”å›å¯¹è±¡ UserInfoRsp userInfoRsp = new UserInfoRsp() ; T_user t_user = t_userService.selectByPrimaryKey(userId) ; //æ„å»º buildUserInfoRsp(userInfoRsp,t_user) ; return userInfoRsp; &#125; /** * æ„å»ºè¿”å› * @param userInfoRsp * @param t_user */ private void buildUserInfoRsp(UserInfoRsp userInfoRsp, T_user t_user) &#123; if (t_user == null)&#123; t_user = new T_user() ; &#125; CommonUtil.setLogValueModelToModel(t_user,userInfoRsp); &#125;&#125; è¿™äº›éƒ½æ˜¯é€šç”¨çš„ä»£ç ï¼Œä½†å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯è¿™é‡Œä½¿ç”¨çš„dubboæ¡†æ¶æ‰€æä¾›çš„@serviceæ³¨è§£ã€‚ä½œç”¨æ˜¯å£°æ˜éœ€è¦æš´éœ²çš„æœåŠ¡æ¥å£ã€‚ å†ä¹‹åå°±æ˜¯å‡ ä¸ªdubboç›¸å…³çš„é…ç½®æ–‡ä»¶äº†ã€‚ spring-dubbo-config.xml12345678910111213&lt;dubbo:application name="ssm-service" owner="crossoverJie" organization="ssm-crossoverJie" logger="slf4j"/&gt;&lt;dubbo:registry id="dubbo-registry" address="zookeeper://192.168.0.188:2181" file="/tmp/dubbo.cachr" /&gt;&lt;dubbo:monitor protocol="registry" /&gt;&lt;dubbo:protocol name="dubbo" port="20880" /&gt;&lt;dubbo:provider timeout="15000" retries="0" delay="-1" /&gt;&lt;dubbo:consumer check="false" timeout="15000" /&gt; å…¶å®å°±æ˜¯é…ç½®æˆ‘ä»¬æœåŠ¡æ³¨å†Œçš„zkåœ°å€ï¼Œä»¥åŠæœåŠ¡åç§°ã€è¶…æ—¶æ—¶é—´ç­‰é…ç½®ã€‚ spring-dubbo-provider.xml1&lt;dubbo:annotation package="com.crossoverJie.api.impl" /&gt; è¿™ä¸ªé…ç½®æ‰«ææ³¨è§£åŒ…çš„ä½ç½®ï¼Œä¸€èˆ¬é…ç½®åˆ°æ¥å£å®ç°åŒ…å³å¯ã€‚ spring-dubbo-consumer.xmlè¿™ä¸ªæ˜¯æ¶ˆè´¹è€…é…ç½®é¡¹ï¼Œè¡¨æ˜æˆ‘ä»¬éœ€è¦ä¾èµ–çš„å…¶ä»–åº”ç”¨ã€‚è¿™é‡Œæˆ‘ä»¬åœ¨SSM-BOOTé¡¹ç›®ä¸­è¿›è¡Œé…ç½®ï¼š12&lt;dubbo:reference id="userInfoApi" interface="com.crossoverJie.api.UserInfoApi" /&gt; ç›´æ¥å°±æ˜¯é…ç½®çš„åˆšæ‰æˆ‘ä»¬æä¾›çš„é‚£ä¸ªç”¨æˆ·æŸ¥è¯¢çš„æ¥å£ï¼Œè¿™æ ·å½“æˆ‘ä»¬è‡ªå·±çš„å†…éƒ¨é¡¹ç›®éœ€è¦ä½¿ç”¨åˆ°è¿™ä¸ªæœåŠ¡åªéœ€è¦ä¾èµ–SSM-BOOTå³å¯ï¼Œä¸éœ€è¦å•ç‹¬çš„å†å»é…ç½®consumerã€‚è¿™ä¸ªæˆ‘æœ‰åœ¨ä¸Šä¸€ç¯‡SSM(å) é¡¹ç›®é‡æ„-äº’è”ç½‘é¡¹ç›®çš„Mavenç»“æ„ä¸­ä¹Ÿæœ‰æåˆ°ã€‚ å®‰è£…ç®¡ç†æ§åˆ¶å°è¿˜æœ‰ä¸€ä¸ªéœ€è¦åšçš„å°±æ˜¯å®‰è£…ç®¡ç†æ§åˆ¶å°ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æœ‰å¤šå°‘æœåŠ¡ã€è°ƒç”¨æƒ…å†µæ˜¯æ€ä¹ˆæ ·ç­‰ä½œç”¨ã€‚ è¿™é‡Œæˆ‘ä»¬å¯ä»¥å°†dubboçš„å®˜æ–¹æºç ä¸‹è½½ä¸‹æ¥ï¼Œå¯¹å…¶ä¸­çš„dubbo-adminæ¨¡å—è¿›è¡Œæ‰“åŒ…ï¼Œå°†ç”Ÿæˆçš„WARåŒ…æ”¾åˆ°Tomcatä¸­è¿è¡Œèµ·æ¥å³å¯ã€‚ ä½†æ˜¯éœ€è¦æ³¨æ„ä¸€ç‚¹çš„æ˜¯ï¼šéœ€è¦å°†å…¶ä¸­çš„dubbo.propertiesçš„zkåœ°å€ä¿®æ”¹ä¸ºè‡ªå·±çš„å³å¯ã€‚123dubbo.registry.address=zookeeper://127.0.0.1:2181dubbo.admin.root.password=rootdubbo.admin.guest.password=guest åˆ°æ—¶å€™ç™»é™†çš„è¯ä½¿ç”¨rootï¼Œå¯†ç ä¹Ÿæ˜¯rootã€‚ä½¿ç”¨guestï¼Œå¯†ç ä¹Ÿæ˜¯guestã€‚ ç™»é™†ç•Œé¢å¦‚ä¸‹å›¾ï¼š å…¶ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªæœåŠ¡ä»¥åŠæ³¨å†Œä¸Šå»äº†ï¼Œä½†æ˜¯æ²¡æœ‰æ¶ˆè´¹è€…ã€‚ æ¶ˆè´¹æœåŠ¡ä¸ºäº†èƒ½å¤Ÿæ›´ç›´è§‚çš„ä½“éªŒåˆ°æ¶ˆè´¹æœåŠ¡ï¼Œæˆ‘æ–°å»ºäº†ä¸€ä¸ªé¡¹ç›®ï¼šhttps://github.com/crossoverJie/SSM-CONSUMERã€‚ å…¶ä¸­åœ¨SSM-CONSUMER-APIä¸­æˆ‘ä¹Ÿå®šä¹‰äº†ä¸€ä¸ªæ¥å£ï¼š12345678910111213141516/** * Function:è–ªèµ„API * @author chenjiec * Date: 2017/4/4 ä¸‹åˆ9:46 * @since JDK 1.7 */public interface SalaryInfoApi &#123; /** * è·å–è–ªèµ„ * @param userId * @return * @throws Exception */ public SalaryInfoRsp getSalaryInfo(int userId) throws Exception;&#125; å› ä¸ºä½œä¸ºæ¶ˆè´¹è€…çš„åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯¹å¤–æä¾›äº†ä¸€ä¸ªè·å–è–ªèµ„çš„ä¸€ä¸ªæœåŠ¡ã€‚ åœ¨SSM-CONSUMER-SERVICEæ¨¡å—ä¸­è¿›è¡Œäº†å®ç°ï¼š12345678910111213141516171819202122232425262728293031323334353637/** * Function: * @author chenjiec * Date: 2017/4/4 ä¸‹åˆ9:51 * @since JDK 1.7 */@Servicepublic class SalaryInfoApiImpl implements SalaryInfoApi &#123; private static Logger logger = LoggerFactory.getLogger(SalaryInfoApiImpl.class); @Autowired UserInfoApi userInfoApi ; /** * è·å–ç”¨æˆ·ä¿¡æ¯ * * @param userId * @return * @throws Exception */ @Override public SalaryInfoRsp getSalaryInfo(int userId) throws Exception &#123; logger.info("è–ªèµ„æŸ¥è¯¢Id="+userId); //è¿”å›å¯¹è±¡ SalaryInfoRsp salaryInfoRsp = new SalaryInfoRsp() ; //è°ƒç”¨è¿œç¨‹æœåŠ¡ UserInfoRsp userInfo = userInfoApi.getUserInfo(userId); salaryInfoRsp.setUsername(userInfo.getUserName()); return salaryInfoRsp; &#125;&#125; å…¶ä¸­å°±å¯ä»¥ç›´æ¥ä½¿ç”¨userInfoApiè°ƒç”¨ä¹‹å‰çš„ä¸ªäººä¿¡æ¯æœåŠ¡ã€‚ å†è°ƒç”¨ä¹‹å‰éœ€è¦æ³¨æ„çš„æœ‰ç‚¹æ˜¯ï¼Œæˆ‘ä»¬åªéœ€è¦ä¾èµ–SSM-BOOTè¿™ä¸ªæ¨¡å—å³å¯è¿›è¡Œè°ƒç”¨ï¼Œå› ä¸ºSSM-BOOTæ¨¡å—å·²ç»ä¸ºæˆ‘ä»¬é…ç½®äº†æ¶ˆè´¹è€…ä¹‹ç±»çš„æ“ä½œäº†ï¼š1234&lt;dependency&gt; &lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;SSM-BOOT&lt;/artifactId&gt;&lt;/dependency&gt; è¿˜æœ‰ä¸€ç‚¹æ˜¯åœ¨é…ç½®SSM-BOOTä¸­çš„spring-dubbo-cosumer.xmlé…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼Œè·¯å¾„è¦å’Œæˆ‘ä»¬åˆå§‹åŒ–springé…ç½®æ–‡ä»¶æ—¶çš„è·¯å¾„ä¸€è‡´ï¼š12345&lt;!-- Springå’Œmybatisçš„é…ç½®æ–‡ä»¶ --&gt;&lt;context-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath*:spring/*.xml&lt;/param-value&gt;&lt;/context-param&gt; æ¥ä¸‹æ¥è·‘ä¸ªå•æµ‹è¯•ä¸€ä¸‹èƒ½å¦è°ƒé€šï¼š123456789101112131415161718192021/** * Function: * * @author chenjiec * Date: 2017/4/5 ä¸‹åˆ10:41 * @since JDK 1.7 */@RunWith(SpringJUnit4ClassRunner.class)@ContextConfiguration(locations = &#123; "classpath*:/spring/*.xml" &#125;)public class SalaryInfoApiImplTest &#123; @Autowired private SalaryInfoApi salaryInfoApi ; @Test public void getSalaryInfo() throws Exception &#123; SalaryInfoRsp salaryInfo = salaryInfoApi.getSalaryInfo(1); System.out.println(JSON.toJSONString(salaryInfo)); &#125;&#125; æ¶ˆè´¹è€… æä¾›è€…å¯ä»¥çœ‹åˆ°ç¡®å®æ˜¯è°ƒç”¨æˆåŠŸäº†çš„ã€‚ æ¥ä¸‹æ¥å°†æ¶ˆè´¹è€…é¡¹ç›®ä¹ŸåŒæ—¶å¯åŠ¨åœ¨æ¥è§‚å¯Ÿç®¡ç†æ§åˆ¶å°æœ‰ä»€ä¹ˆä¸ä¸€æ ·ï¼šä¼šçœ‹åˆ°å¤šäº†ä¸€ä¸ªæ¶ˆè´¹è€…æ‰€æä¾›çš„æœåŠ¡com.crossoverjie.consumer.api.SalaryInfoApi,åŒæ—¶com.crossoverJie.api.UserInfoApiæœåŠ¡å·²ç»æ­£å¸¸ï¼Œè¯´æ˜å·²ç»æœ‰æ¶ˆè´¹è€…äº†ã€‚ ç‚¹è¿›å»ä¾¿å¯æŸ¥çœ‹å…·ä½“çš„æ¶ˆè´¹è€…ã€‚ æ€»ç»“è¿™æ ·ä¸€ä¸ªåŸºäºdubboçš„åˆ†å¸ƒå¼æœåŠ¡å·²ç»è®²çš„å·®ä¸å¤šäº†ï¼Œåœ¨å®é™…çš„å¼€å‘ä¸­æˆ‘ä»¬ä¾¿ä¼šå¼€å‘ä¸€ä¸ªå¤§ç³»ç»Ÿä¸­çš„æŸä¸€ä¸ªå­åº”ç”¨ï¼Œè¿™æ ·å°±ç®—ä¸€ä¸ªå­åº”ç”¨å‡ºé—®é¢˜äº†ä¹Ÿä¸ä¼šå½±å“åˆ°æ•´ä¸ªå¤§çš„é¡¹ç›®ã€‚ å†æä¸€ç‚¹ï¼šåœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸€èˆ¬åŒä¸€ä¸ªæœåŠ¡æˆ‘ä»¬éƒ½ä¼šæœ‰ä¸€ä¸ªmaster,slaveçš„ä¸»ä»æœåŠ¡ï¼Œè¿™æ ·åœ¨ä¸Šçº¿çš„è¿‡ç¨‹ä¸­ä¸è‡³äºæ•´ä¸ªåº”ç”¨å‡ºç°æ— æ³•ä½¿ç”¨çš„å°´å°¬æƒ…å†µã€‚ è°ˆåˆ°äº†SOAçš„å¥½å¤„ï¼Œé‚£ä¹ˆè‡ªç„¶ä¹Ÿæœ‰ç›¸å¯¹äºä¼ ç»Ÿæ¨¡å¼çš„ä¸æ–¹ä¾¿ä¹‹å¤„ï¼š æ‹†åˆ†ä¸€ä¸ªå¤§çš„é¡¹ç›®ä¸ºæˆç™¾ä¸Šåƒçš„å­åº”ç”¨å°±ä¸å¯èƒ½æ‰‹åŠ¨ä¸Šçº¿äº†ï¼Œå³éœ€è¦è‡ªåŠ¨åŒ–çš„éƒ¨ç½²ä¸Šçº¿ï¼Œå¦‚Jenkinsã€‚ è¿˜æœ‰ä¸€ä¸ªéœ€è¦åšåˆ°çš„å°±æ˜¯ç›‘æ§ï¼Œéœ€è¦ä¸€ä¸ªå•ç‹¬çš„ç›‘æ§å¹³å°æ¥å¸®æˆ‘ä»¬å®æ—¶æŸ¥çœ‹å„ä¸ªæœåŠ¡çš„è¿è¡Œæƒ…å†µä»¥ä¾¿äºåŠæ—¶å®šä½å’Œè§£å†³é—®é¢˜ã€‚ æ—¥å¿—æŸ¥çœ‹åˆ†æï¼Œæ‹†åˆ†ä¹‹åä¸å¯èƒ½å†å»æ¯å°æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹æ—¥å¿—ï¼Œéœ€è¦ä¸€ä¸ªå•ç‹¬çš„æ—¥å¿—æŸ¥çœ‹åˆ†æå·¥å…·å¦‚elkã€‚ ä»¥ä¸Šå°±æ˜¯æˆ‘ç†è§£çš„ï¼Œå¦‚æœ‰å·®é”™æ¬¢è¿æŒ‡æ­£ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚ GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>dubbo</tag>
        <tag>åˆ†å¸ƒå¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(å) é¡¹ç›®é‡æ„-äº’è”ç½‘é¡¹ç›®çš„Mavenç»“æ„]]></title>
    <url>%2F2017%2F03%2F04%2FSSM10%2F</url>
    <content type="text"><![CDATA[å‰è¨€å¾ˆä¹…æ²¡æœ‰æ›´æ–°åšå®¢äº†ï¼Œä¹‹å‰å®šä¸‹å‘¨æ›´é€æ¸æˆäº†æœˆæ›´ã€‚æ€ä¹ˆæ„Ÿè§‰åƒæˆ‘è¿½è¿‡çš„ä¸€éƒ¨åŠ¨æ¼«ã€‚è¿™ä¸ªåšæ–‡å…¶å®å¾ˆæ—©å°±æƒ³å†™äº†ã€‚ä¹‹å‰æ‰€æœ‰çš„ä»£ç éƒ½æ˜¯åœ¨ä¸€ä¸ªæ¨¡å—é‡Œé¢è¿›è¡Œå¼€å‘ï¼Œè¿™å’Œmavençš„ç†å¿µæ˜¯å®Œå…¨ä¸ç›¸ç¬¦çš„ï¼Œæœ€è¿‘ç¡¬æ˜¯æŠ½äº†ä¸€ä¸ªæ—¶é—´æ¥å¯¹é¡¹ç›®çš„ç»“æ„è¿›è¡Œäº†ä¸€æ¬¡é‡æ„ã€‚ å…ˆæ¥çœ‹çœ‹è¿™æ¬¡é‡æ„ä¹‹åçš„ç›®å½•ç»“æ„ ä¸ºä»€ä¹ˆéœ€è¦åˆ†æ¨¡å— è‡³äºä¸ºä»€ä¹ˆè¦åˆ†æ¨¡å—å‘¢ï¼Ÿ æˆ‘ä»¬è®¾æƒ³ä¸€ä¸ªè¿™æ ·çš„åœºæ™¯ï¼šåœ¨ç°åœ¨çš„äº’è”ç½‘å¼€å‘ä¸­ï¼Œä¼šæŠŠä¸€ä¸ªå¾ˆå¤§çš„ç³»ç»Ÿæ‹†åˆ†æˆå„ä¸ªå­ç³»ç»Ÿç”¨äºé™ä½ä»–ä»¬ä¹‹é—´çš„è€¦åˆåº¦ã€‚ åœ¨ä¸€ä¸ªå­é¡¹ç›®ä¸­é€šå¸¸éƒ½ä¼šä¸ºAPIã€WEBã€Serviceç­‰æ¨¡å—ã€‚è€Œä¸”å½“é¡¹ç›®å¤Ÿå¤§æ—¶ï¼Œè¿™äº›é€šå¸¸éƒ½ä¸æ˜¯ä¸€ä¸ªäººèƒ½å®Œæˆçš„å·¥ä½œï¼Œéœ€è¦ä¸€ä¸ªå›¢é˜Ÿæ¥å„å¸å…¶èŒã€‚ æƒ³è±¡ä¸€ä¸‹ï¼šå½“ä¹‹å‰æ‰€æœ‰çš„é¡¹ç›®éƒ½åœ¨ä¸€ä¸ªæ¨¡å—çš„æ—¶å€™ï¼ŒAæ”¹åŠ¨äº†APIï¼Œéœ€è¦Deployä»£ç ã€‚è€ŒBä¹Ÿæ”¹åŠ¨äº†serviceçš„ä»£ç ï¼Œä½†å¹¶æ²¡æœ‰å®Œå…¨åšå®Œã€‚æ‰€ä»¥Aåœ¨æäº¤buildçš„æ—¶å€™å°±ä¼šæŠ¥é”™ è€Œä¸”åœ¨æ•´ä¸ªé¡¹ç›®è¶³å¤Ÿå¤§çš„æ—¶å€™ï¼Œè¿™ä¸ªbuildçš„æ—¶é—´ä¹Ÿæ˜¯å¾ˆå½±å“æ•ˆç‡çš„ã€‚ ä½†è®©æˆ‘å°†å„ä¸ªæ¨¡å—ä¹‹é—´åˆ†å¼€ä¹‹åæ•ˆæœå°±ä¸ä¸€æ ·äº†ã€‚æˆ‘ä¿®æ”¹äº†APIæˆ‘å°±åªéœ€è¦ç®¡æˆ‘çš„å°±è¡Œï¼Œä¸éœ€è¦æ•´ä¸ªé¡¹ç›®è¿›è¡Œbuildã€‚ è€Œä¸”å½“æœ‰å…¶ä»–é¡¹ç›®éœ€è¦ä¾èµ–æˆ‘è¿™ä¸ªAPIçš„æ—¶å€™ä¹Ÿåªéœ€è¦ä¾èµ–APIå³å¯ï¼Œä¸ç”¨æ•´ä¸ªé¡¹ç›®éƒ½ä¾èµ–è¿‡å»ã€‚ å„ä¸ªæ¨¡å—çš„ä½œç”¨æ¥çœ‹ä¸‹è¿™æ¬¡æˆ‘æ‰€åˆ†çš„æ¨¡å—ã€‚ ROOTè¿™æ˜¯æ•´ä¸ªé¡¹ç›®çš„æ ¹èŠ‚ç‚¹ã€‚å…ˆçœ‹ä¸€ä¸‹å…¶ä¸­çš„pom.xmlï¼š 123456789101112131415161718192021222324252627282930&lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;SSM&lt;/artifactId&gt; &lt;packaging&gt;pom&lt;/packaging&gt; &lt;version&gt;2.0.0&lt;/version&gt; &lt;modules&gt; &lt;module&gt;SSM-API&lt;/module&gt; &lt;module&gt;SSM-BOOT&lt;/module&gt; &lt;module&gt;SSM-SERVICE&lt;/module&gt; &lt;module&gt;SSM-WEB&lt;/module&gt; &lt;/modules&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;spring.version&gt;4.1.4.RELEASE&lt;/spring.version&gt; &lt;jackson.version&gt;2.5.0&lt;/jackson.version&gt; &lt;lucene.version&gt;6.0.1&lt;/lucene.version&gt; &lt;/properties&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;SSM-API&lt;/artifactId&gt; &lt;version&gt;2.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; æˆ‘æˆªå–äº†å…¶ä¸­æ¯”è¾ƒé‡ç‚¹çš„é…ç½®ã€‚ ç”±äºè¿™æ˜¯çˆ¶èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘çš„packagç±»å‹ä½¿ç”¨çš„æ˜¯pomã€‚å…¶ä¸­åˆ†åˆ«æœ‰ç€å››ä¸ªå­æ¨¡å—ã€‚ å…¶ä¸­é‡ç‚¹çœ‹ä¸‹&lt;dependencyManagement&gt;è¿™ä¸ªæ ‡ç­¾ã€‚å¦‚æœä½¿ç”¨çš„æ˜¯IDEAè¿™ä¸ªå¼€å‘å·¥å…·çš„è¯æ˜¯å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å›¾ï¼š æ ‡çº¢çš„æœ‰ä¸€ä¸ªå‘ä¸‹çš„ç®­å¤´ï¼Œç‚¹ä¸€ä¸‹å°±å¯ä»¥è¿›å…¥å­æ¨¡å—ä¸­ç›¸åŒçš„ä¾èµ–ã€‚è¿™æ ·å­æ¨¡å—å°±ä¸éœ€è¦é…ç½®å…·ä½“çš„ç‰ˆæœ¬äº†ï¼Œç»Ÿä¸€ç”±çˆ¶æ¨¡å—æ¥è¿›è¡Œç»´æŠ¤ï¼Œå¯¹ä¹‹åçš„ç‰ˆæœ¬å‡çº§ä¹Ÿå¸¦æ¥äº†å¥½å¤„ã€‚ SSM-APIæ¥ä¸‹æ¥çœ‹ä¸‹APIè¿™ä¸ªæ¨¡å—ï¼š é€šå¸¸è¿™ä¸ªæ¨¡å—éƒ½æ˜¯ç”¨äºå®šä¹‰å¤–éƒ¨æ¥å£çš„ï¼Œä»¥åŠæ”¹æ¥å£æ‰€ä¾èµ–çš„ä¸€äº›DTOç±»ã€‚ä¸€èˆ¬è¿™ä¸ªæ¨¡å—éƒ½æ˜¯æ‹¿æ¥ç»™å…¶ä»–é¡¹ç›®è¿›è¡Œä¾èµ–ï¼Œå¹¶å’Œæœ¬é¡¹ç›®è¿›è¡Œæ•°æ®äº¤äº’çš„ã€‚ SSM-BOOTBOOTè¿™ä¸ªæ¨¡å—æ¯”è¾ƒç‰¹æ®Šã€‚å¯ä»¥çœ‹åˆ°è¿™é‡Œæ²¡æœ‰ä»»ä½•ä»£ç ï¼Œåªæœ‰ä¸€ä¸ªrpcçš„é…ç½®æ–‡ä»¶ã€‚é€šå¸¸è¿™ä¸ªæ¨¡å—æ˜¯ç”¨äºç»™æˆ‘ä»¬å†…éƒ¨é¡¹ç›®è¿›è¡Œä¾èµ–çš„ï¼Œå¹¶ä¸åƒä¸Šé¢çš„APIæ¨¡å—ä¸€æ ·ç»™å…¶ä»–éƒ¨é—¨æˆ–è€…æ˜¯é¡¹ç›®è¿›è¡Œä¾èµ–çš„ã€‚ å› ä¸ºåœ¨æˆ‘ä»¬çš„RPCè°ƒç”¨çš„æ—¶å€™ï¼Œç”¨dubboæ¥ä¸¾ä¾‹ï¼Œæ˜¯éœ€è¦é…ç½®æ‰€ä¾èµ–çš„consumerã€‚ ä½†å¦‚æœæ˜¯æˆ‘ä»¬è‡ªå·±å†…éƒ¨è°ƒç”¨çš„è¯æˆ‘ä»¬å°±å¯ä»¥æŠŠéœ€è¦è°ƒç”¨è‡ªå·±çš„dubboæœåŠ¡æä¾›è€…é…ç½®åœ¨è¿™é‡Œï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬è‡ªå·±è°ƒç”¨å°±åªéœ€è¦ä¾èµ–è¿™ä¸ªBOOTå°±å¯ä»¥è¿›è¡Œè°ƒç”¨äº†ã€‚ å“¦å¯¹äº†ï¼ŒBOOTåŒæ—¶è¿˜ä¼šä¾èµ–APIï¼Œè¿™æ ·æ‰å®ç°äº†åªä¾èµ–BOOTå°±å¯ä»¥è°ƒç”¨è‡ªå·±å†…éƒ¨çš„dubboæœåŠ¡äº†ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š12345678910111213&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;SSM-API&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; SSM-SERVICESERVICEæ¨¡å—å°±æ¯”è¾ƒå¥½ç†è§£äº†ã€‚æ˜¯å¤„ç†å…·ä½“ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯å¯¹ä¹‹å‰çš„APIçš„å®ç°ã€‚ é€šå¸¸è¿™ä¹Ÿæ˜¯ä¸€ä¸ªwebæ¨¡å—ï¼Œæ‰€ä»¥æˆ‘çš„pomç±»å‹æ˜¯WARã€‚ SSM-WEBå…¶å®WEBæ¨¡å—å’ŒSERVICEæ¨¡å—æœ‰ç‚¹é‡åˆäº†ã€‚é€šå¸¸æ¥è¯´è¿™ä¸ªæ¨¡å—ä¸€èˆ¬åœ¨ä¸€ä¸ªå¯¹å¤–æä¾›httpè®¿é—®æ¥å£çš„é¡¹ç›®ä¸­ã€‚ è¿™é‡Œåªæ˜¯ä¸ºäº†å±•ç¤ºé¡¹ç›®ç»“æ„ï¼Œæ‰€ä»¥ä¹Ÿå†™åœ¨äº†è¿™é‡Œã€‚ ä»–çš„ä½œç”¨å’Œserviceå·®ä¸å¤šï¼Œéƒ½æ˜¯WARçš„ç±»å‹ã€‚ æ€»ç»“è¿™æ¬¡æ²¡æœ‰å®ç°ä»€ä¹ˆç‰¹åˆ«çš„åŠŸèƒ½ï¼Œåªæ˜¯å¯¹ä¸€äº›è¿˜æ²¡æœ‰æ¥è§¦è¿‡è¿™ç§é¡¹ç›®ç»“æ„å¼€å‘çš„ç«¥é‹èƒ½èµ·åˆ°ä¸€äº›å¼•å¯¼ä½œç”¨ã€‚ å…·ä½“æºç è¿˜è¯·å…³æ³¨æˆ‘çš„githubã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚ GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Maven</tag>
        <tag>é‡æ„</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(ä¹) åå°„çš„å®é™…åº”ç”¨ - æ„å»ºæ—¥å¿—å¯¹è±¡]]></title>
    <url>%2F2017%2F01%2F19%2FSSM9%2F</url>
    <content type="text"><![CDATA[å‰è¨€ç›¸ä¿¡åšJavaçš„ç«¥é‹æˆ–å¤šæˆ–å°‘éƒ½å¬è¿‡åå°„ï¼Œè¿™ä¹Ÿåº”è¯¥æ˜¯Javaä»å…¥é—¨åˆ°è¿›é˜¶çš„å¿…ç»ä¹‹è·¯ã€‚ ä½†æ˜¯åœ¨æˆ‘ä»¬çš„å®é™…å¼€å‘ä¸­ç›´æ¥ä½¿ç”¨å®ƒä»¬çš„å‡ ç‡è²Œä¼¼è¿˜æ˜¯æ¯”è¾ƒå°‘çš„ï¼Œï¼ˆé™¤äº†é€ è½®å­æˆ–è€…æ˜¯Spring Mybatisè¿™äº›æ¡†æ¶å¤–ï¼‰ã€‚ æ‰€ä»¥è¿™é‡Œä»‹ç»ä¸€ä¸ªåœ¨å®é™…å¼€å‘ä¸­è¿˜æ˜¯å°æœ‰ç”¨å¤„çš„åå°„å®ä¾‹ã€‚ ä¼ ç»Ÿæ—¥å¿—æœ‰å…³åå°„çš„ä¸€äº›åŸºæœ¬çŸ¥è¯†å°±ä¸è¯´äº†ï¼Œå¯ä»¥è‡ªè¡ŒGoogleï¼Œä¹Ÿå¯ä»¥çœ‹ä¸‹åå°„å…¥é—¨ã€‚ æ—¥å¿—ç›¸ä¿¡å¤§å®¶éƒ½ä¸é™Œç”Ÿï¼Œåœ¨å®é™…å¼€å‘ä¸­ä¸€äº›æ¯”è¾ƒæ•æ„Ÿçš„æ•°æ®è¡¨æˆ‘ä»¬éœ€è¦å¯¹å®ƒçš„æ¯ä¸€æ¬¡æ“ä½œéƒ½è®°å½•ä¸‹æ¥ã€‚ å…ˆæ¥çœ‹çœ‹ä¼ ç»Ÿçš„å†™æ³•ï¼š1234567891011121314@Testpublic void insertSelective() throws Exception &#123; Content content = new Content() ; content.setContent("asdsf"); content.setCreatedate("2016-12-09"); contentService.insertSelective(content) ; ContentLog log = new ContentLog(); log.setContentid(content.getContentid()); log.setContent("asdsf"); log.setCreatedate("2016-12-09"); contentLogService.insertSelective(log);&#125; éå¸¸ç®€å•ï¼Œå°±æ˜¯åœ¨ä¿å­˜å®Œæ•°æ®è¡¨ä¹‹åå†æŠŠç›¸åŒçš„æ•°æ®ä¿å­˜åˆ°æ—¥å¿—è¡¨ä¸­ã€‚ä½†æ˜¯è¿™æ ·æœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š å¦‚æœæ•°æ®è¡¨çš„å­—æ®µè¾ƒå¤šçš„è¯ï¼Œæ¯”å¦‚å‡ ç™¾ä¸ªã€‚é‚£ä¹ˆæ—¥å¿—è¡¨çš„setter()æ–¹æ³•å°±å¾—å†™å‡ ç™¾æ¬¡ï¼Œè¿˜å¾—æ˜¯éƒ½å†™å¯¹çš„æƒ…å†µä¸‹ã€‚ å¦‚æœå“ªå¤©æ•°æ®è¡¨çš„å­—æ®µå‘ç”Ÿäº†å¢åŠ ï¼Œé‚£ä¹ˆæ¯ä¸ªå†™æ—¥å¿—çš„åœ°æ–¹éƒ½å¾—å¢åŠ è¯¥å­—æ®µï¼Œæé«˜äº†ç»´æŠ¤çš„æˆæœ¬ã€‚ é’ˆå¯¹ä»¥ä¸Šçš„æƒ…å†µå°±å¾—éœ€è¦åå°„è¿™ä¸ªä¸»è§’æ¥è§£å†³äº†ã€‚ åˆ©ç”¨åå°„æ„å»ºæ—¥å¿—æˆ‘ä»¬å…ˆæ¥å…ˆæ¥çœ‹ä¸‹ä½¿ç”¨åå°„ä¹‹åå¯¹ä»£ç æ‰€å¸¦æ¥çš„æ”¹å˜ï¼š12345678910111213@Testpublic void insertSelective2() throws Exception &#123; Content content = new Content(); content.setContent("ä½ å¥½"); content.setContentname("1"); content.setCreatedate("2016-09-23"); contentService.insertSelective(content); ContentLog log = new ContentLog(); CommonUtil.setLogValueModelToModel(content, log); contentLogService.insertSelective(log);&#125; åŒæ ·çš„ä¿å­˜æ—¥å¿—ï¼Œä¸ç®¡å¤šå°‘å­—æ®µï¼Œåªéœ€è¦ä¸‰è¡Œä»£ç å³å¯è§£å†³ã€‚è€Œä¸”å°±ç®—ä¹‹åå­—æ®µå‘ç”Ÿæ”¹å˜å†™æ—¥å¿—è¿™æ®µä»£ç ä»ç„¶ä¸éœ€è¦æ”¹åŠ¨ã€‚ å…¶å®è¿™é‡Œæœ€ä¸»è¦çš„ä¸€ä¸ªæ–¹æ³•å°±æ˜¯CommonUtil.setLogValueModelToModel(content, log); æ¥çœ‹ä¸‹æ˜¯å¦‚ä½•å®ç°çš„;12345678910111213141516171819202122232425262728293031323334353637/** * ç”Ÿæˆæ—¥å¿—å®ä½“å·¥å…· * * @param objectFrom * @param objectTo */ public static void setLogValueModelToModel(Object objectFrom, Object objectTo) &#123; Class&lt;? extends Object&gt; clazzFrom = objectFrom.getClass(); Class&lt;? extends Object&gt; clazzTo = objectTo.getClass(); for (Method toSetMethod : clazzTo.getMethods()) &#123; String mName = toSetMethod.getName(); if (mName.startsWith("set")) &#123; //å­—æ®µå String field = mName.substring(3); //è·å–from å€¼ Object value; try &#123; if ("LogId".equals(field)) &#123; continue; &#125; Method fromGetMethod = clazzFrom.getMethod("get" + field); value = fromGetMethod.invoke(objectFrom); //è®¾ç½®å€¼ toSetMethod.invoke(objectTo, value); &#125; catch (NoSuchMethodException e) &#123; throw new RuntimeException(e); &#125; catch (InvocationTargetException e) &#123; throw new RuntimeException(e); &#125; catch (IllegalAccessException e) &#123; throw new RuntimeException(e); &#125; &#125; &#125; &#125; å†ä½¿ç”¨ä¹‹å‰æˆ‘ä»¬é¦–å…ˆéœ€è¦æ„å»ºå¥½ä¸»çš„æ•°æ®è¡¨ï¼Œç„¶ånewä¸€ä¸ªæ—¥å¿—è¡¨çš„å¯¹è±¡ã€‚ åœ¨setLogValueModelToModel()æ–¹æ³•ä¸­ï¼š åˆ†åˆ«è·å¾—æ•°æ®è¡¨å’Œæ—¥å¿—è¡¨å¯¹è±¡çš„ç±»ç±»å‹ã€‚ è·å–åˆ°æ—¥å¿—å¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•é›†åˆã€‚ éå†è¯¥é›†åˆï¼Œå¹¶æ‹¿åˆ°è¯¥æ–¹æ³•çš„åç§°ã€‚ åªå–å…¶ä¸­setå¼€å¤´çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯setæ–¹æ³•ã€‚å› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨å¾ªç¯ä¸­ä¸ºæ—¥å¿—å¯¹è±¡çš„æ¯ä¸€ä¸ªå­—æ®µèµ‹å€¼ã€‚ ä¹‹åæˆªå–æ–¹æ³•åç§°è·å¾—å…·ä½“çš„å­—æ®µåç§°ã€‚ ç”¨ä¹‹å‰æˆªå–çš„å­—æ®µåç§°ï¼Œé€šè¿‡getMethod()æ–¹æ³•è¿”å›æ•°æ®è¡¨ä¸­çš„è¯¥å­—æ®µçš„getteræ–¹æ³•ã€‚ ç›¸å½“äºæ‰§è¡Œäº†String content = content.getContent(); æ‰§è¡Œè¯¥æ–¹æ³•è·å¾—è¯¥å­—æ®µå…·ä½“çš„å€¼ã€‚ åˆ©ç”¨å½“å‰å¾ªç¯çš„setteræ–¹æ³•ä¸ºæ—¥å¿—å¯¹è±¡çš„æ¯ä¸€ä¸ªå­—æ®µèµ‹å€¼ã€‚ ç›¸å½“äºæ‰§è¡Œäº†log.setContent(&quot;asdsf&quot;); å…¶ä¸­å­—æ®µåç§°ä¸ºLogIdæ—¶è·³å‡ºäº†å½“å‰å¾ªç¯ï¼Œå› ä¸ºLogIdæ˜¯æ—¥å¿—è¡¨çš„ä¸»é”®ï¼Œæ˜¯ä¸éœ€è¦èµ‹å€¼çš„ã€‚ å½“å¾ªç¯ç»“æŸæ—¶ï¼Œæ—¥å¿—å¯¹è±¡ä¹Ÿå°±æ„å»ºå®Œæˆäº†ã€‚ä¹‹ååªéœ€è¦ä¿å­˜åˆ°æ•°æ®åº“ä¸­å³å¯ã€‚ æ€»ç»“åå°„å…¶å®æ˜¯éå¸¸è€—èµ„æºçš„ï¼Œå†ä½¿ç”¨è¿‡ç¨‹ä¸­è¿˜æ˜¯è¦æ…ç”¨ã€‚å…¶ä¸­å¯¹methodã€fieldã€constructorç­‰å¯¹è±¡åšç¼“å­˜ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚ GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Reflect</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(å…«)åŠ¨æ€åˆ‡æ¢æ•°æ®æº]]></title>
    <url>%2F2017%2F01%2F05%2FSSM8%2F</url>
    <content type="text"><![CDATA[å‰è¨€ åœ¨ç°åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­åº”è¯¥å¤§å¤šæ•°æœ‹å‹éƒ½æœ‰é‡åˆ°è¿‡åˆ‡æ¢æ•°æ®æºçš„éœ€æ±‚ã€‚æ¯”å¦‚ç°åœ¨å¸¸ç”¨çš„æ•°æ®åº“è¯»å†™åˆ†ç¦»ï¼Œæˆ–è€…å°±æ˜¯æœ‰ä¸¤ä¸ªæ•°æ®åº“çš„æƒ…å†µï¼Œè¿™äº›éƒ½éœ€è¦ç”¨åˆ°åˆ‡æ¢æ•°æ®æºã€‚ æ‰‹åŠ¨åˆ‡æ¢æ•°æ®æºä½¿ç”¨Springçš„AbstractRoutingDataSourceç±»æ¥è¿›è¡Œæ‹“å±•å¤šæ•°æ®æºã€‚ è¯¥ç±»å°±ç›¸å½“äºä¸€ä¸ªdataSourceçš„è·¯ç”±ï¼Œç”¨äºæ ¹æ®keyå€¼æ¥è¿›è¡Œåˆ‡æ¢å¯¹åº”çš„dataSourceã€‚ ä¸‹é¢ç®€å•æ¥çœ‹ä¸‹AbstractRoutingDataSourceç±»çš„å‡ æ®µå…³é”®æºç ï¼š123456789101112131415161718192021222324252627282930313233343536373839@Overridepublic Connection getConnection() throws SQLException &#123; return determineTargetDataSource().getConnection();&#125;@Overridepublic Connection getConnection(String username, String password) throws SQLException &#123; return determineTargetDataSource().getConnection(username, password);&#125;/** * Retrieve the current target DataSource. Determines the * &#123;@link #determineCurrentLookupKey() current lookup key&#125;, performs * a lookup in the &#123;@link #setTargetDataSources targetDataSources&#125; map, * falls back to the specified * &#123;@link #setDefaultTargetDataSource default target DataSource&#125; if necessary. * @see #determineCurrentLookupKey() */protected DataSource determineTargetDataSource() &#123; Assert.notNull(this.resolvedDataSources, "DataSource router not initialized"); Object lookupKey = determineCurrentLookupKey(); DataSource dataSource = this.resolvedDataSources.get(lookupKey); if (dataSource == null &amp;&amp; (this.lenientFallback || lookupKey == null)) &#123; dataSource = this.resolvedDefaultDataSource; &#125; if (dataSource == null) &#123; throw new IllegalStateException("Cannot determine target DataSource for lookup key [" + lookupKey + "]"); &#125; return dataSource;&#125;/** * Determine the current lookup key. This will typically be * implemented to check a thread-bound transaction context. * &lt;p&gt;Allows for arbitrary keys. The returned key needs * to match the stored lookup key type, as resolved by the * &#123;@link #resolveSpecifiedLookupKey&#125; method. */protected abstract Object determineCurrentLookupKey(); å¯ä»¥çœ‹åˆ°å…¶ä¸­è·å–é“¾æ¥çš„æ–¹æ³•getConnection()è°ƒç”¨çš„determineTargetDataSourceåˆ™æ˜¯å…³é”®æ–¹æ³•ã€‚è¯¥æ–¹æ³•ç”¨äºè¿”å›æˆ‘ä»¬ä½¿ç”¨çš„æ•°æ®æºã€‚ å…¶ä¸­å‘¢åˆæ˜¯determineCurrentLookupKey()æ–¹æ³•æ¥è¿”å›å½“å‰æ•°æ®æºçš„keyå€¼ã€‚ä¹‹åé€šè¿‡è¯¥keyå€¼åœ¨resolvedDataSourcesè¿™ä¸ªmapä¸­æ‰¾åˆ°å¯¹åº”çš„value(è¯¥valueå°±æ˜¯æ•°æ®æº)ã€‚ resolvedDataSourcesè¿™ä¸ªmapåˆ™æ˜¯åœ¨ï¼š123456789101112131415@Overridepublic void afterPropertiesSet() &#123; if (this.targetDataSources == null) &#123; throw new IllegalArgumentException("Property 'targetDataSources' is required"); &#125; this.resolvedDataSources = new HashMap&lt;Object, DataSource&gt;(this.targetDataSources.size()); for (Map.Entry&lt;Object, Object&gt; entry : this.targetDataSources.entrySet()) &#123; Object lookupKey = resolveSpecifiedLookupKey(entry.getKey()); DataSource dataSource = resolveSpecifiedDataSource(entry.getValue()); this.resolvedDataSources.put(lookupKey, dataSource); &#125; if (this.defaultTargetDataSource != null) &#123; this.resolvedDefaultDataSource = resolveSpecifiedDataSource(this.defaultTargetDataSource); &#125;&#125; è¿™ä¸ªæ–¹æ³•é€šè¿‡targetDataSourcesè¿™ä¸ªmapæ¥è¿›è¡Œèµ‹å€¼çš„ã€‚targetDataSourcesåˆ™æ˜¯æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œèµ‹å€¼çš„ï¼Œä¸‹é¢ä¼šè®²åˆ°ã€‚ å†æ¥çœ‹çœ‹determineCurrentLookupKey()æ–¹æ³•ï¼Œä»protectedæ¥ä¿®é¥°å°±å¯ä»¥çœ‹å‡ºæ˜¯éœ€è¦æˆ‘ä»¬æ¥è¿›è¡Œé‡å†™çš„ã€‚ DynamicDataSource å’Œ DataSourceHolderäºæ˜¯æˆ‘æ–°å¢äº†DynamicDataSourceç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š1234567891011121314151617package com.crossoverJie.util;import org.springframework.jdbc.datasource.lookup.AbstractRoutingDataSource;/** * Function: * * @author chenjiec * Date: 2017/1/2 ä¸Šåˆ12:22 * @since JDK 1.7 */public class DynamicDataSource extends AbstractRoutingDataSource &#123; @Override protected Object determineCurrentLookupKey() &#123; return DataSourceHolder.getDataSources(); &#125;&#125; ä»£ç å¾ˆç®€å•ï¼Œç»§æ‰¿äº†AbstractRoutingDataSourceç±»å¹¶é‡å†™äº†å…¶ä¸­çš„determineCurrentLookupKey()æ–¹æ³•ã€‚ è¿™é‡Œç›´æ¥ç”¨DataSourceHolderè¿”å›äº†ä¸€ä¸ªæ•°æ®æºã€‚ DataSourceHolderä»£ç å¦‚ä¸‹ï¼š1234567891011121314151617181920package com.crossoverJie.util;/** * Function:åŠ¨æ€æ•°æ®æº * * @author chenjiec * Date: 2017/1/2 ä¸Šåˆ12:19 * @since JDK 1.7 */public class DataSourceHolder &#123; private static final ThreadLocal&lt;String&gt; dataSources = new ThreadLocal&lt;String&gt;(); public static void setDataSources(String dataSource) &#123; dataSources.set(dataSource); &#125; public static String getDataSources() &#123; return dataSources.get(); &#125;&#125; è¿™é‡Œæˆ‘ä½¿ç”¨äº†ThreadLocalæ¥ä¿å­˜äº†æ•°æ®æºï¼Œå…³äºThreadLocalçš„çŸ¥è¯†ç‚¹å¯ä»¥æŸ¥çœ‹ä»¥ä¸‹è¿™ç¯‡æ–‡ç« ï¼šè§£å¯†ThreadLocal ä¹‹ååœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®æˆ‘ä»¬çš„æ•°æ®æºï¼Œå°±æ˜¯ä¸Šæ–‡è®²åˆ°çš„ä¸ºtargetDataSourcesèµ‹å€¼ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566&lt;bean id="ssm1DataSource" class="com.alibaba.druid.pool.DruidDataSource" init-method="init" destroy-method="close"&gt; &lt;!-- æŒ‡å®šè¿æ¥æ•°æ®åº“çš„é©±åŠ¨ --&gt; &lt;property name="driverClassName" value="$&#123;jdbc.driverClass&#125;" /&gt; &lt;property name="url" value="$&#123;jdbc.url&#125;" /&gt; &lt;property name="username" value="$&#123;jdbc.user&#125;" /&gt; &lt;property name="password" value="$&#123;jdbc.password&#125;" /&gt; &lt;!-- é…ç½®åˆå§‹åŒ–å¤§å°ã€æœ€å°ã€æœ€å¤§ --&gt; &lt;property name="initialSize" value="3" /&gt; &lt;property name="minIdle" value="3" /&gt; &lt;property name="maxActive" value="20" /&gt; &lt;!-- é…ç½®è·å–è¿æ¥ç­‰å¾…è¶…æ—¶çš„æ—¶é—´ --&gt; &lt;property name="maxWait" value="60000" /&gt; &lt;!-- é…ç½®é—´éš”å¤šä¹…æ‰è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œæ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿æ¥ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt; &lt;property name="timeBetweenEvictionRunsMillis" value="60000" /&gt; &lt;!-- é…ç½®ä¸€ä¸ªè¿æ¥åœ¨æ± ä¸­æœ€å°ç”Ÿå­˜çš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt; &lt;property name="minEvictableIdleTimeMillis" value="300000" /&gt; &lt;property name="validationQuery" value="SELECT 'x'" /&gt; &lt;property name="testWhileIdle" value="true" /&gt; &lt;property name="testOnBorrow" value="false" /&gt; &lt;property name="testOnReturn" value="false" /&gt; &lt;!-- æ‰“å¼€PSCacheï¼Œå¹¶ä¸”æŒ‡å®šæ¯ä¸ªè¿æ¥ä¸ŠPSCacheçš„å¤§å° --&gt; &lt;property name="poolPreparedStatements" value="true" /&gt; &lt;property name="maxPoolPreparedStatementPerConnectionSize" value="20" /&gt; &lt;!-- é…ç½®ç›‘æ§ç»Ÿè®¡æ‹¦æˆªçš„filtersï¼Œå»æ‰åç›‘æ§ç•Œé¢sqlæ— æ³•ç»Ÿè®¡ --&gt; &lt;property name="filters" value="stat" /&gt; &lt;/bean&gt; &lt;bean id="ssm2DataSource" class="com.alibaba.druid.pool.DruidDataSource" init-method="init" destroy-method="close"&gt; &lt;!-- æŒ‡å®šè¿æ¥æ•°æ®åº“çš„é©±åŠ¨ --&gt; &lt;property name="driverClassName" value="$&#123;jdbc.driverClass&#125;"/&gt; &lt;property name="url" value="$&#123;jdbc.url2&#125;"/&gt; &lt;property name="username" value="$&#123;jdbc.user2&#125;"/&gt; &lt;property name="password" value="$&#123;jdbc.password2&#125;"/&gt; &lt;property name="initialSize" value="3"/&gt; &lt;property name="minIdle" value="3"/&gt; &lt;property name="maxActive" value="20"/&gt; &lt;!-- é…ç½®è·å–è¿æ¥ç­‰å¾…è¶…æ—¶çš„æ—¶é—´ --&gt; &lt;property name="maxWait" value="60000"/&gt; &lt;!-- é…ç½®é—´éš”å¤šä¹…æ‰è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œæ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿æ¥ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt; &lt;property name="timeBetweenEvictionRunsMillis" value="60000"/&gt; &lt;!-- é…ç½®ä¸€ä¸ªè¿æ¥åœ¨æ± ä¸­æœ€å°ç”Ÿå­˜çš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt; &lt;property name="minEvictableIdleTimeMillis" value="300000"/&gt; &lt;property name="validationQuery" value="SELECT 'x'"/&gt; &lt;property name="testWhileIdle" value="true"/&gt; &lt;property name="testOnBorrow" value="false"/&gt; &lt;property name="testOnReturn" value="false"/&gt; &lt;!-- æ‰“å¼€PSCacheï¼Œå¹¶ä¸”æŒ‡å®šæ¯ä¸ªè¿æ¥ä¸ŠPSCacheçš„å¤§å° --&gt; &lt;property name="poolPreparedStatements" value="true"/&gt; &lt;property name="maxPoolPreparedStatementPerConnectionSize" value="20"/&gt; &lt;!-- é…ç½®ç›‘æ§ç»Ÿè®¡æ‹¦æˆªçš„filtersï¼Œå»æ‰åç›‘æ§ç•Œé¢sqlæ— æ³•ç»Ÿè®¡ --&gt; &lt;property name="filters" value="stat"/&gt; &lt;/bean&gt; &lt;bean id="dataSource" class="com.crossoverJie.util.DynamicDataSource"&gt; &lt;property name="targetDataSources"&gt; &lt;map key-type="java.lang.String"&gt; &lt;entry key="ssm1DataSource" value-ref="ssm1DataSource"/&gt; &lt;entry key="ssm2DataSource" value-ref="ssm2DataSource"/&gt; &lt;/map&gt; &lt;/property&gt; &lt;!--é»˜è®¤æ•°æ®æº--&gt; &lt;property name="defaultTargetDataSource" ref="ssm1DataSource"/&gt; &lt;/bean&gt; è¿™é‡Œåˆ†åˆ«é…ç½®äº†ä¸¤ä¸ªæ•°æ®æºï¼šssm1DataSourceå’Œssm2DataSourceã€‚ä¹‹åå†é€šè¿‡Springçš„ä¾èµ–æ³¨å…¥æ–¹å¼å°†ä¸¤ä¸ªæ•°æ®æºè®¾ç½®è¿›targetDataSourcesã€‚ æ¥ä¸‹æ¥çš„ç”¨æ³•ç›¸æ¯”å¤§å®¶ä¹Ÿåº”è¯¥çŒœåˆ°äº†ã€‚ å°±æ˜¯åœ¨æ¯æ¬¡è°ƒç”¨æ•°æ®åº“ä¹‹å‰æˆ‘ä»¬éƒ½è¦å…ˆé€šè¿‡DataSourceHolderæ¥è®¾ç½®å½“å‰çš„æ•°æ®æºã€‚çœ‹ä¸‹demoï¼š123456@Testpublic void selectByPrimaryKey() throws Exception &#123; DataSourceHolder.setDataSources(Constants.DATASOURCE_TWO); Datasource datasource = dataSourceService.selectByPrimaryKey(7); System.out.println(JSON.toJSONString(datasource));&#125; è¯¦è§æˆ‘çš„å•æµ‹ã€‚ ä½¿ç”¨èµ·æ¥ä¹Ÿæ˜¯éå¸¸ç®€å•ã€‚ä½†æ˜¯ä¸çŸ¥é“å¤§å®¶æ³¨æ„åˆ°æ²¡æœ‰ï¼Œè¿™æ ·çš„åšæ³•æ§½ç‚¹å¾ˆå¤šï¼š æ¯æ¬¡ä½¿ç”¨éœ€è¦æ‰‹åŠ¨åˆ‡æ¢ï¼Œæ€»æœ‰ä¸€äº›äººä¼šå¿˜è®°å†™(æ¯”å¦‚æˆ‘)ã€‚ å¦‚æœæ˜¯åæœŸéœ€æ±‚å˜äº†ï¼ŒæŸ¥è¯¢å…¶ä»–çš„è¡¨äº†è¿˜å¾—ä¸€ä¸ªä¸ªæ”¹å›æ¥ã€‚ é‚£æœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥è‡ªåŠ¨çš„å¸®æˆ‘ä»¬åˆ‡æ¢å‘¢ï¼Ÿ è‚¯å®šæ˜¯æœ‰çš„ï¼Œå¤§å®¶åº”è¯¥ä¹Ÿæƒ³å¾—åˆ°ã€‚å°±æ˜¯åˆ©ç”¨Springçš„AOPäº†ã€‚ è‡ªåŠ¨åˆ‡æ¢æ•°æ®æºé¦–å…ˆè¦å®šä¹‰å¥½æˆ‘ä»¬çš„åˆ‡é¢ç±»DataSourceExchange:1234567891011121314151617181920212223242526272829303132333435363738394041package com.crossoverJie.util;import org.aspectj.lang.JoinPoint;/** * Function:æ‹¦æˆªå™¨æ–¹æ³• * * @author chenjiec * Date: 2017/1/3 ä¸Šåˆ12:34 * @since JDK 1.7 */public class DataSourceExchange &#123; /** * * @param point */ public void before(JoinPoint point) &#123; //è·å–ç›®æ ‡å¯¹è±¡çš„ç±»ç±»å‹ Class&lt;?&gt; aClass = point.getTarget().getClass(); //è·å–åŒ…åç”¨äºåŒºåˆ†ä¸åŒæ•°æ®æº String whichDataSource = aClass.getName().substring(25, aClass.getName().lastIndexOf(".")); if ("ssmone".equals(whichDataSource)) &#123; DataSourceHolder.setDataSources(Constants.DATASOURCE_ONE); &#125; else &#123; DataSourceHolder.setDataSources(Constants.DATASOURCE_TWO); &#125; &#125; /** * æ‰§è¡Œåå°†æ•°æ®æºç½®ä¸ºç©º */ public void after() &#123; DataSourceHolder.setDataSources(null); &#125;&#125; é€»è¾‘ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åœ¨æ‰§è¡Œæ•°æ®åº“æ“ä½œä¹‹å‰åšä¸€ä¸ªåˆ‡é¢ã€‚ é€šè¿‡JoinPointå¯¹è±¡è·å–ç›®æ ‡å¯¹è±¡ã€‚ åœ¨ç›®æ ‡å¯¹è±¡ä¸­è·å–åŒ…åæ¥åŒºåˆ†ä¸åŒçš„æ•°æ®æºã€‚ æ ¹æ®ä¸åŒæ•°æ®æºæ¥è¿›è¡Œèµ‹å€¼ã€‚ æ‰§è¡Œå®Œæ¯•ä¹‹åå°†æ•°æ®æºæ¸…ç©ºã€‚ å…³äºä¸€äº›JoinPointçš„APIï¼š1234567891011121314package org.aspectj.lang;import org.aspectj.lang.reflect.SourceLocation;public interface JoinPoint &#123; String toString(); //è¿æ¥ç‚¹æ‰€åœ¨ä½ç½®çš„ç›¸å…³ä¿¡æ¯ String toShortString(); //è¿æ¥ç‚¹æ‰€åœ¨ä½ç½®çš„ç®€çŸ­ç›¸å…³ä¿¡æ¯ String toLongString(); //è¿æ¥ç‚¹æ‰€åœ¨ä½ç½®çš„å…¨éƒ¨ç›¸å…³ä¿¡æ¯ Object getThis(); //è¿”å›AOPä»£ç†å¯¹è±¡ Object getTarget(); //è¿”å›ç›®æ ‡å¯¹è±¡ Object[] getArgs(); //è¿”å›è¢«é€šçŸ¥æ–¹æ³•å‚æ•°åˆ—è¡¨ Signature getSignature(); //è¿”å›å½“å‰è¿æ¥ç‚¹ç­¾å SourceLocation getSourceLocation();//è¿”å›è¿æ¥ç‚¹æ–¹æ³•æ‰€åœ¨ç±»æ–‡ä»¶ä¸­çš„ä½ç½® String getKind(); //è¿æ¥ç‚¹ç±»å‹ StaticPart getStaticPart(); //è¿”å›è¿æ¥ç‚¹é™æ€éƒ¨åˆ†&#125; ä¸ºäº†é€šè¿‡åŒ…åæ¥åŒºåˆ†ä¸åŒæ•°æ®æºï¼Œæˆ‘å°†ç›®å½•ç»“æ„ç¨å¾®è°ƒæ•´äº†ä¸‹ï¼š å°†ä¸¤ä¸ªä¸åŒçš„æ•°æ®æºçš„å®ç°ç±»æ”¾åˆ°ä¸åŒçš„åŒ…ä¸­ï¼Œè¿™æ ·ä»Šåå¦‚æœè¿˜éœ€è¦æ–°å¢å…¶ä»–æ•°æ®æºä¹Ÿå¯ä»¥çµæ´»çš„åˆ‡æ¢ã€‚ çœ‹ä¸‹Springçš„é…ç½®ï¼š123456789101112131415161718192021&lt;bean id="dataSourceExchange" class="com.crossoverJie.util.DataSourceExchange"/&gt;&lt;!--é…ç½®åˆ‡é¢æ‹¦æˆªæ–¹æ³• --&gt;&lt;aop:config proxy-target-class="false"&gt; &lt;!--å°†com.crossoverJie.serviceåŒ…ä¸‹çš„æ‰€æœ‰selectå¼€å¤´çš„æ–¹æ³•åŠ å…¥æ‹¦æˆª å»æ‰selectåˆ™åŠ å…¥æ‰€æœ‰æ–¹æ³• --&gt; &lt;aop:pointcut id="controllerMethodPointcut" expression=" execution(* com.crossoverJie.service.*.select*(..))"/&gt; &lt;aop:pointcut id="selectMethodPointcut" expression=" execution(* com.crossoverJie.dao..*Mapper.select*(..))"/&gt; &lt;aop:advisor advice-ref="methodCacheInterceptor" pointcut-ref="controllerMethodPointcut"/&gt; &lt;!--æ‰€æœ‰æ•°æ®åº“æ“ä½œçš„æ–¹æ³•åŠ å…¥åˆ‡é¢--&gt; &lt;aop:aspect ref="dataSourceExchange"&gt; &lt;aop:pointcut id="dataSourcePointcut" expression="execution(* com.crossoverJie.service.*.*(..))"/&gt; &lt;aop:before pointcut-ref="dataSourcePointcut" method="before"/&gt; &lt;aop:after pointcut-ref="dataSourcePointcut" method="after"/&gt; &lt;/aop:aspect&gt;&lt;/aop:config&gt; è¿™æ˜¯åœ¨æˆ‘ä»¬ä¸Šä¸€ç¯‡æ•´åˆredisç¼“å­˜çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹çš„ã€‚è¿™æ ·ç¼“å­˜å’Œå¤šæ•°æ®æºéƒ½æ»¡è¶³äº†ã€‚ å®é™…ä½¿ç”¨ï¼š12345@Testpublic void selectByPrimaryKey() throws Exception &#123; Rediscontent rediscontent = rediscontentService.selectByPrimaryKey(30); System.out.println(JSON.toJSONString(rediscontent));&#125; è¿™æ ·çœ‹èµ·æ¥å°±å’Œä½¿ç”¨ä¸€ä¸ªæ•°æ®æºè¿™æ ·ç®€å•ï¼Œå†ä¹Ÿä¸ç”¨å…³å¿ƒåˆ‡æ¢çš„é—®é¢˜äº†ã€‚ æ€»ç»“ä¸è¿‡æŒ‰ç…§è¿™æ ·çš„å†™æ³•æ˜¯æ— æ³•åšåˆ°åœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œæ§åˆ¶ä¸¤ä¸ªæ•°æ®æºçš„ã€‚è¿™ä¸ªæˆ‘è¿˜åœ¨å­¦ä¹ ä¸­ï¼Œæœ‰ç›¸å…³ç»éªŒçš„å¤§ç‰›ä¸å¦¨æŒ‡ç‚¹ä¸€ä¸‹ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚ GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>AOP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[GoodBye 2016,Welcome 2017 | ç å†œç Œå¢™è®°]]></title>
    <url>%2F2016%2F12%2F31%2Fannual-summary%2FGoodBye%202016%2CWelcome%202017%20%7C%20%E7%A0%81%E5%86%9C%E7%A0%8C%E5%A2%99%E8%AE%B0%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æ—©åœ¨è¿™ä¸ªæœˆåˆçš„æ—¶å€™æˆ‘å°±å¾ˆæƒ³å†™ä¸€ç¯‡å¹´ç»ˆæ€»ç»“äº†ï¼Œå› ä¸ºè¿™ä¸€å¹´ç›¸å¯¹äºå»å¹´ç¡®å®æ˜¯ç»å†çš„å¤ªå¤šäº†ã€‚ç»“æœä¸€ç›´ç­‰åˆ°31å·ï¼Œåœ¨å®¶é‡Œå’Œåª³å¦‡åƒå®Œæ™šé¥­å°±é©¬ä¸Šæ‰“å¼€ç”µè„‘å¼€ç ã€‚ äº”æœˆäºŒåä¸‰-ç¬¬ä¸€æ¬¡è·³æ§½ æ ¹æ®æ•´å¹´çš„æ—¶é—´çº¿å¼€å§‹ç¬¬ä¸€ä»¶å¤§äº‹è‡ªç„¶å°±æ˜¯æ¢å…¬å¸äº†ã€‚ å…ˆæ¥ç‚¹å‰æ™¯æè¦:æˆ‘æ˜¯14å¹´11æœˆä»½å‚åŠ å·¥ä½œçš„ã€‚å½“æ—¶å…¶å®è¿˜æ²¡æœ‰æ¯•ä¸šå°±åœ¨ä¸€å®¶ç»™å¤§å‹ä¼ä¸šåšå®šåˆ¶è½¯ä»¶å¼€å‘çš„å…¬å¸å®ä¹ ã€‚åˆšå¼€å§‹å·¥ä½œçš„æ—¶å€™ä»€ä¹ˆäº‹æƒ…éƒ½è§‰å¾—éå¸¸æ–°å¥‡ï¼Œä¸€ä¸ªåœ¨å­¦æ ¡å­¦çš„ä¸œè¥¿èƒ½è¿ç”¨åˆ°å®é™…å¼€å‘ä¸­å¹¶èƒ½ç»™ç”¨æˆ·å¸¦æ¥ä¾¿åˆ©è®©æˆ‘è§‰å¾—åšç å†œçœŸæ˜¯ä¸€ä»¶éå¸¸æ­£ç¡®çš„é€‰æ‹©å•Š(pså½“æ—¶çœŸæ˜¯å¤ªå¹´è½»)ã€‚ åæ¥çœŸæ˜¯é€ åŒ–å¼„äººï¼Œå½“æ—¶è´Ÿè´£æˆ‘å‚ä¸çš„è¿™ä¸ªé¡¹ç›®çš„è´Ÿè´£äººè·³æ§½äº†ï¼Œæˆ‘è‡ªç„¶å°±æˆäº†æ•´ä¸ªå…¬å¸æœ€ç†Ÿæ‚‰æ­¤é¡¹ç›®çš„äººäº†ã€‚ç°åœ¨ä¸å¾—ä¸ä½©æœå…¬å¸è€æ¿çœŸæ˜¯å¿ƒå¤§å•Šï¼Œå±…ç„¶è®©ä¸€ä¸ªå®ä¹ ç”Ÿæ¥è´Ÿè´£è¿™ä¸ªé¡¹ç›®ã€‚å°±è¿™æ ·æˆ‘æˆäº†æ•´ä¸ªé¡¹ç›®çš„è´Ÿè´£äººï¼Œä»ä¹‹åçš„å¼€å‘åˆ°æµ‹è¯•åˆ°ä¸Šçº¿åˆ°åé¢çš„ç»´æŠ¤å‡ ä¹éƒ½æ˜¯æˆ‘ä¸€ä¸ªäººåœ¨è´Ÿè´£ã€‚æ¥ä¸€å¼ å½“æ—¶ä¸Šçº¿çš„æˆªå›¾ï¼š ç”±äºè¿™æ¬¡é¡¹ç›®çš„é¡ºåˆ©éªŒæ”¶ï¼Œå…¬å¸ä¹Ÿå¯¹æˆ‘è¶Šæ¥è¶Šä¿¡ä»»ã€‚ä¹‹åä¹Ÿå°±ç†æ‰€å½“ç„¶çš„åˆè´Ÿè´£äº†å‡ ä¸ªé¡¹ç›®ã€‚ è™½ç„¶ç¦»å¼€äº†ä½†çœŸçš„éå¸¸æ„Ÿè°¢å…¬å¸å½“æ—¶å¯¹ä¸€ä¸ªä»€ä¹ˆéƒ½ä¸æ‡‚çš„æ–°äººç»™äºˆä¿¡ä»»ã€‚ ä¹‹åéšç€æŠ€æœ¯çš„æå‡æˆ‘æ¥è§¦äº†githubã€vç«™è¿™æ ·çš„æŠ€æœ¯è®ºå›ï¼Œé€æ¸çš„å‘ç°å¤©å¤–æœ‰å¤©ï¼Œæˆ‘è¿™ç‚¹é›•è™«å°æŠ€çœŸçš„å®Œå…¨ä¸ç®—ä»€ä¹ˆï¼ŒçœŸæ­£æœºé‡ä¸æŒ‘æˆ˜å¹¶å­˜çš„åœ°æ–¹æ˜¯äº’è”ç½‘ã€‚ ä½†æ˜¯æ­¤æ—¶æˆ‘å·²ç»åœ¨è¿™å®¶å…¬å¸åšäº†ä¸€å¹´å¤šäº†ï¼Œçªç„¶ç¦»å¼€è¿™ä¸ªèˆ’é€‚åœˆæ¥åˆ°ä¸€ä¸ªé™Œç”Ÿçš„ç¯å¢ƒæ˜¯éœ€è¦å¾ˆå¤§å‹‡æ°”çš„ï¼Œæˆ–è€…è¯´éœ€è¦ä¸€ä¸ªåˆºæ¿€ç‚¹ã€‚ æ­£å¥½@å˜Ÿçˆ·æˆäº†è¿™ä¸ªå¯¼ç«ç´¢ã€‚é‚£ä¸ªæ—¶å€™æˆ‘æ­£åœ¨æ­æˆ‘çš„ä¸ªäººåšå®¢æ­£å¥½çœ‹åˆ°äº†ä»–çš„æ–‡ç« ï¼Œè§‰å¾—å†™å¾—éå¸¸å¥½ã€‚è€Œä¸”æ­£å¥½ä»–ä¹Ÿæ­£å‡†å¤‡è½¬å‘äº’è”ç½‘ï¼Œäºæ˜¯æˆ‘ç»™ä»–å†™äº†ä¸€å°å¾ˆé•¿çš„é‚®ä»¶è¯´äº†æˆ‘å¿ƒä¸­çš„ä¸€äº›ç–‘æƒ‘ä¸é¡¾è™‘è®©ä»–ç»™ç‚¹å»ºè®®ã€‚ åœ¨ä»–çš„å»ºè®®ä¹‹ä¸‹æˆ‘æ‰å¼€å§‹æŠ•é€’ç®€å†å‡†å¤‡æ¢ä¸€å®¶äº’è”ç½‘å…¬å¸ï¼Œæ„Ÿè°¢å˜Ÿçˆ·ç»™äº†æˆ‘ä¸€ä¸ªè¿™ä¹ˆæ­£ç¡®çš„å»ºè®®ã€‚ ä¹‹åæˆ‘é¡ºåˆ©çš„è¿›å…¥äº†ä¸€ä¸ªåˆ›ä¸šå…¬å¸ï¼Œå¼€å§‹äº†ç‹­ä¹‰çš„äº’è”ç½‘å¼€å‘é“è·¯ï¼Œä¸ºä»€ä¹ˆæ˜¯ç‹­ä¹‰è¯·æ¥ç€å¾€åçœ‹ã€‚ æ­å»ºä¸ªäººåšå®¢ æ­å»ºåšå®¢è¿™äº‹ä¹Ÿæ˜¯å¿…é¡»çš„æ‹¿å‡ºæ¥è¯´ä¸€è¯´çš„ã€‚ ä¸Šé¢è¯´åˆ°æˆ‘çœ‹äº†å˜Ÿçˆ·çš„åšå®¢æ‰å¼€å§‹æ­å»ºè‡ªå·±çš„åšå®¢ï¼Œåˆ°ç°åœ¨ä¸ºæ­¢ç”±äºæˆ‘çš„æ‹–å»¶ç—‡(åŠ ä¸Šæ˜¯çœŸçš„æ‡’)ä¸€å…±å†™äº†20ç¯‡ã€‚ä¸èƒ½è¯´å†™çš„æœ‰å¤šå¥½ï¼Œä½†ç¡®å®æ˜¯æˆ‘åœ¨å·¥ä½œå’Œå­¦ä¹ ä¸­çš„ä¸€äº›æ€»ç»“ã€‚ è®©æˆ‘æ„å¤–çš„æ˜¯æˆ‘åšå®¢çš„è®¿é—®é‡ï¼Œä¸‹å›¾æ˜¯æˆ‘cnzzçš„ç»Ÿè®¡æˆªå›¾ï¼š å…­æœˆäºŒåä¸€-å¼€æºé¡¹ç›®å…³äºå¼€æºé¡¹ç›®ï¼Œä¹‹å‰æˆ‘åœ¨githubä¸Šé¢çœ‹å¾ˆå¤šä¼˜ç§€çš„å¼€æºé¡¹ç›®ï¼Œä¹Ÿå¾ˆä½©æœé‚£äº›ä½œè€…ï¼Œäºæ˜¯å°±æƒ³ç€è‡ªå·±èƒ½ä¸èƒ½ä¹Ÿæä¸€ä¸ªï¼Œä½†æ˜¯ä¸€æ¥å°±é€ ä¸ªè½®å­å¯¹æˆ‘æ¥è¯´ç¡®å®æœ‰ç‚¹ä¸ç°å®ã€‚ äºæ˜¯æˆ‘æ¢äº†ä¸€ä¸ªæ€è·¯ï¼Œç”±äºç°åœ¨æˆ‘å‹‰å¼ºä¹Ÿä¸ç®—æ˜¯æ–°å…¥é—¨çš„èœé¸Ÿäº†ï¼Œä½†æˆ‘æ˜¯ä»èœé¸Ÿè¿‡æ¥çš„ï¼Œæ·±çŸ¥åˆšå¼€å§‹çš„æ—¶å€™æ‰¾èµ„æ–™çš„ç—›è‹¦ã€‚ä¸æ˜¯èµ„æ–™å¤ªè€å°±æ˜¯æ²¡æœ‰ä½“ç³»ï¼Œè®²ä¸€ç‚¹æ˜¯ä¸€ç‚¹çš„é‚£ç§ã€‚ äºæ˜¯å°±æœ‰äº†ç°åœ¨è¿™ä¸ªé¡¹ç›®:ä¼šä¸å®šæœŸæ›´æ–°ä¸€äº›åœ¨å®é™…å¼€å‘ä¸­ä½¿ç”¨çš„æŠ€å·§(ps:ç›®å‰ä¸æ˜¯å¾ˆå¿™åŸºæœ¬ä¸Šä¸€å‘¨ä¸€æ›´)ã€‚ æ²¡æœ‰å¤æ‚çš„ä¸šåŠ¡æµç¨‹ï¼Œæ›´ä¸æ˜¯XXXXç³»ç»Ÿï¼Œåªæœ‰ä¸€äº›æŠ€æœ¯çš„åˆ†äº«ã€‚ ä»å…­æœˆäºŒåä¸€å·åˆ°ç°åœ¨è¿˜æ˜¯æœ‰100å¤šé¢—æ˜Ÿäº†ï¼š ä¹æœˆäºŒåä¸‰-ç¬¬äºŒæ¬¡è·³æ§½çœ‹åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯è§‰å¾—æˆ‘æœ‰ç—…å•Šï¼Œæ€ä¹ˆåˆæ˜¯è·³æ§½ã€‚ã€‚ã€‚ å…¶å®æˆ‘ä¹Ÿä¸æƒ³ï¼Œæˆ‘åœ¨ä¸Šé¢è¯´åˆ°å¼€å§‹äº†æˆ‘çš„ç‹­ä¹‰äº’è”ç½‘å¼€å‘ï¼Œä¸ºä»€ä¹ˆæ˜¯ç‹­ä¹‰å‘¢ï¼Ÿ å› ä¸ºåšäº†ä¸€æ®µæ—¶é—´æ‰å‘ç°è¿™ä¸ªé¡¹ç›®é™¤äº†æ˜¯éƒ¨ç½²åœ¨äº‘æœåŠ¡å™¨ä¸Šå’Œæœ‰ä¸€ä¸ªå¾®ä¿¡ç«¯ä¹‹å¤–å’Œæˆ‘ä¹‹å‰æ‰€åšçš„é¡¹ç›®è²Œä¼¼æ²¡æœ‰æœ¬è´¨ä¸Šçš„åŒºåˆ«ï¼Œè¿˜æ˜¯ä¸€ä¸ªç®¡ç†ç³»ç»Ÿã€‚ è¿™é‡Œæˆ‘ä¸è¯„ä»·å…¬å¸çš„ä¸šåŠ¡ï¼Œä½†æ˜¯å…¬å¸çš„æŠ€æœ¯æ€»ç›‘åœ¨ä¿®æ”¹é—®é¢˜çš„æ—¶å€™æ˜¯ç›´æ¥åœ¨äº‘æœåŠ¡å™¨ä¸Šç™»é™†æ•°æ®åº“åˆ é™¤æ•°æ®ï¼Œä¼šä¸ä¼šè§‰å¾—å¾ˆå¥‡è‘©ã€‚æœ€å¥‡è‘©çš„æ˜¯åˆ é™¤çš„æ—¶å€™å¿˜äº†å†™whereæ¡ä»¶å¯¼è‡´æŠŠæ•´å¼ è¡¨çš„æ•°æ®éƒ½åˆ äº†ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæ˜¯ä½ ä½ ä¼šä¸ä¼šæ€€ç–‘é‚£å•¥ã€‚ã€‚ é™¤æ­¤ä¹‹å¤–æŠ€æœ¯æ€»ç›‘æœ¬äººè¿˜æ˜¯æŒºå¥½çš„ï¼Œä¸è¿‡æˆ‘æ›´è§‰å¾—ä»–é€‚åˆåšé”€å”®æ€»ç›‘ã€‚ åŠ ä¸Šåæ¥å…¬å¸çš„ä¸šåŠ¡æ²¡æœ‰å‘å±•èµ·æ¥ï¼Œæ‰€åšçš„ç³»ç»Ÿåˆè€æ˜¯å‡ºé—®é¢˜(è”æƒ³ä¸Šæ–‡)ï¼ŒåŠ ä¸Šè¿˜åœ¨æµä¼ æˆ‘ä»¬æŠ€æœ¯éƒ¨è¦è£äººã€‚é‚£æˆ‘è¿˜ä¸å¦‚è‡ªå·±èµ°(ç°åœ¨Vç«™é€›å¤šäº†çªç„¶è§‰å¾—å¥½äº)ã€‚ äºæ˜¯æˆ‘å¼€å§‹äº†æˆ‘çš„ç¬¬äºŒæ¬¡è·³æ§½ï¼Œå‰åæ—¶é—´æ‰é—´éš”4ä¸ªæœˆï¼Œä¸å¾—ä¸æ„Ÿæ…¨å‘½è¿å¼„äººå•Šã€‚ ä¹‹åæˆ‘æ¥åˆ°ç°åœ¨è¿™å®¶å‘˜å·¥5000ä½™äººçš„çœŸæ­£çš„äº’è”ç½‘å…¬å¸ï¼Œå¼€å§‹äº†çœŸæ­£æ„ä¹‰çš„äº’è”ç½‘å¼€å‘ã€‚è¿™é‡Œå¿…é¡»å¾—æ„Ÿè°¢æˆ‘çš„é¢è¯•å®˜ä¹Ÿæ˜¯æˆ‘ç°åœ¨è¿™ä¸ªé¡¹ç›®çš„leaderï¼Œç»™äº†æˆ‘è¿™ä¸ªäº’è”ç½‘èœé¸Ÿæœºä¼šã€‚ ä¸è¿‡å‘½è¿æ€»æ˜¯å¦‚æ­¤çš„ç›¸è¯†ï¼Œæ˜å¹´ä¹Ÿå°±æ˜¯ä¸‹å‘¨ä»–å°±æ¢éƒ¨é—¨äº†ï¼Œæ„å‘³ç€ç°åœ¨è¿™ä¸ªé¡¹ç›®æˆ‘åˆæˆè´Ÿè´£äººäº†ã€‚å¸Œæœ›ä¸€åˆ‡é¡ºåˆ©å§ã€‚ æŠ€æœ¯ç›¸å…³å‰é¢è¯´åˆ°æˆ‘æ˜¯ä¹æœˆä»½çš„æ—¶å€™æ‰è¿›å…¥è¿™å®¶æ­£çœŸæ„ä¹‰çš„äº’è”ç½‘å…¬å¸çš„ï¼Œæ‰€ä»¥ä½“æœ¯æå‡æœ€æ˜æ˜¾ä¹Ÿæ˜¯åœ¨è¿™æ®µæ—¶é—´ã€‚ è¿™æ®µæ—¶é—´æ‰€å­¦çš„èµ·ç æ˜¯æˆ‘åœ¨å‰é¢ä¸¤å®¶å…¬å¸ä¸€å¹´éƒ½å­¦ä¸åˆ°çš„ï¼Œè¿™é‡Œæˆ‘å¤§è‡´åˆ—äº†ä¸€ä¸‹ï¼š ç†Ÿæ‚‰äº†ä¸€ä¸ªäº’è”ç½‘äº§å“çš„ç”Ÿå‘½å‘¨æœŸ(å…³äºå¼€å‘ã€æµ‹è¯•ã€é¢„å‘å¸ƒã€ç°åº¦ä»¥åŠä¸Šçº¿) ç†Ÿæ‚‰äº†ä¸€äº›å…³äºå¹¶å‘ã€ä¸»ä»ã€ç¼“å­˜ã€è°ƒåº¦ã€å®¹å™¨è¿™äº›ä¸»æµçš„æŠ€æœ¯ã€‚ æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œå­¦ä¼šäº†ä¸åŠ ç­ä¸èˆ’æœæ–¯åŸºã€‚ èº«ä½“ç›¸å…³ä¸çŸ¥æ˜¯é”™è§‰è¿˜æ˜¯ä»€ä¹ˆï¼Œæ„Ÿè§‰ä»Šå¹´çœ‹åˆ°ITè¡Œä¸šçŒæ­»æˆ–è€…æ˜¯å‡ºäº‹çš„æ–°é—»è¶Šæ¥è¶Šå¤šï¼ŒåŠ ä¸Šæˆ‘è¿™ä¸ªä»Šå¹´æ‰22å²çš„é’å¹´æœ‰æ—¶å€™ä¹Ÿä¼šè…°ç–¼è„–å­é…¸ï¼Œå¯¼è‡´æˆ‘å¯¹äºèº«ä½“ä¹Ÿæ˜¯è¶Šæ¥è¶Šæ‹…å¿§ã€‚ å…¶å®æˆ‘ä»åˆä¸­çš„æ—¶å€™å°±å¼€å§‹æ‰“ç¯®çƒï¼Œåœ¨å·¥ä½œä¹‹å‰ä¹Ÿæ˜¯å¯¹ç¯®çƒå®Œå…¨æ˜¯ç—´è¿·çš„çŠ¶æ€ï¼Œæ¯å¤©ä¸æ‰“çƒå°±æµ‘èº«éš¾å—ã€‚åˆšå·¥ä½œçš„é‚£æ®µæ—¶é—´è¿˜èƒ½åšæŒæ¯å‘¨æœ«å»æ‰“çƒï¼Œä½†æ˜¯ä»Šå¹´èƒ½åšåˆ°ä¸€ä¸ªæœˆæ‰“ä¸€æ¬¡éƒ½éå¸¸éš¾å¾—äº†ã€‚ã€‚ å†æ­¤ï¼Œæˆ‘ç«‹ä¸ªflagï¼Œæ˜å¤©ä¸‹åˆå‡ºå»æ‰“çƒï¼Œæ˜å¹´åšæŒè‡³å°‘æ¯ä¸¤å‘¨æ‰“ä¸€æ¬¡çƒã€‚ 2017å°ç›®æ ‡åˆ°è¿™é‡Œä¹ŸåŸºæœ¬ä¸Šæ€»ç»“çš„å·®ä¸å¤šäº†ï¼Œè¿˜æœ‰åŠä¸ªå°æ—¶å°±æ˜¯17å¹´äº†ã€‚ è¿˜æ˜¯å®šä¸€ä¸ª17å¹´çš„å°ç›®æ ‡å§ï¼š åšå®¢åšæŒå†™ï¼Œè‡³å°‘ä¿æŒä¸¤å‘¨ä¸€æ›´ã€‚ å¼€æºé¡¹ç›®åšæŒç»´æŠ¤ï¼Œäº‰å–é€ ä¸€ä¸ªè½®å­å‡ºæ¥ã€‚ åšæŒé”»ç‚¼ï¼Œæˆ‘è¿˜å¾—å…»å®¶ç³Šå£ã€‚ æœ€åå¸Œæœ›å®¶äººæœ‹å‹éƒ½å¹³å¹³å®‰å®‰ã€‚]]></content>
      <categories>
        <category>annual-summary</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[SSM(ä¸ƒ)åœ¨JavaWebåº”ç”¨ä¸­ä½¿ç”¨Redis]]></title>
    <url>%2F2016%2F12%2F18%2FSSM7%2F</url>
    <content type="text"><![CDATA[å‰è¨€ç”±äºæœ€è¿‘æ¢(mang)äº†(de)å®¶(yi)å…¬(bi)å¸æ¥è§¦äº†æ–°çš„ä¸œè¥¿æ‰€ä»¥å¾ˆä¹…æ²¡æœ‰æ›´æ–°äº†ã€‚è¿™æ¬¡è°ˆè°ˆRedisï¼Œå…³äºRedisåº”è¯¥å¾ˆå¤šæœ‹å‹å°±ç®—æ²¡æœ‰ç”¨è¿‡ä¹Ÿå¬è¿‡ï¼Œç®—æ˜¯è¿™å‡ å¹´æœ€æµè¡Œçš„NoSqlä¹‹ä¸€äº†ã€‚Redisçš„åº”ç”¨åœºæ™¯éå¸¸å¤šè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œè¿™æ¬¡å°±ä»¥ä¸€ä¸ªæœ€ç®€å•çš„ä¹Ÿæœ€å¸¸ç”¨çš„ ç¼“å­˜æ•°æ® æ¥ä¸¾ä¾‹ã€‚å…ˆæ¥çœ‹ä¸€å¼ æ•ˆæœå›¾ï¼š ä½œç”¨å°±æ˜¯åœ¨æ¯æ¬¡æŸ¥è¯¢æ¥å£çš„æ—¶å€™é¦–å…ˆåˆ¤æ–­Redisä¸­æ˜¯å¦æœ‰ç¼“å­˜ï¼Œæœ‰çš„è¯å°±è¯»å–ï¼Œæ²¡æœ‰å°±æŸ¥è¯¢æ•°æ®åº“å¹¶ä¿å­˜åˆ°Redisä¸­ï¼Œä¸‹æ¬¡å†æŸ¥è¯¢çš„è¯å°±ä¼šç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–äº†ã€‚Redisä¸­çš„ç»“æœï¼š ä¹‹åæŸ¥è¯¢rediså‘ç°ç¡®å®æ˜¯å­˜è¿›æ¥äº†ã€‚ Rediså®‰è£…ä¸ä½¿ç”¨é¦–å…ˆç¬¬ä¸€æ­¥è‡ªç„¶æ˜¯å®‰è£…Redisã€‚æˆ‘æ˜¯åœ¨æˆ‘VPSä¸Šè¿›è¡Œå®‰è£…çš„ï¼Œæ“ä½œç³»ç»Ÿæ˜¯CentOS6.5ã€‚ ä¸‹è½½Redishttps://redis.io/downloadï¼Œæˆ‘æœºå™¨ä¸Šå®‰è£…çš„æ˜¯3.2.5 å°†ä¸‹è½½ä¸‹æ¥çš„â€™reidis-3.2.5-tar.gzâ€™ä¸Šä¼ åˆ°usr/localè¿™ä¸ªç›®å½•è¿›è¡Œè§£å‹ã€‚ è¿›å…¥è¯¥ç›®å½•ã€‚ ç¼–è¯‘å®‰è£… 12makemake install ä¿®æ”¹redis.confé…ç½®æ–‡ä»¶ã€‚ è¿™é‡Œæˆ‘åªæ˜¯ç®€å•çš„åŠ ä¸Šå¯†ç è€Œå·²ã€‚12vi redis.confrequirepass ä½ çš„å¯†ç  å¯åŠ¨Redis å¯åŠ¨æ—¶å€™è¦é€‰æ‹©æˆ‘ä»¬ä¹‹å‰ä¿®æ”¹çš„é…ç½®æ–‡ä»¶æ‰èƒ½ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆã€‚1234è¿›å…¥srcç›®å½•cd /usr/local/redis-3.2.5/srcå¯åŠ¨æœåŠ¡./redis-server ../redis.conf ç™»é™†redis1./redis-cli -a ä½ çš„å¯†ç  Springæ•´åˆRedisè¿™é‡Œæˆ‘å°±ç›´æ¥å¼€å§‹ç”¨Springæ•´åˆæ¯•ç«Ÿåœ¨å®é™…ä½¿ç”¨ä¸­éƒ½æ˜¯å’ŒSpringä¸€èµ·ä½¿ç”¨çš„ã€‚ ä¿®æ”¹Springé…ç½®æ–‡ä»¶åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970&lt;!-- jedis é…ç½® --&gt; &lt;bean id="poolConfig" class="redis.clients.jedis.JedisPoolConfig"&gt; &lt;property name="maxIdle" value="$&#123;redis.maxIdle&#125;"/&gt; &lt;property name="maxWaitMillis" value="$&#123;redis.maxWait&#125;"/&gt; &lt;property name="testOnBorrow" value="$&#123;redis.testOnBorrow&#125;"/&gt; &lt;/bean&gt; &lt;!-- redisæœåŠ¡å™¨ä¸­å¿ƒ --&gt; &lt;bean id="connectionFactory" class="org.springframework.data.redis.connection.jedis.JedisConnectionFactory"&gt; &lt;property name="poolConfig" ref="poolConfig"/&gt; &lt;property name="port" value="$&#123;redis.port&#125;"/&gt; &lt;property name="hostName" value="$&#123;redis.host&#125;"/&gt; &lt;property name="password" value="$&#123;redis.password&#125;"/&gt; &lt;property name="timeout" value="$&#123;redis.timeout&#125;"&gt;&lt;/property&gt; &lt;/bean&gt; &lt;bean id="redisTemplate" class="org.springframework.data.redis.core.RedisTemplate"&gt; &lt;property name="connectionFactory" ref="connectionFactory"/&gt; &lt;property name="keySerializer"&gt; &lt;bean class="org.springframework.data.redis.serializer.StringRedisSerializer"/&gt; &lt;/property&gt; &lt;property name="valueSerializer"&gt; &lt;bean class="org.springframework.data.redis.serializer.JdkSerializationRedisSerializer"/&gt; &lt;/property&gt; &lt;/bean&gt; &lt;!-- cacheé…ç½® --&gt; &lt;bean id="methodCacheInterceptor" class="com.crossoverJie.intercept.MethodCacheInterceptor"&gt; &lt;property name="redisUtil" ref="redisUtil"/&gt; &lt;/bean&gt; &lt;bean id="redisUtil" class="com.crossoverJie.util.RedisUtil"&gt; &lt;property name="redisTemplate" ref="redisTemplate"/&gt; &lt;/bean&gt; &lt;!--é…ç½®åˆ‡é¢æ‹¦æˆªæ–¹æ³• --&gt; &lt;aop:config proxy-target-class="true"&gt; &lt;!--å°†com.crossoverJie.serviceåŒ…ä¸‹çš„æ‰€æœ‰selectå¼€å¤´çš„æ–¹æ³•åŠ å…¥æ‹¦æˆª å»æ‰selectåˆ™åŠ å…¥æ‰€æœ‰æ–¹æ³•w --&gt; &lt;aop:pointcut id="controllerMethodPointcut" expression=" execution(* com.crossoverJie.service.*.select*(..))"/&gt; &lt;aop:pointcut id="selectMethodPointcut" expression=" execution(* com.crossoverJie.dao..*Mapper.select*(..))"/&gt; &lt;aop:advisor advice-ref="methodCacheInterceptor" pointcut-ref="controllerMethodPointcut"/&gt; &lt;/aop:config&gt;``` æ›´å¤šçš„é…ç½®å¯ä»¥ç›´æ¥åœ¨æºç é‡Œé¢æŸ¥çœ‹ï¼š[https://github.com/crossoverJie/SSM/blob/master/src/main/resources/spring-mybatis.xml](https://github.com/crossoverJie/SSM/blob/master/src/main/resources/spring-mybatis.xml)ã€‚ä»¥ä¸Šéƒ½å†™æœ‰æ³¨é‡Šï¼Œä¹Ÿéƒ½æ˜¯ä¸€äº›ç®€å•çš„é…ç½®ç›¸ä¿¡éƒ½èƒ½çœ‹æ‡‚ã€‚ä¸‹é¢æˆ‘ä¼šç€é‡è¯´ä¸‹å¦‚ä½•é…ç½®ç¼“å­˜çš„ã€‚# Springåˆ‡é¢ä½¿ç”¨ç¼“å­˜Springçš„`AOP`çœŸæ˜¯æ˜¯ä¸€ä¸ªå¥½ä¸œè¥¿ï¼Œè¿˜ä¸å¤ªæ¸…æ¥šæ˜¯ä»€ä¹ˆçš„åŒå­¦å»ºè®®å…ˆè‡ªè¡Œ`Google`ä¸‹å§ã€‚åœ¨ä¸ä½¿ç”¨åˆ‡é¢çš„æ—¶å€™å¦‚æœæˆ‘ä»¬æƒ³ç»™æŸä¸ªæ–¹æ³•åŠ å…¥ç¼“å­˜çš„è¯è‚¯å®šæ˜¯åœ¨æ–¹æ³•è¿”å›ä¹‹å‰å°±è¦åŠ å…¥ç›¸åº”çš„é€»è¾‘åˆ¤æ–­ï¼Œåªæœ‰ä¸€ä¸ªæˆ–å‡ ä¸ªå€’è¿˜å¥½ï¼Œå¦‚æœæœ‰å‡ åä¸Šç™¾ä¸ªçš„è¯é‚£GGäº†ï¼Œè€Œä¸”ç»´æŠ¤èµ·æ¥ä¹Ÿç‰¹åˆ«éº»çƒ¦ã€‚&gt; å¥½åœ¨Springçš„AOPå¯ä»¥å¸®æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&gt; è¿™æ¬¡å°±åœ¨æˆ‘ä»¬éœ€è¦åŠ å…¥ç¼“å­˜æ–¹æ³•çš„åˆ‡é¢åŠ å…¥è¿™ä¸ªé€»è¾‘ï¼Œå¹¶ä¸”åªéœ€è¦ä¸€ä¸ªé…ç½®å³å¯æå®šï¼Œå°±æ˜¯ä¸Šæ–‡ä¸­æ‰€æåˆ°çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š```xml &lt;!--é…ç½®åˆ‡é¢æ‹¦æˆªæ–¹æ³• --&gt; &lt;aop:config proxy-target-class="true"&gt; &lt;!--å°†com.crossoverJie.serviceåŒ…ä¸‹çš„æ‰€æœ‰selectå¼€å¤´çš„æ–¹æ³•åŠ å…¥æ‹¦æˆª å»æ‰selectåˆ™åŠ å…¥æ‰€æœ‰æ–¹æ³•w --&gt; &lt;aop:pointcut id="controllerMethodPointcut" expression=" execution(* com.crossoverJie.service.*.select*(..))"/&gt; &lt;aop:pointcut id="selectMethodPointcut" expression=" execution(* com.crossoverJie.dao..*Mapper.select*(..))"/&gt; &lt;aop:advisor advice-ref="methodCacheInterceptor" pointcut-ref="controllerMethodPointcut"/&gt; &lt;/aop:config&gt; è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨è¡¨è¾¾å¼execution(* com.crossoverJie.service.*.select*(..))æ¥æ‹¦æˆªserviceä¸­æ‰€æœ‰ä»¥selectå¼€å¤´çš„æ–¹æ³•ã€‚è¿™æ ·åªè¦æˆ‘ä»¬è¦å°†åŠ å…¥çš„ç¼“å­˜çš„æ–¹æ³•ä»¥selectå‘½åå¼€å¤´çš„è¯æ¯æ¬¡è¿›å…¥æ–¹æ³•ä¹‹å‰éƒ½ä¼šè¿›å…¥æˆ‘ä»¬è‡ªå®šä¹‰çš„MethodCacheInterceptoræ‹¦æˆªå™¨ã€‚è¿™é‡Œè´´ä¸€ä¸‹MethodCacheInterceptorä¸­å¤„ç†é€»è¾‘çš„æ ¸å¿ƒæ–¹æ³•ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546@Override public Object invoke(MethodInvocation invocation) throws Throwable &#123; Object value = null; String targetName = invocation.getThis().getClass().getName(); String methodName = invocation.getMethod().getName(); // ä¸éœ€è¦ç¼“å­˜çš„å†…å®¹ //if (!isAddCache(StringUtil.subStrForLastDot(targetName), methodName)) &#123; if (!isAddCache(targetName, methodName)) &#123; // æ‰§è¡Œæ–¹æ³•è¿”å›ç»“æœ return invocation.proceed(); &#125; Object[] arguments = invocation.getArguments(); String key = getCacheKey(targetName, methodName, arguments); logger.debug("redisKey: " + key); try &#123; // åˆ¤æ–­æ˜¯å¦æœ‰ç¼“å­˜ if (redisUtil.exists(key)) &#123; return redisUtil.get(key); &#125; // å†™å…¥ç¼“å­˜ value = invocation.proceed(); if (value != null) &#123; final String tkey = key; final Object tvalue = value; new Thread(new Runnable() &#123; @Override public void run() &#123; if (tkey.startsWith("com.service.impl.xxxRecordManager")) &#123; redisUtil.set(tkey, tvalue, xxxRecordManagerTime); &#125; else if (tkey.startsWith("com.service.impl.xxxSetRecordManager")) &#123; redisUtil.set(tkey, tvalue, xxxSetRecordManagerTime); &#125; else &#123; redisUtil.set(tkey, tvalue, defaultCacheExpireTime); &#125; &#125; &#125;).start(); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); if (value == null) &#123; return invocation.proceed(); &#125; &#125; return value; &#125; å…ˆæ˜¯æŸ¥çœ‹äº†å½“å‰æ–¹æ³•æ˜¯å¦åœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„æ–¹æ³•ä¸­ï¼Œå¦‚æœä¸æ˜¯çš„è¯å°±ç›´æ¥è¿”å›ï¼Œä¸è¿›å…¥æ‹¦æˆªå™¨ã€‚ ä¹‹ååˆ©ç”¨åå°„è·å–çš„ç±»åã€æ–¹æ³•åã€å‚æ•°ç”Ÿæˆredisçš„keyã€‚ ç”¨keyåœ¨redisä¸­æŸ¥è¯¢æ˜¯å¦å·²ç»æœ‰ç¼“å­˜ã€‚ æœ‰ç¼“å­˜å°±ç›´æ¥è¿”å›ç¼“å­˜å†…å®¹ï¼Œä¸å†ç»§ç»­æŸ¥è¯¢æ•°æ®åº“ã€‚ å¦‚æœæ²¡æœ‰ç¼“å­˜å°±æŸ¥è¯¢æ•°æ®åº“å¹¶å°†è¿”å›ä¿¡æ¯åŠ å…¥åˆ°redisä¸­ã€‚ ä½¿ç”¨PageHelperè¿™æ¬¡ä¸ºäº†åˆ†é¡µæ–¹ä¾¿ä½¿ç”¨äº†æ¯”è¾ƒæµè¡Œçš„PageHelperæ¥å¸®æˆ‘ä»¬æ›´ç®€å•çš„è¿›è¡Œåˆ†é¡µã€‚é¦–å…ˆæ˜¯æ–°å¢ä¸€ä¸ªmybatisçš„é…ç½®æ–‡ä»¶mybatis-configï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748&lt;?xml version="1.0" encoding="UTF-8" ?&gt;&lt;!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;&lt;configuration&gt; &lt;settings&gt; &lt;setting name="cacheEnabled" value="true"/&gt; &lt;setting name="lazyLoadingEnabled" value="true"/&gt; &lt;setting name="multipleResultSetsEnabled" value="true"/&gt; &lt;setting name="useColumnLabel" value="true"/&gt; &lt;setting name="useGeneratedKeys" value="false"/&gt; &lt;setting name="autoMappingBehavior" value="PARTIAL"/&gt; &lt;setting name="defaultExecutorType" value="SIMPLE"/&gt; &lt;setting name="defaultStatementTimeout" value="25"/&gt; &lt;setting name="safeRowBoundsEnabled" value="false"/&gt; &lt;setting name="mapUnderscoreToCamelCase" value="false"/&gt; &lt;setting name="localCacheScope" value="SESSION"/&gt; &lt;setting name="jdbcTypeForNull" value="OTHER"/&gt; &lt;setting name="lazyLoadTriggerMethods" value="equals,clone,hashCode,toString"/&gt; &lt;/settings&gt; &lt;plugins&gt; &lt;!-- com.github.pagehelperä¸ºPageHelperç±»æ‰€åœ¨åŒ…å --&gt; &lt;plugin interceptor="com.github.pagehelper.PageHelper"&gt; &lt;property name="dialect" value="mysql"/&gt; &lt;!-- è¯¥å‚æ•°é»˜è®¤ä¸ºfalse --&gt; &lt;!-- è®¾ç½®ä¸ºtrueæ—¶ï¼Œä¼šå°†RowBoundsç¬¬ä¸€ä¸ªå‚æ•°offsetå½“æˆpageNumé¡µç ä½¿ç”¨ --&gt; &lt;!-- å’ŒstartPageä¸­çš„pageNumæ•ˆæœä¸€æ · --&gt; &lt;property name="offsetAsPageNum" value="true"/&gt; &lt;!-- è¯¥å‚æ•°é»˜è®¤ä¸ºfalse --&gt; &lt;!-- è®¾ç½®ä¸ºtrueæ—¶ï¼Œä½¿ç”¨RowBoundsåˆ†é¡µä¼šè¿›è¡ŒcountæŸ¥è¯¢ --&gt; &lt;property name="rowBoundsWithCount" value="true"/&gt; &lt;!-- è®¾ç½®ä¸ºtrueæ—¶ï¼Œå¦‚æœpageSize=0æˆ–è€…RowBounds.limit = 0å°±ä¼šæŸ¥è¯¢å‡ºå…¨éƒ¨çš„ç»“æœ --&gt; &lt;!-- ï¼ˆç›¸å½“äºæ²¡æœ‰æ‰§è¡Œåˆ†é¡µæŸ¥è¯¢ï¼Œä½†æ˜¯è¿”å›ç»“æœä»ç„¶æ˜¯Pageç±»å‹ï¼‰ &lt;property name="pageSizeZero" value="true"/&gt; --&gt; &lt;!-- 3.3.0ç‰ˆæœ¬å¯ç”¨ - åˆ†é¡µå‚æ•°åˆç†åŒ–ï¼Œé»˜è®¤falseç¦ç”¨ --&gt; &lt;!-- å¯ç”¨åˆç†åŒ–æ—¶ï¼Œå¦‚æœpageNum&lt;1ä¼šæŸ¥è¯¢ç¬¬ä¸€é¡µï¼Œå¦‚æœpageNum&gt;pagesä¼šæŸ¥è¯¢æœ€åä¸€é¡µ --&gt; &lt;!-- ç¦ç”¨åˆç†åŒ–æ—¶ï¼Œå¦‚æœpageNum&lt;1æˆ–pageNum&gt;pagesä¼šè¿”å›ç©ºæ•°æ® --&gt; &lt;property name="reasonable" value="true"/&gt; &lt;!-- 3.5.0ç‰ˆæœ¬å¯ç”¨ - ä¸ºäº†æ”¯æŒstartPage(Object params)æ–¹æ³• --&gt; &lt;!-- å¢åŠ äº†ä¸€ä¸ª`params`å‚æ•°æ¥é…ç½®å‚æ•°æ˜ å°„ï¼Œç”¨äºä»Mapæˆ–ServletRequestä¸­å–å€¼ --&gt; &lt;!-- å¯ä»¥é…ç½®pageNum,pageSize,count,pageSizeZero,reasonable,ä¸é…ç½®æ˜ å°„çš„ç”¨é»˜è®¤å€¼ --&gt; &lt;!-- ä¸ç†è§£è¯¥å«ä¹‰çš„å‰æä¸‹ï¼Œä¸è¦éšä¾¿å¤åˆ¶è¯¥é…ç½® --&gt; &lt;property name="params" value="pageNum=start;pageSize=limit;"/&gt; &lt;/plugin&gt; &lt;/plugins&gt;&lt;/configuration&gt; æ¥ç€åœ¨mybatisçš„é…ç½®æ–‡ä»¶ä¸­å¼•å…¥æ¬¡é…ç½®æ–‡ä»¶ï¼š1234567&lt;bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean"&gt; &lt;property name="dataSource" ref="dataSource" /&gt; &lt;!-- è‡ªåŠ¨æ‰«æmapping.xmlæ–‡ä»¶ --&gt; &lt;property name="mapperLocations" value="classpath:mapping/*.xml"&gt;&lt;/property&gt; &lt;!--åŠ å…¥PageHelper--&gt; &lt;property name="configLocation" value="classpath:mybatis-config.xml"/&gt;&lt;/bean&gt; æ¥ç€åœ¨serviceæ–¹æ³•ä¸­ï¼š1234567891011@Overridepublic PageEntity&lt;Rediscontent&gt; selectByPage(Integer pageNum, Integer pageSize) &#123; PageHelper.startPage(pageNum, pageSize); //å› ä¸ºæ˜¯demoï¼Œæ‰€ä»¥è¿™é‡Œé»˜è®¤æ²¡æœ‰æŸ¥è¯¢æ¡ä»¶ã€‚ List&lt;Rediscontent&gt; rediscontents = rediscontentMapper.selectByExample(new RediscontentExample()); PageEntity&lt;Rediscontent&gt; rediscontentPageEntity = new PageEntity&lt;Rediscontent&gt;(); rediscontentPageEntity.setList(rediscontents); int size = rediscontentMapper.selectByExample(new RediscontentExample()).size(); rediscontentPageEntity.setCount(size); return rediscontentPageEntity;&#125; åªéœ€è¦ä½¿ç”¨PageHelper.startPage(pageNum, pageSize);æ–¹æ³•å°±å¯ä»¥å¸®æˆ‘ä»¬ç®€å•çš„åˆ†é¡µäº†ã€‚è¿™é‡Œæˆ‘è‡ªå®šä¹‰äº†ä¸€ä¸ªåˆ†é¡µå·¥å…·ç±»PageEntityæ¥æ›´æ–¹ä¾¿çš„å¸®æˆ‘ä»¬åœ¨ä¹‹åç”ŸæˆJSONæ•°æ®ã€‚123456789101112131415161718192021222324252627282930package com.crossoverJie.util;import java.io.Serializable;import java.util.List;/** * åˆ†é¡µå®ä½“ * * @param &lt;T&gt; */public class PageEntity&lt;T&gt; implements Serializable &#123; private List&lt;T&gt; list;// åˆ†é¡µåçš„æ•°æ® private Integer count; public Integer getCount() &#123; return count; &#125; public void setCount(Integer count) &#123; this.count = count; &#125; public List&lt;T&gt; getList() &#123; return list; &#125; public void setList(List&lt;T&gt; list) &#123; this.list = list; &#125;&#125; æ›´å¤šPageHelperçš„ä½¿ç”¨è¯·æŸ¥çœ‹ä¸€ä¸‹é“¾æ¥ï¼šhttps://github.com/pagehelper/Mybatis-PageHelper å‰ç«¯è”è°ƒæ¥ä¸‹æ¥çœ‹ä¸‹æ§åˆ¶å±‚RedisController:1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556package com.crossoverJie.controller;import com.crossoverJie.pojo.Rediscontent;import com.crossoverJie.service.RediscontentService;import com.crossoverJie.util.CommonUtil;import com.crossoverJie.util.PageEntity;import com.github.pagehelper.PageHelper;import net.sf.json.JSONArray;import net.sf.json.JSONObject;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import javax.servlet.http.HttpServletResponse;@Controller@RequestMapping("/redis")public class RedisController &#123; private static Logger logger = LoggerFactory.getLogger(RedisController.class); @Autowired private RediscontentService rediscontentService; @RequestMapping("/redis_list") public void club_list(HttpServletResponse response, @RequestParam(value = "page", defaultValue = "0") int page, @RequestParam(value = "pageSize", defaultValue = "0") int pageSize) &#123; JSONObject jsonObject = new JSONObject(); JSONObject jo = new JSONObject(); try &#123; JSONArray ja = new JSONArray(); PageHelper.startPage(1, 10); PageEntity&lt;Rediscontent&gt; rediscontentPageEntity = rediscontentService.selectByPage(page, pageSize); for (Rediscontent rediscontent : rediscontentPageEntity.getList()) &#123; JSONObject jo1 = new JSONObject(); jo1.put("rediscontent", rediscontent); ja.add(jo1); &#125; jo.put("redisContents", ja); jo.put("count", rediscontentPageEntity.getCount()); jsonObject = CommonUtil.parseJson("1", "æˆåŠŸ", jo); &#125; catch (Exception e) &#123; jsonObject = CommonUtil.parseJson("2", "æ“ä½œå¼‚å¸¸", ""); logger.error(e.getMessage(), e); &#125; //æ„å»ºè¿”å› CommonUtil.responseBuildJson(response, jsonObject); &#125;&#125; è¿™é‡Œå°±ä¸åšè¿‡å¤šè§£é‡Šäº†ï¼Œå°±æ˜¯ä»redisæˆ–è€…æ˜¯serviceä¸­æŸ¥è¯¢å‡ºæ•°æ®å¹¶è¿”å›ã€‚ å‰ç«¯çš„æ˜¾ç¤ºç•Œé¢åœ¨https://github.com/crossoverJie/SSM/blob/master/src/main/webapp/redis/showRedis.jspä¸­(å¹¶ä¸æ˜¯å‰ç«¯ï¼Œå°†å°±çœ‹)ã€‚å…¶ä¸­æ ¸å¿ƒçš„redis_list.jsçš„ä»£ç å¦‚ä¸‹ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485var page = 1, rows = 10;$(document).ready(function () &#123; initJqPaginator(); //åŠ è½½ load_redis_list(); $(".query_but").click(function () &#123;//æŸ¥è¯¢æŒ‰é’® page = 1; load_redis_list(); &#125;);&#125;);//åˆå§‹åŒ–åˆ†é¡µfunction initJqPaginator() &#123; $.jqPaginator('#pagination', &#123; totalPages: 100, visiblePages: 10, currentPage: 1, first: '&lt;li class="prev"&gt;&lt;a href="javascript:;"&gt;é¦–é¡µ&lt;/a&gt;&lt;/li&gt;', last: '&lt;li class="prev"&gt;&lt;a href="javascript:;"&gt;æœ«é¡µ&lt;/a&gt;&lt;/li&gt;', prev: '&lt;li class="prev"&gt;&lt;a href="javascript:;"&gt;ä¸Šä¸€é¡µ&lt;/a&gt;&lt;/li&gt;', next: '&lt;li class="next"&gt;&lt;a href="javascript:;"&gt;ä¸‹ä¸€é¡µ&lt;/a&gt;&lt;/li&gt;', page: '&lt;li class="page"&gt;&lt;a href="javascript:;"&gt;&#123;&#123;page&#125;&#125;&lt;/a&gt;&lt;/li&gt;', onPageChange: function (num, type) &#123; page = num; if (type == "change") &#123; load_redis_list(); &#125; &#125; &#125;);&#125;//åˆ—è¡¨function create_club_list(redisContens) &#123; var phone = 0; var html = '&lt;div class="product_box"&gt;' + '&lt;div class="br"&gt;' + '&lt;div class="product_link"&gt;' + '&lt;div class="product_phc"&gt;' + '&lt;img class="phc" src="" &gt;' + '&lt;/div&gt;' + '&lt;span class="product_name"&gt;' + redisContens.id + '&lt;/span&gt;&lt;/div&gt;' + '&lt;div class="product_link toto"&gt;' + redisContens.content + '&lt;/div&gt;' + '&lt;div class="product_link toto"&gt;' + '&lt;span&gt;' + "" + '&lt;/span&gt;' + '&lt;/div&gt;' + '&lt;div class="product_link toto"&gt;' + '&lt;span&gt;' + phone + '&lt;/span&gt;&lt;/div&gt;' + '&lt;div class="product_link toto"&gt;' + '&lt;span&gt;' + 0 + '&lt;/span&gt;&lt;/div&gt;' + '&lt;div class="product_link toto product_operation"&gt;' + '&lt;span onclick="edit_club(' + 0 + ')"&gt;ç¼–è¾‘&lt;/span&gt;' + '&lt;span onclick="edit_del(' + 0 + ')"&gt;åˆ é™¤&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;' + '&lt;/div&gt;'; return html;&#125;//åŠ è½½åˆ—è¡¨function load_redis_list() &#123; var name = $("#name").val(); $.ajax(&#123; type: 'POST', url: getPath() + '/redis/redis_list', async: false, data: &#123;name: name, page: page, pageSize: rows&#125;, datatype: 'json', success: function (data) &#123; if (data.result == 1) &#123; $(".product_length_number").html(data.data.count); var html = ""; var count = data.data.count; for (var i = 0; i &lt; data.data.redisContents.length; i++) &#123; var redisContent = data.data.redisContents[i]; html += create_club_list(redisContent.rediscontent); &#125; $(".product_content").html(html); //è¿™é‡Œæ˜¯åˆ†é¡µçš„æ’ä»¶ $('#pagination').jqPaginator('option', &#123; totalPages: (Math.ceil(count / rows) &lt; 1 ? 1 : Math.ceil(count / rows)), currentPage: page &#125;); &#125; else &#123; alert(data.msg); &#125; &#125; &#125;); $(".product_box:even").css("background", "#e6e6e6");//éš”è¡Œå˜è‰²&#125; å…¶å®å°±æ˜¯ä¸€ä¸ªç®€å•çš„è¯·æ±‚æ¥å£ï¼Œå¹¶æ ¹æ®è¿”å›æ•°æ®åŠ¨æ€ç”ŸæˆDomè€Œå·²ã€‚ æ€»ç»“ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªç®€å•çš„redisçš„åº”ç”¨ã€‚redisçš„åº”ç”¨åœºæ™¯è¿˜éå¸¸çš„å¤šï¼Œæ¯”å¦‚ç°åœ¨æˆ‘æ‰€åœ¨åšçš„ä¸€ä¸ªé¡¹ç›®å°±æœ‰ç”¨æ¥å¤„ç†çŸ­ä¿¡éªŒè¯ç çš„ä¸šåŠ¡åœºæ™¯ï¼Œä¹‹åæœ‰æ—¶é—´å¯ä»¥å†™ä¸€ä¸ªdemoã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.gitGitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(å…­)è·¨åŸŸä¼ è¾“]]></title>
    <url>%2F2016%2F10%2F18%2FSSM6%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¸çŸ¥å¤§å®¶åœ¨å¹³æ—¶çš„å¼€å‘è¿‡ç¨‹ä¸­æœ‰æ²¡æœ‰é‡åˆ°è¿‡è·¨åŸŸè®¿é—®èµ„æºçš„é—®é¢˜ï¼Œæˆ‘ä¸å·§åœ¨ä¸Šå‘¨å°±ç¢°åˆ°ä¸€ä¸ªè¿™æ ·çš„é—®é¢˜ï¼Œå¹¸è¿çš„æ˜¯åœ¨å…¬å¸å‰ç«¯åŒå­¦çš„å¸®å¿™ä¸‹è§£å†³äº†è¯¥é—®é¢˜ã€‚ ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜ï¼Ÿ åªè¦åè®®ã€åŸŸåã€ç«¯å£æœ‰ä»»ä½•ä¸€ä¸ªä¸åŒï¼Œéƒ½è¢«å½“ä½œæ˜¯ä¸åŒçš„åŸŸ åªè¦æ˜¯åœ¨ä¸åŒåŸŸä¸­æ˜¯æ— æ³•è¿›è¡Œé€šä¿¡çš„ã€‚ åŸºäºä»¥ä¸Šçš„çš„å‡ºå‘ç‚¹ï¼Œæˆ‘ä»¬åˆæœ‰è·¨åŸŸå…±äº«èµ„æºçš„éœ€æ±‚(è­¬å¦‚ç°åœ¨æµè¡Œçš„å‰åç«¯åˆ†ç¦»ä¹‹ååˆ†åˆ«éƒ¨ç½²çš„æƒ…å†µ)ï¼Œæœ¬æ–‡æ‰€é‡‡ç”¨çš„è§£å†³åŠæ³•æ˜¯JSONPï¼Œè¯´åˆ°JSONPå°±ä¼šé¦–å…ˆæƒ³åˆ°JSONã€‚è™½ç„¶åªæœ‰ä¸€å­—ä¹‹å·®ä½†æ„ä¹‰å´å®Œå…¨ä¸ä¸€æ ·ï¼Œé¦–å…ˆç§‘æ™®ä¸€ä¸‹JSONã€‚ JSON å…¶å®ç°åœ¨JSONå·²ç»æ˜¯ç›¸å½“æµè¡Œäº†ï¼Œåªè¦æ¶‰åŠåˆ°å‰åç«¯çš„æ•°æ®äº¤äº’å¤§éƒ½éƒ½æ˜¯é‡‡ç”¨çš„JSON(ä¸ç®¡æ˜¯webè¿˜æ˜¯androidå’ŒIOS)ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œå°±ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå°±ç®—æ˜¯æ²¡æœ‰ç”¨è¿‡çš„åŒå­¦ä¹Ÿèƒ½å¾ˆå¿«æ˜ç™½å…¶ä¸­çš„æ„æ€ã€‚ PostMané¦–å…ˆç»™å¤§å®¶å®‰åˆ©ä¸€æ¬¾åç«¯å¼€å‘çš„åˆ©å™¨PostMan,å¯ä»¥ç”¨äºæ¨¡æ‹Ÿå‡ ä¹æ‰€æœ‰çš„HTTPè¯·æ±‚ï¼Œåœ¨å¼€å‘é˜¶æ®µè°ƒè¯•åç«¯æ¥å£éå¸¸æœ‰ç”¨ã€‚è¿™æ˜¯ä¸€ä¸ªChromeæ’ä»¶ï¼Œå¯ä»¥ç›´æ¥åœ¨googleå•†åº—æœç´¢ç›´æ¥ä¸‹è½½(å½“ç„¶å‰æä½ æ‡‚å¾—)ã€‚ä¹‹åç•Œé¢å°±å¦‚ä¸‹ï¼š ç•Œé¢éå¸¸ç®€æ´ï¼Œæœ‰ç‚¹å¼€å‘ç»éªŒçš„ç«¥é‹åº”è¯¥éƒ½ä¼šä½¿ç”¨ï¼Œä¸å¤ªä¼šç”¨çš„ç›´æ¥googleä¸‹å°±å¯ä»¥äº†æ¯”è¾ƒç®€å•ã€‚æ¥ç€æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨PostManæ¥å‘èµ·ä¸€æ¬¡è¯·æ±‚è·å–JSONäº†ã€‚è¿™é‡Œä»¥æˆ‘SSMé¡¹ç›®ä¸ºä¾‹,ä¹Ÿæ­£å¥½æœ‰æš´éœ²ä¸€ä¸ªJSONçš„æ¥å£ã€‚åœ°å€å¦‚ä¸‹:http://www.crossoverjie.top/SSM/content_loadã€‚ç›´æ¥åœ¨POSTMANä¸­çš„åœ°å€æ è¾“å…¥è¯¥åœ°å€ï¼Œé‡‡ç”¨GETçš„æ–¹å¼è¯·æ±‚ï¼Œä¹‹åæ‰€è¿”å›çš„å°±æ˜¯JSONæ ¼å¼çš„å­—ç¬¦ä¸²ã€‚ç”±äºJavascriptåŸç”Ÿçš„å°±æ”¯æŒJSONï¼Œæ‰€ä»¥è§£æèµ·æ¥éå¸¸æ–¹ä¾¿ã€‚ JSONPå¥½äº†ï¼Œç»ˆäºå¯ä»¥è°ˆè°ˆJSONPäº†ã€‚ä¹‹å‰è¯´é“JSONPæ˜¯ç”¨æ¥è§£å†³è·¨åŸŸé—®é¢˜çš„ï¼Œé‚£ä¹ˆä»–æ˜¯å¦‚ä½•è§£å†³çš„å‘¢ã€‚ç»è¿‡æˆ‘ä»¬å¼€å‘ç•Œçš„å‰è¾ˆä»¬å‘ç°ï¼ŒHTMLä¸­æ‹¥æœ‰SRCå±æ€§çš„æ ‡ç­¾éƒ½ä¸å—è·¨åŸŸçš„å½±å“ï¼Œæ¯”å¦‚ï¼š&lt;script&gt;ã€&lt;img&gt;ã€&lt;iframe&gt;æ ‡ç­¾ã€‚ç”±äºJSåŸç”Ÿæ”¯æŒJSONçš„è§£æï¼Œäºæ˜¯æˆ‘ä»¬é‡‡ç”¨&lt;script&gt;çš„æ–¹å¼æ¥å¤„ç†è·¨åŸŸè§£æï¼Œä»£ç å¦‚ä¸‹ä¸€çœ‹å°±æ˜ç™½ã€‚webç«¯:1234567891011121314151617181920212223242526272829303132&lt;html lang="zh"&gt;&lt;head&gt; &lt;script type="text/javascript"&gt; $(document).ready(function()&#123; $.ajax(&#123; type: "get", async: false, url: "http://www.crossoverjie.top/SSM/jsonpInfo?callback=getUser&amp;userId=3", dataType: "jsonp", jsonp: "callback",//ä¸€èˆ¬é»˜è®¤ä¸º:callback jsonpCallback:"getUser",//è‡ªå®šä¹‰çš„jsonpå›è°ƒå‡½æ•°åç§°ï¼Œé»˜è®¤ä¸ºjQueryè‡ªåŠ¨ç”Ÿæˆçš„éšæœºå‡½æ•°åï¼Œä¹Ÿå¯ä»¥å†™"?"ï¼ŒjQueryä¼šè‡ªåŠ¨ä¸ºä½ å¤„ç†æ•°æ® success: function(json)&#123; /** * è·å¾—æœåŠ¡å™¨è¿”å›çš„ä¿¡æ¯ã€‚ * å¯ä»¥åšå…·ä½“çš„ä¸šåŠ¡å¤„ç†ã€‚ */ alert('ç”¨æˆ·ä¿¡æ¯ï¼šIDï¼š ' + json.userId + ' ï¼Œå§“åï¼š ' + json.username + 'ã€‚'); &#125;, error: function()&#123; alert('fail'); &#125; &#125;); &#125;); &lt;/script&gt;&lt;/head&gt;&lt;body oncontextmenu="return false"&gt;&lt;/body&gt;&lt;/html&gt; å…¶ä¸­æˆ‘ä»¬é‡‡ç”¨äº†JQueryç»™æˆ‘å°è£…å¥½çš„å‡½æ•°ï¼Œè¿™æ ·å°±å¯ä»¥è‡ªåŠ¨å¸®æˆ‘ä»¬è§£æäº†ã€‚é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸‹ä»£ç ä¸­çš„http://www.crossoverjie.top/SSM/jsonpInfo?callback=getUser&amp;userId=3è¿™ä¸ªåœ°å€è¿”å›çš„æ˜¯ä»€ä¹ˆå†…å®¹ï¼Œè¿˜æ˜¯æ”¾åˆ°POSTMANä¸­æ‰§è¡Œå¦‚ä¸‹ï¼šã€‚å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ‰€ä¼ é€’çš„callbackå‚æ•°å¸¦ç€æŸ¥è¯¢çš„æ•°æ®åˆåŸå°ä¸åŠ¨çš„è¿”å›ç»™æˆ‘ä»¬äº†ï¼Œè¿™æ ·çš„è¯å³ä½¿æˆ‘ä»¬ä¸ä½¿ç”¨JQueryç»™æˆ‘å°è£…å¥½çš„å‡½æ•°ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªå’Œcallbackåç§°ä¸€æ ·çš„å‡½æ•°ä¸€æ ·æ˜¯å¯ä»¥è§£æå…¶ä¸­çš„æ•°æ®çš„ï¼Œåªæ˜¯Jqueryå¸®æˆ‘ä»¬åšäº†è€Œå·²ã€‚ å‰ç«¯æ²¡é—®é¢˜äº†ï¼Œé‚£ä¹ˆåç«¯åˆæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿä¹Ÿå¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š1234567@RequestMapping(value = "/jsonpInfo",method = &#123; RequestMethod.GET &#125;)@ResponseBodypublic Object jsonpInfo(String callback,Integer userId) throws IOException &#123; User user = userService.getUserById(userId); JSONPObject jsonpObject = new JSONPObject(callback,user) ; return jsonpObject ;&#125; åç«¯é‡‡ç”¨äº†jacksonä¸­çš„JSONPObjectè¿™ä¸ªç±»çš„ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œåªéœ€è¦å°†callbackå­—æ®µå’Œéœ€è¦è½¬æˆJSONå­—ç¬¦ä¸²çš„å¯¹è±¡æ”¾è¿›å»å³å¯ã€‚éœ€è¦ä¸»è¦çš„æ˜¯éœ€è¦ä½¿ç”¨@ResponseBodyæ³¨è§£æ‰èƒ½æˆåŠŸè¿”å›ã€‚ æ€»ç»“å…¶å®ç½‘ä¸Šè¿˜æœ‰å…¶ä»–çš„æ–¹æ³•æ¥å¤„ç†è·¨åŸŸé—®é¢˜ï¼Œä¸è¿‡æˆ‘è§‰å¾—è¿™æ ·çš„æ–¹å¼æœ€ä¸ºç®€å•ã€‚åŒæ ·JSONPä¹Ÿæ˜¯æœ‰ç¼ºç‚¹çš„ï¼Œæ¯”å¦‚ï¼šåªæ”¯æŒGETæ–¹å¼çš„HTTPè¯·æ±‚ã€‚ä»¥ä¸Šä»£ç ä¾ç„¶åœ¨åšä¸»çš„SSMé¡¹ç›®ä¸­ï¼Œå¦‚æœ‰éœ€è¦å¯ä»¥ç›´æ¥FORKã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.git ä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚ GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JSONP</tag>
        <tag>JSON</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linuxï¼ˆäºŒï¼‰æœåŠ¡å™¨è¿è¡Œç¯å¢ƒé…ç½®]]></title>
    <url>%2F2016%2F09%2F20%2FLinux-normal2%2F</url>
    <content type="text"><![CDATA[å‰è¨€Linuxç›¸ä¿¡å¯¹å¤§å¤šæ•°ç¨‹åºå‘˜æ¥è¯´éƒ½ä¸é™Œç”Ÿï¼Œæ¯•ç«Ÿåœ¨æœåŠ¡å™¨ç«¯ä¾ç„¶è¿˜æ˜¯éœ¸ä¸»åœ°ä½è€Œä¸”ä¸æ¯«æ²¡æœ‰é€€å±…äºŒçº¿çš„æ„æ€ï¼Œä»¥è‡³äºç°åœ¨å‡ ä¹æ¯ä¸€ä¸ªè½¯ä»¶å¼€å‘çš„ç›¸å…³äººå‘˜éƒ½å¾—æˆ–å¤šæˆ–å°‘çš„çŸ¥é“ä¸€äº›Linuxçš„ç›¸å…³å†…å®¹ï¼Œæœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨åˆšæ‹¿åˆ°ä¸€å°äº‘æœåŠ¡å™¨(é‡‡ç”¨centos)æ¥è¿›è¡Œè¿è¡Œç¯å¢ƒçš„æ­å»ºï¼ŒåŒ…æ‹¬JDKã€Mysqlã€Tomcatä»¥åŠnginxã€‚ç›¸ä¿¡å¯¹äºå°ç™½æ¥è¯´å¾ˆæœ‰å¿…è¦çš„ï¼Œä¹Ÿæ˜¯æˆ‘ä¸ªäººçš„ä¸€ä¸ªè®°å½•ã€‚ è¯¥æœåŠ¡å™¨çš„ç”¨é€”æ˜¯ç”¨äºéƒ¨ç½²JavaEEé¡¹ç›®ã€‚éƒ¨ç½²ä¹‹åçš„æ•ˆæœå›¾å¦‚ä¸‹: JDKå®‰è£…ç”±äºæˆ‘ä»¬ä¹‹åéœ€è¦éƒ¨ç½²çš„æ˜¯JavaEEé¡¹ç›®ï¼Œæ‰€ä»¥é¦–å…ˆç¬¬ä¸€æ­¥å°±æ˜¯å®‰è£…JDKäº†ã€‚ å¸è½½è‡ªå¸¦çš„openJDKç°åœ¨çš„æœåŠ¡å™¨æ‹¿æ¥ä¹‹åä¸€èˆ¬éƒ½æ˜¯é»˜è®¤ç»™æˆ‘ä»¬å®‰è£…ä¸€ä¸ªopenJDKï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦å¸è½½æ‰ã€‚ ä½¿ç”¨rpm -qa | grep javaå‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨æœ‰Javaã€‚ ä½¿ç”¨rpm -e --nodeps ç›¸å…³åº”ç”¨åç§°æ¥è¿›è¡Œå¸è½½ã€‚(ç›¸å…³åº”ç”¨åç§°å°±æ˜¯ä¸Šä¸€ä¸ªå‘½ä»¤ä¸­æ˜¾ç¤ºå‡ºæ¥çš„åç§°å¤åˆ¶åˆ°è¿™é‡Œå¸è½½å³å¯)ã€‚ ä¸‹è½½å¹¶å®‰è£…JDK ä¹‹åæ˜¯ä¸‹è½½ORACLEæ‰€æä¾›çš„JDKï¼Œä¼ é€é—¨æ ¹æ®è‡ªå·±ç³»ç»Ÿçš„æƒ…å†µä¸‹è½½å¯¹åº”ç‰ˆæœ¬å³å¯ã€‚ç¬”è€…ä½¿ç”¨çš„æ˜¯jdk-8u101-linux-x64.rpmç‰ˆæœ¬ã€‚ ç„¶åä½¿ç”¨FTPå·¥å…·ä¸Šä¼ åˆ°/usr/javaç›®å½•ä¸‹å³å¯ï¼Œæ²¡æœ‰javaç›®å½•æ–°å»ºä¸€ä¸ªå³å¯ã€‚ ç„¶åä½¿ç”¨rpm -ivh jdk-8u101-linux-x64.rpmå‘½ä»¤è¿›è¡Œè§£å‹å®‰è£…ã€‚ profileæ–‡ä»¶é…ç½®å®‰è£…å®Œæˆä¹‹åä½¿ç”¨vi /etc/profileå‘½ä»¤ç¼–è¾‘profileæ–‡ä»¶(æ³¨æ„è¯¥æ–‡ä»¶è·¯å¾„æ˜¯æŒ‡æ ¹ç›®å½•ä¸‹çš„etcæ–‡ä»¶å¤¹ä¸è¦æ‰¾é”™äº†)ã€‚åœ¨è¯¥æ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š123export JAVA_HOME=/usr/java/jdk-8u101-linux-x64export CLASSPATH=.:$JAVA_HOME/jre/lib/rt.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jarexport PATH=$PATH:$JAVA_HOME/bin ä¿å­˜ä¹‹åè¿è¡Œsource /etc/profileä½¿é…ç½®ç”Ÿæ•ˆã€‚ éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸä¹‹åæˆ‘ä»¬ä½¿ç”¨åœ¨windowså¹³å°ä¹Ÿæœ‰çš„å‘½ä»¤java -versionï¼Œå¦‚æœè¾“å‡ºå¦‚å›¾ï¼šè¡¨ç¤ºå®‰è£…æˆåŠŸã€‚ MySQLå®‰è£…å¸è½½è‡ªå¸¦çš„Mysqlé¦–å…ˆç¬¬ä¸€æ­¥è¿˜æ˜¯è¦å¸è½½æ‰è‡ªå¸¦çš„mysqlã€‚rpm -e --nodeps mysqlå‘½ä»¤å’Œä¹‹å‰ä¸€æ ·åªæ˜¯æŠŠåº”ç”¨åç§°æ¢æˆmysqläº†è€Œå·²ã€‚ ä½¿ç”¨yumæ¥å®‰è£…mysqlä¹‹åæˆ‘ä»¬é‡‡ç”¨yumæ¥å®‰è£…mysqlã€‚è¿™æ ·çš„æ–¹å¼æœ€ç®€å•ä¾¿æ·ã€‚yum install -y mysql-server mysql mysql-deveæ‰§è¡Œè¯¥å‘½ä»¤ç›´åˆ°å‡ºç°Complete!æç¤ºä¹‹åè¡¨ç¤ºå®‰è£…æˆåŠŸã€‚rpm -qi mysql-serverä¹‹åä½¿ç”¨è¯¥å‘½ä»¤å¯ä»¥æŸ¥çœ‹æˆ‘ä»¬å®‰è£…çš„mysqlä¿¡æ¯ã€‚ mysqlç›¸å…³é…ç½®ä½¿ç”¨service mysqld startæ¥å¯åŠ¨mysqlæœåŠ¡(ç¬¬ä¸€æ¬¡ä¼šè¾“å‡ºå¾ˆå¤šä¿¡æ¯)ï¼Œä¹‹åå°±ä¸ä¼šäº†ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨chkconfig mysqld onå‘½ä»¤å°†mysqlè®¾ç½®ä¸ºå¼€æœºå¯åŠ¨ã€‚è¾“å…¥chkconfig --list | grep mysqlå‘½ä»¤æ˜¾ç¤ºå¦‚ä¸‹å›¾ï¼šè¡¨ç¤ºè®¾ç½®æˆåŠŸã€‚ä½¿ç”¨mysqladmin -u root password &#39;root&#39;ä¸ºrootè´¦æˆ·è®¾ç½®å¯†ç ã€‚ è®¾ç½®è¿œç¨‹ä½¿ç”¨1234grant all privileges on *.* to &apos;root&apos;@&apos;%&apos; identified by &apos;123456&apos; with grant option;# rootæ˜¯ç”¨æˆ·åï¼Œ%ä»£è¡¨ä»»æ„ä¸»æœºï¼Œ&apos;123456&apos;æŒ‡å®šçš„ç™»å½•å¯†ç ï¼ˆè¿™ä¸ªå’Œæœ¬åœ°çš„rootå¯†ç å¯ä»¥è®¾ç½®ä¸åŒçš„ï¼Œäº’ä¸å½±å“ï¼‰flush privileges; # é‡è½½ç³»ç»Ÿæƒé™exit; éªŒè¯ä½¿ç”¨ä½¿ç”¨mysql -u root -prootæ¥ç™»å½•mysqlã€‚å¦‚æœå‡ºç°ä»¥ä¸‹ç•Œé¢è¡¨ç¤ºè®¾ç½®æˆåŠŸã€‚ Tomcatå®‰è£…Tomcatä¹Ÿæ˜¯æˆ‘ä»¬è¿è¡ŒJavaEEé¡¹ç›®å¿…å¤‡çš„ä¸€ä¸ªä¸­é—´ä»¶ã€‚ ç¬¬ä¸€æ­¥éœ€è¦ä¸‹è½½linuxçš„Tomcatï¼Œä¼ é€é—¨ã€‚æ ¹æ®è‡ªå·±ç³»ç»Ÿç‰ˆæœ¬è¿›è¡Œä¸‹è½½å³å¯ã€‚ä¹‹åå°†apache-tomcat-8.5.5.tar.gzä¸Šä¼ åˆ°/usr/localç›®å½•ä¸­ã€‚ è§£å‹è¯¥å‹ç¼©åŒ…tar -zxv -f apache-tomcat-8.5.5.tar.gz,å†ä½¿ç”¨mv apache-tomcat-8.5.5 tomcatå°†è§£å‹çš„Tomcatç§»åŠ¨åˆ°å¤–å±‚çš„Tomcatç›®å½•ä¸­ã€‚ è¿›å…¥/usr/local/tomcat/apache-tomcat-8.5.5/binç›®å½•ä½¿ç”¨./startup.batå‘½ä»¤å¯åŠ¨tomcatã€‚ å› ä¸ºtomcatä½¿ç”¨çš„é»˜è®¤ç«¯å£æ˜¯8080ï¼Œlinuxé˜²ç«å¢™é»˜è®¤æ˜¯ä¸èƒ½è®¿é—®çš„ï¼Œéœ€è¦æ‰‹åŠ¨å°†å…¶æ‰“å¼€ã€‚ä½¿ç”¨vi + /etc/sysconfig/iptablesç¼–è¾‘iptables(æ³¨æ„etcç›®å½•æ˜¯æ ¹ç›®å½•ä¸‹çš„)ï¼ŒåŠ å…¥ä»¥ä¸‹ä»£ç :12-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 8080 -j ACCEPT-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT è¿™é‡Œæˆ‘ä»¬å¼€æ”¾äº†8080å’Œ80ç«¯å£ï¼Œä¹‹åå®‰è£…nginxå°±ä¸ç”¨åœ¨å¼€æ”¾äº†ã€‚ ps:è¿™é‡Œç”¨åˆ°äº†ç®€å•çš„vimå‘½ä»¤ã€‚æŒ‰iè¿›å…¥æ’å…¥æ¨¡å¼ï¼Œè¾“å…¥ä¸Šé¢ä¸¤æ®µä»£ç ã€‚ä¹‹åæŒ‰escé€€å‡ºæ’å…¥æ¨¡å¼ã€‚å†æŒ‰:wqä¿å­˜å…³é—­å³å¯ã€‚ä¹‹åä½¿ç”¨service iptables restartå‘½ä»¤é‡å¯é˜²ç«å¢™å³å¯ã€‚åœ¨æµè§ˆå™¨è¾“å…¥æœåŠ¡å™¨çš„ip+8080å¦‚æœå‡ºç°Tomcatçš„æ¬¢è¿é¡µå³è¡¨æ˜Tomcatå®‰è£…æˆåŠŸã€‚ nginxå®‰è£…æœ€åæ˜¯å®‰è£…nginxï¼Œè¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨æœ€ç®€å•çš„yumçš„æ–¹å¼æ¥è¿›è¡Œå®‰è£…ã€‚ é¦–å…ˆä½¿ç”¨ä»¥ä¸‹å‡ ä¸ªå‘½ä»¤å®‰è£…å¿…å¤‡çš„å‡ ä¸ªåº“ï¼š 123yum -y install pcre*yum -y install openssl*yum -y install gcc ä¹‹åå®‰è£…nginxã€‚ 1234567cd /usr/local/wget http://nginx.org/download/nginx-1.4.2.tar.gztar -zxvf nginx-1.4.2.tar.gzcd nginx-1.4.2 ./configure --prefix=/usr/local/nginx --with-http_stub_status_modulemakemake install ä¹‹åå°±å¯ä»¥ä½¿ç”¨/usr/local/nginx/sbin/nginxå‘½ä»¤æ¥å¯åŠ¨nginxäº†ã€‚è¾“å…¥æœåŠ¡å™¨çš„IPåœ°å€ï¼Œå¦‚æœå‡ºç°nginxçš„æ¬¢è¿ç•Œé¢è¡¨ç¤ºå®‰è£…æˆåŠŸäº†ã€‚ nginxé…ç½®è¿™é‡Œæˆ‘å°±ç®€å•è´´ä»¥ä¸‹æˆ‘çš„é…ç½®ï¼Œä¸»è¦å°±æ˜¯é…ç½®ä¸€ä¸ªupstream,ä¹‹ååœ¨serverä¸­å¼•ç”¨é…ç½®çš„é‚£ä¸ªupstreamå³å¯ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125#user nobody;worker_processes 1;#error_log logs/error.log;#error_log logs/error.log notice;#error_log logs/error.log info;#pid logs/nginx.pid;events &#123; worker_connections 1024;&#125;http &#123; include mime.types; default_type application/octet-stream; #log_format main &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos; # &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos; # &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;; #access_log logs/access.log main; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; upstream crossover_main &#123; server 127.0.0.1:8080; &#125; server &#123; listen 80; server_name www.crossoverjie.top; #charset koi8-r; #access_log logs/host.access.log main; location / &#123; proxy_pass http://crossover_main/examples/; proxy_set_header Host $http_host; proxy_set_header X-Forwarded-For $remote_addr; index index.jsp; &#125; #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125; # proxy the PHP scripts to Apache listening on 127.0.0.1:80 # #location ~ \.php$ &#123; # proxy_pass http://127.0.0.1; #&#125; # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000 # #location ~ \.php$ &#123; # root html; # fastcgi_pass 127.0.0.1:9000; # fastcgi_index index.php; # fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name; # include fastcgi_params; #&#125; # deny access to .htaccess files, if Apache&apos;s document root # concurs with nginx&apos;s one # #location ~ /\.ht &#123; # deny all; #&#125; &#125; # another virtual host using mix of IP-, name-, and port-based configuration # #server &#123; # listen 8000; # listen somename:8080; # server_name somename alias another.alias; # location / &#123; # root html; # index index.html index.htm; # &#125; #&#125; # HTTPS server # #server &#123; # listen 443; # server_name localhost; # ssl on; # ssl_certificate cert.pem; # ssl_certificate_key cert.key; # ssl_session_timeout 5m; # ssl_protocols SSLv2 SSLv3 TLSv1; # ssl_ciphers HIGH:!aNULL:!MD5; # ssl_prefer_server_ciphers on; # location / &#123; # root html; # index index.html index.htm; # &#125; #&#125;&#125; ä¹‹åæˆ‘ä»¬åœ¨åœ°å€æ è¾“å…¥æœåŠ¡å™¨çš„IPåœ°å€(å¦‚æœæœ‰åŸŸåè§£æäº†æœåŠ¡å™¨çš„IPå¯ä»¥ç›´æ¥è¾“å…¥åŸŸå)å°±ä¼šè¿›å…¥æˆ‘ä»¬åœ¨upstreamä¸­é…ç½®çš„åœ°å€åŠ ä¸Šåœ¨serverä¸­çš„åœ°å€ã€‚æ ¹æ®æˆ‘è¿™é‡Œçš„é…ç½®æœ€åè§£æåœ°å€å°±æ˜¯http://127.0.0.1:8080/examplesåº”è¯¥æ˜¯å¾ˆå¥½ç†è§£çš„ã€‚æœ€ç»ˆçš„ç»“æœæ˜¯æˆ‘åœ¨ç‰‡å¤´æ”¾çš„é‚£å¼ æˆªå›¾ä¸€æ ·ã€‚ æ€»ç»“è¿™æ˜¯ä¸€ä¸ªç®€å•çš„åŸºäºcentOSçš„è¿è¡Œç¯å¢ƒé…ç½®ï¼Œå¯¹äºå°ç™½ç»ƒæ‰‹åº”è¯¥æ˜¯å¤Ÿäº†ï¼Œæœ‰ä¸æ¸…æ¥šå’Œé”™è¯¯çš„åœ°æ–¹æ¬¢è¿æŒ‡å‡ºåæ­£æˆ‘ä¹Ÿä¸ä¼šå›å¤ã€‚ ä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚ GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>Linuxç¬”è®°</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>centos</tag>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(äº”)åŸºäºwebSocketçš„èŠå¤©å®¤]]></title>
    <url>%2F2016%2F09%2F04%2FSSM5%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¸çŸ¥å¤§å®¶åœ¨å¹³æ—¶çš„éœ€æ±‚ä¸­æœ‰æ²¡æœ‰é‡åˆ°éœ€è¦å®æ—¶å¤„ç†ä¿¡æ¯çš„æƒ…å†µï¼Œå¦‚ç«™å†…ä¿¡ï¼Œè®¢é˜…ï¼ŒèŠå¤©ä¹‹ç±»çš„ã€‚åœ¨è¿™ä¹‹å‰æˆ‘ä»¬é€šå¸¸æƒ³åˆ°çš„æ–¹æ³•ä¸€èˆ¬éƒ½æ˜¯é‡‡ç”¨è½®è®­çš„æ–¹å¼æ¯éš”ä¸€å®šçš„æ—¶é—´å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ä»è€Œè·å¾—æœ€æ–°çš„æ•°æ®ï¼Œä½†è¿™æ ·ä¼šæµªè´¹æ‰å¾ˆå¤šçš„èµ„æºå¹¶ä¸”ä¹Ÿä¸æ˜¯å®æ—¶çš„ï¼Œäºæ˜¯éšç€HTML5çš„æ¨å‡ºå¸¦æ¥äº†websocketå¯ä»¥æ ¹æœ¬çš„è§£å†³ä»¥ä¸Šé—®é¢˜å®ç°çœŸæ­£çš„å®æ—¶ä¼ è¾“ã€‚ websocketæ˜¯ä»€ä¹ˆï¼Ÿè‡³äºwebsocketæ˜¯ä»€ä¹ˆã€æœ‰ä»€ä¹ˆç”¨è¿™æ ·çš„é—®é¢˜ä¸€Googleä¸€å¤§æŠŠï¼Œè¿™é‡Œæˆ‘å°±ç®€è¦çš„è¯´äº›websocketå†æœ¬æ¬¡å®ä¾‹ä¸­çš„ä½œç”¨å§ã€‚ç”±äºåœ¨æœ¬æ¬¡å®ä¾‹ä¸­éœ€è¦å®ç°çš„æ˜¯ä¸€ä¸ªèŠå¤©å®¤ï¼Œä¸€ä¸ªå®æ—¶çš„èŠå¤©å®¤ã€‚å¦‚ä¸‹å›¾ï¼š é‡‡ç”¨websocketä¹‹åå¯ä»¥è®©å‰ç«¯å’Œå’Œåç«¯åƒC/Sæ¨¡å¼ä¸€æ ·å®æ—¶é€šä¿¡ï¼Œä¸å†éœ€è¦æ¯æ¬¡å•ç‹¬å‘é€è¯·æ±‚ã€‚ç”±äºæ˜¯åŸºäºH5çš„æ‰€ä»¥å¯¹äºè€çš„æµè§ˆå™¨å¦‚IE7ã€IE8ä¹‹ç±»çš„å°±æ²¡åŠæ³•äº†ï¼Œä¸è¿‡H5æ˜¯å¤§åŠ¿æ‰€è¶‹è¿™ç‚¹ä¸ç”¨æ‹…å¿ƒã€‚ åç«¯æ—¢ç„¶æ¨å‡ºäº†websocketï¼Œä½œä¸ºç°åœ¨ä¸»æµçš„Javaè‚¯å®šä¹Ÿæœ‰ç›¸åº”çš„æ”¯æŒï¼Œæ‰€ä»¥åœ¨JavaEE7ä¹‹åä¹Ÿå¯¹websocketåšå‡ºäº†è§„èŒƒï¼Œæ‰€ä»¥æœ¬æ¬¡çš„ä»£ç ç†è®ºä¸Šæ˜¯è¦è¿è¡Œåœ¨Java1.7+å’ŒTomcat7.0+ä¹‹ä¸Šçš„ã€‚çœ‹è¿‡æˆ‘å‰é¢å‡ ç¯‡æ–‡ç« çš„æœ‹å‹åº”è¯¥éƒ½çŸ¥é“æœ¬æ¬¡å®ä¾‹ä¹Ÿæ˜¯è¿è¡Œåœ¨ä¹‹å‰çš„SSMä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚é¦–å…ˆç¬¬ä¸€æ­¥éœ€è¦åŠ å…¥websocketçš„ä¾èµ–ï¼š123456789101112&lt;!-- https://mvnrepository.com/artifact/javax.websocket/javax.websocket-api --&gt;&lt;dependency&gt; &lt;groupId&gt;javax.websocket&lt;/groupId&gt; &lt;artifactId&gt;javax.websocket-api&lt;/artifactId&gt; &lt;version&gt;1.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-websocket&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;&lt;/dependency&gt; ä»¥ä¸Šå°±æ˜¯ä½¿ç”¨websocketæ‰€éœ€è¦ç”¨åˆ°çš„åŒ…ã€‚spring-websocketè¿™ä¸ªä¸»è¦æ˜¯åœ¨ä¹‹åéœ€è¦åœ¨websocketçš„åç«¯æ³¨å…¥serviceæ‰€éœ€è¦çš„ã€‚ä¹‹åå†çœ‹ä¸€ä¸‹åç«¯çš„æ ¸å¿ƒä»£ç MyWebSocket.java123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135package com.crossoverJie.controller;/** * Created by Administrator on 2016/8/7. */import com.crossoverJie.pojo.Content;import com.crossoverJie.service.ContentService;import org.apache.camel.BeanInject;import org.apache.camel.EndpointInject;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Component;import org.springframework.stereotype.Controller;import org.springframework.web.context.support.SpringBeanAutowiringSupport;import org.springframework.web.socket.server.standard.SpringConfigurator;import java.io.IOException;import java.text.SimpleDateFormat;import java.util.Date;import java.util.concurrent.CopyOnWriteArraySet;import javax.annotation.PostConstruct;import javax.websocket.OnClose;import javax.websocket.OnError;import javax.websocket.OnMessage;import javax.websocket.OnOpen;import javax.websocket.Session;import javax.websocket.server.ServerEndpoint;//è¯¥æ³¨è§£ç”¨æ¥æŒ‡å®šä¸€ä¸ªURIï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¿™ä¸ªURIæ¥è¿æ¥åˆ°WebSocketã€‚/** ç±»ä¼¼Servletçš„æ³¨è§£mappingã€‚æ— éœ€åœ¨web.xmlä¸­é…ç½®ã€‚ * configurator = SpringConfigurator.classæ˜¯ä¸ºäº†ä½¿è¯¥ç±»å¯ä»¥é€šè¿‡Springæ³¨å…¥ã€‚ */@ServerEndpoint(value = "/websocket",configurator = SpringConfigurator.class)public class MyWebSocket &#123; //é™æ€å˜é‡ï¼Œç”¨æ¥è®°å½•å½“å‰åœ¨çº¿è¿æ¥æ•°ã€‚åº”è¯¥æŠŠå®ƒè®¾è®¡æˆçº¿ç¨‹å®‰å…¨çš„ã€‚ private static int onlineCount = 0; public MyWebSocket() &#123; &#125; @Autowired private ContentService contentService ; //concurrentåŒ…çš„çº¿ç¨‹å®‰å…¨Setï¼Œç”¨æ¥å­˜æ”¾æ¯ä¸ªå®¢æˆ·ç«¯å¯¹åº”çš„MyWebSocketå¯¹è±¡ã€‚ // è‹¥è¦å®ç°æœåŠ¡ç«¯ä¸å•ä¸€å®¢æˆ·ç«¯é€šä¿¡çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨Mapæ¥å­˜æ”¾ï¼Œå…¶ä¸­Keyå¯ä»¥ä¸ºç”¨æˆ·æ ‡è¯† private static CopyOnWriteArraySet&lt;MyWebSocket&gt; webSocketSet = new CopyOnWriteArraySet&lt;MyWebSocket&gt;(); //ä¸å®¢æˆ·ç«¯çš„è¿æ¥ä¼šè¯ï¼Œéœ€è¦é€šè¿‡å®ƒæ¥ç»™å®¢æˆ·ç«¯å‘é€æ•°æ® private Session session; /** * è¿æ¥å»ºç«‹æˆåŠŸè°ƒç”¨çš„æ–¹æ³• * @param session å¯é€‰çš„å‚æ•°ã€‚sessionä¸ºä¸æŸä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ä¼šè¯ï¼Œéœ€è¦é€šè¿‡å®ƒæ¥ç»™å®¢æˆ·ç«¯å‘é€æ•°æ® */ @OnOpen public void onOpen(Session session)&#123; this.session = session; webSocketSet.add(this); //åŠ å…¥setä¸­ addOnlineCount(); //åœ¨çº¿æ•°åŠ 1 System.out.println("æœ‰æ–°è¿æ¥åŠ å…¥ï¼å½“å‰åœ¨çº¿äººæ•°ä¸º" + getOnlineCount()); &#125; /** * è¿æ¥å…³é—­è°ƒç”¨çš„æ–¹æ³• */ @OnClose public void onClose()&#123; webSocketSet.remove(this); //ä»setä¸­åˆ é™¤ subOnlineCount(); //åœ¨çº¿æ•°å‡1 System.out.println("æœ‰ä¸€è¿æ¥å…³é—­ï¼å½“å‰åœ¨çº¿äººæ•°ä¸º" + getOnlineCount()); &#125; /** * æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯åè°ƒç”¨çš„æ–¹æ³• * @param message å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ¶ˆæ¯ * @param session å¯é€‰çš„å‚æ•° */ @OnMessage public void onMessage(String message, Session session) &#123; System.out.println("æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯:" + message); //ç¾¤å‘æ¶ˆæ¯ for(MyWebSocket item: webSocketSet)&#123; try &#123; item.sendMessage(message); &#125; catch (IOException e) &#123; e.printStackTrace(); continue; &#125; &#125; &#125; /** * å‘ç”Ÿé”™è¯¯æ—¶è°ƒç”¨ * @param session * @param error */ @OnError public void onError(Session session, Throwable error)&#123; System.out.println("å‘ç”Ÿé”™è¯¯"); error.printStackTrace(); &#125; /** * è¿™ä¸ªæ–¹æ³•ä¸ä¸Šé¢å‡ ä¸ªæ–¹æ³•ä¸ä¸€æ ·ã€‚æ²¡æœ‰ç”¨æ³¨è§£ï¼Œæ˜¯æ ¹æ®è‡ªå·±éœ€è¦æ·»åŠ çš„æ–¹æ³•ã€‚ * @param message * @throws IOException */ public void sendMessage(String message) throws IOException&#123; //ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“ Content content = new Content() ; content.setContent(message); SimpleDateFormat sm = new SimpleDateFormat("yyyy-MM-dd HH:mm:dd") ; content.setCreateDate(sm.format(new Date())); contentService.insertSelective(content) ; this.session.getBasicRemote().sendText(message); //this.session.getAsyncRemote().sendText(message); &#125; public static synchronized int getOnlineCount() &#123; return onlineCount; &#125; public static synchronized void addOnlineCount() &#123; MyWebSocket.onlineCount++; &#125; public static synchronized void subOnlineCount() &#123; MyWebSocket.onlineCount--; &#125;&#125; è¿™å°±æ˜¯æ•´ä¸ªwebsocketçš„åç«¯ä»£ç ã€‚çœ‹èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ä¸»è¦å°±æ˜¯ä½¿ç”¨é‚£å‡ ä¸ªæ³¨è§£ã€‚æ¯å½“æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯è¿å…¥ã€å…³é—­ã€å‘é€æ¶ˆæ¯éƒ½ä¼šè°ƒç”¨å„è‡ªæ³¨è§£çš„æ–¹æ³•ã€‚è¿™é‡Œæˆ‘è®²ä¸€ä¸‹sendMessage()è¿™ä¸ªæ–¹æ³•ã€‚ websocketç»•å‘åœ¨sendMessage()æ–¹æ³•ä¸­æˆ‘åªæƒ³å®ç°ä¸€ä¸ªç®€å•çš„åŠŸèƒ½ï¼Œå°±æ˜¯å°†æ¯æ¬¡çš„èŠå¤©è®°å½•éƒ½å­˜åˆ°æ•°æ®åº“ä¸­ã€‚çœ‹ä¼¼ä¸€ä¸ªç®€å•çš„åŠŸèƒ½ç¡¬æ˜¯èŠ±äº†æˆ‘åŠå¤©çš„æ—¶é—´ã€‚æˆ‘å…ˆæ˜¯æŒ‰ç…§ä»¥å‰çš„æƒ¯æ€§æ€ç»´åªéœ€è¦åœ¨è¿™ä¸ªç±»ä¸­æ³¨å…¥serviceå³å¯ã€‚ä½†æ˜¯æ— è®ºæ€ä¹ˆå¼„æ¯æ¬¡éƒ½æ³¨å…¥ä¸è¿›æ¥éƒ½æ˜¯nullã€‚æœ€åæ²¡åŠæ³•åªæœ‰googleäº†ï¼Œæœ€åç»ˆäºåœ¨ç¥çº§ç¤¾åŒºStackOverFlowä¸­æ‰¾åˆ°äº†ç­”æ¡ˆï¼Œå°±æ˜¯å‰è¾¹æ‰€è¯´çš„éœ€è¦æ·»åŠ çš„ç¬¬äºŒä¸ª mavenä¾èµ–ï¼Œç„¶ååŠ å…¥@ServerEndpoint(value = &quot;/websocket&quot;,configurator = SpringConfigurator.class)è¿™ä¸ªæ³¨è§£å³å¯åˆ©ç”¨Springæ³¨å…¥äº†ã€‚æ¥ç€å°±å¯ä»¥åšæ¶ˆæ¯çš„ä¿å­˜äº†ã€‚ å‰ç«¯å‰ç«¯æˆ‘é‡‡ç”¨äº†Bootstrapåšçš„ï¼Œä¸å¤ªæ¸…æ¥šBootstrapçš„ç«¥é‹å»ºè®®å…ˆçœ‹ä¸‹å®˜æ–¹æ–‡æ¡£ä¹Ÿæ¯”è¾ƒç®€å•ã€‚è¿˜æ˜¯å…ˆè´´ä¸€ä¸‹ä»£ç ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146&lt;%@ page language="java" import="java.util.*" pageEncoding="UTF-8" %&gt;&lt;% String path = request.getContextPath(); String basePath = request.getScheme() + "://" + request.getServerName() + ":" + request.getServerPort() + path + "/";%&gt;&lt;!DOCTYPE HTML&gt;&lt;html&gt;&lt;head&gt; &lt;base href="&lt;%=basePath%&gt;"&gt; &lt;!-- Bootstrap --&gt; &lt;link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css"&gt; &lt;!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries --&gt; &lt;!-- WARNING: Respond.js doesn't work if you view the page via file:// --&gt; &lt;!--[if lt IE 9]&gt; &lt;script src="//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"&gt;&lt;/script&gt; &lt;script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"&gt;&lt;/script&gt; &lt;![endif]--&gt; &lt;script type="text/javascript" charset="utf-8" src="&lt;%=path%&gt;/ueditor/ueditor.config.js"&gt;&lt;/script&gt; &lt;script type="text/javascript" charset="utf-8" src="&lt;%=path%&gt;/ueditor/ueditor.all.min.js"&gt; &lt;/script&gt; &lt;!--å»ºè®®æ‰‹åŠ¨åŠ åœ¨è¯­è¨€ï¼Œé¿å…åœ¨ieä¸‹æœ‰æ—¶å› ä¸ºåŠ è½½è¯­è¨€å¤±è´¥å¯¼è‡´ç¼–è¾‘å™¨åŠ è½½å¤±è´¥--&gt; &lt;!--è¿™é‡ŒåŠ è½½çš„è¯­è¨€æ–‡ä»¶ä¼šè¦†ç›–ä½ åœ¨é…ç½®é¡¹ç›®é‡Œæ·»åŠ çš„è¯­è¨€ç±»å‹ï¼Œæ¯”å¦‚ä½ åœ¨é…ç½®é¡¹ç›®é‡Œé…ç½®çš„æ˜¯è‹±æ–‡ï¼Œè¿™é‡ŒåŠ è½½çš„ä¸­æ–‡ï¼Œé‚£æœ€åå°±æ˜¯ä¸­æ–‡--&gt; &lt;script type="text/javascript" charset="utf-8" src="&lt;%=path%&gt;/ueditor/lang/zh-cn/zh-cn.js"&gt;&lt;/script&gt; &lt;title&gt;èŠå¤©å®¤&lt;/title&gt;&lt;/head&gt;&lt;body data="/ssm"&gt;&lt;input id="text" type="text"/&gt;&lt;button onclick="send()"&gt;å‘é€&lt;/button&gt;&lt;button onclick="closeWebSocket()"&gt;å…³é—­è¿æ¥&lt;/button&gt;&lt;div id="message"&gt;&lt;/div&gt;&lt;div class="container-fluid"&gt; &lt;div class="row"&gt; &lt;div class="col-md-12"&gt; &lt;div class="panel panel-primary"&gt; &lt;div class="panel-heading"&gt;èŠå¤©å®¤&lt;/div&gt; &lt;div id="msg" class="panel-body"&gt; &lt;/div&gt; &lt;div class="panel-footer"&gt; åœ¨çº¿äººæ•°&lt;span id="onlineCount"&gt;1&lt;/span&gt;äºº &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;div class="container-fluid"&gt; &lt;div class="row"&gt; &lt;div class="col-md-12"&gt; &lt;script id="editor" type="text/plain" style="width:1024px;height:200px;"&gt;&lt;/script&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;div class="container-fluid"&gt; &lt;div class="row"&gt; &lt;div class="col-md-12"&gt; &lt;p class="text-right"&gt; &lt;button onclick="sendMsg();" class="btn btn-success"&gt;å‘é€&lt;/button&gt; &lt;/p&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;script type="text/javascript"&gt; var ue = UE.getEditor('editor'); var websocket = null; //åˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebSocket if ('WebSocket' in window) &#123; websocket = new WebSocket("ws://192.168.0.102:8080/ssm/websocket"); &#125; else &#123; alert("å¯¹ä¸èµ·ï¼ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒwebSocket") &#125; //è¿æ¥å‘ç”Ÿé”™è¯¯çš„å›è°ƒæ–¹æ³• websocket.onerror = function () &#123; setMessageInnerHTML("error"); &#125;; //è¿æ¥æˆåŠŸå»ºç«‹çš„å›è°ƒæ–¹æ³• websocket.onopen = function (event) &#123; setMessageInnerHTML("åŠ å…¥è¿æ¥"); &#125;; //æ¥æ”¶åˆ°æ¶ˆæ¯çš„å›è°ƒæ–¹æ³• websocket.onmessage = function (event) &#123; setMessageInnerHTML(event.data); &#125;; //è¿æ¥å…³é—­çš„å›è°ƒæ–¹æ³• websocket.onclose = function () &#123; setMessageInnerHTML("æ–­å¼€è¿æ¥"); &#125;; //ç›‘å¬çª—å£å…³é—­äº‹ä»¶ï¼Œå½“çª—å£å…³é—­æ—¶ï¼Œä¸»åŠ¨å»å…³é—­websocketè¿æ¥ï¼Œ // é˜²æ­¢è¿æ¥è¿˜æ²¡æ–­å¼€å°±å…³é—­çª—å£ï¼Œserverç«¯ä¼šæŠ›å¼‚å¸¸ã€‚ window.onbeforeunload = function () &#123; var is = confirm("ç¡®å®šå…³é—­çª—å£ï¼Ÿ"); if (is)&#123; websocket.close(); &#125; &#125;; //å°†æ¶ˆæ¯æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Š function setMessageInnerHTML(innerHTML) &#123; $("#msg").append(innerHTML+"&lt;br/&gt;") &#125;; //å…³é—­è¿æ¥ function closeWebSocket() &#123; websocket.close(); &#125; //å‘é€æ¶ˆæ¯ function send() &#123; var message = $("#text").val() ; websocket.send(message); $("#text").val("") ; &#125; function sendMsg()&#123; var msg = ue.getContent(); websocket.send(msg); ue.setContent(''); &#125;&lt;/script&gt;&lt;!-- jQuery (necessary for Bootstrap's JavaScript plugins) --&gt;&lt;script src="http://cdn.bootcss.com/jquery/1.11.3/jquery.min.js"&gt;&lt;/script&gt;&lt;!-- Include all compiled plugins (below), or include individual files as needed --&gt;&lt;script src="http://cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"&gt;&lt;/script&gt;&lt;script type="text/javascript" src="&lt;%=path%&gt;/js/Globals.js"&gt;&lt;/script&gt;&lt;script type="text/javascript" src="&lt;%=path%&gt;/js/websocket.js"&gt;&lt;/script&gt;&lt;/html&gt; å…¶å®å…¶ä¸­é‡è¦çš„å°±æ˜¯é‚£å‡ ä¸ªJSæ–¹æ³•ï¼Œéƒ½å†™æœ‰æ³¨é‡Šã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œ1234567//åˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebSocketif ('WebSocket' in window) &#123; websocket = new WebSocket("ws://192.168.0.102:8080/ssm/websocket");&#125;else &#123; alert("å¯¹ä¸èµ·ï¼ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒwebSocket")&#125; å½“é¡¹ç›®è·‘èµ·æ¥ä¹‹åéœ€è¦å°†è¿™é‡Œçš„åœ°å€æ”¹ä¸ºä½ é¡¹ç›®çš„åœ°å€å³å¯ã€‚å“¦å¯¹äº†ï¼Œæˆ‘åœ¨è¿™é‡Œé‡‡ç”¨äº†ç™¾åº¦çš„ä¸€ä¸ªUeditorçš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨(è™½ç„¶ç™¾åº¦æœç´¢æˆ‘ç°åœ¨å¾ˆå°‘ç”¨äº†ï¼Œä½†æ˜¯è¿™ä¸ªç¼–è¾‘å™¨ç¡®å®è¿˜ä¸é”™)ï¼Œè¿™ä¸ªç¼–è¾‘å™¨ä¹Ÿæ¯”è¾ƒç®€å•åªéœ€è¦ä¸ªæ€§åŒ–çš„é…ç½®ä¸€ä¸‹ä¸ªäººçš„éœ€æ±‚å³å¯ã€‚ Ueditorç›¸å…³é…ç½®ç›´æ¥ä½¿ç”¨æˆ‘é¡¹ç›®è¿è¡Œçš„ç«¥é‹å°±ä¸éœ€è¦é‡æ–°ä¸‹è½½äº†ï¼Œæˆ‘å°†èµ„æºæ”¾åœ¨äº†webappç›®å½•ä¸‹çš„ueditoræ–‡ä»¶å¤¹ä¸‹é¢çš„ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯æˆ‘ä»¬é¦–å…ˆéœ€è¦å°†jsp--&gt;libä¸‹çš„jaråŒ…åŠ å…¥åˆ°é¡¹ç›®ä¸­ã€‚åŠ å¥½ä¹‹åä¼šå‡ºç°ä¸€ä¸ªæƒ³ä¸‹çš„ç®­å¤´è¡¨ç¤ºå·²ç»å¼•å…¥æˆåŠŸã€‚ï¼Œä¹‹åä¿®æ”¹è¯¥ç›®å½•ä¸‹çš„config.jsonæ–‡ä»¶ï¼Œä¸»è¦ä¿®æ”¹ä»¥ä¸‹å†…å®¹å³å¯ï¼š123456"imageAllowFiles": [".png", ".jpg", ".jpeg", ".gif", ".bmp"], /* ä¸Šä¼ å›¾ç‰‡æ ¼å¼æ˜¾ç¤º */"imageCompressEnable": true, /* æ˜¯å¦å‹ç¼©å›¾ç‰‡,é»˜è®¤æ˜¯true */"imageCompressBorder": 1600, /* å›¾ç‰‡å‹ç¼©æœ€é•¿è¾¹é™åˆ¶ */"imageInsertAlign": "none", /* æ’å…¥çš„å›¾ç‰‡æµ®åŠ¨æ–¹å¼ */"imageUrlPrefix": "http://192.168.0.102:8080/ssm", /* å›¾ç‰‡è®¿é—®è·¯å¾„å‰ç¼€ */"imagePathFormat": "/ueditor/jsp/upload/image/&#123;yyyy&#125;&#123;mm&#125;&#123;dd&#125;/&#123;time&#125;&#123;rand:6&#125;", è¿™é‡Œä¸»è¦æ˜¯è¦ä¿®æ”¹imageUrlPrefixä¸ºä½ è‡ªå·±çš„é¡¹ç›®åœ°å€å°±å¯ä»¥äº†ã€‚ueditorä¸€ä¸ªæˆ‘è®¤ä¸ºå¾ˆä¸é”™çš„å°±æ˜¯ä»–æ”¯æŒå›¾ç‰‡ã€å¤šå›¾ã€æˆªå›¾ä¸Šä¼ ï¼Œè€Œä¸”éƒ½ä¸éœ€è¦æ‰‹åŠ¨ç¼–å†™åç«¯æ¥å£ï¼Œæ‰€æœ‰ä¸Šä¼ çš„æ–‡ä»¶ã€å›¾ç‰‡éƒ½ä¼šä¿å­˜åˆ°é¡¹ç›®å‘å¸ƒå‡ºå»çš„jsp--&gt;uploadæ–‡ä»¶å¤¹ä¸‹ä¸€çœ‹å°±æ˜ç™½äº†ã€‚æ›´å¤šå…³äºueditorçš„é…ç½®å¯ä»¥æŸ¥çœ‹å®˜ç½‘ã€‚ å…¶ä¸­å€¼å¾—æ³¨æ„ä¸€ç‚¹çš„æ˜¯ï¼Œç”±äºé¡¹ç›®é‡‡ç”¨äº†Spring MVCå¹¶æ‹¦æˆªäº†æ‰€æœ‰çš„è¯·æ±‚ï¼Œå¯¼è‡´é™æ€èµ„æºä¸èƒ½è®¿é—®ï¼Œå¦‚æœæ˜¯éœ€è¦ç”¨åˆ°ä¸Šä¼ txtæ–‡ä»¶ä¹‹ç±»çš„éœ€æ±‚å¯ä»¥å‚ç…§web.xmlä¸­ä¿®æ”¹ï¼Œå¦‚ä¸‹:1234&lt;servlet-mapping&gt; &lt;servlet-name&gt;default&lt;/servlet-name&gt; &lt;url-pattern&gt;*.txt&lt;/url-pattern&gt;&lt;/servlet-mapping&gt; è¿™æ ·å°±å¯ä»¥è®¿é—®txtæ–‡ä»¶äº†ï¼Œå¦‚æœè¿˜éœ€è¦ä¸Šä¼ PPTä¹‹ç±»çš„å°±ä»¥æ­¤ç±»æ¨ã€‚ æ€»ç»“è¿™æ ·ä¸€ä¸ªç®€å•çš„åŸºäºwebsocketçš„èŠå¤©å®¤å°±ç®—å®Œæˆäº†ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å°†é¡¹ç›®éƒ¨ç½²åˆ°å¤–ç½‘æœåŠ¡å™¨ä¸Šè¿™æ ·å¥½åŸºå‹ä¹‹é—´å°±å¯ä»¥æ„‰å¿«çš„èŠ(zhuang)å¤©(bi)äº†ã€‚å½“ç„¶è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„é¡¹ç›®ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å†è¿™åŸºç¡€ä¹‹ä¸ŠåŠ å…¥å®æ—¶åœ¨çº¿äººæ•°ï¼Œç”¨æˆ·åå’ŒIPä¹‹ç±»çš„ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.gitä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>websocket</tag>
        <tag>HTML5</tag>
        <tag>ueditor</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(å››)WebServiceå…¥é—¨è¯¦è§£]]></title>
    <url>%2F2016%2F08%2F02%2FSSM4%2F</url>
    <content type="text"><![CDATA[å‰è¨€webserviceè¿™ä¸ªä¸çŸ¥é“å¤§å®¶é¦–æ¬¡æ¥è§¦çš„æ—¶å€™æ˜¯æ€ä¹ˆç†è§£çš„ï¼Œåæ­£æˆ‘è®°å¾—æˆ‘å½“æ—¶ç¬¬ä¸€æ¬¡æ¥è§¦è¿™ä¸ªä¸œè¥¿çš„æ—¶å€™ä»¥ä¸ºåˆæ˜¯ä¸€ä¸ªXXæ¡†æ¶ï¼Œè§‰å¾—è¿˜æŒºé«˜å¤§ä¸Šã€‚ç„¶è€Œè¿™ä¸€åˆ‡åœ¨ä¹‹åæˆ‘ä½¿ç”¨è¿‡åæ‰å‘ç°è¿™äº›å…¨éƒ½æ˜¯YYã€‚é‚£ä¹ˆwebserviceåˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Œæ ¹æ®æˆ‘è‡ªå·±çš„ç†è§£ï¼šç®€å•æ¥è¯´å°±åƒæ˜¯ä¸€ä¸ªå…¬å¼€çš„æ¥å£ï¼Œå…¶ä»–ç³»ç»Ÿä¸ç®¡ä½ æ˜¯ç”¨ä»€ä¹ˆè¯­è¨€æ¥ç¼–å†™çš„éƒ½å¯ä»¥è°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå¹¶å¯ä»¥è¿”å›ç›¸åº”çš„æ•°æ®ç»™ä½ ã€‚å°±åƒæ˜¯ç°åœ¨å¾ˆå¤šçš„å¤©æ°”åº”ç”¨ï¼Œä»–ä»¬è‚¯å®šä¸ä¼šè‡ªå·±å»æä¸€ä¸ªæ°”è±¡å±€ä¹‹ç±»çš„éƒ¨é—¨å»ç›‘æµ‹å¤©æ°”ï¼Œå¤§å¤šéƒ½æ˜¯ç›´æ¥è°ƒç”¨ä¸€ä¸ªå¤©æ°”æ¥å£ï¼Œç„¶åè¿”å›å¤©æ°”æ•°æ®ï¼Œç›¸å…³åº”ç”¨å°±å¯ä»¥å°†è¿™äº›ä¿¡æ¯å±•ç¤ºç»™ç”¨æˆ·äº†ã€‚é€šå¸¸æ¥è¯´å‘å¸ƒè¿™ç±»æ¥å£çš„åº”ç”¨éƒ½æ˜¯ç”¨ä¸€ä¸¤ç§è¯­è¨€æ¥ç¼–å†™å³å¯ï¼Œä½†æ˜¯è°ƒç”¨è¿™ä¸ªæ¥å£åº”ç”¨å¯èƒ½ä¼šæ˜¯å„ç§è¯­è¨€æ¥ç¼–å†™çš„ï¼Œä¸ºäº†æ»¡è¶³è¿™æ ·çš„éœ€æ±‚webserviceå‡ºç°äº†ã€‚ ç®€å•æ¥è¯´webserviceå°±æ˜¯ä¸ºäº†æ»¡è¶³ä»¥ä¸Šéœ€æ±‚è€Œå®šä¹‰å‡ºæ¥çš„è§„èŒƒã€‚ Springæ•´åˆCXFåœ¨Javaä¸­å®ç°webserviceæœ‰å¤šç§æ–¹æ³•ï¼Œjavaæœ¬èº«åœ¨jdk1.7ä¹‹åä¹Ÿå¯¹webserviceæœ‰äº†é»˜è®¤çš„å®ç°ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬å®é™…å¼€å‘ä¸­ä¸€èˆ¬è¿˜æ˜¯ä¼šä½¿ç”¨æ¡†æ¶æ¥ï¼Œæ¯”å¦‚è¿™é‡Œæ‰€æåˆ°çš„CXFå°±æœ‰ç€å¹¿æ³›çš„åº”ç”¨ã€‚åºŸè¯æˆ‘å°±ä¸å¤šè¯´äº†ï¼Œç›´æ¥è®²Springæ•´åˆCXFï¼Œæ¯•ç«Ÿç°åœ¨çš„JavaEEå¼€å‘æ˜¯ç¦»ä¸å¼€Springäº†ã€‚è¯¥é¡¹ç›®è¿˜æ˜¯åŸºäºä¹‹å‰çš„SSMè¿›è¡Œå¼€å‘çš„ã€‚ åŠ å…¥mavenä¾èµ–ç¬¬ä¸€æ­¥è‚¯å®šæ˜¯è¦åŠ å…¥mavenä¾èµ–ï¼š12345678910111213141516171819&lt;!--cxf--&gt;&lt;!-- https://mvnrepository.com/artifact/org.apache.cxf/cxf-rt-frontend-jaxws --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.cxf&lt;/groupId&gt; &lt;artifactId&gt;cxf-rt-frontend-jaxws&lt;/artifactId&gt; &lt;version&gt;3.1.6&lt;/version&gt;&lt;/dependency&gt;&lt;!-- https://mvnrepository.com/artifact/org.apache.cxf/cxf-core --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.cxf&lt;/groupId&gt; &lt;artifactId&gt;cxf-core&lt;/artifactId&gt; &lt;version&gt;3.1.6&lt;/version&gt;&lt;/dependency&gt;&lt;!-- https://mvnrepository.com/artifact/org.apache.cxf/cxf-rt-transports-http --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.cxf&lt;/groupId&gt; &lt;artifactId&gt;cxf-rt-transports-http&lt;/artifactId&gt; &lt;version&gt;3.1.6&lt;/version&gt;&lt;/dependency&gt; web.xmlé…ç½®æ¥ç€æˆ‘ä»¬éœ€è¦é…ç½®ä¸€ä¸ªCXFçš„servletï¼š 123456789&lt;!--å®šä¹‰ä¸€ä¸ªcxfçš„servlet--&gt;&lt;servlet&gt; &lt;servlet-name&gt;CXFServlet&lt;/servlet-name&gt; &lt;servlet-class&gt;org.apache.cxf.transport.servlet.CXFServlet&lt;/servlet-class&gt;&lt;/servlet&gt;&lt;servlet-mapping&gt; &lt;servlet-name&gt;CXFServlet&lt;/servlet-name&gt; &lt;url-pattern&gt;/webservice/*&lt;/url-pattern&gt;&lt;/servlet-mapping&gt; ä¹‹ååªè¦æˆ‘ä»¬è®¿é—®webservice/*è¿™ä¸ªåœ°å€å°±ä¼šè¿›å…¥CXFçš„servletä¸­ã€‚ æ•´åˆSpringé…ç½®æ¥ä¸‹æ¥æ˜¯æœ€é‡è¦çš„ä¸€éƒ¨ï¼Œç”¨Springæ•´åˆCXFï¼šåœ¨è¿™ä¹‹å‰æˆ‘æœ‰æ–°å»ºä¸€ä¸ªCXFçš„åŒ…ï¼Œå¦‚ä¸‹å›¾ï¼š è¿™é‡Œæœ‰ä¸¤ä¸ªä¸»è¦ç±» HelloWorldæ¥å£ã€‚ å®ç°HelloWorldæ¥å£çš„HelloWorldImplç±»ã€‚ä»£ç å¦‚ä¸‹ï¼šHelloWorld.java12345678package com.crossoverJie.cxf;import javax.jws.WebService;@WebServicepublic interface HelloWorld &#123; public String say(String str);&#125; å…¶ä¸­å°±åªå®šä¹‰äº†ä¸€ä¸ªç®€å•çš„say()æ–¹æ³•ã€‚HelloWorldImpl.java1234567891011package com.crossoverJie.cxf.impl;import com.crossoverJie.cxf.HelloWorld;import org.springframework.stereotype.Component;import javax.jws.WebService;@Component("helloWorld")@WebServicepublic class HelloWorldImpl implements HelloWorld &#123; public String say(String str) &#123; return "Hello"+str; &#125;&#125; è¿™é‡Œå°±æ˜¯å¯¹say()æ–¹æ³•çš„ç®€å•å®ç°ã€‚æ¥ä¸‹æ¥å°±æ˜¯æ•´åˆSpringäº†ï¼Œç”±äºéœ€è¦ä½¿ç”¨åˆ°CXFçš„æ ‡ç­¾ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ·»åŠ é¢å¤–çš„å‘½åè·¯å¾„å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p" xmlns:aop="http://www.springframework.org/schema/aop" xmlns:context="http://www.springframework.org/schema/context" xmlns:jee="http://www.springframework.org/schema/jee" xmlns:tx="http://www.springframework.org/schema/tx" xmlns:jaxws="http://cxf.apache.org/jaxws" xsi:schemaLocation=" http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-4.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd"&gt; &lt;import resource="classpath:META-INF/cxf/cxf.xml"/&gt; &lt;import resource="classpath:META-INF/cxf/cxf-servlet.xml"/&gt; &lt;!-- è‡ªåŠ¨æ‰«æwebService --&gt; &lt;context:component-scan base-package="com.crossoverJie.cxf" /&gt; &lt;!-- å®šä¹‰webserviceçš„å‘å¸ƒæ¥å£ --&gt; &lt;jaxws:endpoint implementor="#helloWorld" address="/HelloWorld"&lt;/beans&gt; æ›´åŠ å…·ä½“çš„é…ç½®å¯ä»¥æŸ¥çœ‹å®˜æ–¹ç»™å‡ºçš„æ–‡æ¡£:http://cxf.apache.org/docs/how-do-i-develop-a-service.htmlã€‚#helloWorldæŒ‡çš„æ˜¯æˆ‘ä»¬åœ¨HelloWorldImplç±»ä¸­æ‰€è‡ªå®šä¹‰çš„åå­—ï¼Œ/HelloWorldåˆ™æ˜¯æˆ‘ä»¬éœ€è¦è®¿é—®çš„åœ°å€ã€‚ä¹‹åæˆ‘ä»¬è¿è¡Œé¡¹ç›®è¾“å…¥è¯¥åœ°å€ï¼šhttp://127.0.0.1:8080/ssm/webservice/HelloWorld?wsdlå¦‚æœå‡ºç°å¦‚ä¸‹ç•Œé¢ï¼š åˆ™è¯´æ˜æˆ‘ä»¬çš„webserviceå‘å¸ƒæˆåŠŸäº†ã€‚æ¥ä¸‹æ¥åªéœ€è¦é€šè¿‡å®¢æˆ·ç«¯è°ƒç”¨è¿™ä¸ªæ¥å£å³å¯è·å¾—è¿”å›ç»“æœäº†ã€‚ æ€»ç»“ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªç®€å•çš„webserviceå…¥é—¨å®ä¾‹ï¼Œæ›´å¤šçš„å…³äºCXFæ‹¦æˆªå™¨ï¼Œå®¢æˆ·ç«¯è°ƒç”¨å°±æ²¡æœ‰åšè¿‡å¤šä»‹ç»ï¼Œåç»­æœ‰æ—¶é—´çš„è¯å†æ¥ç€æ›´æ–°ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.gitä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>IDEA</tag>
        <tag>CXF</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(ä¸‰)Shiroä½¿ç”¨è¯¦è§£]]></title>
    <url>%2F2016%2F07%2F15%2FSSM3%2F</url>
    <content type="text"><![CDATA[å‰è¨€ç›¸æ¯”æœ‰åšè¿‡ä¼ä¸šçº§å¼€å‘çš„ç«¥é‹åº”è¯¥éƒ½æœ‰åšè¿‡æƒé™å®‰å…¨ä¹‹ç±»çš„åŠŸèƒ½å§ï¼Œæœ€å…ˆå¼€å§‹æˆ‘é‡‡ç”¨çš„æ˜¯å»ºç”¨æˆ·è¡¨,è§’è‰²è¡¨,æƒé™è¡¨ï¼Œä¹‹ååœ¨æ‹¦æˆªå™¨ä¸­å¯¹æ¯ä¸€ä¸ªè¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼Œå†åˆ°æ•°æ®åº“ä¸­è¿›è¡ŒæŸ¥è¯¢çœ‹å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰è¯¥æƒé™ï¼Œè¿™æ ·çš„è®¾è®¡èƒ½æ»¡è¶³å¤§å¤šæ•°ä¸­å°å‹ç³»ç»Ÿçš„éœ€æ±‚ã€‚ä¸è¿‡è¿™ç¯‡æ‰€ä»‹ç»çš„Shiroèƒ½æ»¡è¶³ä¹‹å‰çš„æ‰€æœ‰éœ€æ±‚ï¼Œå¹¶ä¸”ä½¿ç”¨ç®€å•ï¼Œå®‰å…¨æ€§é«˜ï¼Œè€Œä¸”ç°åœ¨è¶Šæ¥è¶Šçš„å¤šä¼ä¸šéƒ½åœ¨ä½¿ç”¨Shiroï¼Œè¿™åº”è¯¥æ˜¯ä¸€ä¸ªæ”¶å…¥çš„ä½ çš„æŠ€èƒ½åº“ã€‚ åˆ›å»ºè‡ªå®šä¹‰MyRealmç±»æœ‰å…³Shiroçš„åŸºç¡€çŸ¥è¯†æˆ‘è¿™é‡Œå°±ä¸è¿‡å¤šä»‹ç»äº†ï¼Œç›´æ¥æ¥å¹²è´§ï¼Œåˆ°æœ€åä¼šæ•´åˆSpringæ¥è¿›è¡Œæƒé™éªŒè¯ã€‚é¦–å…ˆåœ¨ä½¿ç”¨Shiroçš„æ—¶å€™æˆ‘ä»¬è¦è€ƒè™‘åœ¨ä»€ä¹ˆæ ·çš„ç¯å¢ƒä¸‹ä½¿ç”¨ï¼š ç™»å½•çš„éªŒè¯ å¯¹æŒ‡å®šè§’è‰²çš„éªŒè¯ å¯¹URLçš„éªŒè¯ åŸºæœ¬ä¸Šæˆ‘ä»¬ä¹Ÿå°±è¿™ä¸‰ä¸ªéœ€æ±‚ï¼Œæ‰€ä»¥åŒæ—¶æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸‰ä¸ªæ–¹æ³•ï¼š findUserByUserName(String username)æ ¹æ®usernameæŸ¥è¯¢ç”¨æˆ·ï¼Œä¹‹åShiroä¼šæ ¹æ®æŸ¥è¯¢å‡ºæ¥çš„Userçš„å¯†ç æ¥å’Œæäº¤ä¸Šæ¥çš„å¯†ç è¿›è¡Œæ¯”å¯¹ã€‚ findRoles(String username)æ ¹æ®usernameæŸ¥è¯¢è¯¥ç”¨æˆ·çš„æ‰€æœ‰è§’è‰²ï¼Œç”¨äºè§’è‰²éªŒè¯ã€‚ findPermissions(String username)æ ¹æ®usernameæŸ¥è¯¢ä»–æ‰€æ‹¥æœ‰çš„æƒé™ä¿¡æ¯ï¼Œç”¨äºæƒé™åˆ¤æ–­ã€‚ ä¸‹é¢æˆ‘è´´ä¸€ä¸‹æˆ‘çš„mapperä»£ç (PS:è¯¥é¡¹ç›®ä¾ç„¶æ˜¯åŸºäºä¹‹å‰çš„SSMï¼Œä¸å¤ªæ¸…æ¥šæ•´åˆçš„è¯·çœ‹SSMä¸€)ã€‚123456789101112131415161718192021222324252627&lt;?xml version="1.0" encoding="UTF-8" ?&gt;&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" &gt;&lt;mapper namespace="com.crossoverJie.dao.T_userDao" &gt; &lt;resultMap id="BaseResultMap" type="com.crossoverJie.pojo.T_user" &gt; &lt;result property="id" column="id"/&gt; &lt;result property="userName" column="userName"/&gt; &lt;result property="password" column="password"/&gt; &lt;result property="roleId" column="roleId"/&gt; &lt;/resultMap&gt; &lt;sql id="Base_Column_List" &gt; id, username, password,roleId &lt;/sql&gt; &lt;select id="findUserByUsername" parameterType="String" resultMap="BaseResultMap"&gt; select &lt;include refid="Base_Column_List"/&gt; from t_user where userName=#&#123;userName&#125; &lt;/select&gt; &lt;select id="findRoles" parameterType="String" resultType="String"&gt; select r.roleName from t_user u,t_role r where u.roleId=r.id and u.userName=#&#123;userName&#125; &lt;/select&gt; &lt;select id="findPermissions" parameterType="String" resultType="String"&gt; select p.permissionName from t_user u,t_role r,t_permission p where u.roleId=r.id and p.roleId=r.id and u.userName=#&#123;userName&#125; &lt;/select&gt;&lt;/mapper&gt; å¾ˆç®€å•åªæœ‰ä¸‰ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«å¯¹åº”ä¸Šé¢æ‰€è¯´çš„ä¸‰ä¸ªæ–¹æ³•ã€‚å¯¹sqlç¨å¾®ç†Ÿæ‚‰ç‚¹çš„ç«¥é‹åº”è¯¥éƒ½èƒ½çœ‹æ‡‚ï¼Œä¸å¤ªæ¸…æ¥šå°±æ‹·åˆ°æ•°æ®åº“ä¸­æ‰§è¡Œä¸€ä¸‹å°±è¡Œäº†ï¼Œæ•°æ®åº“çš„Sqlä¹Ÿåœ¨æˆ‘çš„githubä¸Šã€‚å®ä½“ç±»å°±æ¯”è¾ƒç®€å•äº†ï¼Œå°±åªæœ‰å››ä¸ªå­—æ®µä»¥åŠget,setæ–¹æ³•ã€‚æˆ‘å°±è¿™é‡Œå°±ä¸è´´äº†ï¼Œå…·ä½“å¯ä»¥å»githubä¸Šforkæˆ‘çš„æºç ã€‚ ç°åœ¨å°±éœ€è¦åˆ›å»ºè‡ªå®šä¹‰çš„MyRealmç±»ï¼Œè¿™ä¸ªè¿˜æ˜¯æ¯”è¾ƒé‡è¦çš„ã€‚ç»§æ‰¿è‡³Shiroçš„AuthorizingRealmç±»ï¼Œç”¨äºå¤„ç†è‡ªå·±çš„éªŒè¯é€»è¾‘ï¼Œä¸‹é¢è´´ä¸€ä¸‹æˆ‘çš„ä»£ç ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364package com.crossoverJie.shiro;import com.crossoverJie.pojo.T_user;import com.crossoverJie.service.T_userService;import org.apache.shiro.authc.AuthenticationException;import org.apache.shiro.authc.AuthenticationInfo;import org.apache.shiro.authc.AuthenticationToken;import org.apache.shiro.authc.SimpleAuthenticationInfo;import org.apache.shiro.authz.AuthorizationInfo;import org.apache.shiro.authz.SimpleAuthorizationInfo;import org.apache.shiro.realm.AuthorizingRealm;import org.apache.shiro.subject.PrincipalCollection;import javax.annotation.Resource;import java.util.Set;/** * Created with IDEA * Created by $&#123;jie.chen&#125; on 2016/7/14. * Shiroè‡ªå®šä¹‰åŸŸ */public class MyRealm extends AuthorizingRealm &#123; @Resource private T_userService t_userService; /** * ç”¨äºçš„æƒé™çš„è®¤è¯ã€‚ * @param principalCollection * @return */ @Override protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principalCollection) &#123; String username = principalCollection.getPrimaryPrincipal().toString() ; SimpleAuthorizationInfo info = new SimpleAuthorizationInfo() ; Set&lt;String&gt; roleName = t_userService.findRoles(username) ; Set&lt;String&gt; permissions = t_userService.findPermissions(username) ; info.setRoles(roleName); info.setStringPermissions(permissions); return info; &#125; /** * é¦–å…ˆæ‰§è¡Œè¿™ä¸ªç™»å½•éªŒè¯ * @param token * @return * @throws AuthenticationException */ @Override protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException &#123; //è·å–ç”¨æˆ·è´¦å· String username = token.getPrincipal().toString() ; T_user user = t_userService.findUserByUsername(username) ; if (user != null)&#123; //å°†æŸ¥è¯¢åˆ°çš„ç”¨æˆ·è´¦å·å’Œå¯†ç å­˜æ”¾åˆ° authenticationInfoç”¨äºåé¢çš„æƒé™åˆ¤æ–­ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°éšä¾¿æ”¾ä¸€ä¸ªå°±è¡Œäº†ã€‚ AuthenticationInfo authenticationInfo = new SimpleAuthenticationInfo(user.getUserName(),user.getPassword(), "a") ; return authenticationInfo ; &#125;else&#123; return null ; &#125; &#125;&#125; ç»§æ‰¿AuthorizingRealmç±»ä¹‹åå°±éœ€è¦è¦†å†™å®ƒçš„ä¸¤ä¸ªæ–¹æ³•ï¼ŒdoGetAuthorizationInfo,doGetAuthenticationInfoï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•çš„ä½œç”¨æˆ‘éƒ½æœ‰å†™æ³¨é‡Šï¼Œé€»è¾‘ä¹Ÿæ¯”è¾ƒç®€å•ã€‚doGetAuthenticationInfoæ˜¯ç”¨äºç™»å½•éªŒè¯çš„ï¼Œåœ¨ç™»å½•çš„æ—¶å€™éœ€è¦å°†æ•°æ®å°è£…åˆ°Shiroçš„ä¸€ä¸ªtokenä¸­ï¼Œæ‰§è¡Œshiroçš„login()æ–¹æ³•ï¼Œä¹‹ååªè¦æˆ‘ä»¬å°†MyRealmè¿™ä¸ªç±»é…ç½®åˆ°Springä¸­ï¼Œç™»å½•çš„æ—¶å€™Shiroå°±ä¼šè‡ªåŠ¨çš„è°ƒç”¨doGetAuthenticationInfo()æ–¹æ³•è¿›è¡ŒéªŒè¯ã€‚å“¦å¯¹äº†ï¼Œå¿˜äº†è´´ä¸‹ç™»å½•çš„Controlleräº†ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455package com.crossoverJie.controller;import com.crossoverJie.pojo.T_user;import com.crossoverJie.service.T_userService;import org.apache.shiro.SecurityUtils;import org.apache.shiro.authc.UsernamePasswordToken;import org.apache.shiro.subject.Subject;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import javax.annotation.Resource;/** * Created with IDEA * Created by $&#123;jie.chen&#125; on 2016/7/14. * åå°Controller */@Controller@RequestMapping("/")public class T_userController &#123; @Resource private T_userService t_userService ; @RequestMapping("/loginAdmin") public String login(T_user user, Model model)&#123; Subject subject = SecurityUtils.getSubject() ; UsernamePasswordToken token = new UsernamePasswordToken(user.getUserName(),user.getPassword()) ; try &#123; subject.login(token); return "admin" ; &#125;catch (Exception e)&#123; //è¿™é‡Œå°†å¼‚å¸¸æ‰“å°å…³é—­æ˜¯å› ä¸ºå¦‚æœç™»å½•å¤±è´¥çš„è¯ä¼šè‡ªåŠ¨æŠ›å¼‚å¸¸// e.printStackTrace(); model.addAttribute("error","ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯") ; return "../../login" ; &#125; &#125; @RequestMapping("/admin") public String admin()&#123; return "admin"; &#125; @RequestMapping("/student") public String student()&#123; return "admin" ; &#125; @RequestMapping("/teacher") public String teacher()&#123; return "admin" ; &#125;&#125; ä¸»è¦å°±æ˜¯login()æ–¹æ³•ã€‚é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œåªæ˜¯ç™»å½•éªŒè¯çš„æ—¶å€™ä¸æ˜¯åƒä¹‹å‰é‚£æ ·ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ç„¶åè¿”å›æ˜¯å¦æœ‰ç”¨æˆ·äº†ï¼Œè€Œæ˜¯è°ƒç”¨subjectçš„login()æ–¹æ³•,å°±æ˜¯æˆ‘ä¸Šé¢æåˆ°çš„ï¼Œè°ƒç”¨login()æ–¹æ³•æ—¶Shiroä¼šè‡ªåŠ¨è°ƒç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„MyRealmç±»ä¸­çš„doGetAuthenticationInfo()æ–¹æ³•è¿›è¡ŒéªŒè¯çš„ï¼ŒéªŒè¯é€»è¾‘æ˜¯å…ˆæ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ï¼Œå¦‚æœæŸ¥è¯¢åˆ°çš„è¯å†å°†æŸ¥è¯¢åˆ°çš„ç”¨æˆ·åå’Œå¯†ç æ”¾åˆ°SimpleAuthenticationInfoå¯¹è±¡ä¸­ï¼ŒShiroä¼šè‡ªåŠ¨æ ¹æ®ç”¨æˆ·è¾“å…¥çš„å¯†ç å’ŒæŸ¥è¯¢åˆ°çš„å¯†ç è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…ä¸ä¸Šå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼ŒåŒ¹é…ä¸Šä¹‹åå°±ä¼šæ‰§è¡ŒdoGetAuthorizationInfo()è¿›è¡Œç›¸åº”çš„æƒé™éªŒè¯ã€‚doGetAuthorizationInfo()æ–¹æ³•çš„å¤„ç†é€»è¾‘ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæ ¹æ®ç”¨æˆ·åè·å–åˆ°ä»–æ‰€æ‹¥æœ‰çš„è§’è‰²ä»¥åŠæƒé™ï¼Œç„¶åèµ‹å€¼åˆ°SimpleAuthorizationInfoå¯¹è±¡ä¸­å³å¯ï¼ŒShiroå°±ä¼šæŒ‰ç…§æˆ‘ä»¬é…ç½®çš„XXè§’è‰²å¯¹åº”XXæƒé™æ¥è¿›è¡Œåˆ¤æ–­ï¼Œè¿™ä¸ªé…ç½®åœ¨ä¸‹é¢çš„æ•´åˆä¸­ä¼šè®²åˆ°ã€‚ æ•´åˆSpringæ¥ä¸‹æ¥åº”è¯¥æ˜¯å¤§å®¶æ¯”è¾ƒå…³ç³»çš„ä¸€æ­¥ï¼šæ•´åˆSpringã€‚æˆ‘æ˜¯åœ¨ä¹‹å‰çš„Spring SpringMVC Mybatisçš„åŸºç¡€ä¸Šè¿›è¡Œæ•´åˆçš„ã€‚ web.xmlé…ç½®é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨web.xmlè¿›è¡Œé…ç½®Shiroçš„è¿‡æ»¤å™¨ã€‚æˆ‘åªè´´Shiroéƒ¨åˆ†çš„ï¼Œå…¶ä½™çš„å’Œä¹‹å‰é…ç½®æ˜¯ä¸€æ ·çš„ã€‚1234567891011121314&lt;!-- shiroè¿‡æ»¤å™¨å®šä¹‰ --&gt;&lt;filter&gt; &lt;filter-name&gt;shiroFilter&lt;/filter-name&gt; &lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt; &lt;init-param&gt; &lt;!-- è¯¥å€¼ç¼ºçœä¸ºfalse,è¡¨ç¤ºç”Ÿå‘½å‘¨æœŸç”±SpringApplicationContextç®¡ç†,è®¾ç½®ä¸ºtrueåˆ™è¡¨ç¤ºç”±ServletContainerç®¡ç† --&gt; &lt;param-name&gt;targetFilterLifecycle&lt;/param-name&gt; &lt;param-value&gt;true&lt;/param-value&gt; &lt;/init-param&gt;&lt;/filter&gt;&lt;filter-mapping&gt; &lt;filter-name&gt;shiroFilter&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt; é…ç½®è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œè¿™æ ·ä¼šè¿‡æ»¤æ‰€æœ‰çš„è¯·æ±‚ã€‚ä¹‹åæˆ‘ä»¬è¿˜éœ€è¦åœ¨Springä¸­é…ç½®ä¸€ä¸ªshiroFilterçš„beanã€‚ spring-mybatis.xmlé…ç½®ç”±äºè¿™é‡Œé…ç½®è¾ƒå¤šï¼Œæˆ‘å°±å…¨éƒ¨è´´ä¸€ä¸‹ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd"&gt; &lt;!-- è‡ªåŠ¨æ‰«æ --&gt; &lt;context:component-scan base-package="com.crossoverJie" /&gt; &lt;!-- å¼•å…¥é…ç½®æ–‡ä»¶ --&gt; &lt;bean id="propertyConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"&gt; &lt;property name="location" value="classpath:jdbc.properties" /&gt; &lt;/bean&gt; &lt;bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource" init-method="init" destroy-method="close"&gt; &lt;!-- æŒ‡å®šè¿æ¥æ•°æ®åº“çš„é©±åŠ¨ --&gt; &lt;property name="driverClassName" value="$&#123;jdbc.driverClass&#125;" /&gt; &lt;property name="url" value="$&#123;jdbc.url&#125;" /&gt; &lt;property name="username" value="$&#123;jdbc.user&#125;" /&gt; &lt;property name="password" value="$&#123;jdbc.password&#125;" /&gt; &lt;!-- é…ç½®åˆå§‹åŒ–å¤§å°ã€æœ€å°ã€æœ€å¤§ --&gt; &lt;property name="initialSize" value="3" /&gt; &lt;property name="minIdle" value="3" /&gt; &lt;property name="maxActive" value="20" /&gt; &lt;!-- é…ç½®è·å–è¿æ¥ç­‰å¾…è¶…æ—¶çš„æ—¶é—´ --&gt; &lt;property name="maxWait" value="60000" /&gt; &lt;!-- é…ç½®é—´éš”å¤šä¹…æ‰è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œæ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿æ¥ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt; &lt;property name="timeBetweenEvictionRunsMillis" value="60000" /&gt; &lt;!-- é…ç½®ä¸€ä¸ªè¿æ¥åœ¨æ± ä¸­æœ€å°ç”Ÿå­˜çš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt; &lt;property name="minEvictableIdleTimeMillis" value="300000" /&gt; &lt;property name="validationQuery" value="SELECT 'x'" /&gt; &lt;property name="testWhileIdle" value="true" /&gt; &lt;property name="testOnBorrow" value="false" /&gt; &lt;property name="testOnReturn" value="false" /&gt; &lt;!-- æ‰“å¼€PSCacheï¼Œå¹¶ä¸”æŒ‡å®šæ¯ä¸ªè¿æ¥ä¸ŠPSCacheçš„å¤§å° --&gt; &lt;property name="poolPreparedStatements" value="true" /&gt; &lt;property name="maxPoolPreparedStatementPerConnectionSize" value="20" /&gt; &lt;!-- é…ç½®ç›‘æ§ç»Ÿè®¡æ‹¦æˆªçš„filtersï¼Œå»æ‰åç›‘æ§ç•Œé¢sqlæ— æ³•ç»Ÿè®¡ --&gt; &lt;property name="filters" value="stat" /&gt; &lt;/bean&gt; &lt;!-- springå’ŒMyBatiså®Œç¾æ•´åˆï¼Œä¸éœ€è¦mybatisçš„é…ç½®æ˜ å°„æ–‡ä»¶ --&gt; &lt;bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean"&gt; &lt;property name="dataSource" ref="dataSource" /&gt; &lt;!-- è‡ªåŠ¨æ‰«æmapping.xmlæ–‡ä»¶ --&gt; &lt;property name="mapperLocations" value="classpath:mapping/*.xml"&gt;&lt;/property&gt; &lt;/bean&gt; &lt;!-- DAOæ¥å£æ‰€åœ¨åŒ…åï¼ŒSpringä¼šè‡ªåŠ¨æŸ¥æ‰¾å…¶ä¸‹çš„ç±» --&gt; &lt;bean class="org.mybatis.spring.mapper.MapperScannerConfigurer"&gt; &lt;property name="basePackage" value="com.crossoverJie.dao" /&gt; &lt;property name="sqlSessionFactoryBeanName" value="sqlSessionFactory"&gt;&lt;/property&gt; &lt;/bean&gt; &lt;!-- (äº‹åŠ¡ç®¡ç†)transaction manager, use JtaTransactionManager for global tx --&gt; &lt;bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt; &lt;property name="dataSource" ref="dataSource" /&gt; &lt;/bean&gt; &lt;!-- é…ç½®è‡ªå®šä¹‰Realm --&gt; &lt;bean id="myRealm" class="com.crossoverJie.shiro.MyRealm"/&gt; &lt;!-- å®‰å…¨ç®¡ç†å™¨ --&gt; &lt;bean id="securityManager" class="org.apache.shiro.web.mgt.DefaultWebSecurityManager"&gt; &lt;property name="realm" ref="myRealm"/&gt; &lt;/bean&gt; &lt;!-- Shiroè¿‡æ»¤å™¨ æ ¸å¿ƒ--&gt; &lt;bean id="shiroFilter" class="org.apache.shiro.spring.web.ShiroFilterFactoryBean"&gt; &lt;!-- Shiroçš„æ ¸å¿ƒå®‰å…¨æ¥å£,è¿™ä¸ªå±æ€§æ˜¯å¿…é¡»çš„ --&gt; &lt;property name="securityManager" ref="securityManager"/&gt; &lt;!-- èº«ä»½è®¤è¯å¤±è´¥ï¼Œåˆ™è·³è½¬åˆ°ç™»å½•é¡µé¢çš„é…ç½® --&gt; &lt;property name="loginUrl" value="/login.jsp"/&gt; &lt;!-- æƒé™è®¤è¯å¤±è´¥ï¼Œåˆ™è·³è½¬åˆ°æŒ‡å®šé¡µé¢ --&gt; &lt;property name="unauthorizedUrl" value="/nopower.jsp"/&gt; &lt;!-- Shiroè¿æ¥çº¦æŸé…ç½®,å³è¿‡æ»¤é“¾çš„å®šä¹‰ --&gt; &lt;property name="filterChainDefinitions"&gt; &lt;value&gt; &lt;!--anon è¡¨ç¤ºåŒ¿åè®¿é—®ï¼Œä¸éœ€è¦è®¤è¯ä»¥åŠæˆæƒ--&gt; /loginAdmin=anon &lt;!--authcè¡¨ç¤ºéœ€è¦è®¤è¯ æ²¡æœ‰è¿›è¡Œèº«ä»½è®¤è¯æ˜¯ä¸èƒ½è¿›è¡Œè®¿é—®çš„--&gt; /admin*=authc /student=roles[teacher] /teacher=perms["user:create"] &lt;/value&gt; &lt;/property&gt; &lt;/bean&gt; &lt;!-- ä¿è¯å®ç°äº†Shiroå†…éƒ¨lifecycleå‡½æ•°çš„beanæ‰§è¡Œ --&gt; &lt;bean id="lifecycleBeanPostProcessor" class="org.apache.shiro.spring.LifecycleBeanPostProcessor"/&gt; &lt;!-- å¼€å¯Shiroæ³¨è§£ --&gt; &lt;bean class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator" depends-on="lifecycleBeanPostProcessor"/&gt; &lt;bean class="org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor"&gt; &lt;property name="securityManager" ref="securityManager"/&gt; &lt;/bean&gt;&lt;/beans&gt; åœ¨è¿™é‡Œæˆ‘ä»¬é…ç½®äº†ä¸Šæ–‡ä¸­æ‰€æåˆ°çš„è‡ªå®šä¹‰myRealm,è¿™æ ·Shiroå°±å¯ä»¥æŒ‰ç…§æˆ‘ä»¬è‡ªå®šä¹‰çš„é€»è¾‘æ¥è¿›è¡Œæƒé™éªŒè¯äº†ã€‚å…¶ä½™çš„éƒ½æ¯”è¾ƒç®€å•ï¼Œçœ‹æ³¨é‡Šåº”è¯¥éƒ½èƒ½æ˜ç™½ã€‚ç€é‡è®²è§£ä¸€ä¸‹ï¼š12345678910111213&lt;property name="filterChainDefinitions"&gt; &lt;value&gt; &lt;!--anon è¡¨ç¤ºåŒ¿åè®¿é—®ï¼Œä¸éœ€è¦è®¤è¯ä»¥åŠæˆæƒ--&gt; /loginAdmin=anon &lt;!--authcè¡¨ç¤ºéœ€è¦è®¤è¯ æ²¡æœ‰è¿›è¡Œèº«ä»½è®¤è¯æ˜¯ä¸èƒ½è¿›è¡Œè®¿é—®çš„--&gt; /admin*=authc /student=roles[teacher] /teacher=perms["user:create"] &lt;/value&gt;&lt;/property&gt; /loginAdmin=anonçš„æ„æ€çš„æ„æ€æ˜¯ï¼Œå‘èµ·/loginAdminè¿™ä¸ªè¯·æ±‚æ˜¯ä¸éœ€è¦è¿›è¡Œèº«ä»½è®¤è¯çš„ï¼Œè¿™ä¸ªè¯·æ±‚åœ¨è¿™æ¬¡é¡¹ç›®ä¸­æ˜¯ä¸€ä¸ªç™»å½•è¯·æ±‚ï¼Œä¸€èˆ¬å¯¹äºè¿™æ ·çš„è¯·æ±‚éƒ½æ˜¯ä¸éœ€è¦èº«ä»½è®¤è¯çš„ã€‚ /admin*=authcè¡¨ç¤º /admin,/admin1,/admin2è¿™æ ·çš„è¯·æ±‚éƒ½æ˜¯éœ€è¦è¿›è¡Œèº«ä»½è®¤è¯çš„ï¼Œä¸ç„¶æ˜¯ä¸èƒ½è®¿é—®çš„ã€‚ /student=roles[teacher]è¡¨ç¤ºè®¿é—®/studentè¯·æ±‚çš„ç”¨æˆ·å¿…é¡»æ˜¯teacherè§’è‰²ï¼Œä¸ç„¶æ˜¯ä¸èƒ½è¿›è¡Œè®¿é—®çš„ã€‚ /teacher=perms[â€œuser:createâ€]è¡¨ç¤ºè®¿é—®/teacherè¯·æ±‚æ˜¯éœ€è¦å½“å‰ç”¨æˆ·å…·æœ‰user:createæƒé™æ‰èƒ½è¿›è¡Œè®¿é—®çš„ã€‚æ›´å¤šç›¸å…³æƒé™è¿‡æ»¤çš„èµ„æ–™å¯ä»¥è®¿é—®shiroçš„å®˜æ–¹ä»‹ç»ï¼šä¼ é€é—¨ ä½¿ç”¨Shiroæ ‡ç­¾åº“Shiroè¿˜æœ‰ç€å¼ºå¤§æ ‡ç­¾åº“ï¼Œå¯ä»¥åœ¨å‰ç«¯å¸®æˆ‘è·å–ä¿¡æ¯å’Œåšåˆ¤æ–­ã€‚æˆ‘è´´ä¸€ä¸‹æˆ‘è¿™é‡Œç™»å½•å®Œæˆä¹‹åæ˜¾ç¤ºçš„ç•Œé¢ï¼š12345678910111213141516171819202122232425&lt;%-- Created by IntelliJ IDEA. User: Administrator Date: 2016/7/14 Time: 13:17 To change this template use File | Settings | File Templates.--%&gt;&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;&lt;%@ taglib prefix="shiro" uri="http://shiro.apache.org/tags" %&gt;&lt;html&gt;&lt;head&gt; &lt;title&gt;åå°&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;shiro:hasRole name="admin"&gt; è¿™æ˜¯adminè§’è‰²ç™»å½•ï¼š&lt;shiro:principal&gt;&lt;/shiro:principal&gt;&lt;/shiro:hasRole&gt;&lt;shiro:hasPermission name="user:create"&gt; æœ‰user:createæƒé™ä¿¡æ¯&lt;/shiro:hasPermission&gt;&lt;br&gt;ç™»å½•æˆåŠŸ&lt;/body&gt;&lt;/html&gt; è¦æƒ³ä½¿ç”¨Shiroæ ‡ç­¾ï¼Œåªéœ€è¦å¼•å…¥ä¸€ä¸‹æ ‡ç­¾å³å¯ï¼š&lt;%@ taglib prefix=&quot;shiro&quot; uri=&quot;http://shiro.apache.org/tags&quot; %&gt;å…¶å®è‹±è¯­ç¨å¾®å¥½ç‚¹çš„ç«¥é‹åº”è¯¥éƒ½èƒ½çœ‹æ‡‚ã€‚ä¸‹é¢æˆ‘å¤§æ¦‚ä»‹ç»ä¸‹ä¸€äº›æ ‡ç­¾çš„ç”¨æ³•ï¼š å…·æœ‰adminè§’è‰²æ‰ä¼šæ˜¾ç¤ºæ ‡ç­¾å†…çš„ä¿¡æ¯ã€‚ è·å–ç”¨æˆ·ä¿¡æ¯ã€‚é»˜è®¤è°ƒç”¨Subject.getPrincipal()è·å–ï¼Œå³ Primary Principalã€‚ ç”¨æˆ·æ‹¥æœ‰user:createè¿™ä¸ªæƒé™æ‰å›æ˜¾ç¤ºæ ‡ç­¾å†…çš„ä¿¡æ¯ã€‚æ›´å¤šçš„æ ‡ç­¾å¯ä»¥æŸ¥çœ‹å®˜ç½‘ï¼šä¼ é€é—¨ æ•´ä½“æµ‹è¯• è¿™æ˜¯æˆ‘çš„æµ‹è¯•æ•°æ®ã€‚é¦–å…ˆæ¥éªŒè¯ä¸€ä¸‹ç™»å½•ï¼šå…ˆè¾“å…¥ä¸€ä¸ªé”™è¯¯çš„è´¦å·å’Œå¯†ç ï¼š æ¥ä¸‹æ¥è¾“å…¥ä¸€ä¸ªæ­£ç¡®çš„ï¼š å¯ä»¥çœ‹åˆ°æˆ‘ç™»å½•çš„ç”¨æˆ·æ˜¯crossoverJieä»–æ˜¯æœ‰adminçš„è§’è‰²ï¼Œå¹¶ä¸”æ‹¥æœ‰user:*(ps:ç³»ç»Ÿæ•°æ®è¯¦è§ä¸Šé¢çš„æ•°æ®åº“æˆªå›¾)çš„æƒé™ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼š 123456&lt;shiro:hasRole name="admin"&gt; è¿™æ˜¯adminè§’è‰²ç™»å½•ï¼š&lt;shiro:principal&gt;&lt;/shiro:principal&gt;&lt;/shiro:hasRole&gt;&lt;shiro:hasPermission name="user:create"&gt; æœ‰user:createæƒé™ä¿¡æ¯&lt;/shiro:hasPermission&gt; æ˜¯èƒ½æ˜¾ç¤ºå‡ºæ ‡ç­¾å†…çš„ä¿¡æ¯ï¼Œå¹¶æŠŠç”¨æˆ·ä¿¡æ¯ä¹Ÿæ˜¾ç¤ºå‡ºæ¥äº†ã€‚æ¥ç€æˆ‘ä»¬æ¥è®¿é—®ä¸€ä¸‹/studentè¿™ä¸ªè¯·æ±‚ï¼Œå› ä¸ºåœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­ï¼š 12345678910111213&lt;property name="filterChainDefinitions"&gt; &lt;value&gt; &lt;!--anon è¡¨ç¤ºåŒ¿åè®¿é—®ï¼Œä¸éœ€è¦è®¤è¯ä»¥åŠæˆæƒ--&gt; /loginAdmin=anon &lt;!--authcè¡¨ç¤ºéœ€è¦è®¤è¯ æ²¡æœ‰è¿›è¡Œèº«ä»½è®¤è¯æ˜¯ä¸èƒ½è¿›è¡Œè®¿é—®çš„--&gt; /admin*=authc /student=roles[teacher] /teacher=perms["user:create"] &lt;/value&gt;&lt;/property&gt; åªæœ‰teacherè§’è‰²æ‰èƒ½è®¿é—®/studentè¿™ä¸ªè¯·æ±‚çš„ï¼š æœç„¶ï¼ŒShiroåšäº†å®‰å…¨æ§åˆ¶æ˜¯ä¸èƒ½è¿›è¡Œè®¿é—®çš„ã€‚ç„¶åæˆ‘ä»¬æ¢aaaç”¨æˆ·ç™»å½•ï¼Œä»–æ­£å¥½æ˜¯teacherè§’è‰²ï¼Œçœ‹èƒ½ä¸èƒ½è®¿é—®/studentã€‚ æœç„¶æ˜¯èƒ½è®¿é—®çš„ã€‚å› ä¸ºæˆ‘åœ¨æ§åˆ¶å™¨é‡Œè®¿é—®/studentè¿”å›çš„æ˜¯åŒä¸€ä¸ªç•Œé¢æ‰€ä»¥çœ‹åˆ°çš„è¿˜æ˜¯è¿™ä¸ªç•Œé¢ã€‚ 1234@RequestMapping("/teacher")public String teacher()&#123; return "admin" ;&#125; å¹¶ä¸”æ²¡æœ‰æ˜¾ç¤ºä¹‹å‰Shiroæ ‡ç­¾å†…çš„å†…å®¹ã€‚å…¶ä»–çš„æˆ‘å°±ä¸æµ‹äº†ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±åœ¨æ•°æ®åº“é‡ŒåŠ ä¸€äº›æ•°æ®ï¼Œæˆ–è€…æ˜¯æ”¹ä¸‹æ‹¦æˆªçš„æƒé™å¤šè¯•è¯•ï¼Œè¿™æ ·å¯¹Shiroçš„ç†è§£å°±ä¼šæ›´åŠ æ·±åˆ»ã€‚ MD5åŠ å¯†Shiroè¿˜å°è£…äº†ä¸€ä¸ªæˆ‘è®¤ä¸ºéå¸¸ä¸é”™çš„åŠŸèƒ½ï¼Œé‚£å°±æ˜¯MD5åŠ å¯†ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920package com.crossoverJie.shiro;import org.apache.shiro.crypto.hash.Md5Hash;/** * Created with IDEA * åŸºäºShiroçš„MD5åŠ å¯† * Created by $&#123;jie.chen&#125; on 2016/7/13. */public class MD5Util &#123; public static String md5(String str,String salt)&#123; return new Md5Hash(str,salt).toString() ; &#125; public static void main(String[] args) &#123; String md5 = md5("abc123","crossoverjie") ; System.out.println(md5); &#125;&#125; ä»£ç éå¸¸ç®€å•ï¼Œåªéœ€è¦è°ƒç”¨Md5Hash(str,salt)æ–¹æ³•å³å¯ï¼Œè¿™é‡Œå¤šäº†ä¸€ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ç”¨å¤šè§£é‡Šï¼Œæ˜¯éœ€è¦åŠ å¯†çš„å­—ç¬¦ä¸²ã€‚ç¬¬äºŒä¸ªå‚æ•°saltä¸­æ–‡ç¿»è¯‘å«ç›ï¼ŒåŠ å¯†çš„æ—¶å€™æˆ‘ä»¬ä¼ ä¸€ä¸ªå­—ç¬¦ä¸²è¿›å»ï¼Œåªè¦è¿™ä¸ªsaltä¸è¢«æ³„éœ²å‡ºå»ï¼Œé‚£åŸåˆ™ä¸ŠåŠ å¯†ä¹‹åæ˜¯æ— æ³•è¢«è§£å¯†çš„ï¼Œåœ¨å­˜ç”¨æˆ·å¯†ç çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ï¼Œæ„Ÿè§‰è¿˜æ˜¯éå¸¸å±Œçš„ã€‚ æ€»ç»“ä»¥ä¸Šå°±æ˜¯Shiroå®é™…ä½¿ç”¨çš„æ¡ˆä¾‹ï¼Œå°†çš„æ¯”è¾ƒåˆç•¥ï¼Œä½†æ˜¯å…³äºShiroçš„æ ¸å¿ƒä¸œè¥¿éƒ½åœ¨é‡Œé¢äº†ã€‚å¤§å®¶å¯ä»¥å»æˆ‘çš„githubä¸Šä¸‹è½½æºç ï¼Œåªè¦æŒ‰ç…§æˆ‘ç»™çš„æ•°æ®åº“å°±æ²¡æœ‰é—®é¢˜ï¼Œé¡¹ç›®è·‘èµ·æ¥ä¹‹åè¯•ç€æ”¹ä¸‹é‡Œé¢çš„ä¸œè¥¿å¯ä»¥åŠ æ·±å¯¹Shiroçš„ç†è§£ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/crossoverJie/SSM.gitä¸ªäººåšå®¢åœ°å€ï¼šhttp://crossoverjie.topã€‚GitHubåœ°å€ï¼šhttps://github.com/crossoverJieã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>IDEA</tag>
        <tag>Shiro</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(äºŒ)Luceneå…¨æ–‡æ£€ç´¢]]></title>
    <url>%2F2016%2F07%2F06%2FSSM2%2F</url>
    <content type="text"><![CDATA[å‰è¨€ å¤§å®¶å¹³æ—¶è‚¯å®šéƒ½æœ‰ç”¨è¿‡å…¨æ–‡æ£€ç´¢å·¥å…·ï¼Œæœ€å¸¸ç”¨çš„ç™¾åº¦è°·æ­Œå°±æ˜¯å…¶ä¸­çš„å…¸å‹ã€‚å¦‚æœè‡ªå·±èƒ½å¤Ÿåšä¸€ä¸ªé‚£æ˜¯ä¸æ˜¯æƒ³æƒ³å°±é€¼æ ¼æ»¡æ»¡å‘¢ã€‚Apacheå°±ä¸ºæˆ‘ä»¬æä¾›äº†è¿™æ ·ä¸€ä¸ªæ¡†æ¶ï¼Œä»¥ä¸‹å°±æ˜¯åœ¨å®é™…å¼€å‘ä¸­åŠ å…¥Luceneçš„ä¸€ä¸ªå°Demoã€‚ è·å–Mavenä¾èµ–é¦–å…ˆçœ‹ä¸€ä¸‹å®é™…è¿è¡Œçš„æ•ˆæœå›¾ï¼šè¿™ä¸ªé¡¹ç›®æ˜¯åŸºäºä¹‹å‰ä½¿ç”¨IDEAæ­å»ºçš„SSMçš„åŸºç¡€ä¸Šè¿›è¡Œå¢åŠ çš„ï¼Œå»ºè®®å°ç™½å…ˆçœ‹ä¸‹ä¸€æˆ‘ã€‚ä¸Šä¸€ç¯‡åšå®¢ï¼Œä»¥åŠå…±äº«åœ¨Githubä¸Šçš„æºç ã€‚ä»¥ä¸‹æ˜¯Luceneæ‰€éœ€è¦çš„ä¾èµ–ï¼š1234567891011121314151617181920212223242526272829303132333435&lt;!--åŠ å…¥lucene--&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.lucene/lucene-core --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.lucene&lt;/groupId&gt; &lt;artifactId&gt;lucene-core&lt;/artifactId&gt; &lt;version&gt;$&#123;lucene.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.lucene/lucene-queryparser --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.lucene&lt;/groupId&gt; &lt;artifactId&gt;lucene-queryparser&lt;/artifactId&gt; &lt;version&gt;$&#123;lucene.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.lucene/lucene-analyzers-common --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.lucene&lt;/groupId&gt; &lt;artifactId&gt;lucene-analyzers-common&lt;/artifactId&gt; &lt;version&gt;$&#123;lucene.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!--luceneä¸­æ–‡åˆ†è¯--&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.lucene/lucene-analyzers-smartcn --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.lucene&lt;/groupId&gt; &lt;artifactId&gt;lucene-analyzers-smartcn&lt;/artifactId&gt; &lt;version&gt;$&#123;lucene.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!--luceneé«˜äº®--&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.lucene/lucene-highlighter --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.lucene&lt;/groupId&gt; &lt;artifactId&gt;lucene-highlighter&lt;/artifactId&gt; &lt;version&gt;$&#123;lucene.version&#125;&lt;/version&gt; &lt;/dependency&gt; å…·ä½“çš„ç”¨é€”æˆ‘éƒ½å†™æœ‰æ³¨é‡Šã€‚åœ¨IDEAä¸­ä¿®æ”¹äº†Pom.xmlæ–‡ä»¶ä¹‹ååªéœ€è¦ç‚¹å‡»å¦‚å›¾æ‰€ç¤ºçš„æŒ‰é’®å³å¯é‡æ–°è·å–ä¾èµ–ï¼š ç¼–å†™Luceneå·¥å…·ç±»è¿™ä¸ªå·¥å…·ç±»ä¸­çš„å…·ä½“ä»£ç æˆ‘å°±ä¸å•ç‹¬æå‡ºæ¥è¯´äº†ï¼Œæ¯ä¸ªå…³é”®çš„åœ°æ–¹æˆ‘éƒ½å†™æœ‰æ³¨é‡Šï¼Œä¸æ¸…æ¥šçš„å†è®¨è®ºã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164package com.crossoverJie.lucene;import com.crossoverJie.pojo.User;import org.apache.lucene.analysis.TokenStream;import org.apache.lucene.analysis.cn.smart.SmartChineseAnalyzer;import org.apache.lucene.document.Document;import org.apache.lucene.document.Field;import org.apache.lucene.document.StringField;import org.apache.lucene.document.TextField;import org.apache.lucene.index.*;import org.apache.lucene.queryparser.classic.QueryParser;import org.apache.lucene.search.*;import org.apache.lucene.search.highlight.*;import org.apache.lucene.store.Directory;import org.apache.lucene.store.FSDirectory;import java.io.StringReader;import java.nio.file.Paths;import java.util.LinkedList;import java.util.List;import com.crossoverJie.util.*;/** * åšå®¢ç´¢å¼•ç±» * @author Administrator * */public class LuceneIndex &#123; private Directory dir=null; /** * è·å–IndexWriterå®ä¾‹ * @return * @throws Exception */ private IndexWriter getWriter()throws Exception&#123; /** * ç”Ÿæˆçš„ç´¢å¼•æˆ‘æ”¾åœ¨äº†Cç›˜ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦æ”¾åœ¨å…·ä½“ä½ç½® */ dir= FSDirectory.open(Paths.get("C://lucene")); SmartChineseAnalyzer analyzer=new SmartChineseAnalyzer(); IndexWriterConfig iwc=new IndexWriterConfig(analyzer); IndexWriter writer=new IndexWriter(dir, iwc); return writer; &#125; /** * æ·»åŠ åšå®¢ç´¢å¼• * @param user */ public void addIndex(User user)throws Exception&#123; IndexWriter writer=getWriter(); Document doc=new Document(); doc.add(new StringField("id",String.valueOf(user.getUserId()), Field.Store.YES)); /** * yesæ˜¯ä¼šå°†æ•°æ®å­˜è¿›ç´¢å¼•ï¼Œå¦‚æœæŸ¥è¯¢ç»“æœä¸­éœ€è¦å°†è®°å½•æ˜¾ç¤ºå‡ºæ¥å°±è¦å­˜è¿›å»ï¼Œå¦‚æœæŸ¥è¯¢ç»“æœ * åªæ˜¯æ˜¾ç¤ºæ ‡é¢˜ä¹‹ç±»çš„å°±å¯ä»¥ä¸ç”¨å­˜ï¼Œè€Œä¸”å†…å®¹è¿‡é•¿ä¸å»ºè®®å­˜è¿›å» * ä½¿ç”¨TextFieldç±»æ˜¯å¯ä»¥ç”¨äºæŸ¥è¯¢çš„ã€‚ */ doc.add(new TextField("username", user.getUsername(), Field.Store.YES)); doc.add(new TextField("description",user.getDescription(), Field.Store.YES)); writer.addDocument(doc); writer.close(); &#125; /** * æ›´æ–°åšå®¢ç´¢å¼• * @param user * @throws Exception */ public void updateIndex(User user)throws Exception&#123; IndexWriter writer=getWriter(); Document doc=new Document(); doc.add(new StringField("id",String.valueOf(user.getUserId()), Field.Store.YES)); doc.add(new TextField("username", user.getUsername(), Field.Store.YES)); doc.add(new TextField("description",user.getDescription(), Field.Store.YES)); writer.updateDocument(new Term("id", String.valueOf(user.getUserId())), doc); writer.close(); &#125; /** * åˆ é™¤æŒ‡å®šåšå®¢çš„ç´¢å¼• * @param userId * @throws Exception */ public void deleteIndex(String userId)throws Exception&#123; IndexWriter writer=getWriter(); writer.deleteDocuments(new Term("id", userId)); writer.forceMergeDeletes(); // å¼ºåˆ¶åˆ é™¤ writer.commit(); writer.close(); &#125; /** * æŸ¥è¯¢ç”¨æˆ· * @param q æŸ¥è¯¢å…³é”®å­— * @return * @throws Exception */ public List&lt;User&gt; searchBlog(String q)throws Exception&#123; /** * æ³¨æ„çš„æ˜¯æŸ¥è¯¢ç´¢å¼•çš„ä½ç½®å¾—æ˜¯å­˜æ”¾ç´¢å¼•çš„ä½ç½®ï¼Œä¸ç„¶ä¼šæ‰¾ä¸åˆ°ã€‚ */ dir= FSDirectory.open(Paths.get("C://lucene")); IndexReader reader = DirectoryReader.open(dir); IndexSearcher is=new IndexSearcher(reader); BooleanQuery.Builder booleanQuery = new BooleanQuery.Builder(); SmartChineseAnalyzer analyzer=new SmartChineseAnalyzer(); /** * usernameå’Œdescriptionå°±æ˜¯æˆ‘ä»¬éœ€è¦è¿›è¡ŒæŸ¥æ‰¾çš„ä¸¤ä¸ªå­—æ®µ * åŒæ—¶åœ¨å­˜æ”¾ç´¢å¼•çš„æ—¶å€™è¦ä½¿ç”¨TextFieldç±»è¿›è¡Œå­˜æ”¾ã€‚ */ QueryParser parser=new QueryParser("username",analyzer); Query query=parser.parse(q); QueryParser parser2=new QueryParser("description",analyzer); Query query2=parser2.parse(q); booleanQuery.add(query, BooleanClause.Occur.SHOULD); booleanQuery.add(query2, BooleanClause.Occur.SHOULD); TopDocs hits=is.search(booleanQuery.build(), 100); QueryScorer scorer=new QueryScorer(query); Fragmenter fragmenter = new SimpleSpanFragmenter(scorer); /** * è¿™é‡Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦æ¥è‡ªå®šä¹‰æŸ¥æ‰¾å…³é”®å­—é«˜äº®æ—¶çš„æ ·å¼ã€‚ */ SimpleHTMLFormatter simpleHTMLFormatter=new SimpleHTMLFormatter("&lt;b&gt;&lt;font color='red'&gt;","&lt;/font&gt;&lt;/b&gt;"); Highlighter highlighter=new Highlighter(simpleHTMLFormatter, scorer); highlighter.setTextFragmenter(fragmenter); List&lt;User&gt; userList=new LinkedList&lt;User&gt;(); for(ScoreDoc scoreDoc:hits.scoreDocs)&#123; Document doc=is.doc(scoreDoc.doc); User user=new User(); user.setUserId(Integer.parseInt(doc.get(("id")))); user.setDescription(doc.get(("description"))); String username=doc.get("username"); String description=doc.get("description"); if(username!=null)&#123; TokenStream tokenStream = analyzer.tokenStream("username", new StringReader(username)); String husername=highlighter.getBestFragment(tokenStream, username); if(StringUtil.isEmpty(husername))&#123; user.setUsername(username); &#125;else&#123; user.setUsername(husername); &#125; &#125; if(description!=null)&#123; TokenStream tokenStream = analyzer.tokenStream("description", new StringReader(description)); String hContent=highlighter.getBestFragment(tokenStream, description); if(StringUtil.isEmpty(hContent))&#123; if(description.length()&lt;=200)&#123; user.setDescription(description); &#125;else&#123; user.setDescription(description.substring(0, 200)); &#125; &#125;else&#123; user.setDescription(hContent); &#125; &#125; userList.add(user); &#125; return userList; &#125;&#125; æŸ¥è¯¢Controllerçš„ç¼–å†™æ¥ä¸‹æ¥æ˜¯æŸ¥è¯¢Controllerï¼š123456789101112131415161718192021222324@RequestMapping("/q")public String search(@RequestParam(value = "q", required = false,defaultValue = "") String q, @RequestParam(value = "page", required = false, defaultValue = "1") String page, Model model, HttpServletRequest request) throws Exception &#123; LuceneIndex luceneIndex = new LuceneIndex() ; List&lt;User&gt; userList = luceneIndex.searchBlog(q); /** * å…³äºæŸ¥è¯¢ä¹‹åçš„åˆ†é¡µæˆ‘é‡‡ç”¨çš„æ˜¯æ¯æ¬¡åˆ†é¡µå‘èµ·çš„è¯·æ±‚éƒ½æ˜¯å°†æ‰€æœ‰çš„æ•°æ®æŸ¥è¯¢å‡ºæ¥ï¼Œ * å…·ä½“æ˜¯ç¬¬å‡ é¡µå†æˆªå–å¯¹åº”é¡µæ•°çš„æ•°æ®ï¼Œå…¸å‹çš„æ‹¿ç©ºé—´æ¢æ—¶é—´çš„åšæ³•ï¼Œå¦‚æœå„ä½æœ‰ä»€ä¹ˆ * é«˜æ‹›æ¬¢è¿å—æ•™ã€‚ */ Integer toIndex = userList.size() &gt;= Integer.parseInt(page) * 5 ? Integer.parseInt(page) * 5 : userList.size(); List&lt;User&gt; newList = userList.subList((Integer.parseInt(page) - 1) * 5, toIndex); model.addAttribute("userList",newList) ; String s = this.genUpAndDownPageCode(Integer.parseInt(page), userList.size(), q, 5, request.getServletContext(). getContextPath()); model.addAttribute("pageHtml",s) ; model.addAttribute("q",q) ; model.addAttribute("resultTotal",userList.size()) ; model.addAttribute("pageTitle","æœç´¢å…³é”®å­—'" + q + "'ç»“æœé¡µé¢") ; return "queryResult";&#125; å…¶ä¸­æœ‰ç”¨åˆ°ä¸€ä¸ªgenUpAndDownPageCode()æ–¹æ³•æ¥ç”Ÿæˆåˆ†é¡µçš„Htmlä»£ç ï¼Œå¦‚ä¸‹ï¼š1234567891011121314151617181920212223242526272829303132/** * æŸ¥è¯¢ä¹‹åçš„åˆ†é¡µ * @param page * @param totalNum * @param q * @param pageSize * @param projectContext * @return */private String genUpAndDownPageCode(int page,Integer totalNum,String q,Integer pageSize,String projectContext)&#123; long totalPage=totalNum%pageSize==0?totalNum/pageSize:totalNum/pageSize+1; StringBuffer pageCode=new StringBuffer(); if(totalPage==0)&#123; return ""; &#125;else&#123; pageCode.append("&lt;nav&gt;"); pageCode.append("&lt;ul class='pager' &gt;"); if(page&gt;1)&#123; pageCode.append("&lt;li&gt;&lt;a href='"+projectContext+"/q?page="+(page-1)+"&amp;q="+q+"'&gt;ä¸Šä¸€é¡µ&lt;/a&gt;&lt;/li&gt;"); &#125;else&#123; pageCode.append("&lt;li class='disabled'&gt;&lt;a href='#'&gt;ä¸Šä¸€é¡µ&lt;/a&gt;&lt;/li&gt;"); &#125; if(page&lt;totalPage)&#123; pageCode.append("&lt;li&gt;&lt;a href='"+projectContext+"/q?page="+(page+1)+"&amp;q="+q+"'&gt;ä¸‹ä¸€é¡µ&lt;/a&gt;&lt;/li&gt;"); &#125;else&#123; pageCode.append("&lt;li class='disabled'&gt;&lt;a href='#'&gt;ä¸‹ä¸€é¡µ&lt;/a&gt;&lt;/li&gt;"); &#125; pageCode.append("&lt;/ul&gt;"); pageCode.append("&lt;/nav&gt;"); &#125; return pageCode.toString();&#125; ä»£ç æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æ ¹æ®çš„é¡µæ•°ã€æ€»é¡µæ•°æ¥ç”Ÿæˆåˆ†é¡µä»£ç ï¼Œå¯¹äº†æˆ‘å‰ç«¯é‡‡ç”¨çš„æ˜¯ç°åœ¨æµè¡Œçš„Bootstrapï¼Œè¿™ä¸ªæœ‰ä¸ä¼šçš„å¯ä»¥å»ä»–å®˜ç½‘çœ‹çœ‹ï¼Œæ¯”è¾ƒç®€å•æ˜“ä¸Šæ‰‹ã€‚æ¥ä¸‹æ¥åªéœ€è¦ç¼–å†™æ˜¾ç¤ºç•Œé¢å°±å¤§åŠŸå‘Šæˆäº†ã€‚ æ˜¾ç¤ºç•Œé¢æˆ‘åªè´´å…³é”®ä»£ç ï¼Œå…·ä½“çš„å¯ä»¥å»Githubä¸ŠæŸ¥çœ‹ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041&lt;c:choose&gt; &lt;c:when test="$&#123;userList.size()==0 &#125;"&gt; &lt;div align="center" style="padding-top: 20px"&gt;&lt;font color="red"&gt;$&#123;q&#125;&lt;/font&gt;æœªæŸ¥è¯¢åˆ°ç»“æœï¼Œè¯·æ¢ä¸ªå…³é”®å­—è¯•è¯•ï¼&lt;/div&gt; &lt;/c:when&gt; &lt;c:otherwise&gt; &lt;div align="center" style="padding-top: 20px"&gt; æŸ¥è¯¢&lt;font color="red"&gt;$&#123;q&#125;&lt;/font&gt;å…³é”®å­—ï¼Œçº¦$&#123;resultTotal&#125;æ¡è®°å½•ï¼ &lt;/div&gt; &lt;c:forEach var="u" items="$&#123;userList &#125;" varStatus="status"&gt; &lt;div class="panel-heading "&gt; &lt;div class="row"&gt; &lt;div class="col-md-6"&gt; &lt;div class="row"&gt; &lt;div class="col-md-12"&gt; &lt;b&gt; &lt;a href="&lt;%=path %&gt;/user/showUser/$&#123;u.userId&#125;"&gt;$&#123;u.username&#125;&lt;/a&gt; &lt;/b&gt; &lt;br/&gt; $&#123;u.description&#125; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class="col-md-4 col-md-offset-2"&gt; &lt;p class="text-muted text-right"&gt; $&#123;u.password&#125; &lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class="panel-footer"&gt; &lt;p class="text-right"&gt; &lt;span class="label label-default"&gt; &lt;span class="glyphicon glyphicon-comment" aria-hidden="true"&gt;&lt;/span&gt; $&#123;u.password&#125; &lt;/span&gt; &lt;/p&gt; &lt;/div&gt; &lt;/c:forEach&gt; &lt;/c:otherwise&gt; &lt;/c:choose&gt; åˆ©ç”¨JSTLæ ‡ç­¾å³å¯å°†æ•°æ®å¾ªç¯å±•ç¤ºå‡ºæ¥ï¼Œå…³é”®å­—å°±ä¸éœ€è¦å•ç‹¬åšå¤„ç†äº†ï¼Œåœ¨åå°æŸ¥è¯¢çš„æ—¶å€™å·²ç»åšäº†ä¿®æ”¹äº†ã€‚ æ€»ç»“å…³äºå…¨æ–‡æ£€ç´¢çš„æ¡†æ¶ä¸æ­¢Luceneè¿˜æœ‰solrï¼Œå…·ä½“è°å¥½æœ‰ä»€ä¹ˆåŒºåˆ«æˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥šï¼Œå‡†å¤‡ä¸‹æ¥èŠ±ç‚¹æ—¶é—´ç ”ç©¶ä¸‹ã€‚å“¦å¯¹äº†ï¼Œæœ€è¿‘åˆæœ‰ç‚¹æƒ³åšAndroidå¼€å‘äº†ï¼Œæ„Ÿè§‰åšç‚¹ä¸œè¥¿èƒ½å¤Ÿå®å®åœ¨åœ¨çš„æ‘¸å¾—åˆ°é€¼æ ¼ç¡®å®è¦é«˜äº›(ç°åœ¨ä¸»è¦åœ¨åšåç«¯å¼€å‘)ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å…³æ³¨ä¸‹ã€‚å“¦å¯¹äº†ï¼Œç›´æ¥è¿è¡Œæˆ‘ä»£ç çš„æœ‹å‹è¦ä¸‹æ³¨æ„ï¼š é¦–å…ˆè¦å°†æ•°æ®åº“å€’åˆ°è‡ªå·±çš„MySQLä¸Š ä¹‹ååœ¨é¦–æ¬¡è¿è¡Œçš„æ—¶å€™éœ€è¦ç‚¹å‡»é‡æ–°ç”Ÿæˆç´¢å¼•æŒ‰é’®ç”Ÿæˆä¸€éç´¢å¼•ä¹‹åæ‰èƒ½è¿›è¡Œæœç´¢ï¼Œå› ä¸ºç°åœ¨çš„æ•°æ®æ˜¯ç›´æ¥å­˜åˆ°æ•°æ®åº“ä¸­çš„ï¼Œå¹¶æ²¡æœ‰åœ¨æ–°å¢çš„æ—¶å€™å°±å¢åŠ ç´¢å¼•ï¼Œåœ¨å®é™…å¼€å‘çš„æ—¶å€™éœ€è¦åœ¨æ–°å¢æ•°æ®é‚£é‡Œå†ç”Ÿæˆä¸€ä»½ç´¢å¼•ï¼Œå°±ç›´æ¥è°ƒç”¨LuceneIndexç±»ä¸­çš„addIndexæ–¹æ³•ä¼ å…¥å®ä½“å³å¯ï¼Œå†åšæ›´æ–°ã€åˆ é™¤æ“ä½œçš„æ—¶å€™ä¹ŸåŒæ ·éœ€è¦å¯¹ç´¢å¼•åšæ“ä½œã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>IDEA</tag>
        <tag>Lucene</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSM(ä¸€)æ¡†æ¶çš„æ•´åˆ]]></title>
    <url>%2F2016%2F06%2F28%2FSSM1%2F</url>
    <content type="text"><![CDATA[å‰è¨€æœ€è¿‘è¿™å‡ å¹´JetBrainså…¬å¸å¼€å‘çš„IDEAæ˜¯è¶Šæ¥è¶Šæµè¡Œäº†ï¼Œç”šè‡³Googleçš„å®˜æ–¹IDEéƒ½æ˜¯IDEAæ¥å®šåˆ¶çš„ï¼Œå¯è§IDEAçš„å‘å±•è¶‹åŠ¿æ˜¯è¶Šæ¥è¶Šå¥½ï¼Œç”±äºåšä¸»æ¥è§¦IDEAçš„æ—¶é—´ä¹Ÿä¸é•¿ï¼Œæ‰€ä»¥æœ‰å…³IDEAå’ŒEclipseçš„åŒºåˆ«å’Œä¼˜åŠ£åŠ¿è¯·è‡ªè¡Œç™¾åº¦äº†ã€‚å€Ÿæ­¤æœºä¼šæˆ‘å°±ä½¿ç”¨IDEAæ¥æ•´åˆä¸€ä¸‹SSMï¼Œé’ˆå¯¹äºåˆå­¦è€…(åˆæ¬¡ä½¿ç”¨IDEAå’ŒJAVAEEåˆå­¦è€…)è¿˜æ˜¯æœ‰å¸®åŠ©çš„ã€‚ æ–°å»ºSSMé¡¹ç›®å“¦å¯¹äº†ï¼Œå…³äºIDEAçš„ç‰ˆæœ¬é—®é¢˜å¼ºçƒˆå»ºè®®ä½¿ç”¨æ——èˆ°ç‰ˆï¼Œæœ‰æ¡ä»¶çš„å°±è´­ä¹°ï¼Œæ²¡æ¡ä»¶çš„å˜›ã€‚ã€‚å¤©æœä½ æ‡‚çš„ã€‚åœ¨æ¬¢è¿ç•Œé¢ç‚¹å‡»Create New Projectã€‚ä¹‹åé€‰æ‹©Maven(æ–°å»ºJAVAEEé¡¹ç›®æ˜¯éœ€è¦å®‰è£…JDKçš„ï¼Œè¿™ä¸ªå°±ä¸åœ¨è¿™é‡Œè®²è§£äº†ã€‚)é€‰å¥½ä¹‹åç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚ä¹‹åå¡«å…¥GroupIDå’ŒArtifactIDè¿™é‡Œå°½é‡æŒ‰ç…§Mavençš„å‘½åè§„èŒƒæ¥å³å¯ã€‚ä¹‹åç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œå¡«å…¥é¡¹ç›®åç§°ï¼Œè¿™é‡Œæˆ‘å»ºè®®å’Œä¹‹å‰å¡«å†™çš„ArtifactIDåç§°ä¸€æ ·å³å¯ã€‚ç‚¹å‡»Finishå®Œæˆé¡¹ç›®çš„åˆ›å»ºã€‚ä¹‹åå°½é‡ä¸è¦åšå…¶ä»–æ“ä½œï¼Œè®©IDEAå®Œæˆç´¢å¼•åˆ›å»ºã€‚ å®Œå–„ç›®å½•ç»“æ„é¦–å…ˆè§‚å¯Ÿä¸€ä¸‹IDEAç»™æˆ‘ä»¬ç”Ÿæˆçš„ç›®å½•ç»“æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„Mavenç›®å½•ã€‚ä½†æ˜¯å…¶ä¸­å°‘äº†ä¸€ä¸ªwebappç›®å½•ç”¨äºå­˜æ”¾jspã€cssã€jsã€å›¾ç‰‡ä¹‹ç±»çš„æ–‡ä»¶ã€‚ä¹‹åè¿˜éœ€è¦å®Œå–„æˆ‘ä»¬çš„ç›®å½•ç»“æ„ï¼Œå¦‚ä¸‹å›¾ï¼šä»¥ä¸Šçš„å‘½åéƒ½æ˜¯æˆ‘ä»¬å¼€å‘è¿‡ç¨‹ä¸­å¸¸ç”¨çš„å‘½åè§„åˆ™ï¼Œä¸ä¸€å®šæŒ‰ç…§æˆ‘è¿™æ ·æ¥ï¼Œä½†æ˜¯æœ€å¥½æ˜¯æœ‰ä¸€å®šçš„è§„èŒƒã€‚ POM.xmlpom.xmlæ˜¯æ•´ä¸ªmavençš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œé‡Œé¢æœ‰å¯¹é¡¹ç›®çš„æè¿°å’Œé¡¹ç›®æ‰€éœ€è¦çš„ä¾èµ–ã€‚å“¦å¯¹äº†ï¼Œåœ¨ä¿®æ”¹pom.xmlæ–‡ä»¶ä¹‹å‰æˆ‘ä»¬æœ€å¥½å…ˆè®¾ç½®ä¸€ä¸‹è¯¥é¡¹ç›®çš„Mavenè®¾ç½®(IDEAå¯¹æ¯ä¸ªé¡¹ç›®çš„mavenè®¾ç½®å’ŒEclipseä¸ä¸€æ ·ï¼Œä¸æ˜¯è®¾ç½®ä¸€æ¬¡å°±å¯äº†ï¼Œå¦‚æœä»Šåè¿˜è¦æ–°å»ºé¡¹ç›®é‚£å°±è¿˜éœ€è¦è®¾ç½®ï¼ŒåŒæ—¶æŒ‰ä½ctrl,alt,sæ˜¯æ‰“å¼€è®¾ç½®çš„å¿«æ·é”®ï¼Œæ›´å¤šæœ‰å…³IDEAçš„æ“ä½œä»Šåä¼šæ›´æ–°ç›¸å…³åšæ–‡ã€‚) IDEAçš„Mavenè®¾ç½®åœ¨Eclipseä¸­ç”¨è¿‡Mavençš„éƒ½åº”è¯¥çŸ¥é“ï¼Œè¿™é‡Œæ˜¯å°†é¡¹ç›®çš„Mavenæ¢æˆæˆ‘ä»¬è‡ªå·±å®‰è£…çš„Mavenï¼Œä¸‹é¢ä¸¤ä¸ªç›®å½•æ˜¯é€‰æ‹©Mavené…ç½®æ–‡ä»¶ï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› åœ¨Eclipseä¸­é€‰æ‹©äº†é…ç½®æ–‡ä»¶ä¹‹åä¼šè‡ªåŠ¨çš„å°†Mavenæœ¬åœ°å‚åº“çš„è·¯å¾„æ›´æ”¹ä¸ºä½ settings.xmlä¸­é…ç½®çš„è·¯å¾„ã€‚æ—¢ç„¶è¿™é‡Œæ²¡æœ‰è‡ªåŠ¨é€‰ä¸­é‚£æˆ‘ä»¬å°±æ‰‹åŠ¨ä¿®æ”¹å³å¯ï¼Œå°½é‡ä¸è¦æ”¾åœ¨Cç›˜ï¼Œä¸€æ˜¯ç”¨ä¹…ä¹‹åæœ¬åœ°å‚åº“å ç”¨çš„ç©ºé—´ä¼šæ¯”è¾ƒå¤§ï¼ŒäºŒæ˜¯ä¸‡ä¸€ç³»ç»Ÿå´©æºƒçš„è¯è¿˜æœ‰å¯èƒ½æ‰¾å›æ¥ã€‚ ä¿®æ”¹pom.xmlä»¥ä¸‹æ˜¯æˆ‘çš„pom.xmlæ–‡ä»¶ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;!--suppress MavenModelInspection --&gt;&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.crossoverJie&lt;/groupId&gt; &lt;artifactId&gt;SSM&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;source&gt;1.6&lt;/source&gt; &lt;target&gt;1.6&lt;/target&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;spring.version&gt;4.1.4.RELEASE&lt;/spring.version&gt; &lt;jackson.version&gt;2.5.0&lt;/jackson.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;!-- spring --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-core&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-beans&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-context&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-tx&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-web&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-test&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;!-- ä½¿ç”¨SpringMVCéœ€é…ç½® --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!-- å…³ç³»å‹æ•°æ®åº“æ•´åˆæ—¶éœ€é…ç½® å¦‚hibernate jpaç­‰ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-orm&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt; &lt;version&gt;1.2.4&lt;/version&gt; &lt;/dependency&gt; &lt;!-- log4j --&gt; &lt;dependency&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j&lt;/artifactId&gt; &lt;version&gt;1.2.17&lt;/version&gt; &lt;/dependency&gt; &lt;!-- mysqlè¿æ¥ --&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.34&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis&lt;/artifactId&gt; &lt;version&gt;3.3.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid&lt;/artifactId&gt; &lt;version&gt;1.0.18&lt;/version&gt; &lt;/dependency&gt; &lt;!-- json --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.3&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt; &lt;version&gt;$&#123;jackson.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-core&lt;/artifactId&gt; &lt;version&gt;$&#123;jackson.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;version&gt;$&#123;jackson.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;!-- aop --&gt; &lt;dependency&gt; &lt;groupId&gt;org.aspectj&lt;/groupId&gt; &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt; &lt;version&gt;1.8.4&lt;/version&gt; &lt;/dependency&gt; &lt;!-- servlet --&gt; &lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;servlet-api&lt;/artifactId&gt; &lt;version&gt;3.0-alpha-1&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;jstl&lt;/artifactId&gt; &lt;version&gt;1.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt; &lt;version&gt;3.4&lt;/version&gt; &lt;/dependency&gt; &lt;!-- ä¸Šä¼ æ–‡ä»¶ --&gt; &lt;dependency&gt; &lt;groupId&gt;commons-fileupload&lt;/groupId&gt; &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt; &lt;version&gt;1.3.1&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/project&gt; å…³äºmavençš„çŸ¥è¯†ç‚¹æˆ‘å°±ä¸ç»†è®²äº†ï¼Œæ¯•ç«Ÿè¿™æ˜¯ä¸€ä¸ªæ•´åˆæ•™ç¨‹ã€‚ spring-mvc.xmlè¿™ä¸ªé…ç½®æ–‡ä»¶æ˜¯springMVCçš„é…ç½®æ–‡ä»¶ï¼šé‡Œé¢çš„æˆ‘éƒ½å†™æœ‰æ³¨é‡Šï¼Œåº”è¯¥éƒ½èƒ½çœ‹æ‡‚ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p" xmlns:context="http://www.springframework.org/schema/context" xmlns:mvc="http://www.springframework.org/schema/mvc" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd"&gt; &lt;!-- è‡ªåŠ¨æ‰«æè¯¥åŒ…ï¼Œä½¿SpringMVCè®¤ä¸ºåŒ…ä¸‹ç”¨äº†@controlleræ³¨è§£çš„ç±»æ˜¯æ§åˆ¶å™¨ --&gt; &lt;context:component-scan base-package="com.crossoverJie.controller" /&gt; &lt;!--é¿å…IEæ‰§è¡ŒAJAXæ—¶ï¼Œè¿”å›JSONå‡ºç°ä¸‹è½½æ–‡ä»¶ --&gt; &lt;!--&lt;bean id="mappingJacksonHttpMessageConverter" class="org.springframework.http.converter.json.MappingJacksonHttpMessageConverter"&gt; &lt;property name="supportedMediaTypes"&gt; &lt;list&gt; &lt;value&gt;text/html;charset=UTF-8&lt;/value&gt; &lt;/list&gt; &lt;/property&gt; &lt;/bean&gt;--&gt; &lt;mvc:annotation-driven/&gt; &lt;!-- å¯åŠ¨SpringMVCçš„æ³¨è§£åŠŸèƒ½ï¼Œå®Œæˆè¯·æ±‚å’Œæ³¨è§£POJOçš„æ˜ å°„ --&gt; &lt;!-- å®šä¹‰è·³è½¬çš„æ–‡ä»¶çš„å‰åç¼€ ï¼Œè§†å›¾æ¨¡å¼é…ç½®--&gt; &lt;bean class="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt; &lt;!-- è¿™é‡Œçš„é…ç½®æˆ‘çš„ç†è§£æ˜¯è‡ªåŠ¨ç»™åé¢actionçš„æ–¹æ³•returnçš„å­—ç¬¦ä¸²åŠ ä¸Šå‰ç¼€å’Œåç¼€ï¼Œå˜æˆä¸€ä¸ª å¯ç”¨çš„urlåœ°å€ --&gt; &lt;property name="prefix" value="/WEB-INF/jsp/" /&gt; &lt;property name="suffix" value=".jsp" /&gt; &lt;/bean&gt; &lt;!-- é…ç½®æ–‡ä»¶ä¸Šä¼ ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨æ–‡ä»¶ä¸Šä¼ å¯ä»¥ä¸ç”¨é…ç½®ï¼Œå½“ç„¶å¦‚æœä¸é…ï¼Œé‚£ä¹ˆé…ç½®æ–‡ä»¶ä¸­ä¹Ÿä¸å¿…å¼•å…¥ä¸Šä¼ ç»„ä»¶åŒ… --&gt; &lt;bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver"&gt; &lt;!-- é»˜è®¤ç¼–ç  --&gt; &lt;property name="defaultEncoding" value="utf-8" /&gt; &lt;!-- æ–‡ä»¶å¤§å°æœ€å¤§å€¼ --&gt; &lt;property name="maxUploadSize" value="10485760000" /&gt; &lt;!-- å†…å­˜ä¸­çš„æœ€å¤§å€¼ --&gt; &lt;property name="maxInMemorySize" value="40960" /&gt; &lt;/bean&gt; &lt;!-- é…ç½®æ‹¦æˆªå™¨ --&gt; &lt;!--&lt;mvc:interceptors&gt; &lt;mvc:interceptor&gt; &amp;lt;!&amp;ndash; &lt;mvc:mapping path="/**"/&gt;æ‹¦æˆªæ‰€æœ‰ &amp;ndash;&amp;gt; &lt;mvc:mapping path="/user/**"/&gt; &lt;mvc:mapping path="/role/**"/&gt; &lt;mvc:mapping path="/function/**"/&gt; &lt;mvc:mapping path="/news/**"/&gt; &lt;mvc:mapping path="/img/**"/&gt; &lt;bean class="com.crossoverJie.intercept.Intercept"&gt;&lt;/bean&gt; &lt;/mvc:interceptor&gt; &lt;/mvc:interceptors&gt;--&gt;&lt;/beans&gt; å…³äºä¸Šé¢æ‹¦æˆªå™¨æ³¨é‡Šæ‰çš„é‚£é‡Œï¼Œé…ç½®æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªæ•´åˆé¡¹ç›®ï¼Œæ‰€ä»¥é‡Œè¾¹ä¹Ÿæ²¡æœ‰ç”¨åˆ°æ‹¦æˆªå™¨ï¼Œä¸ºäº†é˜²æ­¢è¿è¡ŒæŠ¥é”™æ‰€ä»¥å°±å…ˆæ³¨é‡Šæ‰äº†ã€‚å¦‚æœåç»­éœ€è¦å¢åŠ æ‹¦æˆªå™¨ï¼Œå¯ä»¥å‚è€ƒè¿™é‡Œçš„é…ç½®ã€‚ spring-mybatis.xmlè¿™ä¸ªæ˜¯springå’Œmybatisçš„æ•´åˆé…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­è¿˜æœ‰Druidè¿æ¥æ± çš„é…ç½®ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd"&gt; &lt;!-- è‡ªåŠ¨æ‰«æ --&gt; &lt;context:component-scan base-package="com.crossoverJie" /&gt; &lt;!-- å¼•å…¥é…ç½®æ–‡ä»¶ --&gt; &lt;bean id="propertyConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"&gt; &lt;property name="location" value="classpath:jdbc.properties" /&gt; &lt;/bean&gt; &lt;bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource" init-method="init" destroy-method="close"&gt; &lt;!-- æŒ‡å®šè¿æ¥æ•°æ®åº“çš„é©±åŠ¨ --&gt; &lt;property name="driverClassName" value="$&#123;jdbc.driverClass&#125;" /&gt; &lt;property name="url" value="$&#123;jdbc.url&#125;" /&gt; &lt;property name="username" value="$&#123;jdbc.user&#125;" /&gt; &lt;property name="password" value="$&#123;jdbc.password&#125;" /&gt; &lt;!-- é…ç½®åˆå§‹åŒ–å¤§å°ã€æœ€å°ã€æœ€å¤§ --&gt; &lt;property name="initialSize" value="3" /&gt; &lt;property name="minIdle" value="3" /&gt; &lt;property name="maxActive" value="20" /&gt; &lt;!-- é…ç½®è·å–è¿æ¥ç­‰å¾…è¶…æ—¶çš„æ—¶é—´ --&gt; &lt;property name="maxWait" value="60000" /&gt; &lt;!-- é…ç½®é—´éš”å¤šä¹…æ‰è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œæ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿æ¥ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt; &lt;property name="timeBetweenEvictionRunsMillis" value="60000" /&gt; &lt;!-- é…ç½®ä¸€ä¸ªè¿æ¥åœ¨æ± ä¸­æœ€å°ç”Ÿå­˜çš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt; &lt;property name="minEvictableIdleTimeMillis" value="300000" /&gt; &lt;property name="validationQuery" value="SELECT 'x'" /&gt; &lt;property name="testWhileIdle" value="true" /&gt; &lt;property name="testOnBorrow" value="false" /&gt; &lt;property name="testOnReturn" value="false" /&gt; &lt;!-- æ‰“å¼€PSCacheï¼Œå¹¶ä¸”æŒ‡å®šæ¯ä¸ªè¿æ¥ä¸ŠPSCacheçš„å¤§å° --&gt; &lt;property name="poolPreparedStatements" value="true" /&gt; &lt;property name="maxPoolPreparedStatementPerConnectionSize" value="20" /&gt; &lt;!-- é…ç½®ç›‘æ§ç»Ÿè®¡æ‹¦æˆªçš„filtersï¼Œå»æ‰åç›‘æ§ç•Œé¢sqlæ— æ³•ç»Ÿè®¡ --&gt; &lt;property name="filters" value="stat" /&gt; &lt;/bean&gt; &lt;!-- springå’ŒMyBatiså®Œç¾æ•´åˆï¼Œä¸éœ€è¦mybatisçš„é…ç½®æ˜ å°„æ–‡ä»¶ --&gt; &lt;bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean"&gt; &lt;property name="dataSource" ref="dataSource" /&gt; &lt;!-- è‡ªåŠ¨æ‰«æmapping.xmlæ–‡ä»¶ --&gt; &lt;property name="mapperLocations" value="classpath:mapping/*.xml"&gt;&lt;/property&gt; &lt;/bean&gt; &lt;!-- DAOæ¥å£æ‰€åœ¨åŒ…åï¼ŒSpringä¼šè‡ªåŠ¨æŸ¥æ‰¾å…¶ä¸‹çš„ç±» --&gt; &lt;bean class="org.mybatis.spring.mapper.MapperScannerConfigurer"&gt; &lt;property name="basePackage" value="com.crossoverJie.dao" /&gt; &lt;property name="sqlSessionFactoryBeanName" value="sqlSessionFactory"&gt;&lt;/property&gt; &lt;/bean&gt; &lt;!-- (äº‹åŠ¡ç®¡ç†)transaction manager, use JtaTransactionManager for global tx --&gt; &lt;bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt; &lt;property name="dataSource" ref="dataSource" /&gt; &lt;/bean&gt;&lt;/beans&gt; ä»¥ä¸Šä¸¤ä¸ªå°±æ˜¯æœ€é‡è¦çš„é…ç½®æ–‡ä»¶äº†ï¼Œåªè¦å…¶ä¸­çš„åŒ…åå’Œé…ç½®æ–‡ä»¶ä¸­çš„åå­—ä¸€æ ·å°±ä¸ä¼šå‡ºé—®é¢˜ã€‚å…³äºxxMpper.xmlä»¥åŠå®ä½“ç±»çš„ç”Ÿæˆï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©mybatis-generatorè‡ªåŠ¨ç”Ÿæˆå·¥å…·æ¥ç”Ÿæˆï¼Œæ–¹ä¾¿å¿«æ·ã€‚ IDEAé…ç½®Tomcatå…³äºTomcatçš„ä¸‹è½½ä¸å®‰è£…æˆ‘è¿™é‡Œå°±ä¸å¤šä»‹ç»äº†ã€‚æŒ‰ç…§ä¸‹å›¾é€‰æ‹©ï¼šåœ¨nameä¸­ä¸ºè¿™ä¸ªTomcatè¾“å…¥ä¸€ä¸ªåå­—ã€‚ä¹‹åé€‰æ‹©ä½ æœ¬åœ°Tomcatçš„ç›®å½•ç‚¹å‡»Okå³å¯ã€‚ç‚¹å‡»applyå’Œä¿å­˜ä¹‹åå°±è¿”å›é¦–é¡µå³å¯çœ‹åˆ°Tomcatçš„æ ‡è¯†ã€‚æ ¹æ®éœ€è¦ç‚¹å‡»Runå’ŒDebugå³å¯è¿è¡Œã€‚ è¿è¡Œç»“æœå¦‚ä¸‹ï¼šç‚¹å‡»ä¸Šå›¾çš„2,3,4å¯çœ‹åˆ°ä¸åŒç”¨æˆ·çš„ç»“æœï¼Œå¦‚æœä½ èµ°åˆ°è¿™ä¸€æ­¥ï¼Œé‚£ä¹ˆæ­å–œä½ æ•´åˆæˆåŠŸã€‚ æ€»ç»“ä»¥ä¸Šæºç éƒ½åœ¨githubä¸Šã€‚é¡¹ç›®åœ°å€ï¼šSSMæ¬¢è¿æ‹ç –ã€‚]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring</tag>
        <tag>SpringMVC</tag>
        <tag>Mybatis</tag>
        <tag>IDEA</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ—¥å¸¸è®°å½•ï¼ˆä¸‰ï¼‰æ›´æ¢Hexoä¸»é¢˜]]></title>
    <url>%2F2016%2F06%2F18%2Fnormal-skill3%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ç”±äºåšä¸»çš„å–œæ–°åŒæ—§ï¼Œå†ç»è¿‡ä¸€æ®µæ—¶é—´å¯¹ä¸Šä¸€ä¸ªä¸»é¢˜çš„å®¡ç¾ç–²åŠ³åŠ ä¸Šæˆ‘ä¸“(zhuang)ç ”(bi)çš„ç²¾ç¥äºæ˜¯å°±æƒ³æ‰¾ä¸€ä¸ªBæ ¼è¾ƒé«˜çš„ä¸»é¢˜ã€‚ç»è¿‡ä¸€æ®µæ—¶é—´çš„æŸ¥æ‰¾å‘ç°NexTè¿™ä¸ªä¸»é¢˜ç®€æ´è€Œä¸å¤±åä¸½ï¼Œä½è°ƒè€Œä¸å¤±é€¼æ ¼(å°±ä¸æ”¶å¹¿å‘Šè´¹äº†)ç‰¹åˆ«é€‚åˆæˆ‘ï¼Œæ¥ç€å°±ç€æ‰‹å¼€å¹²ã€‚ å®‰è£…NexTä¸»é¢˜ä»Gitä¸Šå…‹éš†ä¸»é¢˜è¿™é‡Œæˆ‘å°±ä¸ä»‹ç»æœ‰å…³Hexoçš„ä¸œè¥¿äº†ï¼Œé»˜è®¤æ˜¯çŸ¥é“å¦‚ä½•æ­å»ºHexoåšå®¢çš„ã€‚è¿˜ä¸å¤ªæ¸…æ¥šçš„è¯·è‡ªè¡Œç™¾åº¦ã€‚é¦–å…ˆå°†NexTä¸»é¢˜å…ˆå…‹éš†åˆ°è‡ªå·±ç”µè„‘ä¸Šï¼š cd your-hexo-site git clone https://github.com/iissnan/hexo-theme-next themes/nextã€‚å®‰è£…ä¸»é¢˜æ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦å°†ç«™ç‚¹ä¸‹çš„_config.ymlé…ç½®æ–‡ä»¶ä¸­çš„ä¸»é¢˜é…ç½®æ›´æ¢æˆNextï¼Œå¦‚ä¸‹å›¾ï¼šå…¶å®è¿™æ ·ä¸»é¢˜å°±é…å¥½äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ã€‚ NexTä¸»é¢˜é…ç½®Hexoé…ç½®æ–‡ä»¶ç›¸å…³é…ç½®Nextä¸»é¢˜çš„ä¸ªäººå¤´åƒæ˜¯åœ¨Hexoé…ç½®æ–‡ä»¶ä¸­çš„ã€‚NexTåŒæ ·ä¹Ÿæ”¯æŒå¤šè¯´é…ç½®ï¼Œæˆ‘ä»¬åªéœ€è¦å°†ä½ è‡ªå·±çš„å¤šè¯´è´¦å·ä¹Ÿé…ç½®åˆ°Hexoçš„é…ç½®æ–‡ä»¶ä¸­å³å¯ã€‚duoshuo_shortname: your name Nexté…ç½®æ–‡ä»¶ç›¸å…³é…ç½®NexTä¸»é¢˜éå¸¸å¸å¼•æˆ‘çš„ä¸€ç‚¹å°±æ˜¯ä»–æ”¯æŒæ‰“èµåŠŸèƒ½ï¼Œè¿™è®©æˆ‘è¿™ç§ç©·é€¼ç¨‹åºçŒ¿åˆçœ‹åˆ°äº†ç”Ÿè·¯(å¤šåŠä¹Ÿæ²¡äººä¼šç»™æˆ‘æ‰“èµ)ï¼Œä»¥ä¸‹ä¸€æ®µé…ç½®å³å¯åœ¨æ¯ç¯‡åšæ–‡ä¸‹è¾¹å¼€å¯æ‰“èµåŠŸèƒ½ã€‚å¾®ä¿¡ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯æˆ‘æ‰¾äº†åŠå¤©æ²¡æœ‰æ‰¾åˆ°ç”Ÿæˆå¾®ä¿¡æ”¯ä»˜ç çš„åœ°æ–¹ã€‚å…¶ä»–çš„ä¸€äº›é…ç½®æˆ‘è§‰å¾—éƒ½æ¯”è¾ƒç®€å•ï¼Œçœ‹å®˜æ–¹çš„å¸®åŠ©æ–‡æ¡£ä¹Ÿæ˜¯å®Œå…¨å¯ä»¥çš„ï¼Œæœ‰é—®é¢˜çš„æˆ‘ä»¬å¯ä»¥å†è®¨è®ºã€‚ ä¸€ä¸ªç»•å‘æŒ‡å—æˆ‘åœ¨æ¢å®ŒNexTä¹‹åå‘ç°åœ¨é¦–é¡µè¿™é‡Œæ˜¾ç¤ºçš„åˆ†ç±»å’Œä¾¿ç­¾çš„ç»Ÿè®¡éƒ½æ˜¯å¯¹çš„ï¼Œä½†æ˜¯ç‚¹è¿›å»ä¹‹åå°±æ˜¯ç©ºç™½çš„ã€‚æˆ‘æŸ¥çœ‹äº†Hexoå’ŒNexTçš„æ–‡æ¡£å‘ç°æˆ‘å†™çš„æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä¹‹åå°±æ‡µé€¼äº†ã€‚ã€‚ã€‚å„ä½æœ‰ç¢°åˆ°è¿™ä¸ªé—®é¢˜çš„å¯ä»¥å¾€ä¸‹çœ‹ã€‚ ç»•å‘ä¹‹åæˆ‘ä»”ç»†çš„æŸ¥é˜…äº†NexTçš„æ–‡æ¡£ï¼Œå‘ç°ä»–æ‰€ä½¿ç”¨çš„tagså’Œcategoriesæ–‡ä»¶å¤¹ä¸‹çš„index.mdçš„æ ¼å¼æ˜¯è¿™æ ·çš„ï¼š12345---title: tagsdate: 2016-06-16 02:13:06type: &quot;tags&quot;--- è¿™å’Œæˆ‘ä¹‹å‰ä½¿ç”¨çš„JackManä¸»é¢˜æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„(æœ‰å…³JackManä¸»é¢˜å¯ä»¥è‡ªè¡ŒæŸ¥é˜…)ã€‚ä¹‹åæˆ‘è®²categoriesæ–‡ä»¶ä¸‹çš„index.mdæ–‡ä»¶ä¹Ÿæ¢æˆè¿™æ ·çš„æ ¼å¼å°±æ²¡æœ‰é—®é¢˜äº†ã€‚å¦‚æœä½ å’Œæˆ‘ä¸€æ ·çœ¼ç¥ä¸å¥½çš„è¯å»ºè®®é…å‰¯çœ¼é•œã€‚ æ€»ç»“å…¶å®ä»¥ä¸Šçš„å¾ˆå¤šä¸œè¥¿éƒ½æ˜¯åœ¨NexTå®˜æ–¹æ–‡æ¡£é‡ŒæŸ¥å¾—åˆ°çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šå°è¯•æä¸€ç‚¹pull requestæ¥æ›´åŠ æ·±å…¥çš„äº†è§£Hexoã€‚]]></content>
      <categories>
        <category>æ—¥å¸¸è®°å½•</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ—¥å¸¸è®°å½•ï¼ˆäºŒï¼‰SpringMvcå¯¼å‡ºExcel]]></title>
    <url>%2F2016%2F06%2F14%2Fnormal-skill2%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ç›¸ä¿¡å¾ˆå¤šæœ‹å‹åœ¨å®é™…å·¥ä½œä¸­éƒ½ä¼šè¦å°†æ•°æ®å¯¼å‡ºæˆExcelçš„éœ€æ±‚ï¼Œé€šå¸¸è¿™æ ·çš„åšæ³•æœ‰ä¸¤ç§ã€‚ä¸€æ˜¯é‡‡ç”¨JXLæ¥ç”ŸæˆExcelï¼Œä¹‹åä¿å­˜åˆ°æœåŠ¡å™¨ï¼Œç„¶ååœ¨ç”Ÿæˆé¡µé¢ä¹‹åä¸‹è½½è¯¥æ–‡ä»¶ã€‚äºŒæ˜¯ä½¿ç”¨POIæ¥ç”ŸæˆExcelï¼Œä¹‹åä½¿ç”¨Streamçš„æ–¹å¼è¾“å‡ºåˆ°å‰å°ç›´æ¥ä¸‹è½½(ps:å½“ç„¶ä¹Ÿå¯ä»¥ç”Ÿæˆåˆ°æœåŠ¡å™¨ä¸­å†ä¸‹è½½ã€‚)ã€‚è¿™é‡Œæˆ‘ä»¬è®¨è®ºç¬¬äºŒç§ã€‚è‡³äºä¸¤ç§æ–¹å¼çš„ä¼˜ç¼ºç‚¹è¯·è‡ªè¡Œç™¾åº¦ã€‚ Struts2çš„æ–¹å¼é€šå¸¸æˆ‘ä¼šå°†å·²ç»ç”Ÿæˆå¥½çš„HSSFWorkbookæ”¾åˆ°ä¸€ä¸ªInputStreamä¸­ï¼Œç„¶åå†åˆ°xmlé…ç½®æ–‡ä»¶ä¸­å°†è¿”å›ç»“æœæ›´æ”¹ä¸ºstreamçš„æ–¹å¼ã€‚å¦‚ä¸‹ï¼š12345678private void responseData(HSSFWorkbook wb) throws IOException &#123; ByteArrayOutputStream baos = new ByteArrayOutputStream(); wb.write(baos); baos.flush(); byte[] aa = baos.toByteArray(); excelStream = new ByteArrayInputStream(aa, 0, aa.length); baos.close();&#125; é…ç½®æ–‡ä»¶ï¼š1234567&lt;action name="exportXxx" class="xxxAction" method="exportXxx"&gt; &lt;result name="exportSuccess" type="stream"&gt; &lt;param name="inputName"&gt;excelStream&lt;/param&gt; &lt;param name="contentType"&gt;application/vnd.ms-excel&lt;/param&gt; &lt;param name="contentDisposition"&gt;attachment;filename="Undefined.xls"&lt;/param&gt; &lt;/result&gt;&lt;/action&gt; è¿™æ ·å³å¯è¾¾åˆ°ç‚¹å‡»é“¾æ¥å³å¯ç›´æ¥ä¸‹è½½æ–‡ä»¶çš„ç›®çš„ã€‚ SpringMVCçš„æ–¹å¼å…ˆè´´ä»£ç ï¼š123456789101112131415@RequestMapping("/exportXxx.action")public void exportXxx(HttpServletRequest request, HttpServletResponse response, @RequestParam(value="scheduleId", defaultValue="0")int scheduleId)&#123; HSSFWorkbook wb = createExcel(scheduleId) ; try &#123; response.setHeader("Content-Disposition", "attachment; filename=appointmentUser.xls"); response.setContentType("application/vnd.ms-excel; charset=utf-8") ; OutputStream out = response.getOutputStream() ; wb.write(out) ; out.flush(); out.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; å…¶å®springMVCå’ŒStruts2çš„åŸç†ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯Struts2æ˜¯æ‰å»é…ç½®æ–‡ä»¶çš„æ–¹å¼ã€‚é¦–å…ˆæ˜¯ä½¿ç”¨createExcel()è¿™ä¸ªæ–¹æ³•æ¥ç”ŸæˆExcelå¹¶è¿”å›ï¼Œæœ€ååˆ©ç”¨rresponseå³å¯å‘å‰å°è¾“å‡ºExcelï¼Œè¿™ç§æ–¹æ³•æ˜¯é€šç”¨çš„ï¼Œä¹Ÿå¯ä»¥è¯•ç”¨ä¸Servletã€Struts2ç­‰ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨responseçš„å¤´ä¿¡æ¯ä¸­è®¾ç½®ç›¸åº”çš„è¾“å‡ºä¿¡æ¯å³å¯ã€‚ æ€»ç»“ä¸ç®¡æ˜¯ä½¿ç”¨Struts2ï¼Œè¿˜æ˜¯ä½¿ç”¨SpringMVCç©¶å…¶æ ¹æœ¬éƒ½æ˜¯ä½¿ç”¨çš„responseï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬æŠŠresponseç†è§£é€äº†ä¸ç®¡æ˜¯ä¸‹è½½å›¾ç‰‡ã€worldã€Excelè¿˜æ˜¯å…¶ä»–ä»€ä¹ˆæ–‡ä»¶éƒ½æ˜¯ä¸€æ ·çš„ã€‚]]></content>
      <categories>
        <category>æ—¥å¸¸è®°å½•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>poi</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ—¥å¸¸è®°å½•ï¼ˆä¸€ï¼‰MySQLè¢«é”è§£å†³æ–¹æ¡ˆ]]></title>
    <url>%2F2016%2F06%2F05%2Fnormal-skill1%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ç”±äºå‰æ®µæ—¶é—´ä¸ºäº†è®©éƒ¨ç½²åœ¨Linuxä¸­çš„é¡¹ç›®è®¿é—®å¦ä¸€å°æœåŠ¡å™¨çš„MySQLï¼Œç»è¿‡å„ç§æŠ˜è…¾å°±æŠŠrootç”¨æˆ·ç»™å¼„å‡ºé—®é¢˜äº†ï¼Œå¯¼è‡´æ­»æ´»ç™»ä¸ä¸ŠPS:Linuxä¸­çš„é¡¹ç›®è¿˜æ˜¯æ²¡æœ‰è¿ä¸Šã€‚ã€‚(è¿™æ˜¯åè¯äº†ã€‚)ã€‚ç»è¿‡å„ç§æŸ¥é˜…èµ„æ–™ç»ˆäºæ‰¾åˆ°è§£å†³æ–¹æ³•äº†ã€‚ æŠ¥é”™å¦‚ä¸‹ï¼šAccess denied for user &#39;root&#39;@&#39;localhost&#39; (using password:YES) å…³é—­MySQLæœåŠ¡ï¼Œä¿®æ”¹MySQLåˆå§‹æ–‡ä»¶æ‰“å¼€MySQLç›®å½•ä¸‹çš„my-default.iniæ–‡ä»¶ï¼Œå¦‚å›¾ï¼šåœ¨æœ€åä¸€è¡ŒåŠ å…¥skip-grant-tablesä¹‹åä¿å­˜ã€‚ç„¶åé‡å¯MySQLæœåŠ¡ã€‚ ç”¨å‘½ä»¤è¡Œç™»å½•MySQLä¿®æ”¹ROOTè´¦å·å¯†ç ç”¨å‘½ä»¤è¡Œç™»å½•MySQLè¾“å…¥mysql -uroot -p,ä¸ç”¨è¾“å…¥å¯†ç ï¼Œç›´æ¥æ•²å›è½¦å³å¯è¿›å…¥ã€‚å¦‚ä¸‹å›¾ï¼šä¹‹åæ‰§è¡Œä»¥ä¸‹è¯­å¥ä¿®æ”¹ROOTç”¨æˆ·å¯†ç ï¼š use mysql; update user set password=PASSWORD(&quot;ä½ çš„å¯†ç &quot;) where user=&#39;root&#39;; è¿˜åŸmy-default.iniæ–‡ä»¶æœ€åè¿˜åŸé…ç½®æ–‡ä»¶ï¼Œä¹‹åé‡å¯MySQLæœåŠ¡å³å¯æ­£å¸¸ç™»å½•äº†ã€‚]]></content>
      <categories>
        <category>æ—¥å¸¸è®°å½•</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaå¤šçº¿ç¨‹ï¼ˆäºŒï¼‰æœ‰è¿”å›å€¼çš„å¤šçº¿ç¨‹]]></title>
    <url>%2F2016%2F05%2F27%2Fjava-thread2%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨å¤šçº¿ç¨‹è¦ä¹ˆæ˜¯ç»§æ‰¿Threadç±»ï¼Œè¦ä¹ˆæ˜¯å®ç°Runnableæ¥å£ï¼Œç„¶åé‡å†™ä¸€ä¸‹run()æ–¹æ³•å³å¯ã€‚ä½†æ˜¯åªæœ‰çš„è¯å¦‚æœæœ‰æ­»é”ã€å¯¹å…±äº«èµ„æºçš„è®¿é—®å’Œéšæ—¶ç›‘æ§çº¿ç¨‹çŠ¶æ€å°±ä¸è¡Œäº†ï¼Œäºæ˜¯åœ¨Java5ä¹‹åå°±æœ‰äº†Callableæ¥å£ã€‚ ç®€å•çš„å®ç°æœ‰è¿”å›å€¼çš„çº¿ç¨‹ä»£ç å¦‚ä¸‹ï¼šCallableFutureç±»1234567891011121314151617181920212223242526272829303132333435package top.crosssoverjie.study.Thread;import java.util.concurrent.ExecutionException;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;import java.util.concurrent.Future;public class CallableFuture &#123; public static void main(String[] args) &#123; //åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ±  ExecutorService pool = Executors.newFixedThreadPool(3) ; //åˆ›å»ºä¸‰ä¸ªæœ‰è¿”å›å€¼çš„ä»»åŠ¡ CallableTest2 c1 = new CallableTest2("çº¿ç¨‹1") ; CallableTest2 c2 = new CallableTest2("çº¿ç¨‹2") ; CallableTest2 c3 = new CallableTest2("çº¿ç¨‹3") ; Future f1 = pool.submit(c1) ; Future f2 = pool.submit(c2) ; Future f3 = pool.submit(c3) ; try &#123; System.out.println(f1.get().toString()); System.out.println(f2.get().toString()); System.out.println(f3.get().toString()); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; catch (ExecutionException e) &#123; e.printStackTrace(); &#125;finally&#123; pool.shutdown(); &#125; &#125;&#125; Â·CallableTest2Â·ç±»ï¼š123456789101112131415161718package top.crosssoverjie.study.Thread;import java.util.concurrent.Callable;public class CallableTest2 implements Callable &#123; private String name ; public CallableTest2(String name) &#123; this.name = name; &#125; @Override public Object call() throws Exception &#123; return name+"è¿”å›äº†ä¸œè¥¿"; &#125; &#125; è¿è¡Œç»“æœï¼š123çº¿ç¨‹1è¿”å›äº†ä¸œè¥¿çº¿ç¨‹2è¿”å›äº†ä¸œè¥¿çº¿ç¨‹3è¿”å›äº†ä¸œè¥¿ æ€»ç»“ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œéœ€è¦äº†è§£æ›´å¤šè¯¦æƒ…å¯ä»¥å»çœ‹é‚£å‡ ä¸ªç±»çš„APIã€‚]]></content>
      <categories>
        <category>javaå¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Callable</tag>
        <tag>ExecutorService</tag>
        <tag>Future</tag>
        <tag>Executors</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®©ç™¾åº¦å’Œgoogleæ”¶å½•æˆ‘ä»¬çš„ç½‘ç«™]]></title>
    <url>%2F2016%2F05%2F19%2Fbaidu-google%2F</url>
    <content type="text"><![CDATA[å‰è¨€èŠ±äº†å‡ å¤©æ—¶é—´ç»ˆäºæŠŠè¿™ä¸ªçœ‹ä¼¼é«˜å¤§ä¸Šçš„åšå®¢æå¥½äº†ï¼Œä½†æ˜¯å‘ç°åªèƒ½é€šè¿‡åœ¨åœ°å€æ è¾“å…¥åœ°å€è¿›è¡Œè®¿é—®ï¼Œè¿™å¾ˆæ˜æ˜¾å’Œæˆ‘è£…Xè£…åˆ°åº•çš„æ€§æ ¼ï¼Œäºæ˜¯ä¹åœ¨æŸ¥é˜…äº†å˜Ÿçˆ·çš„åšå®¢ï¼Œå’Œæˆ‘å„ç§ç™¾åº¦ç»ˆäºæå‡ºæ¥äº†ã€‚ è®©è°·æ­Œæ”¶å½•è®©è°·æ­Œæ”¶å½•è¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œé¦–å…ˆæˆ‘ä»¬è‚¯å®šæ˜¯è¦ç¿»å¢™çš„(è¿™ä¸ªå°±ä¸ä»”ç»†è¯´äº†ï¼Œå…·ä½“ç™¾åº¦ã€‚)ç”±äºæˆ‘è¿™é‡Œçªç„¶ç™»ä¸ä¸Šgoogleè´¦å·äº†ï¼Œæ‰€ä»¥ä¸‹æ¬¡è¡¥å……æˆªå›¾ã€‚åŒä½“æ¥è¯´å°±æ˜¯ä»¥ä¸‹æ­¥éª¤ï¼š ä¸‹è½½googleçš„htmléªŒè¯æ–‡ä»¶æ”¾åˆ°ç½‘ç«™çš„æ ¹ç›®å½•ï¼Œä½¿googleèƒ½å¤Ÿè®¿é—®å¾—åˆ°ã€‚ åœ¨è°·æ­Œç«™é•¿å·¥å…·é‡ŒåŠ ä¸Šè‡ªå·±çš„ç«™ç‚¹åœ°å›¾ã€‚ åˆ›å»ºç«™ç‚¹åœ°å›¾ç«™ç‚¹åœ°å›¾æ˜¯ä¸€ç§æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡è¯¥æ–‡ä»¶åˆ—å‡ºæ‚¨ç½‘ç«™ä¸Šçš„ç½‘é¡µï¼Œä»è€Œå°†æ‚¨ç½‘ç«™å†…å®¹çš„ç»„ç»‡æ¶æ„å‘ŠçŸ¥Googleå’Œå…¶ä»–æœç´¢å¼•æ“ï¼Œä»¥ä¾¿æ›´åŠ æ™ºèƒ½çš„æŠ“å–ä½ çš„ç½‘ç«™ä¿¡æ¯ã€‚é¦–å…ˆæˆ‘ä»¬è¦ä¸ºHexoå®‰è£…è°·æ­Œå’Œç™¾åº¦çš„æ’ä»¶(åšä¸»æ˜¯ç”¨Hexoæ¥æ­å»ºçš„åšå®¢)ï¼Œå¦‚ä¸‹ï¼š123npm install hexo-generator-sitemap --savenpm install hexo-generator-baidu-sitemap --save åœ¨åšå®¢çš„æ ¹ç›®å½•ä¸­çš„_config.ymlæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼šä¹‹åéƒ¨ç½²ä¸Šå»ä¹‹åå¦‚æœåœ¨åœ°å€æ åé¢åŠ ä¸Šç«™ç‚¹åœ°å›¾å¦‚ä¸‹çš„è¯è¡¨ç¤ºéƒ¨ç½²æˆåŠŸï¼š è®©ç™¾åº¦æ”¶å½•æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥è®©ç™¾åº¦æ”¶å½•æˆ‘ä»¬çš„ç½‘ç«™ã€‚ç¬¬ä¸€ç§ï¼šä¸»åŠ¨æ¨é€æˆ‘ç”¨Javaå†™äº†ä¸€ä¸ªå°ç¨‹åºï¼Œå¯ä»¥æ‰‹å·¥çš„è‡ªå·±æ¨é€åœ°å€ç»™ç™¾åº¦ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990package top.crossoverjie.post;import java.io.BufferedReader;import java.io.IOException;import java.io.InputStreamReader;import java.io.PrintWriter;import java.net.URL;import java.net.URLConnection;public class Post &#123; public static void main(String[] args) &#123; String url = "http://data.zz.baidu.com/urls?site=crossoverjie.top&amp;token=1002EzhDReuy34dq";// ç½‘ç«™çš„æœåŠ¡å™¨è¿æ¥ String[] param = &#123; // éœ€è¦æ¨é€çš„ç½‘å€// "http://crossoverjie.top/tags",// "http://crossoverjie.top/categories", //"http://crossoverjie.top/about/" "http://crossoverjie.top/2016/05/14/java-thread1" &#125;; String json = Post(url, param);// æ‰§è¡Œæ¨é€æ–¹æ³• System.out.println("ç»“æœæ˜¯" + json); // æ‰“å°æ¨é€ç»“æœ &#125; /** * ç™¾åº¦é“¾æ¥å®æ—¶æ¨é€ * * @param PostUrl * @param Parameters * @return */ public static String Post(String PostUrl, String[] Parameters) &#123; if (null == PostUrl || null == Parameters || Parameters.length == 0) &#123; return null; &#125; String result = ""; PrintWriter out = null; BufferedReader in = null; try &#123; // å»ºç«‹URLä¹‹é—´çš„è¿æ¥ URLConnection conn = new URL(PostUrl).openConnection(); // è®¾ç½®é€šç”¨çš„è¯·æ±‚å±æ€§ conn.setRequestProperty("Host", "data.zz.baidu.com"); conn.setRequestProperty("User-Agent", "curl/7.12.1"); conn.setRequestProperty("Content-Length", "83"); conn.setRequestProperty("Content-Type", "text/plain"); // å‘é€POSTè¯·æ±‚å¿…é¡»è®¾ç½®å¦‚ä¸‹ä¸¤è¡Œ conn.setDoInput(true); conn.setDoOutput(true); // è·å–connå¯¹åº”çš„è¾“å‡ºæµ out = new PrintWriter(conn.getOutputStream()); // å‘é€è¯·æ±‚å‚æ•° String param = ""; for (String s : Parameters) &#123; param += s + "\n"; &#125; out.print(param.trim()); // è¿›è¡Œè¾“å‡ºæµçš„ç¼“å†² out.flush(); // é€šè¿‡BufferedReaderè¾“å…¥æµæ¥è¯»å–Urlçš„å“åº” in = new BufferedReader( new InputStreamReader(conn.getInputStream())); String line; while ( (line = in.readLine()) != null) &#123; result += line; &#125; &#125; catch (Exception e) &#123; System.out.println("å‘é€postè¯·æ±‚å‡ºç°å¼‚å¸¸ï¼" + e); e.printStackTrace(); &#125; finally &#123; try &#123; if (out != null) &#123; out.close(); &#125; if (in != null) &#123; in.close(); &#125; &#125; catch (IOException ex) &#123; ex.printStackTrace(); &#125; &#125; return result; &#125;&#125; è¿è¡Œä¹‹åç»“æœå¦‚ä¸‹ï¼š1ç»“æœæ˜¯&#123;"remain":499,"success":1&#125; remainè¡¨ç¤ºè¿˜æœ‰å¤šå°‘å¯ä»¥æ¨é€ï¼Œæˆ‘è¿™é‡Œè¡¨ç¤ºè¿˜æœ‰499æ¡ã€‚successè¡¨ç¤ºæˆåŠŸæ¨é€äº†å¤šå°‘æ¡é“¾æ¥ï¼Œæˆ‘è¿™é‡Œè¡¨ç¤ºæˆåŠŸæ¨é€äº†ä¸€æ¡é“¾æ¥ã€‚ ç¬¬äºŒç§æ˜¯ä¸»åŠ¨æ¨é€ï¼Œå¯ä»¥æŒ‰ç…§ç™¾åº¦çš„æ•™ç¨‹è¿›è¡Œé…ç½®ï¼š ç¬¬ä¸‰ç§å°±æ˜¯é…ç½®ç«™ç‚¹åœ°å›¾äº†ï¼ŒæŒ‰ç…§ä¹‹å‰å°†çš„å°†ç«™ç‚¹åœ°å›¾å®‰è£…åˆ°é¡¹ç›®ä¸­ï¼Œå‚ç…§æˆ‘çš„é…ç½®å³å¯ï¼šå¦‚æœèƒ½åƒæˆ‘è¿™ä¸ªä¸€æ ·çŠ¶æ€æ­£å¸¸ï¼Œèƒ½è·å–åˆ°URLæ•°é‡å°±è¡¨ç¤ºæˆåŠŸäº†ã€‚ æ€»ç»“åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ä¸æ˜¯æˆ‘é»‘ç™¾åº¦ï¼Œç™¾åº¦çš„æ•ˆç‡çœŸæ˜¯å¤ªä½äº†ã€‚æˆ‘å¤´ä¸€å¤©åœ¨googleæäº¤ä¸Šå»ç¬¬äºŒå¤©å°±èƒ½æ”¶åˆ°äº†ï¼Œç™¾åº¦æ˜¯æˆ‘æäº¤äº†å¤§æ¦‚ä¸€å‘¨å¤šæ‰ç»™æˆ‘æ”¶å½•è¿›å»ï¼Œè¿™å½“ç„¶è‚¯å®šä¹Ÿå’Œæˆ‘çš„å†…å®¹æœ‰å…³ç³»ã€‚]]></content>
      <categories>
        <category>å°æŠ€å·§</category>
      </categories>
      <tags>
        <tag>baidu</tag>
        <tag>google</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaå¤šçº¿ç¨‹ï¼ˆä¸€ï¼‰å¤šçº¿ç¨‹åŸºç¡€]]></title>
    <url>%2F2016%2F05%2F14%2Fjava-thread1%2F</url>
    <content type="text"><![CDATA[å‰è¨€æœ¬æ–‡ä¸»è¦è®²è§£javaå¤šçº¿ç¨‹çš„åŸºç¡€ï¼Œä»¥åŠä¸€äº›å¸¸ç”¨æ–¹æ³•ã€‚å…³äºçº¿ç¨‹åŒæ­¥ã€ExecutorServiceæ¡†æ¶æˆ‘ä¼šæ”¾åˆ°åç»­çš„æ–‡ç« è¿›è¡Œè®²è§£ã€‚ è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«è¿›ç¨‹è¿›ç¨‹ç®€å•çš„æ¥è¯´å°±æ˜¯åœ¨å†…å­˜ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥å¯åŠ¨å¤šä¸ªçº¿ç¨‹ã€‚æ¯”å¦‚åœ¨windowsä¸­ä¸€ä¸ªè¿è¡ŒEXEæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ã€‚ çº¿ç¨‹åŒä¸€ä¸ªçº¿ç¨‹ä¸­çš„è¿›ç¨‹å…±ç”¨ç›¸åŒçš„åœ°å€ç©ºé—´ï¼ŒåŒæ—¶å…±äº«è¿›ç¨‹æ‰€æ‹¥æœ‰çš„å†…å­˜å’Œå…¶ä»–èµ„æºã€‚ çº¿ç¨‹Demo-ç»§æ‰¿Threadç±»é¦–å…ˆæˆ‘ä»¬æˆ‘ä»¬ç»§æ‰¿java.lang.Threadç±»æ¥åˆ›å»ºçº¿ç¨‹ã€‚12345678910111213141516171819202122232425262728293031package top.crosssoverjie.study.Thread;public class TestThread &#123; public static void main(String[] args) &#123; System.out.println("ä¸»çº¿ç¨‹IDæ˜¯ï¼š" + Thread.currentThread().getId()); MyThread my = new MyThread("çº¿ç¨‹1"); my.start() ; MyThread my2 = new MyThread("çº¿ç¨‹2") ; /** * è¿™é‡Œç›´æ¥è°ƒç”¨my2çš„run()æ–¹æ³•ã€‚ */ my2.run() ; &#125;&#125;class MyThread extends Thread &#123; private String name; public MyThread(String name) &#123; this.name = name; &#125; @Override public void run() &#123; System.out.println("åå­—ï¼š" + name + "çš„çº¿ç¨‹IDæ˜¯=" + Thread.currentThread().getId()); &#125;&#125; è¾“å‡ºç»“æœ:123ä¸»çº¿ç¨‹IDæ˜¯ï¼š1åå­—ï¼šçº¿ç¨‹2çš„çº¿ç¨‹IDæ˜¯=1åå­—ï¼šçº¿ç¨‹1çš„çº¿ç¨‹IDæ˜¯=9 ç”±è¾“å‡ºç»“æœæˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š myå’Œmy2çš„çº¿ç¨‹IDä¸ç›¸åŒï¼Œmy2å’Œä¸»çº¿ç¨‹IDç›¸åŒã€‚è¯´æ˜ç›´æ¥è°ƒç”¨run()æ–¹æ³•ä¸ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œè€Œæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­ç›´æ¥è°ƒç”¨çš„run()æ–¹æ³•,å’Œæ™®é€šçš„æ–¹æ³•è°ƒç”¨æ²¡æœ‰åŒºåˆ«ã€‚ è™½ç„¶myçš„start()æ–¹æ³•æ˜¯åœ¨my2çš„run()æ–¹æ³•ä¹‹å‰è°ƒç”¨ï¼Œä½†æ˜¯å´æ˜¯åè¾“å‡ºå†…å®¹ï¼Œè¯´æ˜æ–°å»ºçš„çº¿ç¨‹å¹¶ä¸ä¼šå½±å“ä¸»çº¿ç¨‹çš„æ‰§è¡Œã€‚ çº¿ç¨‹Demo-å®ç°Runnableæ¥å£é™¤äº†ç»§æ‰¿java.lang.Threadç±»ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å®ç°java.lang.Runnableæ¥å£æ¥åˆ›å»ºçº¿ç¨‹ã€‚12345678910111213141516171819202122232425262728293031package top.crosssoverjie.study.Thread;public class TestRunnable &#123; public static void main(String[] args) &#123; System.out.println("ä¸»çº¿ç¨‹çš„çº¿ç¨‹IDæ˜¯"+Thread.currentThread().getId()); MyThread2 my = new MyThread2("çº¿ç¨‹1") ; Thread t = new Thread(my) ; t.start() ; MyThread2 my2 = new MyThread2("çº¿ç¨‹2") ; Thread t2 = new Thread(my2) ; /** * æ–¹æ³•è°ƒç”¨ï¼Œå¹¶ä¸ä¼šåˆ›å»ºçº¿ç¨‹ï¼Œä¾ç„¶æ˜¯ä¸»çº¿ç¨‹ */ t2.run() ; &#125;&#125;class MyThread2 implements Runnable&#123; private String name ; public MyThread2(String name)&#123; this.name = name ; &#125; @Override public void run() &#123; System.out.println("çº¿ç¨‹"+name+"çš„çº¿ç¨‹IDæ˜¯"+Thread.currentThread().getId()); &#125; &#125; è¾“å‡ºç»“æœ:123ä¸»çº¿ç¨‹çš„çº¿ç¨‹IDæ˜¯1çº¿ç¨‹çº¿ç¨‹2çš„çº¿ç¨‹IDæ˜¯1çº¿ç¨‹çº¿ç¨‹1çš„çº¿ç¨‹IDæ˜¯9 notes: å®ç°Runnableçš„æ–¹å¼éœ€è¦å°†å®ç°Runnableæ¥å£çš„ç±»ä½œä¸ºå‚æ•°ä¼ é€’ç»™Threadï¼Œç„¶åé€šè¿‡Threadç±»è°ƒç”¨Start()æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹ã€‚ è¿™ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥æ¥åˆ›å»ºçº¿ç¨‹ï¼Œè‡³äºé€‰æ‹©å“ªä¸€ç§è¦çœ‹è‡ªå·±çš„éœ€æ±‚ã€‚ç›´æ¥ç»§æ‰¿Threadç±»çš„è¯ä»£ç è¦ç®€æ´ä¸€äº›ï¼Œä½†æ˜¯ç”±äºjavaåªæ”¯æŒå•ç»§æ‰¿ï¼Œæ‰€ä»¥å¦‚æœè¦ç»§æ‰¿å…¶ä»–ç±»çš„åŒæ—¶éœ€è¦å®ç°çº¿ç¨‹é‚£å°±åªèƒ½å®ç°Runnableæ¥å£äº†ï¼Œè¿™é‡Œæ›´æ¨èå®ç°Runnableæ¥å£ã€‚ å®é™…ä¸Šå¦‚æœæˆ‘ä»¬æŸ¥çœ‹Threadç±»çš„æºç æˆ‘ä»¬ä¼šå‘ç°Threadæ˜¯å®ç°äº†Runnableæ¥å£çš„ï¼š çº¿ç¨‹ä¸­å¸¸ç”¨çš„æ–¹æ³• åºå· æ–¹æ³• ä»‹ç» 1 public void start() ä½¿è¯¥çº¿ç¨‹æ‰§è¡Œï¼Œjavaè™šæ‹Ÿæœºä¼šè°ƒç”¨è¯¥çº¿ç¨‹çš„run()æ–¹æ³•ã€‚ 2 public final void setName(String name) ä¿®æ”¹çº¿ç¨‹åç§°ã€‚ 3 public final void setPriority(int privority) ä¿®æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚ 4 public final void setDaemon(false on) å°†è¯¥çº¿ç¨‹æ ‡è®°ä¸ºå®ˆæŠ¤çº¿ç¨‹æˆ–ç”¨æˆ·çº¿ç¨‹ï¼Œå½“æ­£åœ¨è¿è¡Œçº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹æ—¶ï¼Œjavaè™šæ‹Ÿæœºé€€å‡ºï¼Œè¯¥æ–¹æ³•å¿…é¡»åœ¨å¯åŠ¨çº¿ç¨‹å‰è°ƒç”¨ã€‚ 5 public final void join(long mills) ç­‰å¾…è¯¥çº¿ç¨‹çš„ç»ˆæ­¢æ—¶é—´æœ€é•¿ä¸ºmillsæ¯«ç§’ã€‚ 6 public void interrupt() ä¸­æ–­çº¿ç¨‹ã€‚ 7 public static boolean isAlive() æµ‹è¯•çº¿ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚å¦‚æœè¯¥çº¿ç¨‹å·²ç»å¯åŠ¨å°šæœªç»ˆæ­¢ï¼Œåˆ™ä¸ºæ´»åŠ¨çŠ¶æ€ã€‚ 8 public static void yield() æš‚åœå½“å‰çº¿ç¨‹æ‰§è¡Œçš„å¯¹è±¡ï¼Œå¹¶æ‰§è¡Œå…¶ä»–çº¿ç¨‹ã€‚ 9 public static void sleep(long mills) åœ¨æŒ‡å®šæ¯«ç§’æ•°å†…ï¼Œè®©å½“å‰æ‰§è¡Œçš„çº¿ç¨‹ä¼‘çœ (æš‚åœ)ã€‚ 10 public static Thread currentThread() è¿”å›å½“å‰çº¿ç¨‹çš„å¼•ç”¨ã€‚ æ–¹æ³•è¯¦è§£- public static void sleep(long mills)1234567891011121314151617181920212223242526272829303132333435package top.crosssoverjie.study.Thread;public class TestSleep &#123; private int i = 10 ; private Object ob = new Object() ; public static void main(String[] args) &#123; TestSleep t = new TestSleep() ; MyThread3 thread1 = t.new MyThread3() ; MyThread3 thread2 = t.new MyThread3() ; thread1.start() ; thread2.start() ; &#125; class MyThread3 extends Thread&#123; @Override public void run() &#123; synchronized (ob) &#123; i++ ; System.out.println("içš„å€¼ï¼š"+i); System.out.println("çº¿ç¨‹ï¼š"+Thread.currentThread().getName()+"è¿›å…¥ä¼‘çœ çŠ¶æ€"); try &#123; Thread.currentThread().sleep(1000) ; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; System.out.println("çº¿ç¨‹ï¼š"+Thread.currentThread().getName()+"ä¼‘çœ ç»“æŸ"); i++; System.out.println("içš„å€¼&gt;ï¼š"+i); &#125; &#125; &#125; &#125; è¾“å‡ºç»“æœï¼š12345678içš„å€¼ï¼š11çº¿ç¨‹ï¼šThread-0è¿›å…¥ä¼‘çœ çŠ¶æ€çº¿ç¨‹ï¼šThread-0ä¼‘çœ ç»“æŸiçš„å€¼&gt;ï¼š12içš„å€¼ï¼š13çº¿ç¨‹ï¼šThread-1è¿›å…¥ä¼‘çœ çŠ¶æ€çº¿ç¨‹ï¼šThread-1ä¼‘çœ ç»“æŸiçš„å€¼&gt;ï¼š14 ç”±è¾“å‡ºç»“æœæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼š å½“Thread0è¿›å…¥ä¼‘çœ çŠ¶æ€æ—¶ï¼ŒThread1å¹¶æ²¡æœ‰ç»§ç»­æ‰§è¡Œï¼Œè€Œæ˜¯ç­‰å¾…Thread0ä¼‘çœ ç»“æŸé‡Šæ”¾äº†å¯¹è±¡é”ï¼ŒThread1æ‰ç»§ç»­æ‰§è¡Œã€‚å½“è°ƒç”¨sleep()æ–¹æ³•æ—¶ï¼Œå¿…é¡»æ•è·å¼‚å¸¸æˆ–è€…å‘ä¸Šå±‚æŠ›å‡ºå¼‚å¸¸ã€‚å½“çº¿ç¨‹ä¼‘çœ æ—¶é—´æ»¡æ—¶ï¼Œå¹¶ä¸ä¸€å®šä¼šé©¬ä¸Šæ‰§è¡Œï¼Œå› ä¸ºæ­¤æ—¶æœ‰å¯èƒ½CPUæ­£åœ¨æ‰§è¡Œå…¶ä»–çš„ä»»åŠ¡ï¼Œæ‰€ä»¥è°ƒç”¨äº†sleep()æ–¹æ³•ç›¸å½“äºçº¿ç¨‹è¿›å…¥äº†é˜»å¡çŠ¶æ€ã€‚ æ–¹æ³•è¯¦è§£- public static void yield()123456789101112131415161718192021package top.crosssoverjie.study.Thread;public class Testyield &#123; public static void main(String[] args) &#123; MyThread4 my = new MyThread4() ; my.start() ; &#125;&#125;class MyThread4 extends Thread&#123; @Override public void run() &#123; long open = System.currentTimeMillis(); int count= 0 ; for(int i=0 ;i&lt;1000000;i++)&#123; count= count+(i+1);// Thread.yield() ; &#125; long end = System.currentTimeMillis(); System.out.println("ç”¨æ—¶ï¼š"+(end-open)+"æ¯«ç§’"); &#125;&#125; è¾“å‡ºç»“æœ:ç”¨æ—¶ï¼š1æ¯«ç§’å¦‚æœå°† Thread.yield()æ³¨é‡Šå–æ¶ˆæ‰ï¼Œè¾“å‡ºç»“æœ:ç”¨æ—¶ï¼š116æ¯«ç§’ è°ƒç”¨yield()æ–¹æ³•æ˜¯ä¸ºäº†è®©å½“å‰çº¿ç¨‹äº¤å‡ºCPUæƒé™ï¼Œè®©CPUå»æ‰§è¡Œå…¶ä»–çº¿ç¨‹ã€‚å®ƒå’Œsleep()æ–¹æ³•ç±»ä¼¼åŒæ ·æ˜¯ä¸ä¼šé‡Šæ”¾é”ã€‚ä½†æ˜¯yield()ä¸èƒ½æ§åˆ¶å…·ä½“çš„äº¤å‡ºCUPçš„æ—¶é—´ã€‚å¹¶ä¸”å®ƒåªèƒ½è®©ç›¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹è·å¾—CPUæ‰§è¡Œæ—¶é—´çš„æœºä¼šã€‚ è°ƒç”¨yield()æ–¹æ³•ä¸ä¼šè®©çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œå®ƒåªéœ€è¦ç­‰å¾…é‡æ–°è·å–CPUçš„æ—¶é—´ï¼Œè¿™ä¸€ç‚¹å’Œsleep()æ–¹æ³•æ˜¯ä¸ä¸€æ ·çš„ã€‚ æ–¹æ³•è¯¦è§£- public final void join()åœ¨å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œå¤§é‡çš„è€—æ—¶ä»»åŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸»çº¿ç¨‹åˆå¿…é¡»å¾—ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰èƒ½ç»“æŸï¼Œè¿™å°±éœ€è¦ç”¨åˆ° join()æ–¹æ³•äº†ã€‚join()æ–¹æ³•çš„ä½œç”¨æ˜¯ç­‰å¾…çº¿ç¨‹å¯¹è±¡é”€æ¯ï¼Œå¦‚æœå­çº¿ç¨‹æ‰§è¡Œäº†è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆä¸»çº¿ç¨‹å°±è¦ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰ä¼šé”€æ¯ï¼Œè¯·çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š123456789101112131415161718192021222324252627package top.crosssoverjie.study.Thread;public class Testjoin &#123; public static void main(String[] args) throws InterruptedException &#123; new MyThread5("t1").start() ; for (int i = 0; i &lt; 10; i++) &#123; if(i == 5)&#123; MyThread5 my =new MyThread5("t2") ; my.start() ; my.join() ; &#125; System.out.println("mainå½“å‰çº¿ç¨‹ï¼š"+Thread.currentThread().getName()+" "+i); &#125; &#125;&#125;class MyThread5 extends Thread&#123; public MyThread5(String name)&#123; super(name) ; &#125; @Override public void run() &#123; for (int i = 0; i &lt; 5; i++) &#123; System.out.println("å½“å‰çº¿ç¨‹ï¼š"+Thread.currentThread().getName()+" "+i); &#125; &#125;&#125; è¾“å‡ºç»“æœï¼š1234567891011121314151617181920mainå½“å‰çº¿ç¨‹ï¼šmain 0å½“å‰çº¿ç¨‹ï¼št1 0å½“å‰çº¿ç¨‹ï¼št1 1mainå½“å‰çº¿ç¨‹ï¼šmain 1å½“å‰çº¿ç¨‹ï¼št1 2mainå½“å‰çº¿ç¨‹ï¼šmain 2å½“å‰çº¿ç¨‹ï¼št1 3mainå½“å‰çº¿ç¨‹ï¼šmain 3å½“å‰çº¿ç¨‹ï¼št1 4mainå½“å‰çº¿ç¨‹ï¼šmain 4å½“å‰çº¿ç¨‹ï¼št2 0å½“å‰çº¿ç¨‹ï¼št2 1å½“å‰çº¿ç¨‹ï¼št2 2å½“å‰çº¿ç¨‹ï¼št2 3å½“å‰çº¿ç¨‹ï¼št2 4mainå½“å‰çº¿ç¨‹ï¼šmain 5mainå½“å‰çº¿ç¨‹ï¼šmain 6mainå½“å‰çº¿ç¨‹ï¼šmain 7mainå½“å‰çº¿ç¨‹ï¼šmain 8mainå½“å‰çº¿ç¨‹ï¼šmain 9 å¦‚æœæˆ‘ä»¬æŠŠjoin()æ–¹æ³•æ³¨é‡Šæ‰ä¹‹åï¼š1234567891011121314151617181920mainå½“å‰çº¿ç¨‹ï¼šmain 0å½“å‰çº¿ç¨‹ï¼št1 0mainå½“å‰çº¿ç¨‹ï¼šmain 1å½“å‰çº¿ç¨‹ï¼št1 1mainå½“å‰çº¿ç¨‹ï¼šmain 2å½“å‰çº¿ç¨‹ï¼št1 2mainå½“å‰çº¿ç¨‹ï¼šmain 3å½“å‰çº¿ç¨‹ï¼št1 3mainå½“å‰çº¿ç¨‹ï¼šmain 4å½“å‰çº¿ç¨‹ï¼št1 4mainå½“å‰çº¿ç¨‹ï¼šmain 5mainå½“å‰çº¿ç¨‹ï¼šmain 6mainå½“å‰çº¿ç¨‹ï¼šmain 7mainå½“å‰çº¿ç¨‹ï¼šmain 8mainå½“å‰çº¿ç¨‹ï¼šmain 9å½“å‰çº¿ç¨‹ï¼št2 0å½“å‰çº¿ç¨‹ï¼št2 1å½“å‰çº¿ç¨‹ï¼št2 2å½“å‰çº¿ç¨‹ï¼št2 3å½“å‰çº¿ç¨‹ï¼št2 4 ç”±ä¸Šæˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š åœ¨ä½¿ç”¨äº†join()æ–¹æ³•ä¹‹åä¸»çº¿ç¨‹ä¼šç­‰å¾…å­çº¿ç¨‹ç»“æŸä¹‹åæ‰ä¼šç»“æŸã€‚ æ–¹æ³•è¯¦è§£- setDaemon(boolean on),getDaemon()ç”¨æ¥è®¾ç½®æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹å’Œåˆ¤æ–­æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚notesï¼š å®ˆæŠ¤çº¿ç¨‹ä¾èµ–äºåˆ›å»ºä»–çš„çº¿ç¨‹ï¼Œè€Œç”¨æˆ·çº¿ç¨‹åˆ™ä¸éœ€è¦ã€‚å¦‚æœåœ¨main()æ–¹æ³•ä¸­åˆ›å»ºäº†ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œé‚£ä¹ˆå½“mainæ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åå®ˆæŠ¤çº¿ç¨‹ä¹Ÿä¼šå…³é—­ã€‚è€Œç”¨æˆ·çº¿ç¨‹åˆ™ä¸ä¼šï¼Œåœ¨JVMä¸­åƒåœ¾æ”¶é›†å™¨çš„çº¿ç¨‹å°±æ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚ ä¼˜é›…çš„ç»ˆæ­¢çº¿ç¨‹æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥ç»ˆæ­¢çº¿ç¨‹ï¼Œå¦‚ä¸‹ï¼š ä½¿ç”¨é€€å‡ºæ ‡è¯†ï¼Œä½¿çº¿ç¨‹æ­£å¸¸çš„é€€å‡ºï¼Œä¹Ÿå°±æ˜¯å½“run()æ–¹æ³•å®Œæˆåçº¿ç¨‹ç»ˆæ­¢ã€‚ ä½¿ç”¨stop()æ–¹æ³•å¼ºè¡Œå…³é—­ï¼Œè¿™ä¸ªæ–¹æ³•ç°åœ¨å·²ç»è¢«åºŸå¼ƒï¼Œä¸æ¨èä½¿ç”¨ ä½¿ç”¨interrupt()æ–¹æ³•ç»ˆæ­¢çº¿ç¨‹ã€‚ å…·ä½“çš„å®ç°ä»£ç æˆ‘å°†åœ¨ä¸‹ä¸€ç¯‡åšæ–‡ä¸­å°†åˆ°ã€‚ã€‚ çº¿ç¨‹çš„ä¼˜å…ˆçº§åœ¨æ“ä½œç³»ç»Ÿä¸­çº¿ç¨‹æ˜¯åˆ†ä¼˜å…ˆçº§çš„ï¼Œä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹CPUå°†ä¼šæä¾›æ›´å¤šçš„èµ„æºï¼Œåœ¨javaä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡setPriority(int newPriority)æ–¹æ³•æ¥æ›´æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚åœ¨javaä¸­åˆ†ä¸º1~10è¿™ä¸ªåä¸ªä¼˜å…ˆçº§ï¼Œè®¾ç½®ä¸åœ¨è¿™ä¸ªèŒƒå›´å†…çš„ä¼˜å…ˆçº§å°†ä¼šæŠ›å‡ºIllegalArgumentExceptionå¼‚å¸¸ã€‚javaä¸­æœ‰ä¸‰ä¸ªé¢„è®¾å¥½çš„ä¼˜å…ˆçº§ï¼š public final static int MIN_PRIORITY = 1; public final static int NORM_PRIORITY = 5; public final static int MAX_PRIORITY = 10; å‚è€ƒ å¦‚ä½•ç»ˆæ­¢çº¿ç¨‹ javaå¤šçº¿ç¨‹å­¦ä¹  javaå¤šçº¿ç¨‹æ€ç»´å›¾ æ€»ç»“ä»¥ä¸Šå°±æ˜¯æˆ‘æ€»ç»“çš„javaå¤šçº¿ç¨‹åŸºç¡€çŸ¥è¯†ï¼Œåç»­ä¼šè¡¥å……çº¿ç¨‹å…³é—­ã€çº¿ç¨‹çŠ¶æ€ã€çº¿ç¨‹åŒæ­¥å’Œæœ‰è¿”å›ç»“æœçš„å¤šçº¿ç¨‹ã€‚]]></content>
      <categories>
        <category>javaå¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Thread</tag>
        <tag>Runnable</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaç¬”è®°ï¼ˆä¸€ï¼‰Javaçš„åå°„æœºåˆ¶]]></title>
    <url>%2F2016%2F05%2F10%2Fjava-reflect%2F</url>
    <content type="text"><![CDATA[å‰è¨€javaåå°„æœºåˆ¶æŒ‡çš„æ˜¯åœ¨javaè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯¹äºä»»æ„çš„ç±»éƒ½å¯ä»¥çŸ¥é“ä»–çš„æ‰€æœ‰å±æ€§ä»¥åŠæ–¹æ³•ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä»»æ„çš„è°ƒç”¨ä»–çš„å±æ€§å’Œæ–¹æ³•ï¼Œè¿™ç§åŠ¨æ€è·å–å¯¹è±¡ä¿¡æ¯å’ŒåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸ºjavaåå°„æœºåˆ¶ï¼Œä½†æ˜¯åå°„ä½¿ç”¨ä¸å½“ä¼šé€ æˆå¾ˆé«˜çš„æˆæœ¬ã€‚ ç®€å•å®ä¾‹ åå°„è·å–ç±»åç§°123456789101112131415161718package top.crosssoverjie.study;public class Reflect &#123; public static void main(String[] args) &#123; Class&lt;Reflect&gt; c1 = Reflect.class; System.out.println(c1.getName()); Reflect r1 = new Reflect() ; Class&lt;Reflect&gt; c2 = (Class&lt;Reflect&gt;) r1.getClass() ; System.out.println(c2.getName()); try &#123; Class&lt;Reflect&gt; c3 = (Class&lt;Reflect&gt;) Class.forName("top.crosssoverjie.study.Reflect"); System.out.println(c3.getName()); &#125; catch (ClassNotFoundException e) &#123; e.printStackTrace(); &#125; &#125;&#125; è¾“å‡ºç»“æœï¼š 123top.crosssoverjie.study.Reflecttop.crosssoverjie.study.Reflecttop.crosssoverjie.study.Reflect ä»¥ä¸Šçš„ c1,c2,c3æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œä»–ä»¬éƒ½æœ‰ä¸€ä¸ªç»Ÿä¸€çš„åç§°ï¼šå«åšReflectç±»çš„ç±»ç±»å‹ã€‚ åå°„çš„ç”¨å¤„è·å–æˆå‘˜æ–¹æ³•12public Method getDeclaredMethod(String name,Class&lt;?&gt;...parameterTypes)//å¾—åˆ°è¯¥ç±»çš„æ‰€æœ‰æ–¹æ³•ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬çˆ¶ç±»çš„æ–¹æ³•ã€‚public Method getMethod(String name,Class&lt;?&gt;...parameterTypes)//è·å¾—è¯¥ç±»çš„æ‰€æœ‰publicæ–¹æ³•ï¼ŒåŒ…æ‹¬çˆ¶ç±»çš„ã€‚ é€šè¿‡åå°„è·å–æˆå‘˜æ–¹æ³•è°ƒç”¨çš„å®ä¾‹:1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465package top.crosssoverjie.study;import java.lang.reflect.Method;public class Person &#123; private String name="crossover" ; private String msg ; public Person(String name, String msg) &#123; this.name = name; this.msg = msg; System.out.println(name+"çš„æè¿°æ˜¯"+msg); &#125; public Person() &#123; super(); &#125; public void say(String name ,String msg)&#123; System.out.println(name+"è¯´ï¼š"+msg); &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public String getMsg() &#123; return msg; &#125; public void setMsg(String msg) &#123; this.msg = msg; &#125; public static void main(String[] args) &#123; try &#123; //é¦–å…ˆè·å–ç±»ç±»å‹ Class c1 = Class.forName("top.crosssoverjie.study.Person") ; //é€šè¿‡newInstance()æ–¹æ³•ç”Ÿæˆä¸€ä¸ªå®ä¾‹ Object o1 = c1.newInstance() ; //è·å–è¯¥ç±»çš„sayæ–¹æ³• Method m1 = c1.getMethod("say", String.class,String.class) ; //é€šè¿‡invokeæ–¹æ³•è°ƒç”¨è¯¥æ–¹æ³•// m1.invoke(o1, "å¼ ä¸‰","ä½ å¥½å•Š") ; Method[] methods = c1.getDeclaredMethods() ;// for(Method m : methods)&#123;// System.out.println(m.getName());// &#125; Method[] methods2 = c1.getMethods() ; for (Method method : methods2) &#123; System.out.println(method.getName()); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; è¾“å‡ºç»“æœï¼š1å¼ ä¸‰è¯´ï¼šä½ å¥½å•Š æ‰€ä»¥æˆ‘ä»¬åªè¦çŸ¥é“ç±»çš„å…¨é™å®šåå°±å¯ä»¥ä»»æ„çš„è°ƒç”¨é‡Œé¢çš„æ–¹æ³•ã€‚ 1234Method[] methods = c1.getDeclaredMethods() ;for(Method m : methods)&#123; System.out.println(m.getName());&#125; è¾“å‡ºç»“æœï¼š123456maingetNamesetNamesaygetMsgsetMsg ä½¿ç”¨çš„è¿˜æ˜¯ä¹‹å‰é‚£ä¸ªPersonç±»ï¼Œæ‰€ä»¥è¿™é‡Œåªå†™äº†å…³é”®ä»£ç ã€‚è¿™é‡Œè¾“å‡ºçš„æ˜¯Personçš„æ‰€æœ‰publicæ–¹æ³•ã€‚ å¦‚æœæˆ‘ä»¬è°ƒç”¨getMethods()æ–¹æ³•ä¼šæ˜¯ä»€ä¹ˆç»“æœå‘¢ï¼Ÿ1234Method[] methods2 = c1.getMethods() ;for (Method method : methods2) &#123; System.out.println(method.getName());&#125; è¾“å‡ºç»“æœ:123456789101112131415maingetNamesetNamesaygetMsgsetMsgwaitwaitwaithashCodegetClassequalstoStringnotifynotifyAll è¿™æ—¶æˆ‘ä»¬ä¼šå‘ç°è¿™é‡Œè¾“å‡ºçš„ç»“æœä¼šæ¯”åˆšæ‰å¤šå¾—å¤šï¼Œè¿™æ—¶å› ä¸ºgetMethods()æ–¹æ³•è¿”å›çš„æ˜¯åŒ…æ‹¬çˆ¶ç±»çš„æ‰€æœ‰æ–¹æ³•ã€‚ è·å–æˆå‘˜å˜é‡æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡åå°„æ¥è·å–ç±»åŒ…æ‹¬çˆ¶ç±»çš„æˆå‘˜å˜é‡ï¼Œä¸»è¦æ–¹æ³•å¦‚ä¸‹ï¼š12public Field getDeclaredFiled(String name)//è·å¾—è¯¥ç±»æ‰€æœ‰çš„æˆå‘˜å˜é‡ï¼Œä½†ä¸åŒ…æ‹¬çˆ¶ç±»çš„ã€‚public Filed getFiled(String name)//è·å¾—è¯¥ç±»çš„æ‰€æœ‰çš„publicå˜é‡ï¼ŒåŒ…æ‹¬å…¶çˆ¶ç±»çš„ã€‚ è¿˜æ˜¯æŒ‰ç…§ä¹‹å‰ä¾‹å­ä¸­çš„Personç±»ä¸¾ä¾‹ï¼Œä»–å…·æœ‰ä¸¤ä¸ªæˆå‘˜å˜é‡ï¼š12private String name="crossover" ;private String msg ; æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ¥è·å–å…¶ä¸­çš„æˆå‘˜å˜é‡ï¼š12Class c1 = Class.forName("top.crosssoverjie.study.Person") ;Field field = c1.getDeclaredField("name");//è·å–è¯¥ç±»æ‰€æœ‰çš„æˆå‘˜å±æ€§ é€šè¿‡ä»¥ä¸‹ä¾‹å­å¯ä»¥è·å–æŒ‡å®šå¯¹è±¡ä¸Šæ­¤fieldçš„å€¼ï¼š123456789101112131415161718192021222324252627282930313233343536package top.crosssoverjie.study;import java.io.File;import java.lang.reflect.Field;public class Reflect &#123; public static void main(String[] args) &#123; try &#123; Class c1 = Class.forName("top.crosssoverjie.study.Person"); Field field = c1.getDeclaredField("name") ; Object o1 = c1.newInstance() ; /** * ç”±äºPersonç±»ä¸­çš„nameå˜é‡æ˜¯privateä¿®é¥°çš„ï¼Œ * æ‰€ä»¥éœ€è¦æ‰‹åŠ¨å¼€å¯å…è®¸è®¿é—®ï¼Œæ˜¯publicä¿®é¥°çš„å°±ä¸éœ€è¦è®¾ç½®äº† */ field.setAccessible(true); Object name = field.get(o1) ; System.out.println(name); &#125; catch (Exception e) &#123; e.printStackTrace() ; &#125;// Class&lt;Reflect&gt; c1 = Reflect.class;// System.out.println(c1.getName());// // Reflect r1 = new Reflect() ;// Class&lt;Reflect&gt; c2 = (Class&lt;Reflect&gt;) r1.getClass() ;// System.out.println(c2.getName());// // try &#123;// Class&lt;Reflect&gt; c3 = (Class&lt;Reflect&gt;) Class.forName("top.crosssoverjie.study.Reflect");// System.out.println(c3.getName());// &#125; catch (ClassNotFoundException e) &#123;// e.printStackTrace();// &#125; &#125;&#125; è¾“å‡ºç»“æœï¼š1crossover æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ–¹æ³•getDeclaredFieds()æ–¹æ³•æ¥è·å–æ‰€æœ‰çš„æˆå‘˜å˜é‡ï¼Œè¿”å›æ˜¯æ˜¯ä¸€ä¸ªField[]æ•°ç»„ï¼Œåªéœ€è¦éå†è¿™ä¸ªæ•°ç»„å³å¯è·æ‰€æœ‰çš„æˆå‘˜å˜é‡ã€‚ä¾‹å­å¦‚ä¸‹ï¼š 1234Field[] fields = c1.getDeclaredFields() ;for(Field f :fields)&#123; System.out.println(f.getName());&#125; è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š12namemsg è·å–æ„é€ æ–¹æ³•å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•æ¥è·å–æ„é€ æ–¹æ³•ï¼š12public Constructor getDeclaredConstructor(Class&lt;?&gt;...parameterTypes)//è·å–è¯¥ç±»çš„æ‰€æœ‰æ„é€ æ–¹æ³•ï¼Œä¸åŒ…æ‹¬çˆ¶ç±»çš„ã€‚public Constructor getConstructor(Class&lt;?&gt;...parameterTypes)//è·å–è¯¥ç±»çš„æ‰€æœ‰publicä¿®é¥°çš„æ„é€ æ–¹æ³•ï¼ŒåŒ…æ‹¬çˆ¶ç±»çš„ã€‚ åœ¨ä¹‹å‰çš„Personç±»ä¸­æœ‰ä»¥ä¸‹çš„æ„é€ æ–¹æ³•ï¼š1234public Person(String name, String msg) &#123; this.name = name; this.msg = msg;&#125; æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ¥è·å–Personç±»çš„æ„é€ æ–¹æ³•ï¼š1Constructor dc1 = c1.getDeclaredConstructor(String.class,String.class) ; å…·ä½“ä»£ç å¦‚ä¸‹ï¼š123Constructor dc1 = c1.getDeclaredConstructor(String.class,String.class) ;dc1.setAccessible(true);dc1.newInstance("å°æ˜","å¾ˆå¸…") ; dc1.newInstance(&quot;å°æ˜&quot;,&quot;å¾ˆå¸…&quot;);æ–¹æ³•è°ƒç”¨äº†Personç±»ä¸­çš„ï¼š12345public Person(String name, String msg) &#123; this.name = name; this.msg = msg; System.out.println(name+"çš„æè¿°æ˜¯"+msg);&#125; è¿™ä¸ªæ„é€ æ–¹æ³•ï¼Œå¦‚æœä¸ä¼ å‚æ•°çš„è¯ï¼Œé‚£ä¹ˆè°ƒç”¨çš„å°±æ˜¯æ— å‚çš„æ„é€ æ–¹æ³•ã€‚è¾“å‡ºç»“æœä¸º:1å°æ˜çš„æè¿°æ˜¯å¾ˆå¸… é€šè¿‡åå°„äº†è§£é›†åˆæ³›å‹çš„æœ¬è´¨é€šè¿‡ä»¥ä¸‹ä¾‹å­ç¨‹åºå¯ä»¥çœ‹å‡ºï¼š1234567891011121314151617181920212223242526272829303132333435363738394041package top.crosssoverjie.study;import java.lang.reflect.Method;import java.util.ArrayList;import java.util.List;public class GenericEssence &#123; public static void main(String[] args) &#123; //å£°æ˜ä¸¤ä¸ªlistï¼Œä¸€ä¸ªæœ‰æ³›å‹ï¼Œä¸€ä¸ªæ²¡æœ‰æ³›å‹ List list1 = new ArrayList() ; List&lt;String&gt; list2 = new ArrayList&lt;String&gt;() ; list2.add("ä½ å¥½") ;// list2.add(11) ;åŠ ä¸Šæ³›å‹ä¹‹ååœ¨ç¼–è¯‘æœŸé—´åªèƒ½æ·»åŠ Stringï¼Œä¸ç„¶ä¼šæŠ¥é”™ã€‚ System.out.println("list2çš„é•¿åº¦æ˜¯ï¼š"+list2.size()); Class c1 = list1.getClass(); Class c2 = list2.getClass() ; System.out.print("c1,c2æ˜¯å¦ç›¸ç­‰:"); System.out.println(c1==c2); try &#123; //é€šè¿‡åå°„ç»•è¿‡ç¼–è¯‘å™¨åŠ¨æ€è°ƒç”¨addæ–¹æ³•ï¼Œå¯èƒ½å¦åŠ å…¥éStringç±»å‹çš„å…ƒç´  Method method = c2.getDeclaredMethod("add", Object.class) ; method.invoke(list2, 123) ;//åœ¨è¿™é‡ŒåŠ å…¥intç±»å‹ï¼Œåœ¨ä¸Šé¢å¦‚æœåŠ å…¥intä¼šå‡ºç°ç¼–è¯‘æŠ¥é”™ã€‚ //list2çš„é•¿åº¦å¢åŠ äº†ï¼Œè¯´æ˜æ·»åŠ æˆåŠŸäº† System.out.println("ç°åœ¨list2çš„é•¿åº¦æ˜¯:"+list2.size()); /** * æ‰€ä»¥å¯ä»¥çœ‹å‡ºï¼Œæ³›å‹åªæ˜¯åœ¨ç¼–è¯‘æœŸé—´èµ·ä½œç”¨ï¼Œåœ¨ç»è¿‡ç¼–è¯‘è¿›å…¥è¿è¡ŒæœŸé—´æ˜¯ä¸èµ·ä½œç”¨çš„ã€‚ * å°±ç®—æ˜¯ä¸æ˜¯æ³›å‹è¦æ±‚çš„ç±»å‹ä¹Ÿæ˜¯å¯ä»¥æ’å…¥çš„ã€‚ */ &#125; catch (Exception e) &#123; e.printStackTrace() ; &#125; &#125;&#125; æ‰€ä»¥å¯ä»¥çœ‹å‡ºï¼Œæ³›å‹åªæ˜¯åœ¨ç¼–è¯‘æœŸé—´èµ·ä½œç”¨ï¼Œåœ¨ç»è¿‡ç¼–è¯‘è¿›å…¥è¿è¡ŒæœŸé—´æ˜¯ä¸èµ·ä½œç”¨çš„ã€‚å°±ç®—æ˜¯ä¸æ˜¯æ³›å‹è¦æ±‚çš„ç±»å‹ä¹Ÿæ˜¯å¯ä»¥æ’å…¥çš„ã€‚ åå°„çŸ¥è¯†ç‚¹ æ€»ç»“ æ³›å‹çš„åº”ç”¨æ¯”è¾ƒå¤šï¼š springçš„IOC/DIã€‚ JDBCä¸­çš„ä¸­çš„åŠ è½½é©±åŠ¨ å‚è€ƒ javaä¸­çš„åå°„æœºåˆ¶ åå°„æœºåˆ¶æ˜¯ä»€ä¹ˆ]]></content>
      <categories>
        <category>Javaç¬”è®°</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Reflect</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç¬¬ä¸€æ¬¡æ€»ç»“]]></title>
    <url>%2F2016%2F05%2F07%2F%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æ˜¨å¤©åˆ°ä»Šå¤©ä¸€å…±èŠ±äº†å·®ä¸å¤šä¸¤å¤©çš„æ—¶é—´ç»ˆäºæŠŠåšå®¢æ­å¥½äº†ã€‚è¿˜ä¹°äº†ä¸€ä¸ªåŸŸåï¼Œç°åœ¨å°±è¿«ä¸åŠå¾…çš„æƒ³æŠŠè¿™æ®µå†…å®¹å†™ä¸‹æ¥ã€‚ æ„Ÿè°¢ é¦–å…ˆéå¸¸æ„Ÿè°¢ å˜Ÿçˆ·çš„å¸®å¿™ï¼Œæ²¡æœ‰è¿™äº›èµ„æ–™æˆ‘å¯èƒ½è¿˜å¾—è‡ªå·±ç ”ç©¶å¥½ä¸€æ®µæ—¶é—´ã€‚ è¿‡ç¨‹ æˆ‘æ˜¯å‰å¤©æ— æ„é—´åœ¨å¾®åšä¸Šçœ‹åˆ°å˜Ÿçˆ·çš„ä¸€ç¯‡åšæ–‡ï¼Œå°±ä»”ç»†çœ‹äº†ä¸‹ï¼Œå‘ç°å†™çš„éå¸¸å¥½ï¼Œç„¶åå°±å°†ä»–æ‰€æœ‰çš„åšæ–‡å¤§è‡´çš„æµè§ˆäº†ä¸€ä¸‹ã€‚ æˆ‘å¾ˆæ—©ä»¥å‰å°±æ‰“ç®—æ­ä¸€ä¸ªåšå®¢ï¼Œä½†æ˜¯ç™¾åº¦äº†ä¸€ä¸‹å‘ç°è¿˜æ˜¯æŒºéº»çƒ¦çš„ï¼ŒåŠ ä¸Šæœ€è¿‘ä¹Ÿæ¯”è¾ƒå¿™æ‰€æœ‰ä¸€ç›´ä¹Ÿå°±æ²¡æœ‰åšï¼Œç›´åˆ°çœ‹åˆ°è¿™ç¯‡åšæ–‡æ‰é¡ºåˆ©çš„æ­èµ·äº†è¿™ä¸ªåšå®¢ã€‚ä¸­é€”é‡åˆ°ä¸å°‘é—®é¢˜ä¹Ÿéƒ½é¡ºåˆ©è§£å†³äº†ï¼ŒçœŸæ˜¯å­¦åˆ°äº†ä¸å°‘çš„ä¸œè¥¿ã€‚ ç†Ÿç»ƒäº†Markdownè¯­æ³•ã€‚ çœŸæ­£ä½¿ç”¨äº†ç¼–è¾‘ç¥å™¨ Sublimeã€‚ ä½¿ç”¨é˜¿é‡Œäº‘è§£æäº†githubå’Œcodingé‡Œçš„PagesæœåŠ¡ã€‚ hexoå’Œå¸¸ç”¨çš„ä¸»é¢˜é…ç½®ã€‚ æˆ‘çš„é…ç½® Hexoé…ç½® JackMané…ç½®imglogo: enable: true ## display image logo true/false. src: img/logo.gif ## `.svg` and `.png` are recommended,please put image into the theme folder `/jacman/source/img`. favicon: img/favicon.ico ## size:32px*32px,`.ico` is recommended,please put image into the theme folder `/jacman/source/img`. apple_icon: img/jacman.jpg ## size:114px*114px,please put image into the theme folder `/jacman/source/img`. author_img: img/author.jpg ## size:220px*220px.display author avatar picture.if don&apos;t want to display,please don&apos;t set this. banner_img: #img/banner.jpg ## size:1920px*200px+. Banner Picture ### Theme Color theme_color: theme: &apos;#2ca6cb&apos; ##the defaut theme color is blue # ä»£ç é«˜äº®ä¸»é¢˜ # available: default | night highlight_theme: night #### index post is expanding or not index: expand: false ## default is unexpanding,so you can only see the short description of each post. excerpt_link: Read More close_aside: false #close sidebar in post page if true mathjax: false #enable mathjax if true ### Creative Commons License Support, see http://creativecommons.org/ ### you can choose: by , by-nc , by-nc-nd , by-nc-sa , by-nd , by-sa , zero creative_commons: none ç»“æŸè¯­ä»¥ä¸Šã€‚ã€‚æˆ‘åšè¿™ä¸ªåšå®¢çš„åˆè¡·ä¸€æ˜¯ä¸ºäº†è®°å½•æˆ‘çš„æ•´ä¸ªç¨‹åºçŒ¿ç”Ÿæ¶¯çš„æ•…äº‹ï¼ŒäºŒæ˜¯å¸Œæœ›èƒ½æœ‰å¤§ç¥èƒ½åœ¨è¿‡ç¨‹ä¸­æŒ‡å‡ºæˆ‘çš„é”™è¯¯ï¼Œèƒ½è®©æˆ‘çš„æ°´å¹³æ›´è¿›ä¸€æ­¥ã€‚]]></content>
      <categories>
        <category>blog</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
        <tag>æ€»ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Markdownå°è®¡]]></title>
    <url>%2F2016%2F05%2F06%2FMarkdown%E5%B0%8F%E8%AE%A1%2F</url>
    <content type="text"><![CDATA[# æ ‡é¢˜ è¡¨ç¤ºæ ‡é¢˜ ä¸€ä¸ª#å·ä»£è¡¨ä¸€çº§æ ‡é¢˜ï¼Œä»¥æ­¤ç±»æ¨ã€‚ * æ— åºåˆ—è¡¨ æ— åºåˆ—è¡¨ &gt; å¼•ç”¨ å¼•ç”¨ [http://www.baidu.com](http://www.baidu.com &quot;ç™¾åº¦&quot;) ç™¾åº¦ ![è‰¾å¼—æ£®](http://i.imgur.com/TLnZ2S6.jpg)æ’å…¥å›¾ç‰‡]]></content>
      <categories>
        <category>blog</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linuxï¼ˆä¸€ï¼‰å¸¸ç”¨å‘½ä»¤]]></title>
    <url>%2F2016%2F04%2F10%2FLinux-normal%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ç”±äºç°åœ¨JAVAå¼€å‘çš„å¾ˆå¤šåº”ç”¨éƒ½æ˜¯éƒ¨ç½²åˆ°Linuxç³»ç»Ÿä¸Šçš„ï¼Œå› æ­¤äº†è§£å’ŒæŒæ¡ä¸€äº›Linuxçš„å¸¸ç”¨å‘½ä»¤æ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼Œä»¥ä¸‹å°±æ˜¯åœ¨Javaå¼€å‘è¿‡ç¨‹ä¸­ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ã€‚ å¸¸ç”¨å‘½ä»¤ æŸ¥æ‰¾æ–‡ä»¶find / -name log.txtæ ¹æ®åç§°æŸ¥æ‰¾åœ¨ /ç›®å½•ä¸‹çš„ log.txtæ–‡ä»¶ã€‚ find .-name &quot;*.xml&quot;é€’å½’æŸ¥æ‰¾æ‰€æœ‰çš„xmlæ–‡ä»¶ã€‚ find .-name &quot;*.xml&quot;|xargs grep &quot;hello&quot;é€’å½’æŸ¥æ‰¾æ‰€æœ‰åŒ…å«helloçš„xmlæ–‡ä»¶ã€‚ ls -l grep &#39;jar&#39;æŸ¥æ‰¾å½“å‰ç›®å½•ä¸­çš„æ‰€æœ‰jaræ–‡ä»¶ã€‚ æ£€æŸ¥ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦è¿è¡Œps â€“ef|grep tomecateæ£€æŸ¥æ‰€æœ‰æœ‰å…³tomcatçš„è¿›ç¨‹ã€‚ ç»ˆæ­¢çº¿ç¨‹kill -9 19979ç»ˆæ­¢çº¿ç¨‹å·ä¸º19979çš„çº¿ç¨‹ æŸ¥çœ‹æ–‡ä»¶ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶ã€‚ls -al æŸ¥çœ‹å½“å‰å·¥ä½œç›®å½•ã€‚pwd å¤åˆ¶æ–‡ä»¶åŒ…æ‹¬å…¶å­æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•cp -r source targetå¤åˆ¶sourceæ–‡ä»¶åˆ°targetç›®å½•ä¸­ã€‚ åˆ›å»ºä¸€ä¸ªç›®å½•mkdir newåˆ›å»ºä¸€ä¸ªnewçš„ç›®å½• åˆ é™¤ç›®å½•(å‰ææ˜¯æ­¤ç›®å½•æ˜¯ç©ºç›®å½•)rmdir sourceåˆ é™¤sourceç›®å½•ã€‚ åˆ é™¤æ–‡ä»¶ åŒ…æ‹¬å…¶å­æ–‡ä»¶rm -rf fileåˆ é™¤fileæ–‡ä»¶å’Œå…¶ä¸­çš„å­æ–‡ä»¶ã€‚-rè¡¨ç¤ºå‘ä¸‹é€’å½’ï¼Œä¸ç®¡æœ‰å¤šå°‘ç›®å½•ä¸€å¾‹åˆ é™¤-fè¡¨ç¤ºå¼ºåˆ¶åˆ é™¤ï¼Œä¸åšä»»ä½•æç¤ºã€‚ ç§»åŠ¨æ–‡ä»¶mv /temp/movefile /target åˆ‡æ¢ç”¨æˆ·su -username æŸ¥çœ‹ipifconfigæ³¨æ„æ˜¯ ifconfig ä¸æ˜¯windowsä¸­çš„ipconfig æ€»ç»“ä»¥ä¸Šå°±æ˜¯åœ¨Linuxä¸‹å¼€å‘Javaåº”ç”¨å¸¸ç”¨çš„Linuxå‘½ä»¤ï¼Œå¦‚æœ‰é—æ¼è¯·åœ¨è¯„è®ºå¤„è¡¥å……ï¼Œæˆ‘å°†ä¸å®šæœŸæ·»åŠ ã€‚]]></content>
      <categories>
        <category>Linuxç¬”è®°</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸ªäººç®€å†]]></title>
    <url>%2F1994%2F08%2F08%2Fmyresume%2F</url>
    <content type="text"><![CDATA[ä¸ªäººä¿¡æ¯ é™ˆæ°/ç”·/1994 å·¥ä½œå¹´é™ï¼š3å¹´ æŠ€æœ¯åšå®¢ï¼šhttps://crossoverjie.top Githubï¼šhttp://github.com/crossoverjie æœŸæœ›èŒä½ï¼šJava é«˜çº§å·¥ç¨‹å¸ˆ è”ç³»æ–¹å¼ æ‰‹æœºï¼š18523985794 Emailï¼šcrossoverJie@gmail.com QQ/å¾®ä¿¡å·ï¼š731756881 / chycjj å·¥ä½œç»å†äºšä¿¡ç§‘æŠ€ ï¼ˆ 2017å¹´05æœˆ ~ è‡³ä»Š ï¼‰IOP æ™ºèƒ½è¥é”€å¹³å°é¡¹ç›®æè¿°ï¼šæ ¹æ®ç”¨æˆ·DNAæ•°æ®ã€å½“å‰ä½ç½®ç­‰ä¿¡æ¯åˆç†çš„æ¨é€ç›¸åº”çš„è¥é”€æ´»åŠ¨ç»™ç”¨æˆ·ã€‚ä¸»è¦è´Ÿè´£ï¼š çŸ­ä¿¡ç¾¤å‘æ¸ é“çš„æ•´ä¸ªæµç¨‹ã€‚ çŸ­ä¿¡ç½‘å…³:ä¿è¯ 1000W+ çš„ç”¨æˆ·æ•°æ®å®‰å…¨æœ‰æ•ˆçš„é€šè¿‡çŸ­ä¿¡ç½‘å…³è¿›è¡ŒçŸ­ä¿¡ä¸‹å‘ã€‚ 51 è¥ä¸šå…é¡¹ç›®æè¿°: åŸºäºäº‘ç«¯çš„è¿›é”€å­˜ç³»ç»Ÿã€‚ä¸»è¦è´Ÿè´£ï¼š æ”¯ä»˜æ¨¡å—ã€‚ è´¢åŠ¡æ¨¡å—ã€‚ çº¿ä¸Šåœ°å€ : https://www.51yyt.com.cn/ å…¶ä»–é¡¹ç›®è¯·æ±‚é˜²é‡ç»„ä»¶é¡¹ç›®æè¿° : å¯¹äºæŸäº›ä¸šåŠ¡è¦æ±‚æ¯æ¬¡è¯·æ±‚ä¿è¯å”¯ä¸€ï¼Œå¦‚æœæ¯ä¸ªæ¥å£éƒ½åšæ ¡éªŒæ“ä½œçš„è¯è€¦åˆå¤ªé«˜ä¹Ÿä¸åˆ©äºç»´æŠ¤ã€‚åŸºäºæ­¤è‡ªå®šä¹‰äº† annotation ,é€šè¿‡ Spring çš„ AOP åªè¦ç»™ç›¸åº”çš„æ¥å£åŠ ä¸Šè¯¥æ³¨è§£å³å¯å®ç°è¯·æ±‚å»é‡ã€‚ å¼€æºåœ°å€: Spring ç‰ˆ: https://github.com/crossoverJie/SSM-REQUEST-CHECK SpringBoot ç‰ˆ: https://github.com/crossoverJie/springboot-cloud çŒªå…«æˆ’ç½‘ç»œæœ‰é™å…¬å¸ ï¼ˆ 2016å¹´05æœˆ ~ 2017å¹´05æœˆ ï¼‰å…«æˆ’è®¤è¯é¡¹ç›®æè¿°ï¼šä¸ºæ•´ä¸ªçŒªå…«æˆ’ç½‘æä¾›å®åè®¤è¯æœåŠ¡ï¼Œä¸»æ¨äººè„¸è¯†åˆ«è®¤è¯ã€‚æœŸæœ›æ‰“é€ æˆä¸€ä¸ªæƒå¨çš„ç¬¬ä¸‰æ–¹å®åè®¤è¯å¹³å°ã€‚åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ¨¡å—ï¼š Webç«¯äººè„¸è¯†åˆ«è®¤è¯ã€‚ ç§»åŠ¨ç«¯äººè„¸è¯†åˆ«è®¤è¯(IOS,Android)ã€‚ å›½å†…å¢ƒå¤–ä¼ä¸šå®¡æ ¸è®¤è¯ã€‚ å›½å†…æ¸¯æ¾³å°ä¸ªäººå®¡æ ¸è®¤è¯ã€‚ ä¸»è¦è´Ÿè´£ï¼š å…«æˆ’è®¤è¯æ ¸å¿ƒæœåŠ¡å¼€å‘ã€‚ æ–°è€ç³»ç»Ÿæ•°æ®è¿ç§»ã€‚ æ•´ä¸ªä¸»ç«™æ‰€ä¾èµ–çš„å®åæŸ¥è¯¢æ¥å£ã€‚ çº¿ä¸Šåœ°å€ : https://do.renzheng.zbj.com/fe/page/index å…¶ä»–é¡¹ç›®Dubbo æ¥å£ å®ç° HTTP è®¿é—®ç»„ä»¶é¡¹ç›®æè¿° : ç”±äº Dubbo æ¥å£é€šå¸¸æ˜¯å†…éƒ¨åº”ç”¨ä¹‹é—´è¿›è¡Œè°ƒç”¨ï¼Œå½“æˆ‘ä»¬æƒ³è¦æ’é™¤æ‰è¯­è¨€çš„ç‰¹æœ‰æ€§çš„è¯æœ€å¥½è¿˜æ˜¯æä¾›ä¸€ä¸ª HTTP æ¥å£ã€‚åŸºäºæ­¤å¼€å‘äº†ä¸€ä¸ªç»„ä»¶å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸæœ‰ Dubbo æ¥å£çš„å‰æä¸‹å®ç° HTTP è®¿é—®ï¼Œè¿™åœ¨æŸäº›ç‰¹æœ‰ç¯å¢ƒä¸‹è¿›è¡Œè°ƒè¯•æ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚ å¼€æºåœ°å€ : https://github.com/crossoverJie/SSM-DUBBO-HTTP é‡åº†é©°éª…ç§‘æŠ€ ï¼ˆ 2014å¹´11æœˆ ~ 2016å¹´05æœˆ ï¼‰é•¿å®‰é©¬è‡ªè¾¾å†…éƒ¨å®¡è®¡ç³»ç»Ÿ é¡¹ç›®æè¿°ï¼šè¯¥é¡¹ç›®ä¸ºé•¿å®‰é©¬è‡ªè¾¾è´¢åŠ¡éƒ¨é—¨å†…éƒ¨ä½¿ç”¨çš„ä¸€ä¸ªå®¡è®¡ç³»ç»Ÿï¼Œç”¨äºå‡çº§æ•´ä¸ªé•¿é©¬å…¬å¸çš„é£é™©å’Œç®¡ç†å·¥ä½œã€‚ä¸»è¦è´Ÿè´£ï¼š ç¼–å†™é¡¹ç›®è¿‡ç¨‹ä¸­çš„å„ä¸ªé‡Œç¨‹ç¢‘æ–‡æ¡£ã€‚ ç³»ç»Ÿæ•°æ®åº“è®¾è®¡ã€‚ åˆ¶å®šå¹¶åˆ†é…å¼€å‘ä»»åŠ¡ã€‚ èµ„æºå…±äº«ã€ç³»ç»ŸæŒ‡å—ã€ç³»ç»Ÿç®¡ç†ã€é£é™©ç®¡ç†æ¨¡å—ä»£ç çš„å®ç°ã€‚ é•¿å®‰æ±½è½¦è®¾è®¡æˆæœ¬ç®¡æ§ç³»ç»Ÿé¡¹ç›®æè¿°ï¼šè¯¥é¡¹ç›®ä¸ºé‡åº†é•¿å®‰å…¬å¸ä½¿ç”¨æˆæœ¬ç®¡æ§ç³»ç»Ÿï¼Œå¯¹æ•´ä¸ªæ±½è½¦ç”Ÿäº§æ‰€äº§ç”Ÿçš„æˆæœ¬è¿›è¡Œé¢„ä¼°ä¸ç®¡ç† ä¸»è¦è´Ÿè´£ï¼š é›¶éƒ¨ä»¶å‚æ•°å‡†ç¡®ç‡ã€åŠæ—¶ç‡çš„å¼€å‘ã€‚ å¼€æºé¡¹ç›®å’Œä½œå“å¼€æºé¡¹ç›® SSMï¼šä» 0 æ„å»ºä¸€å¥—åˆ†å¸ƒå¼ç³»ç»Ÿã€‚(1.2K star) springboot-cloudï¼šåŸºäº SpringBoot + SpringCloud æ­å»ºçš„å¾®æœåŠ¡é¡¹ç›® æŠ€æœ¯æ–‡ç«  åŸºäºdubboçš„åˆ†å¸ƒå¼æ¶æ„ MQåº”ç”¨ è¯‘ ä½ å¯ä»¥ç”¨GitHubåšçš„12ä»¶ Cool äº‹æƒ… æŠ€èƒ½æ¸…å•ä»¥ä¸‹å‡ä¸ºæˆ‘ç†Ÿç»ƒä½¿ç”¨çš„æŠ€èƒ½ ä¸»åŠ›è¯­è¨€ï¼šJava æ¡†æ¶ï¼šSpring/SpringMVC/Mybatis/SpringBoot/SpringCloud/Dubbo ä¸­é—´ä»¶ï¼šKafka/Zookeeper/é…ç½®ä¸­å¿ƒ/è°ƒåº¦ä¸­å¿ƒ æ•°æ®åº“ç›¸å…³ï¼šMySQL/Oracle ç‰ˆæœ¬ç®¡ç†ã€æ–‡æ¡£å’Œè‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·ï¼šSvn/Git/Jenkins å•å…ƒæµ‹è¯•ï¼šJunit/Jacoco/coveralls æœåŠ¡å™¨ : Linuxå¸¸ç”¨æ“ä½œï¼ŒåŸºæœ¬çš„ Shell è„šæœ¬ç¼–å†™ è‡´è°¢æ„Ÿè°¢æ‚¨èŠ±æ—¶é—´é˜…è¯»æˆ‘çš„ç®€å†ï¼ŒæœŸå¾…èƒ½æœ‰æœºä¼šå’Œæ‚¨å…±äº‹ã€‚]]></content>
      <categories>
        <category>resume</category>
      </categories>
      <tags>
        <tag>æ€»ç»“</tag>
      </tags>
  </entry>
</search>
